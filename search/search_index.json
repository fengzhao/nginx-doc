{"config":{"lang":["ja"],"separator":"[\\s\\-\uff0c\u3002]+","pipeline":["stemmer"]},"docs":[{"location":"Development/%E8%B4%A1%E7%8C%AE%E6%8C%87%E5%8D%97/","title":"\u8d21\u732e\u53d8\u66f4","text":""},{"location":"Development/%E8%B4%A1%E7%8C%AE%E6%8C%87%E5%8D%97/#_2","title":"\u83b7\u53d6\u6e90\u7801","text":"<p>Mercurial \u662f\u4e00\u4e2a\u6e90\u7801\u5b58\u50a8\u5de5\u5177\u3002\u53ef\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u6e90\u7801\u4ed3\u5e93\uff1a</p> <pre><code>hg clone http://hg.nginx.org/nginx\n</code></pre>"},{"location":"Development/%E8%B4%A1%E7%8C%AE%E6%8C%87%E5%8D%97/#_3","title":"\u683c\u5f0f\u5316\u53d8\u66f4","text":"<p>\u53d8\u66f4\u5e94\u6839\u636e nginx \u4f7f\u7528\u7684\u4ee3\u7801\u6837\u5f0f\u8fdb\u884c\u683c\u5f0f\u5316\u3002\u4ee3\u7801\u683c\u5f0f\u5316\u4e0d\u5e94\u8be5\u4f9d\u8d56\u4e8e\u8bf8\u5982\u8bed\u6cd5\u9ad8\u4eae\u6216\u81ea\u52a8\u6362\u884c\u7b49\u7f16\u8f91\u5668\u529f\u80fd\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u57fa\u672c\u89c4\u5219\uff1a</p> <ul> <li>\u6700\u5927\u6587\u672c\u5bbd\u5ea6\u4e3a 80 \u4e2a\u5b57\u7b26</li> <li>\u7f29\u8fdb\u4e3a\u56db\u4e2a\u7a7a\u683c</li> <li>\u6ca1\u6709 tab\uff08\u5236\u8868\u7b26\uff09</li> <li>\u6587\u4ef6\u4e2d\u7684\u903b\u8f91\u4ee3\u7801\u5757\u7528\u4e24\u884c\u7a7a\u884c\u5206\u9694</li> </ul> <p>\u53c2\u7167\u73b0\u6709 nginx \u6e90\u7801\u7684\u683c\u5f0f\uff0c\u5728\u60a8\u7684\u4ee3\u7801\u4e2d\u6a21\u4eff\u6b64\u6837\u5f0f\u3002\u5982\u679c\u98ce\u683c\u4e0e\u5468\u56f4\u7684\u4ee3\u7801\u76f8\u4e00\u81f4\uff0c\u5219\u66f4\u6539\u66f4\u5bb9\u6613\u88ab\u63a5\u53d7\u3002</p> <p>\u63d0\u4ea4\u66f4\u6539\u4ee5\u521b\u5efa\u4e00\u4e2a Mercurial \u53d8\u66f4\u96c6\uff08changeset\uff09\u3002\u8bf7\u786e\u4fdd\u6307\u5b9a\u7684 \u7535\u5b50\u90ae\u4ef6 \u548c\u53d8\u66f4\u4f5c\u8005\u7684\u771f\u5b9e\u59d3\u540d\u6b63\u786e\u65e0\u8bef\u3002</p> <p>\u63d0\u4ea4\u6d88\u606f\u5e94\u662f\u5355\u884c\u7b80\u8ff0\uff0c\u540e\u8ddf\u4e00\u884c\u7a7a\u884c\u52a0\u63cf\u8ff0\u5185\u5bb9\u3002\u7b2c\u4e00\u884c\u6700\u597d\u4e0d\u8981\u8d85\u8fc7 67 \u4e2a\u7b26\u53f7\u3002\u53ef\u4ee5\u4f7f\u7528 <code>hg export</code> \u547d\u4ee4\u83b7\u5f97\u4e00\u4e2a\u7ed3\u679c\u53d8\u66f4\u96c6 patch\uff1a</p> <pre><code># HG changeset patch\n# User Filipe Da Silva &lt;username@example.com&gt;\n# Date 1368089668 -7200\n#      Thu May 09 10:54:28 2013 +0200\n# Node ID 2220de0521ca2c0b664a8ea1e201ce1cb90fd7a2\n# Parent  822b82191940ef309cd1e6502f94d50d811252a1\nMail: removed surplus ngx_close_connection() call.\n\nIt is already called for a peer connection a few lines above.\n\ndiff -r 822b82191940 -r 2220de0521ca src/mail/ngx_mail_auth_http_module.c\n--- a/src/mail/ngx_mail_auth_http_module.c      Wed May 15 15:04:49 2013 +0400\n+++ b/src/mail/ngx_mail_auth_http_module.c      Thu May 09 10:54:28 2013 +0200\n@@ -699,7 +699,6 @@ ngx_mail_auth_http_process_headers(ngx_m\n\n                    p = ngx_pnalloc(s-&gt;connection-&gt;pool, ctx-&gt;err.len);\n                     if (p == NULL) {\n-                        ngx_close_connection(ctx-&gt;peer.connection);\n                        ngx_destroy_pool(ctx-&gt;pool);\n                         ngx_mail_session_internal_server_error(s);\n                         return;\n</code></pre>"},{"location":"Development/%E8%B4%A1%E7%8C%AE%E6%8C%87%E5%8D%97/#_4","title":"\u63d0\u4ea4\u524d","text":"<p>\u63d0\u4ea4\u66f4\u6539\u524d\uff0c\u6709\u51e0\u70b9\u503c\u5f97\u601d\u8003\uff1a</p> <ul> <li>\u5efa\u8bae\u7684\u53d8\u66f4\u5e94\u80fd\u5728\u5927\u90e8\u5206\u7684 \u652f\u6301\u5e73\u53f0 \u4e0a\u6b63\u5e38\u5de5\u4f5c\u3002</li> <li>\u5c3d\u91cf\u8bf4\u660e\u6e05\u695a\u4e3a\u4ec0\u4e48\u9700\u8981\u66f4\u6539\uff0c\u5982\u679c\u53ef\u4ee5\u7684\u8bdd\uff0c\u8bf7\u63d0\u4f9b\u4e00\u4e2a\u7528\u4f8b\u3002</li> <li>\u901a\u8fc7\u6d4b\u8bd5\u5957\u4ef6\u4f20\u9012\u60a8\u7684\u66f4\u6539\u662f\u786e\u4fdd\u4e0d\u4f1a\u5bfc\u81f4\u56de\u5f52\u7684\u597d\u65b9\u6cd5\u3002\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u514b\u9686\u6d4b\u8bd5\u4ed3\u5e93\uff1a</li> </ul> <pre><code>hg clone http://hg.nginx.org/nginx-tests\n</code></pre>"},{"location":"Development/%E8%B4%A1%E7%8C%AE%E6%8C%87%E5%8D%97/#_5","title":"\u63d0\u4ea4\u53d8\u66f4","text":"<p>\u63d0\u8bae\u7684\u66f4\u6539\u5e94\u53d1\u9001\u5230 nginx \u5f00\u53d1 \u90ae\u4ef6\u5217\u8868\u3002\u63d0\u4ea4\u66f4\u6539\u96c6\u7684\u9996\u9009\u4fbf\u6377\u65b9\u6cd5\u662f\u4f7f\u7528 patchbomb \u6269\u5c55\u3002</p>"},{"location":"Development/%E8%B4%A1%E7%8C%AE%E6%8C%87%E5%8D%97/#_6","title":"\u8bb8\u53ef\u8bc1","text":"<p>\u63d0\u4ea4\u53d8\u66f4\u610f\u5473\u7740\u6388\u4e88\u9879\u76ee\u4e00\u4e2a\u6743\u9650\u4ee5\u5728\u4e00\u4e2a\u9002\u5f53\u7684\u8bb8\u53ef\u8bc1\u4e0b\u4f7f\u7528\u5b83\u3002</p>"},{"location":"Development/%E8%B4%A1%E7%8C%AE%E6%8C%87%E5%8D%97/#_7","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/contributing_changes.html</p>"},{"location":"How-To/WebSocket%E4%BB%A3%E7%90%86/","title":"WebSocket \u4ee3\u7406","text":"<p>\u8981\u5c06\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u8fde\u63a5\u4ece HTTP/1.1 \u8f6c\u6362\u4e3a WebSocket\uff0c\u53ef\u662f\u4f7f\u7528 HTTP/1.1 \u4e2d\u7684 \u534f\u8bae\u5207\u6362 \u673a\u5236\u3002</p> <p>\u7136\u800c\uff0c\u6709\u4e00\u4e2a\u5fae\u5999\u7684\u5730\u65b9\uff1a\u7531\u4e8e <code>Upgrade</code> \u662f\u4e00\u4e2a\u9010\u8df3\uff08hop-by-hop\uff09\u5934\uff0c\u5b83\u4e0d\u4f1a\u4ece\u5ba2\u6237\u7aef\u4f20\u9012\u5230\u4ee3\u7406\u670d\u52a1\u5668\u3002\u5f53\u4f7f\u7528\u8f6c\u53d1\u4ee3\u7406\u65f6\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u4f7f\u7528 <code>CONNECT</code> \u65b9\u6cd5\u6765\u89c4\u907f\u6b64\u95ee\u9898\u3002\u7136\u800c\uff0c\u8fd9\u4e0d\u9002\u7528\u4e8e\u53cd\u5411\u4ee3\u7406\uff0c\u56e0\u4e3a\u5ba2\u6237\u7aef\u4e0d\u77e5\u9053\u4efb\u4f55\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u8fd9\u9700\u8981\u5728\u4ee3\u7406\u670d\u52a1\u5668\u4e0a\u8fdb\u884c\u7279\u6b8a\u5904\u7406\u3002</p> <p>\u81ea 1.3.13 \u7248\u672c\u4ee5\u6765\uff0cnginx \u5b9e\u73b0\u4e86\u7279\u6b8a\u7684\u64cd\u4f5c\u6a21\u5f0f\uff0c\u5982\u679c\u4ee3\u7406\u670d\u52a1\u5668\u8fd4\u56de\u4e00\u4e2a 101\u54cd\u5e94\u7801\uff08\u4ea4\u6362\u534f\u8bae\uff09\uff0c\u5219\u5ba2\u6237\u673a\u548c\u4ee3\u7406\u670d\u52a1\u5668\u4e4b\u95f4\u5c06\u5efa\u7acb\u96a7\u9053\uff0c\u5ba2\u6237\u7aef  \u901a\u8fc7\u8bf7\u6c42\u4e2d\u7684 <code>Upgrade</code> \u5934\u6765\u8bf7\u6c42\u534f\u8bae\u4ea4\u6362\u3002</p> <p>\u5982\u4e0a\u6240\u8ff0\uff0c\u5305\u62ec <code>Upgrade</code> \u548c <code>Connection</code> \u7684\u9010\u8df3\u5934\u4e0d\u4f1a\u4ece\u5ba2\u6237\u7aef\u4f20\u9012\u5230\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u56e0\u6b64\u4e3a\u4e86\u4f7f\u4ee3\u7406\u670d\u52a1\u5668\u77e5\u9053\u5ba2\u6237\u7aef\u5c06\u534f\u8bae\u5207\u6362\u5230 WebSocket \u7684\u610f\u56fe\uff0c\u8fd9\u4e9b\u5934\u5fc5\u987b\u660e\u786e\u5730\u4f20\u9012\uff1a</p> <pre><code>location /chat/ {\nproxy_pass http://backend;\nproxy_http_version 1.1;\nproxy_set_header Upgrade $http_upgrade;\nproxy_set_header Connection \"upgrade\";\n}\n</code></pre> <p>\u4e00\u4e2a\u66f4\u590d\u6742\u7684\u4f8b\u5b50\u662f\uff0c\u5bf9\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u4e2d\u7684 <code>Connection</code> \u5934\u5b57\u6bb5\u7684\u503c\u53d6\u51b3\u4e8e\u5ba2\u6237\u7aef\u8bf7\u6c42\u5934\u4e2d\u7684 <code>Upgrade</code> \u5b57\u6bb5\u7684\u5b58\u5728\uff1a</p> <pre><code>http {\nmap $http_upgrade $connection_upgrade {\ndefault upgrade;\n''      close;\n}\n\nserver {\n...\n\nlocation /chat/ {\nproxy_pass http://backend;\nproxy_http_version 1.1;\nproxy_set_header Upgrade $http_upgrade;\nproxy_set_header Connection $connection_upgrade;\n}\n}\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u4ee3\u7406\u52a1\u5668\u5728 60 \u79d2\u5185\u6ca1\u6709\u4f20\u8f93\u4efb\u4f55\u6570\u636e\uff0c\u8fde\u63a5\u5c06\u88ab\u5173\u95ed\u3002\u8fd9\u4e2a\u8d85\u65f6\u53ef\u4ee5\u901a\u8fc7 proxy_read_timeout \u6307\u4ee4\u6765\u589e\u52a0\u3002 \u6216\u8005\uff0c\u4ee3\u7406\u670d\u52a1\u5668\u53ef\u4ee5\u914d\u7f6e\u4e3a\u5b9a\u671f\u53d1\u9001 WebSocket ping \u5e27\u4ee5\u91cd\u7f6e\u8d85\u65f6\u5e76\u68c0\u67e5\u8fde\u63a5\u662f\u5426\u4ecd\u7136\u6d3b\u8dc3\u3002</p>"},{"location":"How-To/WebSocket%E4%BB%A3%E7%90%86/#_1","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/websocket.html</p>"},{"location":"How-To/%E4%BB%8E%E6%BA%90%E7%A0%81%E6%9E%84%E5%BB%BAnginx/","title":"\u4ece\u6e90\u7801\u6784\u5efa nginx","text":"<p>\u7f16\u8bd1\u65f6\u4f7f\u7528 <code>configure</code> \u547d\u4ee4\u8fdb\u884c\u914d\u7f6e\u3002\u5b83\u5b9a\u4e49\u4e86\u7cfb\u7edf\u7684\u5404\u4e2a\u65b9\u9762\uff0c\u5305\u62ec\u4e86 nginx \u8fdb\u884c\u8fde\u63a5\u5904\u7406\u4f7f\u7528\u7684\u65b9\u6cd5\u3002\u6700\u7ec8\u5b83\u4f1a\u521b\u5efa\u51fa\u4e00\u4e2a <code>Makefile</code>\u3002<code>configure</code> \u547d\u4ee4\u652f\u6301\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <ul> <li> <p>--prefix=path</p> <p>\u5b9a\u4e49\u4e00\u4e2a\u7528\u4e8e\u4fdd\u7559\u670d\u52a1\u5668\u6587\u4ef6\u7684\u76ee\u5f55\u3002\u6b64\u76ee\u5f55\u4e5f\u5c06\u7528\u4e8e\u6240\u6709\u901a\u8fc7 <code>configure</code> \u8bbe\u7f6e\u7684\u76f8\u5bf9\u8def\u5f84\uff08\u9664\u4e86\u5e93\u6e90\u7801\u8def\u5f84\u5916\uff09\u548c <code>nginx.conf</code> \u914d\u7f6e\u6587\u4ef6\u3002\u9ed8\u8ba4\u8bbe\u7f6e\u4e3a <code>/usr/local/nginx</code> \u76ee\u5f55\u3002 - --sbin-path=path</p> <p>\u8bbe\u7f6e nginx \u53ef\u6267\u884c\u6587\u4ef6\u7684\u540d\u79f0\u3002\u6b64\u540d\u79f0\u4ec5\u5728\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6587\u4ef6\u540d\u4e3a <code>prefix/sbin/nginx</code>\u3002 - --conf-path=path</p> <p>\u8bbe\u7f6e <code>nginx.conf</code> \u914d\u7f6e\u6587\u4ef6\u7684\u540d\u79f0\u3002\u5982\u679c\u9700\u8981\uff0cnginx \u53ef\u4ee5\u4f7f\u7528\u4e0d\u540c\u7684\u914d\u7f6e\u6587\u4ef6\u542f\u52a8\uff0c\u65b9\u6cd5\u662f\u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570 <code>-c</code> \u6307\u5b9a\u6587\u4ef6\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6587\u4ef6\u540d\u4e3a <code>prefix/conf/nginx.conf</code>\u3002 - --pid-path=path</p> <p>\u8bbe\u7f6e\u5b58\u50a8\u4e3b\u8fdb\u7a0b\u7684\u8fdb\u7a0b ID \u7684 nginx.pid \u6587\u4ef6\u540d\u79f0\u3002\u5b89\u88c5\u540e\uff0c\u53ef\u4ee5\u5728 <code>nginx.conf</code> \u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528 pid \u6307\u4ee4\u66f4\u6539\u6587\u4ef6\u540d\u3002\u9ed8\u8ba4\u6587\u4ef6\u540d\u4e3a <code>prefix/logs/nginx.pid</code>\u3002 - --lock-path=path</p> <p>\u8bbe\u7f6e\u9501\u6587\u4ef6\u7684\u540d\u79f0\u524d\u7f00\u3002\u5b89\u88c5\u540e\uff0c\u53ef\u4ee5\u5728 <code>nginx.conf</code> \u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528 lock_file \u6307\u4ee4\u66f4\u6539\u5bf9\u5e94\u7684\u503c\u3002\u9ed8\u8ba4\u503c\u4e3a <code>prefix/logs/nginx.lock</code>\u3002 - --error-log-path=path</p> <p>\u8bbe\u7f6e\u4e3b\u8981\u9519\u8bef\u3001\u8b66\u544a\u548c\u8bca\u65ad\u6587\u4ef6\u7684\u540d\u79f0\u3002\u5b89\u88c5\u540e\uff0c\u53ef\u4ee5\u5728 <code>nginx.conf</code> \u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528 error_log \u6307\u4ee4\u66f4\u6539\u6587\u4ef6\u540d\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6587\u4ef6\u540d\u4e3a <code>prefix/logs/error.log</code>\u3002 - --http-log-path=path</p> <p>\u8bbe\u7f6e HTTP \u670d\u52a1\u5668\u4e3b\u8bf7\u6c42\u65e5\u5fd7\u6587\u4ef6\u540d\u79f0\u3002\u5b89\u88c5\u540e\uff0c\u53ef\u4ee5\u5728 <code>nginx.conf</code> \u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528 access_log \u6307\u4ee4\u66f4\u6539\u6587\u4ef6\u540d\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6587\u4ef6\u540d\u4e3a <code>prefix/logs/access.log</code>\u3002 - --build=name</p> <p>\u8bbe\u7f6e\u4e00\u4e2a\u53ef\u9009\u7684 nginx \u6784\u5efa\u540d\u79f0 - --user=name</p> <p>\u8bbe\u7f6e\u4e00\u4e2a\u975e\u7279\u6743\u7528\u6237\u540d\u79f0\uff0c\u5176\u51ed\u636e\u5c06\u7531\u5de5\u4f5c\u8fdb\u7a0b\u4f7f\u7528\u3002\u5b89\u88c5\u540e\uff0c\u53ef\u4ee5\u5728 <code>nginx.conf</code> \u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528 user \u6307\u4ee4\u66f4\u6539\u540d\u79f0\u3002\u9ed8\u8ba4\u7684\u7528\u6237\u540d\u4e3a <code>nobody</code>\u3002 - --group=name</p> <p>\u8bbe\u7f6e\u4e00\u4e2a\u7ec4\u7684\u540d\u79f0\uff0c\u5176\u51ed\u636e\u5c06\u7531\u5de5\u4f5c\u8fdb\u7a0b\u4f7f\u7528\u3002\u5b89\u88c5\u540e\uff0c\u53ef\u4ee5\u5728 <code>nginx.conf</code> \u914d\u7f6e\u6587\u4ef6\u4e2d\u4f7f\u7528 user \u6307\u4ee4\u66f4\u6539\u540d\u79f0\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7ec4\u540d\u79f0\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u975e\u7279\u6743\u7528\u6237\u7684\u540d\u79f0\u3002 - --with-select_module \u548c --without-select_module</p> <p>\u542f\u7528\u6216\u7981\u7528\u6784\u5efa\u5141\u8bb8\u670d\u52a1\u5668\u4f7f\u7528 <code>select()</code> \u65b9\u6cd5\u7684\u6a21\u5757\u3002\u5982\u679c\u5e73\u53f0\u4e0d\u652f\u6301\u5176\u4ed6\u66f4\u5408\u9002\u7684\u65b9\u6cd5\uff08\u5982 kqueue\u3001epoll \u6216 /dev/poll\uff09\uff0c\u5219\u5c06\u81ea\u52a8\u6784\u5efa\u8be5\u6a21\u5757\u3002 - --with-poll_module \u548c --without-poll_module</p> <p>\u542f\u7528\u6216\u7981\u7528\u6784\u5efa\u5141\u8bb8\u670d\u52a1\u5668\u4f7f\u7528 <code>poll()</code> \u65b9\u6cd5\u7684\u6a21\u5757\u3002\u5982\u679c\u5e73\u53f0\u4e0d\u652f\u6301\u5176\u4ed6\u66f4\u5408\u9002\u7684\u65b9\u6cd5\uff08\u5982 kqueue\u3001epoll \u6216 /dev/poll\uff09\uff0c\u5219\u5c06\u81ea\u52a8\u6784\u5efa\u8be5\u6a21\u5757\u3002 - with-threads</p> <p>\u5141\u8bb8\u4f7f\u7528\u7ebf\u7a0b\u6c60thread pools - with-file-aio</p> <p>\u542f\u7528\u5728FreeBSD\u548cLinux\u4e0aasynchronous file I/O (aio)\u6307\u4ee4\u7684\u4f7f\u7528 - --without-http_gzip_module</p> <p>\u7981\u7528\u6784\u5efa HTTP \u670d\u52a1\u5668\u54cd\u5e94\u538b\u7f29\u6a21\u5757\u3002\u9700\u8981 zlib \u5e93\u6765\u6784\u5efa\u548c\u8fd0\u884c\u6b64\u6a21\u5757\u3002 - --without-http_rewrite_module</p> <p>\u7981\u7528\u6784\u5efa\u5141\u8bb8 HTTP \u670d\u52a1\u5668\u91cd\u5b9a\u5411\u8bf7\u6c42\u548c\u66f4\u6539\u8bf7\u6c42 URI \u7684\u6a21\u5757\u3002\u9700\u8981 PCRE \u5e93\u6765\u6784\u5efa\u548c\u8fd0\u884c\u6b64\u6a21\u5757\u3002 - --without-http_proxy_module</p> <p>\u7981\u7528\u6784\u5efa HTTP \u670d\u52a1\u5668\u4ee3\u7406\u6a21\u5757\u3002 - --with-http_ssl_module</p> <p>\u5141\u8bb8\u6784\u5efa\u53ef\u5c06 HTTPS \u534f\u8bae\u652f\u6301\u6dfb\u52a0\u5230 HTTP \u670d\u52a1\u5668\u7684\u6a21\u5757\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6b64\u6a21\u5757\u53c2\u4e0e\u6784\u5efa\u3002\u6784\u5efa\u548c\u8fd0\u884c\u6b64\u6a21\u5757\u9700\u8981 OpenSSL \u5e93\u652f\u6301\u3002 - with-http_v2_module</p> <p>\u5141\u8bb8\u6784\u5efa\u4e00\u4e2a\u652f\u6301HTTP/2 \u7684\u6a21\u5757\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8be5\u6a21\u5757\u4e0d\u6784\u5efa\u3002 - with-http_realip_module</p> <p>\u5141\u8bb8\u6784\u5efangx_http_realip_module \u6a21\u5757\uff0c\u8be5\u6a21\u5757\u5c06\u5ba2\u6237\u7aef\u5730\u5740\u66f4\u6539\u4e3a\u5728\u6307\u5b9a\u7684header\u4e2d\u53d1\u9001\u7684\u5730\u5740\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - with-http_addition_module</p> <p>\u5141\u8bb8\u6784\u5efangx_http_addition_module \u6a21\u5757\uff0c\u8be5\u6a21\u5757\u80fd\u591f\u5728\u54cd\u5e94\u4e4b\u524d\u548c\u4e4b\u540e\u6dfb\u52a0\u6587\u672c\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - with-http_xslt_module**\u548c**with-http_xslt_module=dynamic</p> <p>\u5141\u8bb8\u6784\u5efa\u4f7f\u7528\u4e00\u4e2a\u6216\u8005\u591a\u4e2aXSLT\u6837\u5f0f\u8868\u8f6c\u5316\u4e3aXML\u54cd\u5e94\u7684ngx_http_xslt_module\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002libxslt \u548c libxml2 \u5e93\u9700\u8981\u8fd9\u4e2a\u6a21\u5757\u6765\u6784\u5efa\u548c\u542f\u52a8\u3002 - with-http_image_filter_module**\u548c**with-http_image_filter_module=dynamic</p> <p>\u5141\u8bb8\u6784\u5efangx_http_image_filter_module \u6a21\u5757\uff0c\u8be5\u6a21\u5757\u53ef\u4ee5\u8f6c\u6362 JPEG, GIF, PNG, \u548c WebP \u683c\u5f0f\u7684\u56fe\u7247\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - with-http_geoip_module**\u548c**with-http_geoip_module=dynamic</p> <p>\u5141\u8bb8\u6784\u5efangx_http_geoip_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u6839\u636e\u5ba2\u6237\u7aef IP \u5730\u5740\u548c\u9884\u7f16\u8bd1MaxMind \u7684\u6570\u636e\u5e93\u521b\u5efa\u53d8\u91cf\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - with-http_sub_module</p> <p>\u5141\u8bb8\u6784\u5efangx_http_sub_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u901a\u8fc7\u5c06\u4e00\u4e2a\u6307\u5b9a\u7684\u5b57\u7b26\u4e32\u66ff\u6362\u4e3a\u53e6\u4e00\u4e2a\u6765\u4fee\u6539\u76f8\u5e94\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - with-http_dav_module</p> <p>\u5141\u8bb8\u6784\u5efangx_http_dav_module  \u6a21\u5757\u3002\u8be5\u6a21\u5757\u901a\u8fc7WebDEV\u534f\u8bae\u63d0\u4f9b\u6587\u4ef6\u7ba1\u7406\u81ea\u52a8\u5316\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - with-http_flv_module</p> <p>\u5141\u8bb8\u6784\u5efangx_http_flv_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u4e3a Flash Videos (FLV) \u6587\u4ef6\u63d0\u4f9b\u4f2a\u6d41\u670d\u52a1\u5668\u7aef\u7684\u652f\u6301\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - with-http_mp4_module</p> <p>\u5141\u8bb8\u6784\u5efangx_http_mp4_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u4e3a MP4 \u6587\u4ef6\u63d0\u4f9b\u4f2a\u6d41\u670d\u52a1\u5668\u7aef\u7684\u652f\u6301\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - with-http_gunzip_module</p> <p>\u5141\u8bb8\u6784\u5efangx_http_gunzip_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u4f7f\u7528 <code>Content-Encoding: gzip</code> \u6765\u89e3\u538b\u7f29\u54cd\u5e94\u5bf9\u4e8e\u90a3\u4e9b\u4e0d\u652f\u6301<code>gzip</code>\u7f16\u7801\u65b9\u6cd5\u7684\u5ba2\u6237\u7aef\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - with-http_auth_request_module</p> <p>\u5141\u8bb8\u6784\u5efangx_http_auth_request_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u57fa\u4e8e\u5b50\u8bf7\u6c42\u7684\u7ed3\u679c\u5b9e\u73b0\u5ba2\u6237\u7aef\u6388\u6743\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - with-http_random_index_module</p> <p>\u5141\u8bb8\u6784\u5efangx_http_random_index_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u5904\u7406\u659c\u6760\u5b57\u7b26 ('/') \u7ed3\u5c3e\u7684\u8bf7\u6c42\uff0c\u5e76\u9009\u62e9\u76ee\u5f55\u4e2d\u7684\u968f\u673a\u6587\u4ef6\u4f5c\u4e3a\u7d22\u5f15\u6587\u4ef6\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - with-http_secure_link_module</p> <p>\u5141\u8bb8\u6784\u5efangx_http_secure_link_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - with-http_degradation_module</p> <p>\u5141\u8bb8\u6784\u5efa <code>with-http_degradation_module</code> \u6a21\u5757\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - with-http_slice_module</p> <p>\u5141\u8bb8\u6784\u5efangx_http_slice_module \u5c06\u8bf7\u6c42\u62c6\u5206\u4e3a\u5b50\u8bf7\u6c42\u7684\u6a21\u5757\uff0c\u6bcf\u4e2a\u6a21\u5757\u90fd\u8fd4\u56de\u4e00\u5b9a\u8303\u56f4\u7684\u54cd\u5e94\u3002\u8be5\u6a21\u5757\u63d0\u4f9b\u4e86\u66f4\u6709\u6548\u7684\u5927\u54cd\u5e94\u7f13\u5b58\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - with-http_stub_status_module</p> <p>\u5141\u8bb8\u6784\u5efangx_http_stub_status_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u63d0\u4f9b\u5bf9\u57fa\u672c\u72b6\u6001\u4fe1\u606f\u7684\u8bbf\u95ee\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - without-http_charset_module</p> <p>\u7981\u7528\u6784\u5efa\u538b\u7f29 HTTP \u54cd\u5e94\u7684ngx_http_charset_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u5c06\u6307\u5b9a\u7684\u5b57\u7b26\u96c6\u6dfb\u52a0\u5230 <code>Content-Type</code> \u54cd\u5e94\u5934\u5b57\u6bb5\uff0c\u8fd8\u53ef\u4ee5\u5c06\u6570\u636e\u4ece\u4e00\u4e2a\u5b57\u7b26\u96c6\u8f6c\u5316\u4e3a\u53e6\u4e00\u4e2a\u5b57\u7b26\u96c6\u3002 - without-http_gzip_module</p> <p>\u7981\u7528\u6784\u5efa\u538b\u7f29 HTTP \u54cd\u5e94\u7684compresses responses \u6a21\u5757\u3002\u6784\u5efa\u548c\u8fd0\u884c\u8fd9\u4e2a\u6a21\u5757\u9700\u8981 zlib \u5e93\u3002 - without-http_ssi_module</p> <p>\u7981\u7528\u6784\u5efawithout-http_ssi_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u5728\u901a\u8fc7\u5b83\u7684\u54cd\u5e94\u4e2d\u5904\u7406 SSI (\u670d\u52a1\u7aef\u5305\u542b) \u547d\u4ee4\u3002 - without-http_userid_module</p> <p>\u5141\u8bb8\u6784\u5efangx_http_userid_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u8bbe\u7f6e\u9002\u5408\u5ba2\u6237\u7aef\u8bc6\u522b\u7684cookie\u3002 - without-http_access_module</p> <p>\u7981\u7528\u6784\u5efangx_http_access_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u5141\u8bb8\u9650\u5236\u5bf9\u67d0\u4e9b\u5ba2\u6237\u7aef\u5730\u5740\u7684\u8bbf\u95ee\u3002 - without-http_auth_basic_module</p> <p>\u7981\u7528\u6784\u5efangx_http_auth_basic_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u5141\u8bb8\u901a\u8fc7\u4f7f\u7528HTTP\u57fa\u672c\u8eab\u4efd\u9a8c\u8bc1\u534f\u8bae\u9a8c\u8bc1\u7528\u6237\u540d\u5bc6\u7801\u6765\u9650\u5236\u5bf9\u8d44\u6e90\u7684\u8bbf\u95ee\u3002 - without-http_mirror_module</p> <p>\u7981\u7528\u6784\u5efangx_http_mirror_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u901a\u8fc7\u521b\u5efa\u540e\u53f0\u955c\u50cf\u5b50\u8bf7\u6c42\u6765\u5b9e\u73b0\u539f\u59cb\u8bf7\u6c42\u7684\u955c\u50cf\u3002 - without-http_autoindex_module</p> <p>\u7981\u7528\u6784\u5efangx_http_autoindex_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u5904\u7406\u4ee5\u659c\u6760('/')\u7ed3\u5c3e\u7684\u8bf7\u6c42\uff0c\u5e76\u5728ngx_http_index_module \u6a21\u5757\u627e\u4e0d\u5230\u7d22\u5f15\u6587\u4ef6\u7684\u60c5\u51b5\u4e0b\u751f\u6210\u76ee\u5f55\u5217\u8868\u3002 - without-http_geo_module</p> <p>\u7981\u7528\u6784\u5efangx_http_geo_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u4f7f\u7528\u53d6\u51b3\u4e8e\u5ba2\u6237\u7aefIP\u5730\u5740\u7684\u503c\u521b\u5efa\u53d8\u91cf\u3002 - without-http_map_module</p> <p>\u7981\u7528\u6784\u5efangx_http_map_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u4f7f\u7528\u53d6\u51b3\u4e8e\u5176\u4ed6\u53d8\u91cf\u7684\u503c\u521b\u5efa\u53d8\u91cf\u3002 - without-http_split_clients_module</p> <p>\u7981\u7528\u6784\u5efangx_http_split_clients_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u4e3a A/B \u6d4b\u8bd5\u521b\u5efa\u53d8\u91cf\u3002 - without-http_referer_module</p> <p>\u7981\u7528\u6784\u5efangx_http_referer_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u53ef\u4ee5\u963b\u6b62\u5bf9 \u201cReferer\u201d \u5934\u5b57\u6bb5\u4e2d\u5177\u6709\u65e0\u6548\u503c\u7684\u8bf7\u6c42\u8bbf\u95ee\u7ad9\u70b9\u3002 - without-http_proxy_module</p> <p>\u7981\u7528\u6784\u5efa\u5141\u8bb8HTTP\u670d\u52a1\u5668\u91cd\u5b9a\u5411\u7684\u8bf7\u6c42\u548c\u66f4\u6539\u8bf7\u6c42URI redirect requests and change URI of requests \u7684\u6a21\u5757\u3002 - without-http_proxy_module</p> <p>\u7981\u7528\u6784\u5efaproxying module HTTP\u670d\u52a1\u5668\u4ee3\u7406\u6a21\u5757\u3002  - without-http_fastcgi_module</p> <p>\u7981\u7528\u6784\u5efa\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9FastCGI\u670d\u52a1\u5668\u7684ngx_http_fastcgi_module\u6a21\u5757\u3002 - without-http_uwsgi_module</p> <p>\u7981\u7528\u6784\u5efa\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9uwsgi\u670d\u52a1\u5668\u7684ngx_http_uwsgi_module \u6a21\u5757\u3002 - without-http_scgi_module</p> <p>\u7981\u7528\u6784\u5efa\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9SCGI\u670d\u52a1\u5668\u7684ngx_http_scgi_module \u6a21\u5757\u3002 - without-http_grpc_module</p> <p>\u7981\u7528\u6784\u5efa\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e2aRPC\u670d\u52a1\u5668ngx_http_grpc_module \u6a21\u5757\u3002 - without-http_memcached_module</p> <p>\u7981\u7528\u6784\u5efangx_http_memcached_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u4ece memcached \u670d\u52a1\u5668\u83b7\u5f97\u54cd\u5e94\u3002 - without-http_limit_conn_module</p> <p>\u7981\u7528\u6784\u5efangx_http_limit_conn_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u9650\u5236\u6bcf\u4e2a\u5bc6\u94a5\u7684\u94fe\u63a5\u6570\uff0c\u4f8b\u5982\uff0c\u6765\u81ea\u5355\u4e2aIP\u5730\u5740\u7684\u94fe\u63a5\u6570\u3002 - without-http_limit_req_module</p> <p>\u7981\u7528\u6784\u5efa\u9650\u5236\u6bcf\u4e2a\u952e\u7684\u8bf7\u6c42\u5904\u7406\u901f\u7387ngx_http_limit_req_module \u6a21\u5757\u3002\u4f8b\u5982\uff0c\u6765\u81ea\u5355\u4e2aIP\u5730\u5740\u7684\u8bf7\u6c42\u7684\u5904\u7406\u901f\u7387\u3002 - without-http_empty_gif_module</p> <p>\u7981\u7528\u6784\u5efa\u53d1\u51fa\u5355\u50cf\u7d20\u900f\u660eGIFemits single-pixel transparent GIF \u6a21\u5757\u3002 - without-http_browser_module</p> <p>\u7981\u7528\u6784\u5efangx_http_browser_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u521b\u5efa\u7684\u503c\u7684\u53d8\u91cf\u53d6\u51b3\u4e8e \u201cUser-Agent\u201d \u8bf7\u6c42\u6807\u5934\u5b57\u6bb5\u7684\u503c\u3002 - without-http_upstream_hash_module</p> <p>\u7981\u7528\u6784\u5efa\u5b9e\u73b0\u6563\u5217\u8d1f\u8f7d\u5747\u8861\u7684\u65b9\u6cd5hash \u6a21\u5757\u3002 - without-http_upstream_ip_hash_module</p> <p>\u7981\u7528\u6784\u5efa\u5b9e\u73b0IP_Hash \u8d1f\u8f7d\u5747\u8861\u65b9\u6cd5\u7684\u6a21\u5757\u3002  - without-http_upstream_least_conn_module</p> <p>\u7981\u7528\u6784\u5efa\u5b9e\u73b0least_conn \u8d1f\u8f7d\u5747\u8861\u65b9\u6cd5\u7684\u6a21\u5757\u3002  - without-http_upstream_keepalive_module</p> <p>\u7981\u7528\u6784\u5efacaching of connections \u6a21\u5757\u3002\u8be5\u6a21\u5757\u63d0\u4f9b\u5230\u4e0a\u6e38\u670d\u52a1\u5668\u7684\u94fe\u63a5\u7f13\u5b58\u3002  - without-http_upstream_zone_module</p> <p>\u7981\u7528\u6784\u5efazone \u6a21\u5757\u3002\u8be5\u6a21\u5757\u53ef\u4ee5\u5c06\u4e0a\u6e38\u7ec4\u7684\u8fd0\u884c\u65f6\u72b6\u6001\u5b58\u50a8\u5728\u5171\u4eab\u5185\u5b58\u533a\u57df\u4e2d\u3002  - with-http_perl_module**\u548c**with-http_perl_module=dynamic</p> <p>\u6784\u5efa\u5d4c\u5165\u5f0fPerl \u6a21\u5757\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002  - --with-perl_modules_path=path</p> <p>\u5b9a\u4e49\u4e00\u4e2a\u4fdd\u7559Perl\u6a21\u5757\u7684\u8def\u5f84\u3002  - with-perl=path</p> <p>\u8bbe\u7f6ePerl\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u540d\u5b57\u3002  - http-client-body-temp-path</p> <p>\u5b9a\u4e49\u7528\u4e8e\u5b58\u50a8\u4fdd\u5b58\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u4e3b\u4f53\u7684\u4e34\u65f6\u6587\u4ef6\u7684\u76ee\u5f55\u3002\u5b89\u88c5\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528client_body_temp_path \u6307\u4ee4\u5728nginx.conf\u914d\u7f6e\u6587\u4ef6\u4e2d\u59cb\u7ec8\u66f4\u6539\u76ee\u5f55\u3002\u9ed8\u8ba4\u7684\u76ee\u5f55\u540d\u4e3a <code>prefix/client_body_temp</code>\u3002  - http-proxy-temp-path=path</p> <p>\u5b9a\u4e49\u4e00\u4e2a\u76ee\u5f55\uff0c\u7528\u4e8e\u5b58\u50a8\u4e34\u65f6\u6587\u4ef6\u548c\u4ece\u4ee3\u7406\u670d\u52a1\u5668\u63a5\u53d7\u7684\u6570\u636e\u3002\u5b89\u88c5\u540e\u53ef\u4ee5\u4f7f\u7528proxy_temp_path \u6307\u4ee4\u5728nginx.conf\u914d\u7f6e\u6587\u4ef6\u4e2d\u66f4\u6539\u3002\u9ed8\u8ba4\u7684\u76ee\u5f55\u540d\u4e3a <code>profix/proxy_temp</code> - http-fastcgi-temp-path=path</p> <p>\u5b9a\u4e49\u4e00\u4e2a\u76ee\u5f55\uff0c\u7528\u4e8e\u5b58\u50a8\u4e34\u65f6\u6587\u4ef6\u548c\u4ece FastCGI \u670d\u52a1\u5668\u63a5\u53d7\u7684\u6570\u636e\u3002\u5b89\u88c5\u540e\u53ef\u4ee5\u4f7f\u7528fastcgi_temp_path \u6307\u4ee4\u5728nginx.conf\u914d\u7f6e\u6587\u4ef6\u4e2d\u66f4\u6539\u3002 \u9ed8\u8ba4\u7684\u76ee\u5f55\u4e3a <code>prefix/fastcgi_temp</code> - http-uwsgi-temp-path=path</p> <p>\u5b9a\u4e49\u4e00\u4e2a\u76ee\u5f55\uff0c\u7528\u4e8e\u5b58\u50a8\u4e34\u65f6\u6587\u4ef6\u548c\u4ece uwsgi  \u670d\u52a1\u5668\u63a5\u53d7\u7684\u6570\u636e\u3002\u5b89\u88c5\u540e\u53ef\u4ee5\u4f7f\u7528uwsgi_temp_path \u6307\u4ee4\u5728nginx.conf\u914d\u7f6e\u6587\u4ef6\u4e2d\u66f4\u6539\u3002 \u9ed8\u8ba4\u7684\u76ee\u5f55\u4e3a <code>prefix/uwsgi_temp</code> - http-scgi-temp-path=path</p> <p>\u5b9a\u4e49\u4e00\u4e2a\u76ee\u5f55\uff0c\u7528\u4e8e\u5b58\u50a8\u4e34\u65f6\u6587\u4ef6\u548c\u4ece SCGI \u670d\u52a1\u5668\u63a5\u53d7\u7684\u6570\u636e\u3002\u5b89\u88c5\u540e\u53ef\u4ee5\u4f7f\u7528scgi_temp_path \u6307\u4ee4\u5728nginx.conf\u914d\u7f6e\u6587\u4ef6\u4e2d\u66f4\u6539\u3002 \u9ed8\u8ba4\u7684\u76ee\u5f55\u4e3a <code>prefix/scgi_temp</code> - without-http</p> <p>\u7981\u7528\u6784\u5efaHTTP \u6a21\u5757\u3002  - without-http-cache</p> <p>\u7981\u7528 HTTP \u7f13\u5b58\u3002                                                                                                          - with-mail**\u548c**with-mail=dynamic</p> <p>\u542f\u7528\u6784\u5efa POP3/IMAP4/SMTP mail proxy \u6a21\u5757\u3002 - with-mail_ssl_module</p> <p>\u542f\u7528\u6784\u5efaSSL/TLS protocol support \u6a21\u5757\uff0c\u5c06SSL/TLS\u534f\u8bae\u652f\u6301\u6dfb\u52a0\u5230\u90ae\u4ef6\u4ee3\u7406\u670d\u52a1\u5668\u3002\u9ed8\u8ba4\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\u3002\u9700\u8981OpenSSL\u5e93\u6765\u6784\u5efa\u548c\u8fd0\u884c\u6b64\u6a21\u5757\u3002 - without-mail_pop3_module</p> <p>\u7981\u7528\u90ae\u4ef6\u4ee3\u7406\u670d\u52a1\u5668\u4e2d\u7684POP3 \u534f\u8bae\u3002 - without-mail_imap_module</p> <p>\u7981\u7528\u90ae\u4ef6\u4ee3\u7406\u670d\u52a1\u5668\u4e2d\u7684IMAP \u534f\u8bae\u3002 - without-mail_smtp_module</p> <p>\u7981\u7528\u90ae\u4ef6\u4ee3\u7406\u670d\u52a1\u5668\u4e2d\u7684SMTP \u534f\u8bae\u3002 - with-stream**\u548c**with-stream=dynamic</p> <p>\u542f\u7528\u6784\u5efa\u6d41\u6a21\u5757 \u6a21\u5757\u4ee5\u8fdb\u884c\u901a\u7528\u7684 TCP/UDP \u4ee3\u7406\u548c\u8d1f\u8f7d\u5747\u8861\u3002\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - with-stream_ssl_module</p> <p>\u542f\u7528\u6784\u5efaSSL/TLS protocol support \u6a21\u5757\u3002\u4e3a\u6d41\u6a21\u5757\u6dfb\u52a0SSL/TLS\u534f\u8bae\u652f\u6301\u3002\u9ed8\u8ba4\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\u3002\u9700\u8981OpenSSL\u5e93\u6765\u6784\u5efa\u548c\u8fd0\u884c\u6b64\u6a21\u5757\u3002 - with-stream_realip_module</p> <p>\u542f\u7528\u6784\u5efangx_stream_realip_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u5c06\u5ba2\u6237\u7aef\u5730\u5740\u66f4\u6539\u4e3a PROXY \u534f\u8bae\u5934\u4e2d\u53d1\u9001\u7684\u5730\u5740\u3002\u9ed8\u8ba4\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\u3002 - with-stream_geoip_module**\u548c**with-stream_geoip_module=dynamic</p> <p>\u542f\u7528\u6784\u5efangx_stream_geoip_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u6839\u636e\u5ba2\u6237\u7aef\u5730\u5740\u548c\u9884\u7f16\u8bd1\u7684MaxMind \u6570\u636e\u5e93\u521b\u5efa\u53d8\u91cf\u3002\u9ed8\u8ba4\u4e0d\u6784\u5efa\u3002 - with-stream_ssl_preread_module</p> <p>\u7981\u7528\u6784\u5efawith-http_degradation_modulengx_stream_ssl_preread_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u5141\u8bb8\u4eceClientHello \u6d88\u606f\u4e2d\u63d0\u53d6\u6d88\u606f\u800c\u4e0d\u7ec8\u6b62SSL/TLS\u3002 - without-stream_limit_conn_module</p> <p>\u7981\u7528\u6784\u5efangx_stream_limit_conn_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u9650\u5236\u6bcf\u4e2a\u5bc6\u94a5\u7684\u8fde\u63a5\u6570\uff0c\u4f8b\u5982\uff0c\u6765\u81ea\u5355\u4e2aIP\u5730\u5740\u7684\u8fde\u63a5\u6570\u3002 - without-stream_geo_module</p> <p>\u7981\u7528\u6784\u5efangx_stream_geo_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u4f7f\u7528\u53d6\u51b3\u4e8e\u5ba2\u6237\u7aefIP\u5730\u5740\u7684\u503c\u521b\u5efa\u53d8\u91cf\u3002 - without-stream_map_module</p> <p>\u7981\u7528\u6784\u5efangx_stream_map_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u6839\u636e\u5176\u4ed6\u53d8\u91cf\u7684\u503c\u521b\u5efa\u503c\u3002 - without-stream_split_clients_module</p> <p>\u7981\u7528\u6784\u5efangx_stream_split_clients_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u4e3a A/B \u6d4b\u8bd5\u521b\u5efa\u53d8\u91cf - without-stream_return_module</p> <p>\u7981\u7528\u6784\u5efangx_stream_return_module \u6a21\u5757\u3002\u8be5\u6a21\u5757\u5c06\u4e00\u4e9b\u6307\u5b9a\u503c\u53d1\u9001\u5230\u5ba2\u6237\u7aef\uff0c\u7136\u540e\u5173\u95ed\u8fde\u63a5\u3002 - without-stream_upstream_hash_module</p> <p>\u7981\u7528\u6784\u5efahash \u5b9e\u73b0\u6563\u5217\u8d1f\u8f7d\u5e73\u8861\u65b9\u6cd5\u7684\u6a21\u5757\u3002 - without-stream_upstream_least_conn_module</p> <p>\u7981\u7528\u6784\u5efaleast_conn \u5b9e\u73b0\u6563\u5217\u8d1f\u8f7d\u5e73\u8861\u65b9\u6cd5\u7684\u6a21\u5757\u3002 - without-stream_upstream_zone_module</p> <p>\u7981\u7528\u6784\u5efazone \u7684\u6a21\u5757\u3002\u8be5\u6a21\u5757\u53ef\u4ee5\u5c06\u4e0a\u6e38\u7ec4\u7684\u8fd0\u884c\u65f6\u72b6\u6001\u5b58\u50a8\u5728\u5171\u4eab\u5185\u5b58\u533a\u57df\u4e2d - with-google_perftools_module</p> <p>\u7981\u7528\u6784\u5efangx_google_perftools_module  \u6a21\u5757\u3002\u8be5\u6a21\u5757\u53ef\u4ee5\u4f7f\u7528 Google Performance Tools \u5206\u6790nginx\u5de5\u4f5c\u8fdb\u7a0b\u3002\u8be5\u6a21\u5757\u9002\u7528\u4e8enginx\u5f00\u53d1\u4eba\u5458\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u6784\u5efa\u3002 - with-cpp_test_module</p> <p>\u542f\u7528\u6784\u5efangx_cpp_test_module\u6a21\u5757\u3002 - add-module=path</p> <p>\u542f\u7528\u5916\u90e8\u6a21\u5757\u3002 - add-dynamic-module=path</p> <p>\u542f\u7528\u52a8\u6001\u6a21\u5757\u3002 - with-compat</p> <p>\u5b9e\u73b0\u52a8\u6001\u517c\u5bb9\u6a21\u5757\u3002 - with-cc=path</p> <p>\u8bbe\u7f6eC\u7f16\u8bd1\u5668\u7684\u540d\u79f0\u3002 - with-cpp=path</p> <p>\u8bbe\u7f6eC++\u5904\u7406\u5668\u7684\u540d\u79f0\u3002 - with-cc-opt=parameters</p> <p>\u8bbe\u7f6e\u5c06\u6dfb\u52a0\u5230CFLAGS\u53d8\u91cf\u7684\u5176\u4ed6\u53c2\u6570\u3002\u5728FreeBSD\u4e0b\u4f7f\u7528\u7cfb\u7edfPCRE\u5e93\u65f6\uff0c\u5e94\u6307\u5b9a<code>--with-cc-opt =\" - I / usr / local / include\"</code>\u3002\u5982\u679c\u9700\u8981\u589e\u52a0 select() \u652f\u6301\u7684\u6587\u4ef6\u6570\uff0c\u4e5f\u53ef\u4ee5\u5728\u6b64\u5904\u6307\u5b9a\uff0c\u4f8b\u5982\uff1a <code>- with-cc-opt =\" - D FD_SETSIZE = 2048\"</code>\u3002 - with-ld-opt=parameters</p> <p>\u8bbe\u7f6e\u5c06\u5728\u94fe\u63a5\u671f\u95f4\u4f7f\u7528\u7684\u5176\u4ed6\u53c2\u6570\u3002\u5728FreeBSD\u4e0b\u4f7f\u7528\u7cfb\u7edfPCRE\u5e93\u65f6\uff0c\u5e94\u6307\u5b9a<code>--with-ld-opt =\" - L / usr / local / lib\"</code>\u3002 - with-cpu-opt=cpu</p> <p>\u6307\u5b9a\u7f16\u8bd1\u7684 CPU \uff0cpentium, pentiumpro, pentium3, pentium4, athlon, opteron, sparc32, sparc64, ppc64\u3002 - without-pcre</p> <p>\u7981\u7528 PCRE \u5e93\u7684\u4f7f\u7528\u3002 - with-pcre</p> <p>\u5f3a\u5236\u4f7f\u7528 PCRE \u5e93\u3002 - with-pcre=path</p> <p>\u8bbe\u7f6e PCRE \u5e93\u6e90\u7684\u8def\u5f84\u3002\u9700\u8981\u4ece PCRE \u7ad9\u70b9\u4e0b\u8f7d\u5206\u53d1\uff08\u7248\u672c4.4 - 8.42\uff09\u5e76\u5c06\u5176\u89e3\u538b\u7f29\u3002\u5269\u4e0b\u7684\u5de5\u4f5c\u7531nginx\u7684./configure\u548cmake\u5b8c\u6210\u3002\u8be5\u4f4d\u7f6e\u6307\u4ee4\u548c ngx_http_rewrite_module \u6a21\u5757\u4e2d\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u652f\u6301\u9700\u8981\u8be5\u5e93\u3002 - with-pcre-opt=parameters</p> <p>\u4e3aPCRE\u8bbe\u7f6e\u5176\u4ed6\u6784\u5efa\u9009\u9879\u3002 - with-zlib-opt=parameters</p> <p>\u4e3azlib\u8bbe\u7f6e\u5176\u4ed6\u6784\u5efa\u9009\u9879\u3002 - with-zlib-asm=cpu</p> <p>\u542f\u7528\u4f7f\u7528\u9488\u5bf9\u5176\u4e2d\u4e00\u4e2a\u6307\u5b9aCPU\u4f18\u5316\u7684zlib\u6c47\u7f16\u7a0b\u5e8f\u6e90\uff1apentium\uff0cpentiumpro\u3002 - with-libatomic</p> <p>\u5f3a\u5236libatomic_ops\u5e93\u4f7f\u7528\u3002 - with-libatomic=path</p> <p>\u8bbe\u7f6elibatomic_ops\u5e93\u6e90\u7684\u8def\u5f84\u3002 - with-openssl=path</p> <p>\u8bbe\u7f6eOpenSSL\u5e93\u6e90\u7684\u8def\u5f84\u3002 - with-openssl-opt=parameters</p> <p>\u4e3aOpenSSL\u8bbe\u7f6e\u5176\u4ed6\u6784\u5efa\u9009\u9879\u3002 - with-debug</p> <p>\u542f\u7528 \u8c03\u8bd5\u65e5\u5fd7 \u3002                                                                                                                                                            - --with-pcre=path</p> <p>\u8bbe\u7f6e PCRE \u5e93\u7684\u6e90\u8def\u5f84\u3002\u53d1\u884c\u7248\uff084.4 \u81f3 8.40 \u7248\u672c\uff09\u9700\u8981\u4ece PCRE \u7ad9\u70b9\u4e0b\u8f7d\u5e76\u63d0\u53d6\u3002\u5176\u4f59\u5de5\u4f5c\u7531 nginx \u7684 <code>./configure</code> \u548c <code>make</code> \u5b8c\u6210\u3002\u8be5\u5e93\u662f location \u6307\u4ee4\u548c ngx_http_rewrite_module \u6a21\u5757\u4e2d\u6b63\u5219\u8868\u8fbe\u5f0f\u652f\u6301\u6240\u5fc5\u9700\u7684\u3002 - --with-pcre-jit</p> <p>\u4f7f\u7528\u201c\u5373\u65f6\u7f16\u8bd1\uff08just-in-time compilation\uff09\u201d\u652f\u6301\uff081.1.12\u7248\u672c\u7684 pcre_jit \u6307\u4ee4\uff09\u6784\u5efa PCRE \u5e93\u3002 - --with-zlib=path</p> <p>\u8bbe\u7f6e zlib \u5e93\u7684\u6e90\u8def\u5f84\u3002\u53d1\u884c\u7248\uff081.1.3 \u81f3 1.2.11 \u7248\u672c\uff09\u9700\u8981\u4ece zlib \u7ad9\u70b9\u4e0b\u8f7d\u5e76\u63d0\u53d6\u3002\u5176\u4f59\u5de5\u4f5c\u7531 nginx \u7684 <code>./configure</code> \u548c <code>make</code> \u5b8c\u6210\u3002\u8be5\u5e93\u662f ngx_http_gzip_module \u6a21\u5757\u6240\u5fc5\u9700\u7684\u3002 - --with-cc-opt=parameters</p> <p>\u8bbe\u7f6e\u6dfb\u52a0\u5230 CFLAGS \u53d8\u91cf\u7684\u989d\u5916\u53c2\u6570\u3002\u5f53\u5728 FreeBSD \u4e0b\u4f7f\u7528\u7cfb\u7edf\u7684 PCRE \u5e93\u65f6\uff0c\u5e94\u6307\u5b9a <code>--with-cc-opt=\"-I /usr/local/include\"</code>\u3002\u5982\u679c\u9700\u8981\u589e\u52a0 <code>select()</code> \u6240\u652f\u6301\u7684\u6587\u4ef6\u6570\u91cf\uff0c\u4e5f\u53ef\u4ee5\u5728\u8fd9\u91cc\u6307\u5b9a\uff0c\u5982\uff1a<code>--with-cc-opt=\"-D FD_SETSIZE=2048\"</code>\u3002 - --with-ld-opt=parameters</p> <p>\u8bbe\u7f6e\u94fe\u63a5\u671f\u95f4\u4f7f\u7528\u7684\u5176\u4ed6\u53c2\u6570\u3002\u5728 FreeBSD \u4e0b\u4f7f\u7528\u7cfb\u7edf PCRE \u5e93\u65f6\uff0c\u5e94\u6307\u5b9a--with-ld-opt=\"-L /usr/local/lib\"`\u3002</p> </li> </ul> <p>\u53c2\u6570\u4f7f\u7528\u793a\u4f8b\uff1a</p> <pre><code>./configure \\\n--sbin-path=/usr/local/nginx/nginx \\\n--conf-path=/usr/local/nginx/nginx.conf \\\n--pid-path=/usr/local/nginx/nginx.pid \\\n--with-http_ssl_module \\\n--with-pcre=../pcre-8.40 \\\n--with-zlib=../zlib-1.2.11\n</code></pre> <p>\u914d\u7f6e\u5b8c\u6210\u4e4b\u540e\uff0c\u4f7f\u7528 <code>make</code> \u548c <code>make install</code> \u7f16\u8bd1\u548c\u5b89\u88c5 nginx\u3002</p>"},{"location":"How-To/%E4%BB%8E%E6%BA%90%E7%A0%81%E6%9E%84%E5%BB%BAnginx/#_1","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/configure.html</p>"},{"location":"How-To/%E4%BD%BF%E7%94%A8DTrace_pid%E6%8F%90%E4%BE%9B%E7%A8%8B%E5%BA%8F%E8%B0%83%E8%AF%95nginx/","title":"\u4f7f\u7528 DTrace pid \u63d0\u4f9b\u7a0b\u5e8f\u8c03\u8bd5 nginx","text":"<p>\u672c\u6587\u5047\u8bbe\u8bfb\u8005\u5bf9 nginx \u5185\u90e8\u539f\u7406\u548c DTrace \u6709\u4e86\u4e00\u5b9a\u7684\u4e86\u89e3\u3002</p> <p>\u867d\u7136\u4f7f\u7528\u4e86 --with-debug \u9009\u9879\u6784\u5efa\u7684 nginx \u5df2\u7ecf\u63d0\u4f9b\u4e86\u5927\u91cf\u5173\u4e8e\u8bf7\u6c42\u5904\u7406\u7684\u4fe1\u606f\uff0c\u4f46\u6709\u65f6\u5019\u66f4\u6709\u5fc5\u8981\u8be6\u7ec6\u5730\u8ddf\u8e2a\u4ee3\u7801\u8def\u5f84\u7684\u7279\u5b9a\u90e8\u5206\uff0c\u540c\u65f6\u7701\u7565\u5176\u4f59\u4e0d\u5fc5\u8981\u7684\u8c03\u8bd5\u8f93\u51fa\u3002DTrace pid \u63d0\u4f9b\u7a0b\u5e8f\uff08\u5728 Solaris\uff0cMacOS \u4e0a\u53ef\u7528\uff09\u662f\u4e00\u4e2a\u7528\u4e8e\u6d4f\u89c8\u7528\u6237\u7a0b\u5e8f\u5185\u90e8\u7684\u6709\u7528\u5de5\u5177\uff0c\u56e0\u4e3a\u5b83\u4e0d\u9700\u8981\u66f4\u6539\u4efb\u4f55\u4ee3\u7801\uff0c\u5c31\u53ef\u4ee5\u5e2e\u52a9\u60a8\u5b8c\u6210\u4efb\u52a1\u3002\u8ddf\u8e2a\u548c\u6253\u5370 nginx \u51fd\u6570\u8c03\u7528\u7684\u7b80\u5355 DTrace \u811a\u672c\u793a\u4f8b\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>#pragma D option flowindent\n\npid$target:nginx::entry {\n}\n\npid$target:nginx::return {\n}\n</code></pre> <p>\u5c3d\u7ba1\u5982\u6b64\uff0cDTrace \u7684\u51fd\u6570\u8c03\u7528\u8ddf\u8e2a\u529f\u80fd\u4ec5\u63d0\u4f9b\u6709\u9650\u7684\u6709\u7528\u4fe1\u606f\u3002\u5b9e\u65f6\u68c0\u67e5\u7684\u529f\u80fd\u53c2\u6570\u901a\u5e38\u66f4\u52a0\u6709\u8da3\uff0c\u4f46\u4e5f\u66f4\u590d\u6742\u4e00\u4e9b\u3002\u4ee5\u4e0b\u793a\u4f8b\u65e8\u5728\u5e2e\u52a9\u8bfb\u8005\u719f\u6089 DTrace \u4ee5\u53ca\u4f7f\u7528 DTrace \u5206\u6790 nginx \u884c\u4e3a\u7684\u8fc7\u7a0b\u3002</p> <p>\u4f7f\u7528 DTrace \u4e0e nginx \u7684\u5e38\u89c1\u65b9\u6848\u4e4b\u4e00\u662f\uff1a\u9644\u52a0\u5230 nginx \u7684\u5de5\u4f5c\u8fdb\u7a0b\u6765\u8bb0\u5f55\u8bf7\u6c42\u884c\u548c\u8bf7\u6c42\u5f00\u59cb\u65f6\u95f4\u3002\u9644\u52a0\u7684\u76f8\u5e94\u51fd\u6570\u662f <code>ngx_http_process_request()</code>\uff0c\u53c2\u6570\u6307\u5411\u7684\u662f\u4e00\u4e2a <code>ngx_http_request_t</code> \u7ed3\u6784\u7684\u6307\u9488\u3002\u4f7f\u7528 DTrace \u811a\u672c\u5b9e\u73b0\u8fd9\u79cd\u8bf7\u6c42\u65e5\u5fd7\u8bb0\u5f55\u53ef\u4ee5\u7b80\u5355\u5230\uff1a</p> <pre><code>pid$target::*ngx_http_process_request:entry\n{\nthis-&gt;request = (ngx_http_request_t *)copyin(arg0, sizeof(ngx_http_request_t));\nthis-&gt;request_line = stringof(copyin((uintptr_t)this-&gt;request-&gt;request_line.data,\nthis-&gt;request-&gt;request_line.len));\nprintf(\"request line = %s\\n\", this-&gt;request_line);\nprintf(\"request start sec = %d\\n\", this-&gt;request-&gt;start_sec);\n}\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0cDTrace \u9700\u8981\u5f15\u7528 <code>ngx_http_process_request</code> \u7ed3\u6784\u7684\u4e00\u4e9b\u76f8\u5173\u4fe1\u606f\u3002\u4e0d\u5e78\u7684\u662f\uff0c\u867d\u7136\u53ef\u4ee5\u5728 DTrace \u811a\u672c\u4e2d\u4f7f\u7528\u7279\u5b9a\u7684 <code>#include</code> \u6307\u4ee4\uff0c\u7136\u540e\u5c06\u5176\u4f20\u9012\u7ed9 C \u9884\u5904\u7406\u5668\uff08\u4f7f\u7528 <code>-C</code> \u6807\u5fd7\uff09\uff0c\u4f46\u8fd9\u5e76\u4e0d\u80fd\u771f\u6b63\u8d77\u6548\u3002\u7531\u4e8e\u5927\u91cf\u7684\u4ea4\u53c9\u4f9d\u8d56\uff0c\u51e0\u4e4e\u6240\u6709\u7684 nginx \u5934\u6587\u4ef6\u90fd\u5fc5\u987b\u5305\u542b\u5728\u5185\u3002\u53cd\u8fc7\u6765\uff0c\u57fa\u4e8e <code>configure</code> \u811a\u672c\u8bbe\u7f6e\uff0cnginx \u5934\u5c06\u5305\u62ec PCRE\u3001OpenSSL \u548c\u5404\u79cd\u7cfb\u7edf\u5934\u6587\u4ef6\u3002\u7406\u8bba\u4e0a\uff0c\u5728 DTrace \u811a\u672c\u9884\u5904\u7406\u548c\u7f16\u8bd1\u65f6\uff0c\u4e0e\u7279\u5b9a\u7684 nginx \u6784\u5efa\u76f8\u5173\u7684\u6240\u6709\u5934\u6587\u4ef6\u90fd\u6709\u53ef\u80fd\u88ab\u5305\u542b\u8fdb\u6765\uff0c\u5b9e\u9645\u4e0a DTrace \u811a\u672c\u5f88\u6709\u53ef\u80fd\u7531\u4e8e\u67d0\u4e9b\u5934\u6587\u4ef6\u4e2d\u7684\u672a\u77e5\u8bed\u6cd5\u800c\u9020\u6210\u65e0\u6cd5\u7f16\u8bd1\u3002</p> <p>\u4e0a\u8ff0\u95ee\u9898\u53ef\u4ee5\u901a\u8fc7\u5728 DTrace \u811a\u672c\u4e2d\u4ec5\u5305\u542b\u76f8\u5173\u4e14\u5fc5\u8981\u7684\u7ed3\u6784\u548c\u7c7b\u578b\u5b9a\u4e49\u6765\u89e3\u51b3\u3002DTrace \u5fc5\u987b\u77e5\u9053\u7ed3\u6784\u3001\u7c7b\u578b\u548c\u5b57\u6bb5\u504f\u79fb\u7684\u5927\u5c0f\u3002\u56e0\u6b64\uff0c\u901a\u8fc7\u624b\u52a8\u4f18\u5316\u7528\u4e8e DTrace \u7684\u7ed3\u6784\u5b9a\u4e49\uff0c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u964d\u4f4e\u4f9d\u8d56\u3002</p> <p>\u8ba9\u6211\u4eec\u4f7f\u7528\u4e0a\u9762\u7684 DTrace \u811a\u672c\u793a\u4f8b\uff0c\u770b\u770b\u5b83\u9700\u8981\u54ea\u4e9b\u7ed3\u6784\u5b9a\u4e49\u624d\u80fd\u6b63\u5e38\u5730\u5de5\u4f5c\u3002</p> <p>\u9996\u5148\u5e94\u8be5\u5305\u542b\u7531 configure \u751f\u6210\u7684 <code>objs/ngx_auto_config.h</code> \u6587\u4ef6\uff0c\u56e0\u4e3a\u5b83\u5b9a\u4e49\u4e86\u4e00\u4e9b\u5f71\u54cd\u5404\u4e2a\u65b9\u9762\u7684 <code>\uff03ifdef</code> \u5e38\u91cf\u3002\u4e4b\u540e\uff0c\u4e00\u4e9b\u57fa\u672c\u7c7b\u578b\u548c\u5b9a\u4e49\uff08\u5982 <code>ngx_str_t</code>\uff0c<code>ngx_table_elt_t</code>\uff0c<code>ngx_uint_t</code> \u7b49\uff09\u5e94\u653e\u5728 DTrace \u811a\u672c\u7684\u5f00\u5934\u3002\u8fd9\u4e9b\u5b9a\u4e49\u7ecf\u5e38\u88ab\u4f7f\u7528\u4f46\u4e0d\u592a\u53ef\u80fd\u7ecf\u5e38\u6539\u53d8\u7684\u3002</p> <p>\u90a3\u91cc\u6709\u4e00\u4e2a\u5305\u542b\u8bb8\u591a\u6307\u5411\u5176\u4ed6\u7ed3\u6784\u7684\u6307\u9488\u7684 ngx_http_process_request_t \u7ed3\u6784\u3002\u56e0\u4e3a\u8fd9\u4e9b\u6307\u9488\u4e0e\u8fd9\u4e2a\u811a\u672c\u65e0\u5173\uff0c\u800c\u4e14\u56e0\u4e3a\u5b83\u4eec\u5177\u6709\u76f8\u540c\u7684\u5927\u5c0f\uff0c\u6240\u4ee5\u53ef\u4ee5\u7528 void \u6307\u9488\u6765\u66ff\u6362\u5b83\u4eec\u3002\u4f46\u6700\u597d\u6dfb\u52a0\u5408\u9002\u7684 typedef\uff0c\u800c\u4e0d\u662f\u66f4\u6539\u5b9a\u4e49\uff1a</p> <pre><code>typedef ngx_http_upstream_t     void;\ntypedef ngx_http_request_body_t void;\n</code></pre> <p>\u6700\u540e\u4f46\u540c\u6837\u91cd\u8981\u7684\u662f\uff0c\u9700\u8981\u6dfb\u52a0\u4e24\u4e2a\u6210\u5458\u7ed3\u6784\u7684\u5b9a\u4e49\uff08<code>ngx_http_headers_in_t</code>\uff0c<code>ngx_http_headers_out_t</code>\uff09\u3001\u56de\u8c03\u51fd\u6570\u58f0\u660e\u548c\u5e38\u91cf\u5b9a\u4e49\u3002</p> <p>\u6700\u540e\uff0cDTrace \u811a\u672c\u53ef\u4ee5\u4ece \u8fd9\u91cc \u4e0b\u8f7d\u3002</p> <p>\u4ee5\u4e0b\u793a\u4f8b\u662f\u8fd0\u884c\u6b64\u811a\u672c\u7684\u8f93\u51fa\uff1a</p> <pre><code># dtrace -C -I ./objs -s trace_process_request.d -p 4848\ndtrace: script 'trace_process_request.d' matched 1 probe\nCPU     ID                    FUNCTION:NAME\n  1      4 .XAbmO.ngx_http_process_request:entry request line = GET / HTTP/1.1\nrequest start sec = 1349162898\n\n  0      4 .XAbmO.ngx_http_process_request:entry request line = GET /en/docs/nginx_dtrace_pid_provider.html HTTP/1.1\nrequest start sec = 1349162899\n</code></pre> <p>\u4f7f\u7528\u7c7b\u4f3c\u7684\u6280\u672f\uff0c\u8bfb\u8005\u5e94\u8be5\u80fd\u591f\u8ddf\u8e2a\u5176\u4ed6 nginx \u51fd\u6570\u8c03\u7528\u3002</p>"},{"location":"How-To/%E4%BD%BF%E7%94%A8DTrace_pid%E6%8F%90%E4%BE%9B%E7%A8%8B%E5%BA%8F%E8%B0%83%E8%AF%95nginx/#_1","title":"\u76f8\u5173\u9605\u8bfb","text":"<ul> <li>Solaris \u52a8\u6001\u8ddf\u8e2a\u6307\u5357</li> <li>DTrace pid \u63d0\u4f9b\u7a0b\u5e8f\u4ecb\u7ecd</li> </ul>"},{"location":"How-To/%E4%BD%BF%E7%94%A8DTrace_pid%E6%8F%90%E4%BE%9B%E7%A8%8B%E5%BA%8F%E8%B0%83%E8%AF%95nginx/#_2","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/nginx_dtrace_pid_provider.html</p>"},{"location":"How-To/%E5%9C%A8Win32%E5%B9%B3%E5%8F%B0%E4%B8%8A%E4%BD%BF%E7%94%A8VisualC%E6%9E%84%E5%BB%BAnginx/","title":"\u5728 Win32 \u5e73\u53f0\u4e0a\u4f7f\u7528 Visual C \u6784\u5efa nginx","text":""},{"location":"How-To/%E5%9C%A8Win32%E5%B9%B3%E5%8F%B0%E4%B8%8A%E4%BD%BF%E7%94%A8VisualC%E6%9E%84%E5%BB%BAnginx/#_1","title":"\u5148\u51b3\u6761\u4ef6","text":"<p>\u8981\u5728 Microsoft Win32\u00ae \u5e73\u53f0\u4e0a\u6784\u5efa nginx\uff0c\u60a8\u9700\u8981\uff1a</p> <ul> <li>Microsoft Visual C\u7f16\u8bd1\u5668\u3002\u5df2\u77e5 Microsoft Visual Studio\u00ae 8 \u548c 10 \u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u3002</li> <li>MSYS\u3002</li> <li>\u5982\u679c\u60a8\u8981\u6784\u5efa OpenSSL\u00ae \u548c\u6709 SSL \u652f\u6301\u7684 nginx\uff0c\u5219\u9700\u8981 Perl\u3002\u4f8b\u5982 ActivePerl \u6216 Strawberry Perl\u3002</li> <li>Mercurial \u5ba2\u6237\u7aef</li> <li>PCRE\u3001zlib \u548c OpenSSL \u5e93\u6e90\u4ee3\u7801\u3002</li> </ul>"},{"location":"How-To/%E5%9C%A8Win32%E5%B9%B3%E5%8F%B0%E4%B8%8A%E4%BD%BF%E7%94%A8VisualC%E6%9E%84%E5%BB%BAnginx/#_2","title":"\u6784\u5efa\u6b65\u9aa4","text":"<p>\u5728\u5f00\u59cb\u6784\u5efa\u4e4b\u524d\uff0c\u786e\u4fdd\u5c06 Perl\u3001Mercurial \u548c MSYS \u7684 bin \u76ee\u5f55\u8def\u5f84\u6dfb\u52a0\u5230 PATH \u73af\u5883\u53d8\u91cf\u4e2d\u3002\u4ece Visual C \u76ee\u5f55\u8fd0\u884c vcvarsall.bat \u811a\u672c\u8bbe\u7f6e Visual C \u73af\u5883\u3002</p> <p>\u6784\u5efa nginx\uff1a</p> <ul> <li>\u542f\u52a8 MSYS bash\u3002</li> <li>\u68c0\u51fa hg.nginx.org \u4ed3\u5e93\u4e2d\u7684 nginx \u6e90\u4ee3\u7801\u3002\u4f8b\u5982\uff1a</li> </ul> <pre><code>hg clone http://hg.nginx.org/nginx\n</code></pre> <ul> <li>\u521b\u5efa\u4e00\u4e2a build \u548c lib \u76ee\u5f55\uff0c\u5e76\u5c06 zlib\u3001PCRE \u548c OpenSSL \u5e93\u6e90\u7801\u89e3\u538b\u5230 lib \u76ee\u5f55\u4e2d\uff1a</li> </ul> <pre><code>mkdir objs\nmkdir objs/lib\ncd objs/lib\ntar -xzf ../../pcre-8.41.tar.gz\ntar -xzf ../../zlib-1.2.11.tar.gz\ntar -xzf ../../openssl-1.0.2k.tar.gz\n</code></pre> <ul> <li>\u8fd0\u884c configure \u811a\u672c\uff1a</li> </ul> <pre><code>auto/configure --with-cc=cl --builddir=objs --prefix= \\\n--conf-path=conf/nginx.conf --pid-path=logs/nginx.pid \\\n--http-log-path=logs/access.log --error-log-path=logs/error.log \\\n--sbin-path=nginx.exe --http-client-body-temp-path=temp/client_body_temp \\\n--http-proxy-temp-path=temp/proxy_temp \\\n--http-fastcgi-temp-path=temp/fastcgi_temp \\\n--with-cc-opt=-DFD_SETSIZE=1024 --with-pcre=objs/lib/pcre-8.41 \\\n--with-zlib=objs/lib/zlib-1.2.11 --with-openssl=objs/lib/openssl-1.0.2k \\\n--with-select_module --with-http_ssl_module\n</code></pre> <ul> <li>\u8fd0\u884c make\uff1a</li> </ul> <pre><code>nmake -f objs/Makefile\n</code></pre>"},{"location":"How-To/%E5%9C%A8Win32%E5%B9%B3%E5%8F%B0%E4%B8%8A%E4%BD%BF%E7%94%A8VisualC%E6%9E%84%E5%BB%BAnginx/#_3","title":"\u76f8\u5173\u5185\u5bb9","text":"<p>Windows \u4e0b\u7684 nginx</p>"},{"location":"How-To/%E5%9C%A8Win32%E5%B9%B3%E5%8F%B0%E4%B8%8A%E4%BD%BF%E7%94%A8VisualC%E6%9E%84%E5%BB%BAnginx/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/howto_build_on_win32.html</p>"},{"location":"How-To/%E8%BD%AC%E6%8D%A2%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99/","title":"\u8f6c\u6362\u91cd\u5199\u89c4\u5219","text":""},{"location":"How-To/%E8%BD%AC%E6%8D%A2%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99/#_2","title":"\u91cd\u5b9a\u5411\u5230\u4e3b\u7ad9\u70b9","text":"<p>\u4f7f\u7528\u5171\u4eab\u4e3b\u673a\u7684\u7528\u6237\u4ee5\u524d\u4ec5\u4f7f\u7528 Apache \u7684 <code>.htaccess</code> \u6587\u4ef6\u6765\u914d\u7f6e\u4e00\u5207\uff0c\u901a\u5e38\u7ffb\u8bd1\u4e0b\u5217\u89c4\u5219\uff1a</p> <pre><code>RewriteCond  %{HTTP_HOST}  example.org\nRewriteRule  (.*)          http://www.example.org$1\n</code></pre> <p>\u50cf\u8fd9\u6837\uff1a</p> <pre><code>server {\nlisten       80;\nserver_name  www.example.org  example.org;\nif ($http_host = example.org) {\nrewrite  (.*)  http://www.example.org$1;\n}\n...\n}\n</code></pre> <p>\u8fd9\u662f\u4e00\u4e2a\u9519\u8bef\u3001\u9ebb\u70e6\u800c\u65e0\u6548\u7684\u505a\u6cd5\u3002\u6b63\u786e\u7684\u65b9\u5f0f\u662f\u4e3a <code>example.org</code> \u5b9a\u4e49\u4e00\u4e2a\u5355\u72ec\u7684\u670d\u52a1\u5668\uff1a</p> <pre><code>server {\nlisten       80;\nserver_name  example.org;\nreturn       301 http://www.example.org$request_uri;\n}\n\nserver {\nlisten       80;\nserver_name  www.example.org;\n...\n}\n</code></pre> <p>\u5728 0.9.1 \u4e4b\u524d\u7684\u7248\u672c\uff0c\u91cd\u5b9a\u5411\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5b9e\u73b0\uff1a</p> <pre><code>rewrite ^ http://www.example.org$request_uri?;\n</code></pre> <p>\u53e6\u4e00\u4e2a\u4f8b\u5b50\u662f\u4f7f\u7528\u4e86\u98a0\u5012\u903b\u8f91\uff0c\u5373 \u6240\u6709\u4e0d\u662f <code>example.com</code> \u548c <code>www.example.com</code> \u7684\uff1a</p> <pre><code>RewriteCond  %{HTTP_HOST}  !example.com\nRewriteCond  %{HTTP_HOST}  !www.example.com\nRewriteRule  (.*)          http://www.example.com$1\n</code></pre> <p>\u5e94\u8be5\u7b80\u5355\u5730\u5b9a\u4e49 <code>example.com</code>\u3001<code>www.example.com</code> \u548c \u5176\u4ed6\u4e00\u5207\uff1a</p> <pre><code>server {\nlisten       80;\nserver_name  example.com www.example.com;\n...\n}\n\nserver {\nlisten       80 default_server;\nserver_name  _;\nreturn       301 http://example.com$request_uri;\n}\n</code></pre> <p>\u5728 0.9.1 \u4e4b\u524d\u7684\u7248\u672c\uff0c\u91cd\u5b9a\u5411\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5b9e\u73b0\uff1a</p> <pre><code>rewrite ^ http://example.com$request_uri?;\n</code></pre>"},{"location":"How-To/%E8%BD%AC%E6%8D%A2%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99/#mongrel","title":"\u8f6c\u6362 Mongrel \u89c4\u5219","text":"<p>\u5178\u578b\u7684 Mongrel \u89c4\u5219\uff1a</p> <pre><code>DocumentRoot /var/www/myapp.com/current/public\n\nRewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f\nRewriteCond %{SCRIPT_FILENAME} !maintenance.html\nRewriteRule ^.*$ %{DOCUMENT_ROOT}/system/maintenance.html [L]\n\nRewriteCond %{REQUEST_FILENAME} -f\nRewriteRule ^(.*)$ $1 [QSA,L]\n\nRewriteCond %{REQUEST_FILENAME}/index.html -f\nRewriteRule ^(.*)$ $1/index.html [QSA,L]\n\nRewriteCond %{REQUEST_FILENAME}.html -f\nRewriteRule ^(.*)$ $1.html [QSA,L]\n\nRewriteRule ^/(.*)$ balancer://mongrel_cluster%{REQUEST_URI} [P,QSA,L]\n</code></pre> <p>\u5e94\u8be5\u8f6c\u6362\u4e3a\uff1a</p> <pre><code>location / {\nroot       /var/www/myapp.com/current/public;\n\ntry_files  /system/maintenance.html\n$uri  $uri/index.html $uri.html\n@mongrel;\n}\n\nlocation @mongrel {\nproxy_pass  http://mongrel;\n}\n</code></pre>"},{"location":"How-To/%E8%BD%AC%E6%8D%A2%E9%87%8D%E5%86%99%E8%A7%84%E5%88%99/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/converting_rewrite_rules.html</p>"},{"location":"Introduction/Nginx%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86TCP_UDP%E4%BC%9A%E8%AF%9D/","title":"nginx \u5982\u4f55\u5904\u7406 TCP/UDP \u4f1a\u8bdd","text":"<p>\u6765\u81ea\u5ba2\u6237\u7aef\u7684 TCP/UDP \u4f1a\u8bdd\u4ee5\u9636\u6bb5\u7684\u5f62\u5f0f\u88ab\u9010\u6b65\u5904\u7406\uff1a</p> \u9636 \u6bb5\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u63cf \u8ff0 Post-accept \u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42\u540e\u7684\u7b2c\u4e00\u4e2a\u9636\u6bb5\u3002ngx_stream_realip_module \u6a21\u5757\u5728\u6b64\u9636\u6bb5\u88ab\u8c03\u7528\u3002 Pre-access \u521d\u6b65\u68c0\u67e5\u8bbf\u95ee\uff0cngx_stream_limit_conn_module \u6a21\u5757\u5728\u6b64\u9636\u6bb5\u88ab\u8c03\u7528\u3002 Access \u5b9e\u9645\u5904\u7406\u4e4b\u524d\u7684\u5ba2\u6237\u7aef\u8bbf\u95ee\u9650\u5236\uff0cngx_stream_access_module \u6a21\u5757\u5728\u6b64\u9636\u6bb5\u88ab\u8c03\u7528\u3002 SSL TLS/SSL \u7ec8\u6b62\uff0cngx_stream_ssl_module \u6a21\u5757\u5728\u6b64\u9636\u6bb5\u88ab\u8c03\u7528\u3002 Preread \u5c06\u6570\u636e\u7684\u521d\u59cb\u5b57\u8282\u8bfb\u5165 \u9884\u8bfb\u7f13\u51b2\u533a \u4e2d\uff0c\u4ee5\u5141\u8bb8\u5982 ngx_stream_ssl_preread_module \u4e4b\u7c7b\u7684\u6a21\u5757\u5728\u5904\u7406\u524d\u5206\u6790\u6570\u636e\u3002 Content \u5b9e\u9645\u5904\u7406\u6570\u636e\u7684\u5f3a\u5236\u9636\u6bb5\uff0c\u901a\u5e38 \u4ee3\u7406 \u5230 upstream \u670d\u52a1\u5668\uff0c\u6216\u8005\u8fd4\u56de\u4e00\u4e2a\u7279\u5b9a\u7684\u503c\u7ed9\u5ba2\u6237\u7aef Log \u6b64\u4e3a\u6700\u540e\u9636\u6bb5\uff0c\u5ba2\u6237\u7aef\u4f1a\u8bdd\u5904\u7406\u7ed3\u679c\u5c06\u88ab\u8bb0\u5f55\uff0c ngx_stream_log_module module \u6a21\u5757\u5728\u6b64\u9636\u6bb5\u88ab\u8c03\u7528\u3002"},{"location":"Introduction/Nginx%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86TCP_UDP%E4%BC%9A%E8%AF%9D/#_1","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/stream/stream_processing.html</p>"},{"location":"Introduction/Nginx%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/","title":"nginx \u5982\u4f55\u5904\u7406\u8bf7\u6c42","text":"<ul> <li>\u57fa\u4e8e\u540d\u79f0\u7684\u865a\u62df\u670d\u52a1\u5668</li> <li>\u5982\u4f55\u4f7f\u7528\u672a\u5b9a\u4e49\u7684 server \u540d\u79f0\u6765\u963b\u6b62\u5904\u7406\u8bf7\u6c42</li> <li>\u57fa\u4e8e\u540d\u79f0\u548c IP \u6df7\u5408\u7684\u865a\u62df\u670d\u52a1\u5668</li> <li>\u4e00\u4e2a\u7b80\u5355\u7684 PHP \u7ad9\u70b9\u914d\u7f6e</li> </ul>"},{"location":"Introduction/Nginx%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#_1","title":"\u57fa\u4e8e\u540d\u79f0\u7684\u865a\u62df\u670d\u52a1\u5668","text":"<p>nginx \u9996\u5148\u51b3\u5b9a\u54ea\u4e2a <code>server</code> \u5e94\u8be5\u5904\u7406\u8bf7\u6c42\uff0c\u8ba9\u6211\u4eec\u4ece\u4e00\u4e2a\u7b80\u5355\u7684\u914d\u7f6e\u5f00\u59cb\uff0c\u4e09\u4e2a\u865a\u62df\u670d\u52a1\u5668\u90fd\u76d1\u542c\u4e86 <code>*:80</code> \u7aef\u53e3\uff1a</p> <pre><code>server {\nlisten      80;\nserver_name example.org www.example.org;\n...\n}\n\nserver {\nlisten      80;\nserver_name example.net www.example.net;\n...\n}\n\nserver {\nlisten      80;\nserver_name example.com www.example.com;\n...\n}\n</code></pre> <p>\u5728\u6b64\u914d\u7f6e\u4e2d\uff0cnginx \u4ec5\u68c0\u9a8c\u8bf7\u6c42\u7684 header \u57df\u4e2d\u7684 <code>Host</code>\uff0c\u4ee5\u786e\u5b9a\u8bf7\u6c42\u5e94\u8be5\u88ab\u8def\u7531\u5230\u54ea\u4e00\u4e2a <code>server</code>\u3002\u5982\u679c\u5176\u503c\u4e0e\u4efb\u4f55\u7684 <code>server</code> \u540d\u79f0\u4e0d\u5339\u914d\uff0c\u6216\u8005\u8be5\u8bf7\u6c42\u6839\u672c\u4e0d\u5305\u542b\u6b64 header \u57df\uff0cnginx \u4f1a\u5c06\u8bf7\u6c42\u8def\u7531\u5230\u8be5\u7aef\u53e3\u7684\u9ed8\u8ba4 <code>server</code> \u4e2d\u3002\u5728\u4e0a\u9762\u7684\u914d\u7f6e\u4e2d\uff0c\u9ed8\u8ba4 <code>server</code> \u662f\u7b2c\u4e00\u4e2a\uff08\u8fd9\u662f nginx \u7684\u6807\u51c6\u9ed8\u8ba4\u884c\u4e3a\uff09\u3002\u4f60\u4e5f\u53ef\u4ee5\u5728 listen \u6307\u4ee4\u4e2d\u4f7f\u7528 <code>default_server</code> \u53c2\u6570\uff0c\u660e\u786e\u5730\u8bbe\u7f6e\u9ed8\u8ba4\u7684 <code>server</code>\u3002</p> <pre><code>server {\nlisten      80 default_server;\nserver_name example.net www.example.net;\n...\n}\n</code></pre> <p><code>default_server</code> \u53c2\u6570\u81ea 0.8.21 \u7248\u672c\u8d77\u53ef\u7528\u3002\u5728\u65e9\u671f\u7248\u672c\u4e2d\uff0c\u5e94\u8be5\u4f7f\u7528 <code>default</code> \u53c2\u6570\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c<code>default_server</code> \u662f <code>listen port</code> \u7684\u5c5e\u6027\uff0c\u800c\u4e0d\u662f <code>server_name</code> \u7684\u3002\u4e4b\u540e\u4f1a\u6709\u66f4\u591a\u5173\u4e8e\u8fd9\u65b9\u9762\u7684\u5185\u5bb9\u3002</p> <p></p>"},{"location":"Introduction/Nginx%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#server","title":"\u5982\u4f55\u4f7f\u7528\u672a\u5b9a\u4e49\u7684 server \u540d\u79f0\u6765\u963b\u6b62\u5904\u7406\u8bf7\u6c42","text":"<p>\u5982\u679c\u4e0d\u5141\u8bb8\u6ca1\u6709 \u201cHost\u201d header \u5b57\u6bb5\u7684\u8bf7\u6c42\uff0c\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u4e22\u5f03\u8bf7\u6c42\u7684 server\uff1a</p> <pre><code>server {\nlisten      80;\nserver_name \"\";\nreturn      444;\n}\n</code></pre> <p>\u8fd9\u91cc\u7684 <code>server</code> \u540d\u79f0\u8bbe\u7f6e\u4e3a\u4e00\u4e2a\u7a7a\u5b57\u7b26\u4e32\uff0c\u4f1a\u5339\u914d\u4e0d\u5e26 <code>Host</code> \u7684 header \u57df\u8bf7\u6c42\uff0cnginx \u4f1a\u8fd4\u56de\u4e00\u4e2a\u8868\u793a\u5173\u95ed\u8fde\u63a5\u7684\u975e\u6807\u51c6\u4ee3\u7801 444\u3002</p> <p>\u81ea 0.8.48 \u7248\u672c\u5f00\u59cb\uff0c\u8fd9\u662f <code>server</code> \u540d\u79f0\u7684\u9ed8\u8ba4\u8bbe\u7f6e\uff0c\u56e0\u6b64\u53ef\u4ee5\u7701\u7565 <code>server name \"\"</code>\u3002\u5728\u65e9\u671f\u7248\u672c\u4e2d\uff0c\u673a\u5668\u7684\u4e3b\u673a\u540d\u88ab\u4f5c\u4e3a <code>server</code> \u7684\u9ed8\u8ba4\u540d\u79f0\u3002</p> <p></p>"},{"location":"Introduction/Nginx%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#ip","title":"\u57fa\u4e8e\u540d\u79f0\u548c IP \u6df7\u5408\u7684\u865a\u62df\u670d\u52a1\u5668","text":"<p>\u8ba9\u6211\u4eec\u770b\u770b\u66f4\u52a0\u590d\u6742\u7684\u914d\u7f6e\uff0c\u5176\u4e2d\u4e00\u4e9b\u865a\u62df\u670d\u52a1\u5668\u76d1\u542c\u5728\u4e0d\u540c\u7684 IP \u5730\u5740\u4e0a\u76d1\u542c\uff1a</p> <pre><code>server {\nlisten      192.168.1.1:80;\nserver_name example.org www.example.org;\n...\n}\n\nserver {\nlisten      192.168.1.1:80;\nserver_name example.net www.example.net;\n...\n}\n\nserver {\nlisten      192.168.1.2:80;\nserver_name example.com www.example.com;\n...\n}\n</code></pre> <p>\u6b64\u914d\u7f6e\u4e2d\uff0cnginx \u9996\u5148\u6839\u636e server \u5757\u7684 <code>listen</code> \u6307\u4ee4\u68c0\u9a8c\u8bf7\u6c42\u7684 IP \u548c\u7aef\u53e3\u3002\u4e4b\u540e\uff0c\u6839\u636e\u4e0e IP \u548c\u7aef\u53e3\u76f8\u5339\u914d\u7684 <code>server</code> \u5757\u7684 server_name \u9879\u5bf9\u8bf7\u6c42\u7684\u201cHost\u201d header \u57df\u8fdb\u884c\u68c0\u9a8c\u3002\u5982\u679c\u627e\u4e0d\u5230\u670d\u52a1\u5668\u7684\u540d\u79f0\uff08server_name\uff09\uff0c\u8bf7\u6c42\u5c06\u7531 <code>default_server</code> \u5904\u7406\u3002\u4f8b\u5982\uff0c\u5728 <code>192.168.1.1:80</code> \u4e0a\u6536\u5230\u7684\u5bf9 <code>www.example.com</code> \u7684\u8bf7\u6c42\u5c06\u7531 <code>192.168.1.1:80</code> \u7aef\u53e3\u7684 <code>default_server</code> \uff08\u5373\u7b2c\u4e00\u4e2a server\uff09\u5904\u7406\uff0c\u56e0\u4e3a\u6ca1\u6709 <code>www.example.com</code> \u5728\u6b64\u7aef\u53e3\u4e0a\u5b9a\u4e49\u3002</p> <p>\u5982\u4e0a\u6240\u8ff0\uff0c<code>default_server</code> \u662f <code>listen port</code> \u7684\u5c5e\u6027\uff0c\u53ef\u4ee5\u4e3a\u4e0d\u540c\u7684\u7aef\u53e3\u5b9a\u4e49\u4e0d\u540c\u7684 <code>default_server</code>\uff1a</p> <pre><code>server {\nlisten      192.168.1.1:80;\nserver_name example.org www.example.org;\n...\n}\n\nserver {\nlisten      192.168.1.1:80 default_server;\nserver_name example.net www.example.net;\n...\n}\n\nserver {\nlisten      192.168.1.2:80 default_server;\nserver_name example.com www.example.com;\n...\n}\n</code></pre> <p></p>"},{"location":"Introduction/Nginx%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#php","title":"\u4e00\u4e2a\u7b80\u5355\u7684 PHP \u7ad9\u70b9\u914d\u7f6e","text":"<p>\u73b0\u5728\u8ba9\u6211\u4eec\u6765\u770b\u770b nginx \u662f\u5982\u4f55\u9009\u62e9\u4e00\u4e2a <code>location</code> \u6765\u5904\u7406\u5178\u578b\u7684\u7b80\u5355 PHP \u7ad9\u70b9\u7684\u8bf7\u6c42\uff1a</p> <pre><code>server {\nlisten      80;\nserver_name example.org www.example.org;\nroot        /data/www;\n\nlocation / {\nindex   index.html index.php;\n}\n\nlocation ~* \\.(gif|jpg|png)$ {\nexpires 30d;\n}\n\nlocation ~ \\.php$ {\nfastcgi_pass  localhost:9000;\nfastcgi_param SCRIPT_FILENAME\n$document_root$fastcgi_script_name;\ninclude       fastcgi_params;\n}\n}\n</code></pre> <p>nginx \u9996\u5148\u5ffd\u7565\u6392\u5e8f\u641c\u7d22\u5177\u6709\u6700\u660e\u786e\u5b57\u7b26\u4e32\u7684\u524d\u7f00 <code>location</code>\u3002\u5728\u4e0a\u9762\u7684\u914d\u7f6e\u4e2d\uff0c\u552f\u4e00\u6709\u7b26\u5408\u7684\u662f\u524d\u7f00 <code>location</code> \u4e3a <code>/</code>\uff0c\u56e0\u4e3a\u5b83\u5339\u914d\u4efb\u4f55\u8bf7\u6c42\uff0c\u5b83\u5c06\u88ab\u7528\u4f5c\u6700\u540e\u7684\u624b\u6bb5\u3002\u4e4b\u540e\uff0cnginx \u6309\u7167\u914d\u7f6e\u6587\u4ef6\u4e2d\u5217\u51fa\u7684\u987a\u5e8f\u68c0\u67e5\u7531 <code>location</code> \u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u7b2c\u4e00\u4e2a\u5339\u914d\u8868\u8fbe\u5f0f\u505c\u6b62\u641c\u7d22\uff0cnginx \u5c06\u4f7f\u7528\u6b64 <code>location</code>\u3002\u5982\u679c\u6ca1\u6709\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u8bf7\u6c42\uff0c\u90a3\u4e48 nginx \u5c06\u4f7f\u7528\u524d\u9762\u627e\u5230\u7684\u6700\u660e\u786e\u7684\u524d\u7f00 <code>location</code>\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u6240\u6709\u7c7b\u578b\u7684 <code>location</code> \u4ec5\u4ec5\u662f\u68c0\u9a8c\u8bf7\u6c42\u7684 URI \u90e8\u5206\uff0c\u4e0d\u5e26\u53c2\u6570\u3002\u8fd9\u6837\u505a\u662f\u56e0\u4e3a\u67e5\u8be2\u5b57\u7b26\u4e32\u4e2d\u7684\u53c2\u6570\u53ef\u4ee5\u6709\u591a\u79cd\u5f62\u5f0f\uff0c\u4f8b\u5982\uff1a</p> <pre><code>/index.php?user=john&amp;page=1\n/index.php?page=1&amp;user=john\n</code></pre> <p>\u6b64\u5916\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u5728\u67e5\u8be2\u5b57\u7b26\u4e32\u4e2d\u8bf7\u6c42\u4efb\u4f55\u5185\u5bb9\uff1a</p> <pre><code>/index.php?page=1&amp;something+else&amp;user=john\n</code></pre> <p>\u73b0\u5728\u6765\u770b\u770b\u5728\u4e0a\u9762\u7684\u914d\u7f6e\u4e2d\u662f\u5982\u4f55\u8bf7\u6c42\u7684\uff1a - \u8bf7\u6c42 <code>/logo.gif</code> \u9996\u5148\u4e0e \u524d\u7f00 <code>location</code> \u4e3a <code>/</code> \u76f8\u5339\u914d\uff0c\u7136\u540e\u7531\u6b63\u5219\u8868\u8fbe\u5f0f <code>\\.(gif|jpg|png)$</code> \u5339\u914d\uff0c\u56e0\u6b64\u7531\u540e\u4e00\u4e2a <code>location</code> \u5904\u7406\u3002\u4f7f\u7528\u6307\u4ee4 <code>root /data/www</code> \u5c06\u8bf7\u6c42\u6620\u5c04\u5230 <code>/data/www/logo.gif</code> \u6587\u4ef6\uff0c\u5e76\u5c06\u6587\u4ef6\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002 - \u4e00\u4e2a <code>/index.php</code> \u7684\u8bf7\u6c42\u4e5f\u662f\u9996\u5148\u4e0e\u524d\u7f00 <code>location</code> \u4e3a <code>/</code> \u76f8\u5339\u914d\uff0c\u7136\u540e\u662f\u6b63\u5219\u8868\u8fbe\u5f0f <code>\\.(php)$</code>\u3002\u56e0\u6b64\uff0c\u5b83\u7531\u540e\u4e00\u4e2a <code>location</code> \u5904\u7406\uff0c\u8bf7\u6c42\u5c06\u88ab\u4f20\u9012\u7ed9\u5728 <code>localhost:9000</code> \u4e0a\u76d1\u542c\u7684 FastCGI \u670d\u52a1\u5668\u3002fastcgi_param \u6307\u4ee4\u5c06 FastCGI \u53c2\u6570 <code>SCRPT_FILENAME</code> \u8bbe\u7f6e\u4e3a <code>/data/www/index.php</code>\uff0cFastCGI \u670d\u52a1\u5668\u6267\u884c\u8be5\u6587\u4ef6\u3002\u53d8\u91cf <code>$document_root</code> \u4e0e root \u6307\u4ee4\u7684\u503c\u662f\u4e00\u6837\u7684\uff0c\u53d8\u91cf <code>$fastcgi_script_name</code> \u7684\u503c\u4e3a\u8bf7\u6c42URI\uff0c\u5373 <code>/index.php</code>\u3002 - <code>/about.html</code> \u8bf7\u6c42\u4ec5\u4e0e\u524d\u7f00 <code>location</code> \u4e3a <code>/</code> \u76f8\u5339\u914d\uff0c\u56e0\u6b64\u7531\u6b64 <code>location</code> \u5904\u7406\u3002\u4f7f\u7528\u6307\u4ee4 <code>root /data/www</code> \u5c06\u8bf7\u6c42\u6620\u5c04\u5230 <code>/data/www/about.html</code> \u6587\u4ef6\uff0c\u5e76\u5c06\u6587\u4ef6\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002 - \u5904\u7406\u8bf7\u6c42 <code>/</code> \u66f4\u590d\u6742\u3002\u5b83\u4e0e\u524d\u7f00 <code>location</code> \u4e3a <code>/</code> \u76f8\u5339\u914d\u3002\u56e0\u6b64\u7531\u8be5 <code>location</code> \u5904\u7406\u3002\u7136\u540e\uff0cindex \u6307\u4ee4\u6839\u636e\u5176\u53c2\u6570\u548c <code>root /data/www</code> \u6307\u4ee4\u68c0\u9a8c\u7d22\u5f15\u6587\u4ef6\u662f\u5426\u5b58\u5728\u3002\u5982\u679c\u6587\u4ef6 <code>/data/www/index.html</code> \u4e0d\u5b58\u5728\uff0c\u5e76\u4e14\u6587\u4ef6 <code>/data/www/index.php</code> \u5b58\u5728\uff0c\u5219\u8be5\u6307\u4ee4\u6267\u884c\u5185\u90e8\u91cd\u5b9a\u5411\u5230 <code>/index.php</code>\uff0c\u5c31\u50cf\u8bf7\u6c42\u662f\u7531\u5ba2\u6237\u7aef\u53d1\u8d77\u7684\uff0cnginx \u5c06\u518d\u6b21\u641c\u7d22 <code>location</code>\u3002\u5982\u4e4b\u524d\u6240\u8ff0\uff0c\u91cd\u5b9a\u5411\u8bf7\u6c42\u6700\u7ec8\u7531 FastCGI \u670d\u52a1\u5668\u5904\u7406\u3002</p> <p>\u7531 Igor Sysoev \u64b0\u5199 \u7531 Brian Mercer \u7f16\u8f91</p>"},{"location":"Introduction/Nginx%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/#_2","title":"\u539f\u6587","text":"<ul> <li>http://nginx.org/en/docs/http/request_processing.html</li> </ul>"},{"location":"Introduction/Windows%E4%B8%8B%E7%9A%84Nginx/","title":"Windows \u4e0b\u7684 nginx","text":"<p>\u5df2\u77e5\u95ee\u9898 \u4ee5\u540e\u53ef\u80fd\u7684\u53d1\u5c55</p> <p>Nginx \u7684 Windows \u7248\u672c\u4f7f\u7528\u4e86\u672c\u5730\u7684 Win32 API\uff08\u800c\u4e0d\u662f Cygwin \u6a21\u62df\u5c42\uff09\u3002\u76ee\u524d\u4ec5\u4f7f\u7528 <code>select()</code> \u548c <code>poll()</code> (1.15.9) \u8fde\u63a5\u5904\u7406\u65b9\u5f0f\u3002\u7531\u4e8e\u6b64\u7248\u672c\u548c\u5176\u4ed6\u5b58\u5728\u5df2\u77e5\u7684\u95ee\u9898\u7684 Nginx Windows \u7248\u672c\u90fd\u88ab\u8ba4\u4e3a\u662f beta \u7248\u672c\uff0c\u56e0\u6b64\u60a8\u4e0d\u5e94\u8be5\u671f\u671b\u5b83\u5177\u6709\u9ad8\u6027\u80fd\u548c\u53ef\u6269\u5c55\u6027\u3002\u73b0\u5728\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e0e Unix \u7248\u672c\u7684 nginx \u51e0\u4e4e\u76f8\u540c\u7684\u529f\u80fd\uff0c\u9664\u4e86 XSLT \u8fc7\u6ee4\u5668\u3001\u56fe\u50cf\u8fc7\u6ee4\u5668\u3001GeoIP \u6a21\u5757\u548c\u5d4c\u5165\u5f0f Perl \u8bed\u8a00\u3002</p> <p>\u8981\u5b89\u88c5 nginx \u7684 Windows \u7248\u672c\uff0c\u8bf7 \u4e0b\u8f7d \u6700\u65b0\u7684\u4e3b\u7ebf\u53d1\u884c\u7248\uff081.17.2\uff09\uff0c\u56e0\u4e3a nginx \u7684\u4e3b\u7ebf\u5206\u652f\u5305\u542b\u4e86\u6240\u6709\u5df2\u77e5\u7684\u8865\u4e01\u3002\u4e4b\u540e\u89e3\u538b\u6587\u4ef6\u5230 <code>nginx-1.17.2</code> \u76ee\u5f55\u4e0b\uff0c\u7136\u540e\u8fd0\u884c <code>nginx</code>\u3002\u4ee5\u4e0b\u662f <code>C\u76d8</code> \u7684\u6839\u76ee\u5f55\uff1a</p> <pre><code>cd c:\\\nunzip nginx-1.17.2.zip\ncd nginx-1.17.2\nstart nginx\n</code></pre> <p>\u8fd0\u884c <code>tasklist</code> \u547d\u4ee4\u884c\u5de5\u5177\u67e5\u770b nginx \u8fdb\u7a0b\uff1a</p> <p><pre><code>C:\\nginx-1.17.2&gt;tasklist /fi \"imagename eq nginx.exe\"\n\nImage Name           PID Session Name     Session#    Mem Usage\n=============== ======== ============== ========== ============\nnginx.exe            652 Console                 0      2 780 K\nnginx.exe           1332 Console                 0      3 112 K\n</code></pre> \u5176\u4e2d\u6709\u4e00\u4e2a\u662f\u4e3b\u8fdb\u7a0b\uff08master\uff09\uff0c\u53e6\u4e00\u4e2a\u662f\u5de5\u4f5c\u8fdb\u7a0b\uff08worker\uff09\u3002\u5982\u679c nginx \u672a\u80fd\u542f\u52a8\uff0c\u8bf7\u5728\u9519\u8bef\u65e5\u5fd7 <code>logs\\error.log</code> \u4e2d\u67e5\u627e\u539f\u56e0\u3002\u5982\u679c\u65e5\u5fd7\u6587\u4ef6\u5c1a\u672a\u521b\u5efa\uff0c\u53ef\u4ee5\u5728 Windows \u4e8b\u4ef6\u65e5\u5fd7\u4e2d\u67e5\u627e\u539f\u56e0\u3002\u5982\u679c\u663e\u793a\u7684\u9875\u9762\u4e3a\u9519\u8bef\u9875\u9762\uff0c\u800c\u4e0d\u662f\u9884\u671f\u7ed3\u679c\uff0c\u4e5f\u53ef\u4ee5\u5728 <code>logs\\error.log</code> \u4e2d\u67e5\u627e\u539f\u56e0\u3002</p> <p>Nginx \u7684 Windows \u7248\u672c\u4f7f\u7528\u8fd0\u884c\u76ee\u5f55\u4f5c\u4e3a\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u76f8\u5bf9\u8def\u5f84\u524d\u7f00\u3002\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u524d\u7f00\u662f <code>C:\\nginx-1.17.2\\</code>\u3002\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u8def\u5f84\u5fc5\u987b\u4f7f\u7c7b Unix \u98ce\u683c\u7684\u6b63\u659c\u6760\uff1a</p> <p><pre><code>access_log   logs/site.log;\nroot         C:/web/html;\n</code></pre> Nginx \u7684 Windows \u7248\u672c\u4f5c\u4e3a\u6807\u51c6\u7684\u63a7\u5236\u53f0\u5e94\u7528\u7a0b\u5e8f\uff08\u800c\u4e0d\u662f\u670d\u52a1\uff09\u8fd0\u884c\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u8fdb\u884c\u7ba1\u7406\uff1a</p> <ul> <li><code>nginx -s stop</code> \u5feb\u901f\u9000\u51fa</li> <li><code>nginx -s quit</code> \u6b63\u5e38\u9000\u51fa</li> <li><code>nginx -s reload</code> \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\uff0c\u4f7f\u7528\u65b0\u7684\u914d\u7f6e\u542f\u52a8\u5de5\u4f5c\u8fdb\u7a0b\uff0c\u6b63\u5e38\u5173\u95ed\u65e7\u7684\u5de5\u4f5c\u8fdb\u7a0b</li> <li><code>nginx -s reopen</code> \u91cd\u65b0\u6253\u5f00\u65e5\u5fd7\u6587\u4ef6</li> </ul>"},{"location":"Introduction/Windows%E4%B8%8B%E7%9A%84Nginx/#_1","title":"\u5df2\u77e5\u95ee\u9898","text":"<ul> <li>\u867d\u7136\u53ef\u4ee5\u542f\u52a8\u591a\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\uff0c\u4f46\u5b9e\u9645\u4e0a\u53ea\u6709\u4e00\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u505a\u5b8c\u5168\u90e8\u7684\u5de5\u4f5c</li> <li>\u4e0d\u652f\u6301 UDP \u4ee3\u7406\u529f\u80fd</li> </ul>"},{"location":"Introduction/Windows%E4%B8%8B%E7%9A%84Nginx/#_2","title":"\u4ee5\u540e\u53ef\u80fd\u7684\u53d1\u5c55","text":"<ul> <li>\u4f5c\u4e3a\u670d\u52a1\u8fd0\u884c</li> <li>\u4f7f\u7528 I/O \u5b8c\u6210\u7aef\u53e3\u4f5c\u4e3a\u8fde\u63a5\u5904\u7406\u65b9\u5f0f</li> <li>\u5728\u5355\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u4e2d\u4f7f\u7528\u591a\u4e2a\u5de5\u4f5c\u7ebf\u7a0b</li> </ul>"},{"location":"Introduction/Windows%E4%B8%8B%E7%9A%84Nginx/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/windows.html</p>"},{"location":"Introduction/%E4%BD%BF%E7%94%A8Nginx%E4%BD%9C%E4%B8%BAHTTP%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8/","title":"\u4f7f\u7528 nginx \u4f5c\u4e3a HTTP \u8d1f\u8f7d\u5747\u8861\u5668","text":""},{"location":"Introduction/%E4%BD%BF%E7%94%A8Nginx%E4%BD%9C%E4%B8%BAHTTP%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8/#_1","title":"\u4ecb\u7ecd","text":"<p>\u8d1f\u8f7d\u5747\u8861\u8de8\u8d8a\u591a\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b\uff0c\u662f\u4e00\u79cd\u5e38\u7528\u7684\u6280\u672f\uff0c\u5176\u7528\u4e8e\u4f18\u5316\u8d44\u6e90\u5229\u7528\u7387\u3001\u6700\u5927\u5316\u541e\u5410\u91cf\u3001\u51cf\u5c11\u5ef6\u8fdf\u548c\u786e\u4fdd\u5bb9\u9519\u914d\u7f6e\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 nginx \u4f5c\u4e3a\u9ad8\u6548\u7684 HTTP \u8d1f\u8f7d\u5747\u8861\u5668\uff0c\u5c06\u6d41\u91cf\u5206\u5e03\u5230\u591a\u4e2a\u5e94\u7528\u670d\u52a1\u5668\uff0c\u5e76\u901a\u8fc7 nginx \u63d0\u9ad8 web \u5e94\u7528\u7a0b\u5e8f\u7684\u6027\u80fd\u3001\u53ef\u6269\u5c55\u6027\u548c\u53ef\u9760\u6027\u3002</p>"},{"location":"Introduction/%E4%BD%BF%E7%94%A8Nginx%E4%BD%9C%E4%B8%BAHTTP%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8/#_2","title":"\u8d1f\u8f7d\u5747\u8861\u65b9\u6cd5","text":"<p>nginx \u652f\u6301\u4ee5\u4e0b\u8d1f\u8f7d\u5747\u8861\u673a\u5236\uff08\u6216\u65b9\u6cd5\uff09\uff1a</p> <ul> <li>\u8f6e\u8be2\uff08round-robin\uff09 - \u53d1\u9001\u7ed9\u5e94\u7528\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u4ee5\u8f6e\u8be2\u7684\u65b9\u5f0f\u5206\u53d1</li> <li>\u6700\u5c11\u8fde\u63a5\uff08least-connected\uff09 - \u4e0b\u4e00\u4e2a\u8bf7\u6c42\u88ab\u5206\u914d\u7ed9\u5177\u6709\u6700\u5c11\u6570\u91cf\u6d3b\u52a8\u8fde\u63a5\u7684\u670d\u52a1\u5668</li> <li>ip \u54c8\u5e0c\uff08ip-hash\uff09 - \u4f7f\u7528\u54c8\u5e0c\u51fd\u6570\u786e\u5b9a\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u5e94\u8be5\u9009\u62e9\u54ea\u4e00\u4e2a\u670d\u52a1\u5668\uff08\u57fa\u4e8e\u5ba2\u6237\u7aef\u7684 IP \u5730\u5740\uff09</li> </ul>"},{"location":"Introduction/%E4%BD%BF%E7%94%A8Nginx%E4%BD%9C%E4%B8%BAHTTP%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8/#_3","title":"\u9ed8\u8ba4\u8d1f\u8f7d\u5747\u8861\u914d\u7f6e","text":"<p>\u4f7f\u7528 nginx \u8fdb\u884c\u8d1f\u8f7d\u5747\u8861\u7684\u6700\u7b80\u5355\u914d\u7f6e\u5982\u4e0b\u6240\u793a\uff1a</p> <p><pre><code>http {\nupstream myapp1 {\nserver srv1.example.com;\nserver srv2.example.com;\nserver srv3.example.com;\n}\n\nserver {\nlisten 80;\n\nlocation / {\nproxy_pass http://myapp1;\n}\n}\n}\n</code></pre> \u5728\u4e0a\u8ff0\u793a\u4f8b\u4e2d\uff0c\u5728 srv1-srv3 \u4e0a\u8fd0\u884c\u76f8\u540c\u7684\u5e94\u7528\u7684\u4e09\u4e2a\u5b9e\u4f8b\u3002\u5f53\u8d1f\u8f7d\u5747\u8861\u65b9\u6cd5\u6ca1\u6709\u88ab\u7279\u522b\u914d\u7f6e\u65f6\uff0c\u9ed8\u8ba4\u91c7\u7528\u8f6e\u8be2\uff08round-robin\uff09\u3002\u6240\u6709\u8bf7\u6c42\u90fd\u88ab \u4ee3\u7406 \u5230\u670d\u52a1\u5668\u7ec4 myapp1\uff0cnginx \u5e94\u7528 HTTP \u8d1f\u8f7d\u5747\u8861\u6765\u5206\u53d1\u8bf7\u6c42\u3002</p> <p>nginx \u4e2d\u7684\u53cd\u5411\u4ee3\u7406\u5b9e\u73b0\u5305\u62ec HTTP\u3001HTTPS\u3001FastCGI\u3001uwsgi\u3001SCGI \u548c memcached\u3002</p> <p>\u8981\u914d\u7f6e HTTPS \u800c\u4e0d\u662f HTTP \u8d1f\u8f7d\u5747\u8861\uff0c\u53ea\u9700\u8981\u4f7f\u7528 HTTPS \u534f\u8bae\u3002</p> <p>\u5728\u4e3a FastCGI\u3001uwsgi\u3001SCGI \u6216 memcached \u8bbe\u7f6e\u8d1f\u8f7d\u5747\u8861\u65f6\uff0c\u5206\u522b\u4f7f\u7528 fastcgi_pass\u3001uwsgi_pass\u3001scgi_pass \u548c memcached_pass \u6307\u4ee4\u3002</p>"},{"location":"Introduction/%E4%BD%BF%E7%94%A8Nginx%E4%BD%9C%E4%B8%BAHTTP%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8/#_4","title":"\u6700\u5c11\u8fde\u63a5\u8d1f\u8f7d\u5747\u8861","text":"<p>\u53e6\u4e00\u4e2a\u8d1f\u8f7d\u5747\u8861\u7684\u89c4\u5219\u662f\u6700\u5c11\u8fde\u63a5\u3002\u5728\u4e00\u4e9b\u8bf7\u6c42\u9700\u8981\u66f4\u957f\u7684\u65f6\u95f4\u624d\u80fd\u5b8c\u6210\u7684\u60c5\u51b5\u4e0b\uff0c\u6700\u5c11\u8fde\u63a5\u53ef\u4ee5\u66f4\u516c\u6b63\u5730\u63a7\u5236\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b\u7684\u8d1f\u8f7d\u3002</p> <p>\u4f7f\u7528\u6700\u5c11\u8fde\u63a5\u7684\u8d1f\u8f7d\u5747\u8861\uff0cnginx \u5c06\u5c3d\u91cf\u4e0d\u7ed9\u8fc7\u4e8e\u7e41\u5fd9\u7684\u5e94\u7528\u670d\u52a1\u5668\u8d1f\u8f7d\u8fc7\u591a\u7684\u8bf7\u6c42\uff0c\u800c\u662f\u5c06\u65b0\u7684\u8bf7\u6c42\u5206\u53d1\u5230\u4e0d\u592a\u5fd9\u7684\u670d\u52a1\u5668\u3002</p> <p>\u5f53\u4f7f\u7528 least_conn \u6307\u4ee4\u4f5c\u4e3a\u670d\u52a1\u7ec4\u914d\u7f6e\u7684\u4e00\u90e8\u5206\u65f6\uff0c\u5c06\u6fc0\u6d3b nginx \u4e2d\u7684\u6700\u5c11\u8fde\u63a5\u8d1f\u8f7d\u5747\u8861\uff1a</p> <pre><code>upstream myapp1 {\nleast_conn;\nserver srv1.example.com;\nserver srv2.example.com;\nserver srv3.example.com;\n}\n</code></pre>"},{"location":"Introduction/%E4%BD%BF%E7%94%A8Nginx%E4%BD%9C%E4%B8%BAHTTP%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8/#_5","title":"\u4f1a\u8bdd\u6301\u4e45\u5316","text":"<p>\u8bf7\u6ce8\u610f\uff0c\u4f7f\u7528\u8f6e\u8be2\u6216\u8005\u6700\u5c11\u8fde\u63a5\u7684\u8d1f\u8f7d\u5747\u8861\uff0c\u6bcf\u4e2a\u540e\u7eed\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u90fd\u53ef\u80fd\u88ab\u5206\u914d\u5230\u4e0d\u540c\u7684\u670d\u52a1\u5668\u3002\u4e0d\u80fd\u4fdd\u8bc1\u540c\u4e00\u4e2a\u5ba2\u6237\u7aef\u59cb\u7ec8\u6307\u5411\u540c\u4e00\u4e2a\u670d\u52a1\u5668\u3002</p> <p>\u5982\u679c\u9700\u8981\u5c06\u5ba2\u6237\u7aef\u7ed1\u5b9a\u5230\u7279\u5b9a\u7684\u5e94\u7528\u670d\u52a1\u5668\uff0c\u6362\u800c\u8a00\u4e4b\uff0c\u4f7f\u5ba2\u6237\u7aef\u4f1a\u8bdd\u300c\u7c98\u6ede\u300d\u6216\u8005\u300c\u6c38\u4e45\u300d\uff0c\u59cb\u7ec8\u5c1d\u8bd5\u9009\u62e9\u7279\u5b9a\u7684\u670d\u52a1\u5668\uff0cIP \u54c8\u5e0c\u8d1f\u8f7d\u5747\u8861\u673a\u5236\u53ef\u4ee5\u505a\u5230\u8fd9\u70b9\u3002</p> <p>\u4f7f\u7528 IP \u54c8\u5e0c\uff0c\u5ba2\u6237\u7aef\u7684 IP \u5730\u5740\u7528\u4f5c\u4e3a\u54c8\u5e0c\u952e\uff0c\u4ee5\u786e\u5b9a\u5e94\u7528\u4e3a\u5ba2\u6237\u7aef\u8bf7\u6c42\u9009\u62e9\u670d\u52a1\u5668\u7ec4\u4e2d\u7684\u54ea\u4e2a\u670d\u52a1\u5668\u3002\u6b64\u65b9\u6cd5\u786e\u4fdd\u4e86\u6765\u81ea\u540c\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u59cb\u7ec8\u88ab\u5b9a\u5411\u5230\u540c\u4e00\u53f0\u670d\u52a1\u5668\uff0c\u9664\u975e\u8be5\u670d\u52a1\u5668\u4e0d\u53ef\u7528\u3002</p> <p>\u8981\u914d\u7f6e IP \u54c8\u5e0c\u8d1f\u8f7d\u5747\u8861\uff0c\u53ea\u9700\u8981\u5c06 ip_hash \u6307\u4ee4\u6dfb\u52a0\u5230\u670d\u52a1\u5668 upstream \u7ec4\u914d\u7f6e\u4e2d\u5373\u53ef\uff1a</p> <pre><code>upstream myapp1 {\nip_hash;\nserver srv1.example.com;\nserver srv2.example.com;\nserver srv3.example.com;\n}\n</code></pre>"},{"location":"Introduction/%E4%BD%BF%E7%94%A8Nginx%E4%BD%9C%E4%B8%BAHTTP%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8/#_6","title":"\u52a0\u6743\u8d1f\u8f7d\u5747\u8861","text":"<p>\u8fd8\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u670d\u52a1\u5668\u6743\u91cd\u8fdb\u4e00\u6b65\u52a0\u5f3a nginx \u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u3002</p> <p>\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u670d\u52a1\u5668\u6743\u91cd\u6ca1\u6709\u88ab\u914d\u7f6e\uff0c\u8fd9\u610f\u5473\u5bf9\u4e8e\u7279\u5b9a\u7684\u8d1f\u8f7d\u5747\u8861\u65b9\u6cd5\u6765\u8bf4\u6240\u6709\u6307\u5b9a\u7684\u670d\u52a1\u5668\u90fd\u5177\u6709\u540c\u7b49\u8d44\u683c\u3002</p> <p>\u7279\u522b\u662f\u4f7f\u7528\u8f6e\u8be2\u65b9\u5f0f\uff0c\u8fd9\u4e5f\u610f\u5473\u7740\u670d\u52a1\u5668\u4e0a\u7684\u8bf7\u6c42\u5206\u914d\u6216\u591a\u6216\u5c11\u90fd\u662f\u76f8\u7b49\u7684 \u2014\u2014 \u53ea\u8981\u6709\u8db3\u591f\u7684\u8bf7\u6c42\uff0c\u5e76\u4e14\u4ee5\u7edf\u4e00\u7684\u65b9\u5f0f\u8db3\u591f\u5feb\u901f\u5730\u5b8c\u6210\u8bf7\u6c42\u5904\u7406\u3002</p> <p>\u5f53\u670d\u52a1\u5668\u6307\u5b9a weight \u53c2\u6570\u65f6\uff0c\u6743\u91cd\u5c06\u4f5c\u4e3a\u8d1f\u8f7d\u5747\u8861\u51b3\u7b56\u7684\u4e00\u90e8\u5206\u8fdb\u884c\u6838\u7b97\u3002</p> <p><pre><code> upstream myapp1 {\nserver srv1.example.com weight=3;\nserver srv2.example.com;\nserver srv3.example.com;\n}\n</code></pre> \u901a\u8fc7\u8fd9\u6837\u914d\u7f6e\uff0c\u6bcf 5 \u4e2a\u65b0\u7684\u8bf7\u6c42\u5c06\u5206\u5e03\u5728\u5e94\u7528\u7a0b\u5e8f\u5b9e\u4f8b\u4e4b\u4e2d\uff0c\u5982\u4e0b\u6240\u793a\uff1a\u4e09\u4e2a\u8bf7\u6c42\u88ab\u5b9a\u5411\u5230 srv1\uff0c\u4e00\u4e2a\u8bf7\u6c42\u5c06\u8f6c\u5230 srv2\uff0c\u53e6\u4e00\u4e2a\u8bf7\u6c42\u5c06\u8f6c\u5230 srv3\u3002</p> <p>\u5728 nginx \u7684\u6700\u8fd1\u7248\u672c\u4e2d\uff0c\u53ef\u4ee5\u5728\u6700\u5c11\u8fde\u63a5\u548c IP \u54c8\u5e0c\u8d1f\u8f7d\u5747\u8861\u4e2d\u4f7f\u7528\u6743\u91cd\u3002</p>"},{"location":"Introduction/%E4%BD%BF%E7%94%A8Nginx%E4%BD%9C%E4%B8%BAHTTP%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8/#_7","title":"\u5065\u5eb7\u68c0\u67e5","text":"<p>nginx \u4e2d\u7684\u53cd\u5411\u4ee3\u7406\u5b9e\u73b0\u5305\u62ec\u4e86\u5e26\u5185\uff08\u6216\u8005\u88ab\u52a8\uff09\u670d\u52a1\u5668\u5065\u5eb7\u68c0\u67e5\u3002\u5982\u679c\u7279\u5b9a\u670d\u52a1\u5668\u7684\u54cd\u5e94\u5931\u8d25\u5e76\u51fa\u73b0\u9519\u8bef\uff0c\u5219 nginx \u4f1a\u5c06\u6b64\u670d\u52a1\u5668\u6807\u8bb0\u4e3a\u5931\u8d25\uff0c\u5e76\u5c1d\u8bd5\u907f\u514d\u4e3a\u6b64\u540e\u7eed\u8bf7\u6c42\u9009\u62e9\u6b64\u670d\u52a1\u5668\u800c\u6d6a\u8d39\u4e00\u6bb5\u65f6\u95f4\u3002</p> <p>max_fails \u7528\u4e8e\u8bbe\u7f6e\u5728 fail_timeout \u671f\u95f4\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u5931\u8d25\u91cd\u65b0\u5c1d\u8bd5\u7684\u6b21\u6570\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cmax_fails \u8bbe\u7f6e\u4e3a 1\u3002\u5f53\u8bbe\u7f6e\u4e3a 0 \u65f6\uff0c\u8be5\u670d\u52a1\u5668\u7684\u5065\u5eb7\u68c0\u67e5\u5c06\u88ab\u7981\u7528\u3002fail_timeout \u53c2\u6570\u8fd8\u5b9a\u4e49\u4e86\u670d\u52a1\u5668\u88ab\u6807\u8bb0\u4e3a\u5931\u8d25\u7684\u65f6\u95f4\u3002\u5728\u670d\u52a1\u5668\u53d1\u751f\u6545\u969c\u540e\u7684 fail_timeout \u95f4\u9694\u540e\uff0cnginx \u5f00\u59cb\u4ee5\u5b9e\u65f6\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u4f18\u96c5\u5730\u63a2\u6d4b\u670d\u52a1\u5668\u3002\u5982\u679c\u63a2\u6d4b\u6210\u529f\uff0c\u5219\u5c06\u670d\u52a1\u5668\u6807\u8bb0\u4e3a\u6d3b\u52a8\u3002</p>"},{"location":"Introduction/%E4%BD%BF%E7%94%A8Nginx%E4%BD%9C%E4%B8%BAHTTP%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8/#_8","title":"\u8fdb\u4e00\u6b65\u9605\u8bfb","text":"<p>\u6b64\u5916\uff0c\u8fd8\u6709\u66f4\u591a\u7684\u6307\u4ee4\u548c\u53c2\u6570\u53ef\u4ee5\u63a7\u5236 nginx \u4e2d\u7684\u670d\u52a1\u5668\u8d1f\u8f7d\u5747\u8861\uff0c\u4f8b\u5982\uff0cproxy_next_upstream\u3001backup\u3001down \u548c keepalive\u3002\u6709\u5173\u66f4\u591a\u7684\u4fe1\u606f\uff0c\u8bf7\u67e5\u770b\u6211\u4eec\u7684\u53c2\u8003\u6587\u6863\u3002</p> <p>\u6700\u540e\u4f46\u540c\u6837\u91cd\u8981\uff0c\u5e94\u7528\u7a0b\u5e8f\u8d1f\u8f7d\u5747\u8861\u3001\u5e94\u7528\u7a0b\u5e8f\u5065\u5eb7\u68c0\u67e5\u3001\u6d3b\u52a8\u76d1\u63a7 \u548c\u670d\u52a1\u7ec4 \u52a8\u6001\u91cd\u65b0\u914d\u7f6e \u4f5c\u4e3a\u6211\u4eec NGINX Plus \u4ed8\u8d39\u8ba2\u9605\u7684\u4e00\u90e8\u5206\u3002</p> <p>\u4ee5\u4e0b\u6587\u7ae0\u8be6\u7ec6\u4ecb\u7ecd\u4e86 NGINX Plus \u8d1f\u8f7d\u5747\u8861\uff1a - NGINX \u8d1f\u8f7d\u5747\u8861\u4e0e NGINX Plus - NGINX \u8d1f\u8f7d\u5747\u8861\u4e0e Nginx Plus \u7b2c2\u90e8\u5206</p>"},{"location":"Introduction/%E4%BD%BF%E7%94%A8Nginx%E4%BD%9C%E4%B8%BAHTTP%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8/#_9","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/http/load_balancing.html</li> </ul>"},{"location":"Introduction/%E5%85%B3%E4%BA%8EnginScript/","title":"\u5173\u4e8e nginScript","text":"<p>nginScript \u662f JavaScript \u8bed\u8a00\u7684\u4e00\u4e2a\u5b50\u96c6\uff0c\u5176\u53ef\u5728 http \u548c stream \u4e2d\u5b9e\u73b0\u4f4d\u7f6e\uff08location\uff09\u548c\u53d8\u91cf\u5904\u7406\u5668\u3002nginScript \u7b26\u5408 ECMAScript 5.1 \u89c4\u8303\u548c\u90e8\u5206 ECMAScript 6 \u6269\u5c55\u3002\u5408\u89c4\u6027\u4ecd\u5728\u4e0d\u65ad\u53d1\u5c55\u3002</p>"},{"location":"Introduction/%E5%85%B3%E4%BA%8EnginScript/#_1","title":"\u76ee\u524d\u652f\u6301\u4ec0\u4e48","text":"<ul> <li>\u5e03\u5c14\u503c\u3001\u6570\u5b57\u3001\u5b57\u7b26\u4e32\u3001\u5bf9\u8c61\u3001\u6570\u7ec4\u3001\u51fd\u6570\u548c\u6b63\u5219\u8868\u8fbe\u5f0f</li> <li>ES5.1 \u8fd0\u7b97\u7b26\uff0cES7 \u5e42\u8fd0\u7b97\u7b26</li> <li>ES5.1\u8bed\u53e5\uff1a<code>var</code>\u3001<code>if</code>\u3001<code>else</code>\u3001<code>switch</code>\u3001<code>for</code>\u3001<code>for in</code>\u3001<code>while</code>\u3001<code>do while</code>\u3001<code>break</code>\u3001<code>continue</code>\u3001<code>return</code>\u3001<code>try</code>\u3001<code>catch</code>\u3001<code>throw</code>\u3001<code>finally</code></li> <li>ES6 <code>Number</code> \u548c <code>Math</code> \u7684\u5c5e\u6027\u548c\u65b9\u6cd5</li> <li><code>String</code> \u65b9\u6cd5\uff1a<ul> <li>ES5.1\uff1a<code>fromCharCode</code>\u3001<code>concat</code>\u3001<code>slice</code>\u3001<code>substring</code>\u3001<code>substr</code>\u3001<code>charAt</code>\u3001<code>charCodeAt</code>\u3001<code>indexOf</code>\u3001<code>lastIndexOf</code>\u3001<code>toLowerCase</code>\u3001<code>toUpperCase</code>\u3001<code>trim</code>\u3001<code>search</code>\u3001<code>match</code>\u3001<code>split</code>\u3001<code>replace</code></li> <li>ES6\uff1a<code>fromCodePoint</code>\u3001<code>codePointAt</code>\u3001<code>includes</code>\u3001<code>startsWith</code>\u3001<code>endsWith</code>\u3001<code>repeat</code></li> <li>\u975e\u6807\u51c6\uff1a<code>fromUTF8</code>\u3001<code>toUTF8</code>\u3001<code>fromBytes</code>\u3001<code>toBytes</code></li> </ul> </li> <li><code>Object</code> \u65b9\u6cd5\uff1a<ul> <li>ES5.1\uff1a<code>create</code>\uff08\u4e0d\u652f\u6301\u5c5e\u6027\u5217\u8868\uff09\uff0c<code>keys</code>\u3001<code>defineProperty</code>\u3001<code>defineProperties</code>\u3001<code>getOwnPropertyDescriptor</code>\u3001<code>getPrototypeOf</code>\u3001<code>hasOwnProperty</code>\u3001<code>isPrototypeOf</code>\u3001<code>preventExtensions</code>\u3001<code>isExtensible</code>\u3001<code>freeze</code>\u3001<code>isFrozen</code>\u3001<code>seal</code>\u3001<code>isSealed</code></li> </ul> </li> <li><code>Array</code> \u65b9\u6cd5\uff1a<ul> <li>ES5.1\uff1a<code>isArray</code>\u3001<code>slice</code>\u3001<code>splice</code>\u3001<code>push</code>\u3001<code>pop</code>\u3001<code>unshift</code>\u3001<code>shift</code>\u3001<code>reverse</code>\u3001<code>sort</code>\u3001<code>join</code>\u3001<code>concat</code>\u3001<code>indexOf</code>\u3001<code>lastIndexOf</code>\u3001<code>forEach</code>\u3001<code>some</code>\u3001<code>every</code>\u3001<code>filter</code>\u3001<code>map</code>\u3001<code>reduce</code>\u3001<code>reduceRight</code></li> <li>ES6\uff1a<code>of</code>\u3001<code>fill</code>\u3001<code>find</code>\u3001<code>findIndex</code></li> <li>ES7\uff1a<code>includes</code></li> </ul> </li> <li>ES5.1 <code>Function</code> \u65b9\u6cd5\uff1a<code>call</code>\u3001<code>apply</code>\u3001<code>bind</code></li> <li>ES5.1 <code>RegExp</code> \u65b9\u6cd5\uff1a<code>test</code>\u3001<code>exec</code></li> <li>ES5.1 <code>Date</code> \u65b9\u6cd5</li> <li>ES5.1 \u5168\u5c40\u51fd\u6570\uff1a<code>isFinite</code>\u3001<code>isNaN</code>\u3001<code>parseFloat</code>\u3001<code>parseInt</code>\u3001<code>decodeURI</code>\u3001<code>decodeURIComponent</code>\u3001<code>encodeURI</code>\u3001<code>encodeURIComponent</code></li> </ul>"},{"location":"Introduction/%E5%85%B3%E4%BA%8EnginScript/#_2","title":"\u8fd8\u4e0d\u652f\u6301\u4ec0\u4e48","text":"<ul> <li>ES6 <code>let</code> \u548c <code>const</code> \u58f0\u660e</li> <li>\u6807\u7b7e</li> <li><code>arguments</code> \u6570\u7ec4</li> <li><code>eval</code> \u51fd\u6570</li> <li><code>JSON</code> \u5bf9\u8c61</li> <li><code>Error</code> \u5bf9\u8c61</li> <li><code>setTimeout</code>\u3001<code>setInterval</code>\u3001<code>setImmediate</code> \u51fd\u6570</li> <li>\u975e\u6574\u6570\u5206\u6570\uff08.235\uff09\uff0c\u4e8c\u8fdb\u5236\uff080b0101\uff09\uff0c\u516b\u8fdb\u5236\uff080o77\uff09\u5b57\u9762\u91cf</li> </ul>"},{"location":"Introduction/%E5%85%B3%E4%BA%8EnginScript/#_3","title":"\u4e0b\u8f7d\u4e0e\u5b89\u88c5","text":"<p>nginScript \u53ef\u7528\u4e8e\u4ee5\u4e0b\u4e24\u4e2a\u6a21\u5757\uff1a</p> <ul> <li>ngx_http_js_module</li> <li>ngx_stream_js_module</li> </ul> <p>\u8fd9\u4e24\u4e2a\u6a21\u5757\u90fd\u4e0d\u662f\u9ed8\u8ba4\u6784\u5efa\u7684\uff0c\u5b83\u4eec\u5e94\u8be5\u4ece\u6e90\u6587\u4ef6\u4e2d\u7f16\u8bd1\u6216\u8005\u4f5c\u4e3a\u4e00\u4e2a Linux \u8f6f\u4ef6\u5305\u6765\u5b89\u88c5</p>"},{"location":"Introduction/%E5%85%B3%E4%BA%8EnginScript/#linux","title":"Linux \u5305\u5b89\u88c5\u65b9\u5f0f","text":"<p>\u5728 Linux \u73af\u5883\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528 nginScript \u6a21\u5757\u5305\uff1a</p> <ul> <li><code>nginx-module-njs</code> - nginScript \u52a8\u6001\u6a21\u5757</li> <li><code>nginx-module-njs-dbg</code> - <code>nginx-module-njs</code> \u5305\u7684\u8c03\u8bd5\u7b26\u53f7</li> </ul>"},{"location":"Introduction/%E5%85%B3%E4%BA%8EnginScript/#_4","title":"\u6e90\u7801\u6784\u5efa\u65b9\u5f0f","text":"<p>\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u514b\u9686 nginScript \u7684\u6e90\u7801\u4ed3\u5e93\uff1a\uff08\u9700\u8981 Mercurial \u5ba2\u6237\u7aef\uff09\uff1a</p> <pre><code>hg clone http://hg.nginx.org/njs\n</code></pre> <p>\u7136\u540e\u4f7f\u7528 <code>--add-module</code> \u914d\u7f6e\u53c2\u6570\u8fdb\u884c\u7f16\u8bd1\u6a21\u5757\uff1a</p> <pre><code>./configure --add-module=path-to-njs/nginx\n</code></pre> <p>\u8be5\u6a21\u5757\u4e5f\u53ef\u4ee5\u6784\u5efa\u4e3a\u52a8\u6001\u7684\uff1a</p> <pre><code>./configure --add-dynamic-module=path-to-njs/nginx\n</code></pre>"},{"location":"Introduction/%E5%85%B3%E4%BA%8EnginScript/#_5","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/njs_about.html</p>"},{"location":"Introduction/%E5%88%9D%E5%AD%A6%E8%80%85%E6%8C%87%E5%8D%97/","title":"\u521d\u5b66\u8005\u6307\u5357","text":"<p>\u672c\u6307\u5357\u65e8\u5728\u4ecb\u7ecd Nginx \u57fa\u672c\u5185\u5bb9\u548c\u4e00\u4e9b\u5728 Nginx \u4e0a\u53ef\u4ee5\u5b8c\u6210\u7684\u7b80\u5355\u4efb\u52a1\u3002\u8fd9\u91cc\u5047\u8bbe\u60a8\u5df2\u7ecf\u5b89\u88c5\u4e86 nginx\uff0c\u5426\u5219\u8bf7\u53c2\u9605 \u5b89\u88c5 nginx  \u9875\u9762\u3002 \u672c\u6307\u5357\u4ecb\u7ecd\u5982\u4f55\u542f\u52a8\u3001\u505c\u6b62 nginx \u548c\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\uff0c\u89e3\u91ca\u914d\u7f6e\u6587\u4ef6\u7684\u7ed3\u6784\uff0c\u5e76\u4ecb\u7ecd\u5982\u4f55\u8bbe\u7f6e nginx \u4ee5\u63d0\u4f9b\u9759\u6001\u5185\u5bb9\u670d\u52a1\uff0c\u5982\u4f55\u914d\u7f6e nginx \u4f5c\u4e3a\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u4ee5\u53ca\u5982\u4f55\u5c06\u5176\u8fde\u63a5\u5230\u4e00\u4e2a FastCGI \u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>nginx \u6709\u4e00\u4e2a\u4e3b\u8fdb\u7a0b\uff08Master\uff09\u548c\u51e0\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\uff08Worker\uff09\u3002\u4e3b\u8fdb\u7a0b\u7684\u4e3b\u8981\u76ee\u7684\u662f\u8bfb\u53d6\u548c\u8bc4\u4f30\u914d\u7f6e\uff0c\u5e76\u7ef4\u62a4\u5de5\u4f5c\u8fdb\u7a0b\u3002\u5de5\u4f5c\u8fdb\u7a0b\u5bf9\u8bf7\u6c42\u8fdb\u884c\u5904\u7406\u3002nginx \u91c7\u7528\u4e86\u57fa\u4e8e\u4e8b\u4ef6\u6a21\u578b\u548c\u4f9d\u8d56\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u673a\u5236\u6765\u6709\u6548\u5730\u5728\u5de5\u4f5c\u8fdb\u7a0b\u4e4b\u95f4\u5206\u914d\u8bf7\u6c42\u3002\u5de5\u4f5c\u8fdb\u7a0b\u7684\u6570\u91cf\u53ef\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u5b9a\u4e49\uff0c\u5e76\u4e14\u53ef\u4ee5\u9488\u5bf9\u7ed9\u5b9a\u7684\u914d\u7f6e\u8fdb\u884c\u4fee\u6539\uff0c\u6216\u8005\u81ea\u52a8\u8c03\u6574\u5230\u53ef\u7528 CPU \u5185\u6838\u7684\u6570\u91cf\uff08\u8bf7\u53c2\u9605 worker_processes\uff09\u3002</p> <p>\u914d\u7f6e\u6587\u4ef6\u51b3\u5b9a\u4e86 nginx \u53ca\u5176\u6a21\u5757\u7684\u5de5\u4f5c\u65b9\u5f0f\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u914d\u7f6e\u6587\u4ef6\u540d\u4e3a <code>nginx.conf</code>\uff0c\u5e76\u653e\u5728\u76ee\u5f55 <code>/usr/local/nginx/conf</code>\uff0c<code>/etc/nginx</code> \u6216 <code>/usr/local/etc/nginx</code> \u4e2d\u3002</p>"},{"location":"Introduction/%E5%88%9D%E5%AD%A6%E8%80%85%E6%8C%87%E5%8D%97/#nginx","title":"nginx\u6982\u8ff0","text":"<p>Nginx (\"engine x\") \u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684 HTTP \u548c\u53cd\u5411\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u4e5f\u662f\u4e00\u4e2a IMAP/POP3/SMTP \u4ee3\u7406\u670d\u52a1\u5668\u3002Nginx \u662f\u7531 Igor Sysoev \u4e3a\u4fc4\u7f57\u65af\u8457\u540d\u7684 Rambler.ru \u7ad9\u70b9\u5f00\u53d1\u7684\uff0c\u7b2c\u4e00\u4e2a\u516c\u5f00\u7248\u672c 0.1.0 \u53d1\u5e03\u4e8e 2004 \u5e74 10 \u6708 4 \u65e5\u3002\u5176\u5c06\u6e90\u4ee3\u7801\u4ee5\u7c7b BSD \u8bb8\u53ef\u8bc1\u7684\u5f62\u5f0f\u53d1\u5e03\uff0c\u56e0\u5b83\u7684\u7a33\u5b9a\u6027\u3001\u4e30\u5bcc\u7684\u529f\u80fd\u96c6\u3001\u793a\u4f8b\u914d\u7f6e\u6587\u4ef6\u548c\u4f4e\u7cfb\u7edf\u8d44\u6e90\u7684\u6d88\u8017\u800c\u95fb\u540d\u3002</p> <p>\u7531\u4e8e Nginx \u4f7f\u7528\u57fa\u4e8e\u4e8b\u4ef6\u9a71\u52a8\u7684\u67b6\u6784\uff0c\u80fd\u591f\u5e76\u53d1\u5904\u7406\u767e\u4e07\u7ea7\u522b\u7684 TCP \u8fde\u63a5\uff0c\u9ad8\u5ea6\u6a21\u5757\u5316\u7684\u8bbe\u8ba1\u548c\u81ea\u7531\u7684\u8bb8\u53ef\u8bc1\u4f7f\u5f97\u6269\u5c55 Nginx \u529f\u80fd\u7684\u7b2c\u4e09\u65b9\u6a21\u5757\u5c42\u51fa\u4e0d\u7a77\u3002\u56e0\u6b64\u5176\u4f5c\u4e3a Web \u670d\u52a1\u5668\u88ab\u5e7f\u6cdb\u5e94\u7528\u5230\u5927\u6d41\u91cf\u7684\u7f51\u7ad9\u4e0a\uff0c\u5305\u62ec\u6dd8\u5b9d\u3001\u817e\u8baf\u3001\u65b0\u6d6a\u3001\u4eac\u4e1c\u7b49\u8bbf\u95ee\u91cf\u5de8\u5927\u7684\u7f51\u7ad9\u3002</p> <p>2015 \u5e74 6 \u6708\uff0cNetcraft \u6536\u5230\u7684\u8c03\u67e5\u7f51\u7ad9\u6709 8 \u4ebf\u591a\u5bb6\uff0c\u4e3b\u6d41 web \u670d\u52a1\u5668\u5e02\u573a\u4efd\u989d\uff08\u524d\u56db\u540d\uff09\u5982\u4e0b\u8868\uff1a</p> Web\u670d\u52a1\u5668 \u5e02\u573a\u5360\u6709\u7387 Apache 49.53% Nginx 13.52% Microsoft IIS 12.32% Google Web Server 7.72% <p>\u5176\u4e2d\u5728\u8bbf\u95ee\u91cf\u6700\u591a\u7684\u4e00\u4e07\u4e2a\u7f51\u7ad9\u4e2d\uff0cNginx \u7684\u5360\u6709\u7387\u5df2\u8d85\u8fc7 Apache\u3002</p> <p>Nginx \u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684 Web \u670d\u52a1\u5668\uff0c\u4ece 2001 \u5e74\u53d1\u5c55\u81f3\u4eca\uff0c\u7531\u4e8e Nginx \u5bf9\u786c\u4ef6\u548c\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7279\u6027\u7684\u6df1\u5ea6\u6316\u6398\uff0c\u4f7f\u5f97\u5728\u4fdd\u6301\u9ad8\u5e76\u53d1\u7684\u540c\u65f6\u8fd8\u80fd\u591f\u4fdd\u6301\u9ad8\u541e\u5410\u91cf\u3002</p> <p>Nginx \u8fd8\u91c7\u7528\u4e86\u6a21\u5757\u8bbe\u8ba1\uff0c\u6709\u5927\u91cf\u7684\u7b2c\u4e09\u65b9\u6a21\u5757\u53ef\u4ee5\u6269\u5c55 Nginx \u7684\u529f\u80fd\uff0c\u56e0\u6b64 Nginx \u7684\u573a\u666f\u975e\u5e38\u4e30\u5bcc\uff0c\u540c\u65f6 Nginx \u91c7\u7528\u7684\u662f BSD \u8bb8\u53ef\u8bc1\uff0c\u8d4b\u4e88\u4e86 Nginx \u6700\u5927\u7684\u7075\u6d3b\u6027\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\uff0cNginx \u5177\u6709\u4ee5\u4e0b\u51e0\u4e2a\u4f18\u70b9\uff1a</p> <ul> <li>\u901f\u5ea6\u5feb</li> <li>\u9ad8\u5e76\u53d1\uff0c\u9ad8\u6027\u80fd</li> <li>\u53ef\u6269\u5c55\u6027\u597d</li> <li>\u9ad8\u53ef\u9760\uff0c\u4e00\u5e74\u4e4b\u4e2d\u505c\u673a\u65f6\u95f4\u53ef\u80fd\u53ea\u6709\u51e0\u79d2</li> <li>\u70ed\u90e8\u7f72\uff0c\u53ef\u4ee5\u4e0d\u91cd\u542f\u5347\u7ea7</li> <li>\u7075\u6d3b\u6027\u9ad8\uff0c\u91c7\u7528BSD \u8bb8\u53ef\u8bc1</li> </ul> <p>BSD\u5f00\u6e90\u534f\u8bae\u662f\u4e00\u4e2a\u7ed9\u4e88\u4f7f\u7528\u8005\u8005\u5f88\u5927\u81ea\u7531\u7684\u534f\u8bae\u3002</p> <p>\u57fa\u672c\u4e0a\u4f7f\u7528\u8005\u53ef\u4ee5\u201c\u4e3a\u6240\u6b32\u4e3a\u201d,\u53ef\u4ee5\u81ea\u7531\u7684\u4f7f\u7528\uff0c\u4fee\u6539\u6e90\u4ee3\u7801\uff0c\u4e5f\u53ef\u4ee5\u5c06\u4fee\u6539\u540e\u7684\u4ee3\u7801\u4f5c\u4e3a\u5f00\u6e90\u6216\u8005\u4e13\u6709\u8f6f\u4ef6\u518d\u53d1\u5e03\u3002</p> <p>\u622a\u6b62 2019 \u5e74 9 \u6708\u4efd\uff0cNginx \u7684\u5e02\u573a\u4efd\u989d\u5df2\u7ecf\u8fbe\u5230\u4e86 33%\uff0c\u4e14\u8fd8\u5728\u6301\u7eed\u589e\u957f\uff0c\u7a33\u5c45\u5e02\u573a\u5934\u628a\u4ea4\u6905\u3002</p>"},{"location":"Introduction/%E5%88%9D%E5%AD%A6%E8%80%85%E6%8C%87%E5%8D%97/#_2","title":"\u8bde\u751f\u80cc\u666f","text":"<p>Nginx \u51fa\u73b0\u7684\u80cc\u666f\u662f\u7531\u4e8e\u4e92\u8054\u7f51\u7684\u5feb\u901f\u666e\u53ca\u5bfc\u81f4\u6570\u636e\u91cf\u7684\u5feb\u901f\u589e\u957f\uff0c\u540c\u65f6\u50ac\u751f\u51fa\u4e86\u6d77\u91cf\u7684\u8fde\u63a5\u3002\u4f20\u7edf\u7684 Apache \u7b49\u670d\u52a1\u5668\u91c7\u7528\u7684\u662f\u5355\u8fdb\u7a0b\u6a21\u578b\uff0c\u8fd9\u610f\u5473\u7740\uff0c\u6bcf\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\u5c31\u4f1a\u521b\u5efa\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u8fd9\u4e0d\u4f46\u5b58\u5728\u8fdb\u7a0b\u521b\u5efa\u7684\u5f00\u9500\u3002</p> <p>\u800c\u4e14\u8fdb\u7a0b\u4e4b\u95f4\u76f8\u4e92\u5207\u6362\u4ea7\u751f\u7684\u4e0a\u4e0b\u6587\u5f00\u9500\u4e5f\u975e\u5e38\u8017\u8d39 CPU \u8d44\u6e90\uff0c\u5bfc\u81f4\u8fd9\u79cd\u4f20\u7edf\u7684\u670d\u52a1\u5668\u5728\u9762\u5bf9\u6210\u5343\u4e0a\u4e07\u7684\u5e76\u53d1\u8fde\u63a5\u65f6\uff0c\u6027\u80fd\u975e\u5e38\u4f4e\u4e0b\uff0c\u800c\u8fd9\u662f\u5feb\u901f\u53d1\u5c55\u7684\u4e92\u8054\u7f51\u6240\u4e0d\u80fd\u591f\u5fcd\u53d7\u7684\u3002</p> <p>\u5728\u8fd9\u79cd\u80cc\u666f\u4e0b\uff0cNginx \u91c7\u7528\u7684\u662f\u8fdb\u7a0b\u6c60\u548c epoll \u5904\u7406\u6a21\u578b\uff0c\u8fd9\u4e8c\u8005\u52a0\u8d77\u6765\u4f7f\u5f97 Nginx \u7684\u6027\u80fd\u975e\u5e38\u4f18\u5f02\uff0c\u4e00\u53f0 32 \u6838\u7684\u673a\u5668\u4e0a\u53ef\u4ee5\u652f\u6491\u6570\u5343\u4e07\u7684\u5e76\u53d1\u8fde\u63a5\u3002</p> <p>Nginx\u670d\u52a1\u5668\u7684\u4e00\u4e2a\u663e\u8457\u4f18\u52bf\u662f\u80fd\u591f\u540c\u65f6\u5904\u7406\u5927\u91cf\u5e76\u53d1\u8bf7\u6c42\u3002\u5b83\u7ed3\u5408\u591a\u8fdb\u7a0b\u673a\u5236\u548c\u5f02\u6b65\u673a\u5236\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u5f02\u6b65\u673a\u5236\u4f7f\u7528\u7684\u662f\u5f02\u6b65\u975e\u963b\u585e\u65b9\u5f0f</p> <p>Nginx \u6709\u4e00\u4e2a master \u8fdb\u7a0b\u548c\u82e5\u5e72\u4e2a worker \u8fdb\u7a0b\u3002master \u8fdb\u7a0b\u662f\u7528\u6765\u7ba1\u7406 worker \u8fdb\u7a0b\u7684\uff0cworker \u8fdb\u7a0b\u8d1f\u8d23\u5904\u7406\u5177\u4f53\u7684\u8bf7\u6c42\uff0cworker \u8fdb\u7a0b\u662f master \u8fdb\u7a0b\u7684\u5b50\u8fdb\u7a0b\u3002\u5176\u4e2d\u53ef\u4ee5\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u4ea7\u751f\u7684\u5de5\u4f5c\u8fdb\u7a0b\u6570\u91cf\u3002</p> <p>Nginx\u670d\u52a1\u5668\u7684\u6240\u6709\u5de5\u4f5c\u8fdb\u7a0b\u90fd\u7528\u4e8e\u63a5\u6536\u548c\u5904\u7406\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u3002\u8fd9\u7c7b\u4f3c\u4e8eApache\u4f7f\u7528\u7684\u6539\u8fdb\u7684\u591a\u8fdb\u7a0b\u673a\u5236\uff0c\u9884\u5148\u751f\u6210\u591a\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\uff0c\u7b49\u5f85\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42\u3002</p> <p>\u6bcf\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u4f7f\u7528\u4e86\u5f02\u6b65\u975e\u963b\u585e\u65b9\u5f0f\uff0c\u53ef\u4ee5\u5904\u7406\u591a\u4e2a\u5ba2\u6237\u7aef\u8bf7\u3002\u5f53\u67d0\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u63a5\u6536\u5230\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u4ee5\u540e\uff0c\u8c03\u7528IO\u8fdb\u884c\u5904\u7406\uff0c\u5982\u679c\u4e0d\u80fd\u7acb\u5373\u5f97\u5230\u7ed3\u679c\uff0c\u5c31\u53bb\u5904\u7406\u5176\u4ed6\u7684\u8bf7\u6c42\uff1b</p> <p>\u800c\u5ba2\u6237\u7aef\u5728\u6b64\u671f\u95f4\u4e1a\u52a1\u9700\u7b49\u5f85\u54cd\u5e94\uff0c\u53ef\u4ee5\u53bb\u5904\u7406\u5176\u4ed6\u7684\u4e8b\u60c5\uff1b\u5f53IO\u8c03\u7528\u8fd4\u56de\u7ed3\u679c\u65f6\uff0c\u5c31\u4f1a\u901a\u77e5\u6b64\u5de5\u4f5c\u8fdb\u7a0b\uff1b\u8be5\u8fdb\u7a0b\u7684\u5230\u901a\u77e5\uff0c\u6682\u65f6\u6302\u8d77\u5f53\u524d\u5904\u7406\u7684\u4e8b\u52a1\uff0c\u53bb\u54cd\u5e94\u5ba2\u6237\u7aef\u8bf7\u6c42\u3002</p> <p>\u5ba2\u6237\u7aef\u8bf7\u6c42\u6570\u91cf\u589e\u957f\u3001\u7f51\u7edc\u8d1f\u8f7d\u7e41\u91cd\u65f6\uff0cNginx\u670d\u52a1\u5668\u4f7f\u7528\u591a\u8fdb\u7a0b\u673a\u5236\u80fd\u591f\u4fdd\u8bc1\u4e0d\u589e\u957f\u5bf9\u7cfb\u7edf\u8d44\u6e90\u7684\u538b\u529b\uff1b\u540c\u65f6\u4f7f\u7528\u5f02\u6b65\u975e\u963b\u585e\u65b9\u5f0f\u51cf\u5c11\u4e86\u5de5\u4f5c\u8fdb\u7a0b\u5728I/O\u8c03\u7528\u4e0a\u7684\u963b\u585e\u5ef6\u8fdf\uff0c\u4fdd\u8bc1\u4e86\u4e0d\u964d\u4f4e\u5bf9\u8bf7\u6c42\u7684\u5904\u7406\u80fd\u529b\u3002</p>"},{"location":"Introduction/%E5%88%9D%E5%AD%A6%E8%80%85%E6%8C%87%E5%8D%97/#nginx_1","title":"Nginx \u53ca\u5176\u5468\u8fb9","text":"<p>\u4ecb\u7ecd\u5b8c Nginx \u7684\u80cc\u666f\uff0c\u6211\u4eec\u5c31\u8be5\u8bf4\u8bf4 Nginx \u5468\u8fb9\u4e86\u3002\u76ee\u524d\u57fa\u4e8e Nginx \u4e8c\u6b21\u5f00\u53d1\u7684\u8f6f\u4ef6\u4e3b\u8981\u5982\u4e0b\uff1a</p> <ul> <li>Nginx\uff0c\u4e3b\u8981\u5305\u542b\u5305\u542b\u5f00\u6e90\u7248\u548c\u5546\u4e1a\u7248</li> <li>Tengine\uff0cTengine \u662f\u7531\u6dd8\u5b9d\u7f51\u53d1\u8d77\u7684 Web \u670d\u52a1\u5668\u9879\u76ee\uff0c\u76ee\u524d\u5df2\u7ecf\u5f00\u6e90\u3002</li> <li>OpenResty\uff0cOpenResty \u901a\u8fc7 Lua \u5bf9 Nginx \u8fdb\u884c\u6269\u5c55\uff0c\u4f7f\u5f97\u6269\u5c55 Nginx \u6a21\u5757\u53d8\u5f97\u5f02\u5e38\u8f7b\u677e</li> <li>kong\uff0cKong Gateway (OSS) \uff0cKong\u662f\u4e00\u4e2a\u4e91\u539f\u751f\uff0c\u5feb\u901f\uff0c\u53ef\u6269\u5c55\u548c\u5206\u5e03\u5f0f\u5fae\u670d\u52a1\u7684\u5f00\u6e90API\u7f51\u5173\u3002</li> <li>apisix\uff0cApache APISIX \u662f\u4e00\u4e2a\u52a8\u6001\u3001\u5b9e\u65f6\u3001\u9ad8\u6027\u80fd\u7684\u4e91\u539f\u751f API \u7f51\u5173\uff0c\u63d0\u4f9b\u4e86\u8d1f\u8f7d\u5747\u8861\u3001\u52a8\u6001\u4e0a\u6e38\u3001\u7070\u5ea6\u53d1\u5e03\u3001\u670d\u52a1\u7194\u65ad\u3001\u8eab\u4efd\u8ba4\u8bc1\u7b49\u529f\u80fd\u3002</li> </ul> <p>\u9488\u5bf9\u6211\u4eec\u65e5\u5e38\u5de5\u4f5c\u5b66\u4e60\u6765\u8bf4\uff0c\u9009\u62e9\u5b98\u65b9\u5f00\u6e90\u7248\u7684 Nginx \u6216\u8005 OpenResty \u5c31\u53ef\u4ee5\u4e86\u3002</p>"},{"location":"Introduction/%E5%88%9D%E5%AD%A6%E8%80%85%E6%8C%87%E5%8D%97/#nginx_2","title":"Nginx \u7248\u672c\u7b56\u7565","text":"<p>\u5728 Nginx \u7684\u5f00\u6e90\u4ee3\u7801\u5e93\u4e2d\uff0c\u6709\u4e24\u79cd\u5206\u652f\uff0c\u5206\u522b\u662f mainline \u548c stable\u3002\u4e0eLinux\u5185\u6838\u7248\u672c\u53f7\u7c7b\u4f3c\uff0cnginx\u7684\u7248\u672c\u53f7\u4e5f\u4f7f\u7528\u5947\u6570\u5076\u6570\u533a\u5206\u5f00\u53d1\u7248\u672c\uff08\u4e3b\u7ebf\u7248\u672c\uff09\u4e0e\u7a33\u5b9a\u7248\u672c\u3002</p> <ul> <li>Mainline \u76f8\u5f53\u4e8e\u5f00\u53d1\u5206\u652f\uff0c\u66f4\u65b0\u6bd4\u8f83\u6d3b\u8dc3\uff0c\u5305\u542b\u5f15\u5165\u4e00\u4e9b\u65b0\u7684\u529f\u80fd\u6216\u8005bug\u4fee\u590d\uff0c\u7248\u672c\u53f7\u7684\u7b2c\u4e8c\u4e2a\u6570\u5b57\u5982\u679c\u662f\u5947\u6570\uff0c\u90a3\u5c31\u662f Mainline \u7248\u672c\uff0c\u6bd4\u5982 1.17.0\u3002</li> <li>Stable \u5206\u652f\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u5c31\u662f\u76f8\u5bf9\u7a33\u5b9a\u7684\u7248\u672c\uff0c\u9664\u975e\u6709\u91cd\u5927Bug\uff0c\u5426\u5219\u5728\u5b83\u7684\u751f\u547d\u5468\u671f\u5185\u4e0d\u4f1a\u66f4\u65b0\uff0c\u7248\u672c\u53f7\u7684\u7b2c\u4e8c\u4e2a\u6570\u5b57\u5982\u679c\u662f\u5076\u6570\uff0c\u90a3\u5c31\u662f Mainline \u7248\u672c\uff0c\u6bd4\u5982 1.16.0\u3002</li> </ul> <p>\u4e3b\u7ebf\u5206\u652f\u4e0a\u8fdb\u884c\u65b0\u529f\u80fd\u5f00\u53d1\u548cbug\u4fee\u590d\u3002\u4f1a\u5b9a\u671f\u53d1\u5e03\uff0c\u51e0\u4e4e\u6bcf\u4e2a\u6708\u90fd\u80fd\u770b\u5230\u65b0\u7684\u4e3b\u7ebf\u53d1\u5e03\u7248\u672c\u3002</p> <p>\u7279\u522b\u6ce8\u610f\uff0c\u7a33\u5b9a\u7248\u672c\u4e0e\u5f00\u53d1\u7248\u672c\u5e76\u4e0d\u662f\u8f6f\u4ef6\u8d28\u91cf\u4e0a\u7684\u533a\u522b\uff0c\u53ea\u662f\u7279\u6027\u66f4\u65b0\u9891\u7387\u7684\u533a\u522b\u3002</p> <p>\u5bf9\u4e8e NGINX \u5f00\u6e90\uff0c\u201c\u7a33\u5b9a\u201d\u4e00\u8bcd\u6307\u7684\u662f\u529f\u80fd\u548c\u66f4\u65b0\u9891\u7387\uff0c\u800c\u4e0d\u662f\u8f6f\u4ef6\u8d28\u91cf\u3002\u7a33\u5b9a\u5206\u652f\u5728\u5176\u751f\u547d\u5468\u671f\u4e2d\u4ece\u4e0d\u63a5\u6536\u65b0\u529f\u80fd\uff0c\u901a\u5e38\u53ea\u63a5\u6536\u4e00\u4e24\u4e2a\u66f4\u65b0\uff0c\u7528\u4e8e\u5173\u952e\u9519\u8bef\u4fee\u590d\u3002</p> <p>stable \u7248\u672c\u4ee3\u8868\u529f\u80fd\u591a\u5c11\u548c\u66f4\u65b0\u9891\u7387\uff0c\u548c\u8f6f\u4ef6\u8d28\u91cf\u6ca1\u6709\u592a\u5927\u7684\u5173\u7cfb\uff08\u5f53\u7136\u4efb\u4f55\u8f6f\u4ef6\u90fd\u4f1a\u6709Bug\uff09\u3002</p> <p>\u5728\u6bcf\u5e744\u6708\u4efd\u4f1a\u53d1\u5e03\u4e00\u6b21\uff0c\u5b83\u7684\u751f\u547d\u5468\u671f\u662f\u4e00\u5e74\uff0c\u5728\u8fd9\u6bb5\u65f6\u95f4\u5185\uff0c\u4e00\u822c\u60c5\u51b5\u4e0d\u4f1a\u66f4\u65b0\u7248\u672c\u53f7\uff08\u9664\u975e\u6709\u91cd\u5927Bug\uff09\u3002</p> <p>https://www.cnblogs.com/91donkey/p/11639355.html</p>"},{"location":"Introduction/%E5%88%9D%E5%AD%A6%E8%80%85%E6%8C%87%E5%8D%97/#_3","title":"\u3010\u5982\u4f55\u9009\u62e9\u5206\u652f\u3011","text":"<p>\u901a\u8fc7\u4ee5\u4e0a\u7248\u672c\u7b56\u7565\u63cf\u8ff0\uff0c\u4e3b\u7ebf\u7248\u672c\u4e0e\u7a33\u5b9a\u7248\u672c\u53ea\u5b58\u5728\u7279\u6027\u4e0a\u7684\u4e0d\u540c\uff0c\u5bf9\u4e8e\u8f6f\u4ef6\u8d28\u91cf\u8981\u6c42\u90fd\u662f\u4e00\u81f4\u7684\u3002\u6240\u4ee5\u5b98\u65b9\u7684\u63a8\u8350\u662f\u5c3d\u91cf\u4f7f\u7528\u4e3b\u7ebf\u7248\u672c\u3002 \u540c\u65f6Nginx\u7684\u5546\u4e1a\u7248\u672c\uff08NGINX Plus\uff09\u4e5f\u603b\u662f\u57fa\u4e8e\u6700\u8fd1\u7684\u4e3b\u7ebf\u7248\u672c\uff0c\u5e76\u52a0\u5165\u95ed\u6e90\u7684\u90e8\u5206\u4ee3\u7801\uff0c\u5f62\u6210\u5546\u4e1a\u7248\u672c\u63d0\u4f9b\u670d\u52a1\u3002 \u4f46\u662f\u7531\u4e8e\u4e3b\u7ebf\u7248\u672c\u7684\u66f4\u65b0\u5468\u671f\u8f83\u5feb\uff0c\u5982\u679c\u7d27\u8ddf\u4e3b\u7ebf\u7248\u672c\u6709\u56f0\u96be\uff0c\u53ef\u4ee5\u9009\u62e9\u8ddf\u8fdb\u7a33\u5b9a\u7248\u672c\uff0c\u6bcf\u5e74\u505a\u4e00\u6b21\u5927\u7684\u66f4\u65b0\u3002 \u5728\u6211\u4e2a\u4eba\u7684\u5de5\u4f5c\u4e2d\uff0c\u6211\u4eec\u56e2\u961f\u4ea4\u4ed8\u7684\u7ec4\u4ef6\u662f\u57fa\u4e8enginx\u8fdb\u884c\u5927\u91cf\u7684\u4e8c\u6b21\u5f00\u53d1\u3002 \u6bcf\u6708\u540c\u6b65\u4e3b\u7ebf\u7248\u672c\u5c06\u5e26\u6765\u5f88\u591a\u5de5\u4f5c\u91cf\u3002\uff08\u6211\u4eec\u5bf9nginx\u4ee3\u7801\u8fdb\u884c\u4e86\u5927\u91cf\u8c03\u6574\uff09\u6240\u4ee5\u6211\u4eec\u91c7\u53d6\u4e862\u4e2a\u6d3b\u52a8\uff0c\u4fdd\u969c\u7ec4\u4ef6\u4e0e\u5b98\u65b9\u4ee3\u7801\u7684\u540c\u6b65\uff0c\u66f4\u597d\u5730\u5229\u7528\u5f00\u6e90\u8f6f\u4ef6\u4f18\u52bf\u3002 \u8ba2\u9605NGINX\u4e3b\u7ebf\u7248\u672c\u66f4\u65b0\uff0c\u5173\u6ce8\u662f\u5426\u6709\u4e0e\u6211\u4eec\u5bc6\u5207\u76f8\u5173\u7684\u7279\u6027\u4fee\u6539\uff0c\u9009\u62e9\u6027\u540c\u6b65\u3002 \u6bcf\u5e74\u540c\u6b65\u4e00\u6b21\u7a33\u5b9a\u7248\u672c\uff0c\u9632\u6b62\u8fc7\u5927\u7684\u5dee\u5f02\u5bfc\u81f4\u5931\u53bb\u5f00\u6e90\u652f\u6301\u3002</p>"},{"location":"Introduction/%E5%88%9D%E5%AD%A6%E8%80%85%E6%8C%87%E5%8D%97/#_4","title":"\u542f\u52a8\u3001\u505c\u6b62\u548c\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e","text":"<p>\u8981\u542f\u52a8 nginx\uff0c\u9700\u8981\u8fd0\u884c\u53ef\u6267\u884c\u6587\u4ef6\u3002nginx \u542f\u52a8\u4e4b\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528\u53ef\u6267\u884c\u6587\u4ef6\u9644\u5e26 <code>-s \u53c2\u6570</code> \u6765\u63a7\u5236\u5b83\u3002 \u4f7f\u7528\u4ee5\u4e0b\u8bed\u6cd5\uff1a</p> <pre><code>nginx -s \u4fe1\u53f7\n</code></pre> <p>\u4fe1\u53f7\u53ef\u80fd\u662f\u4ee5\u4e0b\u4e4b\u4e00\uff1a</p> <ul> <li>stop - \u7acb\u5373\u5173\u95ed</li> <li>quit - \u6b63\u5e38\u5173\u95ed</li> <li>reload - \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6</li> <li>reopen - \u91cd\u65b0\u6253\u5f00\u65e5\u5fd7\u6587\u4ef6</li> </ul> <p>\u4f8b\u5982\uff0c\u8981\u7b49\u5f85\u5de5\u4f5c\u8fdb\u7a0b\u5904\u7406\u5b8c\u5f53\u524d\u7684\u8bf7\u6c42\u624d\u505c\u6b62 nginx \u8fdb\u7a0b\uff0c\u53ef\u4ee5\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>nginx -s quit\n</code></pre> <p>\u8fd9\u4e2a\u547d\u4ee4\u7684\u6267\u884c\u7528\u6237\u5e94\u8be5\u662f\u4e0e\u542f\u52a8nginx\u7528\u6237\u662f\u4e00\u81f4\u7684</p> <p>\u5728\u5c06\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u7684\u547d\u4ee4\u53d1\u9001\u5230 nginx \u6216\u91cd\u65b0\u542f\u52a8\u4e4b\u524d\uff0c\u914d\u7f6e\u6587\u4ef6\u6240\u505a\u7684\u5185\u5bb9\u66f4\u6539\u5c06\u4e0d\u4f1a\u751f\u6548\u3002\u8981\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\uff0c\u8bf7\u6267\u884c\uff1a</p> <pre><code>nginx -s reload\n</code></pre> <p>\u4e00\u65e6\u4e3b\u8fdb\u7a0b\uff08Master\uff09\u6536\u5230\u8981\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\uff08reload\uff09\u7684\u4fe1\u53f7\uff0c\u5b83\u5c06\u68c0\u67e5\u65b0\u914d\u7f6e\u6587\u4ef6\u7684\u8bed\u6cd5\u6709\u6548\u6027\uff0c\u5e76\u5c1d\u8bd5\u5e94\u7528\u5176\u4e2d\u63d0\u4f9b\u7684\u914d\u7f6e\u3002\u5982\u679c\u6210\u529f\uff0c\u4e3b\u8fdb\u7a0b\u5c06\u542f\u52a8\u65b0\u7684\u5de5\u4f5c\u8fdb\u7a0b\uff08Worker\uff09\uff0c\u5e76\u5411\u65e7\u5de5\u4f5c\u8fdb\u7a0b\u53d1\u9001\u6d88\u606f\uff0c\u8bf7\u6c42\u5b83\u4eec\u5173\u95ed\u3002\u5426\u5219\uff0c\u4e3b\u8fdb\u7a0b\u56de\u6eda\u66f4\u6539\uff0c\u5e76\u7ee7\u7eed\u4f7f\u7528\u65e7\u914d\u7f6e\u3002\u65e7\u5de5\u4f5c\u8fdb\u7a0b\u63a5\u6536\u5230\u5173\u95ed\u547d\u4ee4\u540e\uff0c\u505c\u6b62\u63a5\u53d7\u65b0\u7684\u8bf7\u6c42\u8fde\u63a5\uff0c\u5e76\u7ee7\u7eed\u7ef4\u62a4\u5f53\u524d\u8bf7\u6c42\uff0c\u76f4\u5230\u8fd9\u4e9b\u8bf7\u6c42\u90fd\u88ab\u5904\u7406\u5b8c\u6210\u4e4b\u540e\uff0c\u65e7\u5de5\u4f5c\u8fdb\u7a0b\u5c06\u9000\u51fa\u3002</p> <p>\u53ef\u4ee5\u501f\u52a9 Unix \u5de5\u5177\uff08\u5982 kill \u5de5\u5177\uff09\u5c06\u4fe1\u53f7\u53d1\u9001\u5230 nginx \u8fdb\u7a0b\uff0c\u4fe1\u53f7\u76f4\u63a5\u53d1\u9001\u5230\u6307\u5b9a\u8fdb\u7a0b ID \u7684\u8fdb\u7a0b\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnginx \u4e3b\u8fdb\u7a0b\u7684\u8fdb\u7a0b ID \u662f\u5199\u5165\u5728 <code>/usr/local/nginx/logs</code> \u6216 <code>/var/run</code> \u4e2d\u7684 nginx.pid \u6587\u4ef6\u4e2d\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4e3b\u8fdb\u7a0b ID \u4e3a 1628\uff0c\u5219\u53d1\u9001 QUIT \u4fe1\u53f7\u8ba9 nginx \u6b63\u5e38\u5e73\u6ed1\u5173\u95ed\uff0c\u53ef\u6267\u884c\uff1a</p> <pre><code>kill -s QUIT 1628\n</code></pre> <p>\u83b7\u53d6\u6240\u6709\u6b63\u5728\u8fd0\u884c\u7684 nginx \u8fdb\u7a0b\u5217\u8868\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>ps</code> \u547d\u4ee4\uff0c\u5982\u4e0b\uff1a</p> <pre><code>ps -ax | grep nginx\n</code></pre> <p>\u6709\u5173\u5411 nginx \u53d1\u9001\u4fe1\u53f7\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 \u63a7\u5236 nginx\u3002</p>"},{"location":"Introduction/%E5%88%9D%E5%AD%A6%E8%80%85%E6%8C%87%E5%8D%97/#_5","title":"\u914d\u7f6e\u6587\u4ef6\u7ed3\u6784","text":"<p>nginx \u662f\u7531\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u7684\u6307\u4ee4\u63a7\u5236\u6a21\u5757\u7ec4\u6210\u3002\u6307\u4ee4\u53ef\u5206\u4e3a\u7b80\u5355\u6307\u4ee4\u548c\u5757\u6307\u4ee4\u3002\u4e00\u4e2a\u7b80\u5355\u7684\u6307\u4ee4\u662f\u7531\u7a7a\u683c\u5206\u9694\u7684\u540d\u79f0\u548c\u53c2\u6570\u7ec4\u6210\uff0c\u5e76\u4ee5\u5206\u53f7 <code>;</code> \u7ed3\u5c3e\u3002\u5757\u6307\u4ee4\u5177\u6709\u4e0e\u7b80\u5355\u6307\u4ee4\u76f8\u540c\u7684\u7ed3\u6784\uff0c\u4f46\u4e0d\u662f\u4ee5\u5206\u53f7\u7ed3\u5c3e\uff0c\u800c\u662f\u4ee5\u5927\u62ec\u53f7<code>{}</code>\u5305\u56f4\u7684\u4e00\u7ec4\u9644\u52a0\u6307\u4ee4\u7ed3\u5c3e\u3002\u5982\u679c\u5757\u6307\u4ee4\u7684\u5927\u62ec\u53f7\u5185\u90e8\u53ef\u4ee5\u6709\u5176\u5b83\u6307\u4ee4\uff0c\u5219\u79f0\u8fd9\u4e2a\u5757\u6307\u4ee4\u4e3a\u4e0a\u4e0b\u6587\uff08\u4f8b\u5982\uff1aevents\uff0chttp\uff0cserver \u548c location\uff09\u3002</p> <p>\u914d\u7f6e\u6587\u4ef6\u4e2d\u88ab\u653e\u7f6e\u5728\u4efb\u4f55\u4e0a\u4e0b\u6587\u4e4b\u5916\u7684\u6307\u4ee4\u90fd\u88ab\u8ba4\u4e3a\u662f\u4e3b\u4e0a\u4e0b\u6587 main\u3002<code>events</code> \u548c <code>http</code> \u6307\u4ee4\u5728\u4e3b <code>main</code> \u4e0a\u4e0b\u6587\u4e2d\uff0c<code>server</code> \u5728 <code>http</code> \u4e2d\uff0c<code>location</code> \u53c8\u5728 <code>server</code> \u4e2d\u3002</p> <p>\u4e95\u53f7 <code>#</code> \u4e4b\u540e\u7684\u884c\u7684\u5185\u5bb9\u88ab\u89c6\u4e3a\u6ce8\u91ca\u3002</p>"},{"location":"Introduction/%E5%88%9D%E5%AD%A6%E8%80%85%E6%8C%87%E5%8D%97/#_6","title":"\u63d0\u4f9b\u9759\u6001\u5185\u5bb9\u670d\u52a1","text":"<p>Web \u670d\u52a1\u5668\u7684\u4e00\u4e2a\u91cd\u8981\u4efb\u52a1\u662f\u63d0\u4f9b\u6587\u4ef6\uff08\u6bd4\u5982\u56fe\u7247\u6216\u8005\u9759\u6001 HTML \u9875\u9762\uff09\u670d\u52a1\u3002\u60a8\u5c06\u5b9e\u73b0\u4e00\u4e2a\u793a\u4f8b\uff0c\u6839\u636e\u8bf7\u6c42\uff0c\u5c06\u63d0\u4f9b\u6765\u81ea\u4e0d\u540c\u7684\u672c\u5730\u76ee\u5f55\u7684\u6587\u4ef6\uff1a <code>/data/www</code>\uff08\u53ef\u80fd\u5305\u542b HTML \u6587\u4ef6\uff09\u548c <code>/data/images</code>\uff08\u5305\u542b\u56fe\u7247\uff09\u3002\u8fd9\u9700\u8981\u7f16\u8f91\u914d\u7f6e\u6587\u4ef6\uff0c\u5728 <code>http</code> \u4e2d\u914d\u7f6e\u4e00\u4e2a\u5305\u542b\u4e24\u4e2a <code>location</code> \u5757\u7684 <code>server</code> \u5757\u6307\u4ee4\u3002</p> <p>\u9996\u5148\uff0c\u521b\u5efa <code>/data/www</code> \u76ee\u5f55\u5c06\u5305\u542b\u4efb\u4f55\u6587\u672c\u5185\u5bb9\u7684 <code>index.html</code> \u6587\u4ef6\u653e\u5165\u5176\u4e2d\uff0c\u521b\u5efa <code>/data/images</code> \u76ee\u5f55\u7136\u540e\u653e\u4e00\u4e9b\u56fe\u7247\u8fdb\u53bb\u3002</p> <p>\u5176\u6b21\uff0c\u6253\u5f00\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c \u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u5df2\u7ecf\u5305\u542b\u51e0\u4e2a\u670d\u52a1\u5668\u5757\u793a\u4f8b\uff0c\u5927\u90e8\u5206\u662f\u5df2\u7ecf\u6ce8\u91ca\u6389\u7684\u3002\u73b0\u5728\u6ce8\u91ca\u6389\u8fd9\u4e9b\u5757\u5e76\u4e14\u542f\u52a8\u4e00\u4e2a\u65b0\u7684 <code>server</code> \u5757\u3002</p> <pre><code>http {\nserver {\n}\n}\n</code></pre> <p>\u901a\u5e38\uff0c\u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u5305\u542b\u51e0\u4e2a\u7531\u76d1\u542c listen \u7aef\u53e3\u548c\u670d\u52a1\u5668\u57df\u540d server names \u533a\u5206\u7684 <code>server</code> \u5757\u6307\u4ee4 distinguished\u3002\u4e00\u65e6 nginx \u51b3\u5b9a\u7531\u54ea\u4e2a <code>server</code> \u6765\u5904\u7406\u8bf7\u6c42\uff0c\u5b83\u4f1a\u6839\u636e <code>server</code> \u5757\u4e2d\u5b9a\u4e49\u7684 <code>location</code> \u6307\u4ee4\u7684\u53c2\u6570\u6765\u68c0\u9a8c\u8bf7\u6c42\u5934\u4e2d\u6307\u5b9a\u7684URI\u3002</p> <p>\u6dfb\u52a0\u5982\u4e0b <code>location</code> \u5757\u6307\u4ee4\u5230 <code>server</code> \u5757\u6307\u4ee4\u4e2d\uff1a</p> <pre><code>location / {\nroot /data/www;\n}\n</code></pre> <p>\u8be5 <code>location</code> \u5757\u6307\u4ee4\u6307\u5b9a <code>/</code> \u524d\u7f00\u4e0e\u8bf7\u6c42\u4e2d\u7684 URI \u76f8\u6bd4\u8f83\u3002\u5bf9\u4e8e\u5339\u914d\u7684\u8bf7\u6c42\uff0cURI \u5c06\u88ab\u6dfb\u52a0\u5230\u6839\u6307\u4ee4 root \u4e2d\u6307\u5b9a\u7684\u8def\u5f84\uff0c\u5373 <code>/data/ www</code>\uff0c\u4ee5\u5f62\u6210\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4e0a\u6240\u8bf7\u6c42\u6587\u4ef6\u7684\u8def\u5f84\u3002\u5982\u679c\u6709\u51e0\u4e2a\u5339\u914d\u4e0a\u7684 <code>location</code> \u5757\u6307\u4ee4\uff0cnginx \u5c06\u9009\u62e9\u5177\u6709\u6700\u957f\u524d\u7f00\u7684 <code>location</code> \u5757\u3002\u4e0a\u9762\u7684\u4f4d\u7f6e\u5757\u63d0\u4f9b\u6700\u77ed\u7684\u524d\u7f00\uff0c\u957f\u5ea6\u4e3a 1\uff0c\u56e0\u6b64\u53ea\u6709\u5f53\u6240\u6709\u5176\u5b83 <code>location</code> \u5757\u4e0d\u80fd\u5339\u914d\u65f6\uff0c\u624d\u4f1a\u4f7f\u7528\u8be5\u5757\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6dfb\u52a0\u7b2c\u4e8c\u4e2a <code>location</code> \u6307\u4ee4\u5feb\uff1a</p> <pre><code>location /images/ {\nroot /data;\n}\n</code></pre> <p>\u4ee5 <code>/images/</code> \u4e3a\u5f00\u5934\u7684\u8bf7\u6c42\u5c06\u4f1a\u88ab\u5339\u914d\u4e0a\uff08\u867d\u7136 <code>location /</code> \u4e5f\u80fd\u5339\u914d\u4e0a\u6b64\u8bf7\u6c42\uff0c\u4f46\u662f\u5b83\u7684\u524d\u7f00\u66f4\u77ed\uff09</p> <p>\u6700\u540e\uff0c<code>server</code> \u5757\u6307\u4ee4\u5e94\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>server {\nlocation / {\nroot /data/www;\n}\n\nlocation /images/ {\nroot /data;\n}\n}\n</code></pre> <p>\u8fd9\u5df2\u7ecf\u662f\u4e00\u4e2a\u76d1\u542c\u6807\u51c6 80 \u7aef\u53e3\u5e76\u4e14\u53ef\u4ee5\u5728\u672c\u5730\u673a\u5668\u4e0a\u901a\u8fc7 <code>http://localhost/</code> \u5730\u5740\u6765\u8bbf\u95ee\u7684\u6709\u6548\u914d\u7f6e\u3002\u54cd\u5e94\u4ee5 <code>/images/</code> \u5f00\u5934\u7684URI\u8bf7\u6c42\uff0c\u670d\u52a1\u5668\u5c06\u4ece <code>/data/images</code> \u76ee\u5f55\u53d1\u9001\u6587\u4ef6\u3002\u4f8b\u5982\uff0c\u54cd\u5e94<code>http://localhost/images/example.png</code> \u8bf7\u6c42\uff0cnginx \u5c06\u53d1\u9001 <code>/data/images/example.png</code> \u6587\u4ef6\u3002\u5982\u679c\u6b64\u6587\u4ef6\u4e0d\u5b58\u5728\uff0cnginx \u5c06\u53d1\u9001\u4e00\u4e2a404\u9519\u8bef\u54cd\u5e94\u3002\u4e0d\u4ee5 <code>/ images/</code> \u5f00\u5934\u7684 URI \u7684\u8bf7\u6c42\u5c06\u6620\u5c04\u5230 <code>/data/www</code> \u76ee\u5f55\u3002\u4f8b\u5982\uff0c\u54cd\u5e94 <code>http://localhost/some/example.html</code> \u8bf7\u6c42\uff0cnginx \u5c06\u53d1\u9001 <code>/data/www/some/example.html</code> \u6587\u4ef6\u3002</p> <p>\u8981\u8ba9\u65b0\u914d\u7f6e\u7acb\u523b\u751f\u6548\uff0c\u5982\u679c nginx \u5c1a\u672a\u542f\u52a8\u53ef\u4ee5\u542f\u52a8\u5b83\uff0c\u5426\u5219\u901a\u8fc7\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u5c06\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u4fe1\u53f7\u53d1\u9001\u5230 nginx \u7684\u4e3b\u8fdb\u7a0b\uff1a</p> <pre><code>nginx -s reload\n</code></pre> <p>\u5982\u679c\u8fd0\u884c\u7684\u6548\u679c\u6ca1\u6709\u5728\u9884\u671f\u4e4b\u4e2d\uff0c\u60a8\u53ef\u4ee5\u5c1d\u8bd5\u4ece <code>/usr/local/nginx/logs</code> \u6216 <code>/var/log/ nginx</code> \u4e2d\u7684 <code>access.log</code> \u548c <code>error.log</code> \u65e5\u5fd7\u6587\u4ef6\u4e2d\u67e5\u627e\u539f\u56e0\u3002</p>"},{"location":"Introduction/%E5%88%9D%E5%AD%A6%E8%80%85%E6%8C%87%E5%8D%97/#_7","title":"\u8bbe\u7f6e\u4e00\u4e2a\u7b80\u5355\u7684\u4ee3\u7406\u670d\u52a1\u5668","text":"<p>nginx \u7684\u4e00\u4e2a\u5e38\u89c1\u7528\u9014\u662f\u4f5c\u4e3a\u4e00\u4e2a\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u4f5c\u7528\u662f\u63a5\u6536\u8bf7\u6c42\u5e76\u8f6c\u53d1\u7ed9\u88ab\u4ee3\u7406\u7684\u670d\u52a1\u5668\uff0c\u4ece\u4e2d\u53d6\u5f97\u54cd\u5e94\uff0c\u5e76\u5c06\u5176\u53d1\u9001\u56de\u5ba2\u6237\u7aef\u3002</p> <p>\u6211\u4eec\u5c06\u914d\u7f6e\u4e00\u4e2a\u57fa\u672c\u7684\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u5b83\u4e3a\u56fe\u7247\u8bf7\u6c42\u63d0\u4f9b\u7684\u6587\u4ef6\u6765\u81ea\u672c\u5730\u76ee\u5f55\uff0c\u5e76\u5c06\u6240\u6709\u5176\u5b83\u8bf7\u6c42\u53d1\u9001\u7ed9\u4ee3\u7406\u7684\u670d\u52a1\u5668\u3002\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u4e24\u4e2a\u670d\u52a1\u5668\u5728\u5355\u4e2a nginx \u5b9e\u4f8b\u4e0a\u5b9a\u4e49\u3002</p> <p>\u9996\u5148\uff0c\u901a\u8fc7\u5411 nginx \u7684\u914d\u7f6e\u6587\u4ef6\u6dfb\u52a0\u4e00\u4e2a <code>server</code> \u5757\u6765\u5b9a\u4e49\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u5176\u4e2d\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>server {\nlisten 8080;\nroot /data/up1;\n\nlocation / {\n}\n}\n</code></pre> <p>\u8fd9\u662f\u4e00\u4e2a\u76d1\u542c 8080 \u7aef\u53e3\u7684\u7b80\u5355\u670d\u52a1\u5668\uff08\u4ee5\u524d\uff0c\u7531\u4e8e\u4f7f\u7528\u4e86\u6807\u51c6 80 \u7aef\u53e3\uff0c\u6240\u4ee5\u6ca1\u6709\u6307\u5b9a listen \u6307\u4ee4\uff09\uff0c\u5e76\u5c06\u6240\u6709\u8bf7\u6c42\u6620\u5c04\u5230\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u4e0a\u7684 <code>/data/up1</code> \u76ee\u5f55\u3002\u521b\u5efa\u6b64\u76ee\u5f55\u5e76\u5c06 <code>index.html</code> \u6587\u4ef6\u653e\u5165\u5176\u4e2d\u3002\u8bf7\u6ce8\u610f\uff0c<code>root</code> \u6307\u4ee4\u4f4d\u4e8e <code>server</code> \u4e0a\u4e0b\u6587\u4e2d\u3002\u5f53\u9009\u62e9\u7528\u4e8e\u5904\u7406\u8bf7\u6c42\u7684 <code>location</code> \u5757\u81ea\u8eab\u4e0d\u5305\u542b <code>root</code> \u6307\u4ee4\u65f6\uff0c\u5c06\u4f7f\u7528\u6b64 <code>root</code> \u6307\u4ee4\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5728\u4e0a\u4e00\u8282\u4e2d\u7684\u670d\u52a1\u5668\u914d\u7f6e\u57fa\u7840\u4e0a\u8fdb\u884c\u4fee\u6539\uff0c\u4f7f\u5176\u6210\u4e3a\u4ee3\u7406\u670d\u52a1\u5668\u914d\u7f6e\u3002\u5728\u7b2c\u4e00\u4e2a <code>location</code> \u5757\u4e2d\uff0c\u4f7f\u7528\u53c2\u6570\u6307\u5b9a\u7684\u4ee3\u7406\u670d\u52a1\u5668\u7684\u534f\u8bae\uff0c\u57df\u540d\u548c\u7aef\u53e3\uff08\u5728\u672c\u4f8b\u4e2d\u4e3a <code>http://localhost:8080</code>\uff09\u653e\u7f6e\u5728 proxy_pass \u6307\u4ee4\u5904\uff1a</p> <pre><code>server {\nlocation / {\nproxy_pass http://localhost:8080;\n}\n\nlocation /images/ {\nroot /data;\n}\n}\n</code></pre> <p>\u6211\u4eec\u5c06\u4fee\u6539\u4f7f\u7528\u4e86 <code>/images/</code> \u524d\u7f00\u5c06\u8bf7\u6c42\u6620\u5c04\u5230 <code>/data/images</code> \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u7684\u7b2c\u4e8c\u4e2a <code>location</code> \u5757\uff0c\u4f7f\u5176\u4e0e\u9644\u5e26\u5e38\u89c1\u7684\u56fe\u7247\u6587\u4ef6\u6269\u5c55\u540d\u7684\u8bf7\u6c42\u76f8\u5339\u914d\u3002\u4fee\u6539\u540e\u7684 <code>location</code> \u5757\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>location ~ \\.(gif|jpg|png)$ {\nroot /data/images;\n}\n</code></pre> <p>\u8be5\u53c2\u6570\u662f\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5339\u914d\u6240\u6709\u4ee5<code>.gif</code>\uff0c<code>.jpg</code> \u6216 <code>.png</code> \u7ed3\u5c3e\u7684 URI\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u4e4b\u524d\u5e94\u8be5\u662f <code>~</code>\u3002\u76f8\u5e94\u7684\u8bf7\u6c42\u5c06\u6620\u5c04\u5230 <code>/data/images</code> \u76ee\u5f55\u3002</p> <p>\u5f53 nginx \u9009\u62e9\u4e00\u4e2a <code>location</code> \u5757\u6765\u63d0\u4f9b\u8bf7\u6c42\u65f6\uff0c\u5b83\u9996\u5148\u68c0\u67e5\u6307\u5b9a\u524d\u7f00\u7684 location \u6307\u4ee4\uff0c\u8bb0\u4f4f\u5177\u6709\u6700\u957f\u524d\u7f00\u7684 <code>location</code>\uff0c\u7136\u540e\u68c0\u67e5\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u5982\u679c\u4e0e\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\uff0cnginx \u4f1a\u9009\u62e9\u6b64 <code>location</code>\uff0c\u5426\u5219\u9009\u62e9\u66f4\u65e9\u4e4b\u524d\u8bb0\u4f4f\u7684\u90a3\u4e00\u4e2a\u3002</p> <p>\u4ee3\u7406\u670d\u52a1\u5668\u7684\u6700\u7ec8\u914d\u7f6e\u5982\u4e0b\uff1a</p> <pre><code>server {\nlocation / {\nproxy_pass http://localhost:8080/;\n}\n\nlocation ~ \\.(gif|jpg|png)$ {\nroot /data/images;\n}\n}\n</code></pre> <p>\u6b64 <code>server</code> \u5c06\u8fc7\u6ee4\u4ee5 <code>.gif</code>\uff0c<code>.jpg</code> \u6216 <code>.png</code> \u7ed3\u5c3e\u7684\u8bf7\u6c42\uff0c\u5e76\u5c06\u5b83\u4eec\u6620\u5c04\u5230 <code>/data/images</code> \u76ee\u5f55\uff08\u901a\u8fc7\u5411 root \u6307\u4ee4\u7684\u53c2\u6570\u6dfb\u52a0 URI\uff09\uff0c\u5e76\u5c06\u6240\u6709\u5176\u5b83\u8bf7\u6c42\u4f20\u9012\u5230\u4e0a\u9762\u914d\u7f6e\u7684\u4ee3\u7406\u670d\u52a1\u5668\u3002</p> <p>\u8981\u4f7f\u65b0\u914d\u7f6e\u7acb\u5373\u751f\u6548\uff0c\u8bf7\u5c06\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\u4fe1\u53f7\uff08reload\uff09\u53d1\u9001\u5230 nginx\uff0c\u5982\u524d\u51e0\u8282\u6240\u8ff0\u3002</p> <p>\u8fd8\u6709\u66f4\u591a\u7684\u6307\u4ee4\u53ef\u7528\u4e8e\u8fdb\u4e00\u6b65\u914d\u7f6e\u4ee3\u7406\u8fde\u63a5\u3002</p>"},{"location":"Introduction/%E5%88%9D%E5%AD%A6%E8%80%85%E6%8C%87%E5%8D%97/#fastcgi","title":"\u8bbe\u7f6e FastCGI \u4ee3\u7406","text":"<p>nginx \u53ef\u88ab\u7528\u4e8e\u5c06\u8bf7\u6c42\u8def\u7531\u5230\u8fd0\u884c\u4e86\u4f7f\u7528\u5404\u79cd\u6846\u67b6\u548c PHP \u7b49\u7f16\u7a0b\u8bed\u8a00\u6784\u5efa\u7684\u5e94\u7528\u7a0b\u5e8f\u7684 FastCGI \u670d\u52a1\u5668\u3002</p> <p>\u4e0e FastCGI \u670d\u52a1\u5668\u534f\u540c\u5de5\u4f5c\u7684\u6700\u57fa\u672c\u7684 nginx \u914d\u7f6e\u662f\u4f7f\u7528 fastcgi_pass \u6307\u4ee4\u800c\u4e0d\u662f <code>proxy_pass</code> \u6307\u4ee4\uff0c\u4ee5\u53ca <code>fastcgi_param</code> \u6307\u4ee4\u6765\u8bbe\u7f6e\u4f20\u9012\u7ed9 FastCGI \u670d\u52a1\u5668\u7684\u53c2\u6570\u3002\u5047\u8bbe FastCGI \u670d\u52a1\u5668\u53ef\u4ee5\u5728 localhost:9000 \u4e0a\u8bbf\u95ee\u3002\u4ee5\u4e0a\u4e00\u8282\u7684\u4ee3\u7406\u914d\u7f6e\u4e3a\u57fa\u7840\uff0c\u7528 <code>fastcgi_pass</code> \u6307\u4ee4\u66ff\u6362 <code>proxy_pass</code> \u6307\u4ee4\uff0c\u5e76\u5c06\u53c2\u6570\u66f4\u6539\u4e3a <code>localhost:9000</code>\u3002\u5728 PHP \u4e2d\uff0c<code>SCRIPT_FILENAME</code> \u53c2\u6570\u7528\u4e8e\u786e\u5b9a\u811a\u672c\u540d\u79f0\uff0c<code>QUERY_STRING</code> \u53c2\u6570\u7528\u4e8e\u4f20\u9012\u8bf7\u6c42\u53c2\u6570\u3002\u6700\u7ec8\u7684\u914d\u7f6e\u5c06\u662f\uff1a</p> <pre><code>server {\nlocation / {\nfastcgi_pass  localhost:9000;\nfastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\nfastcgi_param QUERY_STRING    $query_string;\n}\n\nlocation ~ \\.(gif|jpg|png)$ {\nroot /data/images;\n}\n}\n</code></pre> <p>\u8fd9\u91cc\u8bbe\u7f6e\u4e00\u4e2a <code>server</code>\uff0c\u5c06\u9664\u4e86\u9759\u6001\u56fe\u7247\u8bf7\u6c42\u4e4b\u5916\u7684\u6240\u6709\u8bf7\u6c42\u8def\u7531\u5230\u901a\u8fc7 FastCGI \u534f\u8bae\u5728 <code>localhost:9000</code> \u4e0a\u8fd0\u884c\u7684\u4ee3\u7406\u670d\u52a1\u5668\u3002</p>"},{"location":"Introduction/%E5%88%9D%E5%AD%A6%E8%80%85%E6%8C%87%E5%8D%97/#_8","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/beginners_guide.html</li> </ul>"},{"location":"Introduction/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0/","title":"\u547d\u4ee4\u884c\u53c2\u6570","text":"<p>nginx\u652f\u6301\u4ee5\u4e0b\u547d\u4ee4\u884c\u53c2\u6570\uff1a</p> <ul> <li><code>-?</code> \u6216\u8005 <code>-h</code> \u2014\u2014 \u6253\u5370\u547d\u4ee4\u884c\u53c2\u6570\u5e2e\u52a9\u4fe1\u606f</li> <li><code>-c file</code> \u2014\u2014 \u4f7f\u7528\u6307\u5b9a\u7684\u914d\u7f6e\u6587\u4ef6\u6765\u66ff\u4ee3\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6</li> <li><code>-g directive</code> \u2014\u2014 \u8bbe\u7f6e \u5168\u5c40\u914d\u7f6e\u6307\u4ee4\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>nginx -g \"pid /var/run/nginx.pid; worker_processes `sysctl -n hw.ncpu`;\"\n</code></pre> <ul> <li><code>-p prefix</code> \u2014\u2014 \u8bbe\u7f6e nginx \u8def\u5f84\u524d\u7f00\uff0c\u6bd4\u5982\u4e00\u4e2a\u5b58\u653e\u7740\u670d\u52a1\u5668\u6587\u4ef6\u7684\u76ee\u5f55\uff08\u9ed8\u8ba4\u662f <code>/usr/local/nginx</code> \uff09\u3002</li> <li><code>-q</code> \u2014\u2014 \u5728\u914d\u7f6e\u6d4b\u8bd5\u671f\u95f4\u7981\u6b62\u975e\u9519\u8bef\u4fe1\u606f\u3002</li> <li><code>-s signal</code> \u2014\u2014 \u5411 Master \u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f7\uff0c\u4fe1\u53f7\u53c2\u6570\u53ef\u4ee5\u662f\u4ee5\u4e0b\uff1a<ul> <li><code>stop</code> \u2014\u2014 \u5feb\u901f\u5173\u95ed\u3002</li> <li><code>quit</code> \u2014\u2014 \u6b63\u5e38\u5173\u95ed\u3002</li> <li><code>reload</code> \u2014\u2014 \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\uff0c\u4f7f\u7528\u65b0\u914d\u7f6e\u540e\u542f\u52a8\u65b0\u7684 Worker \u8fdb\u7a0b\u5e76\u6b63\u5e38\u9000\u51fa\u65e7\u7684\u5de5\u4f5c\u8fdb\u7a0b\u3002</li> <li><code>reopen</code> \u2014\u2014 \u91cd\u65b0\u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\u3002</li> </ul> </li> <li><code>-t</code> \u2014\u2014 \u6d4b\u8bd5\u914d\u7f6e\u6587\u4ef6\uff1anginx \u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\u7684\u8bed\u6cd5\u6b63\u786e\u6027\uff0c\u4e4b\u540e\u5c1d\u8bd5\u6253\u5f00\u914d\u7f6e\u4e2d\u5f15\u7528\u5230\u7684\u6587\u4ef6\u3002</li> <li><code>-T</code> \u2014\u2014 \u4e0e <code>-t</code> \u4e00\u6837\uff0c\u4f46\u53e6\u5916\u5c06\u914d\u7f6e\u6587\u4ef6\u8f6c\u50a8\u5230\u6807\u51c6\u8f93\u51fa\uff081.9.2\uff09\u3002</li> <li><code>-v</code> \u2014\u2014 \u6253\u5370 nginx \u7248\u672c\u3002</li> <li><code>-V</code> \u2014\u2014 \u6253\u5370 nginx \u7248\u672c\uff0c\u7f16\u8bd1\u5668\u7248\u672c\u548c\u914d\u7f6e\u53c2\u6570\u3002</li> </ul>"},{"location":"Introduction/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0/#_2","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/switches.html</p>"},{"location":"Introduction/%E5%AE%89%E8%A3%85nginx/","title":"\u5b89\u88c5 nginx","text":"<p>nginx \u53ef\u4ee5\u4ee5\u4e0d\u540c\u7684\u65b9\u5f0f\u5b89\u88c5\uff0c\u5b89\u88c5\u65b9\u5f0f\u53d6\u51b3\u4e8e\u5f53\u524d\u7684\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <p>\u5728 Linux \u4e0a\uff0c\u5f53\u7136\u53ef\u4ee5\u4f7f\u7528 yum\u3001apt-get \u7b49\u8f6f\u4ef6\u5305\u7ba1\u7406\u5de5\u5177\u6765\u4e0b\u8f7d Nginx\uff0c\u4f46\u662f Nginx \u7684\u5f88\u591a\u6a21\u5757\u5e76\u4e0d\u662f\u9ed8\u8ba4\u5f00\u542f\u7684\uff0c\u7b2c\u4e09\u65b9\u6a21\u5757\u5f88\u591a\u4e5f\u5e76\u4e0d\u5305\u542b\u3002</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u60f3\u8981\u5f00\u542f\u5185\u7f6e\u7684\u6a21\u5757\u6216\u7f16\u8bd1\u7b2c\u4e09\u65b9\u6a21\u5757\uff0c\u8fd8\u662f\u9700\u8981\u7f16\u8bd1 Nginx\u3002</p>"},{"location":"Introduction/%E5%AE%89%E8%A3%85nginx/#linux","title":"\u5728 Linux \u4e0a\u5b89\u88c5","text":"<p>\u5bf9\u4e8e Linux\uff0c\u53ef\u4ee5\u4f7f\u7528 nginx.org \u7684 nginx \u8f6f\u4ef6\u5305\u3002</p>"},{"location":"Introduction/%E5%AE%89%E8%A3%85nginx/#freebsd","title":"\u5728 FreeBSD \u4e0a\u5b89\u88c5","text":"<p>\u5728 FreeBSD \u4e0a\uff0c\u53ef\u4ee5\u4ece \u8f6f\u4ef6\u5305 \u6216\u901a\u8fc7 ports \u7cfb\u7edf\u5b89\u88c5 nginx\u3002ports \u7cfb\u7edf\u63d0\u4f9b\u66f4\u5927\u7684\u7075\u6d3b\u6027\uff0c\u63d0\u4f9b\u4e86\u5404\u79cd\u9009\u9879\u53ef\u4f9b\u9009\u62e9\u3002port \u5c06\u4f7f\u7528\u6307\u5b9a\u7684\u9009\u9879\u7f16\u8bd1 nginx \u5e76\u8fdb\u884c\u5b89\u88c5\u3002</p>"},{"location":"Introduction/%E5%AE%89%E8%A3%85nginx/#_1","title":"\u5305\u7ba1\u7406\u5668\u5b89\u88c5","text":"<pre><code># https://www.nginx.com/resources/wiki/start/topics/tutorials/install/\n\n# \u914d\u7f6eyum\u6e90\uff1a/etc/yum.repos.d/nginx.repo \n\n# CentOS\n[nginx]\nname=nginx repo\n# \u7cfb\u7edf:CentOS7 \u67b6\u6784:x86_64\nbaseurl=https://nginx.org/packages/centos/7/x86_64/\n\n# \u7cfb\u7edf:CentOS8 \u67b6\u6784:x86_64\n# baseurl=https://nginx.org/packages/centos/7/x86_64/\n\n# \u7cfb\u7edf:RHEL7 \u67b6\u6784:x86_64\n# baseurl=https://nginx.org/packages/rhel/7/x86_64/\n\n# \u7cfb\u7edf:RHEL8 \u67b6\u6784:x86_64\n# baseurl=https://nginx.org/packages/rhel/7/x86_64/\ngpgcheck=0\nenabled=1\n</code></pre>"},{"location":"Introduction/%E5%AE%89%E8%A3%85nginx/#_2","title":"\u4ece\u6e90\u7801\u5b89\u88c5","text":"<p>\u7f16\u8bd1\u5b89\u88c5</p> <p>\u7f16\u8bd1\u5b89\u88c5\u4e00\u822c\u9002\u7528\u9ad8\u7ea7\u7528\u6237\uff0c\u5bf9Nginx\u5404\u79cd\u7279\u6027\u90fd\u975e\u5e38\u719f\u6089\u5e76\u4e14\u77e5\u9053\u81ea\u5df1\u9700\u8981\u54ea\u4e9b\u529f\u80fd\u7684\u7528\u6237\u3002\u666e\u901a\u7528\u6237\u4e00\u822c\u4f7f\u7528Linux\u53d1\u884c\u7248\u7684\u5305\u7ba1\u7406\u5668\u5b89\u88c5\u5c31\u53ef\u4ee5\u3002 \u63d0\u524d\u89c4\u5212\u597d\u7f16\u8bd1\u5b89\u88c5\u7684\u76f8\u5173\u6587\u4ef6\u8def\u5f84\uff1a</p> <ul> <li>\u53ef\u6267\u884c\u6587\u4ef6\uff1a/usr/local/nginx/sbin/</li> <li>\u8d44\u6e90\u76ee\u5f55\uff1a/usr/local/nginx/html/</li> <li>\u65e5\u5fd7\u76ee\u5f55\uff1a/usr/local/nginx/logs/</li> <li>\u914d\u7f6e\u76ee\u5f55\uff1a/usr/local/nginx/conf/</li> </ul> <p>\u5982\u679c\u9700\u8981\u67d0\u4e9b\u7279\u6b8a\u529f\u80fd\u8f6f\u4ef6\u5305\u548c ports \u65e0\u6cd5\u63d0\u4f9b\uff0c\u90a3\u4e48\u53ef\u4ee5\u4ece\u6e90\u7801\u4e2d\u7f16\u8bd1 nginx\u3002\u867d\u7136\u6b64\u65b9\u5f0f\u66f4\u52a0\u7075\u6d3b\uff0c\u4f46\u5bf9\u4e8e\u521d\u5b66\u8005\u6765\u8bf4\u53ef\u80fd\u4f1a\u5f88\u590d\u6742\u3002\u66f4\u591a\u4fe1\u606f\u8bf7\u53c2\u9605 \u4ece\u6e90\u7801\u6784\u5efa nginx\u3002</p> <pre><code># \u5b89\u88c5\u4f9d\u8d56\u73af\u5883\uff0c\u786e\u4fdd\u7f16\u8bd1\u6b63\u5e38\nsudo yum install gcc gcc-c++ make automake autoconf libtool pcre* zlib openssl openssl-devel  pcre pcre-devel\n\n# ubuntu\napt-get install build-essential libpcre3 libpcre3-dev zlib1g zlib1g-dev libssl-dev libgd-dev libxml2 libxml2-dev uuid-dev libgeoip-dev   geoip-database geoipupdate  libmaxminddb-dev\n\n# \u5728 http://nginx.org/en/download.html \u91cc\u9762\u4e0b\u8f7d Nginx \u6e90\u4ee3\u7801\uff0c\u6c38\u8fdc\u53bb\u4e0b\u8f7d\u6700\u65b0\u7684Stable release\u7248\u672c\nwget http://nginx.org/download/nginx-1.21.6.tar.gz\n\n\n\n\n# \u4e0b\u8f7d\u7f16\u8bd1\u5b89\u88c5\nmkdir -p /usr/local/nginx\nuseradd nginx -s /sbin/nologin -M\n\n# \u5728 http://nginx.org/en/download.html \u91cc\u9762\u4e0b\u8f7d Nginx \u6e90\u4ee3\u7801\uff0c\u6c38\u8fdc\u53bb\u4e0b\u8f7d\u6700\u65b0\u7684Stable release\u7248\u672c\nwget -P /usr/local/src/  http://nginx.org/download/nginx-1.22.0.tar.gz  cd /usr/local/src/ &amp;&amp;  tar\u00a0-zxvf\u00a0nginx-1.22.0.tar.gz\ncd  nginx-1.22.0\n\n\n# \u914d\u7f6e Vim \u9ad8\u4eae, \u5982\u679c Vim \u6ca1\u6709\u5f00\u542f\u8bed\u6cd5\u9ad8\u4eae\u7684\u8bdd\uff0c\u6700\u597d\u5f00\u542f\u4e00\u4e0b\ncp -r contrib/vim/* ~/.vim\necho 'syntax on' &gt; ~/.vimrc ############################################ \u9605\u8bfb\u90e8\u5206 ############################################\n# \u4f7f\u7528\u6700\u65b0\u7684ngx_http_geoip2\uff0c\u8be5\u6a21\u5757\u53ef\u4ee5\u7cbe\u786e\u5230\u56fd\u5bb6\u3001\u7701\u3001\u5e02\u7b49\u4e00\u7ea7\u7684IP\uff0c\u5e76\u4e14\u5168\u90e8\u7531Nginx\u6267\u884c\u8bc6\u522b\u548c\u963b\u6b62\u8bbf\u95ee\n# nginx\u539f\u751f\u7684ngx_http_geoip_module\u4e0d\u652f\u6301GeoIP2\uff0c\u6240\u4ee5\u9700\u8981\u7528\u7b2c\u4e09\u65b9\u7684ngx_http_geoip2_module\u6a21\u5757\ngit clone https://github.com/leev/ngx_http_geoip2_module.git  /usr/local/\n\n\n\n# \u6e90\u4ee3\u7801\u76ee\u5f55\u7ed3\u6784\u8bf4\u660e\n# https://www.cnblogs.com/chrdai/p/11306728.html\nnginx-1.21.4\n\u251c\u2500\u2500 CHANGES           # \u6bcf\u4e2a\u7248\u672c\u63d0\u4f9b\u7684\u7279\u6027\u548c bugfix\uff0cchangelog\u6587\u4ef6\n\u251c\u2500\u2500 CHANGES.ru        # \u4fc4\u7f57\u65af\u7248\u672c\u7684 CHANGES \u6587\u4ef6\n\u251c\u2500\u2500 LICENSE           # \u5f00\u6e90\u8bb8\u53ef\u6587\u4ef6\n\u251c\u2500\u2500 Makefile          # MAKE\u6587\u4ef6   \n\u251c\u2500\u2500 README            # README\u8bf4\u660e\u6587\u4ef6\n\u251c\u2500\u2500 auto              # \u81ea\u52a8\u68c0\u6d4b\u7cfb\u7edf\u73af\u5883\u4ee5\u53ca\u7f16\u8bd1\u76f8\u5173\u7684\u811a\u672c\uff0c\u8f85\u52a9 configure \u811a\u672c\u6267\u884c\u7684\u65f6\u5019\u53bb\u5224\u5b9anginx\u652f\u6301\u54ea\u4e9b\u6a21\u5757\uff0c\u5f53\u524d\u64cd\u4f5c\u7cfb\u7edf\u6709\u4ec0\u4e48\u6837\u7684\u7279\u6027\u53ef\u4ee5\u4f9b\u7ed9nginx\u4f7f\u7528\n\u251c\u2500\u2500 conf              # \u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\uff0c\u65b9\u4fbf\u8fd0\u7ef4\u914d\u7f6e\uff0c\u4f1a\u628aconf\u793a\u4f8b\u914d\u7f6e\u6587\u4ef6\u62f7\u8d1d\u5230\u5b89\u88c5\u76ee\u5f55\n\u251c\u2500\u2500 configure         # \u547d\u4ee4\u811a\u672c\uff0c\u7528\u6765\u751f\u6210\u4e2d\u95f4\u6587\u4ef6\uff0c\u6267\u884c\u7f16\u8bd1\u524d\u7684\u4e00\u4e2a\u5fc5\u5907\u52a8\u4f5c\n\u251c\u2500\u2500 contrib           # \u63d0\u4f9b\u4e86\u4e24\u4e2a pl \u811a\u672c\u548c vim \u5de5\u5177\n\u251c\u2500\u2500 html              # \u4e00\u4e2a 500 \u9519\u8bef\u7684\u9ed8\u8ba4\u9875\u9762\uff0c\u53e6\u4e00\u4e2a\u662f\u9ed8\u8ba4\u7684 index \u9875\u9762\n\u251c\u2500\u2500 man               # nginx \u5bf9 Linux \u7684\u5e2e\u52a9\u6587\u4ef6\uff0cman ./nginx.8\n\u2514\u2500\u2500 src               # nginx \u6838\u5fc3\u6e90\u4ee3\u7801\n\n############################################ \u9605\u8bfb\u90e8\u5206 ############################################\n\n\n# configure\u914d\u7f6e\uff0cconfigure\u4e4b\u540e\uff0c\u4f1a\u751f\u6210Makefile\u6587\u4ef6\uff0c\u7528\u4e8e\u7f16\u8bd1\u548c\u6784\u5efanginx\n./configure   --user=nginx --group=nginx  --prefix=/usr/local/nginx/  --with-http_stub_status_module  --with-http_ssl_module\n\n./configure --help # --help \u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u914d\u7f6e\u811a\u672c\u652f\u6301\u54ea\u4e9b\u53c2\u6570\u9009\u9879\n\n# \u7b2c\u4e00\u7c7b\u914d\u7f6e\u53c2\u6570\n--prefix=PATH                      set installation prefix      # \u4e00\u822c\u6307\u5b9a\u8fd9\u4e2a\u8def\u5f84\u5c31\u53ef\u4ee5\u4e86\uff0c\u5176\u4ed6\u6587\u4ef6\u4f1a\u5728 prefix \u76ee\u5f55\u4e0b\u5efa\u7acb\u76f8\u5e94\u7684\u6587\u4ef6\u5939\n--sbin-path=PATH                   set nginx binary pathname\n--modules-path=PATH                set modules path\n--conf-path=PATH                   set nginx.conf pathname\n--error-log-path=PATH              set error log pathname\n--pid-path=PATH                    set nginx.pid pathname\n--lock-path=PATH                   set nginx.lock pathname\n--user=USER                        set non-privileged user for worker processes\n--group=GROUP                      set non-privileged group for worker processes\n--build=NAME                       set build name\n--builddir=DIR                     set build directory\n\n\n\n# \u7b2c\u4e8c\u7c7b\u914d\u7f6e\u53c2\u6570\n# \u53ef\u4ee5\u914d\u7f6e\u4f7f\u7528\u6216\u4e0d\u4f7f\u7528\u54ea\u4e9b\u6a21\u5757\uff0c\u524d\u7f00\u901a\u5e38\u662f with \u548c with out\u3002\n## with\u5f00\u5934\u7684\u8868\u793a\u8be5\u6a21\u5757\u9ed8\u8ba4\u662f\u672a\u5f00\u542f\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528--with\u5f00\u542f\u3002\n## without\u5f00\u5934\u7684\u8868\u793a\u8be5\u6a21\u5757\u9ed8\u8ba4\u662f\u542f\u7528\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528--without\u7981\u7528\u3002\n## \u7b2c\u4e09\u65b9\u6a21\u5757\u4f7f\u7528--add-module=PATH\u6dfb\u52a0\u3002\u5982\u679c\u652f\u6301\u52a8\u6001\u52a0\u8f7d\uff0c\u4f7f\u7528--add-dynamic-module=PATH\u6dfb\u52a0\u3002\n\n--with-http_ssl_module             enable ngx_http_ssl_module\n--with-http_v2_module              enable ngx_http_v2_module\n--with-http_realip_module          enable ngx_http_realip_module\n...\n--without-http_charset_module      disable ngx_http_charset_module\n--without-http_gzip_module         disable ngx_http_gzip_module\n--without-http_ssi_module          disable ngx_http_ssi_module\n...\n\n# \u7f16\u8bd1\u5e76\u5b89\u88c5\nmake &amp;&amp; make install # nginx\u670d\u52a1\u914d\u7f6e\u6587\u4ef6\uff0c\u4f7f\u7528systemd\n# /lib/systemd/system/nginx.service\n# https://www.nginx.com/resources/wiki/start/topics/examples/systemd/\n\n[Unit]\nDescription=The NGINX HTTP and reverse proxy server\nAfter=syslog.target network-online.target remote-fs.target nss-lookup.target\nWants=network-online.target\n[Service]\nType=forking\nPIDFile=/usr/local/nginx/logs/nginx.pid\nExecStartPre=/usr/local/nginx/sbin/nginx -t\nExecStart=/usr/local/nginx/sbin/nginx\nExecReload=/usr/local/nginx/sbin/nginx -s reload\nExecStop=/bin/kill -s QUIT $MAINPID\nPrivateTmp=true\n[Install]\nWantedBy=multi-user.target\n\n\n\n# ubuntu\n\nsudo apt-get install gcc make libpcre3 libpcre3-dev   zlib1g-dev openssl libssl-dev </code></pre>"},{"location":"Introduction/%E5%AE%89%E8%A3%85nginx/#docker","title":"Docker\u8fd0\u884c","text":"<p>\u5229\u7528 Docker \u76f4\u63a5\u8fd0\u884c\u4e00\u4e2a\u5bb9\u5668\uff0c\u7136\u540e\u5c06\u914d\u7f6e\u6620\u5c04\u51fa\u6765\u4e5f\u662f\u4e00\u79cd\u4e0d\u9519\u7684\u9009\u62e9\uff1a</p> <pre><code>$ docker run -d \\\n--name nginx \\\n-p 80:80 \\\n-p 443:443 \\\n-v $PWD/conf.d:/etc/nginx/conf.d \\\nnginx\n\n$ curl -v localhost\n&lt;html&gt;\n......\n&lt;/html&gt;\n</code></pre>"},{"location":"Introduction/%E5%AE%89%E8%A3%85nginx/#_3","title":"\u52a8\u6001\u6a21\u5757","text":"<p>\u52a8\u6001\u6a21\u5757\uff0c\u9ed8\u8ba4\u60c5\u51b5 nginx \u662f\u7531\u8bb8\u591a\u6838\u5fc3\u6a21\u5757\u6784\u5efa\u7684\uff0c\u90a3\u9700\u8981\u5b9e\u73b0\u989d\u5916\u7684\u529f\u80fd\u5c31\u9700\u8981\u91cd\u65b0\u6784\u5efa\u3002\u4f46\u7248\u672c 1.9.11 \u4e4b\u540e\uff0cnginx \u652f\u6301\u4e86<code>\u52a8\u6001\u6a21\u5757</code>\uff0c\u4ee5\u4e0b\u662f nginx \u52a8\u6001\u6784\u5efa\u7684\u6a21\u5757\uff1a</p> <p>nginx-module-geoip nginx-module-image-filter nginx-module-njs nginx-module-perl nginx-module-xslt \u5b83\u53ef\u4ee5\u901a\u8fc7\u5355\u72ec\u7684\u5305\u8fdb\u884c\u53d1\u5e03\uff0c\u5728\u4f7f\u7528\u65f6\u53ea\u9700 nginx \u52a0\u8f7d\u5373\u53ef\uff1a</p>"},{"location":"Introduction/%E5%AE%89%E8%A3%85nginx/#main","title":"\u4f5c\u7528\u57df main","text":"<p>load_module modules/ngx_mail_module.so;</p>"},{"location":"Introduction/%E5%AE%89%E8%A3%85nginx/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/install.html</p>"},{"location":"Introduction/%E6%8E%A7%E5%88%B6nginx/","title":"\u63a7\u5236 nginx","text":"<ul> <li>\u914d\u7f6e\u53d8\u66f4</li> <li>\u65e5\u5fd7\u8f6e\u8f6c</li> <li>\u5347\u7ea7\u53ef\u6267\u884c\u6587\u4ef6</li> </ul> <p>\u53ef\u4ee5\u7528\u4fe1\u53f7\u63a7\u5236 nginx\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e3b\u8fdb\u7a0b\uff08Master\uff09\u7684 pid \u5199\u5728 <code>/use/local/nginx/logs/nginx.pid</code> \u6587\u4ef6\u4e2d\u3002\u8fd9\u4e2a\u6587\u4ef6\u7684\u4f4d\u7f6e\u53ef\u4ee5\u5728\u914d\u7f6e\u65f6\u66f4\u6539\u6216\u8005\u5728 nginx.conf \u6587\u4ef6\u4e2d\u4f7f\u7528 <code>pid</code> \u6307\u4ee4\u66f4\u6539\u3002Master \u8fdb\u7a0b\u652f\u6301\u4ee5\u4e0b\u4fe1\u53f7\uff1a</p> \u4fe1\u53f7 \u4f5c\u7528 TERM, INT \u5feb\u901f\u5173\u95ed QUIT \u6b63\u5e38\u9000\u51fa HUP \u5f53\u6539\u53d8\u914d\u7f6e\u6587\u4ef6\u65f6\uff0c\u5c06\u6709\u4e00\u6bb5\u8fc7\u6e21\u65f6\u95f4\u6bb5\uff08\u4ec5 FreeBSD \u548c Linux\uff09\uff0c\u65b0\u542f\u52a8\u7684 Worker \u8fdb\u7a0b\u5c06\u5e94\u7528\u65b0\u7684\u914d\u7f6e\uff0c\u65e7\u7684 Worker \u8fdb\u7a0b\u5c06\u88ab\u5e73\u6ed1\u9000\u51fa USR1 \u91cd\u65b0\u6253\u5f00\u65e5\u5fd7\u6587\u4ef6 USR2 \u5347\u7ea7\u53ef\u6267\u884c\u6587\u4ef6 WINCH \u6b63\u5e38\u5173\u95ed Worker \u8fdb\u7a0b <p>Worker \u8fdb\u7a0b\u4e5f\u662f\u53ef\u4ee5\u7528\u4fe1\u53f7\u63a7\u5236\u7684\uff0c\u5c3d\u7ba1\u8fd9\u4e0d\u662f\u5fc5\u987b\u7684\u3002\u652f\u6301\u4ee5\u4e0b\u4fe1\u53f7\uff1a</p> \u4fe1\u53f7 \u4f5c\u7528 TERM, INT \u5feb\u901f\u5173\u95ed QUIT \u6b63\u5e38\u5173\u95ed USR1 \u91cd\u65b0\u6253\u5f00\u65e5\u5fd7\u6587\u4ef6 WINCH \u8c03\u8bd5\u5f02\u5e38\u7ec8\u6b62\uff08\u9700\u8981\u5f00\u542f debug_points\uff09"},{"location":"Introduction/%E6%8E%A7%E5%88%B6nginx/#_1","title":"\u914d\u7f6e\u53d8\u66f4","text":"<p>\u4e3a\u4e86\u8ba9 nginx \u91cd\u65b0\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\uff0c\u5e94\u5c06 <code>HUP</code> \u4fe1\u53f7\u53d1\u9001\u7ed9 Master \u8fdb\u7a0b\u3002Master \u8fdb\u7a0b\u9996\u5148\u4f1a\u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\u7684\u8bed\u6cd5\u6709\u6548\u6027\uff0c\u4e4b\u540e\u5c1d\u8bd5\u5e94\u7528\u65b0\u7684\u914d\u7f6e\uff0c\u5373\u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\u548c\u65b0\u7684 socket\u3002\u5982\u679c\u5931\u8d25\u4e86\uff0c\u5b83\u4f1a\u56de\u6eda\u66f4\u6539\u5e76\u7ee7\u7eed\u4f7f\u7528\u65e7\u7684\u914d\u7f6e\u3002\u5982\u679c\u6210\u529f\uff0c\u5b83\u5c06\u542f\u52a8\u65b0\u7684 Worker \u8fdb\u7a0b\u5e76\u5411\u65e7\u7684 Worker \u8fdb\u7a0b\u53d1\u9001\u6d88\u606f\u8bf7\u6c42\u5b83\u4eec\u6b63\u5e38\u5173\u95ed\u3002\u65e7\u7684 Worker \u8fdb\u7a0b\u5173\u95ed\u76d1\u542c socket \u5e76\u7ee7\u7eed\u4e3a\u65e7\u7684\u5ba2\u6237\u7aef\u670d\u52a1\uff0c\u5f53\u6240\u6709\u65e7\u7684\u5ba2\u6237\u7aef\u88ab\u5904\u7406\u5b8c\u6210\uff0c\u65e7\u7684 Worker \u8fdb\u7a0b\u5c06\u88ab\u5173\u95ed\u3002</p> <p>\u6211\u4eec\u6765\u4e3e\u4f8b\u8bf4\u660e\u4e00\u4e0b\u3002 \u5047\u8bbe nginx \u662f\u5728 FreeBSD 4.x \u547d\u4ee4\u884c\u4e0a\u8fd0\u884c\u7684</p> <pre><code>ps axw -o pid,ppid,user,%cpu,vsz,wchan,command | egrep '(nginx|PID)'\n</code></pre> <p>\u5f97\u5230\u4ee5\u4e0b\u8f93\u51fa\u7ed3\u679c\uff1a</p> <pre><code>  PID  PPID USER    %CPU   VSZ WCHAN  COMMAND\n33126     1 root     0.0  1148 pause  nginx: master process /usr/local/nginx/sbin/nginx\n33127 33126 nobody   0.0  1380 kqread nginx: worker process (nginx)\n33128 33126 nobody   0.0  1364 kqread nginx: worker process (nginx)\n33129 33126 nobody   0.0  1364 kqread nginx: worker process (nginx)\n</code></pre> <p>\u5982\u679c\u628a <code>HUP</code> \u4fe1\u53f7\u53d1\u9001\u5230 master \u8fdb\u7a0b\uff0c\u8f93\u51fa\u7684\u7ed3\u679c\u5c06\u4f1a\u662f\uff1a</p> <pre><code> PID  PPID USER    %CPU   VSZ WCHAN  COMMAND\n33126     1 root     0.0  1164 pause  nginx: master process /usr/local/nginx/sbin/nginx\n33129 33126 nobody   0.0  1380 kqread nginx: worker process is shutting down (nginx)\n33134 33126 nobody   0.0  1368 kqread nginx: worker process (nginx)\n33135 33126 nobody   0.0  1368 kqread nginx: worker process (nginx)\n33136 33126 nobody   0.0  1368 kqread nginx: worker process (nginx)\n</code></pre> <p>\u5176\u4e2d\u4e00\u4e2a PID \u4e3a 33129 \u7684 worker \u8fdb\u7a0b\u4ecd\u7136\u5728\u7ee7\u7eed\u5de5\u4f5c\uff0c\u8fc7\u4e00\u6bb5\u65f6\u95f4\u4e4b\u540e\u5b83\u9000\u51fa\u4e86\uff1a</p> <pre><code>PID  PPID USER    %CPU   VSZ WCHAN  COMMAND\n33126     1 root     0.0  1164 pause  nginx: master process /usr/local/nginx/sbin/nginx\n33134 33126 nobody   0.0  1368 kqread nginx: worker process (nginx)\n33135 33126 nobody   0.0  1368 kqread nginx: worker process (nginx)\n33136 33126 nobody   0.0  1368 kqread nginx: worker process (nginx)\n</code></pre>"},{"location":"Introduction/%E6%8E%A7%E5%88%B6nginx/#_2","title":"\u65e5\u5fd7\u8f6e\u8f6c","text":"<p>\u4e3a\u4e86\u505a\u65e5\u5fd7\u8f6e\u8f6c\uff0c\u9996\u5148\u9700\u8981\u91cd\u547d\u540d\u3002\u4e4b\u540e\u5e94\u8be5\u53d1\u9001 <code>USR1</code> \u4fe1\u53f7\u7ed9 master \u8fdb\u7a0b\u3002Master \u8fdb\u7a0b\u5c06\u4f1a\u91cd\u65b0\u6253\u5f00\u5f53\u524d\u6240\u6709\u7684\u65e5\u5fd7\u6587\u4ef6\uff0c\u5e76\u5c06\u5176\u5206\u914d\u7ed9\u4e00\u4e2a\u6b63\u5728\u8fd0\u884c\u672a\u7ecf\u6388\u6743\u7684\u7528\u6237\u4e3a\u6240\u6709\u8005\u7684 worker \u8fdb\u7a0b\u3002\u6210\u529f\u91cd\u65b0\u6253\u5f00\u4e4b\u540e Master \u8fdb\u7a0b\u5c06\u4f1a\u5173\u95ed\u6240\u6709\u6253\u5f00\u7684\u6587\u4ef6\u5e76\u4e14\u53d1\u9001\u6d88\u606f\u7ed9 worker \u8fdb\u7a0b\u8981\u6c42\u5b83\u4eec\u91cd\u65b0\u6253\u5f00\u6587\u4ef6\u3002Worker \u8fdb\u7a0b\u91cd\u65b0\u6253\u5f00\u65b0\u6587\u4ef6\u548c\u7acb\u5373\u5173\u95ed\u65e7\u6587\u4ef6\u3002\u56e0\u6b64\uff0c\u65e7\u7684\u6587\u4ef6\u51e0\u4e4e\u53ef\u4ee5\u7acb\u5373\u7528\u4e8e\u540e\u671f\u5904\u7406\uff0c\u4f8b\u5982\u538b\u7f29\u3002</p>"},{"location":"Introduction/%E6%8E%A7%E5%88%B6nginx/#_3","title":"\u5347\u7ea7\u53ef\u6267\u884c\u6587\u4ef6","text":"<p>\u4e3a\u4e86\u5347\u7ea7\u670d\u52a1\u5668\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u9996\u5148\u5e94\u8be5\u5c06\u65b0\u7684\u53ef\u6267\u884c\u6587\u4ef6\u66ff\u6362\u65e7\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3002\u4e4b\u540e\u53d1\u9001 <code>USR2</code> \u4fe1\u53f7\u5230 master \u8fdb\u7a0b\u3002Master \u8fdb\u7a0b\u9996\u5148\u5c06\u4ee5\u8fdb\u7a0b ID \u6587\u4ef6\u91cd\u547d\u540d\u4e3a\u4ee5 <code>.oldbin</code> \u4e3a\u540e\u7f00\u7684\u65b0\u6587\u4ef6\uff0c\u4f8b\u5982 <code>/usr/local/nginx/logs/nginx.pid.oldbin</code>\u3002\u4e4b\u540e\u542f\u52a8\u65b0\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u548c\u4f9d\u6b21\u671f\u5f85\u80fd\u591f\u65b0\u7684 worker \u8fdb\u7a0b\uff1a</p> <pre><code>  PID  PPID USER    %CPU   VSZ WCHAN  COMMAND\n33126     1 root     0.0  1164 pause  nginx: master process /usr/local/nginx/sbin/nginx\n33134 33126 nobody   0.0  1368 kqread nginx: worker process (nginx)\n33135 33126 nobody   0.0  1380 kqread nginx: worker process (nginx)\n33136 33126 nobody   0.0  1368 kqread nginx: worker process (nginx)\n36264 33126 root     0.0  1148 pause  nginx: master process /usr/local/nginx/sbin/nginx\n36265 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)\n36266 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)\n36267 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)\n</code></pre> <p>\u4e4b\u540e\u6240\u6709\u7684 worker \u8fdb\u7a0b\uff08\u65e7\u7684\u548c\u65b0\u7684\uff09\u7ee7\u7eed\u63a5\u6536\u8bf7\u6c42\uff0c\u5982\u679c <code>WINCH</code> \u4fe1\u53f7\u88ab\u53d1\u9001\u7ed9\u4e86\u7b2c\u4e00\u4e2a master \u8fdb\u7a0b\uff0c\u5b83\u5c06\u5411\u5176 worker \u8fdb\u7a0b\u53d1\u9001\u6d88\u606f\u8981\u6c42\u5b83\u4eec\u6b63\u5e38\u5173\u95ed\uff0c\u4e4b\u540e\u5b83\u4eec\u5f00\u59cb\u9000\u51fa\uff1a</p> <pre><code>  PID  PPID USER    %CPU   VSZ WCHAN  COMMAND\n33126     1 root     0.0  1164 pause  nginx: master process /usr/local/nginx/sbin/nginx\n33135 33126 nobody   0.0  1380 kqread nginx: worker process is shutting down (nginx)\n36264 33126 root     0.0  1148 pause  nginx: master process /usr/local/nginx/sbin/nginx\n36265 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)\n36266 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)\n36267 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)\n</code></pre> <p>\u8fc7\u4e00\u6bb5\u65f6\u95f4\uff0c\u4ec5\u6709\u65b0\u7684 worker \u8fdb\u7a0b\u5904\u7406\u8bf7\u6c42\uff1a</p> <pre><code>  PID  PPID USER    %CPU   VSZ WCHAN  COMMAND\n33126     1 root     0.0  1164 pause  nginx: master process /usr/local/nginx/sbin/nginx\n36264 33126 root     0.0  1148 pause  nginx: master process /usr/local/nginx/sbin/nginx\n36265 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)\n36266 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)\n36267 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\u65e7\u7684 master \u8fdb\u7a0b\u4e0d\u4f1a\u5173\u95ed\u5b83\u7684\u76d1\u542c socket\uff0c\u5e76\u4e14\u5982\u679c\u9700\u8981\u7684\u8bdd\uff0c\u53ef\u4ee5\u7ba1\u7406\u5b83\u6765\u542f\u52a8 worker \u8fdb\u7a0b\u3002\u5982\u679c\u51fa\u4e8e\u67d0\u4e9b\u539f\u56e0\u4e0d\u80fd\u63a5\u53d7\u65b0\u7684\u53ef\u6267\u884c\u6587\u4ef6\u5de5\u4f5c\u65b9\u5f0f\uff0c\u53ef\u4ee5\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\u4e4b\u4e00\uff1a</p> <ul> <li>\u53d1\u9001 <code>HUP</code> \u4fe1\u53f7\u7ed9\u65e7\u7684 master \u8fdb\u7a0b\uff0c\u65e7\u7684 master \u8fdb\u7a0b\u5c06\u4f1a\u542f\u52a8\u4e0d\u4f1a\u91cd\u65b0\u8bfb\u53d6\u914d\u7f6e\u6587\u4ef6\u7684 worker \u8fdb\u7a0b\u3002\u4e4b\u540e\uff0c\u901a\u8fc7\u5c06 <code>QUIT</code> \u4fe1\u53f7\u53d1\u9001\u5230\u65b0\u7684\u4e3b\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u6b63\u5e38\u5173\u95ed\u6240\u6709\u7684\u65b0\u8fdb\u7a0b\u3002</li> <li>\u53d1\u9001 <code>TERM</code> \u4fe1\u53f7\u5230\u65b0\u7684 master \u8fdb\u7a0b\uff0c\u5b83\u5c06\u4f1a\u53d1\u9001\u4e00\u4e2a\u6d88\u606f\u7ed9 worker \u8fdb\u7a0b\u8981\u6c42\u5b83\u4eec\u7acb\u5373\u5173\u95ed\uff0c\u5e76\u4e14\u5b83\u4eec\u7acb\u5373\u9000\u51fa\uff08\u5982\u679c\u7531\u4e8e\u67d0\u4e9b\u539f\u56e0\u65b0\u7684\u8fdb\u7a0b\u6ca1\u6709\u9000\u51fa\uff0c\u5e94\u8be5\u53d1\u9001 <code>KILL</code> \u4fe1\u53f7\u8ba9\u5b83\u4eec\u5f3a\u5236\u9000\u51fa\uff09\u3002\u5f53\u65b0\u7684 master \u8fdb\u7a0b\u9000\u51fa\u65f6\uff0c\u65e7 master \u5c06\u4f1a\u81ea\u52a8\u542f\u52a8\u65b0\u7684 worker \u8fdb\u7a0b\u3002</li> </ul> <p>\u65b0\u7684 master \u8fdb\u7a0b\u9000\u51fa\u4e4b\u540e\uff0c\u65e7\u7684 master \u8fdb\u7a0b\u4f1a\u4ece\u4ee5\u8fdb\u7a0b ID \u547d\u540d\u7684\u6587\u4ef6\u4e2d\u5ffd\u7565\u6389 <code>.oldbin</code> \u540e\u7f00\u7684\u6587\u4ef6\u3002</p> <p>\u5982\u679c\u5347\u7ea7\u6210\u529f\uff0c\u5e94\u8be5\u53d1\u9001 <code>QUIT</code> \u4fe1\u53f7\u7ed9\u65e7\u7684 master \u8fdb\u7a0b\uff0c\u4ec5\u4ec5\u65b0\u7684\u8fdb\u7a0b\u9a7b\u7559\uff1a</p> <pre><code>  PID  PPID USER    %CPU   VSZ WCHAN  COMMAND\n36264     1 root     0.0  1148 pause  nginx: master process /usr/local/nginx/sbin/nginx\n36265 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)\n36266 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)\n36267 36264 nobody   0.0  1364 kqread nginx: worker process (nginx)\n</code></pre>"},{"location":"Introduction/%E6%8E%A7%E5%88%B6nginx/#_4","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/control.html</li> </ul>"},{"location":"Introduction/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8D%E7%A7%B0/","title":"\u670d\u52a1\u5668\u540d\u79f0","text":"<ul> <li>\u901a\u914d\u7b26\u540d\u79f0</li> <li>\u6b63\u5219\u8868\u8fbe\u5f0f\u540d\u79f0</li> <li>\u5176\u4ed6\u540d\u79f0</li> <li>\u56fd\u9645\u5316\u540d\u79f0</li> </ul> <p>\u670d\u52a1\u5668\u540d\u79f0\u662f\u4f7f\u7528 server_name \u6307\u4ee4\u5b9a\u4e49\u7684\uff0c\u5b83\u786e\u5b9a\u4e86\u54ea\u4e00\u4e2a server \u5757\u88ab\u7ed9\u5b9a\u7684\u8bf7\u6c42\u6240\u4f7f\u7528\u3002\u53e6\u8bf7\u53c2\u89c1 nginx \u5982\u4f55\u5904\u7406\u8bf7\u6c42\u3002\u53ef\u4ee5\u4f7f\u7528\u7cbe\u786e\u7684\u540d\u79f0\u3001\u901a\u914d\u7b26\u6216\u8005\u6b63\u5219\u8868\u8fbe\u5f0f\u6765\u5b9a\u4e49\u4ed6\u4eec\uff1a</p> <pre><code>server {\nlisten       80;\nserver_name  example.org  www.example.org;\n...\n}\n\nserver {\nlisten       80;\nserver_name  *.example.org;\n...\n}\n\nserver {\nlisten       80;\nserver_name  mail.*;\n...\n}\n\nserver {\nlisten       80;\nserver_name  ~^(?&lt;user&gt;.+)\\.example\\.net$;\n...\n}\n</code></pre> <p>\u5f53\u901a\u8fc7\u540d\u79f0\u641c\u7d22\u865a\u62df\u670d\u52a1\u5668\u65f6\uff0c\u5982\u679c\u540d\u79f0\u4e0e\u591a\u4e2a\u6307\u5b9a\u7684\u53d8\u4f53\u5339\u914d\uff0c\u4f8b\u5982\u901a\u914d\u7b26\u548c\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5219\u5c06\u6309\u7167\u4f18\u5148\u987a\u5e8f\u9009\u62e9\u7b2c\u4e00\u4e2a\u5339\u914d\u7684\u53d8\u4f53\uff1a</p> <ol> <li>\u7cbe\u786e\u7684\u540d\u79f0</li> <li>\u4ee5\u661f\u53f7\u5f00\u5934\u7684\u6700\u957f\u7684\u901a\u914d\u7b26\u540d\u79f0\uff0c\u4f8b\u5982 <code>*.example.org</code></li> <li>\u4ee5\u661f\u53f7\u7ed3\u5c3e\u7684\u6700\u957f\u7684\u901a\u914d\u7b26\u540d\u79f0\uff0c\u4f8b\u5982 <code>mail.*</code></li> <li>\u7b2c\u4e00\u4e2a\u5339\u914d\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff08\u6309\u7167\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u51fa\u73b0\u7684\u987a\u5e8f\uff09</li> </ol>"},{"location":"Introduction/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8D%E7%A7%B0/#_2","title":"\u901a\u914d\u7b26\u540d\u79f0","text":"<p>\u901a\u914d\u7b26\u540d\u79f0\u53ea\u80fd\u5728\u540d\u79f0\u7684\u5f00\u5934\u6216\u8005\u7ed3\u5c3e\u5305\u542b\u4e00\u4e2a\u661f\u53f7\uff0c\u4e14\u53ea\u80fd\u5728\u70b9\u7684\u8fb9\u754c\u4e0a\u5305\u542b\u661f\u53f7\u3002\u8fd9\u4e9b\u540d\u79f0\u4e3a <code>www.*.example.org</code> \u548c <code>w*.example.org</code> \u90fd\u662f\u65e0\u6548\u7684\u3002\u7136\u800c\uff0c\u53ef\u4ee5\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u6307\u5b9a\u8fd9\u4e9b\u540d\u79f0\uff0c\u4f8b\u5982\uff0c<code>~^www\\..+\\.example\\.org$\u201d</code> \u548c <code>~^w.*\\.example\\.org$</code>\u3002\u661f\u53f7\u53ef\u4ee5\u5339\u914d\u591a\u4e2a\u540d\u79f0\u90e8\u5206\u3002\u540d\u79f0 <code>*.example.org</code> \u4e0d\u4ec5\u5339\u914d\u4e86 <code>www.example.org</code>\uff0c\u8fd8\u5339\u914d\u4e86 <code>www.sub.example.org</code>\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 <code>.example.org</code> \u5f62\u5f0f\u7684\u7279\u6b8a\u901a\u914d\u7b26\u540d\u79f0\u6765\u5339\u914d\u786e\u5207\u7684\u540d\u79f0 <code>example.org</code> \u548c \u901a\u914d\u7b26 <code>*.example.org</code>\u3002</p>"},{"location":"Introduction/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8D%E7%A7%B0/#_3","title":"\u6b63\u5219\u8868\u8fbe\u5f0f\u540d\u79f0","text":"<p>nginx \u4f7f\u7528\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u4e0e Perl \u7f16\u7a0b\u8bed\u8a00\uff08PCRE\uff09\u4f7f\u7528\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u517c\u5bb9\u3002\u8981\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u670d\u52a1\u5668\u540d\u79f0\u5fc5\u987b\u4ee5\u6ce2\u6d6a\u7b26\u53f7\u5f00\u5934\uff1a</p> <p><pre><code>server_name  ~^www\\d+\\.example\\.net$;\n</code></pre> \u5426\u5219\u5c06\u88ab\u89c6\u4e3a\u786e\u5207\u7684\u540d\u79f0\uff0c\u6216\u8005\u5982\u679c\u8868\u8fbe\u5f0f\u4e2d\u5305\u542b\u661f\u53f7\uff0c\u5c06\u88ab\u89c6\u4e3a\u901a\u914d\u7b26\u540d\u79f0\uff08\u5e76\u4e14\u53ef\u80fd\u662f\u65e0\u6548\u7684\uff09\u3002\u522b\u5fd8\u4e86\u8bbe\u7f6e <code>^</code> \u548c <code>$</code> \u951a\u70b9\u3002\u5b83\u4eec\u5728\u8bed\u6cd5\u4e0a\u4e0d\u662f\u5fc5\u987b\u7684\uff0c\u4f46\u5728\u903b\u8f91\u4e0a\u662f\u9700\u8981\u7684\u3002\u8fd8\u8981\u6ce8\u610f\u7684\u662f\uff0c\u57df\u540d\u7684\u70b9\u5e94\u8be5\u4f7f\u7528\u53cd\u659c\u6760\u8f6c\u4e49\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u7684 <code>{</code> \u548c <code>}</code> \u5e94\u8be5\u88ab\u5f15\u53f7\u62ec\u8d77\uff1a</p> <p><pre><code>server_name  \"~^(?&lt;name&gt;\\w\\d{1,3}+)\\.example\\.net$\";\n</code></pre> \u5426\u5219 nginx \u5c06\u65e0\u6cd5\u542f\u52a8\u5e76\u4e14\u663e\u793a\u9519\u8bef\u4fe1\u606f\uff1a</p> <p><pre><code>directive \"server_name\" is not terminated by \";\" in ...\n</code></pre> \u6b63\u5219\u8868\u8fbe\u5f0f\u540d\u79f0\u6355\u83b7\u5230\u7684\u5185\u5bb9\u53ef\u4ee5\u4f5c\u4e3a\u53d8\u91cf\u4e3a\u540e\u9762\u6240\u7528\uff1a</p> <p><pre><code>server {\nserver_name   ~^(www\\.)?(?&lt;domain&gt;.+)$;\n\nlocation / {\nroot   /sites/$domain;\n}\n}\n</code></pre> PCRE \u5e93\u4f7f\u7528\u4ee5\u4e0b\u8bed\u6cd5\u6355\u83b7\u540d\u79f0\uff1a - <code>?&lt;name&gt;</code> Perl 5.10 \u517c\u5bb9\u8bed\u6cd5\uff0c\u81ea PCRE-7.0 \u8d77\u652f\u6301 - <code>?'name'</code> Perl 5.10 \u517c\u5bb9\u8bed\u6cd5\uff0c\u81ea PCRE-7.0 \u8d77\u652f\u6301 - <code>?P&lt;name&gt;</code> Python \u517c\u5bb9\u8bed\u6cd5\uff0c\u81ea PCRE-4.0 \u8d77\u652f\u6301</p> <p>\u5982\u679c nginx \u65e0\u6cd5\u542f\u52a8\u5e76\u4e14\u663e\u793a\u9519\u8bef\u4fe1\u606f\uff1a</p> <pre><code>pcre_compile() failed: unrecognized character after (?&lt; in ...\n</code></pre> <p>\u8bf4\u660e PCRE \u5e93\u6bd4\u8f83\u8001\uff0c\u5e94\u8be5\u5c1d\u8bd5\u4f7f\u7528\u8bed\u6cd5 <code>?P&lt;name&gt;</code>\u3002\u6355\u83b7\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6570\u5b57\u5f62\u5f0f\uff1a</p> <p><pre><code>server {\nserver_name   ~^(www\\.)?(.+)$;\n\nlocation / {\nroot   /sites/$2;\n}\n}\n</code></pre> \u7136\u800c\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4ec5\u9650\u4e8e\u7b80\u5355\u60c5\u51b5\uff08\u5982\u4e0a\u6240\u8ff0\uff09\uff0c\u56e0\u4e3a\u6570\u5b57\u5f15\u7528\u5bb9\u6613\u88ab\u8986\u76d6\u3002</p>"},{"location":"Introduction/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8D%E7%A7%B0/#_4","title":"\u5176\u4ed6\u540d\u79f0","text":"<p>\u6709\u4e00\u4e9b\u670d\u52a1\u5668\u540d\u79f0\u9700\u8981\u88ab\u7279\u522b\u5904\u7406\u3002</p> <p>\u5982\u679c\u9700\u8981\u5904\u7406\u4e00\u4e2a\u5728\u4e0d\u662f\u9ed8\u8ba4\u7684 server \u5757\u4e2d\u7684\u6ca1\u6709 Host \u5934\u5b57\u6bb5\u7684\u8bf7\u6c42\uff0c\u5e94\u8be5\u6307\u5b9a\u4e00\u4e2a\u7a7a\u540d\u79f0\uff1a</p> <p><pre><code>server {\nlisten       80;\nserver_name  example.org  www.example.org  \"\";\n...\n}\n</code></pre> \u5982\u679c server \u5757\u4e2d\u6ca1\u6709\u5b9a\u4e49 server_name\uff0c\u90a3\u4e48 nginx \u5c06\u4f7f\u7528\u7a7a\u540d\u79f0\u4f5c\u4e3a\u670d\u52a1\u5668\u540d\u3002</p> <p>\u6b64\u60c5\u51b5\u4e0b\uff0cnginx \u7684\u7248\u672c\u5230 0.8.48 \u4f7f\u7528\u673a\u5668\u7684\u4e3b\u673a\u540d\u4f5c\u4e3a\u670d\u52a1\u5668\u540d\u79f0\u3002</p> <p>\u5982\u679c\u670d\u52a1\u5668\u540d\u79f0\u88ab\u5b9a\u4e49\u4e3a <code>$hostname</code>\uff080.9.4\uff09\uff0c\u5219\u4f7f\u7528\u673a\u5668\u7684\u4e3b\u673a\u540d\u3002</p> <p>\u5982\u679c\u6709\u4eba\u4f7f\u7528 IP \u5730\u5740\u800c\u4e0d\u662f\u670d\u52a1\u5668\u540d\u79f0\u6765\u53d1\u51fa\u8bf7\u6c42\uff0c\u5219 Host \u8bf7\u6c42 header \u57df\u5c06\u5305\u542b IP \u5730\u5740\uff0c\u53ef\u4ee5\u4f7f\u7528 IP \u5730\u5740\u4f5c\u4e3a\u670d\u52a1\u5668\u540d\u79f0\u6765\u5904\u7406\u8bf7\u6c42\u3002</p> <p><pre><code>server {\nlisten       80;\nserver_name  example.org\nwww.example.org\n\"\"\n192.168.1.1\n;\n...\n}\n</code></pre> \u5728\u6240\u6709\u7684\u670d\u52a1\u5668\u793a\u4f8b\u4e2d\uff0c\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u5947\u602a\u7684\u540d\u79f0 <code>_</code>\uff1a</p> <p><pre><code>server {\nlisten       80  default_server;\nserver_name  _;\nreturn       444;\n}\n</code></pre> \u8fd9\u4e2a\u540d\u79f0\u6ca1\u6709\u4ec0\u4e48\u7279\u522b\u4e4b\u5904\uff0c\u5b83\u53ea\u662f\u4f17\u591a\u65e0\u6548\u57df\u540d\u4e2d\u7684\u4e00\u4e2a\uff0c\u5b83\u6c38\u8fdc\u4e0d\u4f1a\u4e0e\u4efb\u4f55\u771f\u5b9e\u7684\u540d\u79f0\u76f8\u4ea4\u3002\u6b64\u5916\u8fd8\u6709\u5176\u4ed6\u65e0\u6548\u7684\u540d\u79f0\uff0c\u5982 <code>--</code> \u548c <code>!@#</code> \u4e5f\u662f\u5982\u6b64\u3002</p> <p>nginx \u5230 0.6.25 \u7248\u672c\u652f\u6301\u7279\u6b8a\u7684\u540d\u79f0 <code>*</code>\uff0c\u8fd9\u5e38\u88ab\u9519\u8bef\u5730\u7406\u89e3\u4e3a\u6240\u6709\u540d\u79f0\u3002\u5b83\u5e76\u4e0d\u662f\u6240\u6709\u6216\u8005\u901a\u914d\u7b26\u670d\u52a1\u5668\u540d\u79f0\u3002\u76f8\u53cd\uff0c\u5b83\u7684\u529f\u80fd\u73b0\u5728\u662f\u7531 server_name_in_redirect \u6307\u4ee4\u63d0\u4f9b\u3002\u73b0\u5728\u4e0d\u63a8\u8350\u4f7f\u7528\u7279\u6b8a\u7684\u540d\u79f0 <code>*</code>\uff0c\u5e94\u8be5\u4f7f\u7528 server_name_in_redirect \u6307\u4ee4\u3002\u8bf7\u6ce8\u610f\uff0c\u65e0\u6cd5\u4f7f\u7528 server_name \u6307\u4ee4\u6765\u6307\u5b9a\u6240\u6709\u540d\u79f0\u6216\u8005\u9ed8\u8ba4\u670d\u52a1\u5668\u3002\u8fd9\u662f listen \u6307\u4ee4\u7684\u5c5e\u6027\uff0c\u800c\u4e0d\u662f server_name \u7684\u3002\u8bf7\u53c2\u9605 nginx \u5982\u4f55\u5904\u7406\u8bf7\u6c42\u3002\u53ef\u4ee5\u5b9a\u4e49\u76d1\u542c <code>*:80</code> \u548c <code>*:8080</code> \u7aef\u53e3\u7684\u670d\u52a1\u5668\uff0c\u5e76\u6307\u5b9a\u4e00\u4e2a\u4e3a <code>*:8080</code> \u7aef\u53e3\u7684\u9ed8\u8ba4\u670d\u52a1\u5668\uff0c\u53e6\u4e00\u4e2a\u4e3a <code>*:80</code> \u7aef\u53e3\u7684\u9ed8\u8ba4\u670d\u52a1\u5668\u3002</p> <pre><code>server {\nlisten       80;\nlisten       8080  default_server;\nserver_name  example.net;\n...\n}\n\nserver {\nlisten       80  default_server;\nlisten       8080;\nserver_name  example.org;\n...\n}\n</code></pre>"},{"location":"Introduction/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8D%E7%A7%B0/#_5","title":"\u56fd\u9645\u5316\u540d\u79f0","text":"<p>\u5e94\u4f7f\u7528 server_name \u6307\u4ee4\u4e2d\u7684ASCII\uff08Punycode\uff09\u8868\u793a\u6765\u6307\u5b9a\u56fd\u9645\u5316\u57df\u540d\uff08IDN\uff09</p> <pre><code>server {\nlisten       80;\nserver_name  xn--e1afmkfd.xn--80akhbyknj4f;  # \u043f\u0440\u0438\u043c\u0435\u0440.\u0438\u0441\u043f\u044b\u0442\u0430\u043d\u0438\u0435\n...\n}\n</code></pre>"},{"location":"Introduction/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8D%E7%A7%B0/#_6","title":"\u4f18\u5316","text":"<p>\u786e\u5207\u7684\u540d\u79f0\u3001\u4ee5\u661f\u53f7\u5f00\u5934\u7684\u901a\u914d\u7b26\u540d\u79f0\u548c\u4ee5\u661f\u53f7\u7ed3\u5c3e\u7684\u901a\u914d\u7b26\u540d\u79f0\u88ab\u5b58\u50a8\u5728\u7ed1\u5b9a\u5230\u76d1\u542c\u7aef\u53e3\u7684\u4e09\u79cd\u54c8\u5e0c\u8868\u4e2d\u3002\u54c8\u5e0c\u8868\u7684\u5927\u5c0f\u53ef\u4ee5\u5728\u914d\u7f6e\u9636\u6bb5\u4f18\u5316\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728 CPU \u7f13\u5b58\u672a\u547d\u4e2d\u7684\u6700\u4f4e\u60c5\u51b5\u4e0b\u627e\u5230\u540d\u79f0\u3002\u8bbe\u7f6e\u54c8\u5e0c\u8868\u7684\u5177\u4f53\u7ec6\u8282\u5728\u5355\u72ec\u7684 \u6587\u6863 \u4e2d\u63d0\u4f9b\u3002</p> <p>\u9996\u5148\u641c\u7d22\u786e\u5207\u7684\u540d\u79f0\u54c8\u5e0c\u8868\u3002\u5982\u679c\u4e3a\u627e\u5230\u540d\u79f0\uff0c\u5219\u4f1a\u641c\u7d22\u4ee5\u661f\u53f7\u5f00\u5934\u7684\u901a\u914d\u7b26\u540d\u79f0\u7684\u54c8\u5e0c\u8868\u3002\u5982\u679c\u8fd8\u662f\u6ca1\u6709\u627e\u5230\u540d\u79f0\uff0c\u5219\u641c\u7d22\u4ee5\u661f\u53f7\u7ed3\u5c3e\u7684\u901a\u914d\u7b26\u540d\u79f0\u54c8\u5e0c\u3002</p> <p>\u641c\u7d22\u901a\u914d\u7b26\u54c8\u5e0c\u8868\u6bd4\u641c\u7d22\u786e\u5207\u540d\u79f0\u7684\u54c8\u5e0c\u8868\u8981\u6162\uff0c\u56e0\u4e3a\u540d\u79f0\u662f\u901a\u8fc7\u57df\u90e8\u5206\u641c\u7d22\u7684\u3002\u8bf7\u6ce8\u610f\uff0c\u7279\u6b8a\u901a\u914d\u7b26\u683c\u5f0f <code>.example.org</code> \u5b58\u50a8\u5728\u901a\u914d\u7b26\u54c8\u5e0c\u8868\u4e2d\uff0c\u800c\u4e0d\u662f\u786e\u5207\u540d\u79f0\u54c8\u5e0c\u8868\u4e2d\u3002</p> <p>\u7531\u4e8e\u6b63\u5219\u8868\u8fbe\u5f0f\u662f\u6309\u987a\u5e8f\u9a8c\u8bc1\u7684\uff0c\u56e0\u6b64\u662f\u6700\u6162\u7684\u65b9\u6cd5\uff0c\u5e76\u4e14\u662f\u4e0d\u53ef\u6269\u5c55\u7684\u3002</p> <p>\u7531\u4e8e\u8fd9\u4e9b\u539f\u56e0\uff0c\u6700\u597d\u662f\u5c3d\u53ef\u80fd\u4f7f\u7528\u786e\u5207\u7684\u540d\u79f0\u3002\u4f8b\u5982\uff0c\u5982\u679c\u6700\u5e38\u89c1\u88ab\u8bf7\u6c42\u7684\u670d\u52a1\u5668\u540d\u79f0\u662f <code>example.org</code> \u548c <code>www.example.org</code>\uff0c\u5219\u660e\u786e\u5b9a\u4e49\u5b83\u4eec\u662f\u6700\u6709\u6548\u7684\uff1a</p> <pre><code>server {\nlisten       80;\nserver_name  example.org  www.example.org  *.example.org;\n...\n}\n</code></pre> <p>\u7b80\u5316\u5f62\u5f0f\uff1a</p> <pre><code>server {\nlisten       80;\nserver_name  .example.org;\n...\n}\n</code></pre> <p>\u5982\u679c\u5b9a\u4e49\u4e86\u5927\u91cf\u7684\u670d\u52a1\u5668\u540d\u79f0\uff0c\u6216\u8005\u5b9a\u4e49\u4e86\u975e\u5e38\u957f\u7684\u670d\u52a1\u5668\u540d\u79f0\uff0c\u5219\u53ef\u80fd\u9700\u8981\u8c03\u6574 <code>http</code> \u7ea7\u522b\u7684 server_names_hash_max_size \u548c server_names_hash_bucket_size \u6307\u4ee4\u3002server_names_hash_bucket_size \u6307\u4ee4\u7684\u9ed8\u8ba4\u503c\u53ef\u80fd\u7b49\u4e8e 32 \u6216\u8005 64 \u6216\u8005\u5176\u4ed6\u503c\u3002\u5177\u4f53\u53d6\u51b3\u4e8e CPU \u8d85\u9ad8\u901f\u7f13\u5b58\u50a8\u5668\u7ebf\u7684\u5927\u5c0f\u3002\u5982\u679c\u9ed8\u8ba4\u503c\u4e3a 32\uff0c\u5e76\u4e14\u670d\u52a1\u5668\u540d\u79f0\u5b9a\u4e49\u4e3a <code>too.long.server.name.example.org</code>\uff0c\u5219 nginx \u5c06\u65e0\u6cd5\u542f\u52a8\u5e76\u663e\u793a\u9519\u8bef\u4fe1\u606f\uff1a</p> <p><pre><code>could not build the server_names_hash,\nyou should increase server_names_hash_bucket_size: 32\n</code></pre> \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6307\u4ee4\u503c\u5e94\u8be5\u589e\u52a0\u5230 2 \u500d\uff1a</p> <p><pre><code>http {\nserver_names_hash_bucket_size  64;\n...\n</code></pre> \u5982\u679c\u5b9a\u4e49\u4e86\u5927\u91cf\u7684\u670d\u52a1\u5668\u540d\u79f0\uff0c\u5219\u4f1a\u663e\u793a\u53e6\u4e00\u4e2a\u9519\u8bef\u4fe1\u606f\uff1a</p> <p><pre><code>could not build the server_names_hash,\nyou should increase either server_names_hash_max_size: 512\nor server_names_hash_bucket_size: 32\n</code></pre> \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u9996\u5148\u5c1d\u8bd5\u5c06 server_names_hash_max_size \u8bbe\u7f6e\u4e3a\u63a5\u8fd1\u670d\u52a1\u5668\u540d\u79f0\u6570\u91cf\u7684\u6570\u503c\u3002\u5982\u679c\u8fd9\u6837\u6ca1\u6709\u7528\uff0c\u6216\u8005\u5982\u679c nginx \u7684\u542f\u52a8\u65f6\u95f4\u957f\u7684\u65e0\u6cd5\u5fcd\u53d7\uff0c\u90a3\u4e48\u8bf7\u5c1d\u8bd5\u589e\u52a0 server_names_hash_bucket_size \u7684\u503c\u3002</p> <p>\u5982\u679c\u670d\u52a1\u5668\u662f\u76d1\u542c\u7aef\u53e3\u7684\u552f\u4e00\u670d\u52a1\u5668\uff0c\u90a3\u4e48 nginx \u5c06\u4e0d\u4f1a\u9a8c\u8bc1\u670d\u52a1\u5668\u540d\u79f0\uff08\u5e76\u4e14\u4e0d\u4f1a\u4e3a\u76d1\u542c\u7aef\u53e3\u5efa\u7acb\u54c8\u5e0c\u8868\uff09\u3002\u4f46\u662f\uff0c\u6709\u4e00\u4e2a\u4f8b\u5916\u3002\u5982\u679c\u670d\u52a1\u5668\u540d\u79f0\u5177\u6709\u6355\u83b7\uff08captures\uff09\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5219 nginx \u5fc5\u987b\u6267\u884c\u8868\u8fbe\u5f0f\u624d\u80fd\u83b7\u53d6\u6355\u83b7\u3002</p>"},{"location":"Introduction/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8D%E7%A7%B0/#_7","title":"\u517c\u5bb9\u6027","text":"<ul> <li>\u81ea 0.9.4 \u8d77\uff0c\u652f\u6301\u7279\u6b8a\u7684\u670d\u52a1\u5668\u540d\u79f0 <code>$hostname</code>\u3002</li> <li>\u81ea 0.8.48 \u8d77\uff0c\u9ed8\u8ba4\u670d\u52a1\u5668\u540d\u79f0\u7684\u503c\u4e3a\u7a7a\u540d\u79f0 <code>\"\"</code>\u3002</li> <li>\u81ea 0.8.25 \u5176\uff0c\u5df2\u7ecf\u652f\u6301\u547d\u540d\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u670d\u52a1\u5668\u540d\u79f0\u6355\u83b7\u3002</li> <li>\u81ea 0.7.40 \u8d77\uff0c\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\u540d\u79f0\u6355\u83b7\u3002</li> <li>\u81ea 0.7.12 \u8d77\uff0c\u652f\u6301\u7a7a\u7684\u670d\u52a1\u5668\u540d\u79f0 <code>\"\"</code>\u3002</li> <li>\u81ea 0.6.25 \u8d77\uff0c\u652f\u6301\u4f7f\u7528\u901a\u914d\u7b26\u670d\u52a1\u5668\u540d\u79f0\u548c\u6b63\u5219\u8868\u8fbe\u5f0f\u4f5c\u4e3a\u7b2c\u4e00\u670d\u52a1\u5668\u540d\u79f0\u3002</li> <li>\u81ea 0.6.7 \u8d77\uff0c\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\u670d\u52a1\u540d\u79f0\u3002</li> <li>\u81ea 0.6.0 \u8d77\uff0c\u652f\u6301\u7c7b\u4f3c <code>example.*</code> \u7684\u901a\u914d\u7b26\u3002</li> <li>\u81ea 0.3.18 \u8d77\uff0c\u652f\u6301\u7c7b\u4f3c <code>.example.org</code>\u3002</li> <li>\u81ea 0.1.13 \u8d77\uff0c\u652f\u6301\u7c7b\u4f3c <code>*.example.org</code> \u7684\u901a\u914d\u7b26\u3002</li> </ul> <p>\u7531 Igor Sysoev \u4e66\u5199\uff0c\u7531 Brian Mercer \u7f16\u8f91</p>"},{"location":"Introduction/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8D%E7%A7%B0/#_8","title":"\u539f\u6587","text":"<ul> <li>http://nginx.org/en/docs/http/server_names.html</li> </ul>"},{"location":"Introduction/%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97%E5%88%B0syslog/","title":"\u8bb0\u5f55\u65e5\u5fd7\u5230 syslog","text":"<p>error_log \u548c access_log \u6307\u4ee4\u652f\u6301\u628a\u65e5\u5fd7\u8bb0\u5f55\u5230 syslog\u3002\u4ee5\u4e0b\u914d\u7f6e\u53c2\u6570\u5c06\u4f7f nginx \u65e5\u5fd7\u8bb0\u5f55\u5230 syslog\uff1a</p> <pre><code>server=address\n</code></pre> <p>\u5b9a\u4e49 syslog \u670d\u52a1\u5668\u7684\u5730\u5740\uff0c\u53ef\u4ee5\u5c06\u8be5\u5730\u5740\u6307\u5b9a\u4e3a\u9644\u5e26\u53ef\u9009\u7aef\u53e3\u7684\u57df\u540d\u6216\u8005 IP\uff0c\u6216\u8005\u6307\u5b9a\u4e3a \u201cunix:\u201d \u524d\u7f00\u4e4b\u540e\u8ddf\u7740\u4e00\u4e2a\u7279\u5b9a\u7684 UNIX \u57df\u5957\u63a5\u5b57\u8def\u5f84\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u7aef\u53e3\uff0c\u5219\u4f7f\u7528 UDP \u7684 514 \u7aef\u53e3\u3002\u5982\u679c\u57df\u540d\u89e3\u6790\u4e3a\u591a\u4e2a IP \u5730\u5740\uff0c\u5219\u4f7f\u7528\u7b2c\u4e00\u4e2a\u5730\u5740\u3002</p> <pre><code>facility=string\n</code></pre> <p>\u8bbe\u7f6e syslog \u7684\u6d88\u606f facility\uff08\u8bbe\u5907\uff09\uff0cRFC3164 \u4e2d\u5b9a\u4e49\uff0cfacility\u53ef\u4ee5\u662f <code>kern</code>\uff0c<code>user</code>\uff0c<code>mail</code>\uff0c<code>daemon</code>\uff0c<code>auth</code>\uff0c<code>intern</code>\uff0c<code>lpr</code>\uff0c<code>news</code>\uff0c<code>uucp</code>\uff0c<code>clock</code>\uff0c<code>authpriv</code>\uff0c<code>ftp</code>\uff0c<code>ntp</code>\uff0c<code>audit</code>\uff0c<code>alert</code>\uff0c<code>cron</code>\uff0c<code>local0</code>\uff0c<code>local7</code> \u4e2d\u7684\u4e00\u4e2a\uff0c\u9ed8\u8ba4\u662f <code>local7</code>\u3002</p> <pre><code>severity=string\n</code></pre> <p>\u8bbe\u7f6e access_log \u7684\u6d88\u606f\u4e25\u91cd\u7a0b\u5ea6\uff0c\u5728 RFC3164 \u4e2d\u5b9a\u4e49\u3002\u53ef\u80fd\u503c\u4e0e error_log \u6307\u4ee4\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\uff08 <code>level</code>\uff0c\u7ea7\u522b\uff09\u76f8\u540c\uff0c\u9ed8\u8ba4\u662f <code>info</code>\u3002\u9519\u8bef\u6d88\u606f\u7684\u4e25\u91cd\u7a0b\u5ea6\u7531 nginx \u786e\u5b9a\uff0c\u56e0\u6b64\u5728 <code>error_log</code> \u6307\u4ee4\u4e2d\u5c06\u5ffd\u7565\u8be5\u53c2\u6570\u3002</p> <pre><code>tag=string\n</code></pre> <p>\u8bbe\u7f6e syslog \u6d88\u606f\u6807\u7b7e\u3002\u9ed8\u8ba4\u662f <code>nginx</code>\u3002</p> <pre><code>nohostname\n</code></pre> <p>\u7981\u6b62\u5c06 <code>hostname</code> \u57df\u6dfb\u52a0\u5230 syslog \u7684\u6d88\u606f\uff081.9.7\uff09\u5934\u4e2d\u3002</p> <p>syslog\u914d\u7f6e\u793a\u4f8b\uff1a</p> <pre><code>error_log syslog:server=192.168.1.1 debug;\n\naccess_log syslog:server=unix:/var/log/nginx.sock,nohostname;\naccess_log syslog:server=[2001:db8::1]:12345,facility=local7,tag=nginx,severity=info combined;\n</code></pre> <p>\u8bb0\u5f55\u65e5\u5fd7\u5230 syslog \u7684\u529f\u80fd\u81ea\u4ece 1.7.2 \u7248\u672c\u5f00\u59cb\u53ef\u7528\u3002\u4f5c\u4e3a\u6211\u4eec \u5546\u4e1a\u8ba2\u9605 \u7684\u4e00\u90e8\u5206\uff0c\u8bb0\u5f55\u65e5\u5fd7\u5230 syslog \u7684\u529f\u80fd\u4ece 1.5.3 \u5f00\u59cb\u53ef\u7528\u3002</p>"},{"location":"Introduction/%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97%E5%88%B0syslog/#_1","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/syslog.html</li> </ul>"},{"location":"Introduction/%E8%AE%BE%E7%BD%AE%E5%93%88%E5%B8%8C/","title":"\u8bbe\u7f6e\u54c8\u5e0c","text":"<p>\u4e3a\u4e86\u5feb\u901f\u5904\u7406\u9759\u6001\u6570\u636e\u96c6\uff0c\u5982\u670d\u52a1\u5668\u540d\u79f0\u3001map \u6307\u4ee4\u503c\u3001MIME \u7c7b\u578b\u3001\u8bf7\u6c42\u5934\u5b57\u7b26\u4e32\u7684\u540d\u79f0\uff0cnginx \u4f7f\u7528\u4e86\u54c8\u5e0c\u8868\u3002\u5728\u5f00\u59cb\u548c\u6bcf\u6b21\u91cd\u65b0\u914d\u7f6e\u65f6\uff0cnginx \u5c3d\u53ef\u80fd\u9009\u62e9\u6700\u5c0f\u7684\u54c8\u5e0c\u8868\uff0c\u4ee5\u4fbf\u5b58\u50a8\u5177\u6709\u76f8\u540c\u6563\u5217\u503c\u7684\u5b58\u50a8\u6876\u5927\u5c0f\u4e0d\u4f1a\u8d85\u8fc7\u914d\u7f6e\u53c2\u6570\uff08\u54c8\u5e0c\u6876\u5927\u5c0f\uff09\u3002\u8868\u7684\u5927\u5c0f\u4ee5\u6876\u4e3a\u5355\u4f4d\u3002\u8c03\u6574\u662f\u6301\u7eed\u7684\uff0c\u76f4\u5230\u8868\u7684\u5927\u5c0f\u8d85\u8fc7\u54c8\u5e0c\u7684\u6700\u5927\u5927\u5c0f\u53c2\u6570\u3002\u5927\u591a\u6570\u54c8\u5e0c\u5177\u6709\u4fee\u6539\u8fd9\u4e9b\u53c2\u6570\u5bf9\u5e94\u7684\u6307\u4ee4\uff0c\u4f8b\u5982\uff0c\u5bf9\u4e8e\u670d\u52a1\u5668\u540d\u79f0\u54c8\u5e0c\uff0c\u5b83\u4eec\u662f server_names_hash_max \u548c server_names_hash_bucket_size\u3002</p> <p>\u54c8\u5e0c\u6876\u5927\u5c0f\u53c2\u6570\u4e0e\u5904\u7406\u5668\u7684\u9ad8\u901f\u7f13\u5b58\u7ebf\u5927\u5c0f\u7684\u500d\u6570\u5bf9\u9f50\u3002\u53ef\u4ee5\u901a\u8fc7\u51cf\u5c11\u5185\u5b58\u8bbf\u95ee\u7684\u6b21\u6570\u6765\u52a0\u5feb\u73b0\u4ee3\u5904\u7406\u5668\u7684\u54c8\u5e0c\u952e\u641c\u7d22\u901f\u5ea6\u3002\u5982\u679c\u54c8\u5e0c\u6876\u5927\u5c0f\u7b49\u4e8e\u5904\u7406\u5668\u7684\u9ad8\u901f\u7f13\u5b58\u7ebf\u5927\u5c0f\uff0c\u5219\u54c8\u5e0c\u952e\u641c\u7d22\u671f\u95f4\u5185\u5b58\u8bbf\u95ee\u6b21\u6570\u6700\u574f\u7684\u60c5\u51b5\u4e0b\u5c06\u6709\u4e24\u6b21 \u2014\u2014 \u4e00\u662f\u8ba1\u7b97\u6876\u5730\u5740\uff0c\u4e8c\u662f\u5728\u6876\u5185\u641c\u7d22\u54c8\u5e0c\u952e\u671f\u95f4\u3002\u56e0\u6b64\uff0c\u5982\u679c nginx \u53d1\u51fa\u6d88\u606f\u8bf7\u6c42\u589e\u52a0\u5230\u54c8\u5e0c\u7684\u6700\u5927\u5927\u5c0f\u6216\u8005\u54c8\u5e0c\u6876\u7684\u5927\u5c0f\uff0c\u90a3\u4e48\u9996\u5148\u5e94\u8be5\u589e\u52a0\u7b2c\u4e00\u4e2a\u53c2\u6570\u3002</p>"},{"location":"Introduction/%E8%AE%BE%E7%BD%AE%E5%93%88%E5%B8%8C/#_2","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/hash.html</li> </ul>"},{"location":"Introduction/%E8%B0%83%E8%AF%95%E6%97%A5%E5%BF%97/","title":"\u8c03\u8bd5\u65e5\u5fd7","text":"<ul> <li>\u4e3a\u6307\u5b9a\u5ba2\u6237\u7aef\u505a\u8c03\u8bd5\u65e5\u5fd7</li> <li>\u8bb0\u5f55\u65e5\u5fd7\u5230\u5faa\u73af\u5185\u5b58\u7f13\u51b2\u533a</li> </ul> <p>\u8981\u5f00\u542f\u8c03\u8bd5\u65e5\u5fd7\uff0c\u9700\u8981\u5728\u7f16\u8bd1 Nignx \u65f6\u589e\u52a0\u5982\u4e0b\u914d\u7f6e\uff1a</p> <pre><code>./configure --with-debug ...\n</code></pre> <p>\u4e4b\u540e\u5e94\u8be5\u4f7f\u7528 error_log \u6307\u4ee4\u8bbe\u7f6e\u8c03\u8bd5\u7ea7\u522b\uff1a</p> <pre><code>error_log /path/to/log debug;\n</code></pre> <p>\u8981\u9a8c\u8bc1 nginx \u662f\u5426\u5df2\u7ecf\u914d\u7f6e\u4e3a\u652f\u6301\u8c03\u8bd5\u529f\u80fd\uff0c\u8bf7\u8fd0\u884c <code>nginx -V</code> \u547d\u4ee4\uff1a</p> <pre><code>configure arguments: --with-debug ...\n</code></pre> <p>\u9884\u6784\u5efa Linux \u5305\u4e3a nginx-debug \u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u8c03\u8bd5\u65e5\u5fd7\u63d0\u4f9b\u4e86\u5f00\u7bb1\u5373\u7528\u7684\u652f\u6301\uff0c\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\u8fd0\u884c\u3002</p> <pre><code>service nginx stop\nservice nginx-debug start\n</code></pre> <p>\u4e4b\u540e\u8bbe\u7f6e <code>debug</code> \u7ea7\u522b\u3002Windows \u7684 nginx \u5728\u7f16\u8bd1\u65f6\u5c31\u5df2\u7ecf\u652f\u6301\u8c03\u8bd5\u65e5\u5fd7\uff0c\u56e0\u6b64\u53ea\u9700\u8bbe\u7f6e <code>debug</code> \u7ea7\u522b\u5373\u53ef\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u91cd\u65b0\u5b9a\u4e49\u65e5\u5fd7\u800c\u4e0d\u6307\u5b9a <code>debug</code> \u7ea7\u522b\u5c06\u7981\u6b62\u8c03\u8bd5\u65e5\u5fd7\u3002\u5728\u4e0b\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u91cd\u65b0\u5b9a\u4e49 <code>server</code> \u4e0a\u7684\u65e5\u5fd7\u7ea7\u522b\uff0cnginx \u5c06\u4e0d\u4f1a\u5728\u6b64\u670d\u52a1\u5668\u4e0a\u505a\u65e5\u5fd7\u8c03\u8bd5\u3002</p> <pre><code>error_log /path/to/log debug;\n\nhttp {\nserver {\nerror_log /path/to/log;\n...\n</code></pre> <p>\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u91cd\u65b0\u5b9a\u4e49\u65e5\u5fd7\u7ea7\u522b\u5e94\u8be5\u88ab\u6ce8\u91ca\u6389\uff0c\u6216\u8005\u660e\u786e\u6307\u5b9a\u65e5\u5fd7\u4e3a <code>debug</code> \u7ea7\u522b\u3002</p> <pre><code>error_log /path/to/log debug;\n\nhttp {\nserver {\nerror_log /path/to/log debug;\n...\n</code></pre>"},{"location":"Introduction/%E8%B0%83%E8%AF%95%E6%97%A5%E5%BF%97/#_2","title":"\u4e3a\u6307\u5b9a\u5ba2\u6237\u7aef\u505a\u8c03\u8bd5\u65e5\u5fd7","text":"<p>\u4e5f\u53ef\u4ee5\u4ec5\u4e3a\u9009\u5b9a\u7684\u5ba2\u6237\u7aef\u5730\u5740\u542f\u7528\u8c03\u8bd5\u65e5\u5fd7\uff1a</p> <pre><code>error_log /path/to/log;\n\nevents {\ndebug_connection 192.168.1.1;\ndebug_connection 192.168.10.0/24;\n}\n</code></pre>"},{"location":"Introduction/%E8%B0%83%E8%AF%95%E6%97%A5%E5%BF%97/#_3","title":"\u8bb0\u5f55\u65e5\u5fd7\u5230\u5faa\u73af\u5185\u5b58\u7f13\u51b2\u533a","text":"<p>\u8c03\u8bd5\u65e5\u5fd7\u53ef\u4ee5\u88ab\u5199\u5165\u5230\u5faa\u73af\u5185\u5b58\u7f13\u51b2\u533a\u4e2d\uff1a</p> <pre><code>error_log memory:32m debug;\n</code></pre> <p>\u5728 <code>debug</code> \u7ea7\u522b\u5c06\u65e5\u5fd7\u5199\u5165\u5230\u5185\u5b58\u7f13\u51b2\u533a\u4e2d\uff0c\u5373\u4f7f\u5728\u9ad8\u8d1f\u8f7d\u60c5\u51b5\u4e0b\u4e5f\u4e0d\u4f1a\u5bf9\u6027\u80fd\u4ea7\u751f\u91cd\u5927\u7684\u5f71\u54cd\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b <code>gdb</code> \u811a\u672c\u6765\u63d0\u53d6\u65e5\u5fd7\uff1a</p> <pre><code>set $log = ngx_cycle-&gt;log\n\nwhile $log-&gt;writer != ngx_log_memory_writer\n    set $log = $log-&gt;next\nend\n\nset $buf = (ngx_log_memory_buf_t *) $log-&gt;wdata\ndump binary memory debug_log.txt $buf-&gt;start $buf-&gt;end\n</code></pre>"},{"location":"Introduction/%E8%B0%83%E8%AF%95%E6%97%A5%E5%BF%97/#_4","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/debugging_log.html</li> </ul>"},{"location":"Introduction/%E8%BF%9E%E6%8E%A5%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F/","title":"\u8fde\u63a5\u5904\u7406\u65b9\u5f0f","text":"<p>nginx \u652f\u6301\u591a\u79cd\u8fde\u63a5\u5904\u7406\u65b9\u5f0f\uff0c\u6bcf\u4e00\u79cd\u65b9\u5f0f\u662f\u5426\u53ef\u7528\u53d6\u51b3\u4e8e\u6240\u7528\u7684\u5e73\u53f0\u3002\u5728\u652f\u6301\u51e0\u79cd\u65b9\u5f0f\u7684\u5e73\u53f0\u4e0a\uff0cnginx \u4f1a\u81ea\u52a8\u9009\u62e9\u6700\u6709\u6548\u7684\u65b9\u5f0f\uff0c\u7136\u800c\uff0c\u5982\u679c\u60a8\u9700\u8981\u660e\u786e\u6307\u5b9a\u4f7f\u7528\u54ea\u4e00\u79cd\u65b9\u5f0f\uff0c\u53ef\u4ee5\u4f7f\u7528 use \u6307\u4ee4\u6307\u5b9a\u3002</p> <p>\u652f\u6301\u4ee5\u4e0b\u96c6\u4e2d\u5904\u7406\u65b9\u5f0f\uff1a</p> <ul> <li>select\uff0c\u6807\u51c6\u65b9\u5f0f\u3002\u5f53\u5e73\u53f0\u4e0a\u7f3a\u4e4f\u5176\u4ed6\u6709\u6548\u7684\u65b9\u5f0f\u65f6\u81ea\u52a8\u6784\u5efa\u3002<code>--with-select-module</code> \u548c <code>-without-select_module</code> \u914d\u7f6e\u53c2\u6570\u5f00\u542f\u6216\u8005\u7981\u7528\u6b64\u6a21\u5757\u6784\u5efa\u3002</li> <li>poll\uff0c\u6807\u51c6\u65b9\u5f0f\uff0c\u5f53\u5e73\u53f0\u4e0a\u7f3a\u4e4f\u5176\u5b83\u6709\u6548\u7684\u5904\u7406\u65b9\u5f0f\u65f6\u81ea\u52a8\u6784\u5efa\u6b64\u6a21\u5757\u3002<code>-with-poll_moudle</code> \u548c <code>-without-poll_module</code> \u914d\u7f6e\u9879\u5f00\u542f\u6216\u8005\u7981\u7528\u6b64\u6a21\u5757\u6784\u5efa\u3002</li> <li>kqueue\uff0c\u5728 FreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0, \u548c macOS \u4f7f\u7528\u6709\u6548\u3002</li> <li>epoll\uff0c\u5728 Linux 2.6+ \u4e0a\u4f7f\u7528\u6709\u6548\u3002</li> </ul> <p>\u4ece 1.11.3 \u8d77\u652f\u6301 EPOLLRDHUP\uff08Linux 2.6.17\uff0cglibc 2.8\uff09\u548c EPOLLEXCLUSIVE\uff08Linux 4.5\uff0cglibc 2.24\uff09\u6807\u5fd7\u3002\u4e00\u4e9b\u7c7b\u4f3c\u4e8e SuSE 8.2 \u8fd9\u6837\u7684\u8001\u7248\u672c\u63d0\u4f9b\u4e86\u5bf9 2.4 \u5185\u6838\u652f\u6301 epll \u7684\u8865\u4e01\u3002</p> <ul> <li>/dev/poll\uff0c\u5728 Solaris 7 11/99+\uff0cHP / UX 11.22+\uff08eventport\uff09\uff0cIRIX 6.5.15+ \u548c Tru64 UNIX 5.1A+ \u6709\u6548\u3002</li> <li>eventport\uff0c\u4e8b\u4ef6\u7aef\u53e3\uff0c\u5728 Solaris 10+ \u6709\u6548\uff08\u7531\u4e8e\u5df2\u77e5\u95ee\u9898\uff0c\u63a8\u8350\u4f7f\u7528 <code>/dev/poll</code> \u65b9\u5f0f\u4ee3\u66ff\uff09\u3002</li> </ul>"},{"location":"Introduction/%E8%BF%9E%E6%8E%A5%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F/#_2","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/events.html</li> </ul>"},{"location":"Introduction/%E9%85%8D%E7%BD%AEHTTPS%E6%9C%8D%E5%8A%A1%E5%99%A8/","title":"\u914d\u7f6e HTTPS \u670d\u52a1\u5668","text":"<p>\u8981\u914d\u7f6e HTTPS \u670d\u52a1\u5668\uff0c\u5fc5\u987b\u5728 server \u5757\u4e2d\u7684 \u76d1\u542c\u5957\u63a5\u5b57 \u4e0a\u542f\u7528 <code>ssl</code> \u53c2\u6570\uff0c\u5e76\u4e14\u6307\u5b9a\u670d\u52a1\u5668\u8bc1\u4e66 \u548c \u79c1\u94a5\u6587\u4ef6 \u7684\u4f4d\u7f6e\uff1a</p> <pre><code>server {\nlisten              443 ssl;\nserver_name         www.example.com;\nssl_certificate     www.example.com.crt;\nssl_certificate_key www.example.com.key;\nssl_protocols       TLSv1 TLSv1.1 TLSv1.2;\nssl_ciphers         HIGH:!aNULL:!MD5;\n...\n}\n</code></pre> <p>\u670d\u52a1\u5668\u8bc1\u4e66\u662f\u4e00\u4e2a\u516c\u5171\u5b9e\u4f53\u3002\u5b83\u88ab\u53d1\u9001\u5230\u6bcf\u4e2a\u8fde\u63a5\u5230\u670d\u52a1\u5668\u7684\u5ba2\u6237\u7aef\u3002\u79c1\u94a5\u662f\u4e00\u4e2a\u5b89\u5168\u5b9e\u4f53\uff0c\u5b58\u50a8\u5728\u4e00\u4e2a\u8bbf\u95ee\u53d7\u9650\u7684\u6587\u4ef6\u4e2d\uff0c\u4f46\u662f\u5b83\u5bf9 nginx \u7684\u4e3b\u8fdb\u7a0b\u5fc5\u987b\u662f\u53ef\u8bfb\u7684\u3002\u79c1\u94a5\u4e5f\u53ef\u4ee5\u5b58\u50a8\u5728\u4e0e\u8bc1\u4e66\u76f8\u540c\u7684\u6587\u4ef6\u4e2d\uff1a <pre><code>ssl_certificate     www.example.com.cert;\nssl_certificate_key www.example.com.cert;\n</code></pre></p> <p>\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6587\u4ef6\u7684\u8bbf\u95ee\u4e5f\u5e94\u8be5\u88ab\u9650\u5236\u3002\u867d\u7136\u8bc1\u4e66\u548c\u5bc6\u94a5\u5b58\u50a8\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u4f46\u53ea\u6709\u8bc1\u4e66\u80fd\u88ab\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 ssl_protocols \u548c ssl_ciphers \u6307\u4ee4\u6765\u9650\u5236\u8fde\u63a5\uff0c\u4f7f\u5176\u4ec5\u5305\u62ec SSL/TLS \u7684\u7248\u672c\u548c\u5bc6\u7801\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnginx \u4f7f\u7528\u7248\u672c\u4e3a <code>ssl_protocols TLSv1 TLSv1.1 TLSv1.2</code>\uff0c\u5bc6\u7801\u4e3a <code>ssl_ciphers HIGH:!aNULL:!MD5</code>\uff0c\u56e0\u6b64\u901a\u5e38\u4e0d\u9700\u8981\u914d\u7f6e\u5b83\u4eec\u3002\u8bf7\u6ce8\u610f\uff0c\u8fd9\u4e9b\u6307\u4ee4\u7684\u9ed8\u8ba4\u503c\u5df2\u7ecf\u88ab \u66f4\u6539 \u591a\u6b21\u3002</p>"},{"location":"Introduction/%E9%85%8D%E7%BD%AEHTTPS%E6%9C%8D%E5%8A%A1%E5%99%A8/#https_1","title":"HTTPS \u670d\u52a1\u5668\u4f18\u5316","text":"<p>SSL \u64cd\u4f5c\u4f1a\u6d88\u8017\u989d\u5916\u7684 CPU \u8d44\u6e90\u3002\u5728\u591a\u5904\u7406\u5668\u7cfb\u7edf\u4e0a\uff0c\u5e94\u8be5\u8fd0\u884c\u591a\u4e2a \u5de5\u4f5c\u8fdb\u7a0b\uff08worker process\uff09\uff0c\u4e0d\u5f97\u5c11\u4e8e\u53ef\u7528 CPU \u6838\u5fc3\u7684\u6570\u91cf\u3002\u5927\u591a\u6570 CPU \u5bc6\u96c6\u578b\u64cd\u4f5c\u662f\u53d1\u751f\u5728 SSL \u63e1\u624b\u65f6\u3002\u6709\u4e24\u79cd\u65b9\u6cd5\u53ef\u4ee5\u6700\u5927\u7a0b\u5ea6\u5730\u51cf\u5c11\u6bcf\u4e2a\u5ba2\u6237\u7aef\u6267\u884c\u8fd9\u4e9b\u64cd\u4f5c\u7684\u6b21\u6570\u3002\u9996\u5148\uff0c\u542f\u7528 keepalive \u8fde\u63a5\uff0c\u901a\u8fc7\u4e00\u4e2a\u8fde\u63a5\u6765\u53d1\u9001\u591a\u4e2a\u8bf7\u6c42\uff0c\u7b2c\u4e8c\u4e2a\u662f\u590d\u7528 SSL \u4f1a\u8bdd\u53c2\u6570\uff0c\u907f\u514d\u76f8\u540c\u7684\u548c\u540e\u7eed\u7684\u8fde\u63a5\u53d1\u751f SSL \u63e1\u624b\u3002\u4f1a\u8bdd\u5b58\u50a8\u5728\u5de5\u4f5c\u8fdb\u7a0b\u95f4\u5171\u4eab\u7684 SSL \u4f1a\u8bdd\u7f13\u5b58\u4e2d\uff0c\u7531 ssl_session_cache \u6307\u4ee4\u914d\u7f6e\u30021MB \u7f13\u5b58\u5305\u542b\u7ea6 4000 \u4e2a\u4f1a\u8bdd\u3002\u9ed8\u8ba4\u7f13\u5b58\u8d85\u65f6\u65f6\u95f4\u4e3a 5 \u5206\u949f\uff0c\u53ef\u4ee5\u7528 ssl_session_timeout \u6307\u4ee4\u6765\u589e\u52a0\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u4f18\u5316\u5177\u6709 10MB \u5171\u4eab\u4f1a\u8bdd\u7f13\u5b58\u7684\u591a\u6838\u7cfb\u7edf\u7684\u914d\u7f6e\u793a\u4f8b\uff1a</p> <pre><code>worker_processes auto;\n\nhttp {\nssl_session_cache   shared:SSL:10m;\nssl_session_timeout 10m;\n\nserver {\nlisten              443 ssl;\nserver_name         www.example.com;\nkeepalive_timeout   70;\n\nssl_certificate     www.example.com.crt;\nssl_certificate_key www.example.com.key;\nssl_protocols       TLSv1 TLSv1.1 TLSv1.2;\nssl_ciphers         HIGH:!aNULL:!MD5;\n...\n</code></pre>"},{"location":"Introduction/%E9%85%8D%E7%BD%AEHTTPS%E6%9C%8D%E5%8A%A1%E5%99%A8/#ssl","title":"SSL \u8bc1\u4e66\u94fe","text":"<p>\u67d0\u4e9b\u6d4f\u89c8\u5668\u53ef\u80fd\u4f1a\u4e0d\u627f\u8ba4\u7531\u77e5\u540d\u8bc1\u4e66\u9881\u53d1\u673a\u6784\u7b7e\u53d1\u7684\u8bc1\u4e66\uff0c\u800c\u5176\u4ed6\u6d4f\u89c8\u5668\u53ef\u80fd\u4f1a\u63a5\u53d7\u8be5\u8bc1\u4e66\u3002\u4e4b\u6240\u4ee5\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\uff0c\u662f\u56e0\u4e3a\u9881\u53d1\u673a\u6784\u5df2\u7ecf\u5728\u7279\u5b9a\u6d4f\u89c8\u5668\u5206\u53d1\u4e86\u4e00\u4e2a\u4e2d\u95f4\u8bc1\u4e66\uff0c\u8be5\u8bc1\u4e66\u4e0d\u5b58\u5728\u4e8e\u77e5\u540d\u53ef\u4fe1\u8bc1\u4e66\u9881\u53d1\u673a\u6784\u7684\u8bc1\u4e66\u5e93\u4e2d\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6743\u5a01\u673a\u6784\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u94fe\u5f0f\u8bc1\u4e66\uff0c\u8fd9\u4e9b\u8bc1\u4e66\u5e94\u8be5\u4e0e\u5df2\u7b7e\u540d\u7684\u670d\u52a1\u5668\u8bc1\u4e66\u76f8\u8fde\u3002\u670d\u52a1\u5668\u8bc1\u4e66\u5fc5\u987b\u51fa\u73b0\u5728\u7ec4\u5408\u6587\u4ef6\u4e2d\u7684\u94fe\u5f0f\u8bc1\u4e66\u4e4b\u524d\uff1a</p> <pre><code>$ cat www.example.com.crt bundle.crt &gt; www.example.com.chained.crt\n</code></pre> <p>\u5728 ssl_certificate \u6307\u4ee4\u4e2d\u4f7f\u7528\u751f\u6210\u7684\u6587\u4ef6\uff1a</p> <pre><code>server {\nlisten              443 ssl;\nserver_name         www.example.com;\nssl_certificate     www.example.com.chained.crt;\nssl_certificate_key www.example.com.key;\n...\n}\n</code></pre> <p>\u5982\u679c\u670d\u52a1\u5668\u8bc1\u4e66\u4e0e\u6346\u7ed1\u7684\u94fe\u5f0f\u8bc1\u4e66\u7684\u76f8\u8fde\u987a\u5e8f\u9519\u8bef\uff0cnginx \u5c06\u65e0\u6cd5\u542f\u52a8\u5e76\u663e\u793a\u9519\u8bef\u6d88\u606f\uff1a</p> <pre><code>SSL_CTX_use_PrivateKey_file(\" ... /www.example.com.key\") failed\n   (SSL: error:0B080074:x509 certificate routines:\n    X509_check_private_key:key values mismatch)\n</code></pre> <p>\u56e0\u4e3a nginx \u5df2\u5c1d\u8bd5\u4f7f\u7528\u79c1\u94a5\u548c\u6346\u7ed1\u7684\u7b2c\u4e00\u4e2a\u8bc1\u4e66\u800c\u4e0d\u662f\u670d\u52a1\u5668\u8bc1\u4e66\u3002</p> <p>\u6d4f\u89c8\u5668\u901a\u5e38\u4f1a\u5b58\u50a8\u4ed6\u4eec\u6536\u5230\u7684\u4e2d\u95f4\u8bc1\u4e66\uff0c\u8fd9\u4e9b\u8bc1\u4e66\u7531\u53d7\u4fe1\u4efb\u7684\u673a\u6784\u7b7e\u540d\uff0c\u56e0\u6b64\u79ef\u6781\u4f7f\u7528\u8fd9\u4e9b\u5b58\u50a8\u8bc1\u4e66\u7684\u6d4f\u89c8\u5668\u53ef\u80fd\u5df2\u7ecf\u5177\u6709\u6240\u9700\u7684\u4e2d\u95f4\u8bc1\u4e66\uff0c\u4e0d\u4f1a\u53d1\u751f\u4e0d\u627f\u8ba4\u6ca1\u6709\u94fe\u63a5\u6346\u7ed1\u53d1\u9001\u7684\u8bc1\u4e66\u7684\u60c5\u51b5\u3002\u53ef\u4ee5\u4f7f\u7528 openssl \u547d\u4ee4\u884c\u5de5\u5177\u6765\u786e\u4fdd\u670d\u52a1\u5668\u53d1\u9001\u5b8c\u6574\u7684\u8bc1\u4e66\u94fe\uff0c\u4f8b\u5982\uff1a</p> <pre><code>$ openssl s_client -connect www.godaddy.com:443\n...\nCertificate chain\n 0 s:/C=US/ST=Arizona/L=Scottsdale/1.3.6.1.4.1.311.60.2.1.3=US\n     /1.3.6.1.4.1.311.60.2.1.2=AZ/O=GoDaddy.com, Inc\n     /OU=MIS Department/CN=www.GoDaddy.com\n     /serialNumber=0796928-7/2.5.4.15=V1.0, Clause 5.(b)\ni:/C=US/ST=Arizona/L=Scottsdale/O=GoDaddy.com, Inc.\n     /OU=http://certificates.godaddy.com/repository\n     /CN=Go Daddy Secure Certification Authority\n     /serialNumber=07969287\n1 s:/C=US/ST=Arizona/L=Scottsdale/O=GoDaddy.com, Inc.\n     /OU=http://certificates.godaddy.com/repository\n     /CN=Go Daddy Secure Certification Authority\n     /serialNumber=07969287\ni:/C=US/O=The Go Daddy Group, Inc.\n     /OU=Go Daddy Class 2 Certification Authority\n 2 s:/C=US/O=The Go Daddy Group, Inc.\n     /OU=Go Daddy Class 2 Certification Authority\n   i:/L=ValiCert Validation Network/O=ValiCert, Inc.\n     /OU=ValiCert Class 2 Policy Validation Authority\n     /CN=http://www.valicert.com//emailAddress=info@valicert.com\n...\n</code></pre> <p>\u5728\u672c\u793a\u4f8b\u4e2d\uff0cwww.GoDaddy.com \u670d\u52a1\u5668\u8bc1\u4e66 \uff030 \u7684\u4e3b\u4f53\uff08\u201cs\u201d\uff09\u7531\u53d1\u884c\u673a\u6784\uff08\u201ci\u201d\uff09\u7b7e\u540d\uff0c\u53d1\u884c\u673a\u6784\u672c\u8eab\u662f\u8bc1\u4e66 \uff031 \u7684\u4e3b\u4f53\uff0c\u662f\u7531\u77e5\u540d\u53d1\u884c\u673a\u6784 ValiCert, Inc. \u7b7e\u7f72\u7684\u8bc1\u4e66 \uff032 \u7684\u4e3b\u4f53\uff0c\u5176\u8bc1\u4e66\u5b58\u50a8\u5728\u6d4f\u89c8\u5668\u7684\u5185\u7f6e\u8bc1\u4e66\u5e93\u4e2d\u3002</p> <p>\u5982\u679c\u6ca1\u6709\u6dfb\u52a0\u8bc1\u4e66\u5305\uff08certificate bundle\uff09\uff0c\u5c06\u4ec5\u663e\u793a\u670d\u52a1\u5668\u8bc1\u4e66 \uff030\u3002</p>"},{"location":"Introduction/%E9%85%8D%E7%BD%AEHTTPS%E6%9C%8D%E5%8A%A1%E5%99%A8/#httphttps","title":"HTTP/HTTPS \u670d\u52a1\u5668","text":"<p>\u53ef\u4ee5\u914d\u7f6e\u5355\u4e2a\u670d\u52a1\u5668\u6765\u5904\u7406 HTTP \u548c HTTPS \u8bf7\u6c42\uff1a</p> <pre><code>server {\nlisten              80;\nlisten              443 ssl;\nserver_name         www.example.com;\nssl_certificate     www.example.com.crt;\nssl_certificate_key www.example.com.key;\n...\n}\n</code></pre> <p>\u5728 0.7.14 \u4e4b\u524d\uff0c\u65e0\u6cd5\u4e3a\u5404\u4e2a socket \u9009\u62e9\u6027\u5730\u542f\u7528 SSL\uff0c\u5982\u4e0a\u6240\u793a\u3002\u53ea\u80fd\u4f7f\u7528 ssl \u6307\u4ee4\u4e3a\u6574\u4e2a\u670d\u52a1\u5668\u542f\u7528 SSL\uff0c\u4ece\u800c\u65e0\u6cd5\u8bbe\u7f6e\u5355\u4e2a HTTP/HTTPS \u670d\u52a1\u5668\u3002\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0 listen \u6307\u4ee4\u7684 ssl \u53c2\u6570\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u56e0\u6b64\uff0c\u4e0d\u5efa\u8bae\u5728\u73b0\u5728\u7684\u7248\u672c\u4e2d\u4f7f\u7528 ssl \u6307\u4ee4\u3002</p>"},{"location":"Introduction/%E9%85%8D%E7%BD%AEHTTPS%E6%9C%8D%E5%8A%A1%E5%99%A8/#https_2","title":"\u57fa\u4e8e\u540d\u79f0\u7684 HTTPS \u670d\u52a1\u5668","text":"<p>\u5f53\u914d\u7f6e\u4e24\u4e2a\u6216\u591a\u4e2a HTTPS \u670d\u52a1\u5668\u76d1\u542c\u5355\u4e2a IP \u5730\u5740\u65f6\uff0c\u4f1a\u51fa\u73b0\u4e00\u4e2a\u5e38\u89c1\u95ee\u9898\uff1a</p> <pre><code>server {\nlisten          443 ssl;\nserver_name     www.example.com;\nssl_certificate www.example.com.crt;\n...\n}\n\nserver {\nlisten          443 ssl;\nserver_name     www.example.org;\nssl_certificate www.example.org.crt;\n...\n}\n</code></pre> <p>\u4f7f\u7528\u4e86\u6b64\u914d\u7f6e\uff0c\u6d4f\u89c8\u5668\u4f1a\u63a5\u6536\u9ed8\u8ba4\u670d\u52a1\u5668\u7684\u8bc1\u4e66\uff0c\u5373 www.example.com\uff0c\u800c\u65e0\u89c6\u6240\u8bf7\u6c42\u7684\u670d\u52a1\u5668\u540d\u79f0\u3002\u8fd9\u662f\u7531 SSL \u534f\u8bae\u884c\u4e3a\u5f15\u8d77\u7684\u3002SSL\u8fde\u63a5\u5728\u6d4f\u89c8\u5668\u53d1\u9001 HTTP \u8bf7\u6c42\u4e4b\u524d\u5efa\u7acb\uff0cnginx \u5e76\u4e0d\u77e5\u9053\u8bf7\u6c42\u7684\u670d\u52a1\u5668\u540d\u79f0\u3002\u56e0\u6b64\uff0c\u5b83\u53ea\u80fd\u63d0\u4f9b\u9ed8\u8ba4\u670d\u52a1\u5668\u7684\u8bc1\u4e66\u3002</p> <p>\u6700\u53e4\u8001\u3001\u6700\u5f3a\u5927\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u4e3a\u6bcf\u4e2a HTTPS \u670d\u52a1\u5668\u5206\u914d\u4e00\u4e2a\u5355\u72ec\u7684 IP \u5730\u5740\uff1a</p> <pre><code>server {\nlisten          192.168.1.1:443 ssl;\nserver_name     www.example.com;\nssl_certificate www.example.com.crt;\n...\n}\n\nserver {\nlisten          192.168.1.2:443 ssl;\nserver_name     www.example.org;\nssl_certificate www.example.org.crt;\n...\n}\n</code></pre>"},{"location":"Introduction/%E9%85%8D%E7%BD%AEHTTPS%E6%9C%8D%E5%8A%A1%E5%99%A8/#ssl_1","title":"\u5177\u6709\u591a\u4e2a\u540d\u79f0\u7684 SSL \u8bc1\u4e66","text":"<p>\u867d\u7136\u8fd8\u6709\u5176\u4ed6\u65b9\u6cd5\u5141\u8bb8\u5728\u591a\u4e2a HTTPS \u670d\u52a1\u5668\u4e4b\u95f4\u5171\u4eab\u4e00\u4e2a IP \u5730\u5740\u3002\u4f46\u4ed6\u4eec\u90fd\u6709\u81ea\u5df1\u7684\u7f3a\u70b9\u3002\u4e00\u79cd\u65b9\u6cd5\u662f\u5728 SubjectAltName \u8bc1\u4e66\u5b57\u6bb5\u4e2d\u4f7f\u7528\u591a\u4e2a\u540d\u79f0\u7684\u8bc1\u4e66\uff0c\u4f8b\u5982 <code>www.example.com</code> \u548c <code>www.example.org</code>\u3002\u4f46\u662f\uff0cSubjectAltName \u5b57\u6bb5\u957f\u5ea6\u6709\u9650\u3002</p> <p>\u53e6\u4e00\u79cd\u65b9\u6cd5\u662f\u4f7f\u7528\u9644\u5e26\u901a\u914d\u7b26\u540d\u79f0\u7684\u8bc1\u4e66\uff0c\u4f8b\u5982 <code>*.example.org</code>\u3002\u901a\u914d\u7b26\u8bc1\u4e66\u4fdd\u62a4\u6307\u5b9a\u57df\u7684\u6240\u6709\u5b50\u57df\uff0c\u4f46\u53ea\u80fd\u5728\u540c\u4e00\u7ea7\u522b\u4e0a\u3002\u6b64\u8bc1\u4e66\u80fd\u5339\u914d <code>www.example.org</code>\uff0c\u4f46\u4e0e <code>example.org</code> \u548c <code>www.sub.example.org</code> \u4e0d\u5339\u914d\u3002\u5f53\u7136\uff0c\u8fd9\u4e24\u79cd\u65b9\u6cd5\u4e5f\u53ef\u4ee5\u7ec4\u5408\u4f7f\u7528\u7684\u3002SubjectAltName \u5b57\u6bb5\u4e2d\u7684\u8bc1\u4e66\u53ef\u80fd\u5305\u542b\u786e\u5207\u540d\u79f0\u548c\u901a\u914d\u7b26\u540d\u79f0\uff0c\u4f8b\u5982 <code>example.org</code> \u548c <code>*.example.org</code>\u3002</p> <p>\u6700\u597d\u662f\u5c06\u8bc1\u4e66\u6587\u4ef6\u4e0e\u540d\u79f0\u3001\u79c1\u94a5\u6587\u4ef6\u653e\u7f6e\u5728 http \u7ea7\u914d\u7f6e\uff0c\u4ee5\u4fbf\u5728\u6240\u6709\u670d\u52a1\u5668\u4e2d\u7ee7\u627f\u5176\u5355\u4e2a\u5185\u5b58\u526f\u672c\uff1a</p> <pre><code>ssl_certificate     common.crt;\nssl_certificate_key common.key;\n\nserver {\nlisten          443 ssl;\nserver_name     www.example.com;\n...\n}\n\nserver {\nlisten          443 ssl;\nserver_name     www.example.org;\n...\n</code></pre>"},{"location":"Introduction/%E9%85%8D%E7%BD%AEHTTPS%E6%9C%8D%E5%8A%A1%E5%99%A8/#_1","title":"\u670d\u52a1\u5668\u540d\u79f0\u6307\u793a","text":"<p>\u5728\u5355\u4e2a IP \u5730\u5740\u4e0a\u8fd0\u884c\u591a\u4e2a HTTPS \u670d\u52a1\u5668\u7684\u66f4\u901a\u7528\u7684\u89e3\u51b3\u65b9\u6848\u662f TLS \u670d\u52a1\u5668\u540d\u79f0\u6307\u793a\u6269\u5c55\uff08SNI\uff0cRFC 6066\uff09\uff0c\u5176\u5141\u8bb8\u6d4f\u89c8\u5668\u5728 SSL \u63e1\u624b\u671f\u95f4\u4f20\u9012\u6240\u8bf7\u6c42\u7684\u670d\u52a1\u5668\u540d\u79f0\uff0c\u56e0\u6b64\uff0c\u670d\u52a1\u5668\u5c06\u77e5\u9053\u5e94\u8be5\u4e3a\u6b64\u8fde\u63a5\u4f7f\u7528\u54ea\u4e2a\u8bc1\u4e66\u3002\u7136\u800c\uff0cSNI \u5bf9\u6d4f\u89c8\u5668\u7684\u652f\u6301\u662f\u6709\u9650\u7684\u3002\u76ee\u524d\uff0c\u5b83\u4ec5\u652f\u6301\u4ee5\u4e0b\u7248\u672c\u5f00\u59cb\u7684\u6d4f\u89c8\u5668\uff1a</p> <ul> <li>Opera 8.0</li> <li>MSIE 7.0\uff08\u4f46\u4ec5\u5728 Windows Vista \u6216\u66f4\u9ad8\u7248\u672c\uff09</li> <li>Firefox 2.0 \u548c\u4f7f\u7528 Mozilla Platform rv:1.8.1 \u7684\u5176\u4ed6\u6d4f\u89c8\u5668</li> <li>Safari 3.2.1\uff08\u652f\u6301 SNI \u7684 Windows \u7248\u672c\u9700\u8981 Vista \u6216\u66f4\u9ad8\u7248\u672c\uff09</li> <li>Chrome\uff08\u652f\u6301 SNI \u7684 Windows \u7248\u672c\u9700\u8981 Vista \u6216\u66f4\u9ad8\u7248\u672c\uff09</li> </ul> <p>\u53ea\u6709\u57df\u540d\u53ef\u4ee5\u5728 SNI \u4e2d\u4f20\u9012\uff0c\u7136\u800c\uff0c\u5982\u679c\u8bf7\u6c42\u5305\u542b IP \u5730\u5740\uff0c\u67d0\u4e9b\u6d4f\u89c8\u5668\u53ef\u80fd\u4f1a\u9519\u8bef\u5730\u5c06\u670d\u52a1\u5668\u7684 IP \u5730\u5740\u4f5c\u4e3a\u540d\u79f0\u4f20\u9012\u3002\u4e0d\u5e94\u8be5\u4f9d\u9760\u8fd9\u4e2a\u3002</p> <p>\u8981\u5728 nginx \u4e2d\u4f7f\u7528 SNI\uff0c\u5176\u5fc5\u987b\u652f\u6301\u6784\u5efa\u540e\u7684 nginx \u4e8c\u8fdb\u5236\u7684 OpenSSL \u5e93\u4ee5\u53ca\u5728\u53ef\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u94fe\u63a5\u7684\u5e93\u3002\u81ea 0.9.8f \u7248\u672c\u8d77\uff08OpenSSL\uff09\uff0c\u5982\u679c OpenSSL \u4f7f\u7528\u4e86\u914d\u7f6e\u9009\u9879 <code>--enable-tlsext</code> \u6784\u5efa\uff0c\u662f\u652f\u6301 SNI \u7684\u3002\u81ea OpenSSL 0.9.8j \u8d77\uff0c\u6b64\u9009\u9879\u662f\u9ed8\u8ba4\u542f\u7528\u3002\u5982\u679c nginx \u662f\u7528 SNI \u652f\u6301\u6784\u5efa\u7684\uff0c\u90a3\u4e48\u5f53\u4f7f\u7528 <code>nginx -V</code> \u547d\u4ee4\u65f6 \uff0cnginx \u4f1a\u663e\u793a\uff1a</p> <pre><code>$ nginx -V\n...\nTLS SNI support enabled\n...\n</code></pre> <p>\u4f46\u662f\uff0c\u5982\u679c\u542f\u7528\u4e86 SNI \u7684 nginx \u5728\u6ca1\u6709 SNI \u652f\u6301\u7684\u60c5\u51b5\u4e0b\u52a8\u6001\u94fe\u63a5\u5230 OpenSSL \u5e93\uff0c\u90a3\u4e48 nginx \u5c06\u4f1a\u663e\u793a\u8b66\u544a\uff1a</p> <pre><code>nginx was built with SNI support, however, now it is linked\ndynamically to an OpenSSL library which has no tlsext support,\ntherefore SNI is not available\n</code></pre>"},{"location":"Introduction/%E9%85%8D%E7%BD%AEHTTPS%E6%9C%8D%E5%8A%A1%E5%99%A8/#_2","title":"\u517c\u5bb9\u6027","text":"<ul> <li>\u4ece 0.8.21 \u548c 0.7.62 \u8d77\uff0cSNI \u652f\u6301\u72b6\u6001\u901a\u8fc7 <code>-V</code>\u5f00\u5173\u663e\u793a\u3002</li> <li>\u4ece 0.7.14 \u5f00\u59cb\uff0c\u652f\u6301 listen \u6307\u4ee4\u7684 ssl \u53c2\u6570\u3002\u5728 0.8.21 \u4e4b\u524d\uff0c\u53ea\u80fd\u4e0e <code>default</code> \u53c2\u6570\u4e00\u8d77\u6307\u5b9a\u3002</li> <li>\u4ece 0.5.23 \u8d77\uff0c\u652f\u6301 SNI\u3002</li> <li>\u4ece 0.5.6 \u8d77\uff0c\u652f\u6301\u5171\u4eab SSL \u4f1a\u8bdd\u7f13\u5b58\u3002</li> <li>1.9.1 \u53ca\u66f4\u9ad8\u7248\u672c\uff1a\u9ed8\u8ba4 SSL \u534f\u8bae\u4e3a TLSv1\u3001TLSv1.1 \u548c TLSv1.2\uff08\u5982\u679c OpenSSL \u5e93\u652f\u6301\uff09\u3002</li> <li>0.7.65\u30010.8.19 \u53ca\u66f4\u9ad8\u7248\u672c\uff1a\u9ed8\u8ba4 SSL \u534f\u8bae\u4e3a SSLv3\u3001TLSv1\u3001TLSv1.1 \u548c TLSv1.2\uff08\u5982\u679c OpenSSL \u5e93\u652f\u6301\uff09\u3002</li> <li>0.7.64\u30010.8.18 \u53ca\u66f4\u65e9\u7248\u672c\uff1a\u9ed8\u8ba4 SSL \u534f\u8bae\u4e3a SSLv2\u3001SSLv3 \u548c TLSv1\u3002</li> <li>1.0.5\u53ca\u66f4\u9ad8\u7248\u672c\uff1a\u9ed8\u8ba4 SSL \u5bc6\u7801\u4e3a <code>HIGH:!aNULL:!MD5</code>\u3002</li> <li>0.7.65\u30010.8.20 \u53ca\u66f4\u9ad8\u7248\u672c\uff1a\u9ed8\u8ba4 SSL \u5bc6\u7801\u4e3a <code>HIGH:!ADH:!MD5</code>\u3002</li> <li>0.8.19 \u7248\u672c\uff1a\u9ed8\u8ba4 SSL \u5bc6\u7801\u4e3a <code>ALL:!ADH:RC4+RSA:+HIGH:+MEDIUM</code>\u3002</li> <li>0.7.64\u30010.8.18 \u53ca\u66f4\u65e9\u7248\u672c\uff1a\u9ed8\u8ba4SSL\u5bc6\u7801\u4e3a <code>ALL:!ADH:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP</code>\u3002</li> </ul> <p>\u7531 Igor Sysoev \u64b0\u5199\uff0cBrian Mercer \u7f16\u8f91</p>"},{"location":"Introduction/%E9%85%8D%E7%BD%AEHTTPS%E6%9C%8D%E5%8A%A1%E5%99%A8/#_3","title":"\u539f\u6587\u6863","text":"<ul> <li>Configuring HTTPS servers</li> </ul>"},{"location":"Introduction/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%BA%A6%E9%87%8F%E5%8D%95%E4%BD%8D/","title":"\u914d\u7f6e\u6587\u4ef6\u5ea6\u91cf\u5355\u4f4d","text":"<p>\u5ea6\u91cf\u5355\u4f4d\u53ef\u4ee5\u662f\u5b57\u8282\u3001\u5343\u5b57\u8282\uff08\u5355\u4f4d\u662f k \u6216\u8005 K \uff09\u6216\u8005\u5146\u5b57\u8282\uff08\u5355\u4f4d\u662f m \u6216\u8005 M \uff09\uff0c\u4f8b\u5982\uff0c<code>1024</code>\uff0c<code>8k</code>\uff0c<code>1m</code>\u3002</p> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 g \u6216\u8005 G \u5355\u4f4d\u7684\u5343\u5146\u5b57\u8282\u3002</p> <p>\u53ef\u4ee5\u6307\u5b9a\u6beb\u79d2\u3001\u79d2\u3001\u5206\u3001\u5c0f\u65f6\u548c\u5929\u7b49\u65f6\u95f4\u6765\u8bbe\u5b9a\u65f6\u95f4\u95f4\u9694\uff0c\u4f7f\u7528\u4ee5\u4e0b\u5355\u4f4d\uff1a</p> \u5355\u4f4d \u542b\u4e49 ms \u6beb\u79d2 s \u79d2 m \u5206\u949f h \u5c0f\u65f6 d \u5929 w \u5468 M \u6708\uff0c30\u5929 y \u5e74\uff0c365\u5929 <p>\u53ef\u4ee5\u4ece\u5927\u5230\u5c0f\u7684\u987a\u5e8f\u6307\u5b9a\u591a\u4e2a\u5355\u4f4d\uff0c\u7528\u53ef\u9009\u7684\u7a7a\u683c\u7b26\u95f4\u9694\u7ec4\u5408\u6210\u5355\u4e2a\u503c\u3002\u4f8b\u5982\uff0c<code>1h 30m</code> \u4e0e <code>90m</code> \u6216\u8005 <code>5400s</code> \u65f6\u95f4\u76f8\u540c\u3002\u6ca1\u6709\u5355\u4f4d\u7684\u503c\u8868\u793a\u79d2\uff0c\u5efa\u8bae\u59cb\u7ec8\u52a0\u4e0a\u5355\u4f4d\u3002</p> <p>\u67d0\u4e9b\u65f6\u95f4\u8bbe\u7f6e\u53ea\u80fd\u533a\u5206\u79d2\u7ea7\u5355\u4f4d\u3002</p>"},{"location":"Introduction/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%BA%A6%E9%87%8F%E5%8D%95%E4%BD%8D/#_2","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/syntax.html</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/","title":"\u6838\u5fc3\u529f\u80fd","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>accept_mutex</li> <li>accept_mutex_delay</li> <li>daemon</li> <li>debug_connection</li> <li>debug_points</li> <li>error_log</li> <li>env</li> <li>events</li> <li>include</li> <li>load_module</li> <li>lock_file</li> <li>master_process</li> <li>multi_accept</li> <li>pcre_jit</li> <li>pid</li> <li>ssl_engine</li> <li>thread_pool</li> <li>timer_resolution</li> <li>use</li> <li>user</li> <li>worker_aio_requests</li> <li>worker_connections</li> <li>worker_cpu_affinity</li> <li>worker_priority</li> <li>worker_processes</li> <li>worker_rlimit_core</li> <li>worker_rlimit_nofile</li> <li>worker_shutdown_timeout</li> <li>working_directory</li> </ul> </li> </ul>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#_2","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>user www www;\nworker_processes 2;\n\nerror_log /var/log/nginx-error.log info;\n\nevents {\nuse kqueue;\nworker_connections 2048;\n}\n\n...\n</code></pre>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#_3","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#accept_mutex","title":"accept_mutex","text":"- \u8bf4\u660e \u8bed\u6cd5 accept_mutex <code>on</code> | <code>off</code>; \u9ed8\u8ba4 accept_mutex off; \u4e0a\u4e0b\u6587 events <p>\u5982\u679c\u542f\u7528\u4e86 <code>accept_mutex</code>\uff0c\u5219\u5de5\u4f5c\u8fdb\u7a0b\u5c06\u8f6e\u6d41\u63a5\u53d7\u65b0\u8fde\u63a5\u3002\u5426\u5219\uff0c\u5c06\u65b0\u8fde\u63a5\u901a\u77e5\u7ed9\u6240\u6709\u5de5\u4f5c\u8fdb\u7a0b\uff0c\u5982\u679c\u65b0\u8fde\u63a5\u6570\u91cf\u8f83\u5c11\uff0c\u67d0\u4e9b\u5de5\u4f5c\u8fdb\u7a0b\u53ef\u80fd\u4f1a\u6d6a\u8d39\u7cfb\u7edf\u8d44\u6e90\u3002</p> <p>\u5728\u652f\u6301 EPOLLEXCLUSIVE \u6807\u5fd7\uff081.11.3\uff09\u6216\u4f7f\u7528 reuseport \u7684\u7cfb\u7edf\u4e0a\uff0c\u4e0d\u9700\u8981\u542f\u7528 <code>accept_mutex</code>\u3002</p> <p>\u5728\u7248\u672c 1.11.3 \u4e4b\u524d\uff0c\u9ed8\u8ba4\u503c\u4e3a <code>on</code>\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#accept_mutex_delay","title":"accept_mutex_delay","text":"- \u8bf4\u660e \u8bed\u6cd5 accept_mutex_delay <code>time</code>; \u9ed8\u8ba4 accept_mutex_delay 500ms; \u4e0a\u4e0b\u6587 events <p>\u5982\u679c\u542f\u7528\u4e86 accept_mutex\uff0c\u5219\u6307\u5b9a\u5982\u679c\u53e6\u4e00\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u6b63\u5728\u63a5\u53d7\u65b0\u8fde\u63a5\uff0c\u5219\u5de5\u4f5c\u8fdb\u7a0b\u5c06\u5c1d\u8bd5\u91cd\u65b0\u542f\u52a8\u4ee5\u63a5\u53d7\u65b0\u8fde\u63a5\u7684\u6700\u957f\u65f6\u95f4\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#daemon","title":"daemon","text":"- \u8bf4\u660e \u8bed\u6cd5 daemon <code>on</code> | <code>off</code>; \u9ed8\u8ba4 daemon on; \u4e0a\u4e0b\u6587 main <p>\u51b3\u5b9a nginx \u662f\u5426\u5e94\u8be5\u6210\u4e3a\u5b88\u62a4\u8fdb\u7a0b\u3002\u4e3b\u8981\u7528\u4e8e\u5f00\u53d1\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#debug_connection","title":"debug_connection","text":"- \u8bf4\u660e \u8bed\u6cd5 debug_connection <code>address</code> | <code>CIDR</code> | <code>unix:</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 events <p>\u542f\u7528\u6240\u9009\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u8c03\u8bd5\u65e5\u5fd7\u3002\u5176\u4ed6\u8fde\u63a5\u5c06\u4f7f\u7528\u7531 error_log \u6307\u4ee4\u8bbe\u7f6e\u7684\u65e5\u5fd7\u7ea7\u522b\u3002\u8c03\u8bd5\u8fde\u63a5\u7531 IPv4 \u6216 IPv6 \uff081.3.0\uff0c1.2.1\uff09\u5730\u5740\u6216\u7f51\u7edc\u6307\u5b9a\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e3b\u673a\u540d\u6307\u5b9a\u8fde\u63a5\u3002\u5bf9\u4e8e\u4f7f\u7528 UNIX \u57df\u5957\u63a5\u5b57\uff081.3.0\uff0c1.2.1\uff09\u7684\u8fde\u63a5\uff0c\u8c03\u8bd5\u65e5\u5fd7\u7531 <code>unix:</code> \u53c2\u6570\u542f\u7528\u3002</p> <pre><code>events {\ndebug_connection 127.0.0.1;\ndebug_connection localhost;\ndebug_connection 192.0.2.0/24;\ndebug_connection ::1;\ndebug_connection 2001:0db8::/32;\ndebug_connection unix:;\n...\n}\n</code></pre> <p>\u4e3a\u4e86\u4f7f\u8be5\u6307\u4ee4\u6b63\u5e38\u5de5\u4f5c\uff0c\u9700\u8981\u4f7f\u7528 <code>--with-debug</code> \u6765\u6784\u5efanginx\uff0c\u8bf7\u53c2\u89c1\u8c03\u8bd5\u65e5\u5fd7\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#debug_points","title":"debug_points","text":"- \u8bf4\u660e \u8bed\u6cd5 debug_points <code>abort</code> | <code>stop</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 main <p>\u8be5\u6307\u4ee4\u7528\u4e8e\u8c03\u8bd5\u3002</p> <p>\u5f53\u68c0\u6d4b\u5230\u5185\u90e8\u9519\u8bef\u65f6\uff0c\u4f8b\u5982\uff0c\u5728\u91cd\u65b0\u542f\u52a8\u5de5\u4f5c\u6d41\u7a0b\u65f6\uff0c\u53d1\u751f\u5957\u63a5\u5b57\u6cc4\u6f0f\uff0c\u542f\u7528 <code>debug_points</code> \u4f1a\u5bfc\u81f4\u6838\u5fc3\u6587\u4ef6\u521b\u5efa\uff08<code>abort</code>\uff09\u6216\u505c\u6b62\uff08<code>stop</code>\uff09\u8fdb\u7a0b\u4ee5\u4f7f\u7528\u7cfb\u7edf\u8c03\u8bd5\u5668\u8fdb\u884c\u8fdb\u4e00\u6b65\u5206\u6790\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#error_log","title":"error_log","text":"- \u8bf4\u660e \u8bed\u6cd5 error_log <code>file [level]</code>; \u9ed8\u8ba4 error_log logs/error.log error; \u4e0a\u4e0b\u6587 main\u3001http\u3001mail\u3001stream\u3001server\u3001location <p>\u914d\u7f6e\u65e5\u5fd7\u3002\u53ef\u4ee5\u5728\u540c\u4e00\u7ea7\u522b\u6307\u5b9a\u51e0\u4e2a\u65e5\u5fd7\uff081.5.2\uff09\u3002\u5982\u679c\u5728 <code>main</code> \u914d\u7f6e\u7ea7\u522b\u5c06\u65e5\u5fd7\u5199\u5165\u4e00\u4e2a\u672a\u660e\u786e\u5b9a\u4e49\u6587\u4ef6\uff0c\u5219\u5c06\u4f7f\u7528\u9ed8\u8ba4\u6587\u4ef6\u3002</p> <p>\u7b2c\u4e00\u4e2a\u53c2\u6570\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5c06\u5b58\u50a8\u65e5\u5fd7\u7684 <code>file</code>\u3002\u7279\u6b8a\u503c <code>stderr</code> \u9009\u62e9\u6807\u51c6\u9519\u8bef\u6587\u4ef6\u3002\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a <code>syslog:</code> \u524d\u7f00\u6765\u914d\u7f6e\u8bb0\u5f55\u65e5\u5fd7\u5230 syslog\u3002\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9a <code>memory:</code> \u524d\u7f00\u548c\u7f13\u51b2\u533a <code>size</code> \u6765\u914d\u7f6e\u8bb0\u5f55\u65e5\u5fd7\u5230\u5faa\u73af\u5185\u5b58\u7f13\u51b2\u533a\uff0c\u6b64\u901a\u5e38\u7528\u4e8e\u8c03\u8bd5\uff081.7.11\uff09\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u53c2\u6570\u786e\u5b9a\u65e5\u5fd7\u8bb0\u5f55\u7684 <code>level</code>\uff0c\u53ef\u4ee5\u662f\u4ee5\u4e0b\u4e4b\u4e00\uff1a<code>debug</code>\u3001<code>info</code>\u3001<code>notice</code>\u3001<code>warn</code>\u3001<code>error</code>\u3001<code>crit</code>\u3001<code>alert</code> \u6216<code>emerg</code>\u3002\u4e0a\u8ff0\u65e5\u5fd7\u7ea7\u522b\u6309\u4e25\u91cd\u6027\u9012\u589e\u6392\u5217\u3002\u8bbe\u7f6e\u67d0\u4e2a\u65e5\u5fd7\u7ea7\u522b\u5c06\u9020\u6210\u6240\u6709\u6307\u5b9a\u7684\u6d88\u606f\u548c\u66f4\u4e25\u91cd\u7684\u65e5\u5fd7\u7ea7\u522b\u88ab\u8bb0\u5f55\u3002\u4f8b\u5982\uff0c\u9ed8\u8ba4\u7ea7\u522b <code>error</code> \u5c06\u5bfc\u81f4 <code>error</code>\u3001<code>crit</code>\u3001<code>alert</code>\u548c <code>emerg</code> \u6d88\u606f\u88ab\u8bb0\u5f55\u3002\u5982\u679c\u7701\u7565\u6b64\u53c2\u6570\uff0c\u5219\u4f7f\u7528 <code>error</code>\u3002</p> <p>\u4e3a\u4e86\u4f7f <code>debug</code> \u65e5\u5fd7\u8bb0\u5f55\u5de5\u4f5c\uff0c\u9700\u8981\u4f7f\u7528 <code>--with-debug</code> \u6765\u6784\u5efanginx\uff0c\u8bf7\u53c2\u89c1\u8c03\u8bd5\u65e5\u5fd7\u3002</p> <p>\u4ece 1.7.11 \u7248\u672c\u5f00\u59cb\uff0c\u8be5\u6307\u4ee4\u53ef\u4ee5\u6307\u5b9a <code>stream</code> \u7ea7\u522b\uff0c\u4ece 1.9.0 \u7248\u672c\u5f00\u59cb\u53ef\u4ee5\u6307\u5b9a <code>mail</code> \u7ea7\u522b\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#env","title":"env","text":"- \u8bf4\u660e \u8bed\u6cd5 env <code>variable[=value]</code>; \u9ed8\u8ba4 env TZ; \u4e0a\u4e0b\u6587 main <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnginx \u9664\u53bb TZ \u53d8\u91cf\u4e4b\u5916\u7684\u6240\u6709\u7ee7\u627f\u81ea\u7236\u8fdb\u7a0b\u7684\u73af\u5883\u53d8\u91cf\u3002\u8be5\u6307\u4ee4\u5141\u8bb8\u4fdd\u7559\u4e00\u4e9b\u7ee7\u627f\u7684\u53d8\u91cf\u3001\u66f4\u6539\u5176\u503c\u6216\u521b\u5efa\u65b0\u7684\u73af\u5883\u53d8\u91cf\u3002 \u8fd9\u4e9b\u53d8\u91cf\u662f\uff1a</p> <ul> <li>\u5728\u53ef\u6267\u884c\u6587\u4ef6\u5b9e\u65f6\u5347\u7ea7\u671f\u95f4\u7ee7\u627f</li> <li>\u88ab ngx_http_perl_module \u6a21\u5757\u4f7f\u7528</li> <li>\u88ab\u5de5\u4f5c\u8fdb\u7a0b\u4f7f\u7528\u3002\u5e94\u8be5\u8981\u8bb0\u4f4f\uff0c\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u6765\u63a7\u5236\u7cfb\u7edf\u5e93\u5e76\u4e0d\u603b\u662f\u53ef\u884c\u7684\uff0c\u56e0\u4e3a\u53ea\u6709\u5728\u521d\u59cb\u5316\u671f\u95f4\u8fd9\u4e9b\u5e93\u624d\u80fd\u68c0\u67e5\u53d8\u91cf\u3002\u4e00\u79cd\u4f8b\u5916\u60c5\u51b5\u662f\u53ef\u6267\u884c\u6587\u4ef6\u6267\u884c\u5b9e\u65f6\u5347\u7ea7\u3002</li> </ul> <p>\u9664\u975e\u660e\u786e\u914d\u7f6e\uff0c\u5426\u5219 TZ \u53d8\u91cf\u59cb\u7ec8\u4f1a\u7ee7\u627f\u5e76\u5bf9 ngx_http_perl_module \u6a21\u5757\u53ef\u7528\u3002</p> <p>\u7528\u6cd5\u793a\u4f8b\uff1a</p> <pre><code>env MALLOC_OPTIONS;\nenv PERL5LIB=/data/site/modules;\nenv OPENSSL_ALLOW_PROXY_CERTS=1;\n</code></pre> <p>NGINX \u73af\u5883\u53d8\u91cf\u7531 nginx \u5185\u90e8\u4f7f\u7528\uff0c\u4e0d\u5e94\u7531\u7528\u6237\u76f4\u63a5\u8bbe\u7f6e\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#events","title":"events","text":"- \u8bf4\u660e \u8bed\u6cd5 events <code>{ ... }</code> \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 main <p>\u63d0\u4f9b\u6307\u5b9a\u5f71\u54cd\u8fde\u63a5\u5904\u7406\u6307\u4ee4\u7684\u914d\u7f6e\u6587\u4ef6\u4e0a\u4e0b\u6587\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#include","title":"include","text":"- \u8bf4\u660e \u8bed\u6cd5 include <code>file</code> | <code>mask</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 any <p>\u5305\u542b\u53e6\u4e00\u4e2a <code>file</code> \u6216\u5339\u914d\u6307\u5b9a <code>mask</code> \u7684\u6587\u4ef6\u5230\u914d\u7f6e\u4e2d\u3002\u5305\u542b\u7684\u6587\u4ef6\u5e94\u8be5\u7531\u8bed\u6cd5\u6b63\u786e\u7684\u6307\u4ee4\u548c\u5757\u7ec4\u6210\u3002</p> <p>\u4f7f\u7528\u793a\u4f8b\uff1a</p> <pre><code>include mime.types;\ninclude vhosts/*.conf;\n</code></pre>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#load_module","title":"load_module","text":"- \u8bf4\u660e \u8bed\u6cd5 load_module <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 main \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.9.11 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u52a0\u8f7d\u4e00\u4e2a\u52a8\u6001\u6a21\u5757</p> <p>\u4f7f\u7528\u793a\u4f8b\uff1a</p> <pre><code>load_module modules/ngx_mail_module.so;\n</code></pre> - \u8bf4\u660e \u8bed\u6cd5 lock_file <code>file</code>; \u9ed8\u8ba4 lock_file logs/nginx.lock; \u4e0a\u4e0b\u6587 main <p>nginx \u4f7f\u7528\u9501\u673a\u5236\u6765\u5b9e\u73b0 accept_mutex \u5e76\u5e8f\u5217\u5316\u5bf9\u5171\u4eab\u5185\u5b58\u7684\u8bbf\u95ee\u3002\u5927\u591a\u6570\u7cfb\u7edf\u662f\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c\u5b9e\u73b0\u9501\uff0c\u5e76\u5ffd\u7565\u6b64\u6307\u4ee4\u3002\u5728\u5176\u4ed6\u7cfb\u7edf\u4e0a\u662f\u4f7f\u7528\u201c\u9501\u6587\u4ef6\u201d\u673a\u5236\u3002\u6b64\u6307\u4ee4\u7528\u4e8e\u6307\u5b9a\u4e00\u4e2a\u9501\u6587\u4ef6\u540d\u79f0\u7684\u524d\u7f00\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#master_process","title":"master_process","text":"- \u8bf4\u660e \u8bed\u6cd5 master_process <code>on</code> | <code>off</code>; \u9ed8\u8ba4 master_process on; \u4e0a\u4e0b\u6587 main <p>\u7528\u4e8e\u51b3\u5b9a\u662f\u5426\u542f\u52a8\u5de5\u4f5c\u8fdb\u7a0b\u3002\u8be5\u6307\u4ee4\u9002\u7528\u4e8e nginx \u5f00\u53d1\u4eba\u5458\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#multi_accept","title":"multi_accept","text":"- \u8bf4\u660e \u8bed\u6cd5 multi_accept <code>on</code> | <code>off</code>; \u9ed8\u8ba4 multi_accept off; \u4e0a\u4e0b\u6587 events <p>\u5982\u679c <code>multi_accept</code> \u88ab\u7981\u7528\uff0c\u5de5\u4f5c\u8fdb\u7a0b\u5c06\u4e00\u6b21\u63a5\u53d7\u4e00\u4e2a\u65b0\u8fde\u63a5\u3002\u5426\u5219\uff0c\u5de5\u4f5c\u8fdb\u7a0b\u5c06\u4e00\u6b21\u63a5\u53d7\u6240\u6709\u65b0\u8fde\u63a5\u3002</p> <p>\u5982\u679c\u4f7f\u7528\u4e86 kqueue \u8fde\u63a5\u5904\u7406\u65b9\u5f0f\uff0c\u5219\u4f1a\u5ffd\u7565\u8be5\u6307\u4ee4\uff0c\u56e0\u4e3a\u5b83\u62a5\u544a\u4e86\u7b49\u5f85\u63a5\u53d7\u7684\u65b0\u8fde\u63a5\u7684\u6570\u91cf\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#pcre_jit","title":"pcre_jit","text":"- \u8bf4\u660e \u8bed\u6cd5 pcre_jit <code>on</code> | <code>off</code>; \u9ed8\u8ba4 pcre_jit off; \u4e0a\u4e0b\u6587 main \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.12 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u6216\u7981\u7528\u5bf9\u5728\u914d\u7f6e\u89e3\u6790\u65f6\u5df2\u77e5\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u4f7f\u7528\u201c\u5373\u65f6\u7f16\u8bd1\u201d\uff08PCRE JIT\uff09\u3002</p> <p>PCRE JIT \u53ef\u4ee5\u660e\u663e\u5730\u52a0\u5feb\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5904\u7406\u3002</p> <p>\u4ece 8.20 \u7248\u672c\u5f00\u59cb\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>-enable-jit</code> \u914d\u7f6e\u53c2\u6570\u6784\u5efa PCRE \u5e93\u542f\u7528 JIT\u3002\u5f53\u4f7f\u7528 nginx\uff08<code>--with-pcre=</code>\uff09\u6784\u5efa PCRE \u5e93\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>--with-pcre-jit</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528 JIT \u652f\u6301\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#pid","title":"pid","text":"- \u8bf4\u660e \u8bed\u6cd5 pid <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 main <p>\u5b9a\u4e49\u4e00\u4e2a <code>file</code> \u7528\u4e8e\u5b58\u50a8\u4e3b\u8fdb\u7a0b\u7684\u8fdb\u7a0b ID \u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#ssl_engine","title":"ssl_engine","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_engine <code>device</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 main <p>\u5b9a\u4e49\u786c\u4ef6 SSL \u52a0\u901f\u5668\u7684\u540d\u79f0\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#thread_pool","title":"thread_pool","text":"- \u8bf4\u660e \u8bed\u6cd5 thread_pool <code>name threads=number [max_queue=number]</code>; \u9ed8\u8ba4 thread_pool default threads=32 max_queue=65536; \u4e0a\u4e0b\u6587 main \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.11 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5b9a\u4e49\u547d\u540d\u7684\u7ebf\u7a0b\u6c60\u7528\u4e8e\u591a\u7ebf\u7a0b\u8bfb\u53d6\u548c\u53d1\u9001\u6587\u4ef6\uff0c\u800c\u65e0\u9700\u963b\u585e\u5de5\u4f5c\u8fdb\u7a0b\u3002</p> <p><code>threads</code> \u53c2\u6570\u5b9a\u4e49\u6c60\u4e2d\u7684\u7ebf\u7a0b\u6570\u91cf\u3002</p> <p>\u5982\u679c\u6c60\u4e2d\u7684\u6240\u6709\u7ebf\u7a0b\u90fd\u5904\u4e8e\u7e41\u5fd9\u72b6\u6001\uff0c\u5219\u65b0\u4efb\u52a1\u5c06\u5728\u961f\u5217\u4e2d\u7b49\u5f85\u3002<code>max_queue</code> \u53c2\u6570\u9650\u5236\u961f\u5217\u4e2d\u5141\u8bb8\u7b49\u5f85\u7684\u4efb\u52a1\u6570\u3002\u7f3a\u7701\u60c5\u51b5\u4e0b\uff0c\u961f\u5217\u4e2d\u6700\u591a\u53ef\u4ee5\u7b49\u5f85 65536 \u4e2a\u4efb\u52a1\u3002\u5f53\u961f\u5217\u6ea2\u51fa\u65f6\uff0c\u4efb\u52a1\u5b8c\u6210\u5e76\u51fa\u73b0\u9519\u8bef\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#timer_resolution","title":"timer_resolution","text":"- \u8bf4\u660e \u8bed\u6cd5 timer_resolution <code>interval</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 main <p>\u51cf\u5c11\u5de5\u4f5c\u8fdb\u7a0b\u4e2d\u7684\u8ba1\u65f6\u5668\u5206\u8fa8\u7387\uff0c\u4ece\u800c\u51cf\u5c11 <code>gettimeofday()</code> \u7684\u7cfb\u7edf\u8c03\u7528\u6b21\u6570\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6bcf\u6b21\u63a5\u6536\u5230\u5185\u6838\u4e8b\u4ef6\u65f6\u90fd\u4f1a\u8c03\u7528 <code>gettimeofday()</code>\u3002\u968f\u7740\u5206\u8fa8\u7387\u7684\u964d\u4f4e\uff0c<code>gettimeofday()</code> \u4ec5\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u95f4\u9694\u5185\u88ab\u8c03\u7528\u4e00\u6b21\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>timer_resolution 100ms;\n</code></pre> <p>\u95f4\u9694\u7684\u5185\u90e8\u5b9e\u73b0\u53d6\u51b3\u4e8e\u4f7f\u7528\u7684\u65b9\u6cd5\uff1a</p> <ul> <li>\u5982\u679c\u4f7f\u7528 <code>kqueue</code>\uff0c\u5c31\u4f7f\u7528 <code>EVFILT_TIMER</code> \u8fc7\u6ee4\u5668</li> <li>\u5982\u679c\u4f7f\u7528 <code>eventport</code>\uff0c\u5c31\u4f7f\u7528 <code>timer_create()</code></li> <li>\u5426\u5219\u4f7f\u7528 <code>setitimer()</code></li> </ul>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#use","title":"use","text":"- \u8bf4\u660e \u8bed\u6cd5 use <code>method</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 events <p>\u6307\u5b9a\u8981\u4f7f\u7528\u7684\u8fde\u63a5\u5904\u7406\u65b9\u5f0f\u3002\u901a\u5e38\u4e0d\u9700\u8981\u660e\u786e\u6307\u5b9a\u5b83\uff0c\u56e0\u4e3a nginx \u5c06\u9ed8\u8ba4\u4f7f\u7528\u6700\u6709\u6548\u7684\u65b9\u5f0f\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#user","title":"user","text":"- \u8bf4\u660e \u8bed\u6cd5 user <code>user [group]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 events <p>\u5b9a\u4e49\u5de5\u4f5c\u8fdb\u7a0b\u4f7f\u7528\u7684 <code>user</code> \u548c <code>group</code> \u51ed\u636e\u3002\u5982\u679c\u7701\u7565 <code>group</code>\uff0c\u5219\u4f7f\u7528\u5176\u540d\u79f0\u4e0e <code>user</code> \u76f8\u7b49\u7684\u7ec4\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#worker_aio_requests","title":"worker_aio_requests","text":"- \u8bf4\u660e \u8bed\u6cd5 worker_aio_requests <code>number</code>; \u9ed8\u8ba4 worker_aio_requests 32; \u4e0a\u4e0b\u6587 events \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.4 \u548c 1.0.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5f53\u4f7f\u7528\u6709 epoll \u8fde\u63a5\u5904\u7406\u65b9\u5f0f\u7684 aio \u65f6\uff0c\u4e3a\u5355\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u8bbe\u7f6e\u672a\u5b8c\u6210\u5f02\u6b65 I/O \u64cd\u4f5c\u7684\u6700\u5927 <code>number</code>\uff08\u6570\u91cf\uff09\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#worker_connections","title":"worker_connections","text":"- \u8bf4\u660e \u8bed\u6cd5 worker_connections <code>number</code>; \u9ed8\u8ba4 worker_connections 512; \u4e0a\u4e0b\u6587 events <p>\u8bbe\u7f6e\u5de5\u4f5c\u8fdb\u7a0b\u53ef\u4ee5\u6253\u5f00\u7684\u540c\u65f6\u8fde\u63a5\u7684\u6700\u5927\u6570\u91cf\u3002</p> <p>\u5e94\u8be5\u8bb0\u4f4f\u7684\u662f\uff0c\u8fd9\u4e2a\u6570\u5b57\u5305\u62ec\u4e86\u6240\u6709\u8fde\u63a5\uff08\u4f8b\u5982\u4e0e\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8fde\u63a5\u7b49\uff09\uff0c\u800c\u4e0d\u4ec5\u4ec5\u662f\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u3002\u53e6\u4e00\u4e2a\u8981\u8003\u8651\u56e0\u7d20\u662f\u5b9e\u9645\u7684\u5e76\u53d1\u8fde\u63a5\u6570\u4e0d\u80fd\u8d85\u8fc7\u6700\u5927\u6253\u5f00\u6587\u4ef6\u6570\u7684\u9650\u5236\uff0c\u53ef\u4ee5\u901a\u8fc7 worker_rlimit_nofile \u6765\u4fee\u6539\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#worker_cpu_affinity","title":"worker_cpu_affinity","text":"- \u8bf4\u660e \u8bed\u6cd5 worker_cpu_affinity <code>cpumask ...</code>;  worker_cpu_affinity <code>auto [cpumask]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 main <p>\u5c06\u5de5\u4f5c\u8fdb\u7a0b\u7ed1\u5b9a\u5230\u4e00\u7ec4 CPU\u3002\u6bcf\u4e2a CPU \u7ec4\u7531\u5141\u8bb8\u7684 CPU \u7684\u4f4d\u63a9\u7801\u8868\u793a\u3002\u5e94\u4e3a\u6bcf\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u5b9a\u4e49\u4e00\u4e2a\u5355\u72ec\u7684\u7ec4\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5de5\u4f5c\u8fdb\u7a0b\u6ca1\u6709\u7ed1\u5b9a\u4efb\u4f55\u7279\u5b9a\u7684 CPU\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>worker_processes    4;\nworker_cpu_affinity 0001 0010 0100 1000;\n</code></pre> <p>\u5c06\u6bcf\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u7ed1\u5b9a\u5230\u5355\u72ec\u7684 CPU</p> <pre><code>worker_processes    2;\nworker_cpu_affinity 0101 1010;\n</code></pre> <p>\u5c06\u7b2c\u4e00\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u7ed1\u5b9a\u5230 CPU0/CPU2\uff0c\u5c06\u7b2c\u4e8c\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u7ed1\u5b9a\u5230 CPU1/CPU3\u3002\u7b2c\u4e8c\u4e2a\u4f8b\u5b50\u9002\u7528\u4e8e\u8d85\u7ebf\u7a0b\u3002</p> <p>\u7279\u6b8a\u503c <code>auto</code>\uff081.9.10\uff09\u5141\u8bb8\u81ea\u52a8\u7ed1\u5b9a\u5de5\u4f5c\u8fdb\u7a0b\u5230\u53ef\u7528\u7684 CPU\uff1a</p> <pre><code>worker_processes auto;\nworker_cpu_affinity auto;\n</code></pre> <p>\u53ef\u9009\u7684\u63a9\u7801\u53c2\u6570\u53ef\u7528\u4e8e\u9650\u5236\u81ea\u52a8\u7ed1\u5b9a\u7684\u53ef\u7528 CPU\uff1a</p> <pre><code>worker_cpu_affinity auto 01010101;\n</code></pre> <p>\u8be5\u6307\u4ee4\u4ec5\u9002\u7528\u4e8e FreeBSD \u548c Linux\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#worker_priority","title":"worker_priority","text":"- \u8bf4\u660e \u8bed\u6cd5 worker_priority <code>number</code>; \u9ed8\u8ba4 worker_priority 0; \u4e0a\u4e0b\u6587 main <p>\u5b9a\u4e49\u5de5\u4f5c\u8fdb\u7a0b\u7684\u8c03\u5ea6\u4f18\u5148\u7ea7\uff0c\u4e0e\u4f7f\u7528 <code>nice</code> \u547d\u4ee4\u5b8c\u6210\u7c7b\u4f3c\uff1a\u8d1f\u6570\u610f\u5473\u7740\u66f4\u9ad8\u7684\u4f18\u5148\u7ea7\u3002\u5141\u8bb8\u8303\u56f4\u901a\u5e38\u5728 -20 \u5230 20 \u4e4b\u95f4\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>worker_priority -10;\n</code></pre>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#worker_processes","title":"worker_processes","text":"- \u8bf4\u660e \u8bed\u6cd5 worker_processes <code>number</code> | <code>auto</code>; \u9ed8\u8ba4 worker_processes 1; \u4e0a\u4e0b\u6587 main <p>\u5b9a\u4e49\u5de5\u4f5c\u8fdb\u7a0b\u7684\u6570\u91cf\u3002</p> <p>\u6700\u4f18\u503c\u53d6\u51b3\u4e8e\u8bb8\u591a\u56e0\u7d20\uff0c\u5305\u62ec\uff08\u4f46\u4e0d\u9650\u4e8e\uff09CPU \u6838\u5fc3\u6570\u3001\u5b58\u50a8\u6570\u636e\u7684\u786c\u76d8\u9a71\u52a8\u5668\u6570\u91cf\u4ee5\u53ca\u52a0\u8f7d\u6a21\u5f0f\u3002\u5f53\u60a8\u4e0d\u786e\u5b9a\u65f6\uff0c\u5c06\u5176\u8bbe\u7f6e\u4e3a\u53ef\u7528 CPU \u6838\u5fc3\u7684\u6570\u91cf\u662f\u4e00\u4e2a\u4e0d\u9519\u7684\u505a\u6cd5\uff08\u503c <code>auto</code> \u5c06\u5c1d\u8bd5\u81ea\u52a8\u68c0\u6d4b\uff09\u3002</p> <p><code>auto</code> \u53c2\u6570\u4ece 1.3.8 \u548c 1.2.5 \u7248\u672c\u5f00\u59cb\u5f97\u5230\u652f\u6301\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#worker_rlimit_core","title":"worker_rlimit_core","text":"- \u8bf4\u660e \u8bed\u6cd5 worker_rlimit_core <code>size</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 main <p>\u66f4\u6539\u5de5\u4f5c\u8fdb\u7a0b\u6838\u5fc3\u6587\u4ef6\uff08<code>RLIMIT_CORE</code>\uff09\u6700\u5927\u5927\u5c0f\u9650\u5236\u3002\u7528\u4e8e\u589e\u52a0\u9650\u5236\u800c\u65e0\u9700\u91cd\u65b0\u542f\u52a8\u4e3b\u8fdb\u7a0b\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#worker_rlimit_nofile","title":"worker_rlimit_nofile","text":"- \u8bf4\u660e \u8bed\u6cd5 worker_rlimit_nofile <code>number</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 main <p>\u66f4\u6539\u5de5\u4f5c\u8fdb\u7a0b\u6700\u5927\u6253\u5f00\u6587\u4ef6\u6570\uff08<code>RLIMIT_NOFILE</code>\uff09\u7684\u9650\u5236\u3002\u7528\u4e8e\u589e\u52a0\u9650\u5236\u800c\u65e0\u9700\u91cd\u65b0\u542f\u52a8\u4e3b\u8fdb\u7a0b\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#worker_shutdown_timeout","title":"worker_shutdown_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 worker_shutdown_timeout <code>time</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 main \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.11 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u4e3a\u6b63\u5e38\u5173\u95ed\u5de5\u4f5c\u8fdb\u7a0b\u914d\u7f6e\u8d85\u65f6\u3002\u5f53\u65f6\u95f4\u5230\u671f\u65f6\uff0cnginx \u5c06\u5c1d\u8bd5\u5173\u95ed\u5f53\u524d\u6253\u5f00\u7684\u6240\u6709\u8fde\u63a5\u4ee5\u4fbf\u4e8e\u5173\u95ed\u5de5\u4f5c\u8fdb\u7a0b\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#working_directory","title":"working_directory","text":"- \u8bf4\u660e \u8bed\u6cd5 working_directory <code>directory</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 main <p>\u5b9a\u4e49\u5de5\u4f5c\u8fdb\u7a0b\u7684\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\u3002\u5b83\u4e3b\u8981\u7528\u4e8e\u7f16\u5199\u6838\u5fc3\u6587\u4ef6\u65f6\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5de5\u4f5c\u8fdb\u7a0b\u5e94\u6709\u6307\u5b9a\u76ee\u5f55\u7684\u5199\u5165\u6743\u9650\u3002</p>"},{"location":"Modules-reference/%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/ngx_core_module.html</p>"},{"location":"Modules-reference/google/ngx_google_perftools_module/","title":"ngx_google_perftools_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>google_perftools_profiles</li> </ul> </li> </ul> <p><code>ngx_google_perftoos_module</code> \u6a21\u5757\uff080.6.29\uff09\u53ef\u4ee5\u4f7f\u7528 Google \u6027\u80fd\u5de5\u5177 \u5bf9 nginx \u7684 worker \u8fdb\u7a0b\u8fdb\u884c\u5206\u6790\u3002\u8be5\u6a21\u5757\u9002\u7528\u4e8e nginx \u5f00\u53d1\u4eba\u5458\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\uff0c\u60a8\u53ef\u4ee5\u5728\u6784\u5efa\u65f6\u4f7f\u7528 <code>--with-google_perftools_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u6b64\u6a21\u5757\u3002</p> <p>\u8be5\u6a21\u5757\u9700\u8981 gperftools \u5e93\u3002</p> <p></p>"},{"location":"Modules-reference/google/ngx_google_perftools_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>google_perftools_profiles /path/to/profile;\n</code></pre> <p>profile \u6587\u4ef6\u5c06\u88ab\u5b58\u50a8\u4e3a <code>/path/to/profile.&lt;worker_pid&gt;</code>\u3002</p> <p></p>"},{"location":"Modules-reference/google/ngx_google_perftools_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/google/ngx_google_perftools_module/#google_perftools_profiles","title":"google_perftools_profiles","text":"- \u8bf4\u660e \u8bed\u6cd5 google_perftools_profiles <code>file ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 main <p>\u8bbe\u7f6e\u4fdd\u5b58 nginx worker \u8fdb\u7a0b\u5206\u6790\u4fe1\u606f\u7684\u6587\u4ef6\u7684\u540d\u540d\u3002worker \u8fdb\u7a0b\u7684 ID \u59cb\u7ec8\u662f\u6587\u4ef6\u540d\u7684\u4e00\u90e8\u5206\uff0c\u5e76\u8ffd\u52a0\u5728\u6587\u4ef6\u540d\u7684\u672b\u5c3e\u3002</p>"},{"location":"Modules-reference/google/ngx_google_perftools_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/ngx_google_perftools_module.html</p>"},{"location":"Modules-reference/http/ngx_http_access_module/","title":"ngx_http_access_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>allow</li> <li>deny</li> </ul> </li> </ul> <p><code>ngx_http_access_module</code> \u6a21\u5757\u5141\u8bb8\u9650\u5236\u5bf9\u67d0\u4e9b\u5ba2\u6237\u7aef\u5730\u5740\u7684\u8bbf\u95ee\u3002</p> <p>\u8bbf\u95ee\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5bc6\u7801\u3001\u5b50\u8bf7\u6c42\u7ed3\u679c\u6216 JWT \u9650\u5236\u3002\u53ef\u7528 satisfy \u6307\u4ee4\u901a\u8fc7\u5730\u5740\u548c\u5bc6\u7801\u540c\u65f6\u9650\u5236\u8bbf\u95ee\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_access_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location / {\ndeny  192.168.1.1;\nallow 192.168.1.0/24;\nallow 10.1.1.0/16;\nallow 2001:0db8::/32;\ndeny  all;\n}\n</code></pre> <p>\u6309\u987a\u5e8f\u68c0\u67e5\u89c4\u5219\uff0c\u76f4\u5230\u627e\u5230\u7b2c\u4e00\u4e2a\u5339\u914d\u9879\u3002\u5728\u672c\u4f8b\u4e2d\uff0c\u4ec5\u5141\u8bb8 IPv4 \u7f51\u7edc <code>10.1.1.0/16</code> \u548c <code>192.168.1.0/24</code> \u4e0e IPv6 \u7f51\u7edc <code>2001:0db8::/ 32</code> \u8bbf\u95ee\uff0c\u4e0d\u5305\u62ec\u5730\u5740 <code>192.168.1.1</code>\u3002\u5728\u5f88\u591a\u89c4\u5219\u7684\u60c5\u51b5\u4e0b\uff0c\u6700\u597d\u4f7f\u7528 ngx_http_geo_module \u6a21\u5757\u53d8\u91cf\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_access_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_access_module/#allow","title":"allow","text":"- \u8bf4\u660e \u8bed\u6cd5 allow <code>address</code> | <code>CIDR</code> | <code>unix:</code> | <code>all</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001limit_except <p>\u5141\u8bb8\u8bbf\u95ee\u6307\u5b9a\u7684\u7f51\u7edc\u6216\u5730\u5740\u3002\u5982\u679c\u6307\u5b9a\u4e86\u7279\u6b8a\u503c <code>unix:</code>\uff081.5.1\uff09\uff0c\u5219\u5141\u8bb8\u8bbf\u95ee\u6240\u6709 UNIX \u57df\u5957\u63a5\u5b57\u3002</p>"},{"location":"Modules-reference/http/ngx_http_access_module/#deny","title":"deny","text":"- \u8bf4\u660e \u8bed\u6cd5 deny <code>address</code> | <code>CIDR</code> | <code>unix:</code> | <code>all</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001limit_except <p>\u62d2\u7edd\u6307\u5b9a\u7f51\u7edc\u6216\u5730\u5740\u7684\u8bbf\u95ee\u3002\u5982\u679c\u6307\u5b9a\u4e86\u7279\u6b8a\u503c <code>unix:</code>\uff081.5.1\uff09\uff0c\u5219\u62d2\u7edd\u6240\u6709 UNIX \u57df\u5957\u63a5\u5b57\u7684\u8bbf\u95ee\u3002</p>"},{"location":"Modules-reference/http/ngx_http_access_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_access_module.html</p>"},{"location":"Modules-reference/http/ngx_http_addition_module/","title":"ngx_http_addition_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>add_before_body</li> <li>add_after_body</li> <li>addition_types</li> </ul> </li> </ul> <p><code>ngx_http_addition_module</code> \u662f\u4e00\u4e2a\u8fc7\u6ee4\u5668\uff0c\u7528\u4e8e\u5728\u54cd\u5e94\u4e4b\u524d\u548c\u4e4b\u540e\u6dfb\u52a0\u6587\u672c\u3002\u8be5\u6a21\u5757\u4e0d\u662f\u9ed8\u8ba4\u6784\u5efa\uff0c\u8981\u542f\u7528\u5e94\u4f7f\u7528 <code>--with-http_addition_module</code> \u914d\u7f6e\u53c2\u6570\u6784\u5efa\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_addition_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location / {\nadd_before_body /before_action;\nadd_after_body  /after_action;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_addition_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_addition_module/#add_before_body","title":"add_before_body","text":"- \u8bf4\u660e \u8bed\u6cd5 add_before_body <code>uri</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5728\u54cd\u5e94\u6b63\u6587\u4e4b\u524d\u6dfb\u52a0\u6587\u672c\uff0c\u4f5c\u4e3a\u7ed9\u5b9a\u5b50\u8bf7\u6c42\u7684\u4e00\u4e2a\u5904\u7406\u7ed3\u679c\u8fd4\u56de\u3002\u7a7a\u5b57\u7b26\u4e32\uff08<code>\"\"</code>\uff09\u4f5c\u4e3a\u53c2\u6570\u65f6\u5c06\u53d6\u6d88\u4ece\u5148\u524d\u914d\u7f6e\u7ea7\u522b\u7ee7\u627f\u7684\u989d\u5916\u6587\u672c\u3002</p>"},{"location":"Modules-reference/http/ngx_http_addition_module/#add_after_body","title":"add_after_body","text":"- \u8bf4\u660e \u8bed\u6cd5 add_after_body <code>uri</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5728\u54cd\u5e94\u6b63\u6587\u4e4b\u540e\u6dfb\u52a0\u6587\u672c\uff0c\u4f5c\u4e3a\u7ed9\u5b9a\u5b50\u8bf7\u6c42\u7684\u4e00\u4e2a\u5904\u7406\u7ed3\u679c\u8fd4\u56de\u3002\u7a7a\u5b57\u7b26\u4e32\uff08<code>\"\"</code>\uff09\u4f5c\u4e3a\u53c2\u6570\u65f6\u5c06\u53d6\u6d88\u4ece\u5148\u524d\u914d\u7f6e\u7ea7\u522b\u7ee7\u627f\u7684\u989d\u5916\u6587\u672c\u3002</p>"},{"location":"Modules-reference/http/ngx_http_addition_module/#addition_types","title":"addition_types","text":"- \u8bf4\u660e \u8bed\u6cd5 addition_types <code>mime-type ...</code>; \u9ed8\u8ba4 addition_types text/html; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.7.9 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9664\u4e86 <code>text/html</code> \u5916\uff0c\u5141\u8bb8\u60a8\u5728\u6307\u5b9a\u7684 MIME \u7c7b\u578b\u7684\u54cd\u5e94\u4e2d\u6dfb\u52a0\u6587\u672c\u3002\u7279\u6b8a\u503c <code>*</code> \u5339\u914d\u6240\u6709 MIME\u7c7b\u578b\uff080.8.29\uff09\u3002</p>"},{"location":"Modules-reference/http/ngx_http_addition_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_addition_module.html</p>"},{"location":"Modules-reference/http/ngx_http_auth_basic_module/","title":"ngx_http_auth_basic_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>auth_basic</li> <li>auth_basic_user_file</li> </ul> </li> </ul> <p><code>ngx_http_auth_basic_module</code> \u6a21\u5757\u5141\u8bb8\u901a\u8fc7\u4f7f\u7528 HTTP Basic Authentication \u534f\u8bae\u9a8c\u8bc1\u7528\u6237\u540d\u548c\u5bc6\u7801\u6765\u9650\u5236\u5bf9\u8d44\u6e90\u7684\u8bbf\u95ee\u3002</p> <p>\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5730\u5740\u3001\u5b50\u8bf7\u6c42\u7ed3\u679c\u6216 JWT \u6765\u9650\u5236\u8bbf\u95ee\u3002\u53ef\u4f7f\u7528 satisfy \u6307\u4ee4\u901a\u8fc7\u5730\u5740\u548c\u5bc6\u7801\u540c\u65f6\u9650\u5236\u8bbf\u95ee\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_auth_basic_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location / {\nauth_basic           \"closed site\";\nauth_basic_user_file conf/htpasswd;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_auth_basic_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_auth_basic_module/#auth_basic","title":"auth_basic","text":"- \u8bf4\u660e \u8bed\u6cd5 auth_basic <code>string</code> | <code>off</code>; \u9ed8\u8ba4 auth_basic off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001limit_except <p>\u4f7f\u7528 HTTP Basic Authentication \u534f\u8bae\uff0c\u542f\u7528\u7528\u6237\u540d\u548c\u5bc6\u7801\u9a8c\u8bc1\u3002\u6307\u5b9a\u7684\u53c2\u6570\u7528\u4f5c\u4e3a\u4e00\u4e2a <code>realm</code>\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.3.10\u30011.2.7\uff09\u3002\u7279\u6b8a\u503c <code>off</code> \u53ef\u4ee5\u53d6\u6d88\u4ece\u5148\u524d\u914d\u7f6e\u7ea7\u522b\u7ee7\u627f\u7684 <code>auth_basic</code> \u6307\u4ee4\u7684\u5f71\u54cd\u3002</p>"},{"location":"Modules-reference/http/ngx_http_auth_basic_module/#auth_basic_user_file","title":"auth_basic_user_file","text":"- \u8bf4\u660e \u8bed\u6cd5 auth_basic_user_file <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001limit_except <p>\u6307\u5b9a\u4e00\u4e2a\u7528\u4e8e\u4fdd\u5b58\u7528\u6237\u540d\u548c\u5bc6\u7801\u7684\u6587\u4ef6\uff0c\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code># comment\nname1:password1\nname2:password2:comment\nname3:password3\n</code></pre> <p><code>file</code> \u7684\u540d\u79f0\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002</p> <p>\u652f\u6301\u4ee5\u4e0b\u5bc6\u7801\u7c7b\u578b\uff1a</p> <ul> <li>\u7528 <code>crypt()</code> \u51fd\u6570\u52a0\u5bc6\uff1b\u53ef\u4ee5\u4f7f\u7528 Apache HTTP Server \u5206\u53d1\u7684\u6216 <code>openssl passwd</code> \u547d\u4ee4\u4e2d\u7684 <code>htpasswd</code> \u5de5\u5177\u751f\u6210\uff1b</li> <li>\u4f7f\u7528\u57fa\u4e8e MD5 \u5bc6\u7801\u7b97\u6cd5\uff08apr1\uff09\u7684 Apache \u53d8\u4f53\u8fdb\u884c\u6563\u5217\u8ba1\u7b97\uff1b\u53ef\u4ee5\u7528\u4e0e\u4e0a\u8ff0\u76f8\u540c\u7684\u5de5\u5177\u751f\u6210\uff1b</li> <li>RFC 2307 \u4e2d\u6307\u5b9a\u7684 <code>{scheme}data</code> \u8bed\u6cd5\uff081.0.3+\uff09\uff1b\u76ee\u524d\u7684\u5b9e\u73b0\u65b9\u6848\u5305\u62ec <code>PLAIN</code>\uff08\u4e00\u4e2a\u4e0d\u5e94\u8be5\u4f7f\u7528\u7684\u793a\u4f8b\uff09\u3001<code>SHA</code>\uff081.3.13\uff09\uff08\u7b80\u5355 SHA-1 \u6563\u5217\uff0c\u4e0d\u5e94\u8be5\u4f7f\u7528\uff09\u548c <code>SSHA</code>\uff08\u4e00\u4e9b\u8f6f\u4ef6\u5305\u4f7f\u7528\u4e86\u52a0\u76d0\u7684 SHA-1 \u6563\u5217\uff0c\u7279\u522b\u662f OpenLDAP \u548c Dovecot\uff09\u3002</li> </ul> <p>\u589e\u52a0\u4e86\u5bf9 SHA \u6a21\u5f0f\u7684\u652f\u6301\uff0c\u4ec5\u7528\u4e8e\u5e2e\u52a9\u4ece\u5176\u4ed6 Web \u670d\u52a1\u5668\u8fc1\u79fb\u3002 \u5b83\u4e0d\u5e94\u8be5\u7528\u4e8e\u65b0\u5bc6\u7801\uff0c\u56e0\u4e3a\u5b83\u4f7f\u7528\u7684\u672a\u52a0\u76d0\u7684 SHA-1 \u6563\u5217\u5bb9\u6613\u53d7\u5230\u5f69\u8679\u8868\u7684\u653b\u51fb\u3002</p>"},{"location":"Modules-reference/http/ngx_http_auth_basic_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_auth_basic_module.html</p>"},{"location":"Modules-reference/http/ngx_http_auth_jwt_module/","title":"ngx_http_auth_jwt_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>auth_jwt</li> <li>auth_jwt_header_set</li> <li>auth_jwt_claim_set</li> <li>auth_jwt_key_file</li> </ul> </li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_http_auth_jwt_module</code> \u6a21\u5757\uff081.11.3\uff09\u901a\u8fc7\u9a8c\u8bc1\u4f7f\u7528\u6307\u5b9a\u7684\u5bc6\u94a5\u63d0\u4f9b\u7684 JSON Web Token\uff08JWT\uff09\u6765\u5b9e\u73b0\u5ba2\u6237\u7aef\u6388\u6743\u3002JWT claims \u5fc5\u987b\u4ee5 JSON Web Signature\uff08JWS\uff09\u7ed3\u6784\u7f16\u7801\u3002\u8be5\u6a21\u5757\u53ef\u7528\u4e8e OpenID Connect \u8eab\u4efd\u9a8c\u8bc1\u3002</p> <p>\u8be5\u6a21\u5757\u53ef\u4ee5\u901a\u8fc7 satisfy \u6307\u4ee4\u4e0e\u5176\u4ed6\u8bbf\u95ee\u6a21\u5757\uff08\u5982 ngx_http_access_module\u3001ngx_http_auth_basic_module \u548c ngx_http_auth_request_module\uff09\u8fdb\u884c\u7ec4\u5408\u3002</p> <p>\u6b64\u6a21\u5757\u53ef\u4f5c\u4e3a\u6211\u4eec\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_auth_jwt_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location / {\nauth_jwt          \"closed site\";\nauth_jwt_key_file conf/keys.json;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_auth_jwt_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_auth_jwt_module/#auth_jwt","title":"auth_jwt","text":"- \u8bf4\u660e \u8bed\u6cd5 auth_jwt <code>string [token=$variable]</code> | <code>off</code>; \u9ed8\u8ba4 auth_jwt off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528 JSON Web Token \u9a8c\u8bc1\u3002\u6307\u5b9a\u7684\u5b57\u7b26\u4e32\u4f5c\u4e3a\u4e00\u4e2a <code>realm</code>\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002</p> <p>\u53ef\u9009\u7684 <code>token</code> \u53c2\u6570\u6307\u5b9a\u4e00\u4e2a\u5305\u542b JSON Web Token \u7684\u53d8\u91cf\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cJWT \u4f5c Bearer Token \u5728 Authorization \u5934\u4e2d\u4f20\u9012\u3002JWT \u4e5f\u53ef\u4ee5\u4f5c\u4e3a cookie \u6216\u67e5\u8be2\u5b57\u7b26\u4e32\u7684\u4e00\u90e8\u5206\u4f20\u9012\uff1a</p> <pre><code>auth_jwt \"closed site\" token=$cookie_auth_token;\n</code></pre> <p>\u7279\u6b8a\u503c <code>off</code> \u53d6\u6d88\u4ece\u4e0a\u4e00\u914d\u7f6e\u7ea7\u522b\u7ee7\u627f\u7684 <code>auth_jwt</code> \u6307\u4ee4\u7684\u4f5c\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_auth_jwt_module/#auth_basic_user_file","title":"auth_basic_user_file","text":"- \u8bf4\u660e \u8bed\u6cd5 auth_jwt_header_set <code>$variable name</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.10 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5c06 <code>variable</code> \u8bbe\u7f6e\u4e3a\u7ed9\u5b9a\u7684 JOSE \u5934\u53c2\u6570 <code>name</code>\u3002</p>"},{"location":"Modules-reference/http/ngx_http_auth_jwt_module/#auth_jwt_claim_set","title":"auth_jwt_claim_set","text":"- \u8bf4\u660e \u8bed\u6cd5 auth_jwt_claim_set <code>$variable name</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.10 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5c06 <code>variable</code> \u8bbe\u7f6e\u4e3a\u7ed9\u5b9a\u7684 JWT claim \u53c2\u6570 <code>name</code>\u3002</p>"},{"location":"Modules-reference/http/ngx_http_auth_jwt_module/#auth_jwt_key_file","title":"auth_jwt_key_file","text":"- \u8bf4\u660e \u8bed\u6cd5 auth_jwt_key_file <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u5b9a\u7528\u4e8e\u9a8c\u8bc1 JWT \u7b7e\u540d\u7684 JSON Web Key Set \u683c\u5f0f\u7684 <code>file</code>\uff08\u6587\u4ef6\uff09\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_auth_jwt_module/#_3","title":"\u5185\u5d4c\u53d8\u91cf","text":"<p><code>ngx_http_auth_jwt_module</code> \u6a21\u5757\u652f\u6301\u5185\u5d4c\u53d8\u91cf\uff1a</p> <ul> <li> <p><code>$jwt_header_name</code></p> <p>\u8fd4\u56de JOSE \u5934\u7684\u503c - <code>$jwt_claim_name</code></p> <p>\u8fd4\u56de JWT claim \u7684\u503c</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_auth_jwt_module/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_auth_jwt_module.html</p>"},{"location":"Modules-reference/http/ngx_http_auth_request_module/","title":"ngx_http_auth_request_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>auth_request</li> <li>auth_request_set</li> </ul> </li> </ul> <p><code>ngx_http_auth_request_module</code> \u6a21\u5757\uff081.5.4+\uff09\u57fa\u4e8e\u5b50\u8bf7\u6c42\u7ed3\u679c\u5b9e\u73b0\u5ba2\u6237\u7aef\u6388\u6743\u3002\u5982\u679c\u5b50\u8bf7\u6c42\u8fd4\u56de\u4e00\u4e2a 2xx \u54cd\u5e94\u4ee3\u7801\uff0c\u5219\u5141\u8bb8\u8bbf\u95ee\u3002\u5982\u679c\u8fd4\u56de 401 \u6216 403\uff0c\u5219\u62d2\u7edd\u8bbf\u95ee\u5e76\u629b\u51fa\u76f8\u5e94\u7684\u9519\u8bef\u4ee3\u7801\u3002\u5b50\u8bf7\u6c42\u8fd4\u56de\u7684\u4efb\u4f55\u5176\u4ed6\u54cd\u5e94\u4ee3\u7801\u88ab\u8ba4\u4e3a\u662f\u4e00\u4e2a\u9519\u8bef\u3002</p> <p>\u5bf9\u4e8e 401 \u9519\u8bef\uff0c\u5ba2\u6237\u7aef\u4e5f\u4ece\u5b50\u8bf7\u6c42\u54cd\u5e94\u4e2d\u63a5\u6536 WWW-Authenticate \u5934\u3002</p> <p>\u8be5\u6a21\u5757\u4e0d\u662f\u9ed8\u8ba4\u6784\u5efa\uff0c\u5e94\u8be5\u5728\u6784\u5efa\u65f6\u4f7f\u7528 <code>--with-http_auth_request_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p>\u8be5\u6a21\u5757\u53ef\u4ee5\u901a\u8fc7 satisfy \u6307\u4ee4\u4e0e\u5176\u4ed6\u8bbf\u95ee\u6a21\u5757\uff08\u5982 ngx_http_access_module\u3001ngx_http_auth_basic_module \u548c ngx_http_auth_jwt_module\uff09\u8fdb\u884c\u7ec4\u5408\u3002</p> <p>\u5728 1.7.3 \u7248\u672c\u4e4b\u524d\uff0c\u65e0\u6cd5\u7f13\u5b58\u5bf9\u6388\u6743\u5b50\u8bf7\u6c42\u7684\u54cd\u5e94\uff08\u4f7f\u7528 proxy_cache\u3001proxy_store \u7b49\uff09\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_auth_request_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location /private/ {\nauth_request /auth;\n...\n}\n\nlocation = /auth {\nproxy_pass ...\nproxy_pass_request_body off;\nproxy_set_header Content-Length \"\";\nproxy_set_header X-Original-URI $request_uri;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_auth_request_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_auth_request_module/#auth_request","title":"auth_request","text":"- \u8bf4\u660e \u8bed\u6cd5 auth_request <code>uri</code> | <code>off</code>; \u9ed8\u8ba4 auth_request off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u57fa\u4e8e\u5b50\u8bf7\u6c42\u7ed3\u679c\u7684\u6388\u6743\uff0c\u5e76\u8bbe\u7f6e\u53d1\u9001\u5b50\u8bf7\u6c42\u7684 URI\u3002</p>"},{"location":"Modules-reference/http/ngx_http_auth_request_module/#auth_request_set","title":"auth_request_set","text":"- \u8bf4\u660e \u8bed\u6cd5 auth_request_set <code>$variable value;</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u5728\u6388\u6743\u8bf7\u6c42\u5b8c\u6210\u540e\uff0c\u5c06\u8bf7\u6c42 <code>variable</code>\uff08\u53d8\u91cf\uff09\u8bbe\u7f6e\u4e3a\u7ed9\u5b9a\u7684 <code>value</code>\uff08\u503c\uff09\u3002\u8be5\u503c\u53ef\u80fd\u5305\u542b\u6388\u6743\u8bf7\u6c42\u4e2d\u7684\u53d8\u91cf\uff0c\u4f8b\u5982 <code>$upstream_http_*</code>\u3002</p>"},{"location":"Modules-reference/http/ngx_http_auth_request_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_auth_request_module.html</p>"},{"location":"Modules-reference/http/ngx_http_autoindex_module/","title":"ngx_http_autoindex_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>autoindex</li> <li>autoindex_exact_size</li> <li>autoindex_format</li> <li>autoindex_localtime</li> </ul> </li> </ul> <p><code>ngx_http_autoindex_module</code> \u6a21\u5757\u5904\u7406\u4ee5\u659c\u7ebf\u5b57\u7b26\uff08<code>/</code>\uff09\u7ed3\u5c3e\u7684\u8bf7\u6c42\u5e76\u751f\u6210\u4e00\u4e2a\u76ee\u5f55\u5217\u8868\u3002\u5f53 ngx_http_index_module \u6a21\u5757\u627e\u4e0d\u5230\u7d22\u5f15\u6587\u4ef6\u65f6\uff0c\u901a\u5e38\u4f1a\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9 <code>ngx_http_autoindex_module</code> \u6a21\u5757\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_autoindex_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location / {\nautoindex on;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_autoindex_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_autoindex_module/#autoindex","title":"autoindex","text":"- \u8bf4\u660e \u8bed\u6cd5 autoindex <code>on</code> | <code>off</code>; \u9ed8\u8ba4 autoindex off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u6216\u7981\u7528\u76ee\u5f55\u5217\u8868\u8f93\u51fa\u3002</p>"},{"location":"Modules-reference/http/ngx_http_autoindex_module/#autoindex_exact_size","title":"autoindex_exact_size","text":"- \u8bf4\u660e \u8bed\u6cd5 autoindex_exact_size <code>on</code> | <code>off</code>; \u9ed8\u8ba4 autoindex_exact_size on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5bf9\u4e8e HTML \u683c\u5f0f\uff0c\u6307\u5b9a\u662f\u5426\u5e94\u5728\u76ee\u5f55\u5217\u8868\u4e2d\u8f93\u51fa\u786e\u5207\u7684\u6587\u4ef6\u5927\u5c0f\uff0c\u6216\u8005\u56db\u820d\u4e94\u5165\u5230\u5343\u5b57\u8282\u3001\u5146\u5b57\u8282\u548c\u5343\u5146\u5b57\u8282\u3002</p>"},{"location":"Modules-reference/http/ngx_http_autoindex_module/#autoindex_format","title":"autoindex_format","text":"- \u8bf4\u660e \u8bed\u6cd5 autoindex_format <code>html</code> | <code>xml</code> | <code>json</code> | <code>jsonp</code>; \u9ed8\u8ba4 autoindex_format html; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.9 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u76ee\u5f55\u5217\u8868\u7684\u683c\u5f0f\u3002</p> <p>\u5f53\u4f7f\u7528 JSONP \u683c\u5f0f\u65f6\uff0c\u4f7f\u7528 <code>callback</code> \u8bf7\u6c42\u53c2\u6570\u8bbe\u7f6e\u56de\u8c03\u51fd\u6570\u7684\u540d\u79f0\u3002\u5982\u679c\u6ca1\u6709\u53c2\u6570\u6216\u4e3a\u7a7a\u503c\uff0c\u5219\u4f7f\u7528 JSON \u683c\u5f0f\u3002</p> <p>XML \u8f93\u51fa\u53ef\u4ee5\u4f7f\u7528 ngx_http_xslt_module \u6a21\u5757\u8fdb\u884c\u8f6c\u6362\u3002</p>"},{"location":"Modules-reference/http/ngx_http_autoindex_module/#autoindex_localtime","title":"autoindex_localtime","text":"- \u8bf4\u660e \u8bed\u6cd5 autoindex_localtime <code>on</code> | <code>off</code>; \u9ed8\u8ba4 autoindex_localtime off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5bf9\u4e8e HTML \u683c\u5f0f\uff0c\u6307\u5b9a\u76ee\u5f55\u5217\u8868\u4e2d\u7684\u65f6\u95f4\u662f\u5426\u5e94\u4f7f\u7528\u672c\u5730\u65f6\u533a\u6216 UTC \u8f93\u51fa\u3002</p>"},{"location":"Modules-reference/http/ngx_http_autoindex_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_autoindex_module.html</p>"},{"location":"Modules-reference/http/ngx_http_browser_module/","title":"ngx_http_browser_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>ancient_browser</li> <li>ancient_browser_value</li> <li>modern_browser</li> <li>modern_browser_value</li> </ul> </li> </ul> <p><code>ngx_http_browser_module</code> \u6a21\u5757\u521b\u5efa\u503c\u7531 User-Agent \u8bf7\u6c42\u5934\u57df\u51b3\u5b9a\u7684\u53d8\u91cf\uff1a</p> <ul> <li> <p><code>$modern_browser</code></p> <p>\u5982\u679c\u6d4f\u89c8\u5668\u88ab\u8bc6\u522b\u4e3a\u73b0\u4ee3\uff0c\u5219\u7b49\u4e8e modern_browser_value \u6307\u4ee4\u8bbe\u7f6e\u7684\u503c - <code>$ancient_browser</code></p> <p>\u5982\u679c\u6d4f\u89c8\u5668\u88ab\u8bc6\u522b\u4e3a\u53e4\u4ee3\uff0c\u5219\u7b49\u4e8e\u7531 ancient_browser_value \u6307\u4ee4\u8bbe\u7f6e\u7684\u503c</p> </li> <li> <p><code>$MSIE</code></p> <p>\u5982\u679c\u6d4f\u89c8\u5668\u88ab\u8bc6\u522b\u4e3a\u4efb\u4f55\u7248\u672c\u7684 MSIE\uff0c\u5219\u7b49\u4e8e <code>1</code></p> </li> </ul> <p></p>"},{"location":"Modules-reference/http/ngx_http_browser_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<p>\u9009\u62e9\u4e00\u4e2a\u7d22\u5f15\u6587\u4ef6\uff1a</p> <pre><code>modern_browser_value \"modern.\";\n\nmodern_browser msie      5.5;\nmodern_browser gecko     1.0.0;\nmodern_browser opera     9.0;\nmodern_browser safari    413;\nmodern_browser konqueror 3.0;\n\nindex index.${modern_browser}html index.html;\n</code></pre> <p>\u65e7\u6d4f\u89c8\u5668\u91cd\u5b9a\u5411\uff1a</p> <pre><code>modern_browser msie      5.0;\nmodern_browser gecko     0.9.1;\nmodern_browser opera     8.0;\nmodern_browser safari    413;\nmodern_browser konqueror 3.0;\n\nmodern_browser unlisted;\n\nancient_browser Links Lynx netscape4;\n\nif ($ancient_browser) {\nrewrite ^ /ancient.html;\n}\n</code></pre> <p></p>"},{"location":"Modules-reference/http/ngx_http_browser_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_browser_module/#ancient_browser","title":"ancient_browser","text":"- \u8bf4\u660e \u8bed\u6cd5 ancient_browser <code>string ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5982\u679c\u5728 User-Agent \u8bf7\u6c42\u5934\u57df\u4e2d\u627e\u5230\u4efb\u4f55\u7279\u6b8a\u7684\u5b50\u5b57\u7b26\u4e32\uff0c\u6d4f\u89c8\u5668\u5c06\u88ab\u89c6\u4e3a\u4f20\u7edf\u7c7b\u578b\u3002\u7279\u6b8a\u5b57\u7b26\u4e32 <code>netscape4</code> \u5bf9\u5e94\u4e8e\u6b63\u5219\u8868\u8fbe\u5f0f<code>^Mozilla/[1-4]</code>\u3002</p>"},{"location":"Modules-reference/http/ngx_http_browser_module/#ancient_browser_value","title":"ancient_browser_value","text":"- \u8bf4\u660e \u8bed\u6cd5 ancient_browser_value <code>string</code>; \u9ed8\u8ba4 ancient_browser_value 1; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e <code>$ancient_browser</code> \u53d8\u91cf\u7684\u503c\u3002</p>"},{"location":"Modules-reference/http/ngx_http_browser_module/#modern_browser","title":"modern_browser","text":"- \u8bf4\u660e \u8bed\u6cd5 modern_browser <code>browser version</code>;  modern_browser <code>unlisted</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u5b9a\u5c06\u6d4f\u89c8\u5668\u89c6\u4e3a\u73b0\u4ee3\u7248\u672c\u5f00\u59cb\u7684\u7248\u672c\u3002\u6d4f\u89c8\u5668\u53ef\u4ee5\u662f\u4ee5\u4e0b\u4efb\u4f55\u4e00\u79cd\uff1a<code>msie</code>\u3001<code>gecko</code>\uff08\u57fa\u4e8e Mozilla \u7684\u6d4f\u89c8\u5668\uff09\u3001<code>opera</code>\u3001<code>safari</code> \u6216 <code>konqueror</code>\u3002</p> <p>\u7248\u672c\u53ef\u4ee5\u662f\u4ee5\u4e0b\u5217\u683c\u5f0f\uff1aX\u3001X.X\u3001X.X.X \u6216 X.X.X.X\u3002\u6bcf\u79cd\u683c\u5f0f\u7684\u6700\u5927\u503c\u5206\u522b\u4e3a 4000\u30014000.99\u30014000.99.99 \u548c 4000.99.99.99\u3002</p> <p>\u672a\u5217\u51fa\u7684\u7279\u6b8a\u503c\u5982\u679c\u672a\u88ab <code>modern_browser</code> \u548c ancient_browser \u6307\u4ee4\u6307\u5b9a\uff0c\u5219\u5c06\u5176\u89c6\u4e3a\u73b0\u4ee3\u6d4f\u89c8\u5668\u3002\u5426\u5219\u88ab\u8ba4\u4e3a\u662f\u4f20\u7edf\u6d4f\u89c8\u5668\u3002\u5982\u679c\u8bf7\u6c42\u6ca1\u6709\u5728\u5934\u4e2d\u63d0\u4f9b User-Agent \u57df\uff0c\u5219\u6d4f\u89c8\u5668\u88ab\u89c6\u4e3a\u672a\u5217\u51fa\u3002</p>"},{"location":"Modules-reference/http/ngx_http_browser_module/#modern_browser_value","title":"modern_browser_value","text":"- \u8bf4\u660e \u8bed\u6cd5 modern_browser_value <code>string</code>; \u9ed8\u8ba4 modern_browser_value 1; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e <code>$modern_browser</code> \u53d8\u91cf\u7684\u503c\u3002</p>"},{"location":"Modules-reference/http/ngx_http_browser_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_browser_module.html</p>"},{"location":"Modules-reference/http/ngx_http_charset_module/","title":"ngx_http_charset_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>charset</li> <li>charset_map</li> <li>charset_types</li> <li>override_charset</li> <li>source_charset</li> </ul> </li> </ul> <p><code>ngx_http_charset_module</code> \u6a21\u5757\u5c06\u6307\u5b9a\u7684\u5b57\u7b26\u96c6\u6dfb\u52a0\u5230 Content-Type \u54cd\u5e94\u5934\u57df\u3002\u6b64\u5916\uff0c\u8be5\u6a21\u5757\u53ef\u4ee5\u5c06\u6570\u636e\u4ece\u4e00\u4e2a\u5b57\u7b26\u96c6\u8f6c\u6362\u4e3a\u53e6\u4e00\u4e2a\u5b57\u7b26\u96c6\uff0c\u4f46\u4e5f\u5b58\u5728\u4e00\u4e9b\u9650\u5236\uff1a</p> <ul> <li>\u8f6c\u6362\u5de5\u4f5c\u53ea\u80fd\u662f\u4ece\u670d\u52a1\u5668\u5230\u5ba2\u6237\u7aef</li> <li>\u53ea\u80fd\u8f6c\u6362\u5355\u5b57\u8282\u5b57\u7b26\u96c6</li> <li>\u6216\u8f6c\u4e3a/\u6765\u81ea UTF-8 \u7684\u5355\u5b57\u8282\u5b57\u7b26\u96c6\u3002</li> </ul> <p></p>"},{"location":"Modules-reference/http/ngx_http_charset_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>include        conf/koi-win;\n\ncharset        windows-1251;\nsource_charset koi8-r;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_charset_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_charset_module/#charset","title":"charset","text":"- \u8bf4\u660e \u8bed\u6cd5 charset <code>charset</code> | <code>off</code>; \u9ed8\u8ba4 charset off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001location \u4e2d\u7684 if <p>\u5c06\u6307\u5b9a\u7684\u5b57\u7b26\u96c6\u6dfb\u52a0\u5230 Content-Type \u54cd\u5e94\u5934\u57df\u3002\u5982\u679c\u6b64\u5b57\u7b26\u96c6\u4e0e source_charset \u6307\u4ee4\u6307\u5b9a\u7684\u5b57\u7b26\u96c6\u4e0d\u540c\uff0c\u5219\u6267\u884c\u8f6c\u6362\u3002</p> <p>\u53c2\u6570 <code>off</code> \u53d6\u6d88\u5c06\u5b57\u7b26\u96c6\u6dfb\u52a0\u5230 Content-Type \u54cd\u5e94\u5934\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u53d8\u91cf\u6765\u5b9a\u4e49\u5b57\u7b26\u96c6\uff1a</p> <pre><code>charset $charset;\n</code></pre> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53d8\u91cf\u7684\u503c\u81f3\u5c11\u8981\u5728 charset_map\u3001charset \u6216 source_charset \u5176\u4e2d\u4e00\u4e2a\u6307\u4ee4\u914d\u7f6e\u4e00\u6b21\u3002\u5bf9\u4e8e <code>utf-8</code>\u3001<code>windows-1251</code> \u548c <code>koi8-r</code> \u5b57\u7b26\u96c6\uff0c\u5c06 <code>conf/koi-win</code>\u3001<code>conf/koi-utf</code> \u548c <code>conf/win-utf</code> \u6587\u4ef6\u5305\u542b\u5230\u914d\u7f6e\u4e2d\u5c31\u8db3\u591f\u4e86\u3002\u5bf9\u4e8e\u5176\u4ed6\u5b57\u7b26\u96c6\uff0c\u53ea\u9700\u5236\u4f5c\u4e00\u4e2a\u865a\u6784\u7684\u8f6c\u6362\u8868\u5373\u53ef\uff0c\u4f8b\u5982\uff1a</p> <pre><code>charset_map iso-8859-5 _ { }\n</code></pre> <p>\u53e6\u5916\uff0c\u53ef\u4ee5\u5728 X-Accel-Charset \u54cd\u5e94\u5934\u57df\u4e2d\u8bbe\u7f6e\u4e00\u4e2a\u5b57\u7b26\u96c6\u3002\u53ef\u4ee5\u4f7f\u7528proxy_ignore_headers\u3001fastcgi_ignore_headers\u3001uwsgi_ignore_headers \u548c scgi_ignore_headers \u6307\u4ee4\u7981\u7528\u6b64\u529f\u80fd\u3002</p>"},{"location":"Modules-reference/http/ngx_http_charset_module/#charset_map","title":"charset_map","text":"- \u8bf4\u660e \u8bed\u6cd5 charset_map <code>charset1 charset2 { ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u63cf\u8ff0\u8f6c\u6362\u8868\uff0c\u5c06\u4e00\u4e2a\u5b57\u7b26\u96c6\u8f6c\u6362\u5230\u53e6\u4e00\u4e2a\u5b57\u7b26\u96c6\u3002\u53cd\u5411\u8f6c\u6362\u8868\u4e5f\u4f7f\u7528\u76f8\u540c\u7684\u6570\u636e\u6784\u5efa\u3002\u5b57\u7b26\u4ee3\u7801\u662f\u5341\u516d\u8fdb\u5236\u683c\u5f0f\u3002\u4e0d\u5728 80-FF \u8303\u56f4\u5185\u7684\u5b57\u7b26\u5c06\u88ab\u66ff\u6362\u4e3a <code>?</code>\u3002\u5f53\u4ece UTF-8 \u8f6c\u6362\u65f6\uff0c\u4e00\u4e2a\u5b57\u8282\u5b57\u7b26\u96c6\u4e2d\u4e22\u5931\u7684\u5b57\u7b26\u5c06\u88ab\u66ff\u6362\u4e3a <code>&amp;#XXXX;</code>\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>charset_map koi8-r windows-1251 {\nC0 FE ; # small yu\nC1 E0 ; # small a\nC2 E1 ; # small b\nC3 F6 ; # small ts\n...\n}\n</code></pre> <p>\u5728\u5c06\u8f6c\u6362\u8868\u63cf\u8ff0\u4e3a UTF-8 \u65f6\uff0c\u5e94\u5728\u7b2c\u4e8c\u5217\u4e2d\u7ed9\u51fa UTF-8 \u5b57\u7b26\u96c6\u4ee3\u7801\uff0c\u4f8b\u5982\uff1a</p> <pre><code>charset_map koi8-r utf-8 {\nC0 D18E ; # small yu\nC1 D0B0 ; # small a\nC2 D0B1 ; # small b\nC3 D186 ; # small ts\n...\n}\n</code></pre> <p>\u5728\u5206\u53d1\u6587\u4ef6 <code>conf/koi-win</code>\u3001<code>conf/koi-utf</code> \u548c <code>conf/win-utf</code> \u4e2d\u63d0\u4f9b\u4e86\u4ece <code>koi8-r</code> \u5230 <code>windows-1251</code> \u4ee5\u53ca\u4ece <code>koi8-r</code> \u548c <code>windows-1251</code> \u5230 <code>utf-8</code> \u7684\u5b8c\u6574\u8f6c\u6362\u8868\u3002</p>"},{"location":"Modules-reference/http/ngx_http_charset_module/#charset_types","title":"charset_types","text":"- \u8bf4\u660e \u8bed\u6cd5 charset_types <code>mime-type ...</code>; \u9ed8\u8ba4 charset_types text/html text/xml text/plain text/vnd.wap.wml application/javascript application/rss+xml; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.7.9 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9664\u4e86 <code>text/html</code> \u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u6307\u5b9a\u4e86 MIME \u7c7b\u578b\u7684\u54cd\u5e94\u4e2d\u7684\u6a21\u5757\u5904\u7406\u3002\u7279\u6b8a\u503c <code>*</code> \u53ef\u5339\u914d\u4efb\u4f55 MIME \u7c7b\u578b\uff080.8.29\uff09\u3002</p> <p>\u76f4\u5230 1.5.4 \u7248\u672c\uff0c<code>application/x-javascript</code> \u88ab\u4f5c\u4e3a\u9ed8\u8ba4\u7684 MIME \u7c7b\u578b\uff0c\u800c\u4e0d\u662f<code>application/javascript</code>\u3002</p>"},{"location":"Modules-reference/http/ngx_http_charset_module/#override_charset","title":"override_charset","text":"- \u8bf4\u660e \u8bed\u6cd5 override_charset <code>on</code> | <code>off</code>; \u9ed8\u8ba4 override_charset off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001location \u4e2d\u7684 if <p>\u5f53\u5e94\u7b54\u5df2\u7ecf\u5728 Content-Type \u54cd\u5e94\u5934\u57df\u4e2d\u643a\u5e26\u5b57\u7b26\u96c6\u65f6\uff0c\u786e\u5b9a\u662f\u5426\u5e94\u8be5\u5bf9\u4ece\u4ee3\u7406\u6216 FastCGI/uwsgi/SCGI \u670d\u52a1\u5668\u63a5\u6536\u7684\u5e94\u7b54\u6267\u884c\u8f6c\u6362\u3002\u5982\u679c\u542f\u7528\u8f6c\u6362\uff0c\u5219\u5728\u63a5\u6536\u5230\u7684\u54cd\u5e94\u4e2d\u6307\u5b9a\u7684\u5b57\u7b26\u96c6\u5c06\u7528\u4f5c\u6e90\u5b57\u7b26\u96c6\u3002</p> <p>\u5e94\u8be5\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u5728\u5b50\u8bf7\u6c42\u4e2d\u63a5\u6536\u5230\u54cd\u5e94\uff0c\u5219\u59cb\u7ec8\u6267\u884c\u4ece\u54cd\u5e94\u5b57\u7b26\u96c6\u5230\u4e3b\u8bf7\u6c42\u5b57\u7b26\u96c6\u7684\u8f6c\u6362\uff0c\u800c\u4e0d\u7ba1 <code>override_charset</code> \u6307\u4ee4\u5982\u4f55\u8bbe\u7f6e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_charset_module/#source_charset","title":"source_charset","text":"- \u8bf4\u660e \u8bed\u6cd5 source_charset <code>charset</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001location \u4e2d\u7684 if <p>\u5b9a\u4e49\u54cd\u5e94\u7684\u6e90\u5b57\u7b26\u96c6\u3002\u5982\u679c\u6b64\u5b57\u7b26\u96c6\u4e0e charset \u6307\u4ee4\u4e2d\u6307\u5b9a\u7684\u5b57\u7b26\u96c6\u4e0d\u540c\uff0c\u5219\u6267\u884c\u8f6c\u6362\u3002</p>"},{"location":"Modules-reference/http/ngx_http_charset_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_charset_module.html</p>"},{"location":"Modules-reference/http/ngx_http_core_module/","title":"ngx_http_core_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>absolute_redirect</li> <li>aio</li> <li>aio_write</li> <li>alias</li> <li>chunked_transfer_encoding</li> <li>client_body_buffer_size</li> <li>client_body_in_file_only</li> <li>client_body_in_single_buffer</li> <li>client_body_temp_path</li> <li>client_body_timeout</li> <li>client_header_buffer_size</li> <li>client_header_timeout</li> <li>client_max_body_size</li> <li>connection_pool_size</li> <li>default_type</li> <li>directio</li> <li>directio_alignment</li> <li>disable_symlinks</li> <li>error_page</li> <li>etag</li> <li>http</li> <li>if_modified_since</li> <li>ignore_invalid_headers</li> <li>internal</li> <li>keepalive_disable</li> <li>keepalive_requests</li> <li>keepalive_timeout</li> <li>large_client_header_buffers</li> <li>limit_except</li> <li>limit_rate</li> <li>limit_rate_after</li> <li>lingering_close</li> <li>lingering_time</li> <li>lingering_timeout</li> <li>listen</li> <li>location</li> <li>log_not_found</li> <li>log_subrequest</li> <li>max_ranges</li> <li>merge_slashes</li> <li>msie_padding</li> <li>msie_refresh</li> <li>open_file_cache</li> <li>open_file_cache_errors</li> <li>open_file_cache_min_uses</li> <li>open_file_cache_valid</li> <li>output_buffers</li> <li>port_in_redirect</li> <li>postpone_output</li> <li>read_ahead</li> <li>recursive_error_pages</li> <li>request_pool_size</li> <li>reset_timedout_connection</li> <li>resolver</li> <li>resolver_timeout</li> <li>root</li> <li>satisfy</li> <li>send_lowat</li> <li>send_timeout</li> <li>sendfile</li> <li>sendfile_max_chunk</li> <li>server</li> <li>server_name</li> <li>server_name_in_redirect</li> <li>server_names_hash_bucket_size</li> <li>server_names_hash_max_size</li> <li>server_tokens</li> <li>tcp_nodelay</li> <li>tcp_nopush</li> <li>try_files</li> <li>types</li> <li>types_hash_bucket_size</li> <li>types_hash_max_size</li> <li>underscores_in_headers</li> <li>variables_hash_bucket_size</li> <li>variables_hash_max_size</li> </ul> </li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul>"},{"location":"Modules-reference/http/ngx_http_core_module/#_1","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_core_module/#absolute_redirect","title":"absolute_redirect","text":"- \u8bf4\u660e \u8bed\u6cd5 absolute_redirect <code>on</code> | <code>off</code>; \u9ed8\u8ba4 absolute_redirect on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.8 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5982\u679c\u7981\u7528\uff0cnginx \u53d1\u51fa\u7684\u91cd\u5b9a\u5411\u5c06\u662f\u76f8\u5bf9\u7684\u3002</p> <p>\u53e6\u8bf7\u53c2\u9605 server_name_in_redirect \u548c port_in_redirect \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#aio","title":"aio","text":"- \u8bf4\u660e \u8bed\u6cd5 aio <code>on</code> | <code>off</code> | <code>threads[=pool]</code>; \u9ed8\u8ba4 aio off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.8.11 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u6216\u7981\u7528\u5728 FreeBSD \u548c Linux \u4e0a\u4f7f\u7528\u5f02\u6b65\u6587\u4ef6 I/O\uff08AIO\uff09\uff1a</p> <pre><code>location /video/ {\naio            on;\noutput_buffers 1 64k;\n}\n</code></pre> <p>\u5728 FreeBSD \u4e0a\uff0cAIO \u4ece FreeBSD 4.3 \u5f00\u59cb\u53ef\u7528\u3002\u5728 FreeBSD 11.0 \u4e4b\u524d\uff0c\u53ef\u4ee5\u5c06 AIO \u9759\u6001\u94fe\u63a5\u5230\u5185\u6838\u4e2d\uff1a</p> <pre><code>options VFS_AIO\n</code></pre> <p>\u6216\u4f5c\u4e3a\u4e00\u4e2a\u5185\u6838\u53ef\u52a0\u8f7d\u6a21\u5757\u52a8\u6001\u52a0\u8f7d\uff1a</p> <pre><code>kldload aio\n</code></pre> <p>\u5728 Linux \u4e0a\uff0cAIO \u4ece\u5185\u6838\u7248\u672c\u4e3a 2.6.22 \u5f00\u59cb\u53ef\u7528\u3002\u6b64\u5916\uff0c\u6709\u5fc5\u8981\u542f\u7528 directio\uff0c\u5426\u5219\u8bfb\u53d6\u5c06\u88ab\u963b\u585e\uff1a</p> <p><pre><code>location /video/ {\naio            on;\ndirectio       512;\noutput_buffers 1 128k;\n}\n</code></pre> \u5728 Linux \u4e0a\uff0cdirectio \u53ea\u80fd\u7528\u4e8e\u8bfb\u53d6 512 \u5b57\u8282\u8fb9\u754c\u5bf9\u9f50\u7684\u5757\uff08\u6216 XFS 4K\uff09\u3002\u6587\u4ef6\u672a\u5bf9\u9f50\u7684\u672b\u7aef\u4ee5\u963b\u585e\u6a21\u5f0f\u8bfb\u53d6\u3002\u5bf9\u4e8e\u5b57\u8282\u8303\u56f4\u8bf7\u6c42\u548c\u4e0d\u662f\u4ece\u6587\u4ef6\u5f00\u5934\u5f00\u59cb\u7684 FLV \u8bf7\u6c42\u4e5f\u662f\u5982\u6b64\uff1a\u5728\u6587\u4ef6\u7684\u5f00\u5934\u548c\u7ed3\u5c3e\u8bfb\u53d6\u672a\u5bf9\u9f50\u7684\u6570\u636e\u5c06\u88ab\u963b\u585e\u3002</p> <p>\u5f53\u5728 Linux \u4e0a\u542f\u7528 AIO \u548c sendfile \u65f6\uff0cAIO \u7528\u4e8e\u5927\u4e8e\u6216\u7b49\u4e8e directio \u6307\u4ee4\u6307\u5b9a\u5927\u5c0f\u7684\u6587\u4ef6\uff0c\u800c sendfile \u7528\u4e8e\u8f83\u5c0f\u7684\u6587\u4ef6\uff08\u7981\u7528 directio \u65f6\u4e5f\u662f\u5982\u6b64\uff09\u3002</p> <pre><code>location /video/ {\nsendfile       on;\naio            on;\ndirectio       8m;\n}\n</code></pre> <p>\u6700\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u591a\u7ebf\u7a0b\uff081.7.11\uff09\u8bfb\u53d6\u548c\u53d1\u9001\u6587\u4ef6\uff0c\u4e0d\u4f1a\u963b\u585e\u5de5\u4f5c\u8fdb\u7a0b\uff1a</p> <pre><code>location /video/ {\nsendfile       on;\naio            threads;\n}\n</code></pre> <p>\u8bfb\u53d6\u548c\u53d1\u9001\u6587\u4ef6\u64cd\u4f5c\u88ab\u5378\u8f7d\u5230\u6307\u5b9a\u6c60\u4e2d\u7684\u7ebf\u7a0b\u3002\u5982\u679c\u7701\u7565\u6c60\u540d\u79f0\uff0c\u5219\u4f7f\u7528\u540d\u79f0\u4e3a <code>default</code> \u7684\u6c60\u3002\u6c60\u540d\u4e5f\u53ef\u4ee5\u7528\u53d8\u91cf\u8bbe\u7f6e\uff1a</p> <pre><code>aio threads=pool$disk;\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u591a\u7ebf\u7a0b\u662f\u7981\u7528\u72b6\u6001\uff0c\u5b83\u5e94\u8be5\u4f7f\u7528 <code>--with-threads</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002\u76ee\u524d\uff0c\u591a\u7ebf\u7a0b\u4ec5\u4e0e epoll\u3001kqueue \u548c eventport \u65b9\u5f0f\u517c\u5bb9\u3002\u4ec5\u5728 Linux \u4e0a\u652f\u6301\u591a\u7ebf\u7a0b\u53d1\u9001\u6587\u4ef6\u3002</p> <p>\u53e6\u8bf7\u53c2\u89c1 sendfile \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#aio_write","title":"aio_write","text":"- \u8bf4\u660e \u8bed\u6cd5 aio_write <code>on</code> | <code>off</code>; \u9ed8\u8ba4 aio_write off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.9.13 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5982\u679c\u542f\u7528 aio\uff0c\u5219\u6307\u5b9a\u662f\u5426\u5199\u5165\u6587\u4ef6\u3002\u76ee\u524d\uff0c\u8fd9\u4ec5\u5728\u4f7f\u7528 aio \u7ebf\u7a0b\u65f6\u6709\u6548\uff0c\u5e76\u4e14\u4ec5\u9650\u4e8e\u5c06\u4ece\u4ee3\u7406\u670d\u52a1\u5668\u63a5\u6536\u7684\u6570\u636e\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#alias","title":"alias","text":"- \u8bf4\u660e \u8bed\u6cd5 alias <code>path</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 location <p>\u5b9a\u4e49\u6307\u5b9a location \u7684\u66ff\u6362\u3002\u4f8b\u5982\uff0c\u4f7f\u7528\u4ee5\u4e0b\u914d\u7f6e</p> <pre><code>location /i/ {\nalias /data/w3/images/;\n}\n</code></pre> <p><code>/i/top.gif</code> \u7684\u8bf7\u6c42\uff0c\u5c06\u53d1\u9001 <code>/data/w3/images/top.gif</code> \u6587\u4ef6\u3002</p> <p><code>path</code> \u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff0c\u9664 <code>$document_root</code> \u548c <code>$realpath_root</code> \u5916\u3002</p> <p>\u5982\u679c\u5728\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u5b9a\u4e49\u7684 location \u5185\u4f7f\u7528\u4e86\u522b\u540d\uff0c\u90a3\u4e48\u8fd9\u79cd\u6b63\u5219\u8868\u8fbe\u5f0f\u5e94\u8be5\u5305\u542b\u6355\u83b7\uff0c\u5e76\u4e14\u522b\u540d\u5e94\u8be5\u5f15\u7528\u8fd9\u4e9b\u6355\u83b7\uff080.7.40\uff09\uff0c\u4f8b\u5982\uff1a</p> <pre><code>location ~ ^/users/(.+\\.(?:gif|jpe?g|png))$ {\nalias /data/w3/images/$1;\n}\n</code></pre> <p>\u5f53 location \u4e0e\u6307\u4ee4\u503c\u7684\u6700\u540e\u4e00\u90e8\u5206\u5339\u914d\u65f6\uff1a</p> <pre><code>location /images/ {\nalias /data/w3/images/;\n}\n</code></pre> <p>\u66f4\u597d\u7684\u65b9\u5f0f\u662f\u4f7f\u7528 root \u6307\u4ee4\uff1a</p> <pre><code>location /images/ {\nroot /data/w3;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_core_module/#chunked_transfer_encoding","title":"chunked_transfer_encoding","text":"- \u8bf4\u660e \u8bed\u6cd5 chunked_transfer_encoding <code>on</code> | <code>off</code>; \u9ed8\u8ba4 chunked_transfer_encoding on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5141\u8bb8\u5728 HTTP/1.1 \u4e2d\u7981\u7528\u5206\u5757\u4f20\u8f93\u7f16\u7801\u3002\u5728\u4f7f\u7528\u7684\u8f6f\u4ef6\u672a\u80fd\u652f\u6301\u5206\u5757\u7f16\u7801\u65f6\u5b83\u53ef\u80fd\u4f1a\u6d3e\u4e0a\u7528\u573a\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#client_body_buffer_size","title":"client_body_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 client_body_buffer_size <code>size</code>; \u9ed8\u8ba4 client_body_buffer_size 8k \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u8bfb\u53d6\u5ba2\u6237\u7aef\u8bf7\u6c42\u4f53\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u3002\u5982\u679c\u8bf7\u6c42\u4f53\u5927\u4e8e\u7f13\u51b2\u533a\uff0c\u5219\u6574\u4e2a\u4f53\u6216\u4ec5\u5c06\u5176\u90e8\u5206\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u51b2\u533a\u5927\u5c0f\u7b49\u4e8e\u4e24\u4e2a\u5185\u5b58\u9875\u3002\u5728 x86\u3001\u5176\u4ed6 32 \u4f4d\u5e73\u53f0\u548c x86-64 \u4e0a\u662f 8K\u3002\u5728\u5176\u4ed6 64 \u4f4d\u5e73\u53f0\u4e0a\u901a\u5e38\u4e3a 16K\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#client_body_in_file_only","title":"client_body_in_file_only","text":"- \u8bf4\u660e \u8bed\u6cd5 client_body_in_file_only <code>on</code> | <code>clean</code> | <code>off</code>; \u9ed8\u8ba4 client_body_in_file_only off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u786e\u5b9a nginx \u662f\u5426\u5e94\u5c06\u6574\u4e2a\u5ba2\u6237\u7aef\u8bf7\u6c42\u4f53\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u3002\u53ef\u4ee5\u5728\u8c03\u8bd5\u671f\u95f4\u6216\u4f7f\u7528 <code>$request_body_file</code> \u53d8\u91cf\u6216\u6a21\u5757 ngx_http_perl_module \u7684 $r-&gt;request_body_file \u65b9\u6cd5\u65f6\u4f7f\u7528\u6b64\u6307\u4ee4\u3002</p> <p>\u5f53\u8bbe\u7f6e\u4e3a <code>on</code> \u503c\u65f6\uff0c\u4e34\u65f6\u6587\u4ef6\u5728\u8bf7\u6c42\u5904\u7406\u540e\u4e0d\u4f1a\u88ab\u5220\u9664\u3002</p> <p>\u503c <code>clean</code> \u4f1a\u5c06\u8bf7\u6c42\u5904\u7406\u540e\u5269\u4e0b\u7684\u4e34\u65f6\u6587\u4ef6\u5220\u9664\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#client_body_in_single_buffer","title":"client_body_in_single_buffer","text":"- \u8bf4\u660e \u8bed\u6cd5 client_body_in_single_buffer <code>on</code> | <code>off</code>; \u9ed8\u8ba4 client_body_in_single_buffer off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u786e\u5b9a nginx \u662f\u5426\u5e94\u5c06\u6574\u4e2a\u5ba2\u6237\u7aef\u8bf7\u6c42\u4f53\u4fdd\u5b58\u5728\u5355\u4e2a\u7f13\u51b2\u533a\u4e2d\u3002\u5728\u4f7f\u7528 <code>$request_body</code> \u53d8\u91cf\u65f6\uff0c\u5efa\u8bae\u4f7f\u7528\u8be5\u6307\u4ee4\uff0c\u7528\u6765\u4fdd\u5b58\u6d89\u53ca\u7684\u590d\u5236\u64cd\u4f5c\u6b21\u6570\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#client_body_temp_path","title":"client_body_temp_path","text":"- \u8bf4\u660e \u8bed\u6cd5 client_body_temp_path <code>path [level1 [level2 [level3]]]</code>; \u9ed8\u8ba4 client_body_temp_path client_body_temp; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u7528\u4e8e\u5b58\u50a8\u6301\u6709\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e3b\u4f53\u7684\u4e34\u65f6\u6587\u4ef6\u7684\u76ee\u5f55\u3002\u6700\u591a\u53ef\u4ee5\u5728\u6307\u5b9a\u76ee\u5f55\u4e0b\u4f7f\u7528\u4e09\u7ea7\u5b50\u76ee\u5f55\u5c42\u6b21\u7ed3\u6784\u3002\u4f8b\u5982\u4ee5\u4e0b\u914d\u7f6e</p> <pre><code>client_body_temp_path /spool/nginx/client_temp 1 2;\n</code></pre> <p>\u4e34\u65f6\u6587\u4ef6\u7684\u8def\u5f84\u53ef\u4ee5\u5982\u4e0b\uff1a</p> <pre><code>/spool/nginx/client_temp/7/45/00000123457\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_core_module/#client_body_timeout","title":"client_body_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 client_body_timeout <code>time</code>; \u9ed8\u8ba4 client_body_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u8bfb\u53d6\u5ba2\u6237\u7aef\u8bf7\u6c42\u6b63\u6587\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u8d85\u65f6\u8bbe\u7f6e\u4ec5\u662f\u5728\u4e24\u4e2a\u8fde\u7eed\u8bfb\u64cd\u4f5c\u4e4b\u95f4\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u800c\u4e0d\u662f\u6574\u4e2a\u8bf7\u6c42\u4f53\u7684\u4f20\u8f93\u8fc7\u7a0b\u3002\u5982\u679c\u5ba2\u6237\u7aef\u5728\u6b64\u65f6\u95f4\u5185\u6ca1\u6709\u53d1\u9001\u4efb\u4f55\u5185\u5bb9\uff0c\u5219\u4f1a\u5c06 408\uff08\u8bf7\u6c42\u8d85\u65f6\uff09\u9519\u8bef\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#client_header_buffer_size","title":"client_header_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 client_header_buffer_size <code>size</code>; \u9ed8\u8ba4 client_header_buffer_size 1k; \u4e0a\u4e0b\u6587 http\u3001server <p>\u8bbe\u7f6e\u8bfb\u53d6\u5ba2\u6237\u7aef\u8bf7\u6c42\u5934\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u3002\u5bf9\u4e8e\u5927\u591a\u6570\u8bf7\u6c42\uff0c1K \u5b57\u8282\u7684\u7f13\u51b2\u533a\u5c31\u8db3\u591f\u4e86\u3002\u4f46\u662f\uff0c\u5982\u679c\u8bf7\u6c42\u4e2d\u5305\u542b\u957f cookie\uff0c\u6216\u8005\u6765\u81ea WAP \u5ba2\u6237\u7aef\uff0c\u5219\u53ef\u80fd 1K \u662f\u4e0d\u9002\u7528\u7684\u3002\u5982\u679c\u8bf7\u6c42\u884c\u6216\u8bf7\u6c42\u5934\u57df\u4e0d\u9002\u5408\u6b64\u7f13\u51b2\u533a\uff0c\u5219\u4f1a\u5206\u914d\u7531 large_client_header_buffers \u6307\u4ee4\u914d\u7f6e\u7684\u8f83\u5927\u7f13\u51b2\u533a\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#client_header_timeout","title":"client_header_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 client_header_timeout <code>time</code>; \u9ed8\u8ba4 client_header_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server <p>\u5b9a\u4e49\u8bfb\u53d6\u5ba2\u6237\u7aef\u8bf7\u6c42\u5934\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u5982\u679c\u5ba2\u6237\u7aef\u5728\u8fd9\u6bb5\u65f6\u95f4\u5185\u6ca1\u6709\u4f20\u8f93\u6574\u4e2a\u62a5\u5934\uff0c\u5219\u5c06 408\uff08\u8bf7\u6c42\u8d85\u65f6\uff09\u9519\u8bef\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#client_max_body_size","title":"client_max_body_size","text":"- \u8bf4\u660e \u8bed\u6cd5 client_header_timeout <code>size</code>; \u9ed8\u8ba4 client_max_body_size 1m; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5728 Content-Length \u8bf7\u6c42\u5934\u57df\u4e2d\u6307\u5b9a\u5ba2\u6237\u7aef\u8bf7\u6c42\u4f53\u7684\u6700\u5927\u5141\u8bb8\u5927\u5c0f\u3002\u5982\u679c\u8bf7\u6c42\u7684\u5927\u5c0f\u8d85\u8fc7\u914d\u7f6e\u503c\uff0c\u5219\u5c06 413 \uff08\u8bf7\u6c42\u5b9e\u4f53\u8fc7\u5927\uff09\u9519\u8bef\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u8bf7\u6ce8\u610f\uff0c\u6d4f\u89c8\u5668\u65e0\u6cd5\u6b63\u786e\u663e\u793a\u6b64\u9519\u8bef\u3002\u5c06  <code>size</code> \u8bbe\u7f6e\u4e3a 0 \u5c06\u7981\u7528\u68c0\u67e5\u5ba2\u6237\u7aef\u8bf7\u6c42\u6b63\u6587\u5927\u5c0f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#connection_pool_size","title":"connection_pool_size","text":"- \u8bf4\u660e \u8bed\u6cd5 connection_pool_size <code>size</code>; \u9ed8\u8ba4 connection_pool_size 256 \u4e0a\u4e0b\u6587 http\u3001server <p>\u5141\u8bb8\u7cbe\u786e\u8c03\u6574\u6bcf\u4e2a\u8fde\u63a5\u7684\u5185\u5b58\u5206\u914d\u3002\u8be5\u6307\u4ee4\u5bf9\u6027\u80fd\u5f71\u54cd\u6700\u5c0f\uff0c\u4e00\u822c\u4e0d\u5efa\u8bae\u4f7f\u7528\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c32 \u4f4d\u5e73\u53f0\u4e0a\u7684\u5927\u5c0f\u4e3a 256 \u5b57\u8282\uff0c64 \u4f4d\u5e73\u53f0\u4e0a\u4e3a 512 \u5b57\u8282\u3002</p> <p>\u5728 1.9.8 \u7248\u672c\u4e4b\u524d\uff0c\u6240\u6709\u5e73\u53f0\u4e0a\u7684\u9ed8\u8ba4\u503c\u90fd\u4e3a 256\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#default_type","title":"default_type","text":"- \u8bf4\u660e \u8bed\u6cd5 default_type <code>mime-type</code>; \u9ed8\u8ba4 default_type text/plain; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u54cd\u5e94\u7684\u9ed8\u8ba4 MIME \u7c7b\u578b\u3002\u53ef\u4ee5\u4f7f\u7528 types \u6307\u4ee4\u5bf9 MIME \u7c7b\u578b\u7684\u6587\u4ef6\u6269\u5c55\u540d\u8fdb\u884c\u6620\u5c04\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#directio","title":"directio","text":"- \u8bf4\u660e \u8bed\u6cd5 directio <code>size</code> | <code>off</code>; \u9ed8\u8ba4 directio off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5f00\u542f\u5f53\u8bfb\u53d6\u5927\u4e8e\u6216\u7b49\u4e8e\u6307\u5b9a\u5927\u5c0f\u7684\u6587\u4ef6\u65f6\uff0c\u4f7f\u7528 <code>O_DIRECT</code> \u6807\u5fd7\uff08FreeBSD\u3001Linux\uff09\u3001<code>F_NOCACHE</code> \u6807\u5fd7\uff08macOS\uff09\u6216 <code>directio()</code> \u51fd\u6570\uff08Solaris\uff09\u3002\u8be5\u6307\u4ee4\u81ea\u52a8\u7981\u7528\uff080.7.15\uff09\u7ed9\u5b9a\u8bf7\u6c42\u4f7f\u7528\u7684 sendfile\u3002\u5b83\u53ef\u4ee5\u7528\u4e8e\u670d\u52a1\u5927\u6587\u4ef6\uff1a</p> <pre><code>directio 4m;\n</code></pre> <p>\u6216\u5f53\u5728 Linux \u4e0a\u4f7f\u7528 aio \u65f6\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#directio_alignment","title":"directio_alignment","text":"- \u8bf4\u660e \u8bed\u6cd5 directio_alignment <code>size</code>; \u9ed8\u8ba4 directio_alignment 512; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.8.11 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e directio \u7684\u5bf9\u9f50\u65b9\u5f0f\u3002\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c512 \u5b57\u8282\u7684\u5bf9\u9f50\u5c31\u8db3\u591f\u4e86\u3002\u4f46\u662f\uff0c\u5728 Linux \u4e0b\u4f7f\u7528 XFS \u65f6\uff0c\u9700\u8981\u589e\u52a0\u5230 4K\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#disable_symlinks","title":"disable_symlinks","text":"- \u8bf4\u660e \u8bed\u6cd5 disable_symlinks <code>off</code>;  disable_symlinks on | <code>if_not_owner [from=part]</code>; \u9ed8\u8ba4 disable_symlinks off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.15 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u786e\u5b9a\u6253\u5f00\u6587\u4ef6\u65f6\u5e94\u5982\u4f55\u5904\u7406\u7b26\u53f7\u94fe\u63a5\uff1a</p> <ul> <li> <p><code>off</code></p> <p>\u5141\u8bb8\u8def\u5f84\u540d\u4e2d\u7684\u7b26\u53f7\u94fe\u63a5\u7684\uff0c\u4e0d\u6267\u884c\u68c0\u67e5\u3002\u8fd9\u662f\u9ed8\u8ba4\u884c\u4e3a\u3002 - <code>on</code></p> <p>\u5982\u679c\u8def\u5f84\u540d\u5b58\u5728\u662f\u7b26\u53f7\u94fe\u63a5\u7684\u7ec4\u4ef6\uff0c\u5219\u62d2\u7edd\u5bf9\u6587\u4ef6\u7684\u8bbf\u95ee\u3002</p> </li> <li> <p><code>if_not_owner</code></p> <p>\u5982\u679c\u8def\u5f84\u540d\u5b58\u5728\u662f\u7b26\u53f7\u94fe\u63a5\u7684\u7ec4\u4ef6\uff0c\u5e76\u4e14\u94fe\u63a5\u6307\u5411\u7684\u94fe\u63a5\u548c\u5bf9\u8c61\u4e3a\u4e0d\u540c\u6240\u6709\u8005\uff0c\u5219\u62d2\u7edd\u8bbf\u95ee\u6587\u4ef6\u3002</p> </li> <li> <p><code>from=part</code></p> <p>\u5f53\u68c0\u67e5\u7b26\u53f7\u94fe\u63a5\uff08\u53c2\u6570 <code>on</code> \u548c <code>if_not_owner</code>\uff09\u65f6\uff0c\u901a\u5e38\u4f1a\u68c0\u67e5\u8def\u5f84\u540d\u7684\u6240\u6709\u7ec4\u4ef6\u3002\u53ef\u4ee5\u901a\u8fc7\u53e6\u5916\u6307\u5b9a <code>from=part</code> \u53c2\u6570\u6765\u907f\u514d\u68c0\u67e5\u8def\u5f84\u540d\u7684\u521d\u59cb\u90e8\u5206\u4e2d\u7684\u7b26\u53f7\u94fe\u63a5\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ea\u80fd\u4ece\u6307\u5b9a\u7684\u521d\u59cb\u90e8\u5206\u540e\u9762\u7684\u8def\u5f84\u540d\u7ec4\u4ef6\u68c0\u67e5\u7b26\u53f7\u94fe\u63a5\u3002\u5982\u679c\u8be5\u503c\u4e0d\u662f\u68c0\u67e5\u7684\u8def\u5f84\u540d\u7684\u521d\u59cb\u90e8\u5206\uff0c\u5219\u4f1a\u68c0\u67e5\u6574\u4e2a\u8def\u5f84\u540d\uff0c\u76f8\u5f53\u4e8e\u6ca1\u6709\u6307\u5b9a\u6b64\u53c2\u6570\u3002\u5982\u679c\u8be5\u503c\u4e0e\u6574\u4e2a\u6587\u4ef6\u540d\u5339\u914d\uff0c\u5219\u4e0d\u4f1a\u68c0\u67e5\u7b26\u53f7\u94fe\u63a5\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002</p> </li> </ul> <p>\u4f8b\u5982\uff1a</p> <pre><code>disable_symlinks on from=$document_root;\n</code></pre> <p>\u6b64\u6307\u4ee4\u4ec5\u9002\u7528\u4e8e\u5177\u6709 <code>openat()</code> \u548c <code>fstatat()</code> \u63a5\u53e3\u7684\u7cfb\u7edf\u3002\u8fd9\u6837\u7684\u7cfb\u7edf\u5305\u62ec\u73b0\u4ee3\u7248\u672c\u7684FreeBSD\u3001Linux \u548c Solaris\u3002</p> <p>\u53c2\u6570 <code>on</code> \u548c <code>if_not_owner</code> \u589e\u52a0\u4e86\u5904\u7406\u5f00\u9500\u3002</p> <p>\u5728\u4e0d\u652f\u6301\u6253\u5f00\u76ee\u5f55\u4ec5\u7528\u4e8e\u641c\u7d22\u7684\u7cfb\u7edf\u4e0a\uff0c\u8981\u4f7f\u7528\u8fd9\u4e9b\u53c2\u6570\uff0c\u9700\u8981 worker \u8fdb\u7a0b\u5bf9\u6240\u6709\u6b63\u5728\u68c0\u67e5\u7684\u76ee\u5f55\u5177\u6709\u8bfb\u53d6\u6743\u9650\u3002</p> <p>ngx_http_autoindex_module\u3001ngx_http_random_index_module \u548c ngx_http_dav_module \u6a21\u5757\u76ee\u524d\u5ffd\u7565\u6b64\u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#error_page","title":"error_page","text":"- \u8bf4\u660e \u8bed\u6cd5 error_page <code>code ... [=[response]] uri</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001location \u4e2d\u7684 if <p>\u5b9a\u4e49\u9488\u5bf9\u6307\u5b9a\u9519\u8bef\u663e\u793a\u7684 URI\u3002<code>uri</code> \u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>error_page 404             /404.html;\nerror_page 500 502 503 504 /50x.html;\n</code></pre> <p>\u8fd9\u4f1a\u5bfc\u81f4\u5ba2\u6237\u7aef\u8bf7\u6c42\u65b9\u6cd5\u66f4\u6539\u4e3a <code>GET</code>\uff0c\u5185\u90e8\u91cd\u5b9a\u5411\u5230\u6307\u5b9a\u7684 <code>uri</code>\uff08\u9664 <code>GET</code> \u548c <code>HEAD</code> \u4e4b\u5916\u7684\u6240\u6709\u65b9\u6cd5\uff09\u3002</p> <p>\u6b64\u5916\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>=response</code> \u8bed\u6cd5\u5c06\u4fee\u6539\u54cd\u5e94\u4ee3\u7801\uff0c\u4f8b\u5982\uff1a</p> <pre><code>error_page 404 =200 /empty.gif;\n</code></pre> <p>\u5982\u679c\u9519\u8bef\u54cd\u5e94\u662f\u7531\u4ee3\u7406\u670d\u52a1\u5668\u6216 FastCGI/uwsgi/SCGI \u670d\u52a1\u5668\u5904\u7406\uff0c\u5e76\u4e14\u670d\u52a1\u5668\u53ef\u80fd\u8fd4\u56de\u4e0d\u540c\u7684\u54cd\u5e94\u4ee3\u7801\uff08\u4f8b\u5982\uff0c200\u3001302\u3001401 \u6216 404\uff09\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u5176\u8fd4\u56de\u7684\u4ee3\u7801\u8fdb\u884c\u54cd\u5e94\uff1a</p> <pre><code>error_page 404 = /404.php;\n</code></pre> <p>\u5982\u679c\u5728\u5185\u90e8\u91cd\u5b9a\u5411\u65f6\u4e0d\u9700\u8981\u66f4\u6539 URI \u548c\u65b9\u6cd5\uff0c\u5219\u53ef\u4ee5\u5c06\u9519\u8bef\u5904\u7406\u4f20\u9012\u7ed9\u4e00\u4e2a\u547d\u540d\u4e86\u7684 location\uff1a</p> <pre><code>location / {\nerror_page 404 = @fallback;\n}\n\nlocation @fallback {\nproxy_pass http://backend;\n}\n</code></pre> <p>\u5982\u679c <code>uri</code> \u5904\u7406\u5bfc\u81f4\u53d1\u751f\u9519\u8bef\uff0c\u6700\u540e\u53d1\u751f\u9519\u8bef\u7684\u72b6\u6001\u4ee3\u7801\u5c06\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</p> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 URL \u91cd\u5b9a\u5411\u8fdb\u884c\u9519\u8bef\u5904\u7406\uff1a</p> <pre><code>error_page 403      http://example.com/forbidden.html;\nerror_page 404 =301 http://example.com/notfound.html;\n</code></pre> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u9ed8\u8ba4\u5c06\u54cd\u5e94\u4ee3\u7801 302 \u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u5b83\u53ea\u80fd\u662f\u91cd\u5b9a\u5411\u72b6\u6001\u4ee3\u7801\u5176\u4e2d\u4e4b\u4e00\uff08301\u3001302\u3001303\u3001307 \u548c 308\uff09\u3002</p> <p>\u5728 1.1.16 \u548c 1.0.13 \u7248\u672c\u4e4b\u524d\uff0c\u4ee3\u7801 307 \u6ca1\u6709\u88ab\u89c6\u4e3a\u91cd\u5b9a\u5411\u3002</p> <p>\u76f4\u5230 1.13.0 \u7248\u672c\uff0c\u4ee3\u7801 308 \u624d\u88ab\u89c6\u4e3a\u91cd\u5b9a\u5411\u3002</p> <p>\u5f53\u4e14\u4ec5\u5f53\u6ca1\u6709\u5728\u5f53\u524d\u7ea7\u522b\u4e0a\u5b9a\u4e49 error_page \u6307\u4ee4\u65f6\uff0c\u6307\u4ee4\u624d\u4ece\u4e0a\u4e00\u7ea7\u7ee7\u627f\u8fd9\u4e9b\u7279\u6027\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#etag","title":"etag","text":"- \u8bf4\u660e \u8bed\u6cd5 etag <code>on</code> | <code>off</code>; \u9ed8\u8ba4 etag on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.3.3 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u6216\u7981\u7528\u81ea\u52a8\u751f\u6210\u9759\u6001\u8d44\u6e90 ETag \u54cd\u5e94\u5934\u5b57\u6bb5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#http","title":"http","text":"- \u8bf4\u660e \u8bed\u6cd5 http <code>{ ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 main <p>\u63d0\u4f9b\u6307\u5b9a HTTP server \u6307\u4ee4\u7684\u914d\u7f6e\u6587\u4ef6\u4e0a\u4e0b\u6587\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#if_modified_since","title":"if_modified_since","text":"- \u8bf4\u660e \u8bed\u6cd5 if_modified_since <code>off</code> | <code>exact</code> | <code>before</code>; \u9ed8\u8ba4 if_modified_since exact; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.7.24 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u5982\u4f55\u5c06\u54cd\u5e94\u7684\u4fee\u6539\u65f6\u95f4\u4e0e If-Modified-Since \u8bf7\u6c42\u5934\u5b57\u6bb5\u4e2d\u7684\u65f6\u95f4\u8fdb\u884c\u6bd4\u8f83\uff1a</p> <ul> <li> <p><code>off</code></p> <p>\u5ffd\u7565 If-Modified-Since \u8bf7\u6c42\u5934\u5b57\u6bb5\uff080.7.34\uff09 - <code>exact</code></p> <p>\u5b8c\u5168\u5339\u914d - <code>before</code></p> <p>\u54cd\u5e94\u7684\u4fee\u6539\u65f6\u95f4\u5c0f\u4e8e\u6216\u7b49\u4e8e If-Modified-Since \u8bf7\u6c42\u5934\u5b57\u6bb5\u4e2d\u7684\u65f6\u95f4</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_core_module/#ignore_invalid_headers","title":"ignore_invalid_headers","text":"- \u8bf4\u660e \u8bed\u6cd5 ignore_invalid_headers <code>on</code> | <code>off</code>; \u9ed8\u8ba4 ignore_invalid_headers on; \u4e0a\u4e0b\u6587 http\u3001server <p>\u63a7\u5236\u662f\u5426\u5e94\u5ffd\u7565\u5177\u6709\u65e0\u6548\u540d\u79f0\u7684\u5934\u5b57\u6bb5\u3002\u6709\u6548\u540d\u79f0\u7531\u82f1\u6587\u5b57\u6bcd\u3001\u6570\u5b57\u3001\u8fde\u5b57\u7b26\u6216\u4e0b\u5212\u7ebf\u7ec4\u6210\uff08\u7531 underscores_in_headers \u6307\u4ee4\u63a7\u5236\uff09\u3002</p> <p>\u5982\u679c\u5728 server \u7ea7\u522b\u6307\u5b9a\u4e86\u8be5\u6307\u4ee4\uff0c\u5219\u5176\u503c\u4ec5\u5728 server \u4e3a\u9ed8\u8ba4 server \u65f6\u4f7f\u7528\u3002\u6307\u5b9a\u7684\u503c\u4e5f\u9002\u7528\u4e8e\u76d1\u542c\u76f8\u540c\u5730\u5740\u548c\u7aef\u53e3\u7684\u6240\u6709\u865a\u62df\u670d\u52a1\u5668\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#internal","title":"internal","text":"- \u8bf4\u660e \u8bed\u6cd5 internal; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 location <p>\u6307\u5b9a\u7ed9\u5b9a\u7684 location \u53ea\u80fd\u7528\u4e8e\u5185\u90e8\u8bf7\u6c42\u3002\u5bf9\u4e8e\u5916\u90e8\u8bf7\u6c42\uff0c\u8fd4\u56de\u5ba2\u6237\u7aef\u9519\u8bef 404\uff08\u672a\u627e\u5230\uff09\u3002\u5185\u90e8\u8bf7\u6c42\u5982\u4e0b\uff1a</p> <ul> <li>\u8bf7\u6c42\u7531 error_page\u3001index\u3001random_index \u548c try_files \u6307\u4ee4\u91cd\u5b9a\u5411</li> <li>\u6765 upstream server \u7684 X-Accel-Redirect \u54cd\u5e94\u5934\u5b57\u6bb5\u91cd\u5b9a\u5411\u7684\u8bf7\u6c42</li> <li>\u7531 ngx_http_ssi_module \u6a21\u5757\u7684 <code>include virtual</code> \u547d\u4ee4\u3001ngx_http_addition_module \u6a21\u5757\u6307\u4ee4\u548c auth_request \u548c mirror \u6307\u4ee4\u7ec4\u6210\u7684\u5b50\u8bf7\u6c42</li> <li>\u7531 rewrite \u6307\u4ee4\u66f4\u6539\u7684\u8bf7\u6c42</li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>error_page 404 /404.html;\n\nlocation /404.html {\ninternal;\n}\n</code></pre> <p>\u6bcf\u4e2a\u8bf7\u6c42\u9650\u5236 10 \u4e2a\u5185\u90e8\u91cd\u5b9a\u5411\uff0c\u4ee5\u9632\u6b62\u4e0d\u6b63\u786e\u914d\u7f6e\u5f15\u53d1\u7684\u8bf7\u6c42\u5904\u7406\u6b7b\u5faa\u73af\u3002\u5982\u679c\u8fbe\u5230\u6b64\u9650\u5236\uff0c\u5219\u8fd4\u56de\u9519\u8bef 500\uff08\u5185\u90e8\u670d\u52a1\u5668\u9519\u8bef\uff09\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5728\u9519\u8bef\u65e5\u5fd7\u4e2d\u770b\u5230 <code>rewrite or internal redirection cycle</code> \u6d88\u606f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#keepalive_disable","title":"keepalive_disable","text":"- \u8bf4\u660e \u8bed\u6cd5 keepalive_disable <code>none</code> | <code>browser ...</code>; \u9ed8\u8ba4 keepalive_disable msie6; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u7981\u7528\u4e0e\u884c\u4e3a\u5f02\u5e38\u7684\u6d4f\u89c8\u5668\u4fdd\u6301\u8fde\u63a5\u3002<code>browser</code> \u53c2\u6570\u6307\u5b9a\u54ea\u4e9b\u6d4f\u89c8\u5668\u5c06\u53d7\u5230\u5f71\u54cd\u3002\u4e00\u65e6\u63a5\u6536\u5230 POST \u8bf7\u6c42\uff0c\u503c <code>msie6</code> \u5c06\u7981\u7528\u4e0e\u65e7\u7248\u672c MSIE \u4fdd\u6301\u8fde\u63a5\u3002\u503c <code>safari</code> \u7981\u7528\u4e0e macOS \u548c\u7c7b\u4f3c MacOS \u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u7684 Safari \u548c Safari \u6d4f\u89c8\u5668\u4fdd\u6301\u8fde\u63a5\u3002\u503c <code>none</code> \u542f\u7528\u4e0e\u6240\u6709\u6d4f\u89c8\u5668\u4fdd\u6301\u8fde\u63a5\u3002</p> <p>\u5728 1.1.18 \u7248\u672c\u4e4b\u524d\uff0c\u503c <code>safari</code> \u5339\u914d\u6240\u6709\u64cd\u4f5c\u7cfb\u7edf\u4e0a\u7684\u6240\u6709 Safari \u548c\u7c7b Safari \u6d4f\u89c8\u5668\uff0c\u5e76\u4e14\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7981\u7528\u4e0e\u5b83\u4eec\u4fdd\u6301\u8fde\u63a5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#keepalive_requests","title":"keepalive_requests","text":"- \u8bf4\u660e \u8bed\u6cd5 keepalive_requests <code>number</code>; \u9ed8\u8ba4 keepalive_requests 100; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.8.0 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u901a\u8fc7\u4e00\u4e2a\u4fdd\u6301\u6d3b\u52a8\uff08keep-alive\uff09\u8fde\u63a5\u53ef\u4ee5\u63d0\u4f9b\u7684\u6700\u5927\u8bf7\u6c42\u6570\u3002\u5728\u53d1\u51fa\u7684\u8bf7\u6c42\u8fbe\u5230\u6700\u5927\u6570\u91cf\u540e\uff0c\u8fde\u63a5\u5c06\u88ab\u5173\u95ed\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#keepalive_timeout","title":"keepalive_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 keepalive_timeout <code>timeout</code> <code>[header_timeout]</code>; \u9ed8\u8ba4 keepalive_timeout 75s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u7b2c\u4e00\u4e2a\u53c2\u6570\u8bbe\u7f6e\u4e00\u4e2a\u8d85\u65f6\u65f6\u95f4\uff0ckeep-alive \u5ba2\u6237\u7aef\u8fde\u63a5\u5c06\u5728\u670d\u52a1\u7aef\u4fdd\u6301\u6253\u5f00\u72b6\u6001\u3002\u96f6\u503c\u5c06\u7981\u7528  keep-alive \u5ba2\u6237\u7aef\u8fde\u63a5\u3002\u53ef\u9009\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\u5728 Keep-Alive: timeout=<code>time</code> \u54cd\u5e94\u5934\u57df\u4e2d\u8bbe\u7f6e\u4e00\u4e2a\u503c\u3002\u4e24\u4e2a\u53c2\u6570\u53ef\u80fd\u4e0d\u540c\u3002</p> <p>Mozilla \u548c Konqueror \u4f1a\u8bc6\u522b **Keep-Alive: timeout=<code>time</code> \u5934\u5b57\u6bb5\u3002MSIE \u5728\u5927\u7ea6\u5728 60 \u79d2\u949f\u5185\u81ea\u884c\u5173\u95ed keep-alive \u8fde\u63a5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#large_client_header_buffers","title":"large_client_header_buffers","text":"- \u8bf4\u660e \u8bed\u6cd5 large_client_header_buffers <code>number size</code>; \u9ed8\u8ba4 arge_client_header_buffers 4 8k; \u4e0a\u4e0b\u6587 http\u3001server <p>\u8bbe\u7f6e\u7528\u4e8e\u8bfb\u53d6\u5927\u5ba2\u6237\u7aef\u8bf7\u6c42\u5934\u7684\u7f13\u51b2\u533a\u7684\u6700\u5927 <code>number</code>\uff08\u6570\u91cf\uff09\u548c <code>size</code>\uff08\u5927\u5c0f\uff09\u3002\u8bf7\u6c42\u884c\u4e0d\u80fd\u8d85\u8fc7\u4e00\u4e2a\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff0c\u5426\u5219\u5c06\u8fd4\u56de 414\uff08\u8bf7\u6c42 URI \u592a\u957f\uff09\u9519\u8bef\u7ed9\u5ba2\u6237\u7aef\u3002\u8bf7\u6c42\u5934\u5b57\u6bb5\u4e5f\u4e0d\u80fd\u8d85\u8fc7\u4e00\u4e2a\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff0c\u5426\u5219\u5c06\u8fd4\u56de 400\uff08\u9519\u8bef\u8bf7\u6c42\uff09\u9519\u8bef\u7ed9\u5ba2\u6237\u7aef\u3002\u7f13\u51b2\u533a\u53ea\u80fd\u6309\u9700\u5206\u914d\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u51b2\u533a\u5927\u5c0f\u7b49\u4e8e 8K \u5b57\u8282\u3002\u5982\u679c\u5728\u8bf7\u6c42\u5904\u7406\u7ed3\u675f\u4e4b\u540e\uff0c\u8fde\u63a5\u88ab\u8f6c\u6362\u4e3a keep-alive \u72b6\u6001\uff0c\u8fd9\u4e9b\u7f13\u51b2\u533a\u5c06\u88ab\u91ca\u653e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#limit_except","title":"limit_except","text":"- \u8bf4\u660e \u8bed\u6cd5 limit_except <code>method ... { ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 location <p>\u9650\u5236\u7ed9\u5b9a\u7684 location \u5185\u5141\u8bb8\u7684 HTTP \u65b9\u6cd5\u3002<code>method</code> \u53c2\u6570\u53ef\u4ee5\u662f\u4ee5\u4e0b\u4e4b\u4e00\uff1a<code>GET</code>\u3001<code>HEAD</code>\u3001<code>POST</code>\u3001<code>PUT</code>\u3001<code>DELETE</code>\u3001<code>MKCOL</code>\u3001<code>COPY</code>\u3001<code>MOVE</code>\u3001<code>OPTIONS</code>\u3001<code>PROPFIND</code>\u3001<code>PROPPATCH</code>\u3001<code>LOCK</code>\u3001<code>UNLOCK</code> \u6216 <code>PATCH</code>\u3002\u5141\u8bb8 <code>GET</code> \u65b9\u6cd5\u4e5f\u5c06\u4f7f\u5f97 <code>HEAD</code>\u65b9\u6cd5\u88ab\u5141\u8bb8\u3002\u53ef\u4ee5\u4f7f\u7528 ngx_http_access_module \u548c ngx_http_auth_basic_module \u6a21\u5757\u6307\u4ee4\u6765\u9650\u5236\u5bf9\u5176\u4ed6\u65b9\u6cd5\u7684\u8bbf\u95ee\uff1a</p> <pre><code>limit_except GET {\nallow 192.168.1.0/32;\ndeny  all;\n}\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u8fd9\u5c06\u9650\u5236\u8bbf\u95ee\u9664 <code>GET</code> \u548c <code>HEAD</code> \u4e4b\u5916\u7684\u6240\u6709\u65b9\u6cd5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#limit_rate","title":"limit_rate","text":"- \u8bf4\u660e \u8bed\u6cd5 limit_rate <code>rate</code>; \u9ed8\u8ba4 limit_rate 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001location \u4e2d\u7684 if <p>\u9650\u5236\u5ba2\u6237\u7aef\u7684\u54cd\u5e94\u4f20\u8f93\u901f\u7387\u3002<code>rate</code> \u4ee5\u5b57\u8282/\u79d2\u4e3a\u5355\u4f4d\u3002\u96f6\u503c\u5c06\u7981\u7528\u901f\u7387\u9650\u5236\u3002\u9650\u5236\u8bbe\u7f6e\u662f\u9488\u5bf9\u6bcf\u4e2a\u8bf7\u6c42\uff0c\u56e0\u6b64\u5982\u679c\u5ba2\u6237\u7aef\u540c\u65f6\u6253\u5f00\u4e24\u4e2a\u8fde\u63a5\uff0c\u5219\u6574\u4f53\u901f\u7387\u5c06\u662f\u6307\u5b9a\u9650\u5236\u7684\u4e24\u500d\u3002</p> <p>\u4e5f\u53ef\u4ee5\u5728 <code>$limit_rate</code> \u53d8\u91cf\u4e2d\u8bbe\u7f6e\u901f\u7387\u9650\u5236\u3002\u6839\u636e\u67d0\u4e9b\u6761\u4ef6\u6765\u9650\u5236\u901f\u7387\u53ef\u80fd\u4f1a\u6709\u7528\uff1a</p> <pre><code>server {\n\nif ($slow) {\nset $limit_rate 4k;\n}\n\n...\n}\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u5728\u4ee3\u7406\u670d\u52a1\u5668\u54cd\u5e94\u7684 X-Accel-Limit-Rate \u5934\u5b57\u6bb5\u4e2d\u8bbe\u7f6e\u901f\u7387\u9650\u5236\u3002\u53ef\u4ee5\u4f7f\u7528 proxy_ignore_headers\u3001fastcgi_ignore_headers\u3001uwsgi_ignore_headers \u548c scgi_ignore_headers \u6307\u4ee4\u7981\u7528\u6b64\u529f\u80fd\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#lingering_time","title":"lingering_time","text":"- \u8bf4\u660e \u8bed\u6cd5 lingering_time <code>time</code>; \u9ed8\u8ba4 lingering_time 30s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5f53 lingering_close \u751f\u6548\u65f6\uff0c\u8be5\u6307\u4ee4\u6307\u5b9a nginx \u5904\u7406\uff08\u8bfb\u53d6\u548c\u5ffd\u7565\uff09\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u989d\u5916\u6570\u636e\u7684\u6700\u957f\u65f6\u95f4\u3002\u4e4b\u540e\uff0c\u8fde\u63a5\u5c06\u88ab\u5173\u95ed\uff0c\u5373\u4f7f\u8fd8\u6709\u66f4\u591a\u7684\u6570\u636e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#lingering_timeout","title":"lingering_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 lingering_timeout <code>time</code>; \u9ed8\u8ba4 lingering_timeout 5s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5f53 lingering_close \u751f\u6548\u65f6\uff0c\u8be5\u6307\u4ee4\u6307\u5b9a\u66f4\u591a\u7684\u5ba2\u6237\u7aef\u6570\u636e\u5230\u8fbe\u7684\u6700\u957f\u7b49\u5f85\u65f6\u95f4\u3002\u5982\u679c\u5728\u6b64\u671f\u95f4\u672a\u6536\u5230\u6570\u636e\uff0c\u5219\u5173\u95ed\u8fde\u63a5\u3002\u5426\u5219\uff0c\u8bfb\u53d6\u548c\u5ffd\u7565\u6570\u636e\uff0cnginx \u518d\u6b21\u5f00\u59cb\u7b49\u5f85\u66f4\u591a\u7684\u6570\u636e\u3002wait-read-ignore \u5faa\u73af\u88ab\u91cd\u590d\uff0c\u4f46\u4e0d\u518d\u7531 lingering_time \u6307\u4ee4\u6307\u5b9a\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#listen","title":"listen","text":"- \u8bf4\u660e \u8bed\u6cd5 listen <code>address[:port] [default_server] [ssl] [http2 \\| spdy] [proxy_protocol] [setfib=number] [fastopen=number] [backlog=number] [rcvbuf=size] [sndbuf=size] [accept_filter=filter] [deferred] [bind] [ipv6only=on\\|off] [reuseport] [so_keepalive=on\\|off\\|[keepidle]:[keepintvl]:[keepcnt]]</code>;  listen <code>port [default_server] [ssl] [http2 \\| spdy] [proxy_protocol] [setfib=number] [fastopen=number] [backlog=number] [rcvbuf=size] [sndbuf=size] [accept_filter=filter] [deferred] [bind] [ipv6only=on\\|off] [reuseport] [so_keepalive=on\\|off\\|[keepidle]:[keepintvl]:[keepcnt]]</code>;  listen <code>unix:path [default_server] [ssl] [http2 \\| spdy] [proxy_protocol] [backlog=number] [rcvbuf=size] [sndbuf=size] [accept_filter=filter] [deferred] [bind] [so_keepalive=on\\|off\\|[keepidle]:[keepintvl]:[keepcnt]]</code>; \u9ed8\u8ba4 listen *:80 | *:8000; \u4e0a\u4e0b\u6587 server <p>\u8bbe\u7f6e IP \u7684 <code>address</code> \uff08\u5730\u5740\uff09\u548c <code>port</code> \uff08\u7aef\u53e3\uff09\uff0c\u6216\u670d\u52a1\u5668\u63a5\u53d7\u8bf7\u6c42\u7684 UNIX \u57df\u5957\u63a5\u5b57\u7684 <code>path</code> \uff08\u8def\u5f84\uff09\u3002\u53ef\u4ee5\u540c\u65f6\u6307\u5b9a <code>addres</code> \uff08\u5730\u5740\uff09\u548c <code>port</code> \uff08\u7aef\u53e3\uff09\uff0c\u4e5f\u53ef\u4ee5\u53ea\u6307\u5b9a <code>address</code> \uff08\u5730\u5740\uff09\u6216 <code>port</code> \uff08\u7aef\u53e3\uff09\u3002<code>address</code> \u4e5f\u53ef\u4ee5\u662f\u4e3b\u673a\u540d\uff0c\u4f8b\u5982\uff1a</p> <p><pre><code>listen 127.0.0.1:8000;\nlisten 127.0.0.1;\nlisten 8000;\nlisten *:8000;\nlisten localhost:8000;\n</code></pre> IPv6 \u5730\u5740\uff080.7.36\uff09\u5728\u65b9\u62ec\u53f7\u4e2d\u6307\u5b9a\uff1a</p> <p><pre><code>listen [::]:8000;\nlisten [::1];\n</code></pre> UNIX \u57df\u5957\u63a5\u5b57\uff080.8.21\uff09\u7528 <code>unix:</code> \u524d\u7f00\u6307\u5b9a\uff1a</p> <pre><code>listen unix:/var/run/nginx.sock;\n</code></pre> <p>\u5982\u679c\u53ea\u6307\u5b9a <code>address</code>\uff0c\u5219\u4f7f\u7528 80 \u7aef\u53e3\u3002</p> <p>\u5982\u679c\u6307\u4ee4\u4e0d\u5b58\u5728\uff0c\u90a3\u4e48\u5982\u679c nginx \u662f\u4ee5\u8d85\u7ea7\u7528\u6237\u6743\u9650\u8fd0\u884c\uff0c\u5219\u4f7f\u7528 <code>*:80</code>\uff0c\u5426\u5219\u4f7f\u7528 <code>*:8000</code>\u3002</p> <p><code>default_server</code> \u53c2\u6570\uff08\u5982\u679c\u5b58\u5728\uff09\u5c06\u4f7f\u5f97\u670d\u52a1\u5668\u6210\u4e3a\u6307\u5b9a <code>address:port</code> \u5bf9\u7684\u9ed8\u8ba4\u670d\u52a1\u5668\u3002\u5982\u679c\u6ca1\u6709\u6307\u4ee4\u6709 <code>default_server</code> \u53c2\u6570\uff0c\u90a3\u4e48\u5177\u6709 <code>address:port</code> \u5bf9\u7684\u7b2c\u4e00\u4e2a\u670d\u52a1\u5668\u5c06\u662f\u8be5\u5bf9\u7684\u9ed8\u8ba4\u670d\u52a1\u5668\u3002</p> <p>\u5728 0.8.21 \u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u6b64\u53c2\u6570\u7b80\u5355\u5730\u547d\u540d\u4e3a <code>default</code>\u3002</p> <p><code>ssl</code> \u53c2\u6570\uff080.7.14\uff09\u5141\u8bb8\u6307\u5b9a\u8be5\u7aef\u53e3\u4e0a\u63a5\u53d7\u7684\u6240\u6709\u8fde\u63a5\u90fd\u5e94\u8be5\u5de5\u4f5c\u5728 SSL \u6a21\u5f0f\u3002\u8fd9\u6837\u53ef\u4ee5\u4e3a\u5904\u7406 HTTP \u548c HTTPS \u8bf7\u6c42\u7684\u670d\u52a1\u5668\u63d0\u4f9b\u66f4\u7d27\u51d1\u7684\u914d\u7f6e\u3002</p> <p><code>http2</code> \u53c2\u6570\uff081.9.5\uff09\u914d\u7f6e\u7aef\u53e3\u63a5\u53d7 HTTP/2 \u8fde\u63a5\u3002\u901a\u5e38\uff0c\u4e3a\u4e86\u80fd\u591f\u5de5\u4f5c\uff0c\u8fd8\u5e94\u8be5\u6307\u5b9a <code>ssl</code> \u53c2\u6570\uff0c\u4f46\u4e5f\u53ef\u4ee5\u5c06 nginx \u914d\u7f6e\u4e3a\u63a5\u53d7\u6ca1\u6709 SSL \u7684 HTTP/2 \u8fde\u63a5\u3002</p> <p><code>spdy</code> \u53c2\u6570\uff081.3.15 \u2014 1.9.4\uff09\u5141\u8bb8\u5728\u6b64\u7aef\u53e3\u4e0a\u63a5\u53d7 SPDY \u8fde\u63a5\u3002\u901a\u5e38\uff0c\u4e3a\u4e86\u80fd\u591f\u5de5\u4f5c\uff0c\u8fd8\u5e94\u8be5\u6307\u5b9a <code>ssl</code> \u53c2\u6570\uff0c\u4f46\u4e5f\u53ef\u4ee5\u5c06 nginx \u914d\u7f6e\u4e3a\u63a5\u53d7\u6ca1\u6709 SSL \u7684 SPDY \u8fde\u63a5\u3002</p> <p><code>proxy_protocol</code> \u53c2\u6570\uff081.5.12\uff09\u5141\u8bb8\u6307\u5b9a\u6b64\u7aef\u53e3\u4e0a\u63a5\u53d7\u7684\u6240\u6709\u8fde\u63a5\u90fd\u5e94\u4f7f\u7528 PROXY \u534f\u8bae\u3002</p> <p><code>listen</code> \u6307\u4ee4\u53ef\u4ee5\u6709\u7279\u5b9a\u4e8e\u5957\u63a5\u5b57\u76f8\u5173\u7cfb\u7edf\u8c03\u7528\u7684\u51e0\u4e2a\u9644\u52a0\u53c2\u6570\u3002\u8fd9\u4e9b\u53c2\u6570\u53ef\u4ee5\u5728\u4efb\u4f55 <code>listen</code> \u6307\u4ee4\u4e2d\u6307\u5b9a\uff0c\u4f46\u5bf9\u4e8e\u7ed9\u5b9a\u7684 <code>address:port</code> \u53ea\u80fd\u4f7f\u7528\u4e00\u6b21\u3002</p> <p>\u5728 0.8.21 \u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u5b83\u4eec\u53ea\u80fd\u5728 <code>listen</code> \u6307\u4ee4\u4e2d\u4e0e\u9ed8\u8ba4\u53c2\u6570\u4e00\u8d77\u6307\u5b9a\u3002</p> <ul> <li> <p><code>setfib=number</code></p> <p>\u6b64\u53c2\u6570\uff080.8.44\uff09\u8bbe\u7f6e\u76f8\u5173\u8054\u7684\u8def\u7531\u8868\uff0c\u76d1\u542c\u5957\u63a5\u5b57\u7684 FIB\uff08<code>SO_SETFIB</code> \u9009\u9879\uff09\u3002\u76ee\u524d\u53ea\u9002\u7528\u4e8e FreeBSD\u3002 - <code>fastopen=number</code></p> <p>\u4e3a\u4fa6\u542c\u5957\u63a5\u5b57\u542f\u7528 TCP Fast Open \uff081.5.8\uff09\uff0c\u5e76\u9650\u5236\u5c1a\u672a\u5b8c\u6210\u4e09\u6b21\u63e1\u624b\u7684\u8fde\u63a5\u961f\u5217\u7684\u6700\u5927\u957f\u5ea6\u3002</p> <p>\u4e0d\u8981\u542f\u7528\u6b64\u529f\u80fd\uff0c\u9664\u975e\u670d\u52a1\u5668\u53ef\u4ee5\u4e00\u6b21\u5904\u7406\u63a5\u6536\u591a\u4e2a\u76f8\u540c\u7684 SYN \u5305\u7684\u6570\u636e\u3002 - <code>backlog=number</code></p> <p>\u5728 <code>listen()</code> \u8c03\u7528\u4e2d\u8bbe\u7f6e\u9650\u5236\u6302\u8d77\u8fde\u63a5\u961f\u5217\u7684\u6700\u5927\u957f\u5ea6\u7684<code>backlog</code> \u53c2\u6570\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cFreeBSD\u3001DragonFly BSD \u548c macOS \u4e0a\u7684 <code>backlog</code> \u8bbe\u7f6e\u4e3a -1\uff0c\u5728\u5176\u4ed6\u5e73\u53f0\u4e0a\u8bbe\u7f6e\u4e3a 511\u3002 - <code>rcvbuf=size</code></p> <p>\u8bbe\u7f6e\u4fa6\u542c\u5957\u63a5\u5b57\u7684\u63a5\u6536\u7f13\u51b2\u533a\u5927\u5c0f\uff08<code>SO_RCVBUF</code> \u9009\u9879\uff09\u3002 - <code>sndbuf=size</code></p> <p>\u8bbe\u7f6e\u4fa6\u542c\u5957\u63a5\u5b57\u7684\u53d1\u9001\u7f13\u51b2\u533a\u5927\u5c0f\uff08<code>SO_SNDBUF</code> \u9009\u9879\uff09\u3002 - <code>accept_filter=filter</code></p> <p>\u4e3a\u4fa6\u542c\u5957\u63a5\u5b57\u8bbe\u7f6e\u63a5\u53d7\u8fc7\u6ee4\u5668\uff08<code>SO_ACCEPTFILTER</code> \u9009\u9879\uff09\u7684\u540d\u79f0\uff0c\u8be5\u5957\u63a5\u5b57\u5c06\u4f20\u5165\u7684\u8fde\u63a5\u5728\u4f20\u9012\u7ed9 <code>accept()</code> \u4e4b\u524d\u8fdb\u884c\u8fc7\u6ee4\u3002\u8fd9\u53ea\u9002\u7528\u4e8e FreeBSD \u548c NetBSD 5.0+\u3002\u53ef\u8bbe\u7f6e\u503cdataready \u6216 httpready\u3002 - <code>deferred</code></p> <p>\u6307\u793a\u5728 Linux \u4e0a\u4f7f\u7528\u5ef6\u8fdf <code>accept()</code>\uff08<code>TCP_DEFER_ACCEPT</code> \u5957\u63a5\u5b57\u9009\u9879\uff09\u3002 - <code>bind</code></p> <p>\u6307\u793a\u4e3a\u7ed9\u5b9a\u7684 <code>address:port</code> \u5bf9\u5355\u72ec\u8fdb\u884c <code>bind()</code> \u8c03\u7528\u3002\u8fd9\u662f\u6709\u7528\u7684\uff0c\u56e0\u4e3a\u5982\u679c\u6709\u591a\u4e2a\u6709\u76f8\u540c\u7aef\u53e3\u4f46\u4e0d\u540c\u5730\u5740\u7684 <code>listen</code> \u6307\u4ee4\uff0c\u5e76\u4e14\u5176\u4e2d\u4e00\u4e2a <code>listen</code> \u6307\u4ee4\u76d1\u542c\u7ed9\u5b9a\u7aef\u53e3\uff08<code>*:port</code>\uff09\u7684\u6240\u6709\u5730\u5740\uff0c\u5219 nginx \u5c06 <code>bind()</code> \u5e94\u7528\u5230<code>*:port</code>\u3002\u5e94\u8be5\u6ce8\u610f\u7684\u662f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c06\u4f1a\u8fdb\u884c <code>getsockname()</code> \u7cfb\u7edf\u8c03\u7528\uff0c\u4ee5\u786e\u5b9a\u63a5\u53d7\u8be5\u8fde\u63a5\u7684\u5730\u5740\u3002\u5982\u679c\u4f7f\u7528 <code>setfib</code>\u3001<code>backlog</code>\u3001<code>rcvbuf</code>\u3001<code>sndbuf</code>\u3001<code>accept_filter</code>\u3001<code>deferred</code>\u3001<code>ipv6only</code> \u6216 <code>so_keepalive</code> \u53c2\u6570\uff0c\u90a3\u4e48\u5bf9\u4e8e\u7ed9\u5b9a\u7684 <code>address:port</code> \u5bf9\u5c06\u59cb\u7ec8\u8fdb\u884c\u5355\u72ec\u7684 <code>bind()</code> \u8c03\u7528\u3002 - <code>ipv6only=ON|OFF</code></p> <p>\u6b64\u53c2\u6570\uff080.7.42\uff09\u786e\u5b9a\uff08\u901a\u8fc7 <code>IPV6_V6ONLY</code> \u5957\u63a5\u5b57\u9009\u9879\uff09\u4e00\u4e2a\u76d1\u542c\u901a\u914d\u7b26\u5730\u5740 <code>[::]</code> \u7684 IPv6 \u5957\u63a5\u5b57\u662f\u5426\u4ec5\u63a5\u53d7 IPv6 \u8fde\u63a5\u6216 IPv6 \u548c IPv4 \u8fde\u63a5\u3002\u6b64\u53c2\u6570\u9ed8\u8ba4\u4e3a\u5f00\u542f\u3002\u5b83\u53ea\u80fd\u5728\u542f\u52a8\u65f6\u8bbe\u7f6e\u4e00\u6b21\u3002</p> <p>\u5728 1.3.4 \u7248\u672c\u4e4b\u524d\uff0c\u5982\u679c\u7701\u7565\u8be5\u53c2\u6570\uff0c\u5219\u64cd\u4f5c\u7cfb\u7edf\u7684\u8bbe\u7f6e\u5c06\u5bf9\u4e8e\u5957\u63a5\u5b57\u4ea7\u751f\u5f71\u54cd\u3002 - <code>reuseport</code></p> <p>\u6b64\u53c2\u6570\uff081.9.1\uff09\u6307\u793a\u4e3a\u6bcf\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u521b\u5efa\u4e00\u4e2a\u5355\u72ec\u7684\u76d1\u542c\u5957\u63a5\u5b57\uff08\u4f7f\u7528 <code>SO_REUSEPORT</code> \u5957\u63a5\u5b57\u9009\u9879\uff09\uff0c\u5141\u8bb8\u5185\u6838\u5728\u5de5\u4f5c\u8fdb\u7a0b\u4e4b\u95f4\u5206\u914d\u4f20\u5165\u7684\u8fde\u63a5\u3002\u76ee\u524d\u53ea\u9002\u7528\u4e8e Linux 3.9+ \u548c DragonFly BSD\u3002</p> <p>\u4e0d\u5f53\u5730\u4f7f\u7528\u6b64\u9009\u9879\u53ef\u80fd\u4f1a\u5e26\u6765\u5b89\u5168\u9690\u60a3\u3002 - <code>SO_KEEPALIVE=ON|OFF|[keepidle]:[keepintvl]:[keepcnt]</code></p> <p>\u6b64\u53c2\u6570\uff081.1.11\uff09\u914d\u7f6e\u76d1\u542c\u5957\u63a5\u5b57\u7684 TCP keepalive \u884c\u4e3a\u3002\u5982\u679c\u7701\u7565\u6b64\u53c2\u6570\uff0c\u5219\u64cd\u4f5c\u7cfb\u7edf\u7684\u8bbe\u7f6e\u5c06\u5bf9\u5957\u63a5\u5b57\u4ea7\u751f\u5f71\u54cd\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a <code>on</code>\uff0c\u5219\u5957\u63a5\u5b57\u5c06\u6253\u5f00 <code>SO_KEEPALIVE</code> \u9009\u9879\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a <code>off</code>\uff0c\u5219 <code>SO_KEEPALIVE</code> \u9009\u9879\u5c06\u88ab\u5173\u95ed\u3002\u4e00\u4e9b\u64cd\u4f5c\u7cfb\u7edf\u652f\u6301\u5728\u6bcf\u4e2a\u5957\u63a5\u5b57\u4e0a\u4f7f\u7528 <code>TCP_KEEPIDLE</code>\u3001<code>TCP_KEEPINTVL</code> \u548c <code>TCP_KEEPCNT</code> \u5957\u63a5\u5b57\u9009\u9879\u6765\u8bbe\u7f6e TCP keepalive \u53c2\u6570\u3002\u5728\u8fd9\u6837\u7684\u7cfb\u7edf\u4e0a\uff08\u76ee\u524d\u4e3a Linux 2.4+\u3001NetBSD 5+ \u548c FreeBSD 9.0-STABLE\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>keepidle</code>\u3001<code>keepintvl</code>\u548c <code>keepcnt</code> \u53c2\u6570\u8fdb\u884c\u914d\u7f6e\u3002\u53ef\u4ee5\u7701\u7565\u4e00\u4e2a\u6216\u4e24\u4e2a\u53c2\u6570\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u76f8\u5e94\u5957\u63a5\u5b57\u9009\u9879\u7684\u7cfb\u7edf\u9ed8\u8ba4\u8bbe\u7f6e\u5c06\u751f\u6548\u3002\u4f8b\u5982\uff0c</p> <pre><code>SO_KEEPALIVE=30m::10\n</code></pre> <p>\u5c06\u7a7a\u95f2\u8d85\u65f6\uff08<code>TCP_KEEPIDLE</code>\uff09\u8bbe\u7f6e\u4e3a 30 \u5206\u949f\uff0c\u5c06\u63a2\u6d4b\u95f4\u9694\uff08<code>TCP_KEEPINTVL</code>\uff09\u8bbe\u7f6e\u4e3a\u7cfb\u7edf\u9ed8\u8ba4\u503c\uff0c\u5e76\u5c06\u63a2\u6d4b\u6570\u91cf\uff08<code>TCP_KEEPCNT</code>\uff09\u8bbe\u7f6e\u4e3a 10 \u4e2a\u63a2\u6d4b\u3002</p> </li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>listen 127.0.0.1 default_server accept_filter=dataready backlog=1024;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_core_module/#location","title":"location","text":"- \u8bf4\u660e \u8bed\u6cd5 location <code>[ = \\| ~ \\| ~* \\| ^~ ] uri { ... }</code>;  location <code>@name { ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 server\u3001location <p>\u6839\u636e\u8bf7\u6c42 URI \u8bbe\u7f6e\u914d\u7f6e\u3002</p> <p>\u5728\u89e3\u7801\u4ee5 <code>\uff05XX</code> \u5f62\u5f0f\u7f16\u7801\u7684\u6587\u672c\uff0c\u89e3\u6790\u5bf9\u76f8\u5bf9\u8def\u5f84\u7ec4\u4ef6 <code>.</code> \u548c<code>..</code> \u7684\u5f15\u7528\u5e76\u4e14\u5c06\u4e24\u4e2a\u6216\u66f4\u591a\u4e2a\u76f8\u90bb\u659c\u7ebf\u538b\u7f29\u6210\u5355\u659c\u7ebf\u4e4b\u540e\uff0c\u5bf9\u89c4\u8303\u5316\u7684 URI \u6267\u884c\u5339\u914d\u3002</p> <p>location \u53ef\u4ee5\u7531\u524d\u7f00\u5b57\u7b26\u4e32\u5b9a\u4e49\uff0c\u4e5f\u53ef\u4ee5\u7531\u6b63\u5219\u8868\u8fbe\u5f0f\u5b9a\u4e49\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u524d\u9762\u4f7f\u7528<code>~*</code>\u4fee\u6b63\u7b26\uff08\u7528\u4e8e\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\u5339\u914d\uff09\u6216 <code>~</code> \u4fee\u6b63\u7b26\uff08\u7528\u4e8e\u533a\u5206\u5927\u5c0f\u5199\u7684\u5339\u914d\uff09\u6307\u5b9a\u3002\u8981\u67e5\u627e\u5339\u914d\u7ed9\u5b9a\u8bf7\u6c42\u7684 location\uff0cnginx \u9996\u5148\u68c0\u67e5\u4f7f\u7528\u524d\u7f00\u5b57\u7b26\u4e32\uff08\u524d\u7f00 location\uff09\u5b9a\u4e49\u7684 location\u3002\u671f\u95f4\uff0c\u524d\u7f00\u6700\u957f\u7684 location \u88ab\u5339\u914d\u9009\u4e2d\u5e76\u8bb0\u4f4f\u3002\u7136\u540e\u6309\u7167\u5b83\u4eec\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u51fa\u73b0\u7684\u987a\u5e8f\u68c0\u67e5\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u641c\u7d22\u5c06\u5728\u7b2c\u4e00\u6b21\u5339\u914d\u65f6\u7ec8\u6b62\uff0c\u5e76\u4f7f\u7528\u76f8\u5e94\u7684\u914d\u7f6e\u3002\u5982\u679c\u627e\u4e0d\u5230\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u5339\u914d\uff0c\u5219\u4f7f\u7528\u5148\u524d\u8bb0\u4f4f\u7684\u524d\u7f00 location \u7684\u914d\u7f6e\u3002</p> <p>location \u5757\u53ef\u4ee5\u5d4c\u5957\uff0c\u9664\u4e86\u4e0b\u9762\u63d0\u5230\u7684\u4e00\u4e9b\u4f8b\u5916\u3002</p> <p>\u5bf9\u4e8e\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5982 macOS \u548c Cygwin\uff0c\u4e0e\u524d\u7f00\u5b57\u7b26\u4e32\u5339\u914d\u5ffd\u7565\u5927\u5c0f\u5199\uff080.7.7\uff09\u3002\u4f46\u662f\uff0c\u6bd4\u8f83\u4ec5\u9650\u4e8e\u4e00\u4e2a\u5b57\u8282\u7684\u533a\u57df\u8bbe\u7f6e\u3002</p> <p>\u6b63\u5219\u8868\u8fbe\u5f0f\u53ef\u4ee5\u5305\u542b\u6355\u83b7\uff080.7.40\uff09\uff0c\u4e4b\u540e\u53ef\u4ee5\u5728\u5176\u4ed6\u6307\u4ee4\u4e2d\u4f7f\u7528\u3002</p> <p>\u5982\u679c\u6700\u957f\u5339\u914d\u7684\u524d\u7f00 location \u5177\u6709 <code>^~</code> \u4fee\u6b63\u7b26\uff0c\u5219\u4e0d\u68c0\u67e5\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</p> <p>\u53e6\u5916\uff0c\u4f7f\u7528 <code>=</code> \u4fee\u6b63\u7b26\u53ef\u4ee5\u4f7f URI \u548c location \u7684\u5339\u914d\u7cbe\u786e\u3002\u5982\u679c\u627e\u5230\u5b8c\u5168\u5339\u914d\uff0c\u5219\u641c\u7d22\u7ed3\u675f\u3002\u4f8b\u5982\uff0c\u5982\u679c <code>/</code> \u8bf7\u6c42\u9891\u7e41\uff0c\u90a3\u4e48\u5b9a\u4e49 <code>location=/</code> \u4f1a\u52a0\u5feb\u8fd9\u4e9b\u8bf7\u6c42\u7684\u5904\u7406\u901f\u5ea6\uff0c\u56e0\u4e3a\u641c\u7d22\u5728\u7b2c\u4e00\u6b21\u6bd4\u8f83\u4e4b\u540e\u4f1a\u7acb\u5373\u7ec8\u6b62\u3002\u8fd9\u6837\u7684 location \u4e0d\u80fd\u5305\u542b\u5d4c\u5957 location\u3002</p> <p>\u4ece 0.7.1 \u5230 0.8.41 \u7248\u672c\uff0c\u5982\u679c\u8bf7\u6c42\u4e0e\u6ca1\u6709 <code>=</code> \u548c <code>^~</code> \u4fee\u6b63\u7b26\u7684\u524d\u7f00 location \u5339\u914d\uff0c\u5219\u641c\u7d22\u4e5f\u4f1a\u7ec8\u6b62\uff0c\u5e76\u4e14\u4e0d\u518d\u68c0\u67e5\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</p> <p>\u4e0b\u9762\u4e3e\u4e00\u4e2a\u4f8b\u5b50\u6765\u8bf4\u660e\uff1a</p> <pre><code>location = / {\n[ configuration A ]\n}\n\nlocation / {\n[ configuration B ]\n}\n\nlocation /documents/ {\n[ configuration C ]\n}\n\nlocation ^~ /images/ {\n[ configuration D ]\n}\n\nlocation ~* \\.(gif|jpg|jpeg)$ {\n[ configuration E ]\n}\n</code></pre> <p><code>/</code> \u8bf7\u6c42\u5c06\u4e0e\u914d\u7f6e A \u5339\u914d\uff0c<code>/index.html</code> \u8bf7\u6c42\u5c06\u5339\u914d\u914d\u7f6e B\uff0c<code>/documents/document.html</code> \u8bf7\u6c42\u5c06\u5339\u914d\u914d\u7f6e C\uff0c<code>/images/1.gif</code> \u8bf7\u6c42\u5c06\u5339\u914d\u914d\u7f6e D\uff0c<code>/documents/1.jpg</code> \u8bf7\u6c42\u5c06\u5339\u914d\u914d\u7f6e E\u3002</p> <p><code>@</code> \u524d\u7f00\u5b9a\u4e49\u4e86\u4e00\u4e2a\u547d\u540d location\u3002\u8fd9\u6837\u7684 location \u4e0d\u7528\u4e8e\u5e38\u89c4\u7684\u8bf7\u6c42\u5904\u7406\uff0c\u800c\u662f\u7528\u4e8e\u8bf7\u6c42\u91cd\u5b9a\u5411\u3002\u5b83\u4eec\u4e0d\u80fd\u5d4c\u5957\uff0c\u4e5f\u4e0d\u80fd\u5305\u542b\u5d4c\u5957\u7684 location\u3002</p> <p>\u5982\u679c\u67d0\u4e2a location \u7531\u4ee5\u659c\u6760\u5b57\u7b26\u7ed3\u5c3e\u7684\u524d\u7f00\u5b57\u7b26\u4e32\u5b9a\u4e49\uff0c\u5e76\u4e14\u8bf7\u6c42\u7531 proxy_pass\u3001fastcgi_pass\u3001uwsgi_pass\u3001scgi_pass \u6216 memcached_pa\u200b\u200bss \u4e2d\u7684\u4e00\u4e2a\u8fdb\u884c\u5904\u7406\uff0c\u5219\u4f1a\u6267\u884c\u7279\u6b8a\u5904\u7406\u3002\u4e3a\u4e86\u54cd\u5e94 URI \u4e3a\u8be5\u5b57\u7b26\u4e32\u7684\u8bf7\u6c42\uff0c\u4f46\u6ca1\u6709\u4ee5\u659c\u6760\u7ed3\u5c3e\uff0c\u5e26\u6709 301 \u4ee3\u7801\u7684\u6c38\u4e45\u91cd\u5b9a\u5411\u5c06\u8fd4\u56de\u6240\u8bf7\u6c42\u7684 URI\uff0c\u5e76\u9644\u4e0a\u659c\u7ebf\u3002\u5982\u679c\u4e0d\u9700\u8981\uff0c\u53ef\u4ee5\u50cf\u4ee5\u4e0b\u8fd9\u6837\u5b9a\u4e49 URI \u548c location \u7684\u7cbe\u786e\u5339\u914d\uff1a</p> <pre><code>location /user/ {\nproxy_pass http://user.example.com;\n}\n\nlocation = /user {\nproxy_pass http://login.example.com;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_core_module/#log_not_found","title":"log_not_found","text":"- \u8bf4\u660e \u8bed\u6cd5 log_not_found <code>on \\| off</code>; \u9ed8\u8ba4 log_not_found on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u6216\u7981\u7528\u5c06\u6587\u4ef6\u672a\u627e\u5230\u9519\u8bef\u8bb0\u5f55\u5230 error_log \u4e2d\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#log_subrequest","title":"log_subrequest","text":"- \u8bf4\u660e \u8bed\u6cd5 log_subrequest <code>on \\| off</code>; \u9ed8\u8ba4 log_subrequest off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u6216\u7981\u7528\u5c06\u5b50\u8bf7\u6c42\u8bb0\u5f55\u5230 access_log \u4e2d\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#max_ranges","title":"max_ranges","text":"- \u8bf4\u660e \u8bed\u6cd5 merge_slashes <code>number</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.2 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236 byte-range \u8bf7\u6c42\u4e2d\u5141\u8bb8\u7684\u6700\u5927\u8303\u56f4\u6570\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u5b57\u8282\u8303\u56f4\uff0c\u5219\u5904\u7406\u8d85\u51fa\u9650\u5236\u7684\u8bf7\u6c42\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8303\u56f4\u7684\u6570\u91cf\u4e0d\u53d7\u9650\u5236\u3002\u96f6\u503c\u5c06\u5b8c\u5168\u7981\u7528 byte-range \u652f\u6301\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#merge_slashes","title":"merge_slashes","text":"- \u8bf4\u660e \u8bed\u6cd5 merge_slashes <code>on \\| off</code>; \u9ed8\u8ba4 merge_slashes on; \u4e0a\u4e0b\u6587 http\u3001server <p>\u542f\u7528\u6216\u7981\u7528\u5c06 URI \u4e2d\u4e24\u4e2a\u6216\u591a\u4e2a\u76f8\u90bb\u659c\u7ebf\u538b\u7f29\u4e3a\u5355\u659c\u7ebf\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u538b\u7f29\u5bf9\u4e8e\u6b63\u786e\u5339\u914d\u524d\u7f00\u5b57\u7b26\u4e32\u548c\u6b63\u5219\u8868\u8fbe\u5f0f\u7684 location \u975e\u5e38\u91cd\u8981\u3002\u6ca1\u6709\u5b83\uff0c\u5c06\u4e0d\u5339\u914d <code>//scripts/one.php</code> \u8bf7\u6c42\uff1a</p> <pre><code>location /scripts/ {\n...\n}\n</code></pre> <p>\u5e76\u53ef\u80fd\u88ab\u4f5c\u4e3a\u4e00\u4e2a\u9759\u6001\u6587\u4ef6\u5904\u7406\u3002\u56e0\u6b64\u5b83\u9700\u8981\u88ab\u8f6c\u6362\u6210 <code>/scripts/one.php</code>\u3002</p> <p>\u56e0\u4e3a base64 \u5728\u5185\u90e8\u4f7f\u7528 <code>/</code> \u5b57\u7b26\uff0c\u6240\u4ee5\u5982\u679c URI \u5305\u542b base64 \u7f16\u7801\u7684\u540d\u79f0\uff0c\u5219\u53ef\u80fd\u9700\u8981\u5173\u95ed\u538b\u7f29\u3002\u4f46\u662f\uff0c\u51fa\u4e8e\u5b89\u5168\u8003\u8651\uff0c\u6700\u597d\u4e0d\u8981\u5173\u95ed\u538b\u7f29\u3002</p> <p>\u5982\u679c\u8be5\u6307\u4ee4\u662f\u5728 server \u7ea7\u522b\u6307\u5b9a\u7684\uff0c\u5219\u4ec5\u5728 server \u662f\u9ed8\u8ba4 server \u65f6\u624d\u4f7f\u7528\u8be5\u6307\u4ee4\u3002\u6307\u5b9a\u7684\u503c\u4e5f\u9002\u7528\u4e8e\u76d1\u542c\u76f8\u540c\u5730\u5740\u548c\u7aef\u53e3\u7684\u6240\u6709\u865a\u62df\u670d\u52a1\u5668\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#msie_padding","title":"msie_padding","text":"- \u8bf4\u660e \u8bed\u6cd5 msie_padding <code>on \\| off</code>; \u9ed8\u8ba4 msie_padding on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u6216\u7981\u7528\u5411\u72b6\u6001\u8d85\u8fc7 400 \u7684 MSIE \u5ba2\u6237\u7aef\u54cd\u5e94\u6dfb\u52a0\u6ce8\u91ca\u4ee5\u5c06\u54cd\u5e94\u5927\u5c0f\u589e\u52a0\u5230 512 \u5b57\u8282\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#msie_refresh","title":"msie_refresh","text":"- \u8bf4\u660e \u8bed\u6cd5 msie_refresh <code>on \\| off</code>; \u9ed8\u8ba4 msie_refresh off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u6216\u7981\u7528\u53d1\u5e03\u5237\u65b0\u66ff\u4ee3 MSIE \u5ba2\u6237\u7aef\u91cd\u5b9a\u5411\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#open_file_cache","title":"open_file_cache","text":"- \u8bf4\u660e \u8bed\u6cd5 open_file_cache <code>off</code>;  open_file_cache <code>max=N [inactive=time]</code>; \u9ed8\u8ba4 open_file_cache off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u914d\u7f6e\u4e00\u4e2a\u7f13\u5b58\uff0c\u53ef\u4ee5\u5b58\u50a8\uff1a</p> <ul> <li>\u6253\u5f00\u6587\u4ef6\u63cf\u8ff0\u7b26\u3001\u5927\u5c0f\u548c\u4fee\u6539\u65f6\u95f4</li> <li>\u6709\u5173\u76ee\u5f55\u662f\u5426\u5b58\u5728\u4fe1\u606f</li> <li>\u6587\u4ef6\u67e5\u627e\u9519\u8bef\uff0c\u5982**\u627e\u4e0d\u5230\u6587\u4ef6**\u3001**\u6ca1\u6709\u8bfb\u53d6\u6743\u9650**\u7b49</li> </ul> <p>\u5e94\u8be5\u901a\u8fc7 open_file_cache_errors \u6307\u4ee4\u5206\u522b\u542f\u7528\u7f13\u5b58\u9519\u8bef\u3002</p> <p>\u8be5\u6307\u4ee4\u6709\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <ul> <li> <p><code>max</code></p> <p>\u8bbe\u7f6e\u7f13\u5b58\u4e2d\u5143\u7d20\u7684\u6700\u5927\u6570\u91cf\u3002\u5728\u7f13\u5b58\u6ea2\u51fa\u65f6\uff0c\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\uff08LRU\uff09\u5143\u7d20\u5c06\u88ab\u79fb\u9664 - <code>inactive</code></p> <p>\u5b9a\u4e49\u4e00\u4e2a\u65f6\u95f4\uff0c\u5728\u8fd9\u4e2a\u65f6\u95f4\u4e4b\u540e\uff0c\u5143\u7d20\u5728\u7f13\u5b58\u4e2d\u5c06\u88ab\u5220\u9664\uff0c\u9ed8\u8ba4\u662f 60 \u79d2 - <code>off</code></p> <p>\u7981\u7528\u7f13\u5b58</p> </li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>open_file_cache          max=1000 inactive=20s;\nopen_file_cache_valid    30s;\nopen_file_cache_min_uses 2;\nopen_file_cache_errors   on;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_core_module/#open_file_cache_errors","title":"open_file_cache_errors","text":"- \u8bf4\u660e \u8bed\u6cd5 open_file_cache_errors <code>off</code> | <code>on</code>; \u9ed8\u8ba4 open_file_cache_errors off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u901a\u8fc7 open_file_cache \u542f\u7528\u6216\u7981\u7528\u6587\u4ef6\u67e5\u627e\u9519\u8bef\u7f13\u5b58\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#open_file_cache_min_uses","title":"open_file_cache_min_uses","text":"- \u8bf4\u660e \u8bed\u6cd5 open_file_cache_min_uses <code>number</code>; \u9ed8\u8ba4 open_file_cache_min_uses 1; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7531 open_file_cache \u6307\u4ee4\u7684 <code>inactive</code> \u53c2\u6570\u914d\u7f6e\u7684\u65f6\u95f4\u6bb5\u5185\u6587\u4ef6\u8bbf\u95ee\u7684\u6700\u5c0f <code>number</code> \uff08\u6b21\u6570\uff09\uff0c\u8fd9\u662f\u6587\u4ef6\u63cf\u8ff0\u7b26\u5728\u7f13\u5b58\u4e2d\u4fdd\u6301\u6253\u5f00\u72b6\u6001\u6240\u5fc5\u9700\u7684\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#open_file_cache_valid","title":"open_file_cache_valid","text":"- \u8bf4\u660e \u8bed\u6cd5 open_file_cache_valid <code>time</code>; \u9ed8\u8ba4 open_file_cache_valid 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e open_file_cache \u5143\u7d20\u5e94\u8be5\u9a8c\u8bc1\u7684\u65f6\u95f4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#output_buffers","title":"output_buffers","text":"- \u8bf4\u660e \u8bed\u6cd5 output_buffers <code>number size</code>; \u9ed8\u8ba4 output_buffers 2 32k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u4ece\u78c1\u76d8\u8bfb\u53d6\u54cd\u5e94\u7f13\u51b2\u533a\u7684 <code>number</code> \uff08\u6570\u91cf\uff09\u548c <code>size</code> \uff08\u5927\u5c0f\uff09\u3002</p> <p>\u5728 1.9.5 \u7248\u672c\u4e4b\u524d\uff0c\u9ed8\u8ba4\u503c\u662f <code>1 32k</code>\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#port_in_redirect","title":"port_in_redirect","text":"- \u8bf4\u660e \u8bed\u6cd5 port_in_redirect <code>on</code> | <code>off</code>; \u9ed8\u8ba4 port_in_redirect on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u6216\u7981\u7528\u6307\u5b9a\u7531 nginx \u53d1\u51fa\u7684\u7edd\u5bf9\u91cd\u5b9a\u5411\u4e2d\u7684\u7aef\u53e3\u3002</p> <p>\u5728\u91cd\u5b9a\u5411\u4e2d\u4f7f\u7528\u7684\u4e3b\u670d\u52a1\u5668\u540d\u79f0\u7531 server_name_in_redirect \u6307\u4ee4\u63a7\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#postpone_output","title":"postpone_output","text":"- \u8bf4\u660e \u8bed\u6cd5 postpone_output <code>size</code>; \u9ed8\u8ba4 postpone_output 1460; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5982\u679c\u6307\u5b9a\u7684\u8bdd\uff0c\u5ba2\u6237\u7aef\u6570\u636e\u7684\u4f20\u8f93\u5c06\u88ab\u63a8\u8fdf\uff0c\u76f4\u5230 nginx \u81f3\u5c11\u6709 <code>size</code> \u5b57\u8282\u7684\u6570\u636e\u8981\u53d1\u9001\u3002\u96f6\u503c\u5c06\u7981\u6b62\u5ef6\u8fdf\u6570\u636e\u4f20\u8f93\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#read_ahead","title":"read_ahead","text":"- \u8bf4\u660e \u8bed\u6cd5 read_ahead <code>sizef</code>; \u9ed8\u8ba4 read_ahead 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u4f7f\u7528\u6587\u4ef6\u65f6\u5185\u6838\u7684\u9884\u8bfb\u6570\u91cf\u3002</p> <p>\u5728 Linux \u4e0a\uff0c\u4f7f\u7528 <code>posix_fadvise</code>\uff08<code>0, 0, 0, POSIX_FADV_SEQUENTIAL</code>\uff09\u7cfb\u7edf\u8c03\u7528\uff0c\u56e0\u6b64 <code>size</code> \u53c2\u6570\u5c06\u88ab\u5ffd\u7565\u3002</p> <p>\u5728 FreeBSD \u4e0a\uff0c\u4f7f\u7528\u81ea FreeBSD 9.0-CURRENT \u540e\u652f\u6301\u7684 <code>fcntl</code>\uff08<code>O_READAHEAD, size</code>\uff09\u7cfb\u7edf\u8c03\u7528\u3002FreeBSD 7 \u9700\u8981\u6253\u8865\u4e01\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#recursive_error_pages","title":"recursive_error_pages","text":"- \u8bf4\u660e \u8bed\u6cd5 recursive_error_pages <code>on</code> | <code>off</code>; \u9ed8\u8ba4 reset_timedout_connection off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u6216\u7981\u7528\u4f7f\u7528 error_page \u6307\u4ee4\u6267\u884c\u591a\u4e2a\u91cd\u5b9a\u5411\u3002\u8fd9\u79cd\u91cd\u5b9a\u5411\u7684\u6570\u91cf\u662f\u6709\u9650\u7684\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#request_pool_size","title":"request_pool_size","text":"- \u8bf4\u660e \u8bed\u6cd5 request_pool_size <code>size</code>; \u9ed8\u8ba4 request_pool_size 4k; \u4e0a\u4e0b\u6587 http\u3001server <p>\u5141\u8bb8\u7cbe\u786e\u8c03\u6574\u6bcf\u4e2a\u8bf7\u6c42\u7684\u5185\u5b58\u5206\u914d\u3002\u8be5\u6307\u4ee4\u5bf9\u6027\u80fd\u5f71\u54cd\u6700\u5c0f\uff0c\u4e00\u822c\u4e0d\u5e94\u8be5\u4f7f\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#reset_timedout_connection","title":"reset_timedout_connection","text":"- \u8bf4\u660e \u8bed\u6cd5 reset_timedout_connection <code>on</code> | <code>off</code>; \u9ed8\u8ba4 reset_timedout_connection off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u6216\u7981\u7528\u91cd\u7f6e\u8d85\u65f6\u8fde\u63a5\u3002\u91cd\u7f6e\u8fc7\u7a0b\u5982\u4e0b\u3002\u5728\u5173\u95ed\u4e00\u4e2a\u5957\u63a5\u5b57\u4e4b\u524d\uff0c<code>SO_LINGER</code> \u9009\u9879\u8d85\u65f6\u503c\u88ab\u8bbe\u7f6e\u4e3a 0\u3002\u5f53\u5957\u63a5\u5b57\u5173\u95ed\u65f6\uff0cTCP RST \u88ab\u53d1\u9001\u5230\u5ba2\u6237\u7aef\uff0c\u5e76\u4e14\u91ca\u653e\u8be5\u5957\u63a5\u5b57\u5360\u7528\u7684\u6240\u6709\u5185\u5b58\u3002\u8fd9\u6709\u52a9\u4e8e\u907f\u514d\u957f\u65f6\u95f4\u6301\u6709\u4e00\u4e2a\u7f13\u51b2\u533a\u5df2\u7ecf\u88ab\u586b\u5145 FIN_WAIT1 \u72b6\u6001\u7684\u5df2\u5173\u95ed\u5957\u63a5\u5b57\u3002</p> <p>\u5e94\u8be5\u6ce8\u610f\uff0c\u8d85\u65f6\u7684 keep-alive \u8fde\u63a5\u88ab\u6b63\u5e38\u5173\u95ed\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#resolver","title":"resolver","text":"- \u8bf4\u660e \u8bed\u6cd5 resolver <code>address ... [valid=time] [ipv6=on|off]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5c06\u7528\u4e8e\u89e3\u6790 upstream \u670d\u52a1\u5668\u540d\u79f0\u7684\u540d\u79f0\u670d\u52a1\u5668\u914d\u7f6e\u8fdb\u6307\u5b9a\u7684\u5730\u5740\uff0c\u4f8b\u5982\uff1a</p> <pre><code>resolver 127.0.0.1 [:: 1]:5353;\n</code></pre> <p>\u5730\u5740\u53ef\u4ee5\u6307\u5b9a\u4e3a\u57df\u540d\u6216 IP \u5730\u5740\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u53ef\u9009\u7684\u7aef\u53e3\uff081.3.1\uff0c1.2.2\uff09\u3002\u5982\u679c\u6ca1\u6709\u6307\u5b9a\u7aef\u53e3\uff0c\u5219\u4f7f\u7528\u7aef\u53e3 53\u3002\u540d\u79f0\u670d\u52a1\u5668\u4ee5\u8f6e\u8be2\u65b9\u5f0f\u67e5\u8be2\u3002</p> <p>\u5728 1.1.7 \u7248\u672c\u4e4b\u524d\uff0c\u53ea\u80fd\u914d\u7f6e\u4e00\u4e2a\u540d\u79f0\u670d\u52a1\u5668\u3002\u4ece 1.3.1 \u548c 1.2.2 \u7248\u672c\u5f00\u59cb\uff0c\u652f\u6301\u4f7f\u7528 IPv6 \u5730\u5740\u6765\u6307\u5b9a\u540d\u79f0\u670d\u52a1\u5668\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnginx \u5c06\u5728\u89e3\u6790\u65f6\u67e5\u627e IPv4 \u548c IPv6 \u5730\u5740\u3002\u5982\u679c\u4e0d\u60f3\u67e5\u627e IPv6 \u5730\u5740\uff0c\u5219\u53ef\u4ee5\u6307\u5b9a <code>ipv6=off</code> \u53c2\u6570\u3002</p> <p>\u4ece 1.5.8 \u7248\u672c\u5f00\u59cb\uff0c\u652f\u6301\u5c06\u540d\u79f0\u89e3\u6790\u4e3a IPv6 \u5730\u5740\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnginx \u4f7f\u7528\u54cd\u5e94\u7684 TTL \u503c\u7f13\u5b58\u56de\u590d\u3002\u53ef\u9009\u7684 <code>valid</code> \u53c2\u6570\u53ef\u4ee5\u8986\u76d6\u5b83\uff1a</p> <pre><code>resolver 127.0.0.1 [:: 1]:5353 valid=30s;\n</code></pre> <p>\u5728 1.1.9 \u7248\u672c\u4e4b\u524d\uff0c\u7f13\u5b58\u65f6\u95f4\u662f\u4e0d\u80fd\u8c03\u6574\u7684\uff0cnginx \u603b\u662f\u7f13\u5b58 5 \u5206\u949f\u7684\u56de\u590d\u3002</p> <p>\u4e3a\u4e86\u9632\u6b62 DNS \u6b3a\u9a97\uff0c\u5efa\u8bae\u5728\u5b89\u5168\u7684\u53ef\u4fe1\u4efb\u672c\u5730\u7f51\u7edc\u4e2d\u914d\u7f6e DNS \u670d\u52a1\u5668\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#satisfy","title":"satisfy","text":"- \u8bf4\u660e \u8bed\u6cd5 satisfy <code>all</code> | <code>any</code>; \u9ed8\u8ba4 satisfy all; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5982\u679c\u6240\u6709\uff08\u5168\u90e8\uff09\u6216\u81f3\u5c11\u4e00\u4e2a\uff08\u4efb\u610f\u4e00\u4e2a\uff09 ngx_http_access_module\u3001ngx_http_auth_basic_module\u3001ngx_http_auth_request_module \u6216 ngx_http_auth_jwt_module \u6a21\u5757\u5141\u8bb8\u8bbf\u95ee\uff0c\u5219\u5141\u8bb8\u8bbf\u95ee\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>location / {\nsatisfy any;\n\nallow 192.168.1.0/32;\ndeny  all;\n\nauth_basic           \"closed site\";\nauth_basic_user_file conf/htpasswd;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_core_module/#send_lowat","title":"send_lowat","text":"- \u8bf4\u660e \u8bed\u6cd5 send_lowat <code>size</code>; \u9ed8\u8ba4 send_lowat 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5982\u679c\u6307\u4ee4\u8bbe\u7f6e\u4e3a\u975e\u96f6\u503c\uff0cnginx \u5c06\u5c1d\u8bd5\u901a\u8fc7\u4f7f\u7528 kqueue \u65b9\u6cd5\u7684 <code>NOTE_LOWAT</code> \u6807\u5fd7\u6216<code>SO_SNDLOWAT</code> \u5957\u63a5\u5b57\u9009\u9879\u6765\u6700\u5c0f\u5316\u5ba2\u6237\u7aef\u5957\u63a5\u5b57\u4e0a\u7684\u53d1\u9001\u64cd\u4f5c\u6570\u3002\u5728\u8fd9\u4e24\u79cd\u60c5\u51b5\u4e0b\u90fd\u4f7f\u7528\u5230\u4e86\u6307\u5b9a\u7684 <code>size</code>\u3002</p> <p>\u8be5\u6307\u4ee4\u5728 Linux\u3001Solaris \u548c Windows \u4e0a\u88ab\u5ffd\u7565\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#send_timeout","title":"send_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 send_timeout <code>time</code>; \u9ed8\u8ba4 send_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u54cd\u5e94\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u8d85\u65f6\u8bbe\u7f6e\u53ea\u9650\u5b9a\u5728\u4e24\u6b21\u8fde\u7eed\u7684\u5199\u5165\u64cd\u4f5c\u4e4b\u95f4\uff0c\u800c\u4e0d\u662f\u7528\u4e8e\u6574\u4e2a\u54cd\u5e94\u7684\u4f20\u8f93\u3002\u5982\u679c\u5ba2\u6237\u7aef\u5728\u6b64\u65f6\u95f4\u5185\u6ca1\u6709\u6536\u5230\u4efb\u4f55\u5185\u5bb9\uff0c\u5219\u8fde\u63a5\u5c06\u88ab\u5173\u95ed\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#sendfile","title":"sendfile","text":"- \u8bf4\u660e \u8bed\u6cd5 sendfile <code>on</code> | <code>off</code>; \u9ed8\u8ba4 sendfile off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001location \u4e2d\u7684 if <p>\u542f\u7528\u6216\u7981\u7528 <code>sendfile()</code>\u3002</p> <p>\u4ece nginx 0.8.12 \u548c FreeBSD 5.2.1 \u5f00\u59cb\uff0c\u53ef\u4ee5\u7528 aio \u6765\u4e3a <code>sendfile()</code> \u9884\u52a0\u8f7d\u6570\u636e\uff1a</p> <pre><code>location /video/ {\nsendfile       on;\ntcp_nopush     on;\naio            on;\n}\n</code></pre> <p>\u5728\u6b64\u914d\u7f6e\u4e2d\uff0c\u4f7f\u7528 <code>SF_NODISKIO</code> \u6807\u5fd7\u8c03\u7528 <code>sendfile()</code>\uff0c\u4f7f\u5176\u4e0d\u4f1a\u963b\u585e\u78c1\u76d8 I/O\uff0c\u800c\u662f\u4ee5\u62a5\u544a\u6570\u636e\u4e0d\u5728\u5185\u5b58\u4e2d\u7684\u65b9\u5f0f\u4ee3\u66ff\u3002\u7136\u540e nginx \u901a\u8fc7\u8bfb\u53d6\u4e00\u4e2a\u5b57\u8282\u6765\u542f\u52a8\u5f02\u6b65\u6570\u636e\u52a0\u8f7d\u3002\u5728\u7b2c\u4e00\u6b21\u8bfb\u53d6\u65f6\uff0cFreeBSD \u5185\u6838\u4f1a\u5c06\u6587\u4ef6\u7684\u7b2c\u4e00\u4e2a 128K \u5b57\u8282\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u4f46\u662f\u4e0b\u4e00\u6b21\u8bfb\u53d6\u53ea\u80fd\u4ee5 16K \u5757\u52a0\u8f7d\u6570\u636e\u3002\u53ef\u4ee5\u4f7f\u7528 read_ahead \u6307\u4ee4\u8fdb\u884c\u4fee\u6539\u3002</p> <p>\u5728 1.7.11 \u7248\u672c\u4e4b\u524d\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>aio sendfile</code> \u6765\u542f\u7528\u9884\u52a0\u8f7d\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#sendfile_max_chunk","title":"sendfile_max_chunk","text":"- \u8bf4\u660e \u8bed\u6cd5 **sendfile_max_chunk ** <code>size</code>; \u9ed8\u8ba4 sendfile_max_chunk 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u4e3a\u975e\u96f6\u503c\u65f6\uff0c\u53ef\u9650\u5236\u5355\u4e2a <code>sendfile()</code> \u8c03\u7528\u65f6\u4f20\u8f93\u7684\u6570\u636e\u91cf\u3002\u5982\u679c\u6ca1\u6709\u9650\u5236\uff0c\u4e00\u4e2a\u5feb\u901f\u8fde\u63a5\u53ef\u80fd\u4f1a\u5b8c\u5168\u5360\u7528\u5de5\u4f5c\u8fdb\u7a0b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#server","title":"server","text":"- \u8bf4\u660e \u8bed\u6cd5 server <code>{ ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u8bbe\u7f6e\u865a\u62df\u670d\u52a1\u5668\u7684\u914d\u7f6e\u3002\u57fa\u4e8e IP\uff08\u57fa\u4e8e IP \u5730\u5740\uff09\u548c\u57fa\u4e8e\u540d\u79f0\uff08\u57fa\u4e8e <code>Host</code> \u8bf7\u6c42\u5934\u5b57\u6bb5\uff09\u7684\u865a\u62df\u670d\u52a1\u5668\u4e4b\u95f4\u6ca1\u6709\u660e\u786e\u7684\u754c\u9650\u3002\u76f8\u53cd\uff0clisten \u6307\u4ee4\u63cf\u8ff0\u5e94\u63a5\u53d7\u670d\u52a1\u5668\u8fde\u63a5\u7684\u6240\u6709\u5730\u5740\u548c\u7aef\u53e3\uff0cserver_name \u6307\u4ee4\u5217\u51fa\u6240\u6709\u670d\u52a1\u5668\u540d\u79f0\u3002\u5982\u4f55\u5904\u7406\u8bf7\u6c42\u6587\u6863\u4e2d\u63d0\u4f9b\u4e86\u914d\u7f6e\u793a\u4f8b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#server_name","title":"server_name","text":"- \u8bf4\u660e \u8bed\u6cd5 server_name <code>name ...</code>; \u9ed8\u8ba4 server_name \"\"; \u4e0a\u4e0b\u6587 server <p>\u8bbe\u7f6e\u865a\u62df\u670d\u52a1\u5668\u540d\u79f0\uff0c\u4f8b\u5982\uff1a</p> <pre><code>server {\nserver_name example.com www.example.com;\n}\n</code></pre> <p>\u7b2c\u4e00\u4e2a\u540d\u5b57\u5c06\u6210\u4e3a\u4e3b\u670d\u52a1\u5668\u540d\u79f0\u3002</p> <p>\u670d\u52a1\u5668\u540d\u79f0\u53ef\u4ee5\u5305\u542b\u4e00\u4e2a\u661f\u53f7\uff08<code>*</code>\uff09\u4ee5\u4ee3\u66ff\u540d\u79f0\u7684\u7b2c\u4e00\u90e8\u5206\u6216\u6700\u540e\u4e00\u90e8\u5206\uff1a</p> <pre><code>server {\nserver_name example.com *.example.com www.example.*;\n}\n</code></pre> <p>\u8fd9\u6837\u7684\u540d\u79f0\u88ab\u79f0\u4e3a\u901a\u914d\u7b26\u540d\u79f0\u3002</p> <p>\u4e0a\u9762\u63d0\u5230\u7684\u524d\u4e24\u4e2a\u540d\u5b57\u53ef\u4ee5\u5408\u5e76\u6210\u4e00\u4e2a\uff1a</p> <pre><code>server {\nserver_name .example.com;\n}\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u5728\u670d\u52a1\u5668\u540d\u79f0\u4e2d\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5728\u540d\u79f0\u524d\u9762\u52a0\u4e0a\u6ce2\u6d6a\u53f7\uff08<code>\u301c</code>\uff09\uff1a</p> <pre><code>server {\nserver_name www.example.com ~^www\\d+\\.example\\.com$;\n}\n</code></pre> <p>\u6b63\u5219\u8868\u8fbe\u5f0f\u53ef\u4ee5\u5305\u542b\u4e4b\u540e\u7528\u4e8e\u5176\u4ed6\u6307\u4ee4\u7684\u6355\u83b7\uff080.7.40\uff09\uff1a</p> <pre><code>server {\nserver_name ~^(www\\.)?(.+)$;\n\nlocation / {\nroot /sites/$2;\n}\n}\n\nserver {\nserver_name _;\n\nlocation / {\nroot /sites/default;\n}\n}\n</code></pre> <p>\u5728\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u547d\u540d\u6355\u83b7\u521b\u5efa\u53d8\u91cf\uff080.8.25\uff09\uff0c\u4e4b\u540e\u53ef\u5728\u5176\u4ed6\u6307\u4ee4\u4e2d\u4f7f\u7528\uff1a</p> <pre><code>server {\nserver_name ~^(www\\.)?(?&lt;domain&gt;.+)$;\n\nlocation / {\nroot /sites/$domain;\n}\n}\n\nserver {\nserver_name _;\n\nlocation / {\nroot /sites/default;\n}\n}\n</code></pre> <p>\u5982\u679c\u6307\u4ee4\u53c2\u6570\u8bbe\u7f6e\u4e3a <code>$hostname</code>\uff080.9.4\uff09\uff0c\u5219\u5c06\u66ff\u6362\u4e3a\u673a\u5668\u7684\u4e3b\u673a\u540d\u3002</p> <p>\u4e5f\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u7a7a\u7684\u670d\u52a1\u5668\u540d\u79f0\uff080.7.11\uff09\uff1a</p> <pre><code>server {\nserver_name www.example.com \"\";\n}\n</code></pre> <p>\u5b83\u5141\u8bb8\u8fd9\u4e2a\u670d\u52a1\u5668\u5bf9\u7ed9\u5b9a\u7684 address:port \u5bf9\u5904\u7406\u6ca1\u6709 <code>Host</code> \u5934\u7684\u8bf7\u6c42\uff0c\u800c\u4e0d\u662f\u9ed8\u8ba4\u7684\u670d\u52a1\u5668\u3002\u8fd9\u662f\u9ed8\u8ba4\u8bbe\u7f6e\u3002</p> <p>\u5728 0.8.48 \u4e4b\u524d\uff0c\u9ed8\u8ba4\u4f7f\u7528\u673a\u5668\u7684\u4e3b\u673a\u540d\u3002</p> <p>\u5728\u6309\u540d\u79f0\u641c\u7d22\u865a\u62df\u670d\u52a1\u5668\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u540d\u79f0\u4e0e\u591a\u4e2a\u6307\u5b9a\u53d8\u4f53\u76f8\u5339\u914d\uff08\u4f8b\u5982\uff0c\u901a\u914d\u7b26\u540d\u79f0\u548c\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\uff09\uff0c\u5c06\u6309\u7167\u4ee5\u4e0b\u4f18\u5148\u987a\u5e8f\u9009\u62e9\u7b2c\u4e00\u4e2a\u5339\u914d\u53d8\u4f53\uff1a</p> <ol> <li>\u786e\u5207\u7684\u540d\u5b57</li> <li>\u4ee5\u661f\u53f7\u5f00\u5934\u7684\u6700\u957f\u901a\u914d\u7b26\u540d\u79f0\uff0c\u4f8b\u5982 <code>*.example.com</code></li> <li>\u4ee5\u661f\u53f7\u7ed3\u5c3e\u7684\u6700\u957f\u901a\u914d\u7b26\u540d\u79f0\uff0c\u4f8b\u5982 <code>mail.*</code></li> <li>\u7b2c\u4e00\u4e2a\u5339\u914d\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff08\u6309\u7167\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u51fa\u73b0\u987a\u5e8f\uff09</li> </ol> <p>\u670d\u52a1\u5668\u540d\u79f0\u7684\u8be6\u7ec6\u63cf\u8ff0\u5728\u5355\u72ec\u7684\u670d\u52a1\u5668\u540d\u79f0\u6587\u6863\u4e2d\u63d0\u4f9b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#server_name_in_redirect","title":"server_name_in_redirect","text":"- \u8bf4\u660e \u8bed\u6cd5 server_name <code>on</code> | <code>off</code>; \u9ed8\u8ba4 server_name_in_redirect off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u6216\u7981\u7528\u5728\u7531 nginx \u53d1\u51fa\u7684 absolute \u6307\u4ee4\u4e2d\u4f7f\u7528\u7531 server_name \u6307\u4ee4\u6307\u5b9a\u7684\u4e3b\u670d\u52a1\u5668\u540d\u79f0\u3002\u5f53\u7981\u7528\u4e3b\u670d\u52a1\u5668\u540d\u79f0\u65f6\uff0c\u5c06\u4f7f\u7528 <code>Host</code> \u8bf7\u6c42\u5934\u5b57\u6bb5\u4e2d\u7684\u540d\u79f0\u3002\u5982\u679c\u6b64\u5b57\u6bb5\u4e0d\u5b58\u5728\uff0c\u5219\u4f7f\u7528\u670d\u52a1\u5668\u7684 IP \u5730\u5740\u3002</p> <p>\u91cd\u5b9a\u5411\u4e2d\u4f7f\u7528\u7aef\u53e3\u7531 port_in_redirect \u6307\u4ee4\u63a7\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#server_names_hash_bucket_size","title":"server_names_hash_bucket_size","text":"- \u8bf4\u660e \u8bed\u6cd5 server_names_hash_bucket_size <code>size</code>; \u9ed8\u8ba4 server_names_hash_bucket_size 32 \u4e0a\u4e0b\u6587 http <p>\u8bbe\u7f6e\u670d\u52a1\u5668\u540d\u79f0\u54c8\u5e0c\u8868\u7684\u5b58\u50a8\u6876\u5927\u5c0f\u3002\u9ed8\u8ba4\u503c\u53d6\u51b3\u4e8e\u5904\u7406\u5668\u7f13\u5b58\u884c\u7684\u5927\u5c0f\u3002\u8bbe\u7f6e\u54c8\u5e0c\u8868\u7684\u7ec6\u8282\u5728\u5355\u72ec\u7684\u6587\u6863\u4e2d\u63d0\u4f9b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#server_names_hash_max_size","title":"server_names_hash_max_size","text":"- \u8bf4\u660e \u8bed\u6cd5 server_names_hash_max_size <code>size</code>; \u9ed8\u8ba4 server_names_hash_max_size 512; \u4e0a\u4e0b\u6587 http <p>\u8bbe\u7f6e\u670d\u52a1\u5668\u540d\u79f0\u54c8\u5e0c\u8868\u7684\u6700\u5927\u5927\u5c0f\u3002\u8bbe\u7f6e\u54c8\u5e0c\u8868\u7684\u7ec6\u8282\u5728\u5355\u72ec\u7684\u6587\u6863\u4e2d\u63d0\u4f9b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#server_tokens","title":"server_tokens","text":"- \u8bf4\u660e \u8bed\u6cd5 server_tokens <code>on</code> | <code>off</code> | <code>build</code> | <code>string</code>; \u9ed8\u8ba4 server_tokens on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5728\u9519\u8bef\u9875\u9762\u548c <code>Server</code> \u54cd\u5e94\u5934\u5b57\u6bb5\u4e2d\u542f\u7528\u6216\u7981\u7528\u53d1\u9001 nginx \u7248\u672c\u3002</p> <p><code>build</code> \u53c2\u6570\uff081.11.10\uff09\u80fd\u591f\u53d1\u9001\u6784\u5efa\u540d\u79f0\u4ee5\u53ca nginx \u7248\u672c\u3002</p> <p>\u6b64\u5916\uff0c\u4f5c\u4e3a\u6211\u4eec\u7684\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\uff0c\u4ece1.9.13 \u7248\u672c\u5f00\u59cb\uff0c\u53ef\u4ee5\u4f7f\u7528\u5e26\u6709\u53d8\u91cf\u7684\u5b57\u7b26\u4e32\u663e\u5f0f\u8bbe\u7f6e\u9519\u8bef\u9875\u9762\u4e0a\u7684\u7b7e\u540d\u548c <code>Server</code> \u54cd\u5e94\u5934\u5b57\u6bb5\u503c\u3002\u6307\u5b9a\u7a7a\u5b57\u7b26\u4e32\u5c06\u7981\u7528 <code>Server</code> \u5b57\u6bb5\u7684\u53d1\u9001\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#tcp_nodelay","title":"tcp_nodelay","text":"- \u8bf4\u660e \u8bed\u6cd5 tcp_nodelay <code>on</code> | <code>off</code>; \u9ed8\u8ba4 tcp_nodelay on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u6216\u7981\u7528 <code>TCP_NODELAY</code> \u9009\u9879\u7684\u4f7f\u7528\u3002\u8be5\u9009\u9879\u4ec5\u5728\u8fde\u63a5\u8f6c\u6362\u5230 keep-alive \u72b6\u6001\u65f6\u542f\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#tcp_nopush","title":"tcp_nopush","text":"- \u8bf4\u660e \u8bed\u6cd5 tcp_nopush <code>on</code> | <code>off</code>; \u9ed8\u8ba4 tcp_nopush off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u6216\u7981\u7528\u5728 FreeBSD \u4e0a\u4f7f\u7528 <code>TCP_NOPUSH</code> \u5957\u63a5\u5b57\u9009\u9879\u6216\u5728 Linux \u4e0a\u4f7f\u7528 <code>TCP_CORK</code> \u5957\u63a5\u5b57\u9009\u9879\u3002\u8fd9\u4e9b\u9009\u9879\u53ea\u6709\u5728\u4f7f\u7528 sendfile \u65f6\u624d\u80fd\u4f7f\u7528\u3002\u542f\u7528\u8be5\u9009\u9879\u5c06\u5141\u8bb8\uff1a</p> <ul> <li>\u5728 Linux \u548c FreeBSD 4 \u4e0a\uff0c\u5728\u540c\u4e00\u5305\u4e2d\u53ef\u53d1\u9001\u54cd\u5e94\u5934\u548c\u6587\u4ef6\u5f00\u5934\u3002</li> <li>\u4ee5\u5b8c\u6574\u5305\u7684\u65b9\u5f0f\u53d1\u9001\u4e00\u4e2a\u6587\u4ef6</li> </ul>"},{"location":"Modules-reference/http/ngx_http_core_module/#try_files","title":"try_files","text":"- \u8bf4\u660e \u8bed\u6cd5 try_files <code>file ... uri</code>;  try_files <code>file ... =code</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 server\u3001location <p>\u4ee5\u6307\u5b9a\u987a\u5e8f\u68c0\u67e5\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u5e76\u4f7f\u7528\u7b2c\u4e00\u4e2a\u627e\u5230\u7684\u6587\u4ef6\u8fdb\u884c\u8bf7\u6c42\u5904\u7406\u3002\u5904\u7406\u5c06\u5728\u5f53\u524d\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c\u3002\u6307\u5411\u6587\u4ef6\u7684\u8def\u5f84\u6839\u636e root \u548c alias \u6307\u4ee4\u4ece <code>file</code> \u53c2\u6570\u6784\u9020\u3002\u53ef\u4ee5\u901a\u8fc7\u5728\u540d\u79f0\u672b\u5c3e\u6307\u5b9a\u659c\u7ebf\u6765\u68c0\u67e5\u76ee\u5f55\u662f\u5426\u5b58\u5728\uff0c\u4f8b\u5982\uff0c<code>$URI/</code>\u3002\u5982\u679c\u627e\u4e0d\u5230\u4efb\u4f55\u6587\u4ef6\uff0c\u5219\u5185\u90e8\u91cd\u5b9a\u5411\u5c06\u6307\u5411\u6700\u540e\u4e00\u4e2a\u53c2\u6570\u4e2d\u6307\u5b9a\u7684 <code>uri</code>\u3002\u4f8b\u5982\uff1a</p> <pre><code>location /images/ {\ntry_files $uri /images/default.gif;\n}\n\nlocation = /images/default.gif {\nexpires 30s;\n}\n</code></pre> <p>\u6700\u540e\u4e00\u4e2a\u53c2\u6570\u4e5f\u53ef\u4ee5\u6307\u5411\u4e00\u4e2a\u547d\u540d\u7684 location \uff0c\u5982\u4ee5\u4e0b\u793a\u4f8b\u3002\u4ece 0.7.51 \u7248\u672c\u5f00\u59cb\uff0c\u6700\u540e\u4e00\u4e2a\u53c2\u6570\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a <code>code</code>\uff1a</p> <pre><code>location / {\ntry_files $uri $uri/index.html $uri.html =404;\n}\n</code></pre> <p>\u4ee3\u7406 Mongrel \u793a\u4f8b\uff1a</p> <pre><code>location / {\ntry_files /system/maintenance.html\n$uri $uri/index.html $uri.html\n@mongrel;\n}\n\nlocation @mongrel {\nproxy_pass http://mongrel;\n}\n</code></pre> <p>Drupal/FastCGI \u793a\u4f8b\uff1a</p> <pre><code>location / {\ntry_files $uri $uri/ @drupal;\n}\n\nlocation ~ \\.php$ {\ntry_files $uri @drupal;\n\nfastcgi_pass ...;\n\nfastcgi_param SCRIPT_FILENAME /path/to$fastcgi_script_name;\nfastcgi_param SCRIPT_NAME     $fastcgi_script_name;\nfastcgi_param QUERY_STRING    $args;\n\n... other fastcgi_param's\n}\n\nlocation @drupal {\nfastcgi_pass ...;\n\nfastcgi_param SCRIPT_FILENAME /path/to/index.php;\nfastcgi_param SCRIPT_NAME     /index.php;\nfastcgi_param QUERY_STRING    q=$uri&amp;$args;\n\n... other fastcgi_param's\n}\n</code></pre> <p>\u5728\u4ee5\u4e0b\u793a\u4f8b\u4e2d</p> <pre><code>location / {\ntry_files $uri $uri/ @drupal;\n}\n</code></pre> <p>try_files \u6307\u4ee4\u76f8\u5f53\u4e8e</p> <pre><code>location / {\nerror_page 404 = @drupal;\nlog_not_found off;\n}\n</code></pre> <p>\u8fd8\u6709\u4e00\u4e2a\u793a\u4f8b</p> <pre><code>location ~ \\.php$ {\ntry_files $uri @drupal;\n\nfastcgi_pass ...;\n\nfastcgi_param SCRIPT_FILENAME /path/to$fastcgi_script_name;\n\n...\n}\n</code></pre> <p>\u5728\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9 FastCGI \u670d\u52a1\u5668\u4e4b\u524d\uff0ctry_files \u5c06\u68c0\u67e5 PHP \u6587\u4ef6\u662f\u5426\u5b58\u5728\u3002</p> <p>Wordpress \u4e0e Joomla \u793a\u4f8b\uff1a</p> <pre><code>location / {\ntry_files $uri $uri/ @wordpress;\n}\n\nlocation ~ \\.php$ {\ntry_files $uri @wordpress;\n\nfastcgi_pass ...;\n\nfastcgi_param SCRIPT_FILENAME /path/to$fastcgi_script_name;\n... other fastcgi_param's\n}\n\nlocation @wordpress {\nfastcgi_pass ...;\n\nfastcgi_param SCRIPT_FILENAME /path/to/index.php;\n... other fastcgi_param's\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_core_module/#types_hash_bucket_size","title":"types_hash_bucket_size","text":"- \u8bf4\u660e \u8bed\u6cd5 types_hash_bucket_size <code>size</code>; \u9ed8\u8ba4 types_hash_bucket_size 64; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7c7b\u578b\u54c8\u5e0c\u8868\u6876\u5927\u5c0f\u3002\u8bbe\u7f6e\u54c8\u5e0c\u8868\u7684\u7ec6\u8282\u5728\u5355\u72ec\u7684\u6587\u6863\u4e2d\u6709\u63d0\u4f9b\u3002</p> <p>\u5728\u7248 1.5.13 \u672c\u4e4b\u524d\uff0c\u9ed8\u8ba4\u503c\u53d6\u51b3\u4e8e\u5904\u7406\u5668\u7f13\u5b58\u884c\u7684\u5927\u5c0f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#types_hash_max_size","title":"types_hash_max_size","text":"- \u8bf4\u660e \u8bed\u6cd5 types_hash_max_size <code>size</code>; \u9ed8\u8ba4 types_hash_max_size 1024; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7c7b\u578b\u54c8\u5e0c\u8868\u7684\u6700\u5927\u5927\u5c0f\u3002\u8bbe\u7f6e\u54c8\u5e0c\u8868\u7684\u7ec6\u8282\u5728\u5355\u72ec\u7684\u6587\u6863\u4e2d\u6709\u63d0\u4f9b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#underscores_in_headers","title":"underscores_in_headers","text":"- \u8bf4\u660e \u8bed\u6cd5 underscores_in_headers <code>on</code> | <code>off</code>; \u9ed8\u8ba4 underscores_in_headers off; \u4e0a\u4e0b\u6587 http\u3001server <p>\u542f\u7528\u6216\u7981\u7528\u5728\u5ba2\u6237\u7aef\u8bf7\u6c42\u5934\u5b57\u6bb5\u4e2d\u4f7f\u7528\u4e0b\u5212\u7ebf\u3002\u5f53\u7981\u7528\u4e0b\u5212\u7ebf\u65f6\uff0c\u540d\u79f0\u4e2d\u5305\u542b\u4e0b\u5212\u7ebf\u7684\u8bf7\u6c42\u5934\u5b57\u6bb5\u5c06\u88ab\u6807\u8bb0\u4e3a\u65e0\u6548\uff0c\u5e76\u53d7\u5236\u4e8e ignore_invalid_headers \u6307\u4ee4\u3002</p> <p>\u5982\u679c\u8be5\u6307\u4ee4\u662f\u5728 server \u7ea7\u522b\u6307\u5b9a\uff0c\u5219\u4ec5\u5728 server \u662f\u9ed8\u8ba4 server \u65f6\u624d\u4f7f\u7528\u8be5\u6307\u4ee4\u3002\u6307\u5b9a\u7684\u503c\u4e5f\u9002\u7528\u4e8e\u76d1\u542c\u76f8\u540c\u5730\u5740\u548c\u7aef\u53e3\u7684\u6240\u6709\u865a\u62df\u670d\u52a1\u5668\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#variables_hash_bucket_size","title":"variables_hash_bucket_size","text":"- \u8bf4\u660e \u8bed\u6cd5 variables_hash_bucket_size <code>size</code>; \u9ed8\u8ba4 variables_hash_bucket_size size; \u4e0a\u4e0b\u6587 http <p>\u8bbe\u7f6e\u53d8\u91cf\u54c8\u5e0c\u8868\u6876\u5927\u5c0f\u3002\u8bbe\u7f6e\u54c8\u5e0c\u8868\u7684\u7ec6\u8282\u5728\u5355\u72ec\u7684\u6587\u6863\u4e2d\u6709\u63d0\u4f9b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_core_module/#variables_hash_max_size","title":"variables_hash_max_size","text":"- \u8bf4\u660e \u8bed\u6cd5 variables_hash_max_size <code>size</code>; \u9ed8\u8ba4 variables_hash_max_size  1024; \u4e0a\u4e0b\u6587 http <p>\u8bbe\u7f6e\u53d8\u91cf\u54c8\u54c8\u5e0c\u8868\u7684\u6700\u5927\u5927\u5c0f\u3002\u8bbe\u7f6e\u54c8\u5e0c\u8868\u7684\u7ec6\u8282\u5728\u5355\u72ec\u7684\u6587\u6863\u4e2d\u6709\u63d0\u4f9b\u3002</p> <p>\u5728 1.5.13 \u7248\u672c\u4e4b\u524d\uff0c\u9ed8\u8ba4\u503c\u662f 512\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_core_module/#_2","title":"\u5185\u5d4c\u53d8\u91cf","text":"<p><code>ngx_http_core_module</code> \u6a21\u5757\u652f\u6301\u5d4c\u5165\u5f0f\u53d8\u91cf\u540d\u79f0\u4e0e Apache \u670d\u52a1\u5668\u53d8\u91cf\u5339\u914d\u3002\u9996\u5148\uff0c\u8fd9\u4e9b\u662f\u51fa\u73b0\u5728\u5ba2\u6237\u7aef\u8bf7\u6c42\u5934\u5b57\u6bb5\u7684\u53d8\u91cf\uff0c\u4f8b\u5982 <code>$http_user_agent</code>\u3001<code>$http_cookie</code> \u7b49\u7b49\u3002\u8fd8\u6709\u5176\u4ed6\u53d8\u91cf\uff1a</p> <ul> <li> <p><code>$arg_name</code></p> <p>\u8bf7\u6c42\u884c\u4e2d\u7684 <code>name</code> \u53c2\u6570</p> </li> <li> <p><code>$args</code></p> <p>\u8bf7\u6c42\u884c\u4e2d\u7684\u53c2\u6570</p> </li> <li> <p><code>$binary_remote_addr</code></p> <p>\u5ba2\u6237\u7aef\u5730\u5740\u4ee5\u4e8c\u8fdb\u5236\u5f62\u5f0f\u8868\u793a\uff0c\u503c\u7684\u957f\u5ea6\u5bf9\u4e8e IPv4 \u5730\u5740\u603b\u662f 4 \u4e2a\u5b57\u8282\uff0c\u5bf9\u4e8e IPv6 \u5730\u5740\u603b\u662f 16 \u4e2a\u5b57\u8282 - <code>$body_bytes_sent</code></p> <p>\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u7684\u5b57\u8282\u6570\uff0c\u4e0d\u5305\u62ec\u54cd\u5e94\u5934\u3002\u6b64\u53d8\u91cf\u4e0e <code>mod_log_config</code> Apache \u6a21\u5757\u7684 <code>\uff05B</code> \u53c2\u6570\u517c\u5bb9</p> </li> <li> <p><code>$bytes_sent</code></p> <p>\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u7684\u5b57\u8282\u6570\uff081.3.8\u30011.2.5\uff09</p> </li> <li> <p>$connection</p> <p>\u8fde\u63a5\u5e8f\u5217\u53f7\uff081.3.8\u30011.2.5\uff09</p> </li> <li> <p><code>$connection_requests</code></p> <p>\u5f53\u524d\u901a\u8fc7\u8fde\u63a5\u8bf7\u6c42\u7684\u8bf7\u6c42\u6570\uff081.3.8\u30011.2.5\uff09</p> </li> <li> <p><code>$connect_length</code></p> <p><code>Content-Length</code> \u8bf7\u6c42\u5934\u5b57\u6bb5</p> </li> <li> <p><code>$content_type</code></p> <p><code>Content-Type</code> \u8bf7\u6c42\u5934\u5b57\u6bb5</p> </li> <li> <p><code>$cookie_name</code></p> <p>\u540d\u79f0\u4e3a <code>name</code> \u7684 cookie</p> </li> <li> <p><code>$document_root</code></p> <p>\u6839\u76ee\u5f55\u6216\u522b\u540d\u6307\u4ee4\u7684\u5f53\u524d\u8bf7\u6c42\u7684\u503c</p> </li> <li> <p><code>$document_uri</code></p> <p>\u4e0e <code>$uri</code> \u76f8\u540c</p> </li> <li> <p><code>$host</code></p> <p>\u6309\u7167\u4ee5\u4e0b\u4f18\u5148\u987a\u5e8f\uff1a\u6765\u81ea\u8bf7\u6c42\u884c\u7684\u4e3b\u673a\u540d\uff0c\u6765\u81ea <code>Host</code> \u8bf7\u6c42\u5934\u5b57\u6bb5\u7684\u4e3b\u673a\u540d\uff0c\u6216\u4e0e\u8bf7\u6c42\u5339\u914d\u7684\u670d\u52a1\u5668\u540d</p> </li> <li> <p><code>$hostname</code></p> <p>\u4e3b\u673a\u540d</p> </li> <li> <p><code>$http_name</code></p> <p>\u4efb\u610f\u8bf7\u6c42\u5934\u5b57\u6bb5,\u53d8\u91cf\u540d\u79f0\u7684\u6700\u540e\u4e00\u90e8\u5206\u662f\u5c06\u5b57\u6bb5\u540d\u79f0\u8f6c\u6362\u4e3a\u5c0f\u5199\uff0c\u5e76\u7528\u7834\u6298\u53f7\u66ff\u6362\u4e3a\u4e0b\u5212\u7ebf</p> </li> <li> <p><code>$https</code></p> <p>\u5982\u679c\u8fde\u63a5\u4ee5 SSL \u6a21\u5f0f\u8fd0\u884c\uff0c\u5219\u4e3a <code>on</code>\uff0c\u5426\u5219\u4e3a\u7a7a\u5b57\u7b26\u4e32</p> </li> <li> <p><code>$is_args</code></p> <p>\u5982\u679c\u8bf7\u6c42\u884c\u6709\u53c2\u6570\u5219\u4e3a <code>?</code>\uff0c\u5426\u5219\u4e3a\u7a7a\u5b57\u7b26\u4e32</p> </li> <li> <p><code>$limit_rate</code></p> <p>\u8bbe\u7f6e\u8fd9\u4e2a\u53d8\u91cf\u53ef\u4ee5\u5b9e\u73b0\u54cd\u5e94\u901f\u7387\u9650\u5236\uff0c\u89c1 limit_rate</p> </li> <li> <p><code>$msec</code></p> <p>\u5f53\u524d\u65f6\u95f4\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff081.3.9\u30011.2.6\uff09</p> </li> <li> <p><code>$nginx_version</code></p> <p>nginx \u7248\u672c</p> </li> <li> <p><code>$pid</code></p> <p>\u5de5\u4f5c\u8fdb\u7a0b\u7684 PID</p> </li> <li> <p><code>$pipe</code></p> <p>\u5982\u679c\u8bf7\u6c42\u662f\u7ba1\u9053\u6a21\u5f0f\u5219\u4e3a <code>p</code>\uff0c\u5426\u5219\u4e3a <code>.</code>\uff081.3.12\u30011.2.7\uff09</p> </li> <li> <p><code>$proxy_protocol_addr</code></p> <p>\u6765\u81ea PROXY \u534f\u8bae\u5934\u7684\u5ba2\u6237\u7aef\u5730\u5740\uff0c\u5426\u5219\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff081.5.12\uff09</p> <p>\u8981\u5728 listen \u6307\u4ee4\u4e2d\u8bbe\u7f6e <code>proxy_protocol</code> \u53c2\u6570\uff0c\u5fc5\u987b\u5148\u542f\u7528 PROXY \u534f\u8bae\u3002</p> </li> <li> <p><code>$proxy_protocol_port</code> </p> <p>PROXY \u534f\u8bae\u5934\u4e2d\u7684\u5ba2\u6237\u7aef\u53e3\uff0c\u5426\u5219\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff081.11.0\uff09</p> <p>\u8981\u5728 listen \u6307\u4ee4\u4e2d\u8bbe\u7f6e <code>proxy_protocol</code> \u53c2\u6570\uff0c\u5fc5\u987b\u5148\u542f\u7528 PROXY \u534f\u8bae\u3002</p> </li> <li> <p><code>$query_string</code></p> <p>\u4e0e <code>$args</code> \u76f8\u540c</p> </li> <li> <p><code>$realpath_root</code></p> <p>\u4e0e\u5f53\u524d\u8bf7\u6c42\u7684 root \u6216 alias \u6307\u4ee4\u503c\u76f8\u5bf9\u5e94\u7684\u7edd\u5bf9\u8def\u5f84\u540d\uff0c\u6240\u6709\u7b26\u53f7\u94fe\u63a5\u90fd\u5c06\u89e3\u6790\u4e3a\u5b9e\u9645\u8def\u5f84</p> </li> <li> <p><code>$remote_addr</code></p> <p>\u5ba2\u6237\u7aef\u5730\u5740</p> </li> <li> <p><code>$remote_port</code></p> <p>\u5ba2\u6237\u7aef\u7aef\u53e3</p> </li> <li> <p><code>$remote_user</code></p> <p>\u57fa\u672c\u8eab\u4efd\u9a8c\u8bc1\u63d0\u4f9b\u7684\u7528\u6237\u540d</p> </li> <li> <p><code>$request</code></p> <p>\u5b8c\u6574\u7684\u539f\u59cb\u8bf7\u6c42\u884c</p> </li> <li> <p><code>$request_body</code></p> <p>\u8bf7\u6c42\u6b63\u6587</p> <p>\u5f53\u8bf7\u6c42\u6b63\u6587\u88ab\u8bfb\u53d6\u5230\u5185\u5b58\u7f13\u51b2\u533a\u65f6\uff0c\u53d8\u91cf\u7684\u503c\u5728\u7531proxy_pass\u3001fastcgi_pass\u3001uwsgi_pass \u548c scgi_pass \u6307\u4ee4\u5904\u7406\u7684 location \u4e2d\u53ef\u7528\u3002</p> </li> <li> <p><code>$request_body_file</code></p> <p>\u5e26\u6709\u8bf7\u6c42\u6b63\u6587\u7684\u4e34\u65f6\u6587\u4ef6\u7684\u540d\u79f0</p> <p>\u5728\u5904\u7406\u7ed3\u675f\u65f6\uff0c\u6587\u4ef6\u9700\u8981\u88ab\u5220\u9664\u3002\u60f3\u59cb\u7ec8\u5c06\u8bf7\u6c42\u4e3b\u4f53\u5199\u5165\u6587\u4ef6\u4e2d\uff0c\u9700\u8981\u542f\u7528 client_body_in_file_only\u3002\u5f53\u4e34\u65f6\u6587\u4ef6\u7684\u540d\u79f0\u5728\u4ee3\u7406\u8bf7\u6c42\u4e2d\u6216\u5728\u5411 FastCGI/uwsgi/SCGI \u670d\u52a1\u5668\u7684\u8bf7\u6c42\u4e2d\u4f20\u9012\u65f6\uff0c\u5e94\u8be5\u5206\u522b\u901a\u8fc7 proxy_pass_request_body off\u3001fastcgi_pass_request_body off\u3001uwsgi_pass_request_body off \u6216 scgi_pass_request_body off \u6307\u4ee4\u7981\u7528\u4f20\u9012\u8bf7\u6c42\u6b63\u6587\u3002</p> </li> <li> <p><code>$request_completion</code></p> <p>\u5982\u679c\u8bf7\u6c42\u5df2\u7ecf\u5b8c\u6210\uff0c\u5219\u8fd4\u56de <code>OK</code>\uff0c\u5426\u5219\u8fd4\u56de\u7a7a\u5b57\u7b26\u4e32</p> </li> <li> <p><code>$request_filename</code></p> <p>\u5f53\u524d\u8bf7\u6c42\u7684\u6587\u4ef6\u8def\u5f84\uff0c\u57fa\u4e8e root \u6216 alias \u6307\u4ee4\u4ee5\u53ca\u8bf7\u6c42 URI</p> </li> <li> <p><code>$request_id</code></p> <p>\u7531 16 \u4e2a\u968f\u673a\u5b57\u8282\u751f\u6210\u7684\u552f\u4e00\u8bf7\u6c42\u6807\u8bc6\u7b26\uff0c\u4ee5\u5341\u516d\u8fdb\u5236\u8868\u793a\uff081.11.0\uff09</p> </li> <li> <p><code>$request_length</code></p> <p>\u8bf7\u6c42\u957f\u5ea6\uff08\u5305\u62ec\u8bf7\u6c42\u884c\u3001\u5934\u90e8\u548c\u8bf7\u6c42\u4f53\uff09\uff081.3.12\u30011.2.7\uff09</p> </li> <li> <p><code>$request_method</code></p> <p>\u8bf7\u6c42\u65b9\u6cd5\uff0c\u901a\u5e38\u4e3a <code>GET</code> \u6216 <code>POST</code></p> </li> <li> <p><code>$request_time</code></p> <p>\u8bf7\u6c42\u5904\u7406\u65f6\u95f4\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff081.3.9\u30011.2.6\uff09\u3002\u81ea\u5ba2\u6237\u7aef\u8bfb\u53d6\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u65f6\u95f4\u8d77</p> </li> <li> <p><code>$request_uri</code></p> <p>\u5b8c\u6574\u7684\u539f\u59cb\u8bf7\u6c42 URI\uff08\u5e26\u53c2\u6570\uff09</p> </li> <li> <p><code>$scheme</code></p> <p>\u8bf7\u6c42\u6a21\u5f0f\uff0c<code>http</code> \u6216 <code>https</code></p> </li> <li> <p><code>$sent_http_name</code></p> <p>\u4efb\u610f\u54cd\u5e94\u5934\u5b57\u6bb5\u3002\u53d8\u91cf\u540d\u79f0\u7684\u6700\u540e\u4e00\u90e8\u5206\u662f\u5c06\u5b57\u6bb5\u540d\u79f0\u8f6c\u6362\u4e3a\u5c0f\u5199\uff0c\u5e76\u7528\u7834\u6298\u53f7\u66ff\u6362\u4e3a\u4e0b\u5212\u7ebf</p> </li> <li> <p><code>$sent_trailer_name</code></p> <p>\u54cd\u5e94\u7ed3\u675f\u65f6\u53d1\u9001\u7684\u4efb\u610f\u5b57\u6bb5\uff081.13.2\uff09\u3002\u53d8\u91cf\u540d\u79f0\u7684\u6700\u540e\u4e00\u90e8\u5206\u662f\u5c06\u5b57\u6bb5\u540d\u79f0\u8f6c\u6362\u4e3a\u5c0f\u5199\uff0c\u5e76\u7528\u7834\u6298\u53f7\u66ff\u6362\u4e3a\u4e0b\u5212\u7ebf</p> </li> <li> <p><code>$server_addr</code></p> <p>\u63a5\u53d7\u8bf7\u6c42\u7684\u670d\u52a1\u5668\u5730\u5740</p> <p>\u901a\u5e38\u9700\u8981\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u6765\u8ba1\u7b97\u8fd9\u4e2a\u53d8\u91cf\u7684\u503c\u3002\u4e3a\u4e86\u907f\u514d\u7cfb\u7edf\u8c03\u7528\uff0clisten \u6307\u4ee4\u5fc5\u987b\u6307\u5b9a\u5730\u5740\u5e76\u4f7f\u7528 <code>bind</code> \u53c2\u6570\u3002</p> </li> <li> <p><code>$server_name</code></p> <p>\u63a5\u53d7\u8bf7\u6c42\u7684\u670d\u52a1\u5668\u540d\u79f0</p> </li> <li> <p><code>$server_port</code></p> <p>\u63a5\u53d7\u8bf7\u6c42\u7684\u670d\u52a1\u5668\u7aef\u53e3</p> </li> <li> <p><code>$server_protocol</code></p> <p>\u8bf7\u6c42\u534f\u8bae\uff0c\u901a\u5e38\u4e3a <code>HTTP/1.0</code>\u3001<code>HTTP/1.1</code> \u6216 HTTP/2.0</p> </li> <li> <p><code>$status</code></p> <p>\u54cd\u5e94\u72b6\u6001\uff081.3.2\u30011.2.2\uff09</p> </li> <li> <p><code>$tcpinfo_rtt</code>\u3001<code>$tcpinfo_rttvar</code>\u3001<code>$tcpinfo_snd_cwnd</code>\u3001<code>$tcpinfo_rcv_space</code></p> <p>\u6709\u5173\u5ba2\u6237\u7aef TCP \u8fde\u63a5\u7684\u4fe1\u606f\u3002\u5728\u652f\u6301 <code>TCP_INFO</code> \u5957\u63a5\u5b57\u9009\u9879\u7684\u7cfb\u7edf\u4e0a\u53ef\u7528</p> </li> <li> <p><code>$time_iso8601</code></p> <p>\u672c\u5730\u65f6\u95f4\u91c7\u7528 ISO 8601 \u6807\u51c6\u683c\u5f0f\uff081.3.12\u30011.2.7\uff09</p> </li> <li> <p><code>$time_local</code></p> <p>\u901a\u7528\u65e5\u5fd7\u683c\u5f0f\uff08Common Log Format\uff09\u4e2d\u7684\u672c\u5730\u65f6\u95f4\uff081.3.12\u30011.2.7\uff09</p> </li> <li> <p><code>$uri</code></p> <p>\u89c4\u8303\u5316\u8fc7\u7684\u5f53\u524d\u8bf7\u6c42 URI</p> <p><code>$uri</code> \u7684\u503c\u53ef\u80fd\u5728\u8bf7\u6c42\u671f\u95f4\u4f1a\u6539\u53d8</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_core_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_core_module.html</p>"},{"location":"Modules-reference/http/ngx_http_dav_module/","title":"ngx_http_dav_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>dav_access</li> <li>dav_methods</li> <li>create_full_put_path</li> <li>min_delete_depth</li> </ul> </li> </ul> <p><code>ngx_http_dav_module</code> \u6a21\u5757\u7528\u4e8e\u901a\u8fc7 WebDAV \u534f\u8bae\u8fdb\u884c\u6587\u4ef6\u7ba1\u7406\u81ea\u52a8\u5316\u3002\u8be5\u6a21\u5757\u5904\u7406 HTTP \u548c WebDAV \u7684 PUT\u3001DELETE\u3001MKCOL\u3001COPY \u548c MOVE \u65b9\u6cd5\u3002</p> <p>\u8be5\u6a21\u5757\u4e0d\u662f\u9ed8\u8ba4\u6784\u7684\uff0c\u60a8\u53ef\u4ee5\u5728\u6784\u5efa\u65f6\u4f7f\u7528 <code>--with-http_dav_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p>\u9700\u8981\u5176\u4ed6 WebDAV \u65b9\u6cd5\u8fdb\u884c\u64cd\u4f5c\u7684 WebDAV \u5ba2\u6237\u7aef\u5c06\u65e0\u6cd5\u4f7f\u7528\u6b64\u6a21\u5757\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_dav_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location / {\nroot                  /data/www;\n\nclient_body_temp_path /data/client_temp;\n\ndav_methods PUT DELETE MKCOL COPY MOVE;\n\ncreate_full_put_path  on;\ndav_access            group:rw  all:r;\n\nlimit_except GET {\nallow 192.168.1.0/32;\ndeny  all;\n}\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_dav_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_dav_module/#dav_access","title":"dav_access","text":"- \u8bf4\u660e \u8bed\u6cd5 dav_access <code>users:permissions ...</code>; \u9ed8\u8ba4 dav_access user:rw; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u65b0\u521b\u5efa\u7684\u6587\u4ef6\u548c\u76ee\u5f55\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u4f8b\u5982\uff1a</p> <pre><code>dav_access user:rw group:rw all:r;\n</code></pre> <p>\u5982\u679c\u6307\u5b9a\u4e86\u4efb\u4f55 <code>group</code> \uff08\u7ec4\uff09\u6216\u6240\u6709\u8bbf\u95ee\u6743\u9650\uff0c\u5219\u53ef\u4ee5\u7701\u7565 <code>user</code> \u6743\u9650\uff1a</p> <pre><code>dav_access group:rw all:r;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_dav_module/#dav_methods","title":"dav_methods","text":"- \u8bf4\u660e \u8bed\u6cd5 dav_methods <code>off</code> | <code>method ...</code>; \u9ed8\u8ba4 dav_methods off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5141\u8bb8\u6307\u5b9a\u7684 HTTP \u65b9\u6cd5\u548c WebDAV \u65b9\u6cd5\u3002\u53c2\u6570 <code>off</code> \u5c06\u62d2\u7edd\u672c\u6a21\u5757\u5904\u7406\u7684\u6240\u6709\u65b9\u6cd5\u3002\u652f\u6301\u4ee5\u4e0b\u65b9\u6cd5\uff1aPUT\u3001DELETE\u3001MKCOL\u3001COPY \u548c MOVE\u3002</p> <p>\u4f7f\u7528 PUT \u65b9\u6cd5\u4e0a\u4f20\u7684\u6587\u4ef6\u9996\u5148\u9700\u8981\u5199\u5165\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\uff0c\u7136\u540e\u91cd\u547d\u540d\u8be5\u6587\u4ef6\u3002\u4ece 0.8.9 \u7248\u672c\u5f00\u59cb\uff0c\u4e34\u65f6\u6587\u4ef6\u548c\u6301\u4e45\u5b58\u50a8\u53ef\u4ee5\u653e\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002\u4f46\u662f\uff0c\u8bf7\u6ce8\u610f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6587\u4ef6\u590d\u5236\u9700\u8981\u8de8\u8d8a\u4e24\u4e2a\u6587\u4ef6\u7cfb\u7edf\uff0c\u800c\u4e0d\u662f\u7b80\u5355\u7684\u91cd\u547d\u540d\u64cd\u4f5c\u3002\u56e0\u6b64\uff0c\u5efa\u8bae\u901a\u8fc7 client_body_temp_path \u6307\u4ee4\u5bf9\u4e34\u65f6\u6587\u4ef6\u8bbe\u7f6e\u5b58\u653e\u76ee\u5f55\uff0c\u4e0e\u4fdd\u5b58\u6587\u4ef6\u7684\u76ee\u5f55\u8bbe\u7f6e\u5728\u540c\u4e00\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002</p> <p>\u5f53\u4f7f\u7528 PUT \u65b9\u6cd5\u521b\u5efa\u6587\u4ef6\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u5728 Date \u5934\u57df\u4e2d\u4f20\u9012\u65e5\u671f\u6765\u6307\u5b9a\u4fee\u6539\u65e5\u671f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_dav_module/#create_full_put_path","title":"create_full_put_path","text":"- \u8bf4\u660e \u8bed\u6cd5 create_full_put_path <code>on</code> | <code>off</code>; \u9ed8\u8ba4 create_full_put_path off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>WebDAV \u89c4\u8303\u4ec5\u5141\u8bb8\u5728\u5df2\u5b58\u5728\u7684\u76ee\u5f55\u4e2d\u521b\u5efa\u6587\u4ef6\u3002\u5f00\u542f\u8be5\u6307\u4ee4\u5141\u8bb8\u521b\u5efa\u6240\u6709\u9700\u8981\u7684\u4e2d\u95f4\u76ee\u5f55\u3002</p>"},{"location":"Modules-reference/http/ngx_http_dav_module/#min_delete_depth","title":"min_delete_depth","text":"- \u8bf4\u660e \u8bed\u6cd5 min_delete_depth <code>number</code>; \u9ed8\u8ba4 min_delete_depth 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5141\u8bb8 DELETE \u65b9\u6cd5\u5220\u9664\u6587\u4ef6\uff0c\u53ea\u8981\u8bf7\u6c42\u8def\u5f84\u4e2d\u7684\u5143\u7d20\u6570\u4e0d\u5c11\u4e8e\u6307\u5b9a\u7684\u6570\u5b57\u3002\u4f8b\u5982\uff0c\u6307\u4ee4\uff1a</p> <pre><code>min_delete_depth 4;\n</code></pre> <p>\u5141\u8bb8\u5220\u9664\u8bf7\u6c42\u4e2d\u7684\u6587\u4ef6</p> <pre><code>/users/00/00/name\n/users/00/00/name/pic.jpg\n/users/00/00/page.html\n</code></pre> <p>\u62d2\u7edd\u5220\u9664\u7684\u6587\u4ef6</p> <pre><code>/users/00/00\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_dav_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_dav_module.html</p>"},{"location":"Modules-reference/http/ngx_http_empty_gif_module/","title":"ngx_http_empty_gif_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>empty_gif</li> </ul> </li> </ul> <p><code>ngx_http_empty_gif_module</code> \u6a21\u5757\u53d1\u9001\u5355\u50cf\u7d20\u900f\u660e GIF\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_empty_gif_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location = /_.gif {\nempty_gif;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_empty_gif_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_empty_gif_module/#empty_gif","title":"empty_gif","text":"- \u8bf4\u660e \u8bed\u6cd5 empty_gif; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 location <p>\u5f00\u542f\u9488\u5bf9 <code>location</code> \u7684\u6a21\u5757\u5904\u7406\u3002</p>"},{"location":"Modules-reference/http/ngx_http_empty_gif_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_empty_gif_module.html</p>"},{"location":"Modules-reference/http/ngx_http_f4f_module/","title":"ngx_http_f4f_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>f4f</li> <li>f4f_buffer_size</li> </ul> </li> </ul> <p><code>ngx_http_f4f_module</code> \u6a21\u5757\u4e3a Adobe HTTP \u52a8\u6001\u6d41\uff08HDS\uff09\u63d0\u4f9b\u670d\u52a1\u7aef\u652f\u6301\u3002</p> <p>\u8be5\u6a21\u5757\u4ee5 <code>/videoSeg1-Frag1</code> \u5f62\u5f0f\u5904\u7406 HTTP \u52a8\u6001\u6d41\u8bf7\u6c42\uff0c\u4f7f\u7528 <code>videoSeg1.f4x</code> \u7d22\u5f15\u6587\u4ef6\u4ece <code>videoSeg1.f4f</code> \u6587\u4ef6\u4e2d\u63d0\u53d6\u6240\u9700\u7684\u7247\u6bb5\u3002\u8be5\u6a21\u5757\u662f Apache \u7684 Adobe f4f \u6a21\u5757\uff08HTTP Origin Module\uff09\u7684\u66ff\u4ee3\u54c1\u3002</p> <p>\u5b83\u9700\u8981\u901a\u8fc7 Adobe \u7684 f4fpackager \u8fdb\u884c\u9884\u5904\u7406\uff0c\u6709\u5173\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u76f8\u5173\u6587\u6863\u3002</p> <p>\u6b64\u6a21\u5757\u4f5c\u4e3a\u6211\u4eec\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_f4f_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location /video/ {\nf4f;\n...\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_f4f_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_f4f_module/#f4f","title":"f4f","text":"- \u8bf4\u660e \u8bed\u6cd5 f4f; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 location <p>\u5f00\u542f\u9488\u5bf9 <code>location</code> \u7684\u6a21\u5757\u5904\u7406\u3002</p>"},{"location":"Modules-reference/http/ngx_http_f4f_module/#f4f_buffer_size","title":"f4f_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 f4f4f_buffer_sizef <code>size</code>; \u9ed8\u8ba4 f4f_buffer_size 512k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7528\u4e8e\u8bfb\u53d6 <code>.f4x</code> \u7d22\u5f15\u6587\u4ef6\u7684\u7f13\u51b2\u533a\u7684 <code>size</code> \uff08\u5927\u5c0f\uff09\u3002</p>"},{"location":"Modules-reference/http/ngx_http_f4f_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_f4f_module.html</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/","title":"ngx_http_fastcgi_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>fastcgi_bind</li> <li>fastcgi_buffer_size</li> <li>fastcgi_buffering</li> <li>fastcgi_buffers</li> <li>fastcgi_busy_buffers_size</li> <li>fastcgi_cache</li> <li>fastcgi_cache_background_update</li> <li>fastcgi_cache_bypass</li> <li>fastcgi_cache_key</li> <li>fastcgi_cache_lock</li> <li>fastcgi_cache_lock_age</li> <li>fastcgi_cache_lock_timeout</li> <li>fastcgi_cache_max_range_offset</li> <li>fastcgi_cache_methods</li> <li>fastcgi_cache_min_uses</li> <li>fastcgi_cache_path</li> <li>fastcgi_cache_purge</li> <li>fastcgi_cache_revalidate</li> <li>fastcgi_cache_use_stale</li> <li>fastcgi_cache_valid</li> <li>fastcgi_catch_stderr</li> <li>fastcgi_connect_timeout</li> <li>fastcgi_force_ranges</li> <li>fastcgi_hide_header</li> <li>fastcgi_ignore_client_abort</li> <li>fastcgi_ignore_headers</li> <li>fastcgi_index</li> <li>fastcgi_intercept_errors</li> <li>fastcgi_keep_conn</li> <li>fastcgi_limit_rate</li> <li>fastcgi_max_temp_file_size</li> <li>fastcgi_next_upstream</li> <li>fastcgi_next_upstream_timeout</li> <li>fastcgi_next_upstream_tries</li> <li>fastcgi_no_cache</li> <li>fastcgi_param</li> <li>fastcgi_pass</li> <li>fastcgi_pass_header</li> <li>fastcgi_pass_request_body</li> <li>fastcgi_pass_request_headers</li> <li>fastcgi_read_timeout</li> <li>fastcgi_request_buffering</li> <li>fastcgi_send_lowat</li> <li>fastcgi_send_timeout</li> <li>fastcgi_split_path_info</li> <li>fastcgi_store</li> <li>fastcgi_store_access</li> <li>fastcgi_temp_file_write_size</li> <li>fastcgi_temp_path</li> </ul> </li> <li>\u4f20\u53c2\u5230 FastCGI \u670d\u52a1\u5668</li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_http_fastcgi_module</code> \u6a21\u5757\u5141\u8bb8\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9 FastCGI \u670d\u52a1\u5668\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location / {\nfastcgi_pass  localhost:9000;\nfastcgi_index index.php;\n\nfastcgi_param SCRIPT_FILENAME /home/www/scripts/php$fastcgi_script_name;\nfastcgi_param QUERY_STRING    $query_string;\nfastcgi_param REQUEST_METHOD  $request_method;\nfastcgi_param CONTENT_TYPE    $content_type;\nfastcgi_param CONTENT_LENGTH  $content_length;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_bind","title":"fastcgi_bind","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_bind <code>address [transparent]</code> | <code>off</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.8.22 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u901a\u8fc7\u4e00\u4e2a\u53ef\u9009\u7684\u7aef\u53e3\uff081.11.2\uff09\u4ece\u6307\u5b9a\u7684\u672c\u5730 IP \u5730\u5740\u53d1\u51fa\u5230 FastCGI \u670d\u52a1\u5668\u7684\u4f20\u51fa\u8fde\u63a5\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.3.12\uff09\u3002\u7279\u6b8a\u503c <code>off</code>\uff081.3.12\uff09\u53d6\u6d88\u4ece\u4e0a\u5c42\u914d\u7f6e\u7ea7\u522b\u7ee7\u627f\u5230\u7684 <code>fastcgi_bind</code> \u6307\u4ee4\u4f5c\u7528\uff0c\u8fd9\u5141\u8bb8\u7cfb\u7edf\u81ea\u52a8\u5206\u914d\u672c\u5730 IP \u5730\u5740\u548c\u7aef\u53e3\u3002</p> <p><code>transparent</code> \u53c2\u6570\uff081.11.0\uff09\u5141\u8bb8\u4ece\u975e\u672c\u5730 IP \u5730\u5740\uff08\u4f8b\u5982\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u771f\u5b9e IP \u5730\u5740\uff09\u7684\u5230 FastCGI \u670d\u52a1\u5668\u7684\u4f20\u51fa\u8fde\u63a5\uff1a</p> <pre><code>fastcgi_bind $remote_addr transparent;\n</code></pre> <p>\u4e3a\u4e86\u4f7f\u8fd9\u4e2a\u53c2\u6570\u8d77\u4f5c\u7528\uff0c\u6709\u5fc5\u8981\u4ee5\u8d85\u7ea7\u7528\u6237\u6743\u9650\u8fd0\u884c nginx \u5de5\u4f5c\u8fdb\u7a0b\uff0c\u5e76\u914d\u7f6e\u5185\u6838\u8def\u7531\u6765\u62e6\u622a\u6765\u81ea FastCGI \u670d\u52a1\u5668\u7684\u7f51\u7edc\u6d41\u91cf\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_buffer_size","title":"fastcgi_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_buffer_size <code>size</code>; \u9ed8\u8ba4 fastcgi_buffer_size 4k|8k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u8bfb\u53d6 FastCGI \u670d\u52a1\u5668\u6536\u5230\u7684\u54cd\u5e94\u7684\u7b2c\u4e00\u90e8\u5206\u7684\u7f13\u51b2\u533a\u7684 <code>size</code>\uff08\u5927\u5c0f\uff09\u3002\u8be5\u90e8\u5206\u901a\u5e38\u5305\u542b\u4e00\u4e2a\u5c0f\u7684\u54cd\u5e94\u5934\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u51b2\u533a\u5927\u5c0f\u7b49\u4e8e\u4e00\u4e2a\u5185\u5b58\u9875\u3002\u4e3a 4K \u6216 8K\uff0c\u56e0\u5e73\u53f0\u800c\u5f02\u3002\u4f46\u662f\uff0c\u5b83\u53ef\u4ee5\u8bbe\u7f6e\u5f97\u66f4\u5c0f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_buffering","title":"fastcgi_buffering","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_buffering <code>on</code> | <code>off</code>; \u9ed8\u8ba4 fastcgi_buffering on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.6 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u6216\u7981\u7528\u6765\u81ea FastCGI \u670d\u52a1\u5668\u7684\u54cd\u5e94\u7f13\u51b2\u3002</p> <p>\u5f53\u542f\u7528\u7f13\u51b2\u65f6\uff0cnginx \u4f1a\u5c3d\u53ef\u80fd\u5feb\u5730\u6536\u5230\u63a5\u6536\u6765\u81ea FastCGI \u670d\u52a1\u5668\u7684\u54cd\u5e94\uff0c\u5e76\u5c06\u5176\u4fdd\u5b58\u5230\u7531 fastcgi_buffer_size \u548c fastcgi_buffers \u6307\u4ee4\u8bbe\u7f6e\u7684\u7f13\u51b2\u533a\u4e2d\u3002\u5982\u679c\u5185\u5b58\u653e\u4e0d\u4e0b\u6574\u4e2a\u54cd\u5e94\uff0c\u54cd\u5e94\u7684\u4e00\u90e8\u5206\u53ef\u4ee5\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u7684\u4e34\u65f6\u6587\u4ef6\u4e2d\u3002\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u7531 fastcgi_max_temp_file_size  \u548c fastcgi_temp_file_write_size \u6307\u4ee4\u63a7\u5236\u3002</p> <p>\u5f53\u7f13\u51b2\u88ab\u7981\u7528\u65f6\uff0cnginx \u5728\u6536\u5230\u54cd\u5e94\u65f6\u7acb\u5373\u540c\u6b65\u4f20\u9012\u7ed9\u5ba2\u6237\u7aef\uff0c\u4e0d\u4f1a\u5c1d\u8bd5\u4ece FastCGI \u670d\u52a1\u5668\u8bfb\u53d6\u6574\u4e2a\u54cd\u5e94\u3002nginx \u4e00\u6b21\u53ef\u4ee5\u4ece\u670d\u52a1\u5668\u63a5\u6536\u7684\u6700\u5927\u6570\u636e\u91cf\u7531 fastcgi_buffer_size \u6307\u4ee4\u8bbe\u7f6e\u3002</p> <p>\u901a\u8fc7\u5728 <code>X-Accel-Buffering</code> \u54cd\u5e94\u5934\u5b57\u6bb5\u4e2d\u901a\u8fc7 <code>yes</code> \u6216 <code>no</code> \u4e5f\u53ef\u4ee5\u542f\u7528\u6216\u7981\u7528\u7f13\u51b2\u3002\u53ef\u4ee5\u4f7f\u7528 fastcgi_ignore_headers \u6307\u4ee4\u7981\u7528\u6b64\u529f\u80fd\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_buffes","title":"fastcgi_buffes","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_buffes <code>number size</code>; \u9ed8\u8ba4 fastcgi_buffers 8 4k|8k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u5355\u4e2a\u8fde\u63a5\u4ece FastCGI \u670d\u52a1\u5668\u8bfb\u53d6\u54cd\u5e94\u7684\u7f13\u51b2\u533a\u7684 <code>number</code> \uff08\u6570\u91cf\uff09\u548c <code>size</code> \uff08\u5927\u5c0f\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u51b2\u533a\u5927\u5c0f\u7b49\u4e8e\u4e00\u4e2a\u5185\u5b58\u9875\u3002\u4e3a 4K \u6216 8K\uff0c\u56e0\u5e73\u53f0\u800c\u5f02\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_busy_buffers_size","title":"fastcgi_busy_buffers_size","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_busy_buffers_size <code>size</code>; \u9ed8\u8ba4 fastcgi_busy_buffers_size 8k|16k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5f53\u542f\u7528 FastCGI \u670d\u52a1\u5668\u54cd\u5e94\u7f13\u51b2\u65f6\uff0c\u9650\u5236\u7f13\u51b2\u533a\u7684\u603b\u5927\u5c0f\uff08<code>size</code>\uff09\u5728\u5f53\u54cd\u5e94\u5c1a\u672a\u88ab\u5b8c\u5168\u8bfb\u53d6\u65f6\u53ef\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u54cd\u5e94\u3002\u540c\u65f6\uff0c\u5176\u4f59\u7684\u7f13\u51b2\u533a\u53ef\u4ee5\u7528\u6765\u8bfb\u53d6\u54cd\u5e94\uff0c\u5982\u679c\u9700\u8981\u7684\u8bdd\uff0c\u7f13\u51b2\u90e8\u5206\u54cd\u5e94\u5230\u4e34\u65f6\u6587\u4ef6\u4e2d\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>size</code> \u53d7 fastcgi_buffer_size \u548c fastcgi_buffers \u6307\u4ee4\u8bbe\u7f6e\u7684\u4e24\u4e2a\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_cache","title":"fastcgi_cache","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_cache <code>zone</code> | <code>off</code>; \u9ed8\u8ba4 fastcgi_cache off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u7528\u4e8e\u7f13\u5b58\u7684\u5171\u4eab\u5185\u5b58\u533a\u57df\u3002\u540c\u4e00\u4e2a\u533a\u57df\u53ef\u4ee5\u5728\u51e0\u4e2a\u5730\u65b9\u4f7f\u7528\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.7.9\uff09\u3002<code>off</code> \u53c2\u6570\u5c06\u7981\u7528\u4ece\u4e0a\u7ea7\u914d\u7f6e\u7ea7\u522b\u7ee7\u627f\u7684\u7f13\u5b58\u914d\u7f6e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_cache_background_update","title":"fastcgi_cache_background_update","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_cache_background_update <code>on</code> | <code>off</code>; \u9ed8\u8ba4 fastcgi_cache_background_update off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.10. \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5141\u8bb8\u542f\u52a8\u540e\u53f0\u5b50\u8bf7\u6c42\u6765\u66f4\u65b0\u8fc7\u671f\u7684\u7f13\u5b58\u9879\uff0c\u800c\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\u5219\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u8bf7\u6ce8\u610f\uff0c\u6709\u5fc5\u8981\u5728\u66f4\u65b0\u65f6\u5141\u8bb8\u4f7f\u7528\u9648\u65e7\u7684\u7f13\u5b58\u54cd\u5e94\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_cache_bypass","title":"fastcgi_cache_bypass","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_cache_bypass <code>string ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e0d\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u54cd\u5e94\u7684\u6761\u4ef6\u3002\u5982\u679c\u5b57\u7b26\u4e32\u53c2\u6570\u4e2d\u6709\u4e00\u4e2a\u503c\u4e0d\u4e3a\u7a7a\u4e14\u4e0d\u7b49\u4e8e <code>0</code>\uff0c\u5219\u4e0d\u4f1a\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u54cd\u5e94\uff1a</p> <pre><code>fastcgi_cache_bypass $cookie_nocache $arg_nocache$arg_comment;\nfastcgi_cache_bypass $http_pragma    $http_authorization;\n</code></pre> <p>\u53ef\u4ee5\u548c fastcgi_no_cache \u6307\u4ee4\u4e00\u8d77\u4f7f\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_cache_key","title":"fastcgi_cache_key","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_cache_key <code>string</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u4e3a\u7f13\u5b58\u5b9a\u4e49\u4e00\u4e2a key\uff0c\u4f8b\u5982\uff1a</p> <pre><code>fastcgi_cache_key localhost:9000$request_uri;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_cache_lock","title":"fastcgi_cache_lock","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_cache_lock <code>on</code> | <code>off</code>; \u9ed8\u8ba4 fastcgi_cache_lock off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.12 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5f53\u542f\u7528\u65f6\uff0c\u540c\u4e00\u65f6\u95f4\u53ea\u5141\u8bb8\u4e00\u4e2a\u8bf7\u6c42\u901a\u8fc7\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9 FastCGI \u670d\u52a1\u5668\u6765\u586b\u5145 fastcgi_cache_key \u6307\u4ee4\u6807\u8bc6\u7684\u65b0\u7f13\u5b58\u5143\u7d20\u3002\u540c\u4e00\u7f13\u5b58\u5143\u7d20\u7684\u5176\u4ed6\u8bf7\u6c42\u5c06\u7b49\u5f85\u54cd\u5e94\u51fa\u73b0\u5728\u7f13\u5b58\u4e2d\uff0c\u6216\u7b49\u5f85\u6b64\u5143\u7d20\u7684\u7f13\u5b58\u9501\u91ca\u653e\uff0c\u76f4\u5230 fastcgi_cache_lock_timeout \u6307\u4ee4\u8bbe\u7f6e\u7684\u65f6\u95f4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_cache_lock_age","title":"fastcgi_cache_lock_age","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_cache_lock_age <code>time</code>; \u9ed8\u8ba4 fastcgi_cache_lock_age 5s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.8 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5982\u679c\u4f20\u9012\u7ed9 FastCGI \u670d\u52a1\u5668\u7684\u6700\u540e\u4e00\u4e2a\u8bf7\u6c42\u586b\u5145\u65b0\u7f13\u5b58\u5143\u7d20\u6ca1\u80fd\u5728\u6307\u5b9a\u7684 <code>time</code> \u5185\u5b8c\u6210\uff0c\u5219\u53ef\u80fd\u4f1a\u6709\u5176\u4ed6\u53e6\u4e00\u4e2a\u8bf7\u6c42\u88ab\u4f20\u9012\u7ed9 FastCGI \u670d\u52a1\u5668\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_cache_lock_timeout","title":"fastcgi_cache_lock_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_cache_lock_timeout <code>time</code>; \u9ed8\u8ba4 fastcgi_cache_lock_timeout 5s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.12 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e fastcgi_cache_lock \u7684\u8d85\u65f6\u65f6\u95f4\u3002\u5f53\u65f6\u95f4\u5230\u671f\u65f6\uff0c\u8bf7\u6c42\u5c06\u88ab\u4f20\u9012\u7ed9 FastCGI \u670d\u52a1\u5668\uff0c\u4f46\u662f\uff0c\u54cd\u5e94\u4e0d\u4f1a\u88ab\u7f13\u5b58\u3002</p> <p>\u5728 1.7.8 \u4e4b\u524d\uff0c\u54cd\u5e94\u53ef\u4ee5\u88ab\u7f13\u5b58\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_cache_max_range_offset","title":"fastcgi_cache_max_range_offset","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_cache_max_range_offset <code>number</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.6 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u4e3a byte-range \u8bf7\u6c42\u8bbe\u7f6e\u5b57\u8282\u504f\u79fb\u91cf\u3002\u5982\u679c range \u8d85\u51fa <code>number</code>\uff08\u504f\u79fb\u91cf\uff09\uff0crange \u8bf7\u6c42\u5c06\u88ab\u4f20\u9012\u7ed9 FastCGI \u670d\u52a1\u5668\uff0c\u5e76\u4e14\u4e0d\u4f1a\u7f13\u5b58\u54cd\u5e94\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_cache_methods","title":"fastcgi_cache_methods","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_cache_methods <code>GET</code> | <code>HEAD</code> | <code>POST ...</code>; \u9ed8\u8ba4 fastcgi_cache_methods GET HEAD; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.7.59 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5982\u679c\u6b64\u6307\u4ee4\u4e2d\u5b58\u5728\u5f53\u524d\u5ba2\u6237\u7aef\u8bf7\u6c42\u65b9\u6cd5\uff0c\u90a3\u4e48\u54cd\u5e94\u5c06\u88ab\u7f13\u5b58\u3002\u867d\u7136 <code>GET</code> \u548c <code>HEAD</code> \u65b9\u6cd5\u603b\u662f\u5728\u8be5\u5217\u8868\u4e2d\uff0c\u4f46\u6211\u4eec\u8fd8\u662f\u5efa\u8bae\u60a8\u660e\u786e\u6307\u5b9a\u5b83\u4eec\u3002\u53e6\u8bf7\u53c2\u9605 fastcgi_no_cache \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_cache_min_uses","title":"fastcgi_cache_min_uses","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_cache_min_uses <code>number</code>; \u9ed8\u8ba4 fastcgi_cache_min_uses 1; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u6307\u5b9a\u6570\u91cf\uff08<code>number</code>\uff09\u8bf7\u6c42\u540e\u54cd\u5e94\u5c06\u88ab\u7f13\u5b58\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_cache_path","title":"fastcgi_cache_path","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_cache_path <code>path [levels=levels] [use_temp_path=on&amp;#124;off] keys_zone=name:size [inactive=time] [max_size=size] [manager_files=number] [manager_sleep=time] [manager_threshold=time] [loader_files=number] [loader_sleep=time] [loader_threshold=time] [purger=on&amp;#124;off] [purger_files=number] [purger_sleep=time] [purger_threshold=time]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u8bbe\u7f6e\u7f13\u5b58\u7684\u8def\u5f84\u548c\u5176\u4ed6\u53c2\u6570\u3002\u7f13\u5b58\u6570\u636e\u5b58\u50a8\u5728\u6587\u4ef6\u4e2d\u3002\u7f13\u5b58\u4e2d\u7684 key \u548c\u6587\u4ef6\u540d\u662f\u4ee3\u7406 URL \u7ecf\u8fc7 MD5 \u51fd\u6570\u5904\u7406\u540e\u5f97\u5230\u7684\u503c\u3002<code>levels</code> \u53c2\u6570\u5b9a\u4e49\u7f13\u5b58\u7684\u5c42\u6b21\u7ed3\u6784\u7ea7\u522b\uff1a\u8303\u56f4\u4ece <code>1</code> \u5230 <code>3</code>\uff0c\u6bcf\u4e2a\u7ea7\u522b\u53ef\u63a5\u53d7\u503c\u4e3a <code>1</code> \u6216 <code>2</code>\u3002\u4f8b\u5982\uff0c\u5728\u4ee5\u4e0b\u914d\u7f6e\u4e2d</p> <pre><code>fastcgi_cache_path /data/nginx/cache levels=1:2 keys_zone=one:10m;\n</code></pre> <p>\u7f13\u5b58\u4e2d\u7684\u6587\u4ef6\u540d\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>/data/nginx/cache/c/29/b7f54b2df7773722d382f4809d65029c\n</code></pre> <p>\u9996\u5148\u5c06\u7f13\u5b58\u7684\u54cd\u5e94\u5199\u5165\u4e34\u65f6\u6587\u4ef6\uff0c\u7136\u540e\u91cd\u547d\u540d\u8be5\u6587\u4ef6\u3002\u4ece 0.8.9 \u7248\u672c\u5f00\u59cb\uff0c\u4e34\u65f6\u6587\u4ef6\u548c\u7f13\u5b58\u53ef\u4ee5\u653e\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002\u4f46\u662f\uff0c\u8bf7\u6ce8\u610f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6587\u4ef6\u590d\u5236\u5c06\u8981\u8de8\u4e24\u4e2a\u6587\u4ef6\u7cfb\u7edf\uff0c\u800c\u4e0d\u662f\u7b80\u5355\u7684\u91cd\u547d\u540d\u64cd\u4f5c\u3002\u56e0\u6b64\u5efa\u8bae\uff0c\u5bf9\u4e8e\u4efb\u4f55\u7ed9\u5b9a\u7684\u4f4d\u7f6e\uff0c\u7f13\u5b58\u548c\u4fdd\u5b58\u4e34\u65f6\u6587\u4ef6\u7684\u76ee\u5f55\u90fd\u5e94\u8be5\u653e\u5728\u540c\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002\u4e34\u65f6\u6587\u4ef6\u7684\u76ee\u5f55\u6839\u636e <code>use_temp_path</code> \u53c2\u6570\uff081.7.10\uff09\u8bbe\u7f6e\u3002\u5982\u679c\u5ffd\u7565\u6b64\u53c2\u6570\u6216\u5c06\u5176\u8bbe\u7f6e\u4e3a <code>on</code>\uff0c\u5219\u5c06\u4f7f\u7528\u7531 fastcgi_temp_path \u6307\u4ee4\u8bbe\u7f6e\u7684\u76ee\u5f55\u3002\u5982\u679c\u8be5\u503c\u8bbe\u7f6e\u4e3a <code>off</code>\uff0c\u4e34\u65f6\u6587\u4ef6\u5c06\u76f4\u63a5\u653e\u5728\u7f13\u5b58\u76ee\u5f55\u4e2d\u3002</p> <p>\u53e6\u5916\uff0c\u6240\u6709\u6d3b\u8dc3\u7684 key \u548c\u6709\u5173\u6570\u636e\u7684\u4fe1\u606f\u90fd\u5b58\u50a8\u5728\u5171\u4eab\u5185\u5b58\u533a\u4e2d\uff0c\u5176\u540d\u79f0\u548c\u5927\u5c0f\u7531 <code>keys_zone</code> \u53c2\u6570\u914d\u7f6e\u3002\u4e00\u4e2a\u5146\u5b57\u8282\u7684\u533a\u57df\u53ef\u4ee5\u5b58\u50a8\u5927\u7ea6 8 \u5343\u4e2a key\u3002</p> <p>\u4f5c\u4e3a\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\uff0c\u5171\u4eab\u5185\u5b58\u533a\u8fd8\u5b58\u50a8\u5176\u4ed6\u7f13\u5b58\u4fe1\u606f\uff0c\u56e0\u6b64\uff0c\u9700\u8981\u4e3a\u76f8\u540c\u6570\u91cf\u7684 key\u533a\u57df\u5927\u5c0f\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u5146\u5b57\u8282\u533a\u57df\u53ef\u4ee5\u5b58\u50a8\u5927\u7ea6 4 \u5343\u4e2a key\u3002</p> <p>\u5728 <code>inactive</code> \u53c2\u6570\u6307\u5b9a\u7684\u65f6\u95f4\u5185\u672a\u88ab\u8bbf\u95ee\u7684\u7f13\u5b58\u6570\u636e\u5c06\u4ece\u7f13\u5b58\u4e2d\u5220\u9664\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>inactive</code> \u8bbe\u7f6e\u4e3a 10 \u5206\u949f\u3002</p> <p>\u201c\u7f13\u5b58\u7ba1\u7406\u5668\u201d\uff08cache manager\uff09\u8fdb\u7a0b\u76d1\u89c6\u7684\u6700\u5927\u7f13\u5b58\u5927\u5c0f\u7531 <code>max_size</code> \u53c2\u6570\u8bbe\u7f6e\u3002\u5f53\u8d85\u8fc7\u6b64\u5927\u5c0f\u65f6\uff0c\u5b83\u5c06\u5220\u9664\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u3002\u6570\u636e\u5728\u7531 <code>manager_files</code>\u3001<code>manager_threshold</code> \u548c <code>manager_sleep</code> \u53c2\u6570\uff081.11.5\uff09\u914d\u7f6e\u4e0b\u8fdb\u884c\u8fed\u4ee3\u5220\u9664\u3002\u5728\u4e00\u6b21\u8fed\u4ee3\u4e2d\uff0c\u4e0d\u4f1a\u8d85\u8fc7 <code>manager_files</code> \u9879\u88ab\u5220\u9664\uff08\u9ed8\u8ba4\u4e3a 100\uff09\u3002\u4e00\u6b21\u8fed\u4ee3\u7684\u6301\u7eed\u65f6\u95f4\u53d7\u5230 <code>manager_threshold</code> \u53c2\u6570\uff08\u9ed8\u8ba4\u4e3a 200 \u6beb\u79d2\uff09\u7684\u9650\u5236\u3002\u5728\u6bcf\u6b21\u8fed\u4ee3\u4e4b\u95f4\u5b58\u5728\u95f4\u9694\u65f6\u95f4\uff0c\u7531 <code>manager_sleep</code> \u53c2\u6570\uff08\u9ed8\u8ba4\u4e3a 50 \u6beb\u79d2\uff09\u914d\u7f6e\u3002</p> <p>\u5f00\u59cb\u540e\u4e00\u5206\u949f\uff0c\u201c\u7f13\u5b58\u52a0\u8f7d\u5668\u201d\uff08cache loader\uff09\u8fdb\u7a0b\u88ab\u6fc0\u6d3b\u3002\u5b83\u5c06\u5148\u524d\u5b58\u50a8\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u7f13\u5b58\u6570\u636e\u7684\u6709\u5173\u4fe1\u606f\u52a0\u8f7d\u5230\u7f13\u5b58\u533a\u4e2d\u3002\u52a0\u8f7d\u4e5f\u662f\u5728\u8fed\u4ee3\u4e2d\u5b8c\u6210\u3002\u5728\u6bcf\u4e00\u6b21\u8fed\u4ee3\u4e2d\uff0c\u4e0d\u4f1a\u52a0\u8f7d <code>loader_files</code> \u4e2a\u9879\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a 100\uff09\u3002\u6b64\u5916\uff0c\u6bcf\u4e00\u6b21\u8fed\u4ee3\u7684\u6301\u7eed\u65f6\u95f4\u53d7\u5230 <code>loader_threshold</code> \u53c2\u6570\u7684\u9650\u5236\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a 200 \u6beb\u79d2\uff09\u3002\u5728\u8fed\u4ee3\u4e4b\u95f4\u5b58\u5728\u95f4\u9694\u65f6\u95f4\uff0c\u7531 <code>loader_sleep</code> \u53c2\u6570\uff08\u9ed8\u8ba4\u4e3a 50 \u6beb\u79d2\uff09\u914d\u7f6e\u3002</p> <p>\u6b64\u5916\uff0c\u4ee5\u4e0b\u53c2\u6570\u4f5c\u4e3a\u6211\u4eec\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\uff1a</p> <ul> <li> <p><code>purger=on|off</code>     \u6307\u660e\u7f13\u5b58\u6e05\u9664\u7a0b\u5e8f\uff081.7.12\uff09\u662f\u5426\u5c06\u4e0e\u901a\u914d\u7b26\u952e\u5339\u914d\u7684\u7f13\u5b58\u6761\u76ee\u4ece\u78c1\u76d8\u4e2d\u5220\u9664\u3002\u5c06\u8be5\u53c2\u6570\u8bbe\u7f6e\u4e3a <code>on</code>\uff08\u9ed8\u8ba4\u4e3a <code>off</code>\uff09\u5c06\u6fc0\u6d3b\u201c\u7f13\u5b58\u6e05\u9664\u5668\u201d\uff08cache purger\uff09\u8fdb\u7a0b\uff0c\u8be5\u8fdb\u7a0b\u4e0d\u65ad\u904d\u5386\u6240\u6709\u7f13\u5b58\u6761\u76ee\u5e76\u5220\u9664\u4e0e\u901a\u914d\u7b26\u5339\u914d\u7684\u6761\u76ee\u3002</p> </li> <li> <p><code>purger_files=number</code>     \u8bbe\u7f6e\u5728\u4e00\u6b21\u8fed\u4ee3\u671f\u95f4\u5c06\u8981\u626b\u63cf\u7684\u6761\u76ee\u6570\u91cf\uff081.7.12\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>purger_files</code> \u8bbe\u7f6e\u4e3a 10\u3002</p> </li> <li> <p><code>purger_threshold=number</code>     \u8bbe\u7f6e\u4e00\u6b21\u8fed\u4ee3\u7684\u6301\u7eed\u65f6\u95f4\uff081.7.12\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>purger_threshold</code> \u8bbe\u7f6e\u4e3a 50 \u6beb\u79d2\u3002</p> </li> <li> <p><code>purger_sleep=number</code>     \u5728\u8fed\u4ee3\u4e4b\u95f4\u8bbe\u7f6e\u6682\u505c\u65f6\u95f4\uff081.7.12\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>purger_sleep</code> \u8bbe\u7f6e\u4e3a 50 \u6beb\u79d2\u3002</p> </li> </ul> <p>\u5728 1.7.3\u30011.7.7 \u548c 1.11.10 \u7248\u672c\u4e2d\uff0c\u7f13\u5b58\u5934\u683c\u5f0f\u53d1\u751f\u4e86\u66f4\u6539\u3002\u5347\u7ea7\u5230\u66f4\u65b0\u7684 nginx \u7248\u672c\u540e\uff0c\u4ee5\u524d\u7f13\u5b58\u7684\u54cd\u5e94\u5c06\u89c6\u4e3a\u65e0\u6548\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_cache_purge","title":"fastcgi_cache_purge","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_cache_purge <code>string ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5b9a\u4e49\u5c06\u8bf7\u6c42\u89c6\u4e3a\u7f13\u5b58\u6e05\u9664\u8bf7\u6c42\u7684\u6761\u4ef6\u3002\u5982\u679c string \u53c2\u6570\u4e2d\u81f3\u5c11\u6709\u4e00\u4e2a\u4e0d\u4e3a\u7a7a\u7684\u503c\u5e76\u4e14\u4e0d\u7b49\u4e8e\u201c0\u201d\uff0c\u5219\u5e26\u6709\u76f8\u5e94\u7f13\u5b58\u952e\u7684\u7f13\u5b58\u6761\u76ee\u5c06\u88ab\u5220\u9664\u3002\u901a\u8fc7\u8fd4\u56de 204\uff08\u65e0\u5185\u5bb9\uff09\u54cd\u5e94\u6765\u8868\u793a\u64cd\u4f5c\u6210\u529f\u3002</p> <p>\u5982\u679c\u6e05\u9664\u8bf7\u6c42\u7684\u7f13\u5b58\u952e\u4ee5\u661f\u53f7\uff08<code>*</code>\uff09\u7ed3\u5c3e\uff0c\u5219\u5c06\u5339\u914d\u901a\u914d\u7b26\u952e\u7684\u6240\u6709\u7f13\u5b58\u6761\u76ee\u4ece\u7f13\u5b58\u4e2d\u5220\u9664\u3002\u4f46\u662f\uff0c\u8fd9\u4e9b\u6761\u76ee\u4ecd\u7136\u4fdd\u7559\u5728\u78c1\u76d8\u4e0a\uff0c\u76f4\u5230\u5b83\u4eec\u56e0\u4e3a\u4e0d\u6d3b\u8dc3\u800c\u88ab\u5220\u9664\u6216\u88ab\u7f13\u5b58\u6e05\u9664\u7a0b\u5e8f\uff081.7.12\uff09\u5904\u7406\uff0c\u6216\u8005\u5ba2\u6237\u7aef\u5c1d\u8bd5\u8bbf\u95ee\u5b83\u4eec\u3002</p> <p>\u914d\u7f6e\u793a\u4f8b\uff1a</p> <pre><code>fastcgi_cache_path /data/nginx/cache keys_zone=cache_zone:10m;\n\nmap $request_method $purge_method {\nPURGE   1;\ndefault 0;\n}\n\nserver {\n...\nlocation / {\nfastcgi_pass        backend;\nfastcgi_cache       cache_zone;\nfastcgi_cache_key   $uri;\nfastcgi_cache_purge $purge_method;\n}\n}\n</code></pre> <p>\u8be5\u529f\u80fd\u53ef\u4f5c\u4e3a\u6211\u4eec\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_cache_revalidate","title":"fastcgi_cache_revalidate","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_cache_purge <code>on</code> | <code>off</code>; \u9ed8\u8ba4 fastcgi_cache_revalidate off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5f00\u542f\u4f7f\u7528\u5e26\u6709 <code>If-Modified-Since</code> \u548c <code>If-None-Match</code> \u5934\u5b57\u6bb5\u7684\u6761\u4ef6\u8bf7\u6c42\u5bf9\u8fc7\u671f\u7f13\u5b58\u9879\u8fdb\u884c\u91cd\u65b0\u9a8c\u8bc1\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_cache_use_stale","title":"fastcgi_cache_use_stale","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_cache_use_stale <code>error</code> | <code>timeout</code> | <code>invalid_header</code> | <code>updating</code> | <code>http_500</code> | <code>http_503</code> | <code>http_403</code> | <code>http_404</code> | <code>http_429</code> | <code>off ...</code>; \u9ed8\u8ba4 fastcgi_cache_use_stale off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5f53\u5728\u4e0e FastCGI \u670d\u52a1\u5668\u901a\u4fe1\u671f\u95f4\u53d1\u751f\u9519\u8bef\u65f6\u53ef\u4ee5\u4f7f\u7528\u9648\u65e7\u7684\u7f13\u5b58\u54cd\u5e94\u3002\u8be5\u6307\u4ee4\u7684\u53c2\u6570\u4e0e fastcgi_next_upstream \u6307\u4ee4\u7684\u53c2\u6570\u76f8\u5339\u914d\u3002</p> <p>\u5982\u679c\u65e0\u6cd5\u9009\u62e9\u4f7f\u7528 FastCGI \u670d\u52a1\u5668\u5904\u7406\u8bf7\u6c42\uff0c\u5219 <code>error</code> \u53c2\u6570\u8fd8\u5141\u8bb8\u4f7f\u7528\u9648\u65e7\u7684\u7f13\u5b58\u54cd\u5e94\u3002</p> <p>\u6b64\u5916\uff0c\u5982\u679c\u5b83\u5f53\u524d\u6b63\u5728\u66f4\u65b0\uff0c<code>updating</code> \u53c2\u6570\u5141\u8bb8\u4f7f\u7528\u9648\u65e7\u7684\u7f13\u5b58\u54cd\u5e94\u3002\u8fd9\u6837\u53ef\u4ee5\u5728\u66f4\u65b0\u7f13\u5b58\u6570\u636e\u65f6\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u5bf9 FastCGI \u670d\u52a1\u5668\u7684\u8bbf\u95ee\u6b21\u6570\u3002</p> <p>\u4e5f\u53ef\u4ee5\u5728\u54cd\u5e94\u5934\u4e2d\u76f4\u63a5\u542f\u7528\u5728\u54cd\u5e94\u53d8\u4e3a\u9648\u65e7\u7684\u6307\u5b9a\u79d2\u6570\u540e\u4f7f\u7528\u9648\u65e7\u7684\u7f13\u5b58\u54cd\u5e94\uff081.11.10\uff09\u3002\u8fd9\u6bd4\u4f7f\u7528\u6307\u4ee4\u53c2\u6570\u7684\u4f18\u5148\u7ea7\u4f4e\u3002</p> <ul> <li><code>Cache-Control</code> \u5934\u5b57\u6bb5\u7684 <code>stale-while-revalidate</code> \u6269\u5c55\u5141\u8bb8\u4f7f\u7528\u9648\u65e7\u7684\u7f13\u5b58\u54cd\u5e94\u5f53\u5b83\u6b63\u5728\u66f4\u65b0\u3002</li> <li><code>Cache-Control</code> \u5934\u5b57\u6bb5\u7684 <code>stale-if-error</code> \u6269\u5c55\u5141\u8bb8\u5728\u53d1\u751f\u9519\u8bef\u65f6\u4f7f\u7528\u9648\u65e7\u7684\u7f13\u5b58\u54cd\u5e94\u3002</li> </ul> <p>\u4e3a\u4e86\u6700\u5927\u9650\u5ea6\u5730\u51cf\u5c11\u586b\u5145\u65b0\u7f13\u5b58\u5143\u7d20\u65f6\u5bf9 FastCGI \u670d\u52a1\u5668\u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u53ef\u4ee5\u4f7f\u7528 fastcgi_cache_lock \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_cache_valid","title":"fastcgi_cache_valid","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_cache_valid <code>[code ...] time</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u4e3a\u4e0d\u540c\u7684\u54cd\u5e94\u7801\u8bbe\u7f6e\u7f13\u5b58\u65f6\u95f4\u3002\u4f8b\u5982\uff1a</p> <pre><code>fastcgi_cache_valid 200 302 10m;\nfastcgi_cache_valid 404      1m;\n</code></pre> <p>\u5bf9\u54cd\u5e94\u7801\u4e3a 200 \u548c 302 \u7684\u54cd\u5e94\u8bbe\u7f6e 10 \u5206\u949f\u7f13\u5b58\uff0c\u5bf9\u54cd\u5e94\u7801\u4e3a 404 \u7684\u54cd\u5e94\u8bbe\u7f6e\u4e3a 1 \u5206\u949f\u3002</p> <p>\u5982\u679c\u53ea\u6307\u5b9a\u7f13\u5b58\u65f6\u95f4\uff08<code>time</code>\uff09\uff1a</p> <pre><code>fastcgi_cache_valid 5m;\n</code></pre> <p>\u90a3\u4e48\u53ea\u7f13\u5b58 200 \u3001301 \u548c 302 \u54cd\u5e94\u3002</p> <p>\u53e6\u5916\uff0c\u53ef\u4ee5\u6307\u5b9a <code>any</code> \u53c2\u6570\u6765\u7f13\u5b58\u4efb\u4f55\u54cd\u5e94\uff1a</p> <pre><code>fastcgi_cache_valid 200 302 10m;\nfastcgi_cache_valid 301      1h;\nfastcgi_cache_valid any      1m;\n</code></pre> <p>\u7f13\u5b58\u53c2\u6570\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728\u54cd\u5e94\u5934\u4e2d\u8bbe\u7f6e\u3002\u8fd9\u6bd4\u4f7f\u7528\u6307\u4ee4\u8bbe\u7f6e\u7f13\u5b58\u65f6\u95f4\u5177\u6709\u66f4\u9ad8\u7684\u4f18\u5148\u7ea7\u3002</p> <ul> <li><code>X-Accel-Expires</code> \u5934\u5b57\u6bb5\u4ee5\u79d2\u4e3a\u5355\u4f4d\u8bbe\u7f6e\u54cd\u5e94\u7684\u7f13\u5b58\u65f6\u95f4\u3002\u96f6\u503c\u4f1a\u7981\u7528\u54cd\u5e94\u7f13\u5b58\u3002\u5982\u679c\u8be5\u503c\u4ee5 <code>@</code> \u524d\u7f00\u5f00\u5934\uff0c\u5219\u5b83\u4f1a\u8bbe\u7f6e\u81ea Epoch \u4ee5\u6765\u7684\u7edd\u5bf9\u65f6\u95f4\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09\uff0c\u6700\u591a\u53ef\u4ee5\u7f13\u5b58\u8be5\u65f6\u95f4\u6bb5\u5185\u7684\u54cd\u5e94\u3002</li> <li>\u5982\u679c\u5934\u4e2d\u4e0d\u5305\u542b <code>X-Accel-Expires</code> \u5b57\u6bb5\uff0c\u5219\u53ef\u4ee5\u5728\u5934\u5b57\u6bb5 <code>Expires</code> \u6216 <code>Cache-Control</code> \u4e2d\u8bbe\u7f6e\u7f13\u5b58\u53c2\u6570\u3002</li> <li>\u5982\u679c\u5934\u4e2d\u5305\u542b <code>Set-Cookie</code> \u5b57\u6bb5\uff0c\u5219\u4e0d\u4f1a\u7f13\u5b58\u6b64\u7c7b\u54cd\u5e94\u3002</li> <li>\u5982\u679c\u5934\u4e2d\u5305\u542b\u5177\u6709\u7279\u6b8a\u503c <code>*</code> \u7684 <code>Vary</code> \u5b57\u6bb5\uff0c\u5219\u8fd9\u79cd\u54cd\u5e94\u4e0d\u4f1a\u88ab\u7f13\u5b58\uff081.7.7\uff09\u3002\u5982\u679c\u5934\u4e2d\u5305\u542b\u5e26\u6709\u53e6\u4e00\u4e2a\u503c\u7684 <code>Vary</code> \u5b57\u6bb5\uff0c\u8003\u8651\u5230\u76f8\u5e94\u7684\u8bf7\u6c42\u5934\u5b57\u6bb5\uff081.7.7\uff09\uff0c\u8fd9\u6837\u7684\u54cd\u5e94\u5c06\u88ab\u7f13\u5b58\u3002</li> </ul> <p>\u4f7f\u7528 fastcgi_ignore_headers \u6307\u4ee4\u53ef\u4ee5\u7981\u7528\u4e00\u4e2a\u6216\u591a\u4e2a\u54cd\u5e94\u5934\u5b57\u6bb5\u7684\u5904\u7406\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_catch_stderr","title":"fastcgi_catch_stderr","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_catch_stderr <code>string</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u7528\u4e8e\u5728\u4ece FastCGI \u670d\u52a1\u5668\u63a5\u6536\u5230\u7684\u54cd\u5e94\u7684\u9519\u8bef\u6d41\u4e2d\u641c\u7d22\u5339\u914d\u3002\u5982\u679c\u627e\u5230\u8be5\u5b57\u7b26\u4e32\uff0c\u5219\u8ba4\u4e3a FastCGI \u670d\u52a1\u5668\u8fd4\u56de\u65e0\u6548\u54cd\u5e94\u3002\u6b64\u65f6\u5c06\u542f\u7528 nginx \u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u9519\u8bef\u5904\u7406\uff0c\u4f8b\u5982\uff1a</p> <pre><code>location /php {\nfastcgi_pass backend:9000;\n...\nfastcgi_catch_stderr \"PHP Fatal error\";\nfastcgi_next_upstream error timeout invalid_header;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_connect_timeout","title":"fastcgi_connect_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_connect_timeout <code>time</code>; \u9ed8\u8ba4 fastcgi_connect_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u4e0e FastCGI \u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u4e2a\u8d85\u65f6\u901a\u5e38\u4e0d\u80fd\u8d85\u8fc7 75 \u79d2\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_force_ranges","title":"fastcgi_force_ranges","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_force_ranges <code>on</code> | <code>off</code>; \u9ed8\u8ba4 fastcgi_force_ranges off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u6765\u81ea FastCGI \u670d\u52a1\u5668\u7684\u7f13\u5b58\u548c\u672a\u7f13\u5b58\u54cd\u5e94\u7684 byte-range \u652f\u6301\uff0c\u5ffd\u7565\u54cd\u5e94\u4e2d\u7684 <code>Accept-Ranges</code> \u5934\u5b57\u6bb5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_hide_header","title":"fastcgi_hide_header","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_hide_header <code>field</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnginx \u4e0d\u4f1a\u5c06 FastCGI \u670d\u52a1\u5668\u54cd\u5e94\u4e2d\u7684\u5934\u5b57\u6bb5 <code>Status</code> \u548c <code>X-Accel-...</code> \u4f20\u9012\u7ed9\u5ba2\u6237\u7aef\u3002<code>fastcgi_hide_header</code> \u6307\u4ee4\u8bbe\u7f6e\u4e0d\u4f1a\u88ab\u4f20\u9012\u7684\u9644\u52a0\u5b57\u6bb5\u3002\u4f46\u662f\uff0c\u5982\u679c\u9700\u8981\u5141\u8bb8\u4f20\u9012\u5b57\u6bb5\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 fastcgi_pass_header \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_ignore_client_abort","title":"fastcgi_ignore_client_abort","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_ignore_client_abort <code>on</code> | <code>off</code>; \u9ed8\u8ba4 fastcgi_ignore_client_abort off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u786e\u5b9a\u5f53\u5ba2\u6237\u7aef\u5173\u95ed\u8fde\u63a5\u800c\u4e0d\u7b49\u5f85\u54cd\u5e94\u65f6\u662f\u5426\u5173\u95ed\u4e0e FastCGI \u670d\u52a1\u5668\u7684\u8fde\u63a5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_ignore_headers","title":"fastcgi_ignore_headers","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_ignore_headers <code>field ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u7981\u6b62\u5904\u7406\u6765\u81ea FastCGI \u670d\u52a1\u5668\u7684\u67d0\u4e9b\u54cd\u5e94\u5934\u5b57\u6bb5\u3002\u4ee5\u4e0b\u5b57\u6bb5\u5c06\u88ab\u5ffd\u7565\uff1a<code>X-Accel-Redirect</code>\u3001<code>X-Accel-Expires</code>\u3001<code>X-Accel-Limit-Rate</code>\uff081.1.6\uff09\u3001<code>X-Accel-Buffering</code>\uff081.1.6\uff09\u3001<code>X-Accel-Charset</code>\uff081.1.6\uff09\u3001<code>Expires</code>\u3001<code>Cache-Control</code>\u3001<code>Set-Cookie</code>\uff080.8.44\uff09\u548c <code>Vary</code>\uff081.7.7\uff09\u3002</p> <p>\u5982\u679c\u672a\u7981\u7528\uff0c\u5219\u5904\u7406\u8fd9\u4e9b\u5934\u5b57\u6bb5\u4ea7\u751f\u4ee5\u4e0b\u6548\u679c\uff1a</p> <ul> <li><code>X-Accel-Expires</code>\u3001<code>Expires</code>\u3001<code>Cache-Control</code>\u3001<code>Set-Cookie</code> \u548c <code>Vary</code> \u8bbe\u7f6e\u54cd\u5e94\u7f13\u5b58\u7684\u53c2\u6570</li> <li><code>X-Accel-Redirect</code> \u6267\u884c\u5185\u90e8\u91cd\u5b9a\u5411\u5230\u6307\u5b9a\u7684 URI</li> <li><code>X-Accel-Limit-Rate</code> \u8bbe\u7f6e\u54cd\u5e94\u7684\u4f20\u9001\u901f\u7387\u9650\u5236\u56de\u5ba2\u6237\u7aef</li> <li><code>X-Accel-Buffering</code> \u542f\u7528\u6216\u7981\u7528\u7f13\u51b2\u54cd\u5e94</li> <li><code>X-Accel-Charset</code> \u8bbe\u7f6e\u6240\u9700\u7684\u54cd\u5e94\u5b57\u7b26\u96c6</li> </ul>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_index","title":"fastcgi_index","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_index <code>name</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5728 <code>$fastcgi_script_name</code> \u53d8\u91cf\u7684\u503c\u4e2d\u8bbe\u7f6e\u4e00\u4e2a\u6587\u4ef6\u540d\uff0c\u8be5\u6587\u4ef6\u540d\u8ffd\u52a0\u5230 URL \u540e\u9762\u5e76\u4ee5\u4e00\u4e2a\u659c\u6760\u7ed3\u5c3e\u3002\u4f8b\u5982\u4ee5\u4e0b\u8bbe\u7f6e</p> <pre><code>fastcgi_index index.php;\nfastcgi_param SCRIPT_FILENAME /home/www/scripts/php$fastcgi_script_name;\n</code></pre> <p>\u548c <code>/page.php</code> \u8bf7\u6c42\uff0c<code>SCRIPT_FILENAME</code> \u53c2\u6570\u5c06\u7b49\u4e8e <code>/home/www/scripts/php/page.php</code>\uff0c\u5e76\u4e14 <code>/</code> \u8bf7\u6c42\u5c06\u7b49\u4e8e <code>/home/www/scripts/php/index.php</code>\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_intercept_errors","title":"fastcgi_intercept_errors","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_intercept_errors <code>on</code> | <code>off</code>; \u9ed8\u8ba4 fastcgi_intercept_errors off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u786e\u5b9a\u5f53 FastCGI \u670d\u52a1\u5668\u54cd\u5e94\u7801\u5927\u4e8e\u6216\u7b49\u4e8e 300 \u65f6\u662f\u5426\u5e94\u4f20\u9012\u7ed9\u5ba2\u6237\u7aef\uff0c\u6216\u8005\u62e6\u622a\u5e76\u91cd\u5b9a\u5411\u5230 nginx \u4ee5\u4fbf\u4f7f\u7528 error_page \u6307\u4ee4\u8fdb\u884c\u5904\u7406\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_keep_conn","title":"fastcgi_keep_conn","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_keep_conn <code>on</code> | <code>off</code>; \u9ed8\u8ba4 fastcgi_keep_conn off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.4 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cFastCGI \u670d\u52a1\u5668\u5c06\u5728\u53d1\u9001\u54cd\u5e94\u540e\u7acb\u5373\u5173\u95ed\u8fde\u63a5\u3002\u4f46\u662f\uff0c\u5982\u679c\u5f53\u6b64\u6307\u4ee4\u8bbe\u7f6e\u4e3a <code>on</code> \u503c\uff0c\u5219 nginx \u5c06\u6307\u793a FastCGI \u670d\u52a1\u5668\u4fdd\u6301\u8fde\u63a5\u5904\u4e8e\u6253\u5f00\u72b6\u6001\u3002\u8fd9\u5bf9\u4fdd\u6301 FastCGI \u670d\u52a1\u5668\u8fde\u63a5 keepalive \u5c24\u4e3a\u91cd\u8981\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_limit_rate","title":"fastcgi_limit_rate","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_limit_rate <code>rate</code>; \u9ed8\u8ba4 fastcgi_limit_rate 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236\u8bfb\u53d6 FastCGI \u670d\u52a1\u5668\u54cd\u5e94\u7684\u901f\u5ea6\u3002<code>rate</code> \u4ee5\u6bcf\u79d2\u5b57\u8282\u6570\u4e3a\u5355\u4f4d\u3002\u96f6\u503c\u5219\u7981\u7528\u901f\u7387\u9650\u5236\u3002\u8be5\u9650\u5236\u662f\u9488\u5bf9\u6bcf\u4e2a\u8bf7\u6c42\u8bbe\u7f6e\u7684\uff0c\u56e0\u6b64\u5982\u679c nginx \u540c\u65f6\u6253\u5f00\u4e24\u4e2a\u8fde\u63a5\u5230 FastCFI \u670d\u52a1\u5668\u7684\u8fde\u63a5\uff0c\u5219\u6574\u4f53\u901f\u7387\u5c06\u662f\u6307\u5b9a\u9650\u5236\u7684\u4e24\u500d\u3002\u8be5\u9650\u5236\u4ec5\u5728\u542f\u7528\u7f13\u51b2\u6765\u81ea FastCGI \u670d\u52a1\u5668\u7684\u54cd\u5e94\u65f6\u624d\u8d77\u4f5c\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_max_temp_file_size","title":"fastcgi_max_temp_file_size","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_max_temp_file_size <code>size</code>; \u9ed8\u8ba4 fastcgi_max_temp_file_size 1024m; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5f53\u542f\u7528\u7f13\u51b2\u6765\u81ea FastCGI \u670d\u52a1\u5668\u7684\u54cd\u5e94\u65f6\u5e76\u4e14\u6574\u4e2a\u54cd\u5e94\u4e0d\u9002\u5408\u7531 {fastcgi_buffer_size](#fastcgi_buffer_size)  \u548c fastcgi_buffers \u6307\u4ee4\u8bbe\u7f6e\u7684\u7f13\u51b2\u65f6\uff0c\u54cd\u5e94\u7684\u4e00\u90e8\u5206\u53ef\u4ee5\u4fdd\u5b58\u5230\u4e34\u65f6\u6587\u4ef6\u4e2d\u3002\u8be5\u6307\u4ee4\u7528\u4e8e\u8bbe\u7f6e\u4e34\u65f6\u6587\u4ef6\u7684\u6700\u5927\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u4e00\u6b21\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u7684\u6570\u636e\u5927\u5c0f\u7531 fastcgi_temp_file_write_size \u6307\u4ee4\u8bbe\u7f6e\u3002</p> <p>\u96f6\u503c\u5c06\u7981\u7528\u4e34\u65f6\u6587\u4ef6\u54cd\u5e94\u7f13\u51b2\u3002</p> <p>\u6b64\u9650\u5236\u4e0d\u9002\u7528\u4e8e\u5c06\u8981\u7f13\u5b58\u6216\u5b58\u50a8\u5728\u78c1\u76d8\u4e0a\u7684\u54cd\u5e94\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_next_upstream","title":"fastcgi_next_upstream","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_next_upstream <code>error</code> | <code>timeout</code> | <code>invalid_header</code> | <code>http_500</code> | <code>http_503</code> | <code>http_403</code> | <code>http_404</code> | <code>http_429</code> | <code>non_idempotent</code> | <code>off ...</code>\uff1b \u9ed8\u8ba4 fastcgi_next_upstream error timeout; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u5b9a\u5728\u54ea\u4e9b\u60c5\u51b5\u4e0b\u8bf7\u6c42\u5e94\u4f20\u9012\u7ed9\u4e0b\u4e00\u53f0\u670d\u52a1\u5668\uff1a</p> <ul> <li> <p><code>erorr</code></p> <p>\u5728\u4e0e\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u3001\u4f20\u9012\u8bf7\u6c42\u6216\u8bfb\u53d6\u54cd\u5e94\u5934\u65f6\u53d1\u751f\u9519\u8bef</p> </li> <li> <p><code>timeout</code></p> <p>\u5728\u4e0e\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u3001\u4f20\u9012\u8bf7\u6c42\u6216\u8bfb\u53d6\u54cd\u5e94\u5934\u65f6\u53d1\u751f\u8d85\u65f6</p> </li> <li> <p><code>invalid_header</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u4e86\u7a7a\u7684\u6216\u65e0\u6548\u7684\u54cd\u5e94</p> </li> <li> <p><code>http_500</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de 500 \u54cd\u5e94\u7801</p> </li> <li> <p><code>http_503</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de 503 \u54cd\u5e94\u7801</p> </li> <li> <p><code>http_403</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de 403 \u54cd\u5e94\u7801</p> </li> <li> <p><code>http_404</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de 404 \u54cd\u5e94\u7801</p> </li> <li> <p><code>http_429</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de 429 \u54cd\u5e94\u7801\uff081.11.13\uff09</p> </li> <li> <p><code>non_idempotent</code></p> <p>\u901a\u5e38\uff0c\u5982\u679c\u8bf7\u6c42\u5df2\u53d1\u9001\u5230\u4e0a\u6e38\u670d\u52a1\u5668\uff081.9.13\uff09\uff0c\u5219\u5177\u6709\u975e\u5e42\u7b49\u65b9\u6cd5\uff08POST\u3001LOCK\u3001PATCH\uff09\u7684\u8bf7\u6c42\u4e0d\u4f1a\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\uff0c\u4f7f\u8fd9\u4e2a\u9009\u9879\u660e\u786e\u5141\u8bb8\u91cd\u8bd5\u8fd9\u6837\u7684\u8bf7\u6c42</p> </li> <li> <p><code>off</code></p> <p>\u7981\u7528\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668</p> </li> </ul> <p>\u6211\u4eec\u5e94\u8be5\u8bb0\u4f4f\uff0c\u53ea\u6709\u5728\u6ca1\u6709\u4efb\u4f55\u5185\u5bb9\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u80fd\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e0b\u4e00\u53f0\u670d\u52a1\u5668\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u5728\u54cd\u5e94\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\u6216\u8d85\u65f6\uff0c\u8981\u4fee\u590d\u662f\u4e0d\u53ef\u80fd\u7684\u3002</p> <p>\u8be5\u6307\u4ee4\u8fd8\u5b9a\u4e49\u4e86\u4e0e\u670d\u52a1\u5668\u8fdb\u884c\u901a\u4fe1\u7684\u4e0d\u6210\u529f\u5c1d\u8bd5\u3002<code>erorr</code>\u3001<code>timeout</code> \u548c <code>invalid_header</code> \u7684\u60c5\u51b5\u603b\u662f\u88ab\u8ba4\u4e3a\u662f\u4e0d\u6210\u529f\u7684\u5c1d\u8bd5\uff0c\u5373\u4f7f\u5b83\u4eec\u6ca1\u6709\u5728\u6307\u4ee4\u4e2d\u6307\u5b9a\u3002\u53ea\u6709\u5728\u6307\u4ee4\u4e2d\u6307\u5b9a\u4e86 <code>http_500</code>\u3001<code>http_503</code> \u548c <code>http_429</code> \u7684\u60c5\u51b5\u4e0b\uff0c\u5b83\u4eec\u624d\u88ab\u89c6\u4e3a\u4e0d\u6210\u529f\u5c1d\u8bd5\u3002<code>http_403</code> \u548c <code>http_404</code> \u7684\u60c5\u51b5\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u89c6\u4e3a\u4e0d\u6210\u529f\u5c1d\u8bd5\u3002</p> <p>\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e0b\u4e00\u53f0\u670d\u52a1\u5668\u53ef\u80fd\u53d7\u5230\u5c1d\u8bd5\u6b21\u6570\u548c\u65f6\u95f4\u7684\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_next_upstream_timeout","title":"fastcgi_next_upstream_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_next_upstream_timeout <code>time</code>; \u9ed8\u8ba4 fastcgi_next_upstream_timeout 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.5 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236\u8bf7\u6c42\u53ef\u4ee5\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u65f6\u95f4\u3002<code>0</code> \u503c\u5173\u95ed\u6b64\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_next_upstream_tries","title":"fastcgi_next_upstream_tries","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_next_upstream_tries <code>number</code>; \u9ed8\u8ba4 fastcgi_next_upstream_tries 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.5 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236\u5c06\u8bf7\u6c42\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u5c1d\u8bd5\u6b21\u6570\u3002<code>0</code> \u503c\u5173\u95ed\u6b64\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_no_cache","title":"fastcgi_no_cache","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_no_cache <code>string ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u54cd\u5e94\u4e0d\u4f1a\u4fdd\u5b58\u5230\u7f13\u5b58\u4e2d\u7684\u6761\u4ef6\u3002\u5982\u679c <code>string</code> \u53c2\u6570\u4e2d\u6709\u4e00\u4e2a\u503c\u4e0d\u4e3a\u7a7a\u4e14\u4e0d\u7b49\u4e8e <code>0</code>\uff0c\u5219\u4e0d\u4f1a\u4fdd\u5b58\u54cd\u5e94\uff1a</p> <pre><code>fastcgi_no_cache $cookie_nocache $arg_nocache$arg_comment;\nfastcgi_no_cache $http_pragma    $http_authorization;\n</code></pre> <p>\u53ef\u4ee5\u4e0e fastcgi_cache_bypass \u6307\u4ee4\u4e00\u8d77\u4f7f\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_param","title":"fastcgi_param","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_param <code>parameter value [if_not_empty]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u5e94\u4f20\u9012\u7ed9 FastCGI \u670d\u52a1\u5668\u7684 <code>parameter</code> (\u53c2\u6570)\u3002\u8be5\u503c\u53ef\u4ee5\u5305\u542b\u6587\u672c\u3001\u53d8\u91cf\u53ca\u5176\u7ec4\u5408\u3002\u5f53\u4e14\u4ec5\u5f53\u5728\u5f53\u524d\u7ea7\u522b\u4e0a\u6ca1\u6709\u5b9a\u4e49 fastcgi_param \u6307\u4ee4\u65f6\uff0c\u8fd9\u4e9b\u6307\u4ee4\u624d\u4ece\u524d\u4e00\u7ea7\u7ee7\u627f\u3002</p> <p>\u4ee5\u4e0b\u793a\u4f8b\u5c55\u793a\u4e86 PHP \u7684\u6700\u5c0f\u8981\u6c42\u914d\u7f6e\uff1a</p> <pre><code>fastcgi_param SCRIPT_FILENAME /home/www/scripts/php$fastcgi_script_name;\nfastcgi_param QUERY_STRING    $query_string;\n</code></pre> <p><code>SCRIPT_FILENAME</code> \u53c2\u6570\u5728 PHP \u4e2d\u7528\u4e8e\u786e\u5b9a\u811a\u672c\u540d\u79f0\uff0c<code>QUERY_STRING</code> \u53c2\u6570\u7528\u4e8e\u4f20\u9012\u8bf7\u6c42\u53c2\u6570\u3002</p> <p>\u5bf9\u4e8e\u5904\u7406 POST \u8bf7\u6c42\u7684\u811a\u672c\uff0c\u8fd8\u9700\u8981\u4ee5\u4e0b\u4e09\u4e2a\u53c2\u6570\uff1a</p> <pre><code>fastcgi_param REQUEST_METHOD  $request_method;\nfastcgi_param CONTENT_TYPE    $content_type;\nfastcgi_param CONTENT_LENGTH  $content_length;\n</code></pre> <p>\u5982\u679c PHP \u4f7f\u7528\u4e86 <code>--enable-force-cgi-redirect</code> \u914d\u7f6e\u53c2\u6570\u6784\u5efa\uff0c\u5219\u8fd8\u5e94\u8be5\u4f7f\u7528\u503c <code>200</code> \u4f20\u9012 <code>REDIRECT_STATUS</code> \u53c2\u6570\uff1a</p> <pre><code>fastcgi_param REDIRECT_STATUS 200;\n</code></pre> <p>\u5982\u679c\u8be5\u6307\u4ee4\u662f\u901a\u8fc7 <code>if_not_empty</code>\uff081.1.11\uff09\u6307\u5b9a\u7684\uff0c\u90a3\u4e48\u53ea\u6709\u5f53\u5b83\u7684\u503c\u4e0d\u4e3a\u7a7a\u65f6\uff0c\u8fd9\u4e2a\u53c2\u6570\u624d\u4f1a\u88ab\u4f20\u9012\u7ed9\u670d\u52a1\u5668\uff1a</p> <pre><code>fastcgi_param HTTPS           $https if_not_empty;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_pass","title":"fastcgi_pass","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_pass <code>address</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e FastCGI \u670d\u52a1\u5668\u7684\u5730\u5740\u3002\u8be5\u5730\u5740\u53ef\u4ee5\u6307\u5b9a\u4e3a\u57df\u540d\u6216 IP \u5730\u5740\uff0c\u4ee5\u53ca\u7aef\u53e3\uff1a</p> <pre><code>fastcgi_pass localhost:9000;\n</code></pre> <p>\u6216\u8005\u4f5c\u4e3a UNIX \u57df\u5957\u63a5\u5b57\u8def\u5f84\uff1a</p> <pre><code>fastcgi_pass unix:/tmp/fastcgi.socket;\n</code></pre> <p>\u5982\u679c\u57df\u540d\u89e3\u6790\u4e3a\u591a\u4e2a\u5730\u5740\uff0c\u5219\u6240\u6709\u8fd9\u4e9b\u5730\u5740\u90fd\u5c06\u4ee5\u5faa\u73af\u65b9\u5f0f\u4f7f\u7528\u3002\u53e6\u5916\uff0c\u5730\u5740\u53ef\u4ee5\u88ab\u6307\u5b9a\u4e3a\u670d\u52a1\u5668\u7ec4\u3002</p> <p>\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5730\u5740\u88ab\u6307\u5b9a\u4e3a\u57df\u540d\uff0c\u5219\u5728\u6240\u63cf\u8ff0\u7684\u670d\u52a1\u5668\u7ec4\u4e2d\u641c\u7d22\u540d\u79f0\uff0c\u5982\u679c\u672a\u627e\u5230\uff0c\u5219\u4f7f\u7528\u89e3\u6790\u5668\u6765\u786e\u5b9a\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_pass_header","title":"fastcgi_pass_header","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_pass_header <code>field</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5141\u8bb8\u4ece FastCGI \u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u4f20\u9012\u9690\u85cf\u7981\u7528\u7684\u5934\u5b57\u6bb5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_pass_request_body","title":"fastcgi_pass_request_body","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_pass_request_body <code>on</code> | <code>off</code>; \u9ed8\u8ba4 fastcgi_pass_request_body on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u793a\u662f\u5426\u5c06\u539f\u59cb\u8bf7\u6c42\u4e3b\u4f53\u4f20\u9012\u7ed9 FastCGI \u670d\u52a1\u5668\u3002\u53e6\u8bf7\u53c2\u9605 fastcgi_pass_request_headers \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_pass_request_headers","title":"fastcgi_pass_request_headers","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_pass_request_headers <code>on</code> | <code>off</code>; \u9ed8\u8ba4 fastcgi_pass_request_headers on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u793a\u539f\u59cb\u8bf7\u6c42\u7684\u5934\u5b57\u6bb5\u662f\u5426\u4f20\u9012\u7ed9 FastCGI \u670d\u52a1\u5668\u3002\u53e6\u8bf7\u53c2\u9605 fastcgi_pass_request_body \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_read_timeout","title":"fastcgi_read_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_read_timeout <code>time</code>; \u9ed8\u8ba4 fastcgi_read_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4ece FastCGI \u670d\u52a1\u5668\u8bfb\u53d6\u54cd\u5e94\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u8d85\u65f6\u8bbe\u7f6e\u5728\u4e24\u6b21\u8fde\u7eed\u7684\u8bfb\u64cd\u4f5c\u4e4b\u95f4\uff0c\u800c\u4e0d\u662f\u4f20\u8f93\u6574\u4e2a\u54cd\u5e94\u7684\u8fc7\u7a0b\u3002\u5982\u679c FastCGI \u670d\u52a1\u5668\u5728\u6b64\u65f6\u95f4\u5185\u6ca1\u6709\u53d1\u9001\u4efb\u4f55\u5185\u5bb9\uff0c\u5219\u8fde\u63a5\u5c06\u88ab\u5173\u95ed\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_request_buffering","title":"fastcgi_request_buffering","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_request_buffering <code>on</code> | <code>off</code>; \u9ed8\u8ba4 fastcgi_request_buffering on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.11 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u6216\u7981\u7528\u5ba2\u6237\u7aef\u8bf7\u6c42\u4f53\u7f13\u51b2\u3002</p> <p>\u542f\u7528\u7f13\u51b2\u65f6\uff0c\u5728\u5c06\u8bf7\u6c42\u53d1\u9001\u5230 FastCGI \u670d\u52a1\u5668\u4e4b\u524d\uff0c\u5c06\u4ece\u5ba2\u6237\u7aef\u8bfb\u53d6\u6574\u4e2a\u8bf7\u6c42\u4f53\u3002</p> <p>\u5f53\u7f13\u51b2\u88ab\u7981\u7528\u65f6\uff0c\u8bf7\u6c42\u4f53\u5728\u6536\u5230\u65f6\u7acb\u5373\u53d1\u9001\u5230 FastCGI \u670d\u52a1\u5668\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c nginx \u5df2\u7ecf\u5f00\u59cb\u53d1\u9001\u8bf7\u6c42\u4f53\uff0c\u5219\u8bf7\u6c42\u4e0d\u80fd\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_send_lowat","title":"fastcgi_send_lowat","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_send_lowat <code>size</code>; \u9ed8\u8ba4 fastcgi_send_lowat 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5982\u679c\u6307\u4ee4\u8bbe\u7f6e\u4e3a\u975e\u96f6\u503c\uff0c\u5219 nginx \u5c06\u5c1d\u8bd5\u901a\u8fc7\u4f7f\u7528 kqueue \u65b9\u5f0f\u7684 <code>NOTE_LOWAT</code> \u6807\u5fd7\u6216 <code>SO_SNDLOWAT</code> \u5957\u63a5\u5b57\u9009\u9879\uff0c\u4ee5\u6307\u5b9a\u7684 <code>size</code>\uff08\u5927\u5c0f\uff09\u6765\u6700\u5c0f\u5316\u4f20\u51fa\u8fde\u63a5\u5230 FastCGI \u670d\u52a1\u5668\u4e0a\u7684\u53d1\u9001\u64cd\u4f5c\u6b21\u6570\u3002</p> <p>\u8be5\u6307\u4ee4\u5728 Linux\u3001Solaris \u548c Windows \u4e0a\u88ab\u5ffd\u7565\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_send_timeout","title":"fastcgi_send_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_send_timeout <code>time</code>; \u9ed8\u8ba4 fastcgi_send_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u5411 FastCGI \u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u8d85\u65f6\u8bbe\u7f6e\u5728\u4e24\u6b21\u8fde\u7eed\u5199\u5165\u64cd\u4f5c\u4e4b\u95f4\uff0c\u800c\u4e0d\u662f\u4f20\u8f93\u6574\u4e2a\u8bf7\u6c42\u7684\u8fc7\u7a0b\u3002\u5982\u679c FastCGI \u670d\u52a1\u5668\u5728\u6b64\u65f6\u95f4\u5185\u6ca1\u6709\u6536\u5230\u4efb\u4f55\u5185\u5bb9\uff0c\u5219\u8fde\u63a5\u5c06\u5173\u95ed\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_split_path_info","title":"fastcgi_split_path_info","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_split_path_info <code>regex</code>; \u9ed8\u8ba4 fastcgi_send_timeout 60s; \u4e0a\u4e0b\u6587 location <p>\u5b9a\u4e49\u4e00\u4e2a\u6355\u83b7 <code>$fastcgi_path_info</code> \u53d8\u91cf\u503c\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u5e94\u8be5\u6709\u4e24\u4e2a\u6355\u83b7\uff1a\u7b2c\u4e00\u4e2a\u4e3a <code>$fastcgi_script_name</code> \u53d8\u91cf\u7684\u503c\uff0c\u7b2c\u4e8c\u4e2a\u4e3a <code>$fastcgi_path_info</code> \u53d8\u91cf\u7684\u503c\u3002\u4f8b\u5982\u4ee5\u4e0b\u8bbe\u7f6e</p> <pre><code>location ~ ^(.+\\.php)(.*)$ {\nfastcgi_split_path_info       ^(.+\\.php)(.*)$;\nfastcgi_param SCRIPT_FILENAME /path/to/php$fastcgi_script_name;\nfastcgi_param PATH_INFO       $fastcgi_path_info;\n</code></pre> <p>\u548c <code>/show.php/article/0001</code> \u8bf7\u6c42\uff0c<code>SCRIPT_FILENAME</code> \u53c2\u6570\u7b49\u4e8e <code>/path/to/php/show.php</code>\uff0c\u5e76\u4e14 <code>PATH_INFO</code> \u53c2\u6570\u7b49\u4e8e <code>/article/0001</code>\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_store","title":"fastcgi_store","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_store <code>on</code> | <code>off</code> | <code>string</code>; \u9ed8\u8ba4 fastcgi_store off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u5c06\u6587\u4ef6\u4fdd\u5b58\u5230\u78c1\u76d8\u3002<code>on</code> \u53c2\u6570\u5c06\u6587\u4ef6\u4fdd\u5b58\u4e3a\u4e0e\u6307\u4ee4 alias \u6216 root \u76f8\u5bf9\u5e94\u7684\u8def\u5f84\u3002<code>off</code> \u53c2\u6570\u7981\u7528\u4fdd\u5b58\u6587\u4ef6\u3002\u53e6\u5916\uff0c\u53ef\u4ee5\u4f7f\u7528\u5e26\u53d8\u91cf\u7684\u5b57\u7b26\u4e32\u663e\u5f0f\u8bbe\u7f6e\u6587\u4ef6\u540d\uff1a</p> <p><pre><code>fastcgi_store /data/www$original_uri;\n</code></pre> \u6587\u4ef6\u7684\u4fee\u6539\u65f6\u95f4\u6839\u636e\u6536\u5230\u7684 <code>Last-Modified</code> \u54cd\u5e94\u5934\u5b57\u6bb5\u8bbe\u7f6e\u3002\u9996\u5148\u5c06\u54cd\u5e94\u5199\u5165\u4e34\u65f6\u6587\u4ef6\uff0c\u7136\u540e\u91cd\u547d\u540d\u8be5\u6587\u4ef6\u3002\u4ece 0.8.9 \u7248\u672c\u5f00\u59cb\uff0c\u4e34\u65f6\u6587\u4ef6\u548c\u6301\u4e45\u5b58\u50a8\u53ef\u4ee5\u653e\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002\u4f46\u662f\uff0c\u8bf7\u6ce8\u610f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6587\u4ef6\u5c06\u8de8\u4e24\u4e2a\u6587\u4ef6\u7cfb\u7edf\u8fdb\u884c\u590d\u5236\uff0c\u800c\u4e0d\u662f\u7b80\u5355\u5730\u8fdb\u884c\u91cd\u547d\u540d\u64cd\u4f5c\u3002\u56e0\u6b64\u5efa\u8bae\uff0c\u5bf9\u4e8e\u4efb\u4f55\u7ed9\u5b9a\u4f4d\u7f6e\uff0c\u4fdd\u5b58\u7684\u6587\u4ef6\u548c\u7531 fastcgi_temp_path \u6307\u4ee4\u8bbe\u7f6e\u7684\u4fdd\u5b58\u4e34\u65f6\u6587\u4ef6\u7684\u76ee\u5f55\u90fd\u653e\u5728\u540c\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002</p> <p>\u8be5\u6307\u4ee4\u53ef\u7528\u4e8e\u521b\u5efa\u9759\u6001\u4e0d\u53ef\u66f4\u6539\u6587\u4ef6\u7684\u672c\u5730\u526f\u672c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>location /images/ {\nroot                 /data/www;\nerror_page           404 = /fetch$uri;\n}\n\nlocation /fetch/ {\ninternal;\n\nfastcgi_pass         backend:9000;\n...\n\nfastcgi_store        on;\nfastcgi_store_access user:rw group:rw all:r;\nfastcgi_temp_path    /data/temp;\n\nalias                /data/www/;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_store_access","title":"fastcgi_store_access","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_store_access <code>users:permissions ...</code>; \u9ed8\u8ba4 fastcgi_store_access user:rw; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u4e3a\u65b0\u521b\u5efa\u7684\u6587\u4ef6\u548c\u76ee\u5f55\u8bbe\u7f6e\u8bbf\u95ee\u6743\u9650\uff0c\u4f8b\u5982\uff1a</p> <pre><code>fastcgi_store_access user:rw group:rw all:r;\n</code></pre> <p>\u5982\u679c\u6307\u5b9a\u4e86\u4efb\u4f55\u7ec4\u6216\u6240\u6709\u8bbf\u95ee\u6743\u9650\uff0c\u5219\u53ef\u4ee5\u7701\u7565\u7528\u6237\u6743\u9650</p> <pre><code>fastcgi_store_access group:rw all:r;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_temp_file_write_size","title":"fastcgi_temp_file_write_size","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_temp_file_write_size <code>size</code>; \u9ed8\u8ba4 fastcgi_temp_file_write_size 8k \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u5f53\u5f00\u542f\u7f13\u51b2 FastCGI \u670d\u52a1\u5668\u54cd\u5e94\u5230\u4e34\u65f6\u6587\u4ef6\u65f6\uff0c\u9650\u5236\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u7684\u6570\u636e <code>size</code>\uff08\u5927\u5c0f\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5927\u5c0f\u53d7 fastcgi_buffer_size \u548c fastcgi_buffers \u6307\u4ee4\u8bbe\u7f6e\u7684\u4e24\u4e2a\u7f13\u51b2\u533a\u9650\u5236\u3002\u4e34\u65f6\u6587\u4ef6\u7684\u6700\u5927\u5927\u5c0f\u7531 fastcgi_max_temp_file_size \u6307\u4ee4\u8bbe\u7f6e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi_temp_path","title":"fastcgi_temp_path","text":"- \u8bf4\u660e \u8bed\u6cd5 fastcgi_temp_path <code>path [level1 [level2 [level3]]]</code>; \u9ed8\u8ba4 astcgi_temp_path fastcgi_temp; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e00\u4e2a\u76ee\u5f55\uff0c\u7528\u4e8e\u5b58\u50a8\u4ece FastCGI \u670d\u52a1\u5668\u63a5\u6536\u5230\u7684\u6570\u636e\u7684\u4e34\u65f6\u6587\u4ef6\u3002\u6307\u5b9a\u76ee\u5f55\u4e0b\u6700\u591a\u53ef\u6709\u4e09\u7ea7\u5b50\u76ee\u5f55\u3002\u4f8b\u5982\u4ee5\u4e0b\u914d\u7f6e</p> <pre><code>fastcgi_temp_path /spool/nginx/fastcgi_temp 1 2;\n</code></pre> <p>\u4e34\u65f6\u6587\u4ef6\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>/spool/nginx/fastcgi_temp/7/45/00000123457\n</code></pre> <p>\u53e6\u8bf7\u53c2\u89c1 fastcgi_cache_path \u6307\u4ee4\u7684 <code>use_temp_path</code> \u53c2\u6570\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#fastcgi","title":"\u4f20\u53c2\u5230 FastCGI \u670d\u52a1\u5668","text":"<p>HTTP \u8bf7\u6c42\u5934\u5b57\u6bb5\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9 FastCGI \u670d\u52a1\u5668\u3002\u5728\u4f5c\u4e3a FastCGI \u670d\u52a1\u5668\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u548c\u811a\u672c\u4e2d\uff0c\u8fd9\u4e9b\u53c2\u6570\u901a\u5e38\u4f5c\u4e3a\u73af\u5883\u53d8\u91cf\u63d0\u4f9b\u3002\u4f8b\u5982\uff0c<code>User-Agent</code> \u5934\u5b57\u6bb5\u4f5c\u4e3a <code>HTTP_USER_AGENT</code> \u53c2\u6570\u4f20\u9012\u3002\u9664 HTTP \u8bf7\u6c42\u5934\u5b57\u6bb5\u5916\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528 fastcgi_param \u6307\u4ee4\u4f20\u9012\u4efb\u610f\u53c2\u6570\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#_3","title":"\u5185\u5d4c\u53d8\u91cf","text":"<p><code>ngx_http_fastcgi_module</code> \u6a21\u5757\u652f\u6301\u5728 fastcgi_param \u6307\u4ee4\u8bbe\u7f6e\u53c2\u6570\u65f6\u4f7f\u7528\u5185\u5d4c\u53d8\u91cf\uff1a</p> <ul> <li> <p><code>$fastcgi_script_name</code></p> <p>\u8bf7\u6c42 URI\uff0c\u6216\u8005\u5982\u679c URI \u4ee5\u659c\u6760\u7ed3\u5c3e\uff0c\u5219\u8bf7\u6c42 URI \u7684\u7d22\u5f15\u6587\u4ef6\u540d\u79f0\u7531 fastcgi_index \u6307\u4ee4\u914d\u7f6e\u3002\u8be5\u53d8\u91cf\u53ef\u7528\u4e8e\u8bbe\u7f6e <code>SCRIPT_FILENAME</code> \u548c <code>PATH_TRANSLATED</code> \u53c2\u6570\uff0c\u4ee5\u786e\u5b9a PHP \u4e2d\u7684\u811a\u672c\u540d\u79f0\u3002\u4f8b\u5982\uff0c\u5bf9 <code>/info/</code> \u8bf7\u6c42\u7684\u6307\u4ee4\u8bbe\u7f6e</p> <pre><code>fastcgi_index index.php;\nfastcgi_param SCRIPT_FILENAME /home/www/scripts/php$fastcgi_script_name;\n</code></pre> <p><code>SCRIPT_FILENAME</code> \u53c2\u6570\u7b49\u4e8e <code>/home/www/scripts/php/info/index.php</code>\u3002</p> <p>\u4f7f\u7528 fastcgi_split_path_info \u6307\u4ee4\u65f6\uff0c<code>$fastcgi_script_name</code> \u53d8\u91cf\u7b49\u4e8e\u6307\u4ee4\u8bbe\u7f6e\u7684\u7b2c\u4e00\u4e2a\u6355\u83b7\u503c\u3002</p> </li> <li> <p><code>$fastcgi_path_info</code></p> <p>\u7531 fastcgi_split_path_info \u6307\u4ee4\u8bbe\u7f6e\u7684\u7b2c\u4e8c\u4e2a\u6355\u83b7\u503c\u3002\u8fd9\u4e2a\u53d8\u91cf\u53ef\u4ee5\u7528\u6765\u8bbe\u7f6e <code>PATH_INFO</code> \u53c2\u6570\u3002</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_fastcgi_module/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_fastcgi_module.html</p>"},{"location":"Modules-reference/http/ngx_http_flv_module/","title":"ngx_http_flv_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>flv</li> </ul> </li> </ul> <p><code>ngx_http_flv_module</code> \u6a21\u5757\u4e3a Flash \u89c6\u9891\uff08FLV\uff09\u6587\u4ef6\u63d0\u4f9b\u4f2a\u6d41\u670d\u52a1\u7aef\u652f\u6301\u3002</p> <p>\u5b83\u901a\u8fc7\u53d1\u9001\u56de\u6587\u4ef6\u7684\u5185\u5bb9\u6765\u5904\u7406\u8bf7\u6c42 URI \u67e5\u8be2\u5b57\u7b26\u4e32\u4e2d\u5e26\u6709\u7279\u5b9a <code>start</code> \u53c2\u6570\u7684\u8bf7\u6c42\uff0c\u6587\u4ef6\u7684\u5185\u5bb9\u4ece\u8bf7\u6c42\u5b57\u8282\u504f\u79fb\u5f00\u59cb\u7684\u4e14 FLV \u5934\u4e3a\u524d\u7f00\u3002</p> <p>\u8be5\u6a21\u5757\u4e0d\u662f\u9ed8\u8ba4\u6784\u7684\uff0c\u60a8\u53ef\u4ee5\u5728\u6784\u5efa\u65f6\u4f7f\u7528 <code>--with-http_flv_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_flv_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location ~ \\.flv$ {\nflv;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_flv_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_flv_module/#flv","title":"flv","text":"- \u8bf4\u660e \u8bed\u6cd5 flv; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 location <p>\u5f00\u542f\u9488\u5bf9 <code>location</code> \u7684\u6a21\u5757\u5904\u7406\u3002</p>"},{"location":"Modules-reference/http/ngx_http_flv_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_flv_module.html</p>"},{"location":"Modules-reference/http/ngx_http_geo_module/","title":"ngx_http_geo_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>geo</li> </ul> </li> </ul> <p><code>ngx_http_geo_module</code> \u6a21\u5757\u521b\u5efa\u5e26\u503c\u53d8\u91cf\u9700\u4f9d\u8d56\u5ba2\u6237\u7aef IP \u5730\u5740\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_geo_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>geo $geo {\ndefault        0;\n\n127.0.0.1      2;\n192.168.1.0/24 1;\n10.1.0.0/16    1;\n\n::1            2;\n2001:0db8::/32 1;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_geo_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_geo_module/#geo","title":"geo","text":"- \u8bf4\u660e \u8bed\u6cd5 geo <code>[$address] $variable { ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u63cf\u8ff0\u6307\u5b9a\u53d8\u91cf\u7684\u503c\u5bf9\u5ba2\u6237\u7aef IP \u5730\u5740\u7684\u4f9d\u8d56\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5730\u5740\u6765\u81ea <code>$remote_addr</code> \u53d8\u91cf\uff0c\u4f46\u4e5f\u53ef\u4ee5\u4ece\u53e6\u4e00\u4e2a\u53d8\u91cf\uff080.7.27\uff09\u4e2d\u83b7\u53d6\uff0c\u4f8b\u5982\uff1a</p> <pre><code>geo $arg_remote_addr $geo {\n...;\n}\n</code></pre> <p>\u7531\u4e8e\u53d8\u91cf\u4ec5\u5728\u4f7f\u7528\u65f6\u624d\u751f\u6548\uff0c\u56e0\u6b64\u5373\u4f7f\u5b58\u5728\u5927\u91cf\u5df2\u58f0\u660e\u7684 <code>geo</code> \u53d8\u91cf\u4e5f\u4e0d\u4f1a\u589e\u52a0\u8bf7\u6c42\u5904\u7406\u5f00\u9500\u3002</p> <p>\u5982\u679c\u53d8\u91cf\u7684\u503c\u4e0d\u662f\u6709\u6548\u7684 IP \u5730\u5740\uff0c\u5219\u4f7f\u7528 <code>255.255.255.255</code> \u5730\u5740\u3002</p> <p>\u4ece1.3.10 \u7248\u672c\u548c 1.2.7 \u7248\u672c\u5f00\u59cb\u652f\u6301 IPv6 \u524d\u7f00\u3002</p> <p>\u4e5f\u652f\u6301\u4ee5\u4e0b\u7279\u6b8a\u53c2\u6570\uff1a</p> <ul> <li> <p><code>delete</code></p> <p>\u5220\u9664\u6307\u5b9a\u7684\u7f51\u7edc\uff080.7.23\uff09\u3002</p> </li> <li> <p><code>default</code></p> <p>\u5982\u679c\u5ba2\u6237\u7aef\u5730\u5740\u4e0e\u6240\u6709\u6307\u5b9a\u5730\u5740\u90fd\u4e0d\u5339\u914d\uff0c\u5219\u5c06\u8bbe\u7f6e\u4e3a\u8be5\u53d8\u91cf\u7684\u503c\u3002\u5f53\u4ee5 CIDR \u8868\u793a\u6cd5\u6307\u5b9a\u5730\u5740\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>0.0.0.0/0</code> \u548c <code>::/0</code> \u4ee3\u66ff\u9ed8\u8ba4\u503c\u3002\u672a\u6307\u5b9a\u9ed8\u8ba4\u503c\u65f6\uff0c\u9ed8\u8ba4\u503c\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002</p> </li> <li> <p><code>include</code></p> <p>\u5305\u542b\u4e00\u4e2a\u5305\u542b\u5730\u5740\u548c\u503c\u7684\u6587\u4ef6\u3002\u53ef\u5305\u542b\u591a\u4e2a\u3002</p> </li> <li> <p><code>proxy</code></p> <p>\u5b9a\u4e49\u53ef\u4fe1\u5730\u5740\uff080.8.7\u30010.7.63\uff09\u3002\u5f53\u8bf7\u6c42\u6765\u81ea\u53ef\u4fe1\u5730\u5740\u65f6\uff0c\u5c06\u4f7f\u7528\u6765\u81ea <code>X-Forwarded-For</code> \u8bf7\u6c42\u5934\u5b57\u6bb5\u7684\u5730\u5740\u3002\u4e0e\u5e38\u89c4\u5730\u5740\u76f8\u6bd4\uff0c\u53ef\u4fe1\u5730\u5740\u662f\u6309\u987a\u5e8f\u68c0\u67e5\u7684\u3002</p> <p>\u4ece 1.3.0 \u7248\u672c\u548c 1.2.1 \u7248\u672c\u5f00\u59cb\u652f\u6301 IPv6 \u5730\u5740\u3002</p> </li> <li> <p><code>proxy_recursive</code></p> <p>\u542f\u7528\u9012\u5f52\u5730\u5740\u641c\u7d22\uff081.3.0\u30011.2.1\uff09\u3002\u5982\u679c\u9012\u5f52\u641c\u7d22\u88ab\u7981\u7528\uff0c\u5c06\u4f7f\u7528\u5728 <code>X-Forwarded-For</code> \u4e2d\u53d1\u9001\u7684\u6700\u540e\u4e00\u4e2a\u5730\u5740\uff0c\u800c\u4e0d\u662f\u5339\u914d\u5176\u4e2d\u4e00\u4e2a\u53ef\u4fe1\u5730\u5740\u7684\u539f\u59cb\u5ba2\u6237\u7aef\u5730\u5740\u3002\u5982\u679c\u542f\u7528\u9012\u5f52\u641c\u7d22\uff0c\u5219\u5c06\u4f7f\u7528\u5728 <code>X-Forwarded-For</code> \u4e2d\u53d1\u9001\u7684\u6700\u540e\u4e00\u4e2a\u4e0d\u53ef\u4fe1\u5730\u5740\uff0c\u800c\u4e0d\u662f\u5339\u914d\u5176\u4e2d\u4e00\u4e2a\u53ef\u4fe1\u5730\u5740\u7684\u539f\u59cb\u5ba2\u6237\u7aef\u5730\u5740\u3002 </p> </li> <li> <p><code>ranges</code></p> <p>\u8868\u793a\u5730\u5740\u88ab\u6307\u5b9a\u4e3a\u8303\u56f4\u5f62\u5f0f\uff080.7.23\uff09\u3002\u8fd9\u4e2a\u53c2\u6570\u5e94\u8be5\u653e\u5728\u9996\u4f4d\u3002\u60f3\u8981\u52a0\u5feb\u52a0\u8f7d\u5730\u7406\u533a\u57df\uff0c\u5730\u5740\u5e94\u6309\u5347\u5e8f\u6392\u5217\u3002</p> </li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>geo $country {\ndefault        ZZ;\ninclude        conf/geo.conf;\ndelete         127.0.0.0/16;\nproxy          192.168.100.0/24;\nproxy          2001:0db8::/32;\n\n127.0.0.0/24   US;\n127.0.0.1/32   RU;\n10.1.0.0/16    RU;\n192.168.1.0/24 UK;\n}\n</code></pre> <p><code>conf/geo.conf</code> \u6587\u4ef6\u53ef\u80fd\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>10.2.0.0/16    RU;\n192.168.2.0/24 RU;\n</code></pre> <p>\u4f7f\u7528\u6700\u660e\u786e\u5339\u914d\u7684\u503c\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e 127.0.0.1 \u5730\u5740\uff0c\u5c06\u9009\u62e9 <code>RU</code> \u503c\uff0c\u800c\u4e0d\u662f <code>US</code>\u3002</p> <p>\u8303\u56f4\u793a\u4f8b\uff1a</p> <pre><code>geo $country {\nranges;\ndefault                   ZZ;\n127.0.0.0-127.0.0.0       US;\n127.0.0.1-127.0.0.1       RU;\n127.0.0.1-127.0.0.255     US;\n10.1.0.0-10.1.255.255     RU;\n192.168.1.0-192.168.1.255 UK;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_geo_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_geo_module.html</p>"},{"location":"Modules-reference/http/ngx_http_geoip_module/","title":"ngx_http_geoip_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>geoip_country</li> <li>geoip_city</li> <li>geoip_org</li> <li>geoip_proxy</li> <li>geoip_proxy_recursive</li> </ul> </li> </ul> <p><code>ngx_http_geoip_module</code> \u6a21\u5757\uff080.8.6+\uff09\u4f7f\u7528\u9884\u7f16\u8bd1\u7684 MaxMind \u6570\u636e\u5e93\uff0c\u5176\u521b\u5efa\u5e26\u503c\u7684\u53d8\u91cf\u4f9d\u8d56\u5ba2\u6237\u7aef IP \u5730\u5740\u3002</p> <p>\u5f53\u4f7f\u7528\u652f\u6301 IPv6 \u7684\u6570\u636e\u5e93\u65f6\uff081.3.12\u30011.2.7\uff09\uff0cIPv4 \u5730\u5740\u5c06\u88ab\u89c6\u4e3a IPv4 \u6620\u5c04\u7684 IPv6 \u5730\u5740\u3002</p> <p>\u6b64\u6a21\u5757\u4e0d\u662f\u9ed8\u8ba4\u6784\u5efa\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>--with-http_geoip_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p>\u8be5\u6a21\u5757\u9700\u8981 MaxMind GeoIP \u5e93\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_geoip_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>http {\ngeoip_country         GeoIP.dat;\ngeoip_city            GeoLiteCity.dat;\ngeoip_proxy           192.168.100.0/24;\ngeoip_proxy           2001:0db8::/32;\ngeoip_proxy_recursive on;\n...\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_geoip_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_geoip_module/#geoip_country","title":"geoip_country","text":"- \u8bf4\u660e \u8bed\u6cd5 geoip_country <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u6307\u5b9a\u4e00\u4e2a\u7528\u4e8e\u6839\u636e\u5ba2\u6237\u7aef IP \u5730\u5740\u786e\u5b9a\u56fd\u5bb6\u7684\u6570\u636e\u5e93\u3002\u4f7f\u7528\u6b64\u6570\u636e\u5e93\u65f6\uff0c\u4ee5\u4e0b\u53d8\u91cf\u53ef\u7528\uff1a</p> <ul> <li> <p><code>$geoip_country_code</code></p> <p>\u53cc\u5b57\u6bcd\u56fd\u5bb6\u4ee3\u7801\uff0c\u4f8b\u5982 <code>RU</code>\u3001<code>US</code></p> </li> <li> <p><code>$geoip_country_code3</code></p> <p>\u4e09\u4e2a\u5b57\u6bcd\u7684\u56fd\u5bb6\u4ee3\u7801\uff0c\u4f8b\u5982 <code>RUS</code>\u3001<code>USA</code></p> </li> <li> <p><code>$geoip_country_name</code></p> <p>\u56fd\u5bb6\u540d\u79f0\uff0c\u4f8b\u5982 <code>Russian Federation</code>\u3001<code>United States</code></p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_geoip_module/#geoip_city","title":"geoip_city","text":"- \u8bf4\u660e \u8bed\u6cd5 geoip_city <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u6307\u5b9a\u4e00\u4e2a\u7528\u4e8e\u6839\u636e\u5ba2\u6237\u7aef IP \u5730\u5740\u786e\u5b9a\u56fd\u5bb6\u3001\u5730\u533a\u548c\u57ce\u5e02\u7684\u6570\u636e\u5e93\u3002\u4f7f\u7528\u6b64\u6570\u636e\u5e93\u65f6\uff0c\u4ee5\u4e0b\u53d8\u91cf\u53ef\u7528\uff1a</p> <ul> <li> <p><code>$geoip_area_code</code></p> <p>\u7535\u8bdd\u533a\u53f7\uff08\u4ec5\u9650\u7f8e\u56fd\uff09</p> <p>\u7531\u4e8e\u76f8\u5e94\u7684\u6570\u636e\u5e93\u5b57\u6bb5\u5df2\u5f03\u7528\uff0c\u56e0\u6b64\u6b64\u53d8\u91cf\u53ef\u80fd\u5305\u542b\u8fc7\u65f6\u7684\u4fe1\u606f</p> </li> <li> <p><code>$geoip_city_continent_code</code></p> <p>\u53cc\u5b57\u6bcd\u7684\u5927\u9646\u7801\uff0c\u4f8b\u5982 <code>EU</code>\u3001<code>NA</code></p> </li> <li> <p><code>$geoip_city_country_code</code></p> <p>\u53cc\u5b57\u6bcd\u56fd\u5bb6\u4ee3\u7801\uff0c\u4f8b\u5982 <code>RU</code>\u3001<code>US</code></p> </li> <li> <p><code>$geoip_city_country_code3</code></p> <p>\u4e09\u4e2a\u5b57\u6bcd\u7684\u56fd\u5bb6\u4ee3\u7801\uff0c\u4f8b\u5982 <code>RUS</code>\u3001<code>USA</code></p> </li> <li> <p><code>$geoip_city_country_name</code></p> <p>\u56fd\u5bb6\u540d\u79f0\uff0c\u4f8b\u5982 <code>Russian Federation</code>\u3001<code>United States</code></p> </li> <li> <p><code>$geoip_dma_code</code></p> <p>\u7f8e\u56fd\u7684 DMA \u5730\u533a\u4ee3\u7801\uff08\u4e5f\u79f0\u4e3a**\u57ce\u5e02\u4ee3\u7801**\uff09\uff0c\u6839\u636e Google AdWords API \u4e2d\u7684\u5730\u7406\u4f4d\u7f6e\u5b9a\u4f4d</p> </li> <li> <p><code>$geoip_latitude</code></p> <p>\u7eac\u5ea6</p> </li> <li> <p><code>$geoip_longitude</code></p> <p>\u7ecf\u5ea6</p> </li> <li> <p><code>$geoip_region</code></p> <p>\u53cc\u7b26\u53f7\u56fd\u5bb6\u5730\u533a\u4ee3\u7801\uff08\u5730\u533a\u3001\u9886\u571f\u3001\u5dde\u3001\u7701\u3001\u8054\u90a6\u571f\u5730\u7b49\uff09\uff0c\u4f8b\u5982 <code>48</code>\u3001<code>DC</code></p> </li> <li> <p><code>$geoip_region_name</code></p> <p>\u56fd\u5bb6\u5730\u533a\u540d\u79f0\uff08\u5730\u533a\uff0c\u9886\u571f\uff0c\u5dde\uff0c\u7701\uff0c\u8054\u90a6\u571f\u5730\u7b49\uff09\uff0c\u4f8b\u5982 <code>Moscow City</code>\u3001<code>District of Columbia</code></p> </li> <li> <p><code>$geoip_city</code></p> <p>\u57ce\u5e02\u540d\u79f0\uff0c\u4f8b\u5982 <code>Moscow</code>\u3001<code>Washington</code></p> </li> <li> <p><code>$geoip_postal_code</code></p> <p>\u90ae\u653f\u7f16\u7801</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_geoip_module/#geoip_org","title":"geoip_org","text":"- \u8bf4\u660e \u8bed\u6cd5 geoip_org <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.0.3 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u7528\u4e8e\u6839\u636e\u5ba2\u6237\u7aef IP \u5730\u5740\u786e\u5b9a\u7ec4\u7ec7\u7684\u6570\u636e\u5e93\u3002\u4f7f\u7528\u6b64\u6570\u636e\u5e93\u65f6\uff0c\u4ee5\u4e0b\u53d8\u91cf\u53ef\u7528\uff1a</p> <ul> <li> <p><code>$geoip_org</code></p> <p>\u7ec4\u7ec7\u540d\u79f0\uff0c\u4f8b\u5982 <code>The University of Melbourne</code></p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_geoip_module/#geoip_proxy","title":"geoip_proxy","text":"- \u8bf4\u660e \u8bed\u6cd5 geoip_proxy <code>address</code> | <code>CIDR</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.3.0 \u7248\u672c\u548c 1.2.1. \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5b9a\u4e49\u53ef\u4fe1\u5730\u5740\u3002\u5f53\u8bf7\u6c42\u6765\u81ea\u53ef\u4fe1\u5730\u5740\u65f6\uff0c\u5c06\u4f7f\u7528\u6765\u81ea <code>X-Forwarded-For</code> \u8bf7\u6c42\u5934\u5b57\u6bb5\u7684\u5730\u5740\u3002</p>"},{"location":"Modules-reference/http/ngx_http_geoip_module/#geoip_proxy_recursive","title":"geoip_proxy_recursive","text":"- \u8bf4\u660e \u8bed\u6cd5 geoip_proxy_recursive <code>on</code> | <code>off</code>; \u9ed8\u8ba4 geoip_proxy_recursive off; \u4e0a\u4e0b\u6587 http \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.3.0 \u7248\u672c\u548c 1.2.1. \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5982\u679c\u9012\u5f52\u641c\u7d22\u88ab\u7981\u7528\uff0c\u90a3\u4e48\u5c06\u4f7f\u7528\u5728 <code>X-Forwarded-For</code> \u4e2d\u53d1\u9001\u7684\u6700\u540e\u4e00\u4e2a\u5730\u5740\uff0c\u800c\u4e0d\u662f\u5339\u914d\u5176\u4e2d\u4e00\u4e2a\u53ef\u4fe1\u5730\u5740\u7684\u539f\u59cb\u5ba2\u6237\u7aef\u5730\u5740\u3002\u5982\u679c\u542f\u7528\u9012\u5f52\u641c\u7d22\uff0c\u5219\u5c06\u4f7f\u7528\u5728 <code>X-Forwarded-For</code> \u4e2d\u53d1\u9001\u7684\u6700\u540e\u4e00\u4e2a\u4e0d\u53ef\u4fe1\u5730\u5740\uff0c\u800c\u4e0d\u662f\u5339\u914d\u5176\u4e2d\u4e00\u4e2a\u53ef\u4fe1\u5730\u5740\u7684\u539f\u59cb\u5ba2\u6237\u7aef\u5730\u5740\u3002</p>"},{"location":"Modules-reference/http/ngx_http_geoip_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_geoip_module.html</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/","title":"- grpc_bind","text":"<p>ngx_http_grpc_module</p> <ul> <li>\u6307\u4ee4<ul> <li>grpc_buffer_size</li> <li>grpc_connect_timeout</li> <li>grpc_hide_header</li> <li>grpc_ignore_headers</li> <li>grpc_intercept_errors</li> <li>grpc_next_upstream</li> <li>grpc_next_upstream_timeout</li> <li>grpc_next_upstream_tries</li> <li>grpc_pass</li> <li>grpc_pass_header</li> <li>grpc_read_timeout</li> <li>grpc_send_timeout</li> <li>grpc_set_header</li> <li>grpc_ssl_certificate</li> <li>grpc_ssl_certificate_key</li> <li>grpc_ssl_ciphers</li> <li>grpc_ssl_crl</li> <li>grpc_ssl_name</li> <li>grpc_ssl_password_file</li> <li>grpc_ssl_server_name</li> <li>grpc_ssl_session_reuse</li> <li>grpc_ssl_protocols</li> <li>grpc_ssl_trusted_certificate</li> <li>grpc_ssl_verify</li> <li>grpc_ssl_verify_depth</li> </ul> </li> </ul> <p><code>ngx_http_grpc_module</code> \u6a21\u5757\u5141\u8bb8\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9 gRPC \u670d\u52a1\u5668\uff081.13.10\uff09\u3002\u8be5\u6a21\u5757\u9700\u8981 ngx_http_v2_module \u6a21\u5757\u7684\u652f\u6301\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>server {\nlisten 9000 http2;\n\nlocation / {\ngrpc_pass 127.0.0.1:9000;\n}\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_bind","title":"grpc_bind","text":"- \u8bf4\u660e \u8bed\u6cd5 map <code>address [transparent ]</code> | <code>off</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8fde\u63a5\u5230\u4e00\u4e2a\u6307\u5b9a\u4e86\u672c\u5730 IP \u5730\u5740\u548c\u53ef\u9009\u7aef\u53e3\u7684 gRPC \u670d\u52a1\u5668\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002\u7279\u6b8a\u503c <code>off</code> \u53d6\u6d88\u4ece\u4e0a\u5c42\u914d\u7f6e\u7ea7\u522b\u7ee7\u627f\u7684 <code>grpc_bind</code> \u6307\u4ee4\u7684\u4f5c\u7528\uff0c\u5176\u5141\u8bb8\u7cfb\u7edf\u81ea\u52a8\u5206\u914d\u672c\u5730 IP \u5730\u5740\u548c\u7aef\u53e3\u3002</p> <p><code>transparent</code> \u53c2\u6570\u5141\u8bb8\u51fa\u7ad9\u4ece\u975e\u672c\u5730 IP \u5730\u5740\u5230 gRPC \u670d\u52a1\u5668\u7684\u8fde\u63a5\uff08\u4f8b\u5982\uff0c\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u771f\u5b9e IP \u5730\u5740\uff09\uff1a</p> <pre><code>grpc_bind $remote_addr transparent;\n</code></pre> <p>\u4e3a\u4e86\u4f7f\u8fd9\u4e2a\u53c2\u6570\u8d77\u4f5c\u7528\uff0c\u901a\u5e38\u9700\u8981\u4ee5\u8d85\u7ea7\u7528\u6237\u6743\u9650\u8fd0\u884c nginx worker \u8fdb\u7a0b\u3002\u5728 Linux \u4e0a\uff0c\u4e0d\u9700\u8981\u6307\u5b9a <code>transparent</code> \u53c2\u6570\uff0c\u5de5\u4f5c\u8fdb\u7a0b\u4f1a\u7ee7\u627f master \u8fdb\u7a0b\u7684 <code>CAP_NET_RAW</code> \u529f\u80fd\u3002\u6b64\u5916\uff0c\u8fd8\u8981\u914d\u7f6e\u5185\u6838\u8def\u7531\u8868\u6765\u62e6\u622a\u6765\u81ea gRPC \u670d\u52a1\u5668\u7684\u7f51\u7edc\u6d41\u91cf\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_buffer_size","title":"grpc_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_buffer_size <code>size</code>; \u9ed8\u8ba4 grpc_buffer_size 4k|8k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7528\u4e8e\u8bfb\u53d6\u4ece gRPC \u670d\u52a1\u5668\u6536\u5230\u7684\u54cd\u5e94\u7684\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u4e00\u65e6\u6536\u5230\u54cd\u5e94\uff0c\u54cd\u5e94\u4fbf\u4f1a\u540c\u6b65\u4f20\u9001\u7ed9\u5ba2\u6237\u7aef\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_connect_timeout","title":"grpc_connect_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_connect_timeout <code>time</code>; \u9ed8\u8ba4 grpc_connect_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e0e gRPC \u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u9700\u8981\u8bf4\u660e\u7684\u662f\uff0c\u8d85\u65f6\u901a\u5e38\u4e0d\u80fd\u8d85\u8fc7 75 \u79d2\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_hide_header","title":"grpc_hide_header","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_hide_header <code>field</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnginx \u4e0d\u4f1a\u5c06 gRPC \u670d\u52a1\u5668\u54cd\u5e94\u4e2d\u7684\u5934\u5b57\u6bb5 <code>Date</code>\u3001<code>Server</code> \u548c <code>X-Accel-...</code> \u4f20\u9001\u7ed9\u5ba2\u6237\u7aef\u3002<code>grpc_hide_header</code> \u6307\u4ee4\u8bbe\u7f6e\u4e86\u4e0d\u4f1a\u88ab\u4f20\u9001\u7684\u9644\u52a0\u5b57\u6bb5\u3002\u76f8\u53cd\uff0c\u5982\u679c\u9700\u8981\u5141\u8bb8\u4f20\u9001\u5b57\u6bb5\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 grpc_pass_header \u6307\u4ee4\u8bbe\u7f6e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_ignore_headers","title":"grpc_ignore_headers","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_ignore_headers <code>field ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u7981\u7528\u5904\u7406\u6765\u81ea gRPC \u670d\u52a1\u5668\u7684\u67d0\u4e9b\u54cd\u5e94\u5934\u5b57\u6bb5\u3002\u4ee5\u4e0b\u5b57\u6bb5\u53ef\u4ee5\u5ffd\u7565\uff1a<code>X-Accel-Redirect</code> \u548c <code>X-Accel-Charset</code>\u3002</p> <p>\u5982\u679c\u672a\u7981\u7528\uff0c\u5904\u7406\u8fd9\u4e9b\u5934\u5b57\u6bb5\u5c06\u4ea7\u751f\u4ee5\u4e0b\u4f5c\u7528\uff1a</p> <ul> <li><code>X-Accel-Redirect</code> \u6267\u884c\u5185\u90e8\u91cd\u5b9a\u5411\u5230\u6307\u5b9a\u7684 URI</li> <li><code>X-Accel-Charset</code> \u8bbe\u7f6e\u6240\u9700\u7684\u54cd\u5e94\u5b57\u7b26\u96c6</li> </ul>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_intercept_errors","title":"grpc_intercept_errors","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_intercept_errors <code>on</code> | <code>off</code>; \u9ed8\u8ba4 grpc_intercept_errors off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u786e\u5b9a\u72b6\u6001\u7801\u5927\u4e8e\u6216\u7b49\u4e8e 300 \u7684 gRPC \u670d\u52a1\u5668\u54cd\u5e94\u662f\u5e94\u8be5\u4f20\u9001\u7ed9\u5ba2\u6237\u7aef\u8fd8\u662f\u62e6\u622a\u5e76\u91cd\u5b9a\u5411\u5230 nginx \u4f7f\u7528 error_page \u6307\u4ee4\u8fdb\u884c\u5904\u7406\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_next_upstream","title":"grpc_next_upstream","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_next_upstream <code>error</code> | <code>timeout</code> | <code>invalid_header</code> | <code>http_500</code> | <code>http_502</code> | <code>http_503</code> | <code>http_504</code> | <code>http_403</code> | <code>http_404</code> | <code>http_429</code> | <code>non_idempotent</code> | <code>off ...</code>; \u9ed8\u8ba4 grpc_next_upstream error timeout; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u5b9a\u5728\u54ea\u4e9b\u60c5\u51b5\u4e0b\u8bf7\u6c42\u5e94\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\uff1a</p> <ul> <li> <p><code>error</code></p> <p>\u5728\u4e0e\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u3001\u4f20\u9012\u8bf7\u6c42\u6216\u8bfb\u53d6\u54cd\u5e94\u5934\u65f6\u53d1\u751f\u9519\u8bef</p> </li> <li> <p><code>timeout</code></p> <p>\u5728\u4e0e\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u3001\u4f20\u9012\u8bf7\u6c42\u6216\u8bfb\u53d6\u54cd\u5e94\u5934\u65f6\u53d1\u751f\u8d85\u65f6</p> </li> <li> <p><code>invalid_header</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u4e86\u7a7a\u7684\u6216\u65e0\u6548\u7684\u54cd\u5e94</p> </li> <li> <p><code>http_500</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 500 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_502</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 502 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_503</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 503 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_504</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 504 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_403</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 403 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_404</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 404 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_429</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 429 \u7684\u54cd\u5e94</p> </li> <li> <p><code>non_idempotent</code></p> <p>\u901a\u5e38\uff0c\u5982\u679c\u8bf7\u6c42\u5df2\u53d1\u9001\u5230\u4e0a\u6e38\u670d\u52a1\u5668\uff0c\u8bf7\u6c42\u65b9\u6cd5\u4e3a\u975e\u5e42\u7b49\uff08POST\u3001LOCK\u3001PATCH\uff09\u7684\u8bf7\u6c42\u662f\u4e0d\u4f1a\u4f20\u9001\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\uff0c\u4f7f\u8fd9\u4e2a\u9009\u9879\u5c06\u660e\u786e\u5141\u8bb8\u91cd\u8bd5\u8fd9\u6837\u7684\u8bf7\u6c42</p> </li> <li> <p><code>off</code></p> <p>\u7981\u6b62\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668</p> </li> </ul> <p>\u6211\u4eec\u5e94\u8be5\u8bb0\u4f4f\uff0c\u53ea\u6709\u5728\u6ca1\u6709\u4efb\u4f55\u5185\u5bb9\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u80fd\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u5728\u54cd\u5e94\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\u6216\u8d85\u65f6\uff0c\u4fee\u590d\u8fd9\u6837\u7684\u9519\u8bef\u662f\u4e0d\u53ef\u80fd\u7684\u3002</p> <p>\u8be5\u6307\u4ee4\u8fd8\u5b9a\u4e49\u4e86\u4e0e\u670d\u52a1\u5668\u8fdb\u884c\u901a\u4fe1\u7684\u5931\u8d25\u5c1d\u8bd5\u3002<code>error</code>\u3001<code>timeout</code> \u548c <code>invalid_header</code> \u7684\u60c5\u51b5\u603b\u662f\u88ab\u8ba4\u4e3a\u662f\u5931\u8d25\u5c1d\u8bd5\uff0c\u5373\u4f7f\u5b83\u4eec\u6ca1\u6709\u5728\u6307\u4ee4\u4e2d\u6307\u5b9a\u3002\u53ea\u6709\u5728\u6307\u4ee4\u4e2d\u6307\u5b9a\u4e86 <code>http_500</code>\u3001<code>http_502</code>\u3001<code>http_503</code>\u3001<code>http_504</code> \u548c <code>http_429</code> \u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u4f1a\u5c06\u5176\u89c6\u4e3a\u5931\u8d25\u5c1d\u8bd5\u3002<code>http_403</code> \u548c <code>http_404</code> \u7684\u60c5\u51b5\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u89c6\u4e3a\u5931\u8d25\u5c1d\u8bd5\u3002</p> <p>\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u53ef\u80fd\u53d7\u5230\u5c1d\u8bd5\u6b21\u6570\u548c\u65f6\u95f4\u7684\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_next_upstream_timeout","title":"grpc_next_upstream_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_next_upstream_timeout <code>time</code>; \u9ed8\u8ba4 grpc_next_upstream_timeout 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u9650\u5236\u8bf7\u6c42\u53ef\u4ee5\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u65f6\u95f4\u3002<code>0</code> \u503c\u8868\u793a\u5173\u95ed\u6b64\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_next_upstream_tries","title":"grpc_next_upstream_tries","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_next_upstream_tries <code>number</code>; \u9ed8\u8ba4 grpc_next_upstream_tries 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u9650\u5236\u5c1d\u8bd5\u5c06\u8bf7\u6c42\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u6b21\u6570\u3002<code>0</code> \u503c\u8868\u793a\u5173\u95ed\u6b64\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_pass","title":"grpc_pass","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_pass <code>address</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 location\u3001location \u4e2d\u7684 if <p>\u8bbe\u7f6e gRPC \u670d\u52a1\u5668\u5730\u5740\u3002\u8be5\u5730\u5740\u53ef\u4ee5\u6307\u5b9a\u4e3a\u57df\u540d\u6216 IP \u5730\u5740\u4ee5\u53ca\u7aef\u53e3\uff1a</p> <p><pre><code>grpc_pass localhost:9000;\n</code></pre> \u6216\u4f7f\u7528 UNIX \u57df\u5957\u63a5\u5b57\u8def\u5f84\uff1a</p> <pre><code>grpc_pass unix:/tmp/grpc.socket;\n</code></pre> <p>\u6216\u4f7f\u7528 <code>grpc://</code> scheme\uff1a</p> <pre><code>grpc_pass grpc://127.0.0.1:9000;\n</code></pre> <p>\u8981 gRPC \u914d\u5408 SSL\uff0c\u5e94\u8be5\u4f7f\u7528 <code>grpcs://</code> scheme\uff1a</p> <pre><code>grpc_pass grpcs://127.0.0.1:443;\n</code></pre> <p>\u5982\u679c\u57df\u540d\u89e3\u6790\u4e3a\u591a\u4e2a\u5730\u5740\uff0c\u5219\u8fd9\u4e9b\u5730\u5740\u5c06\u4ee5\u5faa\u73af\u65b9\u5f0f\u4f7f\u7528\u3002\u53e6\u5916\uff0c\u5730\u5740\u53ef\u4ee5\u88ab\u6307\u5b9a\u4e3a\u670d\u52a1\u5668\u7ec4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_pass_header","title":"grpc_pass_header","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_pass_header <code>field</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5141\u8bb8\u4ece gRPC \u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u4f20\u9012\u5ffd\u7565\u7684\u5934\u5b57\u6bb5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_read_timeout","title":"grpc_read_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_read_timeout <code>time</code>; \u9ed8\u8ba4 grpc_read_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4ece gRPC \u670d\u52a1\u5668\u8bfb\u53d6\u54cd\u5e94\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u8d85\u65f6\u95f4\u9694\u53ea\u5728\u4e24\u6b21\u8fde\u7eed\u7684\u8bfb\u64cd\u4f5c\u4e4b\u95f4\uff0c\u800c\u4e0d\u662f\u6574\u4e2a\u54cd\u5e94\u7684\u4f20\u8f93\u8fc7\u7a0b\u3002\u5982\u679c gRPC \u670d\u52a1\u5668\u5728\u6b64\u65f6\u95f4\u5185\u6ca1\u6709\u53d1\u9001\u4efb\u4f55\u5185\u5bb9\uff0c\u5219\u8fde\u63a5\u5173\u95ed\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_send_timeout","title":"grpc_send_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_send_timeout <code>time</code>; \u9ed8\u8ba4 grpc_send_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u5411 gRPC \u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u8d85\u65f6\u95f4\u9694\u53ea\u5728\u4e24\u6b21\u8fde\u7eed\u5199\u5165\u64cd\u4f5c\u4e4b\u95f4\uff0c\u800c\u4e0d\u662f\u6574\u4e2a\u8bf7\u6c42\u7684\u4f20\u8f93\u8fc7\u7a0b\u3002\u5982\u679c gRPC \u670d\u52a1\u5668\u5728\u6b64\u65f6\u95f4\u5185\u6ca1\u6709\u6536\u5230\u4efb\u4f55\u5185\u5bb9\uff0c\u5219\u8fde\u63a5\u5c06\u5173\u95ed\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_set_header","title":"grpc_set_header","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_set_header <code>field value</code>; \u9ed8\u8ba4 grpc_set_header Content-Length $content_length; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5141\u8bb8\u91cd\u65b0\u5b9a\u4e49\u6216\u9644\u52a0\u5b57\u6bb5\u5230\u4f20\u9012\u7ed9 gRPC \u670d\u52a1\u5668\u7684\u8bf7\u6c42\u5934\u3002\u8be5\u503c\u53ef\u4ee5\u5305\u542b\u6587\u672c\u3001\u53d8\u91cf\u53ca\u5176\u7ec4\u5408\u3002\u5f53\u4e14\u4ec5\u5f53\u5728\u5f53\u524d\u7ea7\u522b\u4e0a\u6ca1\u6709\u5b9a\u4e49 <code>grpc_set_header</code> \u6307\u4ee4\u65f6\uff0c\u8fd9\u4e9b\u6307\u4ee4\u624d\u4ece\u4e0a\u4e00\u7ea7\u7ee7\u627f\u3002</p> <p>\u5982\u679c\u5934\u5b57\u6bb5\u7684\u503c\u662f\u4e00\u4e2a\u7a7a\u5b57\u7b26\u4e32\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5b57\u6bb5\u5c06\u4e0d\u4f1a\u88ab\u4f20\u9012\u7ed9 gRPC \u670d\u52a1\u5668\uff1a</p> <pre><code>grpc_set_header Accept-Encoding \"\";\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_ssl_certificate","title":"grpc_ssl_certificate","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_ssl_certificate <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u5b9a\u4e00\u4e2a\u5e26\u6709 PEM \u683c\u5f0f\u8bc1\u4e66\u7684\u6587\u4ef6\uff08<code>file</code>\uff09\uff0c\u7528\u4e8e\u5411 gRPC SSL \u670d\u52a1\u5668\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_ssl_certificate_key","title":"grpc_ssl_certificate_key","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_ssl_certificate_key <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u5b9a\u4e00\u4e2a\u6587\u4ef6\uff08<code>file</code>\uff09\uff0c\u5176\u5305\u542b PEM \u683c\u5f0f\u7684\u5bc6\u94a5\uff0c\u7528\u4e8e\u5bf9 gRPC SSL \u670d\u52a1\u5668\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002</p> <p>\u53ef\u4ee5\u6307\u5b9a\u503c <code>engine:name:id</code> \u6765\u4ee3\u66ff <code>file</code>\uff0c\u5176\u4ece OpenSSL \u5f15\u64ce <code>name</code> \u52a0\u8f7d\u5177\u6709\u6307\u5b9a <code>id</code> \u7684\u5bc6\u94a5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_ssl_ciphers","title":"grpc_ssl_ciphers","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_ssl_ciphers <code>ciphers</code>; \u9ed8\u8ba4 grpc_ssl_ciphers DEFAULT; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u5b9a\u5bf9 gRPC SSL \u670d\u52a1\u5668\u7684\u8bf7\u6c42\u542f\u7528\u7684\u5bc6\u7801\u3002\u5bc6\u7801\u683c\u5f0f\u80fd\u88ab OpenSSL \u5e93\u6240\u652f\u6301\u3002</p> <p>\u5b8c\u6574\u7684\u5217\u8868\u8be6\u60c5\u53ef\u4ee5\u4f7f\u7528 <code>openssl ciphers</code> \u547d\u4ee4\u67e5\u770b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_ssl_crl","title":"grpc_ssl_crl","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_ssl_crl <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u5b9a\u4e00\u4e2a\u5e26\u6709 PEM \u683c\u5f0f\u7684\u64a4\u9500\u8bc1\u4e66\uff08CRL\uff09\u7684\u6587\u4ef6\uff08<code>file</code>\uff09\uff0c\u7528\u4e8e\u9a8c\u8bc1 gRPC SSL \u670d\u52a1\u5668\u7684\u8bc1\u4e66\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_ssl_name","title":"grpc_ssl_name","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_ssl_name <code>name</code>; \u9ed8\u8ba4 grpc_ssl_name host from grpc_pass; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5141\u8bb8\u91cd\u5199\u7528\u4e8e\u9a8c\u8bc1 gRPC SSL \u670d\u52a1\u5668\u7684\u8bc1\u4e66\u5e76\u5728\u4e0e gRPC SSL \u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u65f6\u901a\u8fc7 SNI \u4f20\u9012\u7684\u670d\u52a1\u5668\u540d\u79f0\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528 grpc_pass \u7684\u4e3b\u673a\u90e8\u5206\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_ssl_password_file","title":"grpc_ssl_password_file","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_ssl_password_file <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u5b9a\u4e00\u4e2a\u5bc6\u7801\u4e3a\u5bc6\u94a5\u7684\u6587\u4ef6\uff0c\u6bcf\u4e2a\u5bc6\u7801\u5728\u5355\u72ec\u7684\u884c\u4e0a\u6307\u5b9a\u3002\u52a0\u8f7d\u5bc6\u94a5\u65f6\u4f1a\u4f9d\u6b21\u5c1d\u8bd5\u6bcf\u4e2a\u5bc6\u7801\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_ssl_server_name","title":"grpc_ssl_server_name","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_ssl_server_name <code>on</code> | <code>off</code>; \u9ed8\u8ba4 grpc_ssl_server_name off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5728\u5efa\u7acb\u4e0e gRPC SSL \u670d\u52a1\u5668\u7684\u8fde\u63a5\u65f6\uff0c\u542f\u7528\u6216\u7981\u7528\u901a\u8fc7 TLS \u670d\u52a1\u5668\u540d\u79f0\u6307\u793a\u6269\u5c55\uff08SNI\uff0cRFC 6066\uff09\u4f20\u9001\u670d\u52a1\u5668\u540d\u79f0\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_ssl_session_reuse","title":"grpc_ssl_session_reuse","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_ssl_session_reuse <code>on</code> | <code>off</code>; \u9ed8\u8ba4 grpc_ssl_session_reuse on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u786e\u5b9a\u5728\u4f7f\u7528 gRPC \u670d\u52a1\u5668\u65f6\u662f\u5426\u53ef\u4ee5\u91cd\u7528 SSL \u4f1a\u8bdd\u3002\u5982\u679c\u9519\u8bef <code>SSL3_GET_FINISHED:digest check fialed</code> \u51fa\u73b0\u5728\u65e5\u5fd7\u4e2d\uff0c\u5c1d\u8bd5\u7981\u7528\u4f1a\u8bdd\u91cd\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_ssl_protocols","title":"grpc_ssl_protocols","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_ssl_protocols <code>[SSLv2] [SSLv3] [TLSv1] [TLSv1.1] [TLSv1.2] [TLSv1.3]</code>; \u9ed8\u8ba4 grpc_ssl_protocols TLSv1 TLSv1.1 TLSv1.2; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5bf9 gRPC SSL \u670d\u52a1\u5668\u7684\u8bf7\u6c42\u542f\u7528\u6307\u5b9a\u7684\u534f\u8bae\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_ssl_trusted_certificate","title":"grpc_ssl_trusted_certificate","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_ssl_trusted_certificate <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u5b9a\u4e00\u4e2a\u5e26\u6709 PEM \u683c\u5f0f\u7684\u53ef\u4fe1 CA \u8bc1\u4e66\u7684\u6587\u4ef6\uff0c\u7528\u4e8e\u9a8c\u8bc1 gRPC SSL \u670d\u52a1\u5668\u7684\u8bc1\u4e66\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_ssl_verify","title":"grpc_ssl_verify","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_ssl_verify <code>on</code> | <code>off</code>; \u9ed8\u8ba4 grpc_ssl_verify off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u6216\u7981\u7528\u9a8c\u8bc1 gRPC SSL \u670d\u52a1\u5668\u8bc1\u4e66\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#grpc_ssl_verify_depth","title":"grpc_ssl_verify_depth","text":"- \u8bf4\u660e \u8bed\u6cd5 grpc_ssl_verify_depth <code>number</code>; \u9ed8\u8ba4 grpc_ssl_verify_depth 1; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e gRPC SSL \u670d\u52a1\u5668\u8bc1\u4e66\u94fe\u4e2d\u7684\u9a8c\u8bc1\u6df1\u5ea6\u3002</p>"},{"location":"Modules-reference/http/ngx_http_grpc_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_grpc_module.html</p>"},{"location":"Modules-reference/http/ngx_http_gunzip_module/","title":"ngx_http_gunzip_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>gunzip</li> <li>gunzip_buffers</li> </ul> </li> </ul> <p><code>ngx_http_gunzip_module</code> \u6a21\u5757\u662f\u4e00\u4e2a\u8fc7\u6ee4\u5668\uff0c\u7528\u4e8e\u5bf9\u4e0d\u652f\u6301 gzip \u7f16\u7801\u65b9\u6cd5\u7684\u5ba2\u6237\u7aef\u89e3\u538b\u7f29 <code>Content-Encoding\uff1agzip</code> \u7684\u54cd\u5e94\u3002\u5f53\u9700\u8981\u5b58\u50a8\u538b\u7f29\u6570\u636e\u4ee5\u8282\u7701\u7a7a\u95f4\u5e76\u964d\u4f4e I/O \u6210\u672c\u65f6\uff0c\u8be5\u6a21\u5757\u5c06\u975e\u5e38\u6709\u7528\u3002</p> <p>\u6b64\u6a21\u5757\u4e0d\u662f\u9ed8\u8ba4\u6784\u5efa\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>--with-http_gunzip_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_gunzip_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location /storage/ {\ngunzip on;\n...\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_gunzip_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_gunzip_module/#gunzip","title":"gunzip","text":"- \u8bf4\u660e \u8bed\u6cd5 gunzip <code>on</code> | <code>off</code>; \u9ed8\u8ba4 gunzip off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5bf9\u7f3a\u5c11 gzip \u652f\u6301\u7684\u5ba2\u6237\u7aef\u542f\u7528\u6216\u7981\u7528 gzip \u54cd\u5e94\u89e3\u538b\u7f29\u3002\u5982\u679c\u5f00\u542f\uff0c\u5728\u786e\u5b9a\u5ba2\u6237\u7aef\u662f\u5426\u652f\u6301 gzip \u65f6\u8fd8\u4f1a\u8003\u8651\u4ee5\u4e0b\u6307\u4ee4\uff1agzip_http_version\u3001gzip_proxied \u548c gzip_disable\u3002\u53e6\u8bf7\u53c2\u9605 gzip_vary \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_gunzip_module/#gunzip_buffers","title":"gunzip_buffers","text":"- \u8bf4\u660e \u8bed\u6cd5 gunzip_buffers <code>number size</code>; \u9ed8\u8ba4 gunzip_buffers 32 4k|16 8k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7528\u4e8e\u89e3\u538b\u54cd\u5e94\u7684\u7f13\u51b2\u533a\u7684\u6570\u91cf\uff08<code>number</code>\uff09\u548c\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u51b2\u533a\u5927\u5c0f\u7b49\u4e8e\u4e00\u4e2a\u5185\u5b58\u9875\uff084K \u6216 8K\uff0c\u53d6\u51b3\u4e8e\u5e73\u53f0\uff09\u3002</p>"},{"location":"Modules-reference/http/ngx_http_gunzip_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_gunzip_module.html</p>"},{"location":"Modules-reference/http/ngx_http_gzip_module/","title":"ngx_http_gzip_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>gzip</li> <li>gzip_buffers</li> <li>gzip_comp_level</li> <li>gzip_disable</li> <li>gzip_min_length</li> <li>gzip_http_version</li> <li>gzip_proxied</li> <li>gzip_types</li> <li>gzip_vary</li> </ul> </li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_http_gzip_module</code> \u6a21\u5757\u662f\u4e00\u4e2a\u4f7f\u7528\u4e86 gzip \u65b9\u6cd5\u538b\u7f29\u54cd\u5e94\u7684\u8fc7\u6ee4\u5668\u3002\u6709\u52a9\u4e8e\u5c06\u4f20\u8f93\u6570\u636e\u7684\u5927\u5c0f\u51cf\u5c11\u4e00\u534a\u751a\u81f3\u66f4\u591a\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_gzip_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>gzip            on;\ngzip_min_length 1000;\ngzip_proxied    expired no-cache no-store private auth;\ngzip_types      text/plain application/xml;\n</code></pre> <p><code>$gzip_ratio</code> \u53d8\u91cf\u53ef\u7528\u4e8e\u8bb0\u5f55\u5b9e\u73b0\u7684\u538b\u7f29\u6bd4\u7387\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_gzip_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_gzip_module/#gzip","title":"gzip","text":"- \u8bf4\u660e \u8bed\u6cd5 gzip <code>on</code> | <code>off</code>; \u9ed8\u8ba4 gzip off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001location \u4e2d\u7684 if <p>\u542f\u7528\u6216\u7981\u7528\u54cd\u5e94\u7684 gzip \u538b\u7f29\u3002</p>"},{"location":"Modules-reference/http/ngx_http_gzip_module/#gzip_buffers","title":"gzip_buffers","text":"- \u8bf4\u660e \u8bed\u6cd5 gzip_buffers <code>number size</code>; \u9ed8\u8ba4 gzip_buffers 32 4k|16 8k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7528\u4e8e\u538b\u7f29\u54cd\u5e94\u7684\u7f13\u51b2\u533a\u7684\u6570\u91cf\uff08<code>number</code>\uff09\u548c\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u51b2\u533a\u5927\u5c0f\u7b49\u4e8e\u4e00\u4e2a\u5185\u5b58\u9875\uff084K \u6216 8K\uff0c\u53d6\u51b3\u4e8e\u5e73\u53f0\uff09\u3002</p> <p>\u5728 0.7.28 \u7248\u672c\u4e4b\u524d\uff0c\u9ed8\u8ba4\u4f7f\u7528 4 \u4e2a 4K \u6216 8K \u7f13\u51b2\u533a\u3002</p>"},{"location":"Modules-reference/http/ngx_http_gzip_module/#gzip_comp_level","title":"gzip_comp_level","text":"- \u8bf4\u660e \u8bed\u6cd5 gzip_comp_level <code>level</code>; \u9ed8\u8ba4 gzip_comp_level 1; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u54cd\u5e94\u7684 gzip \u538b\u7f29\u7ea7\u522b\uff08<code>level</code>\uff09\u3002\u503c\u7684\u8303\u56f4\u4e3a 1 \u5230 9\u3002</p>"},{"location":"Modules-reference/http/ngx_http_gzip_module/#gzip_disable","title":"gzip_disable","text":"- \u8bf4\u660e \u8bed\u6cd5 gzip_disable <code>regex ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.6.23 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u7981\u7528\u5bf9\u4e0e\u4efb\u4f55\u6307\u5b9a\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u7684 <code>User-Agent</code> \u5934\u5b57\u6bb5\u7684\u8bf7\u6c42\u54cd\u5e94\u505a gzip \u5904\u7406\u3002</p> <p>\u7279\u6b8a\u63a9\u7801 <code>msie6</code>\uff080.7.12\uff09\u5bf9\u5e94\u6b63\u5219\u8868\u8fbe\u5f0f <code>MSIE [4-6]\\.</code>\uff0c\u4f46\u6548\u7387\u66f4\u9ad8\u3002\u4ece 0.8.11 \u7248\u672c\u5f00\u59cb\uff0c<code>MSIE 6.0; ... SV1</code> \u4e0d\u5305\u542b\u5728\u6b64\u63a9\u7801\u4e2d\u3002</p>"},{"location":"Modules-reference/http/ngx_http_gzip_module/#gzip_min_length","title":"gzip_min_length","text":"- \u8bf4\u660e \u8bed\u6cd5 gzip_min_length <code>length</code>; \u9ed8\u8ba4 gzip_min_length 20; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u88ab\u538b\u7f29\u54cd\u5e94\u7684\u6700\u5c0f\u957f\u5ea6\u3002\u8be5\u957f\u5ea6\u4ec5\u7531 <code>Content-Length</code> \u54cd\u5e94\u5934\u5b57\u6bb5\u786e\u5b9a\u3002</p>"},{"location":"Modules-reference/http/ngx_http_gzip_module/#gzip_http_version","title":"gzip_http_version","text":"- \u8bf4\u660e \u8bed\u6cd5 gzip_http_version <code>1.0</code> | <code>1.1</code>; \u9ed8\u8ba4 gzip_http_version 1.1; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u538b\u7f29\u54cd\u5e94\u4e00\u4e2a\u8bf7\u6c42\u6240\u9700\u7684\u6700\u5c0f HTTP \u7248\u672c\u3002</p>"},{"location":"Modules-reference/http/ngx_http_gzip_module/#gzip_proxied","title":"gzip_proxied","text":"- \u8bf4\u660e \u8bed\u6cd5 gzip_proxied <code>off</code> | <code>expired</code> | <code>no-cache</code> | <code>no-store</code> | <code>private</code> | <code>no_last_modified</code> | <code>no_etag</code> | <code>auth</code> | <code>any ...</code>; \u9ed8\u8ba4 gzip_proxied off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6839\u636e\u8bf7\u6c42\u548c\u54cd\u5e94\uff0c\u542f\u7528\u6216\u7981\u7528\u9488\u5bf9\u4ee3\u7406\u8bf7\u6c42\u7684\u54cd\u5e94\u7684 gzip\u3002\u4e8b\u5b9e\u4e0a\u8bf7\u6c42\u88ab\u4ee3\u7406\u53d6\u51b3\u4e8e <code>Via</code> \u8bf7\u6c42\u5934\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u3002\u8be5\u6307\u4ee4\u63a5\u53d7\u591a\u4e2a\u53c2\u6570\uff1a</p> <ul> <li> <p><code>off</code></p> <p>\u7981\u7528\u6240\u6709\u4ee3\u7406\u8bf7\u6c42\u538b\u7f29\uff0c\u5ffd\u7565\u5176\u4ed6\u53c2\u6570</p> </li> <li> <p><code>expired</code></p> <p>\u5982\u679c\u54cd\u5e94\u5934\u5305\u542b <code>Expires\u201d</code> \u5b57\u6bb5\u5e76\u4e14\u5176\u503c\u4e3a\u7981\u7528\u7f13\u5b58\uff0c\u5219\u542f\u7528\u538b\u7f29</p> </li> <li> <p><code>no-cache</code></p> <p>\u5982\u679c\u54cd\u5e94\u5934\u5305\u542b\u5177\u6709 <code>no-cache</code> \u53c2\u6570\u7684 <code>Cache-Control</code> \u5b57\u6bb5\uff0c\u5219\u542f\u7528\u538b\u7f29</p> </li> <li> <p><code>no-store</code></p> <p>\u5982\u679c\u54cd\u5e94\u5934\u5305\u542b\u5177\u6709 <code>no-store</code> \u53c2\u6570\u7684 <code>Cache-Control</code> \u5b57\u6bb5\uff0c\u5219\u542f\u7528\u538b\u7f29</p> </li> <li> <p><code>private</code></p> <p>\u5982\u679c\u54cd\u5e94\u5934\u5305\u542b\u5e26\u6709 <code>private</code> \u53c2\u6570\u7684 <code>Cache-Control</code> \u5b57\u6bb5\uff0c\u5219\u542f\u7528\u538b\u7f29</p> </li> <li> <p><code>no_last_modified</code></p> <p>\u5982\u679c\u54cd\u5e94\u5934\u4e0d\u5305\u542b <code>Last-Modified</code> \u5b57\u6bb5\uff0c\u5219\u542f\u7528\u538b\u7f29</p> </li> <li> <p><code>no_etag</code></p> <p>\u5982\u679c\u54cd\u5e94\u5934\u4e0d\u5305\u542b <code>ETag</code> \u5b57\u6bb5\uff0c\u5219\u542f\u7528\u538b\u7f29</p> </li> <li> <p><code>auth</code></p> <p>\u5982\u679c\u8bf7\u6c42\u5934\u5305\u542b <code>Authorization</code> \u5b57\u6bb5\uff0c\u5219\u542f\u7528\u538b\u7f29</p> </li> <li> <p><code>any</code></p> <p>\u4e3a\u6240\u6709\u4ee3\u7406\u8bf7\u6c42\u542f\u7528\u538b\u7f29</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_gzip_module/#gzip_types","title":"gzip_types","text":"- \u8bf4\u660e \u8bed\u6cd5 gzip_types <code>mime-type ...</code>; \u9ed8\u8ba4 gzip_types text/html; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u9664\u4e86 <code>text/html</code> \u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u9488\u5bf9\u6307\u5b9a\u7684 MIME \u7c7b\u578b\u542f\u7528 gzip \u54cd\u5e94\u3002\u7279\u6b8a\u503c <code>*</code> \u5339\u914d\u4efb\u4f55 MIME \u7c7b\u578b\uff080.8.29\uff09\u3002\u5bf9 <code>text/html</code> \u7c7b\u578b\u7684\u54cd\u5e94\u59cb\u7ec8\u542f\u7528\u538b\u7f29\u3002</p>"},{"location":"Modules-reference/http/ngx_http_gzip_module/#gzip_vary","title":"gzip_vary","text":"- \u8bf4\u660e \u8bed\u6cd5 gzip_vary <code>on</code> | <code>off</code>; \u9ed8\u8ba4 gzip_vary off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5982\u679c\u6307\u4ee4 gzip\u3001gzip_static \u6216 gunzip \u5904\u4e8e\u6fc0\u6d3b\u72b6\u6001\uff0c\u5219\u542f\u7528\u6216\u7981\u7528\u63d2\u5165 <code>Vary:Accept-Encoding</code> \u54cd\u5e94\u5934\u5b57\u6bb5\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_gzip_module/#_3","title":"\u5185\u5d4c\u53d8\u91cf","text":"<ul> <li> <p><code>$gzip_ratio</code></p> <p>\u5b9e\u73b0\u538b\u7f29\u6bd4\u7387\uff0c\u8ba1\u7b97\u4e3a\u539f\u59cb\u538b\u7f29\u54cd\u5e94\u5927\u5c0f\u4e0e\u538b\u7f29\u540e\u54cd\u5e94\u5927\u5c0f\u4e4b\u95f4\u7684\u6bd4\u7387\u3002</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_gzip_module/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_gzip_module.html</p>"},{"location":"Modules-reference/http/ngx_http_gzip_static_module/","title":"ngx_http_gzip_static_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>gzip_static</li> </ul> </li> </ul> <p><code>ngx_http_gzip_static_module</code> \u6a21\u5757\u5141\u8bb8\u53d1\u9001\u4ee5 .gz \u7ed3\u5c3e\u7684\u9884\u538b\u7f29\u6587\u4ef6\u66ff\u4ee3\u666e\u901a\u6587\u4ef6\u3002 \u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u4f1a\u88ab\u6784\u5efa\u5230 nginx \u4e2d\uff0c\u9700\u8981\u5728\u7f16\u8bd1\u65f6\u52a0\u5165 <code>--with-http_gzip_static_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_gzip_static_module/#_1","title":"\u914d\u7f6e\u793a\u4f8b","text":"<p><pre><code>gzip_static on;\ngzip_proxied expired no-cache no-store private auth;\n</code></pre> </p>"},{"location":"Modules-reference/http/ngx_http_gzip_static_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_gzip_static_module/#gzip_static","title":"gzip_static","text":"- \u8bf4\u660e \u8bed\u6cd5 gzip_static <code>on</code> | <code>off</code> | <code>always</code>; \u9ed8\u8ba4 gzip_static off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5f00\u542f(on)\u6216\u7981\u7528(off)\u4f1a\u68c0\u67e5\u9884\u538b\u7f29\u6587\u4ef6\u662f\u5426\u5b58\u5728\u3002\u4e0b\u5217\u6307\u4ee4\u4e5f\u4f1a\u88ab\u5f71\u54cd\u5230 gzip_http_verson\uff0c gzip_proxied\uff0c gzip_disable\uff0c gzip_vary\u3002</p> <p>\u503c\u4e3a always (1.3.6)\uff0c\u5728\u6240\u6709\u60c5\u51b5\u4e0b\u90fd\u4f1a\u4f7f\u7528\u538b\u7f29\u6587\u4ef6\uff0c\u4e0d\u68c0\u67e5\u5ba2\u6237\u7aef\u662f\u5426\u652f\u6301\u3002\u5982\u679c\u78c1\u76d8\u4e0a\u6ca1\u6709\u672a\u88ab\u538b\u7f29\u7684\u6587\u4ef6\u6216\u8005 ngx_http_gunzip_module \u6a21\u5757\u88ab\u542f\u7528\uff0c\u8fd9\u4e2a\u53c2\u6570\u975e\u5e38\u6709\u7528\u3002</p> <p>\u6587\u4ef6\u53ef\u4ee5\u4f7f\u7528<code>gzip</code>\u547d\u4ee4\uff0c\u6216\u8005\u4efb\u4f55\u517c\u5bb9\u6587\u4ef6\u8fdb\u884c\u538b\u7f29\u3002\u5efa\u8bae\u538b\u7f29\u6587\u4ef6\u548c\u6e90\u6587\u4ef6\u7684\u4fee\u6539\u65e5\u671f\u548c\u65f6\u95f4\u4fdd\u6301\u4e00\u81f4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_headers_module/","title":"ngx_http_headers_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>add_header</li> <li>add_trailer</li> <li>expires</li> </ul> </li> </ul> <p><code>ngx_http_headers_module</code> \u6a21\u5757\u5141\u8bb8\u5c06 <code>Expires</code> \u548c <code>Cache-Control</code> \u5934\u5b57\u6bb5\u4ee5\u53ca\u4efb\u610f\u5b57\u6bb5\u6dfb\u52a0\u5230\u54cd\u5e94\u5934\u4e2d\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_headers_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>expires    24h;\nexpires    modified +24h;\nexpires    @24h;\nexpires    0;\nexpires    -1;\nexpires    epoch;\nexpires    $expires;\nadd_header Cache-Control private;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_headers_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_headers_module/#add_header","title":"add_header","text":"- \u8bf4\u660e \u8bed\u6cd5 add_header <code>name value [always]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001location \u4e2d\u7684 if <p>\u5982\u679c\u54cd\u5e94\u4ee3\u7801\u7b49\u4e8e 200\u3001201\uff081.3.10\uff09\u3001204\u3001206\u3001301\u3001302\u3001303\u3001304\u3001307\uff081.1.16\u30011.0.13\uff09\u6216 308\uff081.13.0\uff09\uff0c\u5219\u5c06\u6307\u5b9a\u7684\u5b57\u6bb5\u6dfb\u52a0\u5230\u54cd\u5e94\u62a5\u5934\u4e2d\u3002\u8be5\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002</p> <p>\u53ef\u4ee5\u5b58\u5728\u51e0\u4e2a <code>add_header</code> \u6307\u4ee4\u3002\u5f53\u4e14\u4ec5\u5f53\u5728\u5f53\u524d\u7ea7\u522b\u4e0a\u6ca1\u6709\u5b9a\u4e49 <code>add_header</code> \u6307\u4ee4\u65f6\uff0c\u8fd9\u4e9b\u6307\u4ee4\u624d\u4ece\u4e0a\u4e00\u7ea7\u7ee7\u627f\u3002</p> <p>\u5982\u679c\u6307\u5b9a\u4e86 <code>always</code> \u53c2\u6570\uff081.7.5\uff09\uff0c\u5219\u65e0\u8bba\u54cd\u5e94\u4ee3\u7801\u4e3a\u4f55\u503c\uff0c\u5934\u5b57\u6bb5\u90fd\u5c06\u88ab\u6dfb\u52a0\u3002</p>"},{"location":"Modules-reference/http/ngx_http_headers_module/#add_trailer","title":"add_trailer","text":"- \u8bf4\u660e \u8bed\u6cd5 add_trailer <code>number size</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001location \u4e2d\u7684 if \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.13.2 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5982\u679c\u54cd\u5e94\u4ee3\u7801\u7b49\u4e8e 200\u3001201\u3001206\u3001301\u3001302\u3001303\u3001307 \u6216 308\uff0c\u5219\u5c06\u6307\u5b9a\u7684\u5b57\u6bb5\u6dfb\u52a0\u5230\u54cd\u5e94\u7684\u672b\u5c3e\u3002\u8be5\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002</p> <p>\u53ef\u4ee5\u5b58\u5728\u591a\u4e2a <code>add_trailer</code> \u6307\u4ee4\u3002\u5f53\u4e14\u4ec5\u5f53\u5728\u5f53\u524d\u7ea7\u522b\u4e0a\u6ca1\u6709\u5b9a\u4e49 <code>add_trailer</code> \u6307\u4ee4\u65f6\uff0c\u8fd9\u4e9b\u6307\u4ee4\u624d\u4ece\u4e0a\u4e00\u7ea7\u7ee7\u627f\u3002</p> <p>\u5982\u679c\u6307\u5b9a <code>always</code> \u53c2\u6570\uff0c\u5219\u65e0\u8bba\u54cd\u5e94\u4ee3\u7801\u4e3a\u4f55\u503c\uff0c\u90fd\u4f1a\u6dfb\u52a0\u6307\u5b9a\u7684\u5b57\u6bb5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_headers_module/#expires","title":"expires","text":"- \u8bf4\u660e \u8bed\u6cd5 expires <code>[modified] time</code>;  expires <code>epoch</code> |<code>max</code> | <code>off</code>; \u9ed8\u8ba4 expires off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001location \u4e2d\u7684 if <p>\u5982\u679c\u54cd\u5e94\u4ee3\u7801\u7b49\u4e8e 200\u3001201\uff081.3.10\uff09\u3001204\u3001206\u3001301\u3001302\u3001303\u3001304 307\uff081.1.16\u30011.0.13\uff09\u6216 308\uff081.13.0\uff09\uff0c\u5219\u542f\u7528\u6216\u7981\u7528\u6dfb\u52a0\u6216\u4fee\u6539 <code>Expires</code> \u548c <code>Cache-Control</code> \u54cd\u5e94\u5934\u5b57\u6bb5\u3002\u53c2\u6570\u53ef\u4ee5\u662f\u6b63\u503c\u6216\u8d1f\u503c\u3002</p> <p><code>`Expires</code> \u5b57\u6bb5\u4e2d\u7684\u65f6\u95f4\u8ba1\u7b97\u4e3a\u6307\u4ee4\u4e2d\u6307\u5b9a\u7684 <code>time</code> \u548c\u5f53\u524d\u65f6\u95f4\u7684\u603b\u548c\u3002\u5982\u679c\u4f7f\u7528 <code>modified</code> \u53c2\u6570\uff080.7.0\u30010.6.32\uff09\uff0c\u5219\u8ba1\u7b97\u65f6\u95f4\u4e3a\u6587\u4ef6\u4fee\u6539\u65f6\u95f4\u4e0e\u6307\u4ee4\u4e2d\u6307\u5b9a\u7684 <code>time</code> \u4e4b\u548c\u3002</p> <p>\u53e6\u5916\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>@</code> \u524d\u7f00\u6307\u5b9a\u4e00\u5929\u7684\u65f6\u95f4\uff080.7.9\u30010.6.34\uff09\uff1a</p> <pre><code>expires @15h30m;\n</code></pre> <p><code>epoch</code> \u53c2\u6570\u5bf9\u5e94\u4e8e\u7edd\u5bf9\u65f6\u95f4 Thu, 01 Jan 1970 00:00:01 GMT\u3002<code>Cache-Control</code> \u5b57\u6bb5\u7684\u5185\u5bb9\u53d6\u51b3\u4e8e\u6307\u5b9a\u65f6\u95f4\u7684\u7b26\u53f7\uff1a</p> <ul> <li>\u65f6\u95f4\u4e3a\u8d1f\u503c \u2014 <code>Cache-Control:no-cache</code></li> <li>\u65f6\u95f4\u4e3a\u6b63\u503c\u6216\u4e3a\u96f6 \u2014 <code>Cache-Control:max-age=t</code>\uff0c\u5176\u4e2d <code>t</code> \u662f\u6307\u4ee4\u4e2d\u6307\u5b9a\u7684\u65f6\u95f4\uff0c\u5355\u4f4d\u4e3a\u79d2</li> </ul> <p><code>max</code> \u53c2\u6570\u5c06 <code>Expires</code> \u7684\u503c\u8bbe\u4e3a <code>Thu, 2037 Dec 23:55:55 GMT</code>\uff0c<code>Cache-Control</code> \u8bbe\u7f6e\u4e3a 10 \u5e74\u3002</p> <p><code>off</code> \u53c2\u6570\u7981\u6b62\u6dfb\u52a0\u6216\u4fee\u6539 <code>Expires</code> \u548c <code>Cache-Control</code> \u54cd\u5e94\u5934\u5b57\u6bb5\u3002</p> <p>\u6700\u540e\u4e00\u4e2a\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.7.9\uff09\uff1a</p> <pre><code>map $sent_http_content_type $expires {\ndefault         off;\napplication/pdf 42d;\n~image/         max;\n}\n\nexpires $expires;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_headers_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_headers_module.html</p>"},{"location":"Modules-reference/http/ngx_http_hls_module/","title":"ngx_http_headers_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>hls</li> <li>hls_buffers</li> <li>hls_forward_args</li> <li>hls_fragment</li> <li>hls_mp4_buffer_size</li> <li>hls_mp4_max_buffer_size</li> </ul> </li> </ul> <p><code>ngx_http_hls_module</code> \u6a21\u5757\u4e3a MP4 \u548c MOV \u5a92\u4f53\u6587\u4ef6\u63d0\u4f9b HTTP Live Streaming\uff08HLS\uff09\u670d\u52a1\u5668\u7aef\u652f\u6301\u3002\u8fd9\u4e9b\u6587\u4ef6\u901a\u5e38\u5177\u6709 <code>.mp4</code>\u3001<code>.m4v</code>\u3001<code>.m4a</code>\u3001<code>.mov</code> \u6216 <code>.qt</code> \u6269\u5c55\u540d\u3002\u8be5\u6a21\u5757\u652f\u6301 H.264 \u89c6\u9891\u7f16\u89e3\u7801\u5668\u3001AAC \u548c MP3 \u97f3\u9891\u7f16\u89e3\u7801\u5668\u3002</p> <p>\u5bf9\u4e8e\u6bcf\u4e2a\u5a92\u4f53\u6587\u4ef6\uff0c\u652f\u6301\u4e24\u79cd URI\uff1a</p> <ul> <li>\u5e26\u6709 <code>.m3u8</code> \u6587\u4ef6\u6269\u5c55\u540d\u7684\u64ad\u653e\u5217\u8868 URI\u3002\u8be5 URI \u53ef\u4ee5\u63a5\u53d7\u53ef\u9009\u53c2\u6570\uff1a<ul> <li><code>start</code> \u548c <code>end</code> \u4ee5\u79d2\u4e3a\u5355\u4f4d\u5b9a\u4e49\u64ad\u653e\u5217\u8868\u8303\u56f4\uff081.9.0\uff09\u3002</li> <li><code>offset</code> \u5c06\u521d\u59cb\u64ad\u653e\u4f4d\u7f6e\u79fb\u52a8\u5230\u4ee5\u79d2\u4e3a\u5355\u4f4d\u7684\u65f6\u95f4\u504f\u79fb\uff081.9.0\uff09\u3002\u6b63\u503c\u8bbe\u7f6e\u64ad\u653e\u5217\u8868\u5f00\u5934\u7684\u65f6\u95f4\u504f\u79fb\u91cf\u3002\u8d1f\u503c\u8bbe\u7f6e\u64ad\u653e\u5217\u8868\u4e2d\u6700\u540e\u4e00\u4e2a\u7247\u6bb5\u672b\u5c3e\u7684\u65f6\u95f4\u504f\u79fb\u91cf\u3002</li> <li><code>len</code> \u4ee5\u79d2\u4e3a\u5355\u4f4d\u5b9a\u4e49\u7247\u6bb5\u957f\u5ea6\u3002</li> </ul> </li> <li>\u5e26\u6709 <code>.ts</code> \u6587\u4ef6\u6269\u5c55\u540d\u7684\u7247\u6bb5 URI\u3002\u8be5 URI \u53ef\u4ee5\u63a5\u53d7\u53ef\u9009\u53c2\u6570\uff1a<ul> <li><code>start</code> \u548c <code>end</code> \u4ee5\u79d2\u4e3a\u5355\u4f4d\u5b9a\u4e49\u7247\u6bb5\u8303\u56f4\u3002</li> </ul> </li> </ul> <p>\u8be5\u6a21\u5757\u53ef\u4f5c\u4e3a\u6211\u4eec\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_hls_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location / {\nhls;\nhls_fragment            5s;\nhls_buffers             10 10m;\nhls_mp4_buffer_size     1m;\nhls_mp4_max_buffer_size 5m;\nroot /var/video/;\n}\n</code></pre> <p>\u5728\u6b64\u914d\u7f6e\u4e2d\uff0c<code>/var/video/test.mp4</code> \u6587\u4ef6\u652f\u6301\u4ee5\u4e0b URI\uff1a</p> <pre><code>http://hls.example.com/test.mp4.m3u8?offset=1.000&amp;start=1.000&amp;end=2.200\nhttp://hls.example.com/test.mp4.m3u8?len=8.000\nhttp://hls.example.com/test.mp4.ts?start=1.000&amp;end=2.200\n</code></pre> <p></p>"},{"location":"Modules-reference/http/ngx_http_hls_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_hls_module/#hls","title":"hls","text":"- \u8bf4\u660e \u8bed\u6cd5 hls; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 location <p>\u4e3a\u5f53\u524d location \u6253\u5f00 HLS \u6d41\u3002</p>"},{"location":"Modules-reference/http/ngx_http_hls_module/#hls_buffers","title":"hls_buffers","text":"- \u8bf4\u660e \u8bed\u6cd5 hls_buffers <code>number size</code>; \u9ed8\u8ba4 hls_buffers 8 2m; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7528\u4e8e\u8bfb\u53d6\u548c\u5199\u5165\u6570\u636e\u5e27\u7684\u7f13\u51b2\u533a\u7684\u6700\u5927\u6570\u91cf\uff08<code>number</code>\uff09\u548c\u5927\u5c0f\uff08<code>size</code>\uff09\u3002</p>"},{"location":"Modules-reference/http/ngx_http_hls_module/#hls_forward_args","title":"hls_forward_args","text":"- \u8bf4\u660e \u8bed\u6cd5 hls_forward_args <code>on</code> | <code>off</code>; \u9ed8\u8ba4 hls_forward_args off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.12 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5c06\u64ad\u653e\u5217\u8868\u8bf7\u6c42\u4e2d\u7684\u53c2\u6570\u6dfb\u52a0\u5230\u7247\u6bb5\u7684 URI \u4e2d\u3002\u8fd9\u5bf9\u4e8e\u5728\u8bf7\u6c42\u7247\u6bb5\u65f6\u6216\u5728\u4f7f\u7528 ngx_http_secure_link_module \u6a21\u5757\u4fdd\u62a4 HLS \u6d41\u65f6\u6267\u884c\u5ba2\u6237\u7aef\u6388\u6743\u975e\u5e38\u6709\u7528\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u8bf7\u6c42\u64ad\u653e\u5217\u8868 <code>http://example.com/hls/test.mp4.m3u8?a=1&amp;b=2</code>\uff0c\u53c2\u6570 <code>a=1</code> \u548c <code>b=2</code> \u5c06\u5728\u53c2\u6570 <code>start</code> \u548c <code>end</code> \u540e\u9762\u6dfb\u52a0\u5230\u7247\u6bb5 URI \u4e2d\uff1a</p> <pre><code>#EXTM3U\n#EXT-X-VERSION:3\n#EXT-X-TARGETDURATION:15\n#EXT-X-PLAYLIST-TYPE:VOD\n\n#EXTINF:9.333,\ntest.mp4.ts?start=0.000&amp;end=9.333&amp;a=1&amp;b=2\n#EXTINF:7.167,\ntest.mp4.ts?start=9.333&amp;end=16.500&amp;a=1&amp;b=2\n#EXTINF:5.416,\ntest.mp4.ts?start=16.500&amp;end=21.916&amp;a=1&amp;b=2\n#EXTINF:5.500,\ntest.mp4.ts?start=21.916&amp;end=27.416&amp;a=1&amp;b=2\n#EXTINF:15.167,\ntest.mp4.ts?start=27.416&amp;end=42.583&amp;a=1&amp;b=2\n#EXTINF:9.626,\ntest.mp4.ts?start=42.583&amp;end=52.209&amp;a=1&amp;b=2\n\n#EXT-X-ENDLIST\n</code></pre> <p>\u5982\u679c HLS \u6d41\u53d7\u5230 ngx_http_secure_link_module \u6a21\u5757\u7684\u4fdd\u62a4\uff0c\u5219\u4e0d\u5e94\u5728 secure_link_md5 \u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528 <code>$uri</code>\uff0c\u56e0\u4e3a\u8fd9\u4f1a\u5728\u8bf7\u6c42\u7247\u6bb5\u65f6\u89e6\u53d1\u9519\u8bef\u3002\u5e94\u8be5\u4f7f\u7528 Base URI \u800c\u4e0d\u662f <code>$uri</code>\uff08\u5728\u793a\u4f8b\u4e2d\u4e3a <code>$hls_uri</code>\uff09\uff1a</p> <pre><code>http {\n...\n\nmap $uri $hls_uri {\n~^(?&lt;base_uri&gt;.*).m3u8$ $base_uri;\n~^(?&lt;base_uri&gt;.*).ts$   $base_uri;\ndefault                 $uri;\n}\n\nserver {\n...\n\nlocation /hls {\nhls;\nhls_forward_args on;\n\nalias /var/videos;\n\nsecure_link $arg_md5,$arg_expires;\nsecure_link_md5 \"$secure_link_expires$hls_uri$remote_addr secret\";\n\nif ($secure_link = \"\") {\nreturn 403;\n}\n\nif ($secure_link = \"0\") {\nreturn 410;\n}\n}\n}\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_hls_module/#hls_fragment","title":"hls_fragment","text":"- \u8bf4\u660e \u8bed\u6cd5 hls_fragment <code>time</code>; \u9ed8\u8ba4 hls_fragment 5s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u672a\u4f7f\u7528 <code>len</code> \u53c2\u6570\u8bf7\u6c42\u7684\u64ad\u653e\u5217\u8868 URI \u7684\u9ed8\u8ba4\u7247\u6bb5\u957f\u5ea6\u3002</p>"},{"location":"Modules-reference/http/ngx_http_hls_module/#hls_mp4_buffer_size","title":"hls_mp4_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 hls_mp4_buffer_size <code>size</code>; \u9ed8\u8ba4 hls_mp4_buffer_size 512k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7528\u4e8e\u5904\u7406 MP4 \u548c MOV \u6587\u4ef6\u7684\u7f13\u51b2\u533a\u7684\u521d\u59cb\u5927\u5c0f\uff08<code>size</code>\uff09\u3002</p>"},{"location":"Modules-reference/http/ngx_http_hls_module/#hls_mp4_max_buffer_size","title":"hls_mp4_max_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 hls_mp4_max_buffer_size <code>size</code>; \u9ed8\u8ba4 hls_mp4_max_buffer_size 10m; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5728\u5143\u6570\u636e\u5904\u7406\u671f\u95f4\uff0c\u53ef\u80fd\u9700\u8981\u66f4\u5927\u7684\u7f13\u51b2\u533a\u3002\u5176\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7\u6307\u5b9a\u7684\u5927\u5c0f\uff08<code>size</code>\uff09\uff0c\u5426\u5219 nginx \u5c06\u8fd4\u56de 500 \u72b6\u6001\u7801\uff08\u5185\u90e8\u670d\u52a1\u5668\u9519\u8bef\uff09\uff0c\u5e76\u8bb0\u5f55\u4ee5\u4e0b\u6d88\u606f\uff1a</p> <pre><code>\"/some/movie/file.mp4\" mp4 moov atom is too large:\n12583268, you may want to increase hls_mp4_max_buffer_size\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_hls_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_hls_module.html</p>"},{"location":"Modules-reference/http/ngx_http_image_filter_module/","title":"ngx_http_image_filter_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>image_filter</li> <li>image_filter_buffer</li> <li>image_filter_interlace</li> <li>image_filter_jpeg_quality</li> <li>image_filter_sharpen</li> <li>image_filter_transparency</li> <li>image_filter_webp_quality</li> </ul> </li> </ul> <p><code>ngx_http_image_filter_module</code> \u6a21\u5757\uff080.7.54+\uff09\u662f\u4e00\u4e2a\u53ef\u4ee5\u8f6c\u6362 JPEG\u3001GIF\u3001PNG \u548c WebP \u683c\u5f0f\u56fe\u50cf\u7684\u8fc7\u6ee4\u5668\u3002</p> <p>\u6b64\u6a21\u5757\u4e0d\u662f\u9ed8\u8ba4\u6784\u5efa\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>--with-http_image_filter_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p>\u8be5\u6a21\u5757\u4f7f\u7528\u4e86 libgd \u5e93\u3002\u5efa\u8bae\u4f7f\u7528\u8be5\u5e93\u7684\u6700\u65b0\u7248\u672c\u3002</p> <p>WebP \u683c\u5f0f\u652f\u6301\u51fa\u73b0\u5728 1.11.6 \u7248\u672c\u4e2d\u3002\u8981\u8f6c\u6362\u6210\u6b64\u683c\u5f0f\u7684\u56fe\u50cf\uff0c\u5fc5\u987b\u5728\u7f16\u8bd1 <code>libgd</code> \u5e93\u65f6\u542f\u7528 WebP \u652f\u6301\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_image_filter_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location /img/ {\nproxy_pass   http://backend;\nimage_filter resize 150 100;\nimage_filter rotate 90;\nerror_page   415 = /empty;\n}\n\nlocation = /empty {\nempty_gif;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_image_filter_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_image_filter_module/#image_filter","title":"image_filter","text":"- \u8bf4\u660e \u8bed\u6cd5 image_filter <code>off</code>; image_filter <code>test</code>;image_filter <code>size</code>;image_filter <code>rotate 90 &amp;#124; 180 &amp;#124; 270</code>;image_filter <code>resize width height</code>;image_filter <code>crop width height</code>; \u9ed8\u8ba4 image_filter off; \u4e0a\u4e0b\u6587 location <p>\u8bbe\u7f6e\u56fe\u7247\u6267\u884c\u7684\u8f6c\u6362\u7c7b\u578b\uff1a</p> <ul> <li> <p><code>off</code></p> <p>\u5173\u95ed\u5bf9 location \u6a21\u5757\u7684\u5904\u7406</p> </li> <li> <p><code>test</code></p> <p>\u786e\u4fdd\u54cd\u5e94\u662f JPEG\u3001GIF\u3001PNG \u6216 WebP \u683c\u5f0f\u7684\u56fe\u7247\u3002\u5426\u5219\uff0c\u8fd4\u56de 415\uff08\u4e0d\u652f\u6301\u7684\u5a92\u4f53\u7c7b\u578b\uff09\u9519\u8bef\u3002</p> </li> <li> <p><code>size</code></p> <p>\u4ee5 JSON \u683c\u5f0f\u8f93\u51fa\u56fe\u7247\u7684\u4fe1\u606f\uff0c\u4f8b\u5982\uff1a</p> <pre><code>{ \"img\" : { \"width\": 100, \"height\": 100, \"type\": \"gif\" } }\n</code></pre> <p>\u53d1\u751f\u9519\u8bef\u65f6\uff0c\u8f93\u51fa\u5982\u4e0b\uff1a</p> <pre><code>{}\n</code></pre> </li> <li> <p><code>rotate 90&amp;#124;180&amp;#124;270</code></p> <p>\u5c06\u56fe\u7247\u9006\u65f6\u9488\u65cb\u8f6c\u6307\u5b9a\u7684\u5ea6\u6570\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002\u6b64\u6a21\u5f0f\u53ef\u4ee5\u5355\u72ec\u4f7f\u7528\uff0c\u4e5f\u53ef\u4ee5\u4e0e\u8c03\u6574\u5927\u5c0f\u548c\u88c1\u526a\u8f6c\u6362\u4e00\u8d77\u4f7f\u7528\u3002</p> </li> <li> <p><code>resize width height</code></p> <p>\u6309\u6bd4\u4f8b\u5c06\u56fe\u7247\u7f29\u5c0f\u5230\u6307\u5b9a\u7684\u5c3a\u5bf8\u3002\u8981\u53ea\u6307\u5b9a\u4e00\u4e2a\u7ef4\u5ea6\uff0c\u53ef\u4ee5\u5c06\u53e6\u4e00\u4e2a\u7ef4\u5ea6\u6307\u5b9a\u4e3a <code>-</code>\u3002\u5f53\u53d1\u751f\u9519\u8bef\uff0c\u670d\u52a1\u5668\u5c06\u8fd4\u56de 415 \u72b6\u6001\u7801\uff08\u4e0d\u652f\u6301\u7684\u5a92\u4f53\u7c7b\u578b\uff09\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002\u5f53\u4e0e <code>rotate</code> \u53c2\u6570\u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u65cb\u8f6c\u53d8\u6362\u5c06\u5728\u7f29\u5c0f\u53d8\u6362**\u4e4b\u540e**\u6267\u884c\u3002</p> </li> <li> <p><code>crop width height</code></p> <p>\u6309\u6bd4\u4f8b\u5c06\u56fe\u7247\u7f29\u5c0f\u5230\u8f83\u5927\u7684\u4e00\u8fb9\uff0c\u5e76\u88c1\u526a\u53e6\u4e00\u8fb9\u591a\u4f59\u7684\u8fb9\u7f18\u3002\u8981\u53ea\u6307\u5b9a\u4e00\u4e2a\u7ef4\u5ea6\uff0c\u53ef\u4ee5\u5c06\u53e6\u4e00\u4e2a\u7ef4\u5ea6\u6307\u5b9a\u4e3a <code>-</code>\u3002\u5f53\u53d1\u751f\u9519\u8bef\uff0c\u670d\u52a1\u5668\u5c06\u8fd4\u56de 415 \u72b6\u6001\u7801\uff08\u4e0d\u652f\u6301\u7684\u5a92\u4f53\u7c7b\u578b\uff09\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002\u5f53\u4e0e <code>rotate</code> \u53c2\u6570\u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u65cb\u8f6c\u53d8\u6362\u5c06\u5728\u7f29\u5c0f\u53d8\u6362**\u4e4b\u524d**\u6267\u884c\u3002</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_image_filter_module/#image_filter_buffer","title":"image_filter_buffer","text":"- \u8bf4\u660e \u8bed\u6cd5 image_filter_buffer <code>size</code>; \u9ed8\u8ba4 image_filter_buffer 1M; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7528\u4e8e\u8bfb\u53d6\u56fe\u7247\u7684\u7f13\u51b2\u533a\u7684\u6700\u5927\u5927\u5c0f\u3002\u5f53\u8d85\u8fc7\u6307\u5b9a\u5927\u5c0f\u65f6\uff0c\u670d\u52a1\u5668\u8fd4\u56de 415 \u9519\u8bef\u72b6\u6001\u7801\uff08\u4e0d\u652f\u6301\u7684\u5a92\u4f53\u7c7b\u578b\uff09\u3002</p>"},{"location":"Modules-reference/http/ngx_http_image_filter_module/#image_filter_interlace","title":"image_filter_interlace","text":"- \u8bf4\u660e \u8bed\u6cd5 image_filter_interlace <code>on</code> | <code>off</code>; \u9ed8\u8ba4 image_filter_interlace off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.3.15 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5982\u679c\u542f\u7528\u6b64\u9009\u9879\uff0c\u56fe\u7247\u6700\u540e\u5c06\u88ab\u9010\u884c\u626b\u63cf\u3002\u5bf9\u4e8e JPEG\uff0c\u56fe\u7247\u6700\u7ec8\u5c06\u91c7\u7528**\u9010\u884c JPEG** \u683c\u5f0f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_image_filter_module/#image_filter_jpeg_quality","title":"image_filter_jpeg_quality","text":"- \u8bf4\u660e \u8bed\u6cd5 image_filter_jpeg_quality <code>quality</code>; \u9ed8\u8ba4 image_filter_jpeg_quality 75; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e JPEG \u56fe\u7247\u7684\u8f6c\u6362\u8d28\u91cf\u3002\u53ef\u63a5\u53d7\u7684\u503c\u8303\u56f4\u5728 1 \u5230 100 \u4e4b\u95f4\u3002\u8f83\u5c0f\u7684\u503c\u610f\u5473\u7740\u8f83\u4f4e\u7684\u56fe\u7247\u8d28\u91cf\u548c\u8f83\u5c11\u7684\u6570\u636e\u4f20\u8f93\u3002\u6700\u5927\u7684\u63a8\u8350\u503c\u662f 95\uff0c\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002</p>"},{"location":"Modules-reference/http/ngx_http_image_filter_module/#image_filter_sharpen","title":"image_filter_sharpen","text":"- \u8bf4\u660e \u8bed\u6cd5 image_filter_sharpen <code>percent</code>; \u9ed8\u8ba4 image_filter_sharpen 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u589e\u52a0\u6700\u7ec8\u56fe\u50cf\u7684\u6e05\u6670\u5ea6\u3002\u9510\u5ea6\u767e\u5206\u6bd4\u53ef\u4ee5\u8d85\u8fc7 100\u3002\u96f6\u503c\u5c06\u7981\u7528\u9510\u5316\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002</p>"},{"location":"Modules-reference/http/ngx_http_image_filter_module/#image_filter_transparency","title":"image_filter_transparency","text":"- \u8bf4\u660e \u8bed\u6cd5 image_filter_transparency <code>on</code> | <code>off</code>; \u9ed8\u8ba4 image_filter_transparency on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u5728\u4f7f\u7528\u8c03\u8272\u677f\u6307\u5b9a\u7684\u989c\u8272\u8f6c\u6362 GIF \u56fe\u50cf\u6216 PNG \u56fe\u50cf\u65f6\u662f\u5426\u4fdd\u7559\u900f\u660e\u5ea6\u3002\u900f\u660e\u5ea6\u7684\u4e27\u5931\u4f7f\u56fe\u50cf\u7684\u8d28\u91cf\u66f4\u597d\u7684\u3002PNG \u4e2d\u7684 alpha \u901a\u9053\u900f\u660e\u5ea6\u59cb\u7ec8\u4fdd\u7559\u3002</p>"},{"location":"Modules-reference/http/ngx_http_image_filter_module/#image_filter_webp_quality","title":"image_filter_webp_quality","text":"- \u8bf4\u660e \u8bed\u6cd5 image_filter_webp_quality <code>quality</code>; \u9ed8\u8ba4 image_filter_webp_quality 80; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.6 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e WebP \u56fe\u7247\u7684\u8f6c\u6362\u8d28\u91cf\u3002\u53ef\u63a5\u53d7\u7684\u503c\u5728 1 \u5230 100 \u4e4b\u95f4\u3002\u8f83\u5c0f\u7684\u503c\u610f\u5473\u7740\u8f83\u4f4e\u7684\u56fe\u7247\u8d28\u91cf\u548c\u8f83\u5c11\u7684\u6570\u636e\u4f20\u8f93\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002</p>"},{"location":"Modules-reference/http/ngx_http_image_filter_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_image_filter_module.html</p>"},{"location":"Modules-reference/http/ngx_http_index_module/","title":"Ngx http index module","text":"<p>ngx_http_mirror_module# ngx_http_index_module</p> <ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>index</li> </ul> </li> </ul> <p><code>ngx_http_index_module</code> \u6a21\u5757\u5904\u7406\u4ee5\u659c\u7ebf\u5b57\u7b26\uff08<code>/</code>\uff09\u7ed3\u5c3e\u7684\u8bf7\u6c42\u3002\u8fd9\u4e9b\u8bf7\u6c42\u4e5f\u53ef\u4ee5\u7531ngx_http_autoindex_module \u548c ngx_http_random_index_module \u6a21\u5757\u6765\u5904\u7406\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_index_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location / {\nindex index.$geo.html index.html;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_index_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_index_module/#index","title":"index","text":"- \u8bf4\u660e \u8bed\u6cd5 index <code>file ...</code>; \u9ed8\u8ba4 index index.html; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u5c06\u7528\u4f5c\u7d22\u5f15\u7684\u6587\u4ef6\u3002\u6587\u4ef6\u540d\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002\u4ee5\u6307\u5b9a\u7684\u987a\u5e8f\u68c0\u67e5\u6587\u4ef6\u3002\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u53ef\u4ee5\u662f\u4e00\u4e2a\u5177\u6709\u7edd\u5bf9\u8def\u5f84\u7684\u6587\u4ef6\u3002\u4f8b\uff1a</p> <pre><code>index index.$geo.html index.0.html /index.html;\n</code></pre> <p>\u5e94\u8be5\u6ce8\u610f\u7684\u662f\uff0c\u4f7f\u7528\u7d22\u5f15\u6587\u4ef6\u53d1\u8d77\u5185\u90e8\u91cd\u5b9a\u5411\uff0c\u53ef\u4ee5\u5728\u4e0d\u540c\u7684 location \u5904\u7406\u8bf7\u6c42\u3002\u4f8b\u5982\uff0c\u4f7f\u7528\u4ee5\u4e0b\u914d\u7f6e\uff1a</p> <pre><code>location = / {\nindex index.html;\n}\n\nlocation / {\n...\n}\n</code></pre> <p><code>/</code> \u8bf7\u6c42\u5b9e\u9645\u4e0a\u662f\u5c06\u5728\u7b2c\u4e8c\u4e2a location \u5904\u7406\u4e3a <code>/index.html</code>\u3002</p>"},{"location":"Modules-reference/http/ngx_http_index_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_index_module.html</p>"},{"location":"Modules-reference/http/ngx_http_js_module/","title":"ngx_http_js_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>js_include</li> <li>js_content</li> <li> js_set</li> </ul> </li> <li>\u8bf7\u6c42\u4e0e\u54cd\u5e94\u53c2\u6570</li> </ul> <p><code>ngx_http_js_module</code> \u6a21\u5757\u7528\u4e8e\u5728 nginScript \u4e2d\u5b9e\u73b0 location \u548c\u53d8\u91cf\u5904\u7406\u5668 \u2014 \u5b83\u662f JavaScript \u8bed\u8a00\u7684\u4e00\u4e2a\u5b50\u96c6\u3002</p> <p>\u6b64\u6a21\u5757\u4e0d\u662f\u9ed8\u6784\u5efa\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>--add-module</code> \u914d\u7f6e\u53c2\u6570\u4e0e nginScript \u6a21\u5757\u4e00\u8d77\u7f16\u8bd1\uff1a</p> <pre><code>./configure --add-module=path-to-njs/nginx\n</code></pre> <p>\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u514b\u9686 nginScript \u6a21\u5757\u4ed3\u5e93\uff08\u9700\u8981 Mercurial \u5ba2\u6237\u7aef\uff09\uff1a</p> <pre><code>hg clone http://hg.nginx.org/njs\n</code></pre> <p>\u8be5\u6a21\u5757\u4e5f\u53ef\u4ee5\u6784\u5efa\u4e3a\u52a8\u6001\u5f62\u5f0f\uff1a</p> <pre><code>./configure --add-dynamic-module=path-to-njs/nginx\n</code></pre> <p></p>"},{"location":"Modules-reference/http/ngx_http_js_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>js_include http.js;\n\njs_set $foo     foo;\njs_set $summary summary;\n\nserver {\nlisten 8000;\n\nlocation / {\nadd_header X-Foo $foo;\njs_content baz;\n}\n\nlocation /summary {\nreturn 200 $summary;\n}\n}\n</code></pre> <p><code>http.js</code> \u6587\u4ef6\uff1a</p> <pre><code>function foo(req, res) {\nreq.log(\"hello from foo() handler\");\nreturn \"foo\";\n}\n\nfunction summary(req, res) {\nvar a, s, h;\n\ns = \"JS summary\\n\\n\";\n\ns += \"Method: \" + req.method + \"\\n\";\ns += \"HTTP version: \" + req.httpVersion + \"\\n\";\ns += \"Host: \" + req.headers.host + \"\\n\";\ns += \"Remote Address: \" + req.remoteAddress + \"\\n\";\ns += \"URI: \" + req.uri + \"\\n\";\n\ns += \"Headers:\\n\";\nfor (h in req.headers) {\ns += \"  header '\" + h + \"' is '\" + req.headers[h] + \"'\\n\";\n}\n\ns += \"Args:\\n\";\nfor (a in req.args) {\ns += \"  arg '\" + a + \"' is '\" + req.args[a] + \"'\\n\";\n}\n\nreturn s;\n}\n\nfunction baz(req, res) {\nres.headers.foo = 1234;\nres.status = 200;\nres.contentType = \"text/plain; charset=utf-8\";\nres.contentLength = 15;\nres.sendHeader();\nres.send(\"nginx\");\nres.send(\"java\");\nres.send(\"script\");\n\nres.finish();\n}\n</code></pre> <p></p>"},{"location":"Modules-reference/http/ngx_http_js_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_js_module/#js_include","title":"js_include","text":"- \u8bf4\u660e \u8bed\u6cd5 js_include <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u6307\u5b9a\u4e00\u4e2a\u5728 nginScript \u4e2d\u5b9e\u73b0 location \u548c\u53d8\u91cf\u5904\u7406\u5668\u7684\u6587\u4ef6\u3002</p>"},{"location":"Modules-reference/http/ngx_http_js_module/#hls_buffers","title":"hls_buffers","text":"- \u8bf4\u660e \u8bed\u6cd5 js_content <code>function</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 location\u3001limit_except <p>\u5c06 nginScript \u51fd\u6570\u8bbe\u7f6e\u4e3a location \u5185\u5bb9\u5904\u7406\u5668\u3002</p>"},{"location":"Modules-reference/http/ngx_http_js_module/#js_set","title":"js_set","text":"- \u8bf4\u660e \u8bed\u6cd5 js_set <code>$variable function</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.12 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u4e3a\u6307\u5b9a\u53d8\u91cf\u8bbe\u7f6e nginScript \u51fd\u6570\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_js_module/#_3","title":"\u8bf7\u6c42\u4e0e\u54cd\u5e94\u53c2\u6570","text":"<p>\u6bcf\u4e2a HTTP nginScript \u5904\u7406\u5668\u63a5\u6536\u4e24\u4e2a\u53c2\u6570\uff0c\u8bf7\u6c42\u548c\u54cd\u5e94\u3002</p> <p>\u8bf7\u6c42\u5bf9\u8c61\u5177\u6709\u4ee5\u4e0b\u5c5e\u6027\uff1a</p> <ul> <li> <p><code>uri</code></p> <p>\u8bf7\u6c42\u7684\u5f53\u524d URI\uff0c\u53ea\u8bfb</p> </li> <li> <p><code>method</code></p> <p>\u8bf7\u6c42\u65b9\u6cd5\uff0c\u53ea\u8bfb</p> </li> <li> <p><code>httpVersion</code></p> <p>HTTP \u7248\u672c\uff0c\u53ea\u8bfb</p> </li> <li> <p><code>remoteAddress</code></p> <p>\u5ba2\u6237\u7aef\u5730\u5740\uff0c\u53ea\u8bfb</p> </li> <li> <p><code>headers{}</code></p> <p>\u8bf7\u6c42\u5934\u5bf9\u8c61\uff0c\u53ea\u8bfb</p> <p>\u4f8b\u5982\uff0c\u53ef\u4ee5\u4f7f\u7528\u8bed\u6cd5 <code>headers['Header-Name']</code> \u6216 <code>headers.Header_name</code> \u6765\u8bbf\u95ee <code>Header-Name</code> \u5934</p> </li> <li> <p><code>args{}</code></p> <p>\u8bf7\u6c42\u53c2\u6570\u5bf9\u8c61\uff0c\u53ea\u8bfb</p> </li> <li> <p><code>variables{}</code></p> <p>nginx \u53d8\u91cf\u5bf9\u8c61\uff0c\u53ea\u8bfb</p> </li> <li> <p><code>log(string)</code></p> <p>\u5c06 <code>string</code> \u5199\u5165\u9519\u8bef\u65e5\u5fd7</p> </li> </ul> <p>\u54cd\u5e94\u5bf9\u8c61\u5177\u6709\u4ee5\u4e0b\u5c5e\u6027\uff1a</p> <ul> <li> <p><code>status</code></p> <p>\u54cd\u5e94\u72b6\u6001\uff0c\u53ef\u5199</p> </li> <li> <p><code>headers{}</code></p> <p>\u54cd\u5e94\u5934\u5bf9\u8c61</p> </li> <li> <p><code>contentType</code></p> <p>\u54cd\u5e94\u7684 <code>Content-Type</code> \u5934\u5b57\u6bb5\u503c\uff0c\u53ef\u5199</p> </li> <li> <p><code>contentLength</code></p> <p>\u54cd\u5e94\u7684 <code>Content-Length</code> \u5934\u5b57\u6bb5\u503c\uff0c\u53ef\u5199</p> </li> </ul> <p>\u54cd\u5e94\u5bf9\u8c61\u5177\u6709\u4ee5\u4e0b\u65b9\u6cd5\uff1a</p> <ul> <li> <p><code>sendHeader()</code></p> <p>\u5c06 HTTP \u5934\u53d1\u9001\u5230\u5ba2\u6237\u7aef</p> </li> <li> <p><code>send(string)</code></p> <p>\u5c06\u90e8\u5206\u54cd\u5e94\u4f53\u7684\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef</p> </li> <li> <p><code>finish()</code></p> <p>\u5b8c\u6210\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u54cd\u5e94</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_js_module/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_js_module.html</p>"},{"location":"Modules-reference/http/ngx_http_keyval_module/","title":"ngx_http_keyval_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>keyval</li> <li>keyval_zone</li> </ul> </li> </ul> <p><code>ngx_http_keyval_module</code> \u6a21\u5757\uff081.13.3\uff09\u521b\u5efa\u7684\u5e26\u503c\u53d8\u91cf\u4ece API \u7ba1\u7406\u7684\u952e\u503c\u5bf9\u4e2d\u83b7\u53d6\u3002</p> <p>\u8be5\u6a21\u5757\u53ef\u4f5c\u4e3a\u6211\u4eec\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_keyval_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>http {\n\nkeyval_zone zone=one:32k state=one.keyval;\nkeyval $arg_text $text zone=one;\n...\nserver {\n...\nlocation / {\nreturn 200 $text;\n}\n\nlocation /api {\napi write=on;\n}\n}\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_keyval_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_keyval_module/#keyval","title":"keyval","text":"- \u8bf4\u660e \u8bed\u6cd5 keyval <code>key $variable zone=name</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u53d8\u91cf <code>$variable</code>\uff0c\u8be5\u53d8\u91cf\u7684\u503c\u4ece\u952e\u503c\u6570\u636e\u5e93\u4e2d\u901a\u8fc7 <code>key</code> \u67e5\u627e\u3002\u5b57\u7b26\u4e32\u5339\u914d\u5ffd\u7565\u5927\u5c0f\u5199\u3002\u6570\u636e\u5e93\u5b58\u50a8\u5728 <code>zone</code> \u53c2\u6570\u6307\u5b9a\u7684\u5171\u4eab\u5185\u5b58\u533a\u57df\u4e2d\u3002</p>"},{"location":"Modules-reference/http/ngx_http_keyval_module/#keyval_zone","title":"keyval_zone","text":"- \u8bf4\u660e \u8bed\u6cd5 keyval_zone <code>zone=name:size [state=file]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u8bbe\u7f6e\u4fdd\u5b58\u952e\u503c\u6570\u636e\u5e93\u7684\u5171\u4eab\u5185\u5b58\u533a\u57df\u7684\u540d\u79f0\uff08<code>name</code>\uff09\u548c\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u952e\u503c\u5bf9\u7531 API \u7ba1\u7406\u3002</p> <p>\u53ef\u9009\u7684 <code>state</code> \u53c2\u6570\u6307\u5b9a\u4e00\u4e2a\u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u5c06\u952e\u503c\u6570\u636e\u5e93\u7684\u5f53\u524d\u72b6\u6001\u4fdd\u6301\u4e3a JSON \u683c\u5f0f\uff0c\u5e76\u4f7f\u5176\u5728 nginx \u91cd\u542f\u65f6\u4fdd\u6301\u4e0d\u53d8\u3002</p>"},{"location":"Modules-reference/http/ngx_http_keyval_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_keyval_module.html</p>"},{"location":"Modules-reference/http/ngx_http_limit_conn_module/","title":"ngx_http_limit_conn_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>limit_conn</li> <li>limit_conn_log_level</li> <li>limit_conn_status</li> <li>limit_conn_zone</li> <li>limit_zone</li> </ul> </li> </ul> <p><code>ngx_http_limit_conn_module</code> \u6a21\u5757\u7528\u4e8e\u9650\u5236\u6bcf\u4e2a\u5df2\u5b9a\u4e49\u7684 key \u7684\u8fde\u63a5\u6570\u91cf\uff0c\u7279\u522b\u662f\u6765\u81ea\u5355\u4e2a IP \u5730\u5740\u7684\u8fde\u63a5\u6570\u91cf\u3002</p> <p>\u5e76\u975e\u6240\u6709\u7684\u8fde\u63a5\u90fd\u4f1a\u88ab\u8ba1\u6570\u3002\u53ea\u6709\u5f53\u670d\u52a1\u5668\u5904\u7406\u4e86\u8bf7\u6c42\u5e76\u4e14\u5df2\u7ecf\u8bfb\u53d6\u4e86\u6574\u4e2a\u8bf7\u6c42\u5934\u65f6\uff0c\u8fde\u63a5\u624d\u88ab\u8ba1\u6570\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_limit_conn_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>http {\nlimit_conn_zone $binary_remote_addr zone=addr:10m;\n\n...\n\nserver {\n\n...\n\nlocation /download/ {\nlimit_conn addr 1;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_limit_conn_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_limit_conn_module/#limit_conn","title":"limit_conn","text":"- \u8bf4\u660e \u8bed\u6cd5 limit_conn <code>zone number</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7ed9\u5b9a\u952e\u503c\u7684\u5171\u4eab\u5185\u5b58\u533a\u57df\u548c\u6700\u5927\u5141\u8bb8\u8fde\u63a5\u6570\u3002\u5f53\u8d85\u8fc7\u6b64\u9650\u5236\u65f6\uff0c\u670d\u52a1\u5668\u5c06\u8fd4\u56de\u9519\u8bef\u54cd\u5e94\u8bf7\u6c42\u3002\u4f8b\u5982\uff1a</p> <pre><code>limit_conn_zone $binary_remote_addr zone=addr:10m;\n\nserver {\nlocation /download/ {\nlimit_conn addr 1;\n}\n</code></pre> <p>\u540c\u4e00\u65f6\u95f4\u53ea\u5141\u8bb8\u4e00\u4e2a IP \u5730\u5740\u4e00\u4e2a\u8fde\u63a5\u3002</p> <p>\u5728 HTTP/2\u548c SPDY \u4e2d\uff0c\u6bcf\u4e2a\u5e76\u53d1\u8bf7\u6c42\u90fd\u88ab\u89c6\u4e3a\u4e00\u4e2a\u5355\u72ec\u7684\u8fde\u63a5\u3002</p> <p>\u53ef\u4ee5\u6709\u591a\u4e2a <code>limit_conn</code> \u6307\u4ee4\u3002 \u4f8b\u5982\uff0c\u4ee5\u4e0b\u914d\u7f6e\u5c06\u9650\u5236\u6bcf\u4e2a\u5ba2\u6237\u7aef IP \u8fde\u63a5\u5230\u670d\u52a1\u5668\u7684\u6570\u91cf\uff0c\u540c\u65f6\u9650\u5236\u8fde\u63a5\u5230\u865a\u62df\u670d\u52a1\u5668\u7684\u603b\u6570\uff1a</p> <pre><code>limit_conn_zone $binary_remote_addr zone=perip:10m;\nlimit_conn_zone $server_name zone=perserver:10m;\n\nserver {\n...\nlimit_conn perip 10;\nlimit_conn perserver 100;\n}\n</code></pre> <p>\u5f53\u4e14\u4ec5\u5f53\u5728\u5f53\u524d\u7ea7\u522b\u4e0a\u6ca1\u6709 <code>limit_conn</code> \u6307\u4ee4\u65f6\uff0c\u8fd9\u4e9b\u6307\u4ee4\u624d\u4ece\u524d\u4e00\u7ea7\u7ee7\u627f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_limit_conn_module/#limit_conn_log_level","title":"limit_conn_log_level","text":"- \u8bf4\u660e \u8bed\u6cd5 limit_conn_log_level <code>info</code> | <code>notice</code> | <code>warn</code> | <code>error</code>; \u9ed8\u8ba4 limit_conn_log_level error; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.8.18 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5f53\u670d\u52a1\u5668\u9650\u5236\u8fde\u63a5\u6570\u65f6\uff0c\u8bbe\u7f6e\u6240\u9700\u7684\u65e5\u5fd7\u8bb0\u5f55\u7ea7\u522b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_limit_conn_module/#limit_conn_status","title":"limit_conn_status","text":"- \u8bf4\u660e \u8bed\u6cd5 limit_conn_status <code>code</code>; \u9ed8\u8ba4 limit_conn_status 503; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.3.15 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u54cd\u5e94\u62d2\u7edd\u8bf7\u6c42\u8fd4\u56de\u7684\u72b6\u6001\u7801\u3002</p>"},{"location":"Modules-reference/http/ngx_http_limit_conn_module/#limit_conn_zone","title":"limit_conn_zone","text":"- \u8bf4\u660e \u8bed\u6cd5 limit_conn_zone <code>key zone=name:size</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u4e3a\u5171\u4eab\u5185\u5b58\u533a\u57df\u8bbe\u7f6e\u53c2\u6570\uff0c\u8be5\u533a\u57df\u5c06\u4fdd\u7559\u5404\u79cd\u952e\u7684\u72b6\u6001\u3002\u7279\u522b\u662f\uff0c\u8be5\u72b6\u6001\u5305\u542b\u5f53\u524d\u7684\u8fde\u63a5\u6570\u3002<code>key</code> \u53ef\u4ee5\u5305\u542b\u6587\u672c\u3001\u53d8\u91cf\u53ca\u5176\u7ec4\u5408\u3002\u4e0d\u5305\u62ec\u6709\u7a7a\u952e\u503c\u7684\u8bf7\u6c42\u3002</p> <p>\u5728 1.7.6 \u7248\u672c\u4e4b\u524d\uff0c\u4e00\u4e2a key \u53ef\u80fd\u53ea\u5305\u542b\u4e00\u4e2a\u53d8\u91cf\u3002</p> <p>\u7528\u6cd5\u793a\u4f8b\uff1a</p> <pre><code>limit_conn_zone $binary_remote_addr zone=addr:10m;\n</code></pre> <p>\u5728\u8fd9\u91cc\uff0c\u5ba2\u6237\u7aef IP \u5730\u5740\u4f5c\u4e3a key\u3002\u8bf7\u6ce8\u610f\uff0c\u4e0d\u662f <code>$remote_addr</code>\uff0c\u800c\u662f\u4f7f\u7528 <code>$binary_remote_addr</code> \u53d8\u91cf\u3002<code>$remote_addr</code> \u53d8\u91cf\u7684\u5927\u5c0f\u53ef\u4ee5\u4e3a 7 \u5230 15 \u4e2a\u5b57\u8282\u4e0d\u7b49\u3002\u5b58\u50a8\u72b6\u6001\u5728 32 \u4f4d\u5e73\u53f0\u4e0a\u5360\u7528 32 \u6216 64 \u5b57\u8282\u7684\u5185\u5b58\uff0c\u5728 64 \u4f4d\u5e73\u53f0\u4e0a\u603b\u662f\u5360\u7528 64 \u5b57\u8282\u3002\u5bf9\u4e8e IPv4 \u5730\u5740\uff0c<code>$binary_remote_addr</code> \u53d8\u91cf\u7684\u5927\u5c0f\u59cb\u7ec8\u4e3a 4 \u4e2a\u5b57\u8282\uff0c\u5bf9\u4e8e IPv6 \u5730\u5740\u5219\u4e3a 16 \u4e2a\u5b57\u8282\u3002\u5b58\u50a8\u72b6\u6001\u5728 32 \u4f4d\u5e73\u53f0\u4e0a\u59cb\u7ec8\u5360\u7528 32 \u6216 64 \u4e2a\u5b57\u8282\uff0c\u5728 64 \u4f4d\u5e73\u53f0\u4e0a\u5360\u7528 64 \u4e2a\u5b57\u8282\u3002\u4e00\u5146\u5b57\u8282\u7684\u533a\u57df\u53ef\u4ee5\u4fdd\u6301\u5927\u7ea6 32000 \u4e2a 32 \u5b57\u8282\u7684\u72b6\u6001\u6216\u5927\u7ea6 16000 \u4e2a 64 \u5b57\u8282\u7684\u72b6\u6001\u3002\u5982\u679c\u533a\u57df\u5b58\u50a8\u8017\u5c3d\uff0c\u670d\u52a1\u5668\u4f1a\u5c06\u9519\u8bef\u8fd4\u56de\u7ed9\u6240\u6709\u5176\u4f59\u7684\u8bf7\u6c42\u3002</p>"},{"location":"Modules-reference/http/ngx_http_limit_conn_module/#limit_zone","title":"limit_zone","text":"- \u8bf4\u660e \u8bed\u6cd5 limit_zone <code>name $variable size</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u8be5\u6307\u4ee4\u5728 1.1.8 \u7248\u672c\u4e2d\u5df2\u8fc7\u65f6\uff0c\u5e76\u5728 1.7.6 \u7248\u672c\u4e2d\u88ab\u5220\u9664\u3002\u8bf7\u4f7f\u7528\u7b49\u6548 limit_conn_zone \u6307\u4ee4\u4ee3\u66ff\uff1a</p> <p><code>limit_conn_zone $variable zone=name:size;</code></p>"},{"location":"Modules-reference/http/ngx_http_limit_conn_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_limit_conn_module.html</p>"},{"location":"Modules-reference/http/ngx_http_limit_req_module/","title":"ngx_http_limit_req_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>limit_req</li> <li>limit_req_log_level</li> <li>limit_req_status</li> <li>limit_req_zone</li> </ul> </li> </ul> <p><code>ngx_http_limit_req_module</code> \u6a21\u5757\uff080.7.21\uff09\u7528\u4e8e\u9650\u5236\u6bcf\u4e2a\u5df2\u5b9a\u4e49 key \u7684\u8bf7\u6c42\u5904\u7406\u901f\u7387\uff0c\u7279\u522b\u662f\u6765\u81ea\u5355\u4e2a IP \u5730\u5740\u8bf7\u6c42\u7684\u5904\u7406\u901f\u7387\u3002\u9650\u5236\u673a\u5236\u91c7\u7528\u4e86 leaky bucket \uff08\u6f0f\u6876\u7b97\u6cd5\uff09\u65b9\u6cd5\u5b8c\u6210\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_limit_req_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>http {\nlimit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;\n\n...\n\nserver {\n\n...\n\nlocation /search/ {\nlimit_req zone=one burst=5;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_limit_req_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_limit_req_module/#limit_req","title":"limit_req","text":"- \u8bf4\u660e \u8bed\u6cd5 limit_req <code>zone=name [burst=number] [nodelay]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u5171\u4eab\u5185\u5b58\u533a\u57df\u548c\u8bf7\u6c42\u7684\u6700\u5927\u7a81\u53d1\u5927\u5c0f\u3002\u5982\u679c\u8bf7\u6c42\u901f\u7387\u8d85\u8fc7\u4e3a\u67d0\u4e2a\u533a\u57df\u914d\u7f6e\u7684\u901f\u7387\uff0c\u5219\u5b83\u4eec\u7684\u5904\u7406\u4f1a\u5ef6\u8fdf\uff0c\u4ece\u800c\u4f7f\u8bf7\u6c42\u4ee5\u5b9a\u4e49\u7684\u901f\u7387\u5904\u7406\u3002\u8fc7\u591a\u7684\u8bf7\u6c42\u88ab\u5ef6\u8fdf\uff0c\u76f4\u5230\u5b83\u4eec\u7684\u6570\u91cf\u8d85\u8fc7\u6700\u5927\u7a81\u53d1\u5927\u5c0f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u8bf7\u6c42\u88ab\u7ec8\u6b62\u5e76\u51fa\u73b0\u9519\u8bef\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6700\u5927\u7a81\u53d1\u5927\u5c0f\u7b49\u4e8e\u96f6\u3002\u4f8b\u5982\uff1a</p> <pre><code>limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;\n\nserver {\nlocation /search/ {\nlimit_req zone=one burst=5;\n}\n</code></pre> <p>\u5e73\u5747\u6bcf\u79d2\u4e0d\u8d85\u8fc7 1 \u4e2a\u8bf7\u6c42\uff0c\u5e76\u4e14\u7a81\u53d1\u4e0d\u8d85\u8fc7 5 \u4e2a\u8bf7\u6c42\u3002</p> <p>\u5982\u679c\u5728\u9650\u5236\u671f\u95f4\u5ef6\u8fdf\u8bf7\u6c42\u8fc7\u591a\uff0c\u5219\u4e0d\u9700\u8981\u4f7f\u7528\u53c2\u6570 <code>nodelay</code>\uff1a</p> <pre><code>limit_req zone=one burst=5 nodelay;\n</code></pre> <p>\u53ef\u4ee5\u5b58\u5728\u591a\u4e2a <code>limit_req</code> \u6307\u4ee4\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u914d\u7f6e\u5c06\u9650\u5236\u6765\u81ea\u5355\u4e2a IP \u5730\u5740\u8bf7\u6c42\u7684\u5904\u7406\u901f\u7387\uff0c\u540c\u65f6\u9650\u5236\u865a\u62df\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u5904\u7406\u901f\u7387\uff1a</p> <pre><code>limit_req_zone $binary_remote_addr zone=perip:10m rate=1r/s;\nlimit_req_zone $server_name zone=perserver:10m rate=10r/s;\n\nserver {\n...\nlimit_req zone=perip burst=5 nodelay;\nlimit_req zone=perserver burst=10;\n}\n</code></pre> <p>\u5f53\u4e14\u4ec5\u5f53\u5728\u5f53\u524d\u7ea7\u522b\u4e0a\u6ca1\u6709 <code>limit_req</code> \u6307\u4ee4\u65f6\uff0c\u8fd9\u4e9b\u6307\u4ee4\u624d\u4ece\u4e0a\u4e00\u7ea7\u7ee7\u627f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_limit_req_module/#limit_req_log_level","title":"limit_req_log_level","text":"- \u8bf4\u660e \u8bed\u6cd5 limit_req_log_level <code>info</code> | <code>notice</code> | <code>warn</code> | <code>error</code>; \u9ed8\u8ba4 limit_req_log_level error; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.8.18 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5f53\u670d\u52a1\u5668\u7531\u4e8e\u901f\u7387\u8d85\u51fa\u800c\u62d2\u7edd\u5904\u7406\u8bf7\u6c42\u6216\u5ef6\u8fdf\u8bf7\u6c42\u5904\u7406\u65f6\uff0c\u8bbe\u7f6e\u6240\u9700\u7684\u65e5\u5fd7\u8bb0\u5f55\u7ea7\u522b\u3002\u5ef6\u8bef\u60c5\u51b5\u7684\u8bb0\u5f55\u7b49\u7ea7\u6bd4\u62d2\u7edd\u60c5\u51b5\u7684\u8bb0\u5f55\u4f4e\u4e00\u4e9b\u3002\u4f8b\u5982\uff0c\u5982\u679c\u6307\u5b9a\u4e86 <code>limit_req_log_level notice</code>\uff0c\u5219\u5ef6\u8fdf\u60c5\u51b5\u5c06\u4f1a\u5728 <code>info</code> \u7ea7\u522b\u8bb0\u5f55\u3002</p>"},{"location":"Modules-reference/http/ngx_http_limit_req_module/#limit_req_status","title":"limit_req_status","text":"- \u8bf4\u660e \u8bed\u6cd5 limit_req_status <code>code</code>; \u9ed8\u8ba4 limit_req_status 503; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.3.15 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u54cd\u5e94\u62d2\u7edd\u8bf7\u6c42\u8fd4\u56de\u7684\u72b6\u6001\u7801\u3002</p>"},{"location":"Modules-reference/http/ngx_http_limit_req_module/#limit_req_zone","title":"limit_req_zone","text":"- \u8bf4\u660e \u8bed\u6cd5 limit_req_zone <code>key zone=name:size rate=rate</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u4e3a\u5171\u4eab\u5185\u5b58\u533a\u57df\u8bbe\u7f6e\u53c2\u6570\uff0c\u8be5\u533a\u57df\u5c06\u4fdd\u7559\u5404\u79cd\u952e\u7684\u72b6\u6001\u3002\u7279\u522b\u662f\uff0c\u8be5\u72b6\u6001\u5305\u542b\u5f53\u524d\u7684\u8fde\u63a5\u6570\u3002<code>key</code> \u53ef\u4ee5\u5305\u542b\u6587\u672c\u3001\u53d8\u91cf\u53ca\u5176\u7ec4\u5408\u3002\u4e0d\u5305\u62ec\u6709\u7a7a\u952e\u503c\u7684\u8bf7\u6c42\u3002</p> <p>\u5728 1.7.6 \u7248\u672c\u4e4b\u524d\uff0c\u4e00\u4e2a <code>key</code> \u53ef\u80fd\u53ea\u5305\u542b\u4e00\u4e2a\u53d8\u91cf\u3002</p> <p>\u7528\u6cd5\u793a\u4f8b\uff1a</p> <pre><code>limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;\n</code></pre> <p>\u5728\u8fd9\u91cc\uff0c\u72b6\u6001\u4fdd\u6301\u5728 10 \u5146\u5b57\u8282\u7684\u533a\u57df one\uff0c\u5e76\u4e14\u8be5\u533a\u57df\u7684\u5e73\u5747\u8bf7\u6c42\u5904\u7406\u901f\u7387\u4e0d\u80fd\u8d85\u8fc7\u6bcf\u79d2 1 \u4e2a\u8bf7\u6c42\u3002</p> <p>\u5ba2\u6237\u7aef IP \u5730\u5740\u4f5c\u4e3a key\u3002\u8bf7\u6ce8\u610f\uff0c\u4e0d\u662f <code>$remote_addr</code>\uff0c\u800c\u662f\u4f7f\u7528 <code>$binary_remote_addr</code> \u53d8\u91cf\u3002<code>$binary_remote_addr</code> \u53d8\u91cf\u7684\u5927\u5c0f\u59cb\u7ec8\u4e3a 4 \u4e2a\u5b57\u8282\uff0c\u5bf9\u4e8e IPv6 \u5730\u5740\u5219\u4e3a 16 \u4e2a\u5b57\u8282\u3002\u5b58\u50a8\u72b6\u6001\u5728 32 \u4f4d\u5e73\u53f0\u4e0a\u59cb\u7ec8\u5360\u7528 32 \u6216 64 \u4e2a\u5b57\u8282\uff0c\u5728 64 \u4f4d\u5e73\u53f0\u4e0a\u5360\u7528 64 \u4e2a\u5b57\u8282\u3002\u4e00\u5146\u5b57\u8282\u7684\u533a\u57df\u53ef\u4ee5\u4fdd\u6301\u5927\u7ea6 32000 \u4e2a 32 \u5b57\u8282\u7684\u72b6\u6001\u6216\u5927\u7ea6 16000 \u4e2a 64 \u5b57\u8282\u7684\u72b6\u6001\u6216\u5927\u7ea6 8000 \u4e2a 128 \u5b57\u8282\u7684\u72b6\u6001\u3002</p> <p>\u5982\u679c\u533a\u57df\u5b58\u50a8\u8017\u5c3d\uff0c\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u72b6\u6001\u5c06\u88ab\u5220\u9664\u3002\u5373\u4f7f\u5728\u6b64\u4e4b\u540e\u65e0\u6cd5\u521b\u5efa\u65b0\u72b6\u6001\uff0c\u8be5\u8bf7\u6c42\u4e5f\u4f1a\u56e0\u9519\u8bef\u800c\u7ec8\u6b62\u3002</p> <p>\u901f\u7387\u4ee5\u6bcf\u79d2\u8bf7\u6c42\u6570\uff08r/s\uff09\u6307\u5b9a\u3002\u5982\u679c\u9700\u8981\u6bcf\u79d2\u5c0f\u4e8e\u4e00\u4e2a\u8bf7\u6c42\u7684\u901f\u7387\uff0c\u5219\u6309\u6bcf\u5206\u949f\u8bf7\u6c42\uff08r/m\uff09\u6307\u5b9a\u3002\u4f8b\u5982\uff0c\u6bcf\u79d2\u534a\u8bf7\u6c42\u662f 30r/m\u3002</p>"},{"location":"Modules-reference/http/ngx_http_limit_req_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_limit_req_module.html</p>"},{"location":"Modules-reference/http/ngx_http_log_module/","title":"ngx_http_log_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>access_log</li> <li>log_format</li> <li>open_log_file_cache</li> </ul> </li> </ul> <p><code>ngx_http_log_module</code> \u6a21\u5757\u53ef\u8ba9\u8bf7\u6c42\u65e5\u5fd7\u4ee5\u6307\u5b9a\u7684\u683c\u5f0f\u5199\u5165\u3002</p> <p>\u8bf7\u6c42\u4f1a\u5728\u5904\u7406\u7ed3\u675f\u7684 location \u7684\u4e0a\u4e0b\u6587\u4e2d\u8bb0\u5f55\u3002\u5982\u679c\u5728\u8bf7\u6c42\u5904\u7406\u671f\u95f4\u53d1\u751f\u5185\u90e8\u91cd\u5b9a\u5411\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u4e0e\u539f\u59cb location \u4e0d\u540c\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_log_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>log_format compression '$remote_addr - $remote_user [$time_local] '\n'\"$request\" $status $bytes_sent '\n'\"$http_referer\" \"$http_user_agent\" \"$gzip_ratio\"';\n\naccess_log /spool/logs/nginx-access.log compression buffer=32k;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_log_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_log_module/#access_log","title":"access_log","text":"- \u8bf4\u660e \u8bed\u6cd5 access_log <code>path [format [buffer=size] [gzip[=level]] [flush=time] [if=condition]]</code>;  access_log <code>off</code>; \u9ed8\u8ba4 access_log logs/access.log combined; \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001location \u4e2d\u7684 if\u3001limit_except <p>\u8bbe\u7f6e\u7f13\u51b2\u65e5\u5fd7\u5199\u5165\u7684\u8def\u5f84\u3001\u683c\u5f0f\u548c\u914d\u7f6e\u3002\u53ef\u4ee5\u5728\u540c\u4e00\u7ea7\u522b\u6307\u5b9a\u591a\u4e2a\u65e5\u5fd7\u3002\u53ef\u4ee5\u901a\u8fc7\u5728\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e2d\u6307\u5b9a <code>syslog:</code> \u524d\u7f00\u914d\u7f6e\u5c06\u65e5\u5fd7\u8bb0\u5f55\u5230 syslog\u3002\u7279\u6b8a\u503c <code>off</code> \u53d6\u6d88\u5f53\u524d\u7ea7\u522b\u7684\u6240\u6709 <code>access_log</code> \u6307\u4ee4\u3002\u5982\u679c\u672a\u6307\u5b9a\u683c\u5f0f\uff0c\u5219\u4f7f\u7528\u9884\u5b9a\u4e49\u7684 <code>combined</code> \u683c\u5f0f\u3002</p> <p>\u5982\u679c\u4f7f\u7528\u7f13\u51b2\u533a\u6216 <code>gzip</code> \u53c2\u6570\uff081.3.10\u30011.2.7\uff09\uff0c\u5219\u65e5\u5fd7\u5199\u5165\u5c06\u88ab\u7f13\u51b2\u3002</p> <p>\u7f13\u51b2\u533a\u5927\u5c0f\u4e0d\u5f97\u8d85\u8fc7\u539f\u5b50\u5199\u5165\u78c1\u76d8\u6587\u4ef6\u7684\u5927\u5c0f\u3002\u5bf9\u4e8e FreeBSD\uff0c\u8be5\u5927\u5c0f\u662f\u65e0\u9650\u7684\u3002</p> <p>\u542f\u7528\u7f13\u51b2\u65f6\uff0c\u4ee5\u4e0b\u60c5\u51b5\u6570\u636e\u5c06\u88ab\u5199\u5165\u6587\u4ef6\u4e2d\uff1a</p> <ul> <li>\u5982\u679c\u4e0b\u4e00\u4e2a\u65e5\u5fd7\u884c\u4e0d\u9002\u5408\u653e\u5165\u7f13\u51b2\u533a</li> <li>\u5982\u679c\u7f13\u51b2\u6570\u636e\u6bd4 <code>flush\u53c2\u6570</code>\u6307\u5b9a\u7684\u66f4\u65e7\uff081.3.10,1.2.7\uff09</li> <li>\u5f53 worker \u8fdb\u7a0b\u91cd\u65b0\u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\u6216\u6b63\u5728\u5173\u95ed\u65f6</li> </ul> <p>\u5982\u679c\u4f7f\u7528 <code>gzip</code> \u53c2\u6570\uff0c\u90a3\u4e48\u5728\u5199\u5165\u6587\u4ef6\u4e4b\u524d\uff0c\u7f13\u51b2\u7684\u6570\u636e\u5c06\u88ab\u538b\u7f29\u3002\u538b\u7f29\u7ea7\u522b\u53ef\u4ee5\u8bbe\u7f6e\u5728 1\uff08\u6700\u5feb\u3001\u8f83\u5c11\u538b\u7f29\uff09\u548c 9\uff08\u6700\u6162\u3001\u6700\u4f73\u538b\u7f29\uff09\u4e4b\u95f4\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u51b2\u533a\u5927\u5c0f\u7b49\u4e8e 64K \u5b57\u8282\uff0c\u538b\u7f29\u7ea7\u522b\u8bbe\u7f6e\u4e3a 1\u3002\u7531\u4e8e\u6570\u636e\u662f\u4ee5\u539f\u5b50\u5757\u7684\u5f62\u5f0f\u538b\u7f29\u7684\uff0c\u56e0\u6b64\u65e5\u5fd7\u6587\u4ef6\u53ef\u4ee5\u968f\u65f6\u89e3\u538b\u7f29\u6216\u7531 <code>zcat</code> \u8bfb\u53d6\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>access_log /path/to/log.gz combined gzip flush=5m;\n</code></pre> <p>\u8981\u4f7f gzip \u538b\u7f29\u8d77\u4f5c\u7528\uff0c\u5fc5\u987b\u5728\u6784\u5efa nginx \u65f6\u4f7f\u7528 zlib \u5e93\u3002</p> <p>\u6587\u4ef6\u8def\u5f84\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff080.7.6+\uff09\uff0c\u4f46\u5b58\u5728\u4e00\u4e9b\u9650\u5236\uff1a</p> <ul> <li>\u88ab woker \u8fdb\u7a0b\u4f7f\u7528\u51ed\u636e\u7684\u7528\u6237\u5e94\u6709\u5728\u6b64\u7c7b\u65e5\u5fd7\u5728\u76ee\u5f55\u4e2d\u521b\u5efa\u6587\u4ef6\u7684\u6743\u9650</li> <li>\u7f13\u51b2\u5199\u5165\u4e0d\u8d77\u4f5c\u7528</li> <li>\u8be5\u6587\u4ef6\u5728\u6bcf\u6b21\u65e5\u5fd7\u5199\u5165\u90fd\u8981\u6253\u5f00\u548c\u5173\u95ed\u3002\u7136\u800c\uff0c\u7531\u4e8e\u5e38\u7528\u6587\u4ef6\u7684\u63cf\u8ff0\u7b26\u53ef\u4ee5\u5b58\u50a8\u5728\u7f13\u5b58\u4e2d\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728 open_log_file_cache \u6307\u4ee4\u7684 <code>valid</code> \u53c2\u6570\u6307\u5b9a\u7684\u65f6\u95f4\u5185\u7ee7\u7eed\u5199\u5165\u65e7\u6587\u4ef6</li> <li>\u5728\u6bcf\u6b21\u5199\u5165\u65e5\u5fd7\u671f\u95f4\uff0c\u68c0\u67e5\u8bf7\u6c42\u6839\u76ee\u5f55\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5219\u4e0d\u521b\u5efa\u65e5\u5fd7\u3002\u56e0\u6b64\uff0c\u5728\u540c\u4e00\u7ea7\u522b\u6307\u5b9a root \u548c access_log \u662f\u4e00\u4e2a\u597d\u65b9\u6cd5\uff1a</li> </ul> <pre><code>server {\nroot       /spool/vhost/data/$host;\naccess_log /spool/vhost/logs/$host;\n...\n</code></pre> <p><code>if</code> \u53c2\u6570\uff081.7.0\uff09\u542f\u7528\u6761\u4ef6\u65e5\u5fd7\u8bb0\u5f55\u3002\u5982\u679c <code>condition</code>\u4e3a <code>0</code> \u6216\u7a7a\u5b57\u7b26\u4e32\uff0c\u5219\u4e0d\u4f1a\u8bb0\u5f55\u8bf7\u6c42\u3002\u5728\u4ee5\u4e0b\u793a\u4f8b\u4e2d\uff0c\u4e0d\u4f1a\u8bb0\u5f55\u54cd\u5e94\u4ee3\u7801\u4e3a 2xx \u548c 3xx \u7684\u8bf7\u6c42\uff1a</p> <pre><code>map $status $loggable {\n~^[23]  0;\ndefault 1;\n}\n\naccess_log /path/to/access.log combined if=$loggable;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_log_module/#log_format","title":"log_format","text":"- \u8bf4\u660e \u8bed\u6cd5 log_format <code>name [escape=default\\|json\\|none] string ...</code>; \u9ed8\u8ba4 log_format combined \"...\"; \u4e0a\u4e0b\u6587 http <p>\u6307\u5b9a\u65e5\u5fd7\u683c\u5f0f\u3002</p> <p><code>escape</code> \u53c2\u6570\uff081.11.8\uff09\u5141\u8bb8\u8bbe\u7f6e <code>json</code> \u6216 <code>default</code> \u5b57\u7b26\u5728\u53d8\u91cf\u4e2d\u8f6c\u4e49\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f7f\u7528 <code>default</code> \u8f6c\u4e49\u3002<code>none</code> \u53c2\u6570\uff081.13.10\uff09\u7981\u7528\u8f6c\u4e49\u3002</p> <p>\u65e5\u5fd7\u683c\u5f0f\u53ef\u4ee5\u5305\u542b\u516c\u5171\u53d8\u91cf\u548c\u4ec5\u5728\u65e5\u5fd7\u5199\u5165\u65f6\u5b58\u5728\u7684\u53d8\u91cf\uff1a</p> <ul> <li> <p><code>$bytes_sent</code></p> <p>\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u7684\u5b57\u8282\u6570</p> </li> <li> <p><code>$connection</code></p> <p>\u8fde\u63a5\u5e8f\u5217\u53f7</p> </li> <li> <p><code>$connection_requests</code></p> <p>\u5f53\u524d\u901a\u8fc7\u8fde\u63a5\u53d1\u51fa\u7684\u8bf7\u6c42\u6570\u91cf\uff081.1.18\uff09</p> </li> <li> <p><code>$msec</code></p> <p>\u4ee5\u79d2\u4e3a\u5355\u4f4d\u7684\u65f6\u95f4\uff0c\u65e5\u5fd7\u5199\u5165\u65f6\u7684\u6beb\u79d2\u7cbe\u5ea6</p> </li> <li> <p><code>$pipe</code></p> <p>\u5982\u679c\u8bf7\u6c42\u662f pipe\uff0c\u5219\u4e3a p\uff0c\u5426\u5219\u4e3a .</p> </li> <li> <p><code>$request_length</code></p> <p>\u8bf7\u6c42\u957f\u5ea6\uff08\u5305\u62ec\u8bf7\u6c42\u884c\u3001\u5934\u90e8\u548c\u8bf7\u6c42\u4f53\uff09</p> </li> <li> <p><code>$request_time</code></p> <p>\u4ee5\u6beb\u79d2\u4e3a\u7cbe\u5ea6\u7684\u8bf7\u6c42\u5904\u7406\u65f6\u95f4\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002\u4ece\u5ba2\u6237\u7aef\u8bfb\u53d6\u7b2c\u4e00\u4e2a\u5b57\u8282\u5230\u6700\u540e\u4e00\u4e2a\u5b57\u8282\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u5e76\u5199\u5165\u65e5\u5fd7\u8fc7\u7a0b\u7684\u65f6\u95f4</p> </li> <li> <p><code>$status</code></p> <p>\u54cd\u5e94\u72b6\u6001</p> </li> <li> <p><code>$time_iso8601</code></p> <p>\u672c\u5730\u65f6\u95f4\u91c7\u7528 ISO 8601 \u6807\u51c6\u683c\u5f0f</p> </li> <li> <p><code>$time_local</code></p> <p>\u672c\u5730\u65f6\u95f4\u91c7\u7528\u901a\u7528\u65e5\u5fd7\u683c\u5f0f\uff08Common Log Format\uff09</p> </li> </ul> <p>\u5728\u73b0\u4ee3 nginx \u7248\u672c\u4e2d\uff0c\u53d8\u91cf status](ngx_http_core_module.md#var_status)\uff081.3.2\u30011.2.2\uff09\u3001[bytes_sent\uff081.3.8\u30011.2.5\uff09\u3001connection](ngx_http_core_module.md#var_connection)\uff081.3.8\u30011.2.5\uff09\u3001[connection](ngx_http_core_module.md#var_connection)\uff081.3.8\u30011.2.5\uff09\u3001[connection_requests\uff081.3.8\u30011.2.5\uff09\u3001msec](ngx_http_core_module.md#var_msec)\uff081.3.9\u30011.2.6\uff09\u3001[msec](ngx_http_core_module.md#var_msec)\uff081.3.9\u30011.2.6\uff09\u3001[request_time\uff081.3.9\u30011.2.6\uff09\u3001pipe](ngx_http_core_module.md#var_pipe)\uff081.3.12\u30011.2.7\uff09\u3001<code>$request_length</code>\uff081.3.12\u30011.2.7\uff09\u3001[\uff081.3.12\u30011.2.7\uff09\u3001[pipe](ngx_http_core_module.md#var_pipe)\uff081.3.12\u30011.2.7\uff09\u3001&lt;code&gt;$request_length&lt;/code&gt;\uff081.3.12\u30011.2.7\uff09\u3001[\uff081.3.12\u30011.2.7\uff09\u3001[time_iso8601\uff081.3.12\u30011.2.7\uff09\u548c $time_local\uff081.3.12\u30011.2.7\uff09\u4e5f\u4f5c\u4e3a\u516c\u5171\u53d8\u91cf\u3002</p> <p>\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u7684\u5934\u5b57\u6bb5\u524d\u7f00\u4e3a <code>sent_http_</code>\uff0c\u4f8b\u5982 <code>$sent_http_content_range</code>\u3002</p> <p>\u914d\u7f6e\u59cb\u7ec8\u5305\u542b\u9884\u5b9a\u4e49\u7684 <code>combined</code> \u683c\u5f0f\uff1a</p> <pre><code>log_format combined '$remote_addr - $remote_user [$time_local] '\n'\"$request\" $status $body_bytes_sent '\n'\"$http_referer\" \"$http_user_agent\"';\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_log_module/#open_log_file_cache","title":"open_log_file_cache","text":"- \u8bf4\u660e \u8bed\u6cd5 open_log_file_cache <code>max=N [inactive=time] [min_uses=N] [valid=time]</code>;  open_log_file_cache <code>off</code>; \u9ed8\u8ba4 open_log_file_cache off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e00\u4e2a\u7f13\u5b58\uff0c\u7528\u4e8e\u5b58\u50a8\u540d\u79f0\u4e2d\u5305\u542b\u53d8\u91cf\u7684\u5e38\u7528\u65e5\u5fd7\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002\u8be5\u6307\u4ee4\u6709\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <ul> <li> <p><code>max</code></p> <p>\u8bbe\u7f6e\u7f13\u5b58\u4e2d\u63cf\u8ff0\u7b26\u7684\u6700\u5927\u6570\u91cf\u3002\u5982\u679c\u7f13\u5b58\u53d8\u6ee1\uff0c\u5219\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\uff08LRU\uff09\u7684\u63cf\u8ff0\u7b26\u5c06\u88ab\u5173\u95ed</p> </li> <li> <p><code>inactive</code></p> <p>\u5982\u679c\u5728\u6b64\u65f6\u95f4\u540e\u7f13\u5b58\u63cf\u8ff0\u7b26\u6ca1\u6709\u88ab\u8bbf\u95ee\uff0c\u5219\u88ab\u5173\u95ed\uff0c\u9ed8\u8ba4\u4e3a 10 \u79d2</p> </li> <li> <p><code>min_uses</code></p> <p>\u5728 <code>inactive</code> \u53c2\u6570\u5b9a\u4e49\u7684\u65f6\u95f4\u5185\u8bbe\u7f6e\u6587\u4ef6\u4f7f\u7528\u7684\u6700\u5c0f\u6570\u91cf\uff0c\u4ee5\u4f7f\u63cf\u8ff0\u7b26\u5728\u7f13\u5b58\u4e2d\u4fdd\u6301\u6253\u5f00\u72b6\u6001\uff0c\u9ed8\u8ba4\u4e3a 1</p> </li> <li> <p><code>valid</code></p> <p>\u8bbe\u7f6e\u68c0\u67e5\u540c\u540d\u6587\u4ef6\u662f\u5426\u4ecd\u7136\u5b58\u5728\u7684\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4e3a 60 \u79d2</p> </li> <li> <p><code>off</code></p> <p>\u7981\u7528\u7f13\u5b58</p> </li> </ul> <p>\u4f7f\u7528\u793a\u4f8b\uff1a</p> <pre><code>open_log_file_cache max=1000 inactive=20s valid=1m min_uses=2;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_log_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_log_module.html</p>"},{"location":"Modules-reference/http/ngx_http_map_module/","title":"ngx_http_map_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>map</li> <li>map_hash_bucket_size</li> <li>map_hash_max_size</li> </ul> </li> </ul> <p><code>ngx_http_map_module</code> \u6a21\u5757\u521b\u5efa\u7684\u53d8\u91cf\u7684\u503c\u53d6\u51b3\u4e8e\u5176\u4ed6\u53d8\u91cf\u503c\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_map_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>map $http_host $name {\nhostnames;\n\ndefault       0;\n\nexample.com   1;\n*.example.com 1;\nexample.org   2;\n*.example.org 2;\n.example.net  3;\nwap.*         4;\n}\n\nmap $http_user_agent $mobile {\ndefault       0;\n\"~Opera Mini\" 1;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_map_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_map_module/#map","title":"map","text":"- \u8bf4\u660e \u8bed\u6cd5 map <code>string $variable { ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u521b\u5efa\u4e00\u4e2a\u65b0\u53d8\u91cf\uff0c\u5176\u503c\u53d6\u51b3\u4e8e\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e2d\u6307\u5b9a\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u6e90\u53d8\u91cf\u7684\u503c\u3002</p> <p>\u5728 0.9.0 \u7248\u672c\u4e4b\u524d\uff0c\u53ea\u80fd\u5728\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e2d\u6307\u5b9a\u4e00\u4e2a\u53d8\u91cf\u3002</p> <p>\u7531\u4e8e\u53ea\u6709\u5728\u4f7f\u7528\u53d8\u91cf\u65f6\u624d\u8ba1\u7b97\u53d8\u91cf\u7684\u503c\uff0c\u56e0\u6b64\u4ec5\u4ec5\u58f0\u660e\u5927\u91cf\u7684 <code>map</code> \u53d8\u91cf\u4e5f\u4e0d\u4f1a\u589e\u52a0\u989d\u5916\u8bf7\u6c42\u5904\u7406\u8d1f\u8377\u3002</p> <p><code>map</code> \u5757\u5185\u7684\u53c2\u6570\u6307\u5b9a\u6e90\u548c\u7ed3\u679c\u503c\u4e4b\u95f4\u7684\u6620\u5c04\u3002</p> <p>\u6e90\u503c\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u6216\u6b63\u5219\u8868\u8fbe\u5f0f\uff080.9.6\uff09\u3002</p> <p>\u5b57\u7b26\u4e32\u5339\u914d\u5c06\u5ffd\u7565\u5927\u5c0f\u5199\u3002</p> <p>\u6b63\u5219\u8868\u8fbe\u5f0f\u5e94\u8be5\u4ee5\u533a\u5206\u5927\u5c0f\u5199\u5339\u914d\u7684 <code>\u301c</code> \u7b26\u53f7\u5f00\u59cb\uff0c\u6216\u8005\u4ee5\u533a\u5206\u5927\u5c0f\u5199\u5339\u914d\u7684 <code>\u301c*</code> \u7b26\u53f7\u5f00\u59cb\uff081.0.4\uff09\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u53ef\u4ee5\u5305\u542b\u547d\u540d\u548c\u4f4d\u7f6e\u6355\u83b7\uff0c\u4e4b\u540e\u53ef\u4ee5\u5c06\u5176\u7528\u4e8e\u5176\u4ed6\u6307\u4ee4\u548c\u4f5c\u4e3a\u7ed3\u679c\u53d8\u91cf\u3002</p> <p>\u5982\u679c\u6e90\u503c\u4e0e\u4e0b\u9762\u63cf\u7f57\u5217\u7684\u7279\u6b8a\u53c2\u6570\u540d\u79f0\u4e4b\u4e00\u76f8\u5339\u914d\uff0c\u5219\u5e94\u8be5\u4ee5 <code>\\</code> \u7b26\u53f7\u4e3a\u524d\u7f00\u8f6c\u4e49\u3002</p> <p>\u7ed3\u679c\u503c\u53ef\u4ee5\u5305\u542b\u6587\u672c\uff0c\u53d8\u91cf\uff080.9.0\uff09\u53ca\u5176\u7ec4\u5408\uff081.11.0\uff09\u3002</p> <p>\u8fd8\u652f\u6301\u4ee5\u4e0b\u7279\u6b8a\u53c2\u6570\uff1a</p> <ul> <li> <p><code>default</code></p> <p>\u5982\u679c\u6e90\u503c\u4e0d\u5339\u914d\u6307\u5b9a\u53d8\u4f53\uff0c\u5219\u8bbe\u7f6e\u7ed3\u679c\u503c\u3002\u5982\u679c\u672a\u6307\u5b9a <code>default</code>\uff0c\u5219\u9ed8\u8ba4\u7ed3\u679c\u503c\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002</p> </li> <li> <p><code>hostname</code></p> <p>\u8868\u793a\u6e90\u503c\u53ef\u4ee5\u662f\u5177\u6709\u524d\u7f00\u6216\u540e\u7f00\u63a9\u7801\u7684\u4e3b\u673a\u540d\uff1a</p> <pre><code>*.example.com 1;\nexample.*     1;\n</code></pre> <p>\u4ee5\u4e0b\u4e24\u6761\u8bb0\u5f55</p> <pre><code>example.com 1;\n* .example.com 1;\n````\n\n\u53ef\u4ee5\u5408\u5e76\uff1a\n\n```nginx\n.example.com 1;\n</code></pre> <p>\u8fd9\u4e2a\u53c2\u6570\u5e94\u8be5\u5728\u503c\u5217\u8868\u4e4b\u524d\u6307\u5b9a\u3002</p> </li> <li> <p><code>include file</code></p> <p>\u5305\u542b\u4e00\u4e2a\u5305\u542b\u503c\u7684\u6587\u4ef6\u3002\u53ef\u4ee5\u6709\u591a\u4e2a\u5305\u542b\u3002</p> </li> <li> <p><code>volatile</code></p> <p>\u8868\u793a\u8be5\u53d8\u91cf\u4e0d\u53ef\u7f13\u5b58\uff081.11.7\uff09</p> </li> </ul> <p>\u5982\u679c\u6e90\u503c\u5339\u914d\u591a\u4e8e\u4e00\u4e2a\u6307\u5b9a\u7684\u53d8\u4f53\uff0c\u4f8b\u5982 \u63a9\u7801\u548c\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u65f6\uff0c\u5c06\u6309\u7167\u4ee5\u4e0b\u4f18\u5148\u7ea7\u987a\u5e8f\u9009\u62e9\u7b2c\u4e00\u4e2a\u5339\u914d\u53d8\u4f53\uff1a</p> <ol> <li>\u6ca1\u6709\u63a9\u7801\u7684\u5b57\u7b26\u4e32\u503c</li> <li>\u5e26\u6709\u524d\u7f00\u63a9\u7801\u7684\u6700\u957f\u5b57\u7b26\u4e32\u503c\uff0c\u4f8b\u5982 <code>*.example.com</code></li> <li>\u5e26\u6709\u540e\u7f00\u63a9\u7801\u7684\u6700\u957f\u5b57\u7b26\u4e32\u503c\uff0c\u4f8b\u5982 <code>mail.*</code></li> <li>\u9996\u5148\u5339\u914d\u6b63\u5219\u8868\u8fbe\u5f0f\uff08\u6309\u7167\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u51fa\u73b0\u7684\u987a\u5e8f\uff09</li> <li>\u9ed8\u8ba4\u503c</li> </ol>"},{"location":"Modules-reference/http/ngx_http_map_module/#map_hash_bucket_size","title":"map_hash_bucket_size","text":"- \u8bf4\u660e \u8bed\u6cd5 map_hash_bucket_size <code>size</code>; \u9ed8\u8ba4 map_hash_bucket_size 32|64|128; \u4e0a\u4e0b\u6587 http <p>\u8bbe\u7f6e map \u53d8\u91cf\u54c8\u5e0c\u8868\u7684\u6876\u5927\u5c0f\u3002\u9ed8\u8ba4\u503c\u53d6\u51b3\u4e8e\u5904\u7406\u5668\u7684\u7f13\u5b58\u884c\u5927\u5c0f\u3002\u8bbe\u7f6e\u54c8\u5e0c\u8868\u7684\u8be6\u7ec6\u5185\u5bb9\u53ef\u5728\u5355\u72ec\u7684\u6587\u6863\u4e2d\u627e\u5230\u3002</p>"},{"location":"Modules-reference/http/ngx_http_map_module/#map_hash_max_size","title":"map_hash_max_size","text":"- \u8bf4\u660e \u8bed\u6cd5 map_hash_max_size <code>size</code>; \u9ed8\u8ba4 map_hash_max_size 2048; \u4e0a\u4e0b\u6587 http <p>\u8bbe\u7f6e map \u53d8\u91cf\u54c8\u5e0c\u8868\u7684\u6700\u5927\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u8bbe\u7f6e\u54c8\u719f\u8868\u7684\u8be6\u7ec6\u5185\u5bb9\u53ef\u5728\u5355\u72ec\u7684\u6587\u6863\u4e2d\u627e\u5230\u3002</p>"},{"location":"Modules-reference/http/ngx_http_map_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_map_module.html</p>"},{"location":"Modules-reference/http/ngx_http_memcached_module/","title":"ngx_http_memcached_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>memcached_bind</li> <li>memcached_buffer_size</li> <li>memcached_connect_timeout</li> <li>memcached_force_ranges</li> <li>memcached_gzip_flag</li> <li>memcached_next_upstream</li> <li>memcached_next_upstream_timeout</li> <li>memcached_next_upstream_tries</li> <li>memcached_pass</li> <li>memcached_read_timeout</li> <li>memcached_send_timeout</li> </ul> </li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_http_memcached_module</code> \u6a21\u5757\u7528\u4e8e\u4ece memcached \u670d\u52a1\u5668\u4e0a\u83b7\u53d6\u54cd\u5e94\u3002key \u8bbe\u7f6e\u5728 <code>$memcached_key</code> \u53d8\u91cf\u4e2d\u3002\u5e94\u901a\u8fc7 nginx \u4e4b\u5916\u7684\u65b9\u5f0f\u63d0\u524d\u5c06\u54cd\u5e94\u653e\u5165 memcached\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_memcached_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>server {\nlocation / {\nset            $memcached_key \"$uri?$args\";\nmemcached_pass host:11211;\nerror_page     404 502 504 = @fallback;\n}\n\nlocation @fallback {\nproxy_pass     http://backend;\n}\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_memcached_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_memcached_module/#memcached_bind","title":"memcached_bind","text":"- \u8bf4\u660e \u8bed\u6cd5 memcached_bind <code>address [transparent ]</code> | <code>off</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.8.22 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8fde\u63a5\u5230\u4e00\u4e2a\u6307\u5b9a\u4e86\u672c\u5730 IP \u5730\u5740\u548c\u53ef\u9009\u7aef\u53e3\uff081.11.2\uff09\u7684 memcached \u670d\u52a1\u5668\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.3.12\uff09\u3002\u7279\u6b8a\u503c <code>off</code> \uff081.3.12\uff09\u53d6\u6d88\u4ece\u4e0a\u5c42\u914d\u7f6e\u7ea7\u522b\u7ee7\u627f\u7684 <code>memcached_bind</code> \u6307\u4ee4\u7684\u4f5c\u7528\uff0c\u5176\u5141\u8bb8\u7cfb\u7edf\u81ea\u52a8\u5206\u914d\u672c\u5730 IP \u5730\u5740\u548c\u7aef\u53e3\u3002</p> <p><code>transparent</code> \u53c2\u6570\uff081.11.0\uff09\u5141\u8bb8\u51fa\u7ad9\u4ece\u975e\u672c\u5730 IP \u5730\u5740\u5230 memcached \u670d\u52a1\u5668\u7684\u8fde\u63a5\uff08\u4f8b\u5982\uff0c\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u771f\u5b9e IP \u5730\u5740\uff09\uff1a</p> <pre><code>memcached_bind $remote_addr transparent;\n</code></pre> <p>\u4e3a\u4e86\u4f7f\u8fd9\u4e2a\u53c2\u6570\u8d77\u4f5c\u7528\uff0c\u901a\u5e38\u9700\u8981\u4ee5\u8d85\u7ea7\u7528\u6237\u6743\u9650\u8fd0\u884c nginx worker \u8fdb\u7a0b\u3002\u5728 Linux \u4e0a\uff0c\u4e0d\u9700\u8981\u6307\u5b9a <code>transparent</code> \u53c2\u6570\uff0c\u5de5\u4f5c\u8fdb\u7a0b\u4f1a\u7ee7\u627f master \u8fdb\u7a0b\u7684 <code>CAP_NET_RAW</code> \u529f\u80fd\u3002\u6b64\u5916\uff0c\u8fd8\u8981\u914d\u7f6e\u5185\u6838\u8def\u7531\u8868\u6765\u62e6\u622a\u6765\u81ea memcached \u670d\u52a1\u5668\u7684\u7f51\u7edc\u6d41\u91cf\u3002</p>"},{"location":"Modules-reference/http/ngx_http_memcached_module/#memcached_buffer_size","title":"memcached_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 memcached_buffer_size <code>size</code>; \u9ed8\u8ba4 memcached_buffer_size 4k|8k \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7528\u4e8e\u8bfb\u53d6\u4ece memcached \u670d\u52a1\u5668\u6536\u5230\u7684\u54cd\u5e94\u7684\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u4e00\u65e6\u6536\u5230\u54cd\u5e94\uff0c\u54cd\u5e94\u4fbf\u4f1a\u540c\u6b65\u4f20\u9001\u7ed9\u5ba2\u6237\u7aef\u3002</p>"},{"location":"Modules-reference/http/ngx_http_memcached_module/#memcached_connect_timeout","title":"memcached_connect_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 memcached_connect_timeout <code>time</code>; \u9ed8\u8ba4 memcached_connect_timeout 60s \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e0e memcached \u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u9700\u8981\u8bf4\u660e\u7684\u662f\uff0c\u8d85\u65f6\u901a\u5e38\u4e0d\u80fd\u8d85\u8fc7 75 \u79d2\u3002</p>"},{"location":"Modules-reference/http/ngx_http_memcached_module/#memcached_force_ranges","title":"memcached_force_ranges","text":"- \u8bf4\u660e \u8bed\u6cd5 memcached_force_ranges <code>on</code> | <code>off</code>; \u9ed8\u8ba4 memcached_force_ranges off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u65e0\u8bba\u54cd\u5e94\u4e2d\u7684 Accept-Ranges \u5b57\u6bb5\u5982\u4f55\uff0c\u90fd\u5bf9\u6765\u81ea memcached \u670d\u52a1\u5668\u7684\u7f13\u5b58\u548c\u672a\u7f13\u5b58\u7684\u54cd\u5e94\u542f\u7528 byte-range \u652f\u6301\u3002</p>"},{"location":"Modules-reference/http/ngx_http_memcached_module/#memcached_gzip_flag","title":"memcached_gzip_flag","text":"- \u8bf4\u660e \u8bed\u6cd5 memcached_gzip_flag <code>flag</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.3.6 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u5bf9 memcached \u670d\u52a1\u5668\u54cd\u5e94\u4e2d\u7684 <code>flag</code> \u5b58\u5728\u6d4b\u8bd5\uff0c\u5e76\u5728 flag \u8bbe\u7f6e\u65f6\u5c06 Content-Encoding \u54cd\u5e94\u5934\u5b57\u6bb5\u8bbe\u7f6e\u4e3a gzip\u3002</p>"},{"location":"Modules-reference/http/ngx_http_memcached_module/#memcached_next_upstream","title":"memcached_next_upstream","text":"- \u8bf4\u660e \u8bed\u6cd5 memcached_next_upstream <code>error</code> | <code>timeout</code> | <code>invalid_response</code> | <code>not_found</code> | <code>off ...</code>; \u9ed8\u8ba4 memcached_next_upstream error timeout; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u5b9a\u5728\u54ea\u4e9b\u60c5\u51b5\u4e0b\u8bf7\u6c42\u5e94\u4f20\u9012\u7ed9\u4e0b\u4e00\u53f0\u670d\u52a1\u5668\uff1a</p> <ul> <li> <p><code>error</code></p> <p>\u5728\u4e0e\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u3001\u4f20\u9012\u8bf7\u6c42\u6216\u8bfb\u53d6\u54cd\u5e94\u5934\u65f6\u53d1\u751f\u9519\u8bef</p> </li> <li> <p><code>timeout</code></p> <p>\u5728\u4e0e\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u3001\u4f20\u9012\u8bf7\u6c42\u6216\u8bfb\u53d6\u54cd\u5e94\u5934\u65f6\u53d1\u751f\u8d85\u65f6</p> </li> <li> <p><code>invalid_response</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u7a7a\u6216\u65e0\u6548\u7684\u54cd\u5e94</p> </li> <li> <p><code>not_found</code></p> <p>\u5728\u670d\u52a1\u5668\u4e0a\u672a\u627e\u5230\u54cd\u5e94</p> </li> <li> <p><code>off</code></p> <p>\u7981\u7528\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u3002</p> </li> </ul> <p>\u6211\u4eec\u5e94\u8be5\u8bb0\u4f4f\uff0c\u53ea\u6709\u5728\u6ca1\u6709\u4efb\u4f55\u5185\u5bb9\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u80fd\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u5728\u54cd\u5e94\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\u6216\u8d85\u65f6\uff0c\u4fee\u590d\u8fd9\u6837\u7684\u9519\u8bef\u662f\u4e0d\u53ef\u80fd\u7684\u3002</p> <p>\u8be5\u6307\u4ee4\u8fd8\u5b9a\u4e49\u4e86\u4e0e\u670d\u52a1\u5668\u8fdb\u884c\u901a\u4fe1\u7684\u5931\u8d25\u5c1d\u8bd5\u3002<code>error</code>\u3001<code>timeout</code> \u548c <code>invalid_response</code> \u7684\u60c5\u51b5\u59cb\u7ec8\u88ab\u89c6\u4e3a\u5931\u8d25\u5c1d\u8bd5\uff0c\u5373\u4f7f\u5b83\u4eec\u6ca1\u6709\u5728\u6307\u4ee4\u4e2d\u6307\u5b9a\u3002<code>not_found</code> \u7684\u60c5\u51b5\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u89c6\u4e3a\u5931\u8d25\u5c1d\u8bd5\u3002</p> <p>\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u53ef\u80fd\u53d7\u5230\u5c1d\u8bd5\u6b21\u6570\u548c\u65f6\u95f4\u7684\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_memcached_module/#memcached_next_upstream_tries","title":"memcached_next_upstream_tries","text":"- \u8bf4\u660e \u8bed\u6cd5 memcached_next_upstream_tries <code>number</code>; \u9ed8\u8ba4 memcached_next_upstream_tries 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.5 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236\u5c1d\u8bd5\u5c06\u8bf7\u6c42\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u6b21\u6570\u3002<code>0</code> \u503c\u8868\u793a\u5173\u95ed\u6b64\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_memcached_module/#memcached_pass","title":"memcached_pass","text":"- \u8bf4\u660e \u8bed\u6cd5 memcached_pass <code>address</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001location \u4e2d if <p>\u8bbe\u7f6e memcached \u670d\u52a1\u5668\u5730\u5740\u3002\u8be5\u5730\u5740\u53ef\u4ee5\u6307\u5b9a\u4e3a\u57df\u540d\u6216 IP \u5730\u5740\u4ee5\u53ca\u7aef\u53e3\uff1a</p> <pre><code>memcached_pass localhost:11211;\n</code></pre> <p>\u6216\u4f7f\u7528 UNIX \u57df\u5957\u63a5\u5b57\u8def\u5f84\uff1a</p> <pre><code>memcached_pass unix:/tmp/memcached.socket;\n</code></pre> <p>\u5982\u679c\u57df\u540d\u89e3\u6790\u4e3a\u591a\u4e2a\u5730\u5740\uff0c\u5219\u8fd9\u4e9b\u5730\u5740\u5c06\u4ee5\u5faa\u73af\u65b9\u5f0f\u4f7f\u7528\u3002\u53e6\u5916\uff0c\u5730\u5740\u53ef\u4ee5\u88ab\u6307\u5b9a\u4e3a\u670d\u52a1\u5668\u7ec4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_memcached_module/#memcached_read_timeout","title":"memcached_read_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 memcached_read_timeout <code>time</code>; \u9ed8\u8ba4 memcached_read_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location memcached \u5b9a\u4e49\u4ece gRPC \u670d\u52a1\u5668\u8bfb\u53d6\u54cd\u5e94\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u8d85\u65f6\u95f4\u9694\u53ea\u5728\u4e24\u6b21\u8fde\u7eed\u7684\u8bfb\u64cd\u4f5c\u4e4b\u95f4\uff0c\u800c\u4e0d\u662f\u6574\u4e2a\u54cd\u5e94\u7684\u4f20\u8f93\u8fc7\u7a0b\u3002\u5982\u679c memcached \u670d\u52a1\u5668\u5728\u6b64\u65f6\u95f4\u5185\u6ca1\u6709\u53d1\u9001\u4efb\u4f55\u5185\u5bb9\uff0c\u5219\u8fde\u63a5\u5173\u95ed\u3002"},{"location":"Modules-reference/http/ngx_http_memcached_module/#memcached_send_timeout","title":"memcached_send_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 memcached_send_timeout <code>time</code>; \u9ed8\u8ba4 memcached_send_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u5c06\u8bf7\u6c42\u4f20\u8f93\u5230 memcached \u670d\u52a1\u5668\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u8d85\u65f6\u95f4\u9694\u53ea\u5728\u4e24\u6b21\u8fde\u7eed\u5199\u5165\u64cd\u4f5c\u4e4b\u95f4\uff0c\u800c\u4e0d\u662f\u6574\u4e2a\u8bf7\u6c42\u7684\u4f20\u8f93\u8fc7\u7a0b\u3002\u5982\u679c memcached \u670d\u52a1\u5668\u5728\u6b64\u65f6\u95f4\u5185\u6ca1\u6709\u6536\u5230\u4efb\u4f55\u5185\u5bb9\uff0c\u5219\u8fde\u63a5\u5c06\u5173\u95ed\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_memcached_module/#_3","title":"\u5185\u5d4c\u53d8\u91cf","text":"<ul> <li> <p><code>$memcached_key</code></p> <p>\u5b9a\u4e49\u4ece memcached \u670d\u52a1\u5668\u83b7\u53d6\u54cd\u5e94\u7684\u5bc6\u94a5</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_memcached_module/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_memcached_module.html</p>"},{"location":"Modules-reference/http/ngx_http_mirror_module/","title":"ngx_http_mirror_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>mirror</li> <li>mirror_request_body</li> </ul> </li> </ul> <p><code>ngx_http_mirror_module</code> \u6a21\u5757\uff081.13.4\uff09\u901a\u8fc7\u521b\u5efa\u540e\u53f0\u955c\u50cf\u5b50\u8bf7\u6c42\u6765\u5b9e\u73b0\u539f\u59cb\u8bf7\u6c42\u7684\u955c\u50cf\u3002\u955c\u50cf\u5b50\u8bf7\u6c42\u7684\u54cd\u5e94\u5c06\u88ab\u5ffd\u7565\u3002</p> <p>\u8bd1\u8005\u6ce8\uff1a\u5229\u7528 mirror \u6a21\u5757\uff0c\u4e1a\u52a1\u53ef\u4ee5\u5c06\u7ebf\u4e0a\u5b9e\u65f6\u8bbf\u95ee\u6d41\u91cf\u62f7\u8d1d\u81f3\u5176\u4ed6\u73af\u5883\uff0c\u57fa\u4e8e\u8fd9\u4e9b\u6d41\u91cf\u53ef\u4ee5\u505a\u7248\u672c\u53d1\u5e03\u524d\u7684\u9884\u5148\u9a8c\u8bc1\uff0c\u8fdb\u884c\u6d41\u91cf\u653e\u5927\u540e\u7684\u538b\u6d4b\u7b49\u7b49\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_mirror_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location / {\nmirror /mirror;\nproxy_pass http://backend;\n}\n\nlocation /mirror {\ninternal;\nproxy_pass http://test_backend$request_uri;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_mirror_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_mirror_module/#mirror","title":"mirror","text":"- \u8bf4\u660e \u8bed\u6cd5 mirror <code>uri</code> | <code>off</code>; \u9ed8\u8ba4 mirror off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u5c06\u505a\u6210\u955c\u50cf\u7684\u539f\u59cb\u8bf7\u6c42\u7684 URI\u3002\u53ef\u4ee5\u5728\u540c\u4e00\u5c42\u7ea7\u4e0a\u6307\u5b9a\u591a\u4e2a\u955c\u50cf\uff08\u8bd1\u8005\u6ce8: \u591a\u6b21\u91cd\u590d\u4e00\u4e2a\u955c\u50cf\u53ef\u4ee5\u5b9e\u73b0\u6d41\u91cf\u653e\u5927\uff09\u3002</p>"},{"location":"Modules-reference/http/ngx_http_mirror_module/#mirror_request_body","title":"mirror_request_body","text":"- \u8bf4\u660e \u8bed\u6cd5 mirror_request_body <code>on</code> | <code>off</code>; \u9ed8\u8ba4 mirror_request_body on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u793a\u662f\u5426\u5c06\u5ba2\u6237\u7aef\u8bf7\u6c42\u4f53\u505a\u6210\u955c\u50cf\u3002\u542f\u7528\u540e\uff0c\u5c06\u5728\u521b\u5efa\u955c\u50cf\u5b50\u8bf7\u6c42\u4e4b\u524d\u8bfb\u53d6\u5ba2\u6237\u7aef\u8bf7\u6c42\u4f53\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u7981\u7528\u7531 proxy_request_buffering\u3001fastcgi_request_buffering\u3001scgi_request_buffering \u548c uwsgi_request_buffering \u6307\u4ee4\u8bbe\u7f6e\u7684\u672a\u7f13\u51b2\u7684\u5ba2\u6237\u7aef\u8bf7\u6c42\u6b63\u4ee3\u7406\u3002</p> <pre><code>location / {\nmirror /mirror;\nmirror_request_body off;\nproxy_pass http://backend;\n}\n\nlocation /mirror {\ninternal;\nproxy_pass http://log_backend;\nproxy_pass_request_body off;\nproxy_set_header Content-Length \"\";\nproxy_set_header X-Original-URI $request_uri;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_mirror_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_mirror_module.html</p>"},{"location":"Modules-reference/http/ngx_http_mp4_module/","title":"ngx_http_mp4_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>mp4</li> <li>mp4_buffer_size</li> <li>mp4_max_buffer_size</li> <li>mp4_limit_rate</li> <li>mp4_limit_rate_after</li> </ul> </li> </ul> <p><code>ngx_http_mp4_module</code> \u6a21\u5757\u4e3a MP4 \u6587\u4ef6\u63d0\u4f9b\u4f2a\u6d41\u670d\u52a1\u7aef\u652f\u6301\u3002\u8fd9\u4e9b\u6587\u4ef6\u7684\u6269\u5c55\u540d\u901a\u5e38\u4e3a <code>.mp4</code>\u3001<code>.m4v</code> \u6216 <code>.m4a</code>\u3002</p> <p>\u4f2a\u6d41\u4e0e\u517c\u5bb9\u7684 Flash \u64ad\u653e\u5668\u53ef\u4ee5\u5f88\u597d\u5730\u914d\u5408\u5de5\u4f5c\u3002\u64ad\u653e\u5668\u5728\u67e5\u8be2\u5b57\u7b26\u4e32\u53c2\u6570\u4e2d\u6307\u5b9a\u7684\u5f00\u59cb\u65f6\u95f4\u5411\u670d\u52a1\u5668\u53d1\u9001 HTTP \u8bf7\u6c42\uff08\u7b80\u5355\u5730\u4ee5 <code>start</code> \u547d\u540d\u5e76\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09\uff0c\u670d\u52a1\u5668\u4ee5\u6d41\u54cd\u5e94\u65b9\u5f0f\u4f7f\u5176\u8d77\u59cb\u4f4d\u7f6e\u4e0e\u8bf7\u6c42\u7684\u65f6\u95f4\u76f8\u5bf9\u5e94\uff0c\u4f8b\u5982\uff1a</p> <pre><code>http://example.com/elephants_dream.mp4?start=238.88\n</code></pre> <p>\u8fd9\u5c06\u5141\u8bb8\u968f\u65f6\u6267\u884c\u968f\u673a\u67e5\u627e\uff0c\u6216\u8005\u5728\u65f6\u95f4\u7ebf\u4e2d\u95f4\u5f00\u59cb\u56de\u653e\u3002</p> <p>\u4e3a\u4e86\u652f\u6301\u641c\u7d22\uff0c\u57fa\u4e8e H.264 \u7684\u683c\u5f0f\u5c06\u5143\u6570\u636e\u5b58\u50a8\u5728\u6240\u8c13\u7684 moov atom \u4e2d\u3002\u5b83\u662f\u4fdd\u5b58\u6574\u4e2a\u6587\u4ef6\u7d22\u5f15\u4fe1\u606f\u6587\u4ef6\u7684\u4e00\u90e8\u5206\u3002</p> <p>\u8981\u5f00\u59cb\u64ad\u653e\uff0c\u64ad\u653e\u5668\u9996\u5148\u9700\u8981\u8bfb\u53d6\u5143\u6570\u636e\u3002\u901a\u8fc7\u53d1\u9001\u4e00\u4e2a\u6709 <code>start=0</code> \u53c2\u6570\u7684\u7279\u6b8a\u8bf7\u6c42\u6765\u5b8c\u6210\u7684\u3002\u8bb8\u591a\u7f16\u7801\u8f6f\u4ef6\u5728\u6587\u4ef6\u7684\u672b\u5c3e\u63d2\u5165\u5143\u6570\u636e\u3002\u8fd9\u5bf9\u4e8e\u4f2a\u6d41\u64ad\u6765\u8bf4\u5f88\u7cdf\u7cd5\uff0c\u56e0\u4e3a\u64ad\u653e\u5668\u5fc5\u987b\u5728\u5f00\u59cb\u64ad\u653e\u4e4b\u524d\u4e0b\u8f7d\u6574\u4e2a\u6587\u4ef6\u3002\u5982\u679c\u5143\u6570\u636e\u4f4d\u4e8e\u6587\u4ef6\u7684\u5f00\u5934\uff0c\u90a3\u4e48 nginx \u5c31\u53ef\u4ee5\u7b80\u5355\u5730\u5f00\u59cb\u53d1\u56de\u6587\u4ef6\u5185\u5bb9\u3002\u5982\u679c\u5143\u6570\u636e\u4f4d\u4e8e\u6587\u4ef6\u672b\u5c3e\uff0cnginx \u5fc5\u987b\u8bfb\u53d6\u6574\u4e2a\u6587\u4ef6\u5e76\u51c6\u5907\u4e00\u4e2a\u65b0\u6d41\uff0c\u4ee5\u4fbf\u5143\u6570\u636e\u4f4d\u4e8e\u5a92\u4f53\u6570\u636e\u4e4b\u524d\u3002\u8fd9\u6d89\u53ca\u5230\u4e00\u4e9b CPU\u3001\u5185\u5b58\u548c\u78c1\u76d8 I/O \u5f00\u9500\uff0c\u6240\u4ee5\u6700\u597d\u4e8b\u5148\u51c6\u5907\u4e00\u4e2a\u7528\u4e8e\u4f2a\u6d41\u4f20\u8f93\u7684\u539f\u59cb\u6587\u4ef6\uff0c\u800c\u4e0d\u662f\u8ba9 nginx \u5728\u6bcf\u4e2a\u8fd9\u6837\u7684\u8bf7\u6c42\u4e0a\u90fd\u8fd9\u6837\u5904\u7406\u3002</p> <p>\u8be5\u6a21\u5757\u8fd8\u652f\u6301\u8bbe\u7f6e\u64ad\u653e\u7ed3\u675f\u70b9\u7684 HTTP \u8bf7\u6c42\uff081.5.13\uff09\u7684 <code>end</code> \u53c2\u6570\u3002<code>end</code> \u53c2\u6570\u53ef\u4ee5\u4e0e <code>start</code> \u53c2\u6570\u4e00\u8d77\u6307\u5b9a\u6216\u5355\u72ec\u6307\u5b9a\uff1a</p> <pre><code>http://example.com/elephants_dream.mp4?start=238.88&amp;end=555.55\n</code></pre> <p>\u5bf9\u4e8e\u6709\u975e\u96f6 <code>start</code> \u6216 <code>end</code> \u53c2\u6570\u7684\u5339\u914d\u8bf7\u6c42\uff0cnginx \u5c06\u4ece\u6587\u4ef6\u4e2d\u8bfb\u53d6\u5143\u6570\u636e\uff0c\u51c6\u5907\u6709\u6240\u9700\u65f6\u95f4\u8303\u56f4\u7684\u6d41\u5e76\u5c06\u5176\u53d1\u9001\u5230\u5ba2\u6237\u7aef \u8fd9\u4e0e\u4e0a\u9762\u63cf\u8ff0\u7684\u5f00\u9500\u76f8\u540c\u3002</p> <p>\u5982\u679c\u5339\u914d\u8bf7\u6c42\u4e0d\u5305\u542b <code>start</code> \u548c <code>end</code> \u53c2\u6570\uff0c\u5219\u4e0d\u4f1a\u6709\u5f00\u9500\uff0c\u5e76\u4e14\u6587\u4ef6\u4ec5\u4f5c\u4e3a\u9759\u6001\u8d44\u6e90\u53d1\u9001\u3002\u6709\u4e9b\u64ad\u653e\u5668\u4e5f\u652f\u6301 byte-range \u8bf7\u6c42\uff0c\u56e0\u6b64\u4e0d\u9700\u8981\u8fd9\u4e2a\u6a21\u5757\u3002</p> <p>\u8be5\u6a21\u5757\u4e0d\u662f\u9ed8\u8ba4\u6784\u5efa\u7684\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>--with-http_mp4_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p>\u5982\u679c\u4ee5\u524d\u4f7f\u7528\u8fc7\u7b2c\u4e09\u65b9 mp4 \u6a21\u5757\uff0c\u5219\u5e94\u8be5\u7981\u7528\u5b83\u3002</p> <p>ngx_http_flv_module \u6a21\u5757\u63d0\u4f9b\u4e86\u5bf9 FLV \u6587\u4ef6\u7684\u7c7b\u4f2a\u6d41\u5f0f\u7684\u652f\u6301\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_mp4_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location /video/ {\nmp4;\nmp4_buffer_size       1m;\nmp4_max_buffer_size   5m;\nmp4_limit_rate        on;\nmp4_limit_rate_after  30s;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_mp4_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_mp4_module/#mp4","title":"mp4","text":"- \u8bf4\u660e \u8bed\u6cd5 mp4; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 location <p>\u542f\u7528\u5bf9 location \u6a21\u5757\u5904\u7406\u3002</p>"},{"location":"Modules-reference/http/ngx_http_mp4_module/#mp4_buffer_size","title":"mp4_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 mp4_buffer_size <code>size</code>; \u9ed8\u8ba4 mp4_buffer_size 512K; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7528\u4e8e\u5904\u7406 MP4 \u6587\u4ef6\u7684\u7f13\u51b2\u533a\u7684\u521d\u59cb\u5927\u5c0f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_mp4_module/#mp4_max_buffer_size","title":"mp4_max_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 mp4_max_buffer_size <code>time</code>; \u9ed8\u8ba4 mp4_max_buffer_size 10M; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5728\u5143\u6570\u636e\u5904\u7406\u671f\u95f4\uff0c\u53ef\u80fd\u9700\u8981\u66f4\u5927\u7684\u7f13\u51b2\u533a\u3002\u5b83\u7684\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7\u6307\u5b9a\u7684\u5927\u5c0f\uff0c\u5426\u5219 nginx \u5c06\u8fd4\u56de 500\uff08\u5185\u90e8\u670d\u52a1\u5668\u9519\u8bef\uff09\u9519\u8bef\u72b6\u6001\u7801\uff0c\u5e76\u8bb0\u5f55\u4ee5\u4e0b\u6d88\u606f\uff1a</p> <pre><code>\"/some/movie/file.mp4\" mp4 moov atom is too large:\n12583268, you may want to increase mp4_max_buffer_size\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_mp4_module/#mp4_limit_rate","title":"mp4_limit_rate","text":"- \u8bf4\u660e \u8bed\u6cd5 mp4_limit_rate <code>on</code> | <code>off</code> | <code>factor</code>; \u9ed8\u8ba4 p4_limit_rate off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u9650\u5236\u5bf9\u5ba2\u6237\u54cd\u5e94\u7684\u4f20\u8f93\u901f\u7387\u3002\u901f\u7387\u9650\u5236\u57fa\u4e8e\u6240\u63d0\u4f9b MP4 \u6587\u4ef6\u7684\u5e73\u5747\u6bd4\u7279\u7387\u3002\u8981\u8ba1\u7b97\u901f\u7387\uff0c\u6bd4\u7279\u7387\u5c06\u4e58\u4ee5\u6307\u5b9a\u7684 <code>factor</code>\u3002\u7279\u6b8a\u503c <code>on</code> \u5bf9\u5e94\u4e8e\u56e0\u5b50 1.1 \u3002\u7279\u6b8a\u503c <code>off</code> \u7981\u7528\u901f\u7387\u9650\u5236\u3002\u9650\u5236\u662f\u6839\u636e\u8bf7\u6c42\u8bbe\u7f6e\u7684\uff0c\u6240\u4ee5\u5982\u679c\u5ba2\u6237\u7aef\u540c\u65f6\u6253\u5f00\u4e24\u4e2a\u8fde\u63a5\uff0c\u603b\u4f53\u901f\u7387\u5c06\u662f\u6307\u5b9a\u9650\u5236\u7684\u4e24\u500d\u3002</p> <p>\u8be5\u6307\u4ee4\u53ef\u4f5c\u4e3a\u6211\u4eec\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\u3002</p>"},{"location":"Modules-reference/http/ngx_http_mp4_module/#mp4_limit_rate_after","title":"mp4_limit_rate_after","text":"- \u8bf4\u660e \u8bed\u6cd5 mp4_limit_rate_after <code>time</code>; \u9ed8\u8ba4 mp4_limit_rate_after 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u5a92\u4f53\u6570\u636e\u7684\u521d\u59cb\u6570\u91cf\uff08\u5728\u56de\u653e\u65f6\u8ba1\u7b97\uff09\uff0c\u4e4b\u540e\u8fdb\u4e00\u6b65\u4f20\u8f93\u5230\u5ba2\u6237\u7aef\u7684\u54cd\u5e94\u5c06\u53d7\u5230\u901f\u7387\u9650\u5236\u3002</p> <p>\u8be5\u6307\u4ee4\u53ef\u4f5c\u4e3a\u6211\u4eec\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\u3002</p>"},{"location":"Modules-reference/http/ngx_http_mp4_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_mp4_module.html</p>"},{"location":"Modules-reference/http/ngx_http_perl_module/","title":"ngx_http_perl_module","text":"<ul> <li>\u6307\u4ee4</li> <li>\u5df2\u77e5\u95ee\u9898<ul> <li>perl</li> <li>perl_modules</li> <li>perl_require</li> <li>perl_set</li> </ul> </li> <li>\u4ece SSI \u8c03\u7528 Perl</li> <li>$r \u8bf7\u6c42\u5bf9\u8c61\u65b9\u6cd5</li> </ul> <p><code>ngx_http_perl_module</code> \u6a21\u5757\u7528\u4e8e\u5728 Perl \u4e2d\u5b9e\u73b0 location \u548c\u53d8\u91cf\u5904\u7406\u5668\uff0c\u5e76\u5c06 Perl \u8c03\u7528\u63d2\u5165\u5230 SSI\u4e2d\u3002</p> <p>\u6b64\u6a21\u5757\u4e0d\u662f\u9ed8\u8ba4\u6784\u5efa\uff0c\u53ef\u4ee5\u5728\u6784\u5efa\u65f6\u4f7f\u7528 <code>--with-http_perl_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p>\u8be5\u6a21\u5757\u9700\u8981 Perl 5.6.1 \u6216\u66f4\u9ad8\u7248\u672c\u3002C \u7f16\u8bd1\u5668\u5e94\u8be5\u4e0e\u7528\u4e8e\u6784\u5efaPerl \u7684\u7f16\u8bd1\u5668\u517c\u5bb9\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_perl_module/#_1","title":"\u5df2\u77e5\u7684\u95ee\u9898","text":"<p>\u8be5\u6a21\u5757\u8fd8\u5904\u4e8e\u5b9e\u9a8c\u9636\u6bb5\uff0c\u4ee5\u4e0b\u662f\u4e00\u4e9b\u6ce8\u610f\u4e8b\u9879\u3002</p> <p>\u4e3a\u4e86\u8ba9 Perl \u80fd\u5728\u91cd\u65b0\u914d\u7f6e\u8fc7\u7a0b\u4e2d\u91cd\u65b0\u7f16\u8bd1\u5df2\u4fee\u6539\u7684\u6a21\u5757\uff0c\u5e94\u4f7f\u7528 <code>-Dusemultiplicity=yes</code> \u6216 <code>-Dusethreads=yes</code> \u53c2\u6570\u6765\u6784\u5efa\u5b83\u3002\u53e6\u5916\uff0c\u4e3a\u4e86\u8ba9 Perl \u5728\u8fd0\u884c\u65f6\u6cc4\u6f0f\u66f4\u5c11\u7684\u5185\u5b58\uff0c\u5e94\u4f7f\u7528 <code>-Dusemymalloc=no</code> \u53c2\u6570\u6765\u6784\u5efa\u5b83\u3002\u8981\u68c0\u67e5\u5df2\u6784\u5efa\u7684 Perl \u4e2d\u8fd9\u4e9b\u53c2\u6570\u503c\uff08\u5728\u793a\u4f8b\u4e2d\u5df2\u6307\u5b9a\u9996\u9009\u503c\uff09\uff0c\u8bf7\u8fd0\u884c\uff1a</p> <pre><code>$ perl -V:usemultiplicity -V:usemymalloc\nusemultiplicity='define';\nusemymalloc='n';\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u5728\u4f7f\u7528\u65b0\u7684 <code>-Dusemultiplicity=yes</code> \u6216 <code>-Dusethreads=yes</code> \u53c2\u6570\u91cd\u65b0\u6784\u5efa Perl \u4e4b\u540e\uff0c\u6240\u6709\u4e8c\u8fdb\u5236 Perl \u6a21\u5757\u4e5f\u5fc5\u987b\u91cd\u65b0\u6784\u5efa \u2014 \u5426\u5219\u5b83\u4eec\u5c06\u505c\u6b62\u4f7f\u7528\u65b0\u7684 Perl\u3002</p> <p>\u5728\u6bcf\u6b21\u91cd\u65b0\u914d\u7f6e\u540e\uff0cmaster \u8fdb\u7a0b\u548c worker \u8fdb\u7a0b\u90fd\u6709\u53ef\u80fd\u589e\u52a0\u3002\u5982\u679c master \u8fdb\u7a0b\u589e\u52a0\u5230\u4e0d\u53ef\u63a5\u53d7\u7684\u5927\u5c0f\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u5b9e\u65f6\u5347\u7ea7\u6d41\u7a0b\u800c\u65e0\u9700\u66f4\u6539\u53ef\u6267\u884c\u6587\u4ef6\u3002</p> <p>\u5f53 Perl \u6a21\u5757\u6267\u884c\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u64cd\u4f5c\u65f6\uff0c\u4f8b\u5982\u89e3\u6790\u57df\u540d\u3001\u8fde\u63a5\u5230\u53e6\u4e00\u53f0\u670d\u52a1\u5668\u6216\u67e5\u8be2\u6570\u636e\u5e93\u65f6\uff0c\u5c06\u4e0d\u4f1a\u5904\u7406\u5206\u914d\u7ed9\u5f53\u524d worker \u8fdb\u7a0b\u7684\u5176\u4ed6\u8bf7\u6c42\u3002\u56e0\u6b64\uff0c\u5efa\u8bae\u4ec5\u6267\u884c\u53ef\u9884\u6d4b\u4e14\u6267\u884c\u65f6\u95f4\u77ed\u7684\u64cd\u4f5c\uff0c\u4f8b\u5982\u8bbf\u95ee\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_perl_module/#_2","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>http {\n\nperl_modules perl/lib;\nperl_require hello.pm;\n\nperl_set $msie6 '\n\nsub {\nmy $r = shift;\nmy $ua = $r-&gt;header_in(\"User-Agent\");\n\nreturn \"\" if $ua =~ /Opera/;\nreturn \"1\" if $ua =~ / MSIE [6-9]\\.\\d+/;\nreturn \"\";\n}\n\n';\n\nserver {\nlocation / {\nperl hello::handler;\n}\n}\n</code></pre> <p>The perl/lib/hello.pm module:</p> <pre><code>package hello;\n\nuse nginx;\n\nsub handler {\nmy $r = shift;\n\n$r-&gt;send_http_header(\"text/html\");\nreturn OK if $r-&gt;header_only;\n\n$r-&gt;print(\"hello!\\n&lt;br/&gt;\");\n\nif (-f $r-&gt;filename or -d _) {\n$r-&gt;print($r-&gt;uri, \" exists!\\n\");\n}\n\nreturn OK;\n}\n\n1;\n__END__\n</code></pre> <p></p>"},{"location":"Modules-reference/http/ngx_http_perl_module/#_3","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_perl_module/#perl","title":"perl","text":"- \u8bf4\u660e \u8bed\u6cd5 perl <code>module::function</code>|<code>'sub { ... }'</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 location\u3001limit_except <p>\u7ed9\u6307\u5b9a\u7684 location \u8bbe\u7f6e\u4e00\u4e2a Perl \u5904\u7406\u7a0b\u5e8f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_perl_module/#perl_modules","title":"perl_modules","text":"- \u8bf4\u660e \u8bed\u6cd5 perl_modules <code>path</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u4e3a Perl \u6a21\u5757\u8bbe\u7f6e\u989d\u5916\u7684\u8def\u5f84\u3002</p>"},{"location":"Modules-reference/http/ngx_http_perl_module/#perl_require","title":"perl_require","text":"- \u8bf4\u660e \u8bed\u6cd5 perl_require <code>module</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u5b9a\u4e49\u6bcf\u6b21\u91cd\u65b0\u914d\u7f6e\u671f\u95f4\u5c06\u8981\u52a0\u8f7d\u7684\u6a21\u5757\u7684\u540d\u79f0\u3002\u53ef\u5b58\u5728\u591a\u4e2a <code>perl_require</code> \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_perl_module/#perl_set","title":"perl_set","text":"- \u8bf4\u660e \u8bed\u6cd5 perl_set <code>$variable module::function</code>|<code>'sub { ... }'</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u4e3a\u6307\u5b9a\u7684\u53d8\u91cf\u5b89\u88c5\u4e00\u4e2a Perl \u5904\u7406\u7a0b\u5e8f\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_perl_module/#ssi-perl","title":"\u4ece SSI \u8c03\u7528 Perl","text":"<p>\u4f7f\u7528 SSI \u547d\u4ee4\u8c03\u7528 Perl \u7684\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>&lt;!--# perl sub=\"module::function\" arg=\"parameter1\" arg=\"parameter2\" ...\n--&gt;\n</code></pre> <p></p>"},{"location":"Modules-reference/http/ngx_http_perl_module/#r","title":"$r \u8bf7\u6c42\u5bf9\u8c61\u65b9\u6cd5","text":"<ul> <li> <p><code>$r-&gt;args</code></p> <p>\u8fd4\u56de\u8bf7\u6c42\u53c2\u6570\u3002</p> </li> <li> <p><code>$r-&gt;filename</code></p> <p>\u8fd4\u56de\u4e0e\u8bf7\u6c42 URI \u76f8\u5bf9\u5e94\u7684\u6587\u4ef6\u540d\u3002</p> </li> <li> <p><code>$r-&gt;has_request_body(handler)</code></p> <p>\u5982\u679c\u8bf7\u6c42\u4e2d\u6ca1\u6709\u8bf7\u6c42\u4f53\uff0c\u5219\u8fd4\u56de 0\u3002\u5982\u679c\u5b58\u5728\uff0c\u5219\u4e3a\u8bf7\u6c42\u8bbe\u7f6e\u6307\u5b9a\u7684\u5904\u7406\u7a0b\u5e8f\uff0c\u5e76\u8fd4\u56de 1\u3002\u5728\u8bfb\u53d6\u8bf7\u6c42\u4f53\u540e\uff0cnginx \u5c06\u8c03\u7528\u6307\u5b9a\u7684\u5904\u7406\u7a0b\u5e8f\u3002\u8bf7\u6ce8\u610f\uff0c\u5904\u7406\u51fd\u6570\u5e94\u8be5\u901a\u8fc7\u5f15\u7528\u4f20\u9012\u3002\u4f8b\uff1a</p> <pre><code>package hello;\n\nuse nginx;\n\nsub handler {\nmy $r = shift;\n\nif ($r-&gt;request_method ne \"POST\") {\nreturn DECLINED;\n}\n\nif ($r-&gt;has_request_body(\\&amp;post)) {\nreturn OK;\n}\n\nreturn HTTP_BAD_REQUEST;\n}\n\nsub post {\nmy $r = shift;\n\n$r-&gt;send_http_header;\n\n$r-&gt;print(\"request_body: \\\"\", $r-&gt;request_body, \"\\\"&lt;br/&gt;\");\n$r-&gt;print(\"request_body_file: \\\"\", $r-&gt;request_body_file, \"\\\"&lt;br/&gt;\\n\");\n\nreturn OK;\n}\n\n1;\n\n__END__\n</code></pre> </li> <li> <p><code>$r-&gt;allow_ranges</code></p> <p>\u5728\u53d1\u9001\u54cd\u5e94\u65f6\u542f\u7528\u5b57\u8282\u8303\u56f4\u3002</p> </li> <li> <p><code>$r-&gt;discard_request_body</code></p> <p>\u6307\u793a nginx \u653e\u5f03\u8bf7\u6c42\u4f53\u3002</p> </li> <li> <p><code>$r-&gt;header_in(field)</code></p> <p>\u8fd4\u56de\u6307\u5b9a\u7684\u5ba2\u6237\u7aef\u8bf7\u6c42\u5934\u5b57\u6bb5\u7684\u503c\u3002</p> </li> <li> <p><code>$r-&gt;header_only</code></p> <p>\u786e\u5b9a\u6574\u4e2a\u54cd\u5e94\u8fd8\u662f\u4ec5\u5c06\u5934\u90e8\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002</p> </li> <li> <p><code>$r-&gt;header_out(field, value)</code></p> <p>\u4e3a\u6307\u5b9a\u7684\u54cd\u5e94\u5934\u5b57\u6bb5\u8bbe\u7f6e\u4e00\u4e2a\u503c\u3002</p> </li> <li> <p><code>$r-&gt;internal_redirect(uri)</code></p> <p>\u505a\u4e00\u4e2a\u5185\u90e8\u91cd\u5b9a\u5411\u5230\u6307\u5b9a\u7684 uri\u3002\u5728 Perl \u5904\u7406\u7a0b\u5e8f\u6267\u884c\u5b8c\u6210\u540e\u91cd\u5b9a\u5411\u3002</p> <p>\u76ee\u524d\u4e0d\u652f\u6301\u91cd\u5b9a\u5411\u5230\u5177\u540d location\u3002</p> </li> <li> <p><code>$r-&gt;log_error(errno, message)</code></p> <p>\u5c06\u6307\u5b9a\u7684\u6d88\u606f\u5199\u5165 error_log\u3002\u5982\u679c <code>errno</code> \u4e0d\u4e3a\u96f6\uff0c\u5219\u9519\u8bef\u7801\u53ca\u5176\u63cf\u8ff0\u5c06\u88ab\u9644\u52a0\u5230\u6d88\u606f\u4e2d\u3002</p> </li> <li> <p><code>$r-&gt;print(text, ...)</code></p> <p>\u5c06\u6570\u636e\u4f20\u9012\u7ed9\u5ba2\u6237\u7aef\u3002</p> </li> <li> <p><code>$r-&gt;request_body</code></p> <p>\u5982\u679c\u5c1a\u672a\u5c06\u8bf7\u6c42\u4f53\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u4e2d\uff0c\u5219\u8fd4\u56de\u5ba2\u6237\u7aef\u8bf7\u6c42\u4f53\u3002\u4e3a\u4e86\u786e\u4fdd\u5ba2\u6237\u7aef\u8bf7\u6c42\u4f53\u5728\u5185\u5b58\u4e2d\uff0c\u5176\u5927\u5c0f\u5e94\u8be5\u7531 client_max_body_size \u6765\u9650\u5236\uff0c\u5e76\u4e14\u5e94\u8be5\u4f7f\u7528 client_body_buffer_size \u6765\u8bbe\u7f6e\u8db3\u591f\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u3002</p> </li> <li> <p><code>$r-&gt;request_body_file</code></p> <p>\u5ba2\u6237\u7aef\u8bf7\u6c42\u4f53\u8fd4\u56de\u6587\u4ef6\u7684\u540d\u79f0\u3002\u5904\u7406\u5b8c\u6210\u540e\uff0c\u8be5\u6587\u4ef6\u5c06\u88ab\u5220\u9664\u3002\u8981\u59cb\u7ec8\u5c06\u8bf7\u6c42\u4f53\u5199\u5165\u6587\u4ef6\uff0c\u5e94\u542f\u7528 client_body_in_file_only\u3002</p> </li> <li> <p><code>$r-&gt;request_method</code></p> <p>\u8fd4\u56de\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684 HTTP \u65b9\u6cd5\u3002</p> </li> <li> <p><code>$r-&gt;remote_addr</code></p> <p>\u8fd4\u56de\u5ba2\u6237\u7aef IP \u5730\u5740\u3002</p> </li> <li> <p><code>$r-&gt;flush</code></p> <p>\u7acb\u5373\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u6570\u636e\u3002</p> </li> <li> <p><code>$r-&gt;sendfile(name[, offset[, length]])</code>     \u5c06\u6307\u5b9a\u7684\u6587\u4ef6\u5185\u5bb9\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u3002\u53ef\u9009\u53c2\u6570\u6307\u5b9a\u8981\u4f20\u8f93\u7684\u6570\u636e\u7684\u521d\u59cb\u504f\u79fb\u91cf\uff08<code>offset</code>\uff09\u548c\u957f\u5ea6\uff08<code>length</code>\uff09\u3002\u6570\u636e\u5728 Perl \u5904\u7406\u7a0b\u5e8f\u5b8c\u6210\u4e4b\u540e\u5f00\u59cb\u4f20\u8f93\u3002</p> </li> <li> <p><code>$r-&gt;send_http_header([type])</code></p> <p>\u5c06\u54cd\u5e94\u5934\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002\u53ef\u9009\u7684 <code>type</code> \u53c2\u6570\u7528\u4e8e\u8bbe\u7f6e Content-Type \u54cd\u5e94\u5934\u5b57\u6bb5\u7684\u503c\u3002\u5982\u679c\u8be5\u503c\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u5219\u4e0d\u4f1a\u53d1\u9001 Content-Type \u5934\u5b57\u6bb5\u3002</p> </li> <li> <p><code>$r-&gt;status(code)</code></p> <p>\u8bbe\u7f6e\u54cd\u5e94\u72b6\u6001\u7801\u3002</p> </li> <li> <p><code>$r-&gt;sleep(milliseconds, handler)</code></p> <p>\u8bbe\u7f6e\u6307\u5b9a\u7684\u5904\u7406\u7a0b\u5e8f\uff08<code>handler</code>\uff09\u548c\u6307\u5b9a\u505c\u6b62\u8bf7\u6c42\u5904\u7406\u7684\u65f6\u95f4\uff08<code>milliseconds</code>\uff09\u3002\u5728\u6b64\u671f\u95f4\uff0cnginx \u7ee7\u7eed\u5904\u7406\u5176\u4ed6\u8bf7\u6c42\u3002\u5728\u7ecf\u8fc7\u6307\u5b9a\u7684\u65f6\u95f4\u540e\uff0cnginx \u5c06\u8c03\u7528\u5df2\u5b89\u88c5\u7684\u5904\u7406\u7a0b\u5e8f\u3002\u8bf7\u6ce8\u610f\uff0c\u5904\u7406\u51fd\u6570\u5e94\u8be5\u901a\u8fc7\u5f15\u7528\u4f20\u9012\u3002\u4e3a\u4e86\u5728\u5904\u7406\u7a0b\u5e8f\u4e4b\u95f4\u4f20\u9012\u6570\u636e\uff0c\u5e94\u4f7f\u7528 <code>$r-&gt;variable()</code>\u3002\u4f8b\uff1a</p> <pre><code>package hello;\n\nuse nginx;\n\nsub handler {\nmy $r = shift;\n\n$r-&gt;discard_request_body;\n$r-&gt;variable(\"var\", \"OK\");\n$r-&gt;sleep(1000, \\&amp;next);\n\nreturn OK;\n}\n\nsub next {\nmy $r = shift;\n\n$r-&gt;send_http_header;\n$r-&gt;print($r-&gt;variable(\"var\"));\n\nreturn OK;\n}\n\n1;\n\n__END__\n</code></pre> </li> <li> <p><code>$r-&gt;unescape(text)</code></p> <p>\u89e3\u7801 \uff05XX \u683c\u5f0f\u7f16\u7801\u7684\u6587\u672c\u3002</p> </li> <li> <p><code>$r-&gt;uri</code></p> <p>\u8fd4\u56de\u8bf7\u6c42 URI\u3002</p> </li> <li> <p><code>$r-&gt;variable(name[, value])</code></p> <p>\u8fd4\u56de\u6216\u8bbe\u7f6e\u6307\u5b9a\u53d8\u91cf\u7684\u503c\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u8bf7\u6c42\u6765\u8bf4\u8fd9\u4e9b\u53d8\u91cf\u90fd\u662f\u672c\u5730\u53d8\u91cf\u3002</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_perl_module/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_perl_module.html</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/","title":"ngx_http_proxy_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>proxy_bind</li> <li>proxy_buffer_size</li> <li>proxy_buffering</li> <li>proxy_buffers</li> <li>proxy_busy_buffers_size</li> <li>proxy_cache</li> <li>proxy_cache_background_update</li> <li>proxy_cache_bypass</li> <li>proxy_cache_convert_head</li> <li>proxy_cache_key</li> <li>proxy_cache_lock</li> <li>proxy_cache_lock_age</li> <li>proxy_cache_lock_timeout</li> <li>proxy_cache_max_range_offset</li> <li>proxy_cache_methods</li> <li>proxy_cache_min_uses</li> <li>proxy_cache_path</li> <li>proxy_cache_purge</li> <li>proxy_cache_revalidate</li> <li>proxy_cache_use_stale</li> <li>proxy_cache_valid</li> <li>proxy_connect_timeout</li> <li>proxy_cookie_domain</li> <li>proxy_cookie_path</li> <li>proxy_force_ranges</li> <li>proxy_headers_hash_bucket_size</li> <li>proxy_headers_hash_max_size</li> <li>proxy_hide_header</li> <li>proxy_http_version</li> <li>proxy_ignore_client_abort</li> <li>proxy_ignore_headers</li> <li>proxy_intercept_errors</li> <li>proxy_limit_rate</li> <li>proxy_max_temp_file_size</li> <li>proxy_method</li> <li>proxy_next_upstream</li> <li>proxy_next_upstream_timeout</li> <li>proxy_next_upstream_tries</li> <li>proxy_no_cache</li> <li>proxy_pass</li> <li>proxy_pass_header</li> <li>proxy_pass_request_body</li> <li>proxy_pass_request_headers</li> <li>proxy_read_timeout</li> <li>proxy_redirect</li> <li>proxy_request_buffering</li> <li>proxy_send_lowat</li> <li>proxy_send_timeout</li> <li>proxy_set_body</li> <li>proxy_set_header</li> <li>proxy_ssl_certificate</li> <li>proxy_ssl_certificate_key</li> <li>proxy_ssl_ciphers</li> <li>proxy_ssl_crl</li> <li>proxy_ssl_name</li> <li>proxy_ssl_password_file</li> <li>proxy_ssl_protocols</li> <li>proxy_ssl_server_name</li> <li>proxy_ssl_session_reuse</li> <li>proxy_ssl_trusted_certificate</li> <li>proxy_ssl_verify</li> <li>proxy_ssl_verify_depth</li> <li>proxy_store</li> <li>proxy_store_access</li> <li>proxy_temp_file_write_size</li> <li>proxy_temp_path</li> </ul> </li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_http_proxy_module</code> \u6a21\u5757\u5141\u8bb8\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u53e6\u4e00\u53f0\u670d\u52a1\u5668\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location / {\nproxy_pass       http://localhost:8000;\nproxy_set_header Host      $host;\nproxy_set_header X-Real-IP $remote_addr;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_bind","title":"proxy_bind","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_bind <code>address [transparent]</code> | <code>off</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.8.22 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8fde\u63a5\u5230\u4e00\u4e2a\u6307\u5b9a\u4e86\u672c\u5730 IP \u5730\u5740\u548c\u53ef\u9009\u7aef\u53e3\uff081.11.2\uff09\u7684\u4ee3\u7406\u670d\u52a1\u5668\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.3.12\uff09\u3002\u7279\u6b8a\u503c <code>off</code> \uff081.3.12\uff09\u53d6\u6d88\u4ece\u4e0a\u5c42\u914d\u7f6e\u7ea7\u522b\u7ee7\u627f\u7684 <code>proxy_bind</code> \u6307\u4ee4\u7684\u4f5c\u7528\uff0c\u5176\u5141\u8bb8\u7cfb\u7edf\u81ea\u52a8\u5206\u914d\u672c\u5730 IP \u5730\u5740\u548c\u7aef\u53e3\u3002</p> <p><code>transparent</code> \u53c2\u6570\uff081.11.0\uff09\u5141\u8bb8\u51fa\u7ad9\u4ece\u975e\u672c\u5730 IP \u5730\u5740\u5230\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8fde\u63a5\uff08\u4f8b\u5982\uff0c\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u771f\u5b9e IP \u5730\u5740\uff09\uff1a</p> <pre><code>proxy_bind $remote_addr transparent;\n</code></pre> <p>\u4e3a\u4e86\u4f7f\u8fd9\u4e2a\u53c2\u6570\u8d77\u4f5c\u7528\uff0c\u901a\u5e38\u9700\u8981\u4ee5\u8d85\u7ea7\u7528\u6237\u6743\u9650\u8fd0\u884c nginx worker \u8fdb\u7a0b\u3002\u5728 Linux \u4e0a\uff0c\u4e0d\u9700\u8981\u6307\u5b9a <code>transparent</code> \u53c2\u6570\uff081.13.8\uff09\uff0c\u5de5\u4f5c\u8fdb\u7a0b\u4f1a\u7ee7\u627f master \u8fdb\u7a0b\u7684 <code>CAP_NET_RAW</code> \u529f\u80fd\u3002\u6b64\u5916\uff0c\u8fd8\u8981\u914d\u7f6e\u5185\u6838\u8def\u7531\u8868\u6765\u62e6\u622a\u6765\u81ea\u4ee3\u7406\u670d\u52a1\u5668\u7684\u7f51\u7edc\u6d41\u91cf\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_buffer_size","title":"proxy_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_buffer_size <code>size</code>; \u9ed8\u8ba4 proxy_buffer_size 4k|8k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7528\u4e8e\u8bfb\u53d6\u4ece\u4ee3\u7406\u670d\u52a1\u5668\u6536\u5230\u7684\u7b2c\u4e00\u90e8\u5206\u54cd\u5e94\u7684\u7f13\u51b2\u533a\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u8fd9\u90e8\u5206\u901a\u5e38\u5305\u542b\u4e00\u4e2a\u5c0f\u7684\u54cd\u5e94\u5934\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u51b2\u533a\u5927\u5c0f\u7b49\u4e8e\u4e00\u4e2a\u5185\u5b58\u9875\u30024K \u6216 8K\uff0c\u56e0\u5e73\u53f0\u800c\u5f02\u3002\u4f46\u662f\uff0c\u5b83\u53ef\u4ee5\u8bbe\u7f6e\u5f97\u66f4\u5c0f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_buffering","title":"proxy_buffering","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_buffering <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_buffering on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u6216\u7981\u7528\u6765\u81ea\u4ee3\u7406\u670d\u52a1\u5668\u7684\u54cd\u5e94\u7f13\u51b2\u3002</p> <p>\u5f53\u542f\u7528\u7f13\u51b2\u65f6\uff0cnginx \u4f1a\u5c3d\u53ef\u80fd\u5feb\u5730\u6536\u5230\u63a5\u6536\u6765\u81ea\u4ee3\u7406\u670d\u52a1\u5668\u7684\u54cd\u5e94\uff0c\u5e76\u5c06\u5176\u4fdd\u5b58\u5230\u7531 proxy_buffer_size \u548c proxy_buffers \u6307\u4ee4\u8bbe\u7f6e\u7684\u7f13\u51b2\u533a\u4e2d\u3002\u5982\u679c\u5185\u5b58\u653e\u4e0d\u4e0b\u6574\u4e2a\u54cd\u5e94\uff0c\u54cd\u5e94\u7684\u4e00\u90e8\u5206\u53ef\u4ee5\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u7684\u4e34\u65f6\u6587\u4ef6\u4e2d\u3002\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u7531 proxy_max_temp_file_size  \u548c proxy_temp_file_write_size \u6307\u4ee4\u63a7\u5236\u3002</p> <p>\u5f53\u7f13\u51b2\u88ab\u7981\u7528\u65f6\uff0cnginx \u5728\u6536\u5230\u54cd\u5e94\u65f6\u7acb\u5373\u540c\u6b65\u4f20\u9012\u7ed9\u5ba2\u6237\u7aef\uff0c\u4e0d\u4f1a\u5c1d\u8bd5\u4ece\u4ee3\u7406\u670d\u52a1\u5668\u8bfb\u53d6\u6574\u4e2a\u54cd\u5e94\u3002nginx \u4e00\u6b21\u53ef\u4ee5\u4ece\u670d\u52a1\u5668\u63a5\u6536\u7684\u6700\u5927\u6570\u636e\u91cf\u7531 proxy_buffer_size \u6307\u4ee4\u8bbe\u7f6e\u3002</p> <p>\u901a\u8fc7\u5728 <code>X-Accel-Buffering</code> \u54cd\u5e94\u5934\u5b57\u6bb5\u4e2d\u901a\u8fc7 <code>yes</code> \u6216 <code>no</code> \u4e5f\u53ef\u4ee5\u542f\u7528\u6216\u7981\u7528\u7f13\u51b2\u3002\u53ef\u4ee5\u4f7f\u7528 proxy_ignore_headers \u6307\u4ee4\u7981\u7528\u6b64\u529f\u80fd\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_buffers","title":"proxy_buffers","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_buffers <code>number size</code>; \u9ed8\u8ba4 proxy_buffers 8 4k|8k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u5355\u4e2a\u8fde\u63a5\u4ece\u4ee3\u7406\u670d\u52a1\u5668\u8bfb\u53d6\u54cd\u5e94\u7684\u7f13\u51b2\u533a\u7684 <code>number</code> \uff08\u6570\u91cf\uff09\u548c <code>size</code> \uff08\u5927\u5c0f\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u51b2\u533a\u5927\u5c0f\u7b49\u4e8e\u4e00\u4e2a\u5185\u5b58\u9875\u3002\u4e3a 4K \u6216 8K\uff0c\u56e0\u5e73\u53f0\u800c\u5f02\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_busy_buffers_size","title":"proxy_busy_buffers_size","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_busy_buffers_size <code>size</code>; \u9ed8\u8ba4 proxy_buffer_size 8k|16k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5f53\u542f\u7528\u4ee3\u7406\u670d\u52a1\u5668\u54cd\u5e94\u7f13\u51b2\u65f6\uff0c\u9650\u5236\u7f13\u51b2\u533a\u7684\u603b\u5927\u5c0f\uff08<code>size</code>\uff09\u5728\u5f53\u54cd\u5e94\u5c1a\u672a\u88ab\u5b8c\u5168\u8bfb\u53d6\u65f6\u53ef\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u54cd\u5e94\u3002\u540c\u65f6\uff0c\u5176\u4f59\u7684\u7f13\u51b2\u533a\u53ef\u4ee5\u7528\u6765\u8bfb\u53d6\u54cd\u5e94\uff0c\u5982\u679c\u9700\u8981\u7684\u8bdd\uff0c\u7f13\u51b2\u90e8\u5206\u54cd\u5e94\u5230\u4e34\u65f6\u6587\u4ef6\u4e2d\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>size</code> \u53d7 proxy_buffer_size \u548c proxy_buffers \u6307\u4ee4\u8bbe\u7f6e\u7684\u4e24\u4e2a\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cache","title":"proxy_cache","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cache <code>zone</code> | <code>off</code>; \u9ed8\u8ba4 proxy_cache off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u7528\u4e8e\u7f13\u5b58\u7684\u5171\u4eab\u5185\u5b58\u533a\u57df\u3002\u540c\u4e00\u4e2a\u533a\u57df\u53ef\u4ee5\u5728\u51e0\u4e2a\u5730\u65b9\u4f7f\u7528\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.7.9\uff09\u3002<code>off</code> \u53c2\u6570\u5c06\u7981\u7528\u4ece\u4e0a\u7ea7\u914d\u7f6e\u7ea7\u522b\u7ee7\u627f\u7684\u7f13\u5b58\u914d\u7f6e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cache_background_update","title":"proxy_cache_background_update","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cache_background_update <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_cache_background_update off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.10 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5141\u8bb8\u542f\u52a8\u540e\u53f0\u5b50\u8bf7\u6c42\u6765\u66f4\u65b0\u8fc7\u671f\u7684\u7f13\u5b58\u9879\uff0c\u800c\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\u5219\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u8bf7\u6ce8\u610f\uff0c\u6709\u5fc5\u8981\u5728\u66f4\u65b0\u65f6\u5141\u8bb8\u4f7f\u7528\u9648\u65e7\u7684\u7f13\u5b58\u54cd\u5e94\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cache_bypass","title":"proxy_cache_bypass","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cache_bypass <code>string ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e0d\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u54cd\u5e94\u7684\u6761\u4ef6\u3002\u5982\u679c\u5b57\u7b26\u4e32\u53c2\u6570\u4e2d\u6709\u4e00\u4e2a\u503c\u4e0d\u4e3a\u7a7a\u4e14\u4e0d\u7b49\u4e8e <code>0</code>\uff0c\u5219\u4e0d\u4f1a\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u54cd\u5e94\uff1a</p> <pre><code>proxy_cache_bypass $cookie_nocache $arg_nocache$arg_comment;\nproxy_cache_bypass $http_pragma    $http_authorization;\n</code></pre> <p>\u53ef\u4ee5\u4e0e proxy_no_cache \u6307\u4ee4\u4e00\u8d77\u4f7f\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cache_convert_head","title":"proxy_cache_convert_head","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cache_convert_head <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_cache_convert_head on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.9.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u6216\u7981\u7528\u5c06 HEAD \u65b9\u6cd5\u8f6c\u6362\u4e3a GET \u8fdb\u884c\u7f13\u5b58\u3002\u7981\u7528\u8f6c\u6362\u65f6\uff0c\u5e94\u5c06\u7f13\u5b58\u952e\u914d\u7f6e\u4e3a\u5305\u542b <code>$request_method</code>\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cache_key","title":"proxy_cache_key","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cache_key <code>string</code>; \u9ed8\u8ba4 proxy_cache_key schemeproxy_host$request_uri; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u4e3a\u7f13\u5b58\u5b9a\u4e49\u4e00\u4e2a key\uff0c\u4f8b\u5982\uff1a</p> <pre><code>proxy_cache_key \"$host$request_uri $cookie_user\";\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6307\u4ee4\u7684\u503c\u4e0e\u5b57\u7b26\u4e32\u76f8\u8fd1\uff1a</p> <pre><code>proxy_cache_key $scheme$proxy_host$uri$is_args$args;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cache_lock","title":"proxy_cache_lock","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cache_key <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_cache_lock off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.12 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u540e\uff0c\u901a\u8fc7\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u4e00\u6b21\u53ea\u5141\u8bb8\u4e00\u4e2a\u8bf7\u6c42\u586b\u5145\u6839\u636e proxy_cache_key \u6307\u4ee4\u6807\u8bc6\u7684\u65b0\u7f13\u5b58\u5143\u7d20\u3002\u540c\u4e00\u7f13\u5b58\u5143\u7d20\u7684\u5176\u4ed6\u8bf7\u6c42\u5c06\u7b49\u5f85\u54cd\u5e94\u51fa\u73b0\u5728\u7f13\u5b58\u4e2d\u6216\u7f13\u5b58\u9501\u5b9a\u4ee5\u91ca\u653e\u6b64\u5143\u7d20\uff0c\u76f4\u5230 proxy_cache_lock_timeout \u6307\u4ee4\u8bbe\u7f6e\u7684\u65f6\u95f4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cache_lock_age","title":"proxy_cache_lock_age","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cache_lock_age <code>time</code>; \u9ed8\u8ba4 proxy_cache_lock_age 5s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.8 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5982\u679c\u4f20\u9012\u7ed9\u4ee3\u7406\u670d\u52a1\u5668\u4ee5\u586b\u5145\u65b0\u7f13\u5b58\u5143\u7d20\u7684\u6700\u540e\u4e00\u4e2a\u8bf7\u6c42\u5728\u6307\u5b9a\u65f6\u95f4\uff08<code>time</code>\uff09\u5185\u6ca1\u6709\u5b8c\u6210\uff0c\u5219\u53ef\u4ee5\u5c06\u53e6\u4e00\u4e2a\u8bf7\u6c42\u4f20\u9012\u7ed9\u4ee3\u7406\u670d\u52a1\u5668\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cache_lock_timeout","title":"proxy_cache_lock_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cache_lock_timeout <code>time</code>; \u9ed8\u8ba4 proxy_cache_lock_timeout 5s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.12 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e proxy_cache_lock \u7684\u8d85\u65f6\u65f6\u95f4\u3002\u5f53\u65f6\u95f4\uff08<code>time</code>\uff09\u5230\u671f\u65f6\uff0c\u8bf7\u6c42\u5c06\u88ab\u4f20\u9012\u5230\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u4f46\u54cd\u5e94\u4e0d\u4f1a\u88ab\u7f13\u5b58\u3002</p> <p>\u5728 1.7.8 \u4e4b\u524d\u53ef\u4ee5\u7f13\u5b58\u54cd\u5e94\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cache_max_range_offset","title":"proxy_cache_max_range_offset","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cache_max_range_offset <code>number</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.6 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u5b57\u8282\u8303\u56f4\uff08byte-range\uff09\u8bf7\u6c42\u7684\u504f\u79fb\u91cf\u3002\u5982\u679c\u8303\u56f4\u8d85\u51fa\u504f\u79fb\u91cf\uff0c\u5219\u8303\u56f4\u8bf7\u6c42\u5c06\u4f20\u9012\u5230\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u5e76\u4e14\u4e0d\u4f1a\u7f13\u5b58\u54cd\u5e94\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cache_methods","title":"proxy_cache_methods","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cache_methods <code>GET</code> | <code>HEAD</code> | <code>POST ...</code>; \u9ed8\u8ba4 proxy_cache_methods GET HEAD; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.7.59 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5982\u679c\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u65b9\u6cd5\u5728\u8be5\u5217\u8868\u4e2d\uff0c\u5219\u5c06\u7f13\u5b58\u54cd\u5e94\u3002<code>GET</code> \u548c <code>HEAD</code> \u65b9\u6cd5\u603b\u662f\u5728\u5217\u8868\u4e2d\uff0c\u4f46\u5efa\u8bae\u663e\u5f0f\u6307\u5b9a\u5b83\u4eec\u3002\u53e6\u8bf7\u53c2\u89c1 proxy_no_cache \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cache_min_uses","title":"proxy_cache_min_uses","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cache_min_uses <code>number</code>; \u9ed8\u8ba4 proxy_cache_min_uses 1; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u5728 <code>number</code> \u6b64\u8bf7\u6c42\u540e\u7f13\u5b58\u54cd\u5e94\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cache_path","title":"proxy_cache_path","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cache_path <code>path [levels=levels] [use_temp_path=on\\|off] keys_zone=name:size [inactive=time] [max_size=size] [manager_files=number] [manager_sleep=time] [manager_threshold=time] [loader_files=number] [loader_sleep=time] [loader_threshold=time] [purger=on\\|off] [purger_files=number] [purger_sleep=time] [purger_threshold=time]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u8bbe\u7f6e\u7f13\u5b58\u7684\u8def\u5f84\u548c\u5176\u4ed6\u53c2\u6570\u3002\u7f13\u5b58\u6570\u636e\u5b58\u50a8\u5728\u6587\u4ef6\u4e2d\u3002\u7f13\u5b58\u4e2d\u7684\u6587\u4ef6\u540d\u4e3a\u7f13\u5b58 key \u7ecf\u8fc7 MD5 \u8ba1\u7b97\u540e\u7684\u7ed3\u679c\u3002<code>levels</code> \u53c2\u6570\u5b9a\u4e49\u9ad8\u901f\u7f13\u5b58\u7684\u5c42\u6b21\u7ed3\u6784\u7ea7\u522b\uff1a\u4ece 1 \u5230 3\uff0c\u6bcf\u4e2a\u7ea7\u522b\u63a5\u53d7\u503c 1 \u6216\u503c 2\u3002\u4f8b\u5982\u4ee5\u4e0b\u914d\u7f6e\uff1a</p> <pre><code>proxy_cache_path /data/nginx/cache levels=1:2 keys_zone=one:10m;\n</code></pre> <p>\u7f13\u5b58\u4e2d\u7684\u6587\u4ef6\u540d\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>/data/nginx/cache/c/29/b7f54b2df7773722d382f4809d65029c\n</code></pre> <p>\u9996\u5148\u7f13\u5b58\u54cd\u5e94\u5c06\u5199\u5165\u4e34\u65f6\u6587\u4ef6\uff0c\u7136\u540e\u91cd\u547d\u540d\u8be5\u6587\u4ef6\u3002\u4ece 0.8.9 \u7248\u672c\u5f00\u59cb\uff0c\u4e34\u65f6\u6587\u4ef6\u548c\u7f13\u5b58\u53ef\u4ee5\u653e\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u3002\u4f46\u8bf7\u6ce8\u610f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6587\u4ef6\u5c06\u8de8\u8d8a\u4e24\u4e2a\u6587\u4ef6\u7cfb\u7edf\u8fdb\u884c\u590d\u5236\uff0c\u800c\u4e0d\u662f\u7b80\u5355\u7684\u91cd\u547d\u540d\u64cd\u4f5c\u3002\u56e0\u6b64\uff0c\u5efa\u8bae\u5bf9\u4e8e\u4efb\u4f55\u6307\u5b9a\u4f4d\u7f6e\uff0c\u7f13\u5b58\u548c\u4fdd\u5b58\u4e34\u65f6\u6587\u4ef6\u7684\u76ee\u5f55\u90fd\u653e\u5728\u540c\u4e00\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002\u4e34\u65f6\u6587\u4ef6\u7684\u76ee\u5f55\u662f\u6839\u636e <code>use_temp_path</code> \u53c2\u6570\uff081.7.10\uff09\u8bbe\u7f6e\u7684\u3002\u5982\u679c\u7701\u7565\u6b64\u53c2\u6570\u6216\u5c06\u5176\u8bbe\u7f6e\u4e3a <code>on</code>\uff0c\u5219\u5c06\u4f7f\u7528 proxy_temp_path \u6307\u4ee4\u6307\u5b9a\u7684\u76ee\u5f55\u4f4d\u7f6e\u3002\u5982\u679c\u8be5\u503c\u8bbe\u7f6e\u4e3a <code>off</code>\uff0c\u5219\u4e34\u65f6\u6587\u4ef6\u5c06\u76f4\u63a5\u653e\u5165\u7f13\u5b58\u76ee\u5f55\u4e2d\u3002</p> <p>\u6b64\u5916\uff0c\u6240\u6709\u6d3b\u8dc3\u7684 key \u548c\u6709\u5173\u6570\u636e\u7684\u4fe1\u606f\u90fd\u5b58\u50a8\u5728\u5171\u4eab\u5185\u5b58\u533a\u57df\u4e2d\uff0c\u5176 <code>name</code> \u548c <code>size</code> \u7531 <code>keys_zone</code> \u53c2\u6570\u914d\u7f6e\u3002\u4e00\u5146\u5b57\u8282\u533a\u57df\u53ef\u4ee5\u5b58\u50a8\u5927\u7ea6 8000 \u4e2a key\u3002</p> <p>\u4f5c\u4e3a\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\uff0c\u5171\u4eab\u5b58\u50a8\u533a\u57df\u8fd8\u5b58\u50a8\u7740\u5176\u4ed6\u7f13\u5b58\u4fe1\u606f\uff0c\u56e0\u6b64\uff0c\u9700\u8981\u4e3a\u76f8\u540c\u6570\u91cf\u7684 key \u6307\u5b9a\u66f4\u5927\u7684\u533a\u57df\u5927\u5c0f\u3002 \u4f8b\u5982\uff0c\u4e00\u5146\u5b57\u8282\u533a\u57df\u53ef\u4ee5\u5b58\u50a8\u5927\u7ea6 4000 \u4e2a key\u3002</p> <p>\u5728 <code>inactive</code> \u53c2\u6570\u6307\u5b9a\u7684\u65f6\u95f4\u5185\u672a\u8bbf\u95ee\u7684\u7f13\u5b58\u6570\u636e\u5c06\u4ece\u7f13\u5b58\u4e2d\u5220\u9664\uff0c\u65e0\u8bba\u5176\u65b0\u65e7\u7a0b\u5ea6\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>inactive</code> \u8bbe\u7f6e\u4e3a 10 \u5206\u949f\u3002</p> <p>\u7279\u6b8a\u7684**\u7f13\u5b58\u7ba1\u7406\u5668**\u8fdb\u7a0b\u76d1\u89c6 <code>max_size</code> \u53c2\u6570\u8bbe\u7f6e\u7684\u6700\u5927\u7f13\u5b58\u5927\u5c0f\u3002\u8d85\u8fc7\u6b64\u5927\u5c0f\u65f6\uff0c\u5b83\u4f1a\u5220\u9664\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u3002<code>manager_files</code>\u3001<code>manager_threshold</code> \u548c <code>manager_sleep</code> \u53c2\u6570\uff081.11.5\uff09\u914d\u7f6e\u7684\u6570\u636e\u5c06\u88ab\u8fed\u4ee3\u5220\u9664\u3002\u5728\u4e00\u6b21\u8fed\u4ee3\u671f\u95f4\uff0c\u4e0d\u4f1a\u5220\u9664\u8d85\u8fc7 <code>manager_files</code> \u9879\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a 100\uff09\u3002\u4e00\u6b21\u8fed\u4ee3\u7684\u6301\u7eed\u65f6\u95f4\u53d7 <code>manager_threshold</code> \u53c2\u6570\u9650\u5236\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a 200 \u6beb\u79d2\uff09\u3002\u5728\u8fed\u4ee3\u4e4b\u95f4\uff0c\u7531 <code>manager_sleep</code> \u53c2\u6570\uff08\u9ed8\u8ba4\u4e3a 50 \u6beb\u79d2\uff09\u914d\u7f6e\u7684\u95f4\u9694\u65f6\u95f4\u3002</p> <p>\u542f\u52a8\u4e00\u5206\u949f\u540e\uff0c\u7279\u6b8a**\u7f13\u5b58\u52a0\u8f7d\u7a0b\u5e8f**\u8fdb\u7a0b\u88ab\u6fc0\u6d3b\u3002\u5b83\u5c06\u6709\u5173\u5b58\u50a8\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u5148\u524d\u7f13\u5b58\u6570\u636e\u7684\u4fe1\u606f\u52a0\u8f7d\u5230\u7f13\u5b58\u533a\u3002\u52a0\u8f7d\u4e5f\u662f\u5728\u8fed\u4ee3\u4e2d\u5b8c\u6210\u7684\u3002\u5728\u4e00\u6b21\u8fed\u4ee3\u671f\u95f4\uff0c\u4e0d\u4f1a\u52a0\u8f7d\u8d85\u8fc7 <code>loader_files</code> \u9879\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a 100\uff09\u3002\u6b64\u5916\uff0c\u4e00\u6b21\u8fed\u4ee3\u7684\u6301\u7eed\u65f6\u95f4\u53d7 <code>loader_threshold</code> \u53c2\u6570\u9650\u5236\uff08\u9ed8\u8ba4\u4e3a 200 \u6beb\u79d2\uff09\u3002\u5728\u8fed\u4ee3\u4e4b\u95f4\uff0c\u7531 loader_sleep \u53c2\u6570\uff08\u9ed8\u8ba4\u4e3a 50 \u6beb\u79d2\uff09\u914d\u7f6e\u95f4\u9694\u65f6\u95f4\u3002</p> <p>\u6b64\u5916\uff0c\u4ee5\u4e0b\u53c2\u6570\u4f5c\u4e3a\u6211\u4eec\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\u63d0\u4f9b\uff1a</p> <ul> <li> <p><code>purger=on|off</code></p> <p>\u6307\u793a\u7f13\u5b58\u6e05\u9664\u7a0b\u5e8f\uff08cache purger\uff09\u662f\u5426\u5c06\u4ece\u78c1\u76d8\u4e2d\u5220\u9664\u4e0e\u901a\u914d\u7b26 key \u5339\u914d\u7684\u7f13\u5b58\u6761\u76ee\uff081.7.12\uff09\u3002\u5c06\u53c2\u6570\u8bbe\u7f6e\u4e3a <code>on</code>\uff08\u9ed8\u8ba4\u4e3a <code>off</code>\uff09\u5c06\u6fc0\u6d3b cache purger \u8fdb\u7a0b\uff0c\u8be5\u8fdb\u7a0b\u5c06\u6c38\u4e45\u8fed\u4ee3\u6240\u6709\u7f13\u5b58\u6761\u76ee\u5e76\u5220\u9664\u4e0e\u901a\u914d\u7b26 key \u5339\u914d\u7684\u6761\u76ee\u3002</p> </li> <li> <p><code>purger_files=number</code></p> <p>\u8bbe\u7f6e\u5728\u4e00\u6b21\u8fed\u4ee3\u671f\u95f4\u5c06\u626b\u63cf\u7684\u6761\u76ee\u6570\uff081.7.12\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>purger_files</code> \u8bbe\u7f6e\u4e3a 10\u3002</p> </li> <li> <p><code>purger_threshold=number</code></p> <p>\u8bbe\u7f6e\u4e00\u6b21\u8fed\u4ee3\u7684\u6301\u7eed\u65f6\u95f4\uff081.7.12\uff09\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>purger_threshold</code> \u8bbe\u7f6e\u4e3a 50 \u6beb\u79d2\u3002</p> </li> <li> <p><code>purger_sleep=number</code></p> <p>\u8bbe\u7f6e\u8fed\u4ee3\u4e4b\u95f4\u7684\u6682\u505c\u95f4\u9694\uff081.7.12\uff09\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>purger_sleep</code> \u8bbe\u7f6e\u4e3a 50 \u6beb\u79d2\u3002</p> <p>\u5728 1.7.3\u30011.7.7 \u548c 1.11.10 \u7248\u672c\u4e2d\uff0c\u7f13\u5b58\u5934\u683c\u5f0f\u5df2\u53d1\u751f\u66f4\u6539\uff0c\u5347\u7ea7\u5230\u8f83\u65b0\u7684 nginx \u7248\u672c\u4e4b\u540e\uff0c\u7f13\u5b58\u7684\u54cd\u5e94\u5c06\u88ab\u89c6\u4e3a\u65e0\u6548\u3002</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cache_purge","title":"proxy_cache_purge","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cache_purge <code>string ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5b9a\u4e49\u5c06\u8bf7\u6c42\u89c6\u4e3a\u7f13\u5b58\u6e05\u9664\u8bf7\u6c42\u7684\u6761\u4ef6\u3002\u5982\u679c\u8be5\u5b57\u7b26\u4e32\u53c2\u6570\u81f3\u5c11\u6709\u4e00\u4e2a\u503c\u4e0d\u4e3a\u7a7a\u5e76\u4e14\u4e0d\u7b49\u4e8e <code>0</code>\uff0c\u5219\u5220\u9664\u6709\u76f8\u5e94\u7f13\u5b58 key \u7684\u7f13\u5b58\u9879\u3002\u901a\u8fc7\u8fd4\u56de 204\uff08No Content\uff09\u54cd\u5e94\u6765\u6307\u793a\u64cd\u4f5c\u6210\u529f\u3002</p> <p>\u5982\u679c\u6e05\u9664\u8bf7\u6c42\u7684\u7f13\u5b58 key \u4ee5\u661f\u53f7\uff08<code>*</code>\uff09\u7ed3\u5c3e\uff0c\u5219\u5c06\u4ece\u7f13\u5b58\u4e2d\u5220\u9664\u4e0e\u901a\u914d\u7b26 key \u5339\u914d\u7684\u6240\u6709\u7f13\u5b58\u9879\u3002\u4f46\u662f\uff0c\u8fd9\u4e9b\u6761\u76ee\u5c06\u4fdd\u7559\u5728\u78c1\u76d8\u4e0a\uff0c\u76f4\u5230\u5b83\u4eec\u56e0\u4e3a\u975e\u6d3b\u8dc3\u800c\u88ab\u5220\u9664\uff0c\u6216\u88ab\u7f13\u5b58\u6e05\u9664\u7a0b\u5e8f\uff081.7.12\uff09\u5904\u7406\uff0c\u6291\u6216\u5ba2\u6237\u7aef\u5c1d\u8bd5\u8bbf\u95ee\u5b83\u4eec\u3002</p> <p>\u914d\u7f6e\u793a\u4f8b\uff1a</p> <pre><code>proxy_cache_path /data/nginx/cache keys_zone=cache_zone:10m;\n\nmap $request_method $purge_method {\nPURGE   1;\ndefault 0;\n}\n\nserver {\n...\nlocation / {\nproxy_pass http://backend;\nproxy_cache cache_zone;\nproxy_cache_key $uri;\nproxy_cache_purge $purge_method;\n}\n}\n</code></pre> <p>\u6b64\u529f\u80fd\u4f5c\u4e3a\u6211\u4eec\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\u63d0\u4f9b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cache_revalidate","title":"proxy_cache_revalidate","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cache_revalidate <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_cache_revalidate off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u4f7f\u7528\u5177\u6709 If-Modified-Since \u548c If-None-Match \u5934\u5b57\u6bb5\u7684\u6761\u4ef6\u8bf7\u6c42\u6765\u91cd\u65b0\u9a8c\u8bc1\u8fc7\u671f\u7684\u7f13\u5b58\u9879\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cache_use_stale","title":"proxy_cache_use_stale","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cache_use_stale <code>error</code> | <code>timeout</code> | <code>invalid_header</code> | <code>updating</code> | <code>http_500</code> | <code>http_502</code> | <code>http_503</code> | <code>http_504</code> | <code>http_403</code> | <code>http_404</code> | <code>http_429</code> | <code>off ...</code>; \u9ed8\u8ba4 proxy_cache_use_stale off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u786e\u5b9a\u5728\u4e0e\u4ee3\u7406\u670d\u52a1\u5668\u901a\u4fe1\u671f\u95f4\u53ef\u4ee5\u5728\u54ea\u4e9b\u60c5\u51b5\u4e0b\u4f7f\u7528\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\u3002\u8be5\u6307\u4ee4\u7684\u53c2\u6570\u4e0e proxy_next_upstream \u6307\u4ee4\u7684\u53c2\u6570\u5339\u914d\u3002</p> <p>\u5982\u679c\u65e0\u6cd5\u9009\u62e9\u4ee3\u7406\u670d\u52a1\u5668\u6765\u5904\u7406\u8bf7\u6c42\uff0c\u5219 <code>error</code> \u53c2\u6570\u8fd8\u5141\u8bb8\u4f7f\u7528\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\u3002</p> <p>\u6b64\u5916\uff0c\u5982\u679c\u5f53\u524d\u6b63\u5728\u66f4\u65b0\uff0c\u5219 <code>updating</code> \u53c2\u6570\u5141\u8bb8\u4f7f\u7528\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\u3002\u8fd9\u5141\u8bb8\u5728\u66f4\u65b0\u7f13\u5b58\u6570\u636e\u65f6\u6700\u5927\u5316\u51cf\u5c11\u5bf9\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8bbf\u95ee\u6b21\u6570\u3002</p> <p>\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728\u54cd\u5e94\u5934\u4e2d\u6307\u5b9a\u54cd\u5e94\u5931\u6548\u591a\u5c11\u79d2\u6570\u540e\u76f4\u63a5\u542f\u7528\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\uff081.11.10\uff09\u3002\u8fd9\u6bd4\u4f7f\u7528\u6307\u4ee4\u53c2\u6570\u7684\u4f18\u5148\u7ea7\u4f4e\u3002</p> <ul> <li> <p>Cache-Control \u5934\u5b57\u6bb5\u7684 stale-while-revalidate \u6269\u5c55\u5141\u8bb8\u4f7f\u7528\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\uff08\u5982\u679c\u5f53\u524d\u6b63\u5728\u66f4\u65b0\uff09\u3002</p> </li> <li> <p>Cache-Control \u5934\u5b57\u6bb5\u7684 stale-if-error \u6269\u5c55\u5141\u8bb8\u5728\u51fa\u73b0\u9519\u8bef\u65f6\u4f7f\u7528\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\u3002</p> </li> </ul> <p>\u8981\u5728\u586b\u5145\u65b0\u7f13\u5b58\u5143\u7d20\u65f6\u6700\u5927\u5316\u51cf\u5c11\u5bf9\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u53ef\u4ee5\u4f7f\u7528 proxy_cache_lock \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cache_valid","title":"proxy_cache_valid","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cache_valid <code>[code ...] time</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u4e3a\u4e0d\u540c\u7684\u54cd\u5e94\u4ee3\u7801\u8bbe\u7f6e\u7f13\u5b58\u65f6\u95f4\u3002\u4f8b\u5982\u4ee5\u4e0b\u6307\u4ee4</p> <pre><code>proxy_cache_valid 200 302 10m;\nproxy_cache_valid 404      1m;\n</code></pre> <p>\u4e3a\u4ee3\u7801\u4e3a 200 \u548c 302 \u7684\u54cd\u5e94\u8bbe\u7f6e 10 \u5206\u949f\u7684\u7f13\u5b58\u65f6\u95f4\uff0c\u4e3a\u4ee3\u7801 404 \u7684\u54cd\u5e94\u8bbe\u7f6e 1 \u5206\u949f\u7684\u7f13\u5b58\u65f6\u95f4\u3002</p> <p>\u5982\u679c\u4ec5\u6307\u5b9a\u4e86\u7f13\u5b58 <code>time</code></p> <pre><code>proxy_cache_valid 5m;\n</code></pre> <p>\u5c06\u53ea\u7f13\u5b58 200\u3001301 \u548c 302 \u7684\u54cd\u5e94\u3002</p> <p>\u6b64\u5916\uff0c\u53ef\u4ee5\u6307\u5b9a <code>any</code> \u53c2\u6570\u6765\u7f13\u5b58\u4efb\u4f55\u54cd\u5e94\uff1a</p> <pre><code>proxy_cache_valid 200 302 10m;\nproxy_cache_valid 301      1h;\nproxy_cache_valid any      1m;\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728\u54cd\u5e94\u5934\u4e2d\u8bbe\u7f6e\u7f13\u5b58\u7684\u53c2\u6570\u3002\u8fd9\u6bd4\u4f7f\u7528\u8be5\u6307\u4ee4\u8bbe\u7f6e\u7f13\u5b58\u65f6\u95f4\u5177\u6709\u66f4\u9ad8\u7684\u4f18\u5148\u7ea7\u3002</p> <ul> <li>X-Accel-Expires \u5934\u5b57\u6bb5\u8bbe\u7f6e\u4ee5\u79d2\u4e3a\u5355\u4f4d\u7684\u54cd\u5e94\u7f13\u5b58\u65f6\u95f4\u3002\u96f6\u503c\u5c06\u7981\u7528\u54cd\u5e94\u7f13\u5b58\u3002\u5982\u679c\u503c\u4ee5 <code>@</code> \u524d\u7f00\u5f00\u5934\uff0c\u5219\u8bbe\u7f6e\u81ea Epoch \u4ee5\u6765\u7684\u7edd\u5bf9\u65f6\u95f4\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09\u5185\u7684\u54cd\u5e94\u53ef\u4ee5\u88ab\u7f13\u5b58\u3002</li> <li>\u5982\u679c\u5934\u4e0d\u5305\u62ec X-Accel-Expires \u5b57\u6bb5\uff0c\u5219\u53ef\u4ee5\u5728\u5934\u5b57\u6bb5 Expires \u6216 Cache-Control \u4e2d\u8bbe\u7f6e\u7f13\u5b58\u7684\u53c2\u6570\u3002</li> <li>\u5982\u679c\u5934\u5305\u542b\u4e86 Set-Cookie \u5b57\u6bb5\uff0c\u5219\u4e0d\u4f1a\u7f13\u5b58\u6b64\u7c7b\u54cd\u5e94\u3002</li> <li>\u5982\u679c\u5934\u5305\u542b\u6709\u7279\u6b8a\u503c <code>*</code> \u7684 Vary \u5b57\u6bb5\uff0c\u5219\u4e0d\u4f1a\u7f13\u5b58\u6b64\u7c7b\u54cd\u5e94\uff081.7.7\uff09\u3002\u5982\u679c\u5934\u5305\u542b\u6709\u53e6\u4e00\u4e2a\u503c\u7684 Vary \u5b57\u6bb5\uff0c\u8fd9\u6837\u7684\u54cd\u5e94\u5219\u5c06\u8003\u8651\u7f13\u5b58\u76f8\u5e94\u7684\u8bf7\u6c42\u5934\u5b57\u6bb5\uff081.7.7\uff09\u3002</li> </ul> <p>\u53ef\u4ee5\u4f7f\u7528 proxy_ignore_headers \u6307\u4ee4\u7981\u7528\u8fd9\u4e9b\u54cd\u5e94\u5934\u5b57\u6bb5\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u7684\u5904\u7406\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_connect_timeout","title":"proxy_connect_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_connect_timeout <code>time</code>; \u9ed8\u8ba4 proxy_connect_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e0e\u4ee3\u7406\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u5e94\u8be5\u6ce8\u610f\uff0c\u6b64\u8d85\u65f6\u65f6\u95f4\u901a\u5e38\u4e0d\u4f1a\u8d85\u8fc7 75 \u79d2\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_cookie_path","title":"proxy_cookie_path","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_cookie_path <code>off</code>;  proxy_cookie_path <code>path replacement</code>; \u9ed8\u8ba4 proxy_cookie_path off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.15 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u4ee3\u7406\u670d\u52a1\u5668\u54cd\u5e94\u7684 Set-Cookie \u5934\u5b57\u6bb5\u7684 <code>path</code> \u5c5e\u6027\u4e2d\u7684\u5e94\u8be5\u53d8\u66f4\u7684\u6587\u672c\u3002\u5047\u8bbe\u4ee3\u7406\u670d\u52a1\u5668\u8fd4\u56de\u5e26\u6709\u5c5e\u6027 <code>path=/two/some/uri/</code> \u7684 Set-Cookie \u5934\u5b57\u6bb5\u3002\u6307\u4ee4\uff1a</p> <pre><code>proxy_cookie_path /two/ /;\n</code></pre> <p>\u5c06\u6b64\u5c5e\u6027\u91cd\u5199\u4e3a <code>path=/some/uri/</code>\u3002</p> <p><code>path</code> \u548c <code>replacement</code> \u5b57\u7b26\u4e32\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff1a</p> <pre><code>proxy_cookie_path $uri /some$uri;\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u6307\u5b9a\u8be5\u6307\u4ee4\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8def\u5f84\u5e94\u8be5\u4ee5\u533a\u5206\u5927\u5c0f\u5199\u7684 <code>\u301c</code> \u5339\u914d\u7b26\u53f7\u5f00\u59cb\uff0c\u6216\u8005\u4ee5\u533a\u5206\u5927\u5c0f\u5199\u7684 <code>\u301c*</code> \u5339\u914d\u7b26\u53f7\u5f00\u59cb\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u53ef\u4ee5\u5305\u542b\u547d\u540d\u548c\u4f4d\u7f6e\u6355\u83b7\uff0c<code>replacement</code> \u53ef\u4ee5\u5f15\u7528\u5b83\u4eec\uff1a</p> <pre><code>proxy_cookie_path ~*^/user/([^/]+) /u/$1;\n</code></pre> <p>\u53ef\u80fd\u6709\u591a\u4e2a <code>proxy_cookie_path</code> \u6307\u4ee4\uff1a</p> <pre><code>proxy_cookie_path /one/ /;\nproxy_cookie_path / /two/;\n</code></pre> <p><code>off</code> \u53c2\u6570\u53d6\u6d88\u6240\u6709 <code>proxy_cookie_path</code> \u6307\u4ee4\u5bf9\u5f53\u524d\u7ea7\u522b\u7684\u5f71\u54cd\uff1a</p> <pre><code>proxy_cookie_path off;\nproxy_cookie_path /two/ /;\nproxy_cookie_path ~*^/user/([^/]+) /u/$1;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_force_ranges","title":"proxy_force_ranges","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_force_ranges <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_force_ranges off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u65e0\u8bba\u4ee3\u7406\u670d\u52a1\u5668\u4e2d\u7684 Accept-Ranges \u5b57\u6bb5\u5982\u4f55\uff0c\u5bf9\u4ee3\u7406\u670d\u52a1\u5668\u7684\u7f13\u5b58\u548c\u672a\u7f13\u5b58\u54cd\u5e94\u90fd\u542f\u7528\u5b57\u8282\u8303\u56f4\uff08byte-range\uff09\u652f\u6301\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_force_ranges_1","title":"proxy_force_ranges","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_headers_hash_bucket_size <code>size</code>; \u9ed8\u8ba4 proxy_headers_hash_bucket_size 64; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e proxy_hide_header \u548c proxy_set_header \u6307\u4ee4\u4f7f\u7528\u7684\u54c8\u5e0c\u8868\u7684\u6876 <code>size</code>\u3002\u8bbe\u7f6e\u54c8\u5e0c\u8868\u7684\u8be6\u7ec6\u4ecb\u7ecd\u5728\u5355\u72ec\u7684\u6587\u6863\u4e2d\u63d0\u4f9b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_headers_hash_max_size","title":"proxy_headers_hash_max_size","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_headers_hash_max_size <code>size</code>; \u9ed8\u8ba4 proxy_headers_hash_max_size 512; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e proxy_hide_header \u548c proxy_set_header \u6307\u4ee4\u4f7f\u7528\u7684\u54c8\u5e0c\u8868\u7684\u6700\u5927 <code>size</code>\u3002\u8bbe\u7f6e\u54c8\u5e0c\u8868\u7684\u8be6\u7ec6\u4ecb\u7ecd\u5728\u5355\u72ec\u7684\u6587\u6863\u4e2d\u63d0\u4f9b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_hide_header","title":"proxy_hide_header","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_hide_header <code>field</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnginx \u4e0d\u4f1a\u4ece\u4ee3\u7406\u670d\u52a1\u5668\u5411\u5ba2\u6237\u7aef\u7684\u54cd\u5e94\u4e2d\u4f20\u9012\u5934\u5b57\u6bb5 Date\u3001Server\u3001X-Pad \u548c X-Accel-...\u3002<code>proxy_hide_header</code> \u6307\u4ee4\u8bbe\u7f6e\u4e0d\u4f20\u9012\u7684\u5176\u4ed6\u5b57\u6bb5\u3002\u76f8\u53cd\uff0c\u5982\u679c\u9700\u8981\u5141\u8bb8\u4f20\u9012\u5b57\u6bb5\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 proxy_pass_header \u6307\u4ee4\u8bbe\u7f6e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_http_version","title":"proxy_http_version","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_http_version <code>1.0</code> | <code>1.1</code>; \u9ed8\u8ba4 proxy_http_version 1.0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.4 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u4ee3\u7406\u7684 HTTP \u534f\u8bae\u7248\u672c\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528 1.0 \u7248\u672c\u3002\u5efa\u8bae\u5c06 1.1 \u7248\u4e0e keepalive \u8fde\u63a5\u548c NTLM \u8eab\u4efd\u9a8c\u8bc1\u914d\u5408\u4f7f\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_ignore_client_abort","title":"proxy_ignore_client_abort","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ignore_client_abort <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_ignore_client_abort off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u786e\u5b9a\u5728\u5ba2\u6237\u7aef\u5173\u95ed\u8fde\u63a5\u4e0d\u7b49\u5f85\u54cd\u5e94\u65f6\u662f\u5426\u5e94\u5173\u95ed\u4e0e\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8fde\u63a5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_ignore_headers","title":"proxy_ignore_headers","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ignore_headers <code>field ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u7981\u7528\u5904\u7406\u67d0\u4e9b\u6765\u81ea\u4ee3\u7406\u670d\u52a1\u5668\u7684\u54cd\u5e94\u5934\u5b57\u6bb5\u3002\u53ef\u4ee5\u5ffd\u7565\u4ee5\u4e0b\u5b57\u6bb5\uff1aX-Accel-Redirect\u3001X-Accel-Expires\u3001X-Accel-Limit-Rate\uff081.1.6\uff09\u3001X-Accel-Buffering\uff081.1.6\uff09\u3001X-Accel-Charset\uff081.1.6\uff09\u3001Expires\u3001Cache-Control\u3001Set-Cookie\uff080.8.44\uff09\u548c Vary\uff081.7.7\uff09\u3002</p> <p>\u5982\u679c\u672a\u7981\u7528\uff0c\u5904\u7406\u8fd9\u4e9b\u5934\u5b57\u6bb5\u5c06\u4f1a\u4ea7\u751f\u4ee5\u4e0b\u5f71\u54cd\uff1a</p> <ul> <li>X-Accel-Expires\u3001Expires\u3001Cache-Control\u3001Set-Cookie \u548c Vary \u8bbe\u7f6e\u54cd\u5e94\u7f13\u5b58\u7684\u53c2\u6570</li> <li>X-Accel-Redirect \u6267\u884c\u5185\u90e8\u91cd\u5b9a\u5411\u5230\u6307\u5b9a\u7684 URI</li> <li>X-Accel-Limit-Rate \u8bbe\u7f6e\u5411\u5ba2\u6237\u7aef\u4f20\u8f93\u54cd\u5e94\u7684\u901f\u7387\u9650\u5236</li> <li>X-Accel-Buffering \u542f\u7528\u6216\u7981\u7528\u54cd\u5e94\u7f13\u51b2</li> <li>X-Accel-Charset \u8bbe\u7f6e\u4e86\u6240\u9700\u7684\u54cd\u5e94\u5b57\u7b26\u96c6</li> </ul>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_intercept_errors","title":"proxy_intercept_errors","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_intercept_errors <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_intercept_errors off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u786e\u5b9a\u72b6\u6001\u7801\u5927\u4e8e\u6216\u7b49\u4e8e 300 \u7684\u4ee3\u7406\u54cd\u5e94\u662f\u5e94\u8be5\u4f20\u9012\u7ed9\u5ba2\u6237\u7aef\u8fd8\u662f\u62e6\u622a\u5e76\u91cd\u5b9a\u5411\u5230 nginx \u4ee5\u4fbf\u4f7f\u7528 error_page \u6307\u4ee4\u8fdb\u884c\u5904\u7406\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_limit_rate","title":"proxy_limit_rate","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_limit_rate <code>rate</code>; \u9ed8\u8ba4 proxy_limit_rate 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236\u4ece\u4ee3\u7406\u670d\u52a1\u5668\u8bfb\u53d6\u54cd\u5e94\u7684\u901f\u7387\u3002<code>rate</code> \u4ee5\u6bcf\u79d2\u5b57\u8282\u6570\u6307\u5b9a\u3002\u96f6\u503c\u5219\u7981\u7528\u901f\u7387\u9650\u5236\u3002\u9650\u5236\u662f\u9488\u5bf9\u6bcf\u4e2a\u8bf7\u6c42\uff0c\u56e0\u6b64\u5982\u679c nginx \u540c\u65f6\u6253\u5f00\u4e24\u4e2a\u5230\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8fde\u63a5\uff0c\u5219\u603b\u901f\u7387\u5c06\u662f\u6307\u5b9a\u9650\u5236\u7684\u4e24\u500d\u3002\u4ec5\u5f53\u542f\u7528\u4e86\u4ee3\u7406\u670d\u52a1\u5668\u7684\u54cd\u5e94\u7f13\u51b2\u65f6\uff0c\u6b64\u9650\u5236\u624d\u751f\u6548\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_max_temp_file_size","title":"proxy_max_temp_file_size","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_max_temp_file_size <code>size</code>; \u9ed8\u8ba4 proxy_max_temp_file_size 1024m; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5f53\u542f\u7528\u7f13\u51b2\u6765\u81ea\u4ee3\u7406\u670d\u52a1\u5668\u7684\u54cd\u5e94\uff0c\u5e76\u4e14\u6574\u4e2a\u54cd\u5e94\u4e0d\u7b26\u5408 proxy_buffer_size \u548c proxy_buffers \u6307\u4ee4\u8bbe\u7f6e\u7684\u7f13\u51b2\u65f6\uff0c\u90e8\u5206\u54cd\u5e94\u53ef\u4ee5\u4fdd\u5b58\u5230\u4e34\u65f6\u6587\u4ef6\u4e2d\u3002\u8be5\u6307\u4ee4\u8bbe\u7f6e\u4e34\u65f6\u6587\u4ef6\u7684\u6700\u5927 <code>size</code>\u3002\u4e00\u6b21\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u7684\u6570\u636e\u5927\u5c0f\u7531 proxy_temp_file_write_size \u6307\u4ee4\u8bbe\u7f6e\u3002</p> <p>\u96f6\u503c\u5219\u7981\u6b62\u5c06\u7f13\u51b2\u54cd\u5e94\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u3002</p> <p>\u6b64\u9650\u5236\u4e0d\u9002\u7528\u4e8e\u5c06\u8981\u7f13\u5b58\u6216\u5b58\u50a8\u5728\u78c1\u76d8\u4e0a\u7684\u54cd\u5e94\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_method","title":"proxy_method","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_method <code>method</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u5b9a\u8f6c\u53d1\u5230\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u4f7f\u7528\u7684 HTTP \u65b9\u6cd5\uff08<code>method</code>\uff09\uff0c\u800c\u4e0d\u662f\u4f7f\u7528\u6765\u81ea\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u65b9\u6cd5\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.11.6\uff09\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_next_upstream","title":"proxy_next_upstream","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_next_upstream <code>error</code> | <code>timeout</code> | <code>invalid_header</code> | <code>http_500</code> | <code>http_502</code> | <code>http_503</code> | <code>http_504</code> | <code>http_403</code> | <code>http_404</code> | <code>http_429</code> | <code>non_idempotent</code> | <code>off ...</code>; \u9ed8\u8ba4 proxy_intercept_errors off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u5b9a\u5e94\u5c06\u8bf7\u6c42\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u6761\u4ef6\uff1a</p> <ul> <li> <p><code>error</code></p> <p>\u4e0e\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\uff0c\u5411\u5176\u4f20\u9012\u8bf7\u6c42\u6216\u8bfb\u53d6\u54cd\u5e94\u5934\u65f6\u53d1\u751f\u9519\u8bef</p> </li> <li> <p><code>timeout</code></p> <p>\u5728\u4e0e\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\uff0c\u5411\u5176\u4f20\u9012\u8bf7\u6c42\u6216\u8bfb\u53d6\u54cd\u5e94\u5934\u65f6\u53d1\u751f\u8d85\u65f6</p> </li> <li> <p><code>invalid_header</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u7a7a\u6216\u65e0\u6548\u54cd\u5e94</p> </li> <li> <p><code>http_500</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u4ee3\u7801\u4e3a 500 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_502</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u4ee3\u7801\u4e3a 502 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_503</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u4ee3\u7801\u4e3a 503 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_504</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u4ee3\u7801 504 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_403</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u4ee3\u7801\u4e3a 403 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_404</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u4ee3\u7801\u4e3a 404 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_429</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u4ee3\u7801\u4e3a 429 \u7684\u54cd\u5e94\uff081.11.13\uff09</p> </li> <li> <p><code>non_idempotent</code></p> <p>\u901a\u5e38\uff0c\u5982\u679c\u8bf7\u6c42\u5df2\u53d1\u9001\u5230\u4e0a\u6e38\u670d\u52a1\u5668\uff0c\u5219\u4f7f\u7528\u975e\u5e42\u7b49\u65b9\u6cd5\uff08<code>POST</code>\u3001<code>LOCK</code>\u3001<code>PATCH</code>\uff09\u7684\u8bf7\u6c42\u4e0d\u4f1a\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\uff081.9.13\uff09\uff0c\u542f\u7528\u6b64\u9009\u9879\u663e\u5f0f\u5141\u8bb8\u91cd\u8bd5\u6b64\u7c7b\u8bf7\u6c42</p> </li> <li> <p><code>off</code></p> <p>\u7981\u6b62\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668</p> </li> </ul> <p>\u5e94\u8be5\u8bb0\u4f4f\uff0c\u53ea\u6709\u5728\u5c1a\u672a\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u4efb\u4f55\u5185\u5bb9\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u80fd\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u5728\u4f20\u8f93\u54cd\u5e94\u7684\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\u6216\u8d85\u65f6\uff0c\u5219\u65e0\u6cd5\u4fee\u590d\u6b64\u95ee\u9898\u3002</p> <p>\u8be5\u6307\u4ee4\u8fd8\u5b9a\u4e49\u4e86\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u7684\u5931\u8d25\u5c1d\u8bd5\u3002<code>error</code>\u3001<code>timeout</code> \u548c <code>invalid_header</code> \u7684\u60c5\u51b5\u59cb\u7ec8\u88ab\u89c6\u4e3a\u5931\u8d25\u5c1d\u8bd5\uff0c\u5373\u4f7f\u5b83\u4eec\u672a\u5728\u6307\u4ee4\u4e2d\u6307\u5b9a\u3002<code>http_500</code>\u3001<code>http_502</code>\u3001<code>http_503</code>\u3001<code>http_504</code> \u548c <code>http_429</code> \u7684\u60c5\u51b5\u4ec5\u5728\u6307\u4ee4\u4e2d\u6307\u5b9a\u65f6\u624d\u88ab\u89c6\u4e3a\u5931\u8d25\u5c1d\u8bd5\u3002<code>http_403</code> \u548c <code>http_404</code> \u7684\u60c5\u51b5\u4e0d\u4f1a\u88ab\u89c6\u4e3a\u5931\u8d25\u5c1d\u8bd5\u3002</p> <p>\u5c06\u8bf7\u6c42\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u53ef\u80fd\u4f1a\u53d7\u5230\u5c1d\u8bd5\u6b21\u6570\u548c\u65f6\u95f4\u7684\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_next_upstream_timeout","title":"proxy_next_upstream_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_next_upstream_timeout <code>time</code>; \u9ed8\u8ba4 proxy_next_upstream_timeout 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.5 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236\u8bf7\u6c42\u53ef\u4ee5\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u65f6\u95f4\u3002<code>0</code> \u503c\u5173\u95ed\u6b64\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_next_upstream_tries","title":"proxy_next_upstream_tries","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_next_upstream_tries <code>number</code>; \u9ed8\u8ba4 proxy_next_upstream_tries 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.5 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236\u5c06\u8bf7\u6c42\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u53ef\u80fd\u5c1d\u8bd5\u6b21\u6570\u3002<code>0</code> \u503c\u5173\u95ed\u6b64\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_no_cache","title":"proxy_no_cache","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_no_cache <code>string ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e0d\u5c06\u54cd\u5e94\u4fdd\u5b58\u5230\u7f13\u5b58\u7684\u6761\u4ef6\u3002\u5982\u679c\u5b57\u7b26\u4e32\u53c2\u6570\u6709\u4e00\u4e2a\u503c\u4e0d\u4e3a\u7a7a\u4e14\u4e0d\u7b49\u4e8e <code>0</code>\uff0c\u5219\u4e0d\u4f1a\u4fdd\u5b58\u54cd\u5e94\uff1a</p> <pre><code>proxy_no_cache $cookie_nocache $arg_nocache$arg_comment;\nproxy_no_cache $http_pragma    $http_authorization;\n</code></pre> <p>\u53ef\u4ee5\u4e0e proxy_cache_bypass \u6307\u4ee4\u4e00\u8d77\u4f7f\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_pass","title":"proxy_pass","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_pass <code>URL</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u4ee3\u7406\u670d\u52a1\u5668\u7684\u534f\u8bae\u3001\u5730\u5740\u4ee5\u53ca\u5e94\u6620\u5c04\u4f4d\u7f6e\u7684\u53ef\u9009 URI\u3002\u534f\u8bae\u53ef\u4ee5\u6307\u5b9a <code>http</code> \u6216 <code>https</code>\u3002\u53ef\u4ee5\u5c06\u5730\u5740\u6307\u5b9a\u4e3a\u57df\u540d\u6216 IP \u5730\u5740\uff0c\u4ee5\u53ca\u4e00\u4e2a\u53ef\u9009\u7aef\u53e3\u53f7\uff1a</p> <pre><code>proxy_pass http://localhost:8000/uri/;\n</code></pre> <p>\u6216\u8005\u5728 <code>unix</code> \u5355\u8bcd\u540e\u9762\u6307\u5b9a\u4f7f\u7528\u5192\u53f7\u62ec\u8d77\u6765\u7684 UNIX \u57df\u5957\u63a5\u5b57\u8def\u5f84\uff1a</p> <pre><code>proxy_pass http://unix:/tmp/backend.socket:/uri/;\n</code></pre> <p>\u5982\u679c\u57df\u540d\u89e3\u6790\u4e3a\u591a\u4e2a\u5730\u5740\uff0c\u5219\u6240\u6709\u8fd9\u4e9b\u5730\u5740\u5c06\u4ee5\u8f6e\u8be2\u7684\u65b9\u5f0f\u4f7f\u7528\u3002\u6b64\u5916\uff0c\u53ef\u4ee5\u5c06\u5730\u5740\u6307\u5b9a\u4e3a\u670d\u52a1\u5668\u7ec4\u3002</p> <p>\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5c06\u5730\u5740\u6307\u5b9a\u4e3a\u57df\u540d\uff0c\u5219\u5728\u6240\u63cf\u8ff0\u7684\u670d\u52a1\u5668\u7ec4\u4e2d\u641c\u7d22\u540d\u79f0\uff0c\u5982\u679c\u672a\u627e\u5230\uff0c\u5219\u4f7f\u7528\u89e3\u6790\u5668\u786e\u5b9a\u3002</p> <p>\u8bf7\u6c42 URI \u6309\u5982\u4e0b\u65b9\u5f0f\u4f20\u9012\u7ed9\u670d\u52a1\u5668\uff1a</p> <ul> <li> <p>\u5982\u679c\u6307\u5b9a\u4e86\u5e26\u6709 URI \u7684 <code>proxy_pass</code>\uff0c\u90a3\u4e48\u5f53\u8bf7\u6c42\u4f20\u9012\u7ed9\u670d\u52a1\u5668\u65f6\uff0c\u4e0e\u8be5\u4f4d\u7f6e\uff08location\uff09\u5339\u914d\u7684\u89c4\u8303\u5316\u8bf7\u6c42 URI \u7684\u90e8\u5206\u5c06\u88ab\u6307\u4ee4\u4e2d\u6307\u5b9a\u7684 URI \u66ff\u6362\uff1a</p> <pre><code>location /name/ {\nproxy_pass http://127.0.0.1/remote/;\n}\n</code></pre> </li> <li> <p>\u5982\u679c\u6307\u5b9a\u4e86\u6ca1\u6709 URI \u7684 <code>proxy_pass</code>\uff0c\u5219\u8bf7\u6c42 URI \u5c06\u4ee5\u4e0e\u5904\u7406\u539f\u59cb\u8bf7\u6c42\u65f6\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u683c\u5f0f\u76f8\u540c\u7684\u5f62\u5f0f\u4f20\u9012\u7ed9\u670d\u52a1\u5668\uff0c\u6216\u8005\u5728\u5904\u7406\u66f4\u6539\u7684 URI \u65f6\u4f20\u9012\u5b8c\u6574\u7684\u89c4\u8303\u5316\u8bf7\u6c42 URI\uff1a</p> <pre><code>location /some/path/ {\nproxy_pass http://127.0.0.1;\n}\n</code></pre> <p>\u5728 1.1.12 \u7248\u672c\u4e4b\u524d\uff0c\u5982\u679c\u6307\u5b9a\u4e86\u6ca1\u6709 URI \u7684 <code>proxy_pass</code>\uff0c\u5219\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u53ef\u80fd\u4f1a\u4f20\u9012\u539f\u59cb\u8bf7\u6c42 URI \u800c\u4e0d\u662f\u66f4\u6539 URI\u3002</p> </li> </ul> <p>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u65e0\u6cd5\u786e\u5b9a\u8bf7\u6c42 URI \u8981\u66ff\u6362\u7684\u90e8\u5206\uff1a</p> <ul> <li> <p>\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u6307\u5b9a location \uff08\u4f4d\u7f6e\uff09\u65f6\uff0c\u4ee5\u53ca\u5728\u547d\u540d\u4f4d\u7f6e\u5185\u6307\u5b9a\u4f4d\u7f6e\u3002 \u5728\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u5e94\u6307\u5b9a <code>proxy_pass</code> \u800c\u4e0d\u4f7f\u7528 URI\u3002</p> </li> <li> <p>\u4f7f\u7528 rewrite \u6307\u4ee4\u5728\u4ee3\u7406\u4f4d\u7f6e\u5185\u66f4\u6539 URI \u65f6\uff0c\u5c06\u4f7f\u7528\u76f8\u540c\u7684\u914d\u7f6e\u6765\u5904\u7406\u8bf7\u6c42\uff08<code>break</code>\uff09\uff1a</p> <pre><code>location /name/ {\nrewrite    /name/([^/]+) /users?name=$1 break;\nproxy_pass http://127.0.0.1;\n}\n</code></pre> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u5ffd\u7565\u6307\u4ee4\u4e2d\u6307\u5b9a\u7684 URI\uff0c\u5e76\u5c06\u5b8c\u6574\u66f4\u6539\u7684\u8bf7\u6c42 URI \u4f20\u9012\u7ed9\u670d\u52a1\u5668\u3002</p> </li> <li> <p>\u5728 proxy_pass \u4e2d\u4f7f\u7528\u53d8\u91cf\u65f6\uff1a</p> <pre><code>location /name/ {\nproxy_pass http://127.0.0.1$request_uri;\n}\n</code></pre> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5728\u6307\u4ee4\u4e2d\u6307\u5b9a\u4e86 URI\uff0c\u5219\u5c06\u5176\u539f\u6837\u4f20\u9012\u7ed9\u670d\u52a1\u5668\uff0c\u66ff\u6362\u539f\u59cb\u8bf7\u6c42 URI\u3002</p> </li> </ul> <p>WebSocket \u4ee3\u7406\u9700\u8981\u7279\u6b8a\u914d\u7f6e\uff0c\u4ece 1.3.13 \u7248\u672c\u5f00\u59cb\u652f\u6301\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_pass_header","title":"proxy_pass_header","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_pass_header <code>field</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5141\u8bb8\u5c06\u5df2\u7981\u7528\u7684\u5934\u5b57\u6bb5\u4ece\u4ee3\u7406\u670d\u52a1\u5668\u4f20\u9012\u5230\u5ba2\u6237\u7aef\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_pass_request_body","title":"proxy_pass_request_body","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_pass_request_body <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_pass_request_body on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u793a\u662f\u5426\u5c06\u539f\u59cb\u8bf7\u6c42\u4f53\u4f20\u9012\u7ed9\u4ee3\u7406\u670d\u52a1\u5668\u3002</p> <pre><code>location /x-accel-redirect-here/ {\nproxy_method GET;\nproxy_pass_request_body off;\nproxy_set_header Content-Length \"\";\n\nproxy_pass ...\n}\n</code></pre> <p>\u53e6\u8bf7\u53c2\u9605 proxy_set_header \u548c proxy_pass_request_headers \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_pass_request_headers","title":"proxy_pass_request_headers","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_pass_request_headers <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_pass_request_headers on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u793a\u662f\u5426\u5c06\u539f\u59cb\u8bf7\u6c42\u7684 header \u5b57\u6bb5\u4f20\u9012\u7ed9\u4ee3\u7406\u670d\u52a1\u5668\u3002</p> <pre><code>location /x-accel-redirect-here/ {\nproxy_method GET;\nproxy_pass_request_headers off;\nproxy_pass_request_body off;\n\nproxy_pass ...\n}\n</code></pre> <p>\u53e6\u8bf7\u53c2\u9605 proxy_set_header \u548c proxy_pass_request_body \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_read_timeout","title":"proxy_read_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_read_timeout <code>time</code>; \u9ed8\u8ba4 proxy_read_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4ece\u4ee3\u7406\u670d\u52a1\u5668\u8bfb\u53d6\u54cd\u5e94\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u8be5\u8d85\u65f6\u65f6\u95f4\u4ec5\u9488\u5bf9\u4e24\u4e2a\u8fde\u7eed\u7684\u8bfb\u64cd\u4f5c\u4e4b\u95f4\u8bbe\u7f6e\uff0c\u800c\u4e0d\u662f\u6574\u4e2a\u54cd\u5e94\u7684\u4f20\u8f93\u8fc7\u7a0b\u3002\u5982\u679c\u4ee3\u7406\u670d\u52a1\u5668\u5728\u8be5\u65f6\u95f4\u5185\u672a\u4f20\u8f93\u4efb\u4f55\u5185\u5bb9\uff0c\u5219\u5173\u95ed\u8fde\u63a5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_redirect","title":"proxy_redirect","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_redirect <code>default</code>;proxy_redirect <code>off</code>;proxy_redirect <code>redirect replacement</code>; \u9ed8\u8ba4 proxy_redirect default; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u4ee3\u7406\u670d\u52a1\u5668\u54cd\u5e94 header \u4e2d\u7684 Location \u548c Refresh \u5b57\u6bb5\u5e94\u8981\u66f4\u6539\u7684\u6587\u672c\u3002\u5047\u8bbe\u4ee3\u7406\u670d\u52a1\u5668\u8fd4\u56deheader \u5b57\u6bb5\u4e3a <code>Location: http://localhost:8000/two/some/uri/</code>\u3002\u6307\u4ee4</p> <pre><code>proxy_redirect http://localhost:8000/two/ http://frontend/one/;\n</code></pre> <p>\u5c06\u6b64\u5b57\u7b26\u4e32\u91cd\u5199\u4e3a <code>Location: http://frontend/one/some/uri/</code>\u3002</p> <p><code>replacement</code> \u4e2d\u53ef\u80fd\u7701\u7565\u4e86\u670d\u52a1\u5668\u540d\u79f0\uff1a</p> <pre><code>proxy_redirect http://localhost:8000/two/ /;\n</code></pre> <p>\u7136\u540e\u5982\u679c\u4e0d\u662f\u6765\u81ea 80 \u7aef\u53e3\uff0c\u5219\u5c06\u63d2\u5165\u4e3b\u670d\u52a1\u5668\u7684\u540d\u79f0\u548c\u7aef\u53e3\u3002</p> <p><code>default</code> \u53c2\u6570\u6307\u5b9a\u7684\u9ed8\u8ba4\u66ff\u6362\u4f7f\u7528 location \u548c proxy_pass \u6307\u4ee4\u7684\u53c2\u6570\u3002\u56e0\u6b64\uff0c\u4ee5\u4e0b\u4e24\u79cd\u914d\u7f6e\u662f\u7b49\u6548\u7684\uff1a</p> <pre><code>location /one/ {\nproxy_pass     http://upstream:port/two/;\nproxy_redirect default;\n</code></pre> <pre><code>location /one/ {\nproxy_pass     http://upstream:port/two/;\nproxy_redirect http://upstream:port/two/ /one/;\n</code></pre> <p>\u5982\u679c\u4f7f\u7528\u53d8\u91cf\u6307\u5b9a proxy_pass\uff0c\u5219\u4e0d\u5141\u8bb8\u4f7f\u7528 <code>default</code> \u53c2\u6570\u3002</p> <p><code>replacement</code> \u5b57\u7b26\u4e32\u53ef\u4ee5\u5305\u6362\u53d8\u91cf\uff1a</p> <pre><code>proxy_redirect http://localhost:8000/ http://$host:$server_port/;\n</code></pre> <p><code>redirect</code> \u4e5f\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.1.11 \u7248\u672c\uff09:</p> <pre><code>proxy_redirect http://$proxy_host:8000/ /;\n</code></pre> <p>\u53ef\u4ee5\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u6307\u5b9a\u6307\u4ee4\uff081.1.11\uff09\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c<code>redirect</code> \u5e94\u8be5\u4ee5 <code>~</code> \u7b26\u53f7\u5f00\u5934\uff0c\u4ee5\u533a\u5206\u5927\u5c0f\u5199\u5339\u914d\uff0c\u6216\u8005\u4f7f\u7528 <code>~*</code> \u7b26\u53f7\u4ee5\u533a\u5206\u5927\u5c0f\u5199\u5339\u914d\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u53ef\u4ee5\u5305\u542b\u547d\u540d\u548c\u4f4d\u7f6e\u6355\u83b7\uff0c\u5e76\u4e14 <code>replacement</code> \u53ef\u4ee5\u5f15\u7528\u5b83\u4eec\uff1a</p> <pre><code>proxy_redirect ~^(http://[^:]+):\\d+(/.+)$ $1$2;\nproxy_redirect ~*/user/([^/]+)/(.+)$      http://$1.example.com/$2;\n</code></pre> <p><code>off</code> \u53c2\u6570\u53d6\u6d88\u6240\u6709 <code>proxy_redirect</code> \u6307\u4ee4\u5bf9\u5f53\u524d\u7ea7\u522b\u7684\u5f71\u54cd\uff1a</p> <pre><code>proxy_redirect off;\nproxy_redirect default;\nproxy_redirect http://localhost:8000/  /;\nproxy_redirect http://www.example.com/ /;\n</code></pre> <p>\u4f7f\u7528\u6b64\u6307\u4ee4\uff0c\u8fd8\u53ef\u4ee5\u5c06\u4e3b\u673a\u540d\u6dfb\u52a0\u5230\u4ee3\u7406\u670d\u52a1\u5668\u53d1\u51fa\u7684\u76f8\u5bf9\u91cd\u5b9a\u5411\uff1a</p> <pre><code>proxy_redirect / /;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_request_buffering","title":"proxy_request_buffering","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_request_buffering <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_request_buffering on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.11 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u6216\u7981\u7528\u5ba2\u6237\u7aef\u8bf7\u6c42\u4f53\u7f13\u51b2\u3002</p> <p>\u542f\u7528\u7f13\u51b2\u540e\uff0c\u5728\u5c06\u8bf7\u6c42\u53d1\u9001\u5230\u4ee3\u7406\u670d\u52a1\u5668\u4e4b\u524d\uff0c\u5c06\u4ece\u5ba2\u6237\u7aef\u8bfb\u53d6\u6574\u4e2a\u8bf7\u6c42\u4f53\u3002</p> <p>\u7981\u7528\u7f13\u51b2\u65f6\uff0c\u8bf7\u6c42\u4f53\u5728\u6536\u5230\u65f6\u7acb\u5373\u53d1\u9001\u5230\u4ee3\u7406\u670d\u52a1\u5668\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c nginx \u5df2\u7ecf\u5f00\u59cb\u53d1\u9001\u8bf7\u6c42\u4f53\uff0c\u5219\u65e0\u6cd5\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u3002</p> <p>\u5f53\u4f7f\u7528 HTTP/1.1 \u5206\u5757\u4f20\u8f93\u7f16\u7801\u53d1\u9001\u539f\u59cb\u8bf7\u6c42\u4f53\u65f6\uff0c\u65e0\u8bba\u6307\u4ee4\u503c\u5982\u4f55\uff0c\u90fd\u5c06\u7f13\u51b2\u8bf7\u6c42\u4f53\uff0c\u9664\u975e\u4e3a\u4ee3\u7406\u542f\u7528\u4e86 HTTP/1.1\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_send_lowat","title":"proxy_send_lowat","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_send_lowat <code>size</code>; \u9ed8\u8ba4 proxy_send_lowat 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5982\u679c\u6307\u4ee4\u8bbe\u7f6e\u4e3a\u975e\u96f6\u503c\uff0c\u5219 nginx \u5c06\u5c1d\u8bd5\u901a\u8fc7\u4f7f\u7528 kqueue \u65b9\u6cd5\u7684 <code>NOTE_LOWAT</code> \u6807\u5fd7\u6216\u6709\u6307\u5b9a\u5927\u5c0f\u7684 <code>SO_SNDLOWAT</code> \u5957\u63a5\u5b57\u9009\u9879\u6765\u6700\u5c0f\u5316\u5230\u4ee3\u7406\u670d\u52a1\u5668\u7684\u4f20\u51fa\u8fde\u63a5\u4e0a\u7684\u53d1\u9001\u64cd\u4f5c\u6570\u3002</p> <p>\u5728 Linux\u3001Solaris \u548c Windows \u4e0a\u5ffd\u7565\u6b64\u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_send_timeout","title":"proxy_send_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_send_timeout <code>time</code>; \u9ed8\u8ba4 proxy_send_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u5c06\u8bf7\u6c42\u4f20\u8f93\u5230\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u8d85\u65f6\u65f6\u95f4\u4ec5\u4f5c\u7528\u4e8e\u4e24\u4e2a\u8fde\u7eed\u7684\u5199\u64cd\u4f5c\u4e4b\u95f4\uff0c\u800c\u4e0d\u662f\u6574\u4e2a\u8bf7\u6c42\u7684\u4f20\u8f93\u8fc7\u7a0b\u3002\u5982\u679c\u4ee3\u7406\u670d\u52a1\u5668\u5728\u8be5\u65f6\u95f4\u5185\u672a\u6536\u5230\u4efb\u4f55\u5185\u5bb9\uff0c\u5219\u5173\u95ed\u8fde\u63a5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_set_body","title":"proxy_set_body","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_set_body <code>value</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5141\u8bb8\u91cd\u65b0\u5b9a\u4e49\u4f20\u9012\u7ed9\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u4f53\u3002\u8be5\u503c\u53ef\u4ee5\u5305\u542b\u6587\u672c\u3001\u53d8\u91cf\u53ca\u5176\u7ec4\u5408\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_set_header","title":"proxy_set_header","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_set_header <code>filed value</code>; \u9ed8\u8ba4 proxy_set_header <code>Host $proxy_host</code>;proxy_set_header <code>Connection close</code>; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5141\u8bb8\u5c06\u5b57\u6bb5\u91cd\u65b0\u5b9a\u4e49\u6216\u9644\u52a0\u5230\u4f20\u9012\u7ed9\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8bf7\u6c42 header\u3002\u8be5\u503c\u53ef\u4ee5\u5305\u542b\u6587\u672c\u3001\u53d8\u91cf\u53ca\u5176\u7ec4\u5408\u3002\u5f53\u4e14\u4ec5\u5f53\u5728\u5f53\u524d\u7ea7\u522b\u4e0a\u6ca1\u6709\u5b9a\u4e49 <code>proxy_set_header</code> \u6307\u4ee4\u65f6\uff0c\u8fd9\u4e9b\u6307\u4ee4\u624d\u4ece\u4e0a\u5c42\u7ea7\u522b\u7ee7\u627f\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u53ea\u91cd\u65b0\u5b9a\u4e49\u4e86\u4e24\u4e2a\u5b57\u6bb5\uff1a</p> <pre><code>proxy_set_header Host       $proxy_host;\nproxy_set_header Connection close;\n</code></pre> <p>\u5982\u679c\u542f\u7528\u4e86\u7f13\u5b58\uff0c\u5219\u6765\u81ea\u539f\u59cb\u8bf7\u6c42\u7684 header \u5b57\u6bb5 If-Modified-Since\u3001If-Unmodified-Since\u3001If-None-Match\u3001If-Match\u3001Range \u548c If-Range \u4e0d\u4f1a\u4f20\u9012\u7ed9\u4ee3\u7406\u670d\u52a1\u5668\u3002</p> <p>\u4e00\u4e2a\u672a\u7ecf\u66f4\u6539\u7684\u8bf7\u6c42\u5934\uff08header\uff09\u5b57\u6bb5 Host \u53ef\u4ee5\u50cf\u8fd9\u6837\u4f20\u9012\uff1a</p> <pre><code>proxy_set_header Host       $http_host;\n</code></pre> <p>\u4f46\u662f\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u8bf7\u6c42 header \u4e2d\u4e0d\u5b58\u5728\u6b64\u5b57\u6bb5\uff0c\u5219\u4e0d\u4f1a\u4f20\u9012\u4efb\u4f55\u5185\u5bb9\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6700\u597d\u4f7f\u7528 <code>$host</code> \u53d8\u91cf \u2014\u2014 \u5b83\u7684\u503c\u7b49\u4e8e Host \u8bf7\u6c42\u5934\u5b57\u6bb5\u4e2d\u7684\u670d\u52a1\u5668\u540d\u79f0\uff0c\u6216\u8005\u5982\u679c\u6b64\u5b57\u6bb5\u4e0d\u5b58\u5728\u5219\u7b49\u4e8e\u4e3b\u670d\u52a1\u5668\u540d\u79f0\uff1a</p> <pre><code>proxy_set_header Host       $host;\n</code></pre> <p>\u6b64\u5916\uff0c\u670d\u52a1\u5668\u540d\u79f0\u53ef\u4ee5\u4e0e\u4ee3\u7406\u670d\u52a1\u5668\u7684\u7aef\u53e3\u4e00\u8d77\u4f20\u9012\uff1a</p> <pre><code>proxy_set_header Host       $host:$proxy_port;\n</code></pre> <p>\u5982\u679c\u5934\u5b57\u6bb5\u7684\u503c\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u5219\u6b64\u5b57\u6bb5\u5c06\u4e0d\u4f1a\u4f20\u9012\u7ed9\u4ee3\u7406\u670d\u52a1\u5668\uff1a</p> <pre><code>proxy_set_header Accept-Encoding \"\";\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_socket_keepalive","title":"proxy_socket_keepalive","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_socket_keepalive <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_socket_keepalive off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.15.6 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u914d\u7f6e\u5230\u4ee3\u7406\u670d\u52a1\u5668\u7684\u4f20\u51fa\u8fde\u63a5\u7684 TCP keepalive \u884c\u4e3a\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u8bbe\u7f6e\u5bf9 socket \u6709\u5f71\u54cd\u3002\u5982\u679c\u6307\u4ee4\u8bbe\u7f6e\u4e3a\u503c <code>on</code>\uff0c\u5219\u4e3a socket \u6253\u5f00 <code>SO_KEEPALIVE</code> socket \u9009\u9879\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_ssl_certificate","title":"proxy_ssl_certificate","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_certificate <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.8 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u4e00\u4e2a PEM \u683c\u5f0f\u7684\u8bc1\u4e66\u6587\u4ef6\uff08<code>file</code>\uff09\uff0c\u8be5\u8bc1\u4e66\u7528\u4e8e HTTPS \u4ee3\u7406\u670d\u52a1\u5668\u8eab\u4efd\u9a8c\u8bc1\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_ssl_certificate_key","title":"proxy_ssl_certificate_key","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_certificate_key <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.8 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u4e00\u4e2a\u6709\u5bc6\u94a5\u7684 PEM \u683c\u5f0f\u6587\u4ef6\uff08<code>file</code>\uff09\uff0c\u7528\u4e8e HTTPS \u4ee3\u7406\u670d\u52a1\u5668\u8eab\u4efd\u9a8c\u8bc1\u3002</p> <p>\u53ef\u4ee5\u6307\u5b9a <code>engine:name:id</code> \u6765\u4ee3\u66ff <code>file</code>\uff081.7.9\uff09\uff0c\u5b83\u5c06\u4ece\u540d\u4e3a <code>name</code> \u7684 OpenSSL \u5f15\u64ce\u52a0\u8f7d id \u4e3a <code>id</code> \u7684\u5bc6\u94a5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_ssl_ciphers","title":"proxy_ssl_ciphers","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_ciphers <code>ciphers</code>; \u9ed8\u8ba4 proxy_ssl_ciphers DEFAULT; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.6 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u5bf9 HTTPS \u4ee3\u7406\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u5df2\u542f\u7528\u5bc6\u7801\u3002\u5bc6\u7801\u5e94\u4e3a OpenSSL \u5e93\u652f\u6301\u7684\u683c\u5f0f\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 <code>openssl ciphers</code> \u547d\u4ee4\u67e5\u770b\u5b8c\u6574\u7684\u652f\u6301\u5217\u8868\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_ssl_crl","title":"proxy_ssl_crl","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_crl <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.0 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u4e00\u4e2a\u5305\u542b\u5df2\u64a4\u9500\u8bc1\u4e66\uff08CRL\uff09\u7684 PEM \u683c\u5f0f\u7684\u6587\u4ef6\uff08<code>file</code>\uff09\uff0c\u7528\u4e8e\u9a8c\u8bc1 HTTPS \u4ee3\u7406\u670d\u52a1\u5668\u7684\u8bc1\u4e66\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_ssl_name","title":"proxy_ssl_name","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_name <code>name</code>; \u9ed8\u8ba4 proxy_ssl_name $proxy_host; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.0 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5141\u8bb8\u8986\u76d6\u7528\u4e8e\u9a8c\u8bc1 HTTPS \u4ee3\u7406\u670d\u52a1\u5668\u8bc1\u4e66\u7684\u670d\u52a1\u5668\u540d\u79f0\uff0c\u5e76\u5728\u4e0e HTTPS \u4ee3\u7406\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u65f6\u901a\u8fc7 SNI \u4f20\u9001\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528 proxy_pass URL \u7684 host \u90e8\u5206\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_ssl_password_file","title":"proxy_ssl_password_file","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_password_file <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.8 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u4e3a\u5bc6\u94a5\u6307\u5b9a\u4e00\u4e2a\u5bc6\u7801\u6587\u4ef6\uff08<code>file</code>\uff09\uff0c\u6bcf\u4e2a\u5bc6\u7801\u5355\u72ec\u5360\u4e00\u884c\u3002\u5728\u52a0\u8f7d\u5bc6\u94a5\u65f6\u4f9d\u6b21\u5c1d\u8bd5\u8fd9\u4e9b\u5bc6\u7801\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_ssl_protocols","title":"proxy_ssl_protocols","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_protocols <code>[SSLv2] [SSLv3] [TLSv1] [TLSv1.1] [TLSv1.2] [TLSv1.3]</code>; \u9ed8\u8ba4 proxy_ssl_protocols TLSv1 TLSv1.1 TLSv1.2; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.6 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u4e3a HTTPS \u4ee3\u7406\u670d\u52a1\u5668\u8bf7\u6c42\u542f\u7528\u6307\u5b9a\u7684\u534f\u8bae\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_ssl_server_name","title":"proxy_ssl_server_name","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_server_name <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_ssl_server_name off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.0 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5728\u4e0e HTTPS \u4ee3\u7406\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u542f\u7528\u6216\u7981\u7528\u901a\u8fc7 TLS \u670d\u52a1\u5668\u540d\u79f0\u6307\u793a\u6269\u5c55\uff08SNI\uff0cRFC 6066\uff09\u4f20\u9012\u670d\u52a1\u5668\u540d\u79f0\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_ssl_session_reuse","title":"proxy_ssl_session_reuse","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_session_reuse <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_ssl_session_reuse on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u786e\u5b9a\u5728\u4f7f\u7528\u4ee3\u7406\u670d\u52a1\u5668\u65f6\u662f\u5426\u53ef\u4ee5\u590d\u7528 SSL \u4f1a\u8bdd\u3002\u5982\u679c\u65e5\u5fd7\u4e2d\u51fa\u73b0\u9519\u8bef <code>SSL3_GET_FINISHED:digest check failed</code>\uff0c\u8bf7\u5c1d\u8bd5\u7981\u7528\u4f1a\u8bdd\u590d\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_ssl_trusted_certificate","title":"proxy_ssl_trusted_certificate","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_trusted_certificate <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.0 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a PEM \u683c\u5f0f\u7684\u53ef\u4fe1 CA \u8bc1\u4e66\u6587\u4ef6\uff0c\u7528\u4e8e\u9a8c\u8bc1 HTTPS \u4ee3\u7406\u670d\u52a1\u5668\u8bc1\u4e66\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_ssl_verify","title":"proxy_ssl_verify","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_verify <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_ssl_verify off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.0 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u6216\u7981\u7528\u9a8c\u8bc1 HTTPS \u4ee3\u7406\u670d\u52a1\u5668\u8bc1\u4e66\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_ssl_verify_depth","title":"proxy_ssl_verify_depth","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_verify_depth <code>number</code>; \u9ed8\u8ba4 proxy_ssl_verify_depth 1; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.0 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u4ee3\u7406\u7684 HTTPS \u670d\u52a1\u5668\u8bc1\u4e66\u94fe\u9a8c\u8bc1\u6df1\u5ea6\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_store","title":"proxy_store","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_store <code>on</code> | <code>off</code> | <code>string</code>; \u9ed8\u8ba4 proxy_store off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5141\u8bb8\u5c06\u6587\u4ef6\u4fdd\u5b58\u5230\u78c1\u76d8\u3002<code>on</code> \u53c2\u6570\u4f7f\u7528\u4e0e alias \u6216 root \u6307\u4ee4\u5bf9\u5e94\u7684\u8def\u5f84\u4fdd\u5b58\u6587\u4ef6\u3002<code>off</code> \u53c2\u6570\u7981\u7528\u6587\u4ef6\u4fdd\u5b58\u3002\u6b64\u5916\uff0c\u53ef\u4ee5\u4f7f\u7528\u5e26\u53d8\u91cf\u7684\u5b57\u7b26\u4e32\u663e\u5f0f\u8bbe\u7f6e\u6587\u4ef6\u540d\uff1a</p> <pre><code>proxy_store /data/www$original_uri;\n</code></pre> <p>\u6839\u636e\u63a5\u6536\u7684 Last-Modified \u54cd\u5e94 header \u5b57\u6bb5\u8bbe\u7f6e\u6587\u4ef6\u7684\u4fee\u6539\u65f6\u95f4\u3002\u9996\u5148\u5c06\u54cd\u5e94\u5199\u5165\u4e34\u65f6\u6587\u4ef6\uff0c\u7136\u540e\u91cd\u547d\u540d\u8be5\u6587\u4ef6\u3002\u4ece 0.8.9 \u7248\u672c\u5f00\u59cb\uff0c\u4e34\u65f6\u6587\u4ef6\u548c\u6301\u4e45\u5316\u5b58\u50a8\u53ef\u4ee5\u653e\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002\u4f46\u662f\uff0c\u8bf7\u6ce8\u610f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6587\u4ef6\u590d\u5236\u9700\u8981\u8de8\u8d8a\u4e24\u4e2a\u6587\u4ef6\u7cfb\u7edf\uff0c\u800c\u4e0d\u662f\u7b80\u5355\u7684\u91cd\u547d\u540d\u64cd\u4f5c\u3002\u56e0\u6b64\uff0c\u5efa\u8bae\u7531 proxy_temp_path \u6307\u4ee4\u8bbe\u7f6e\u7684\u4fdd\u5b58\u6587\u4ef6\u548c\u4fdd\u5b58\u4e34\u65f6\u6587\u4ef6\u7684\u76ee\u5f55\u90fd\u653e\u5728\u540c\u4e00\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002</p> <p>\u8be5\u6307\u4ee4\u53ef\u7528\u4e8e\u521b\u5efa\u9759\u6001\u4e0d\u53ef\u66f4\u6539\u6587\u4ef6\u7684\u672c\u5730\u526f\u672c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>location /images/ {\nroot               /data/www;\nerror_page         404 = /fetch$uri;\n}\n\nlocation /fetch/ {\ninternal;\n\nproxy_pass         http://backend/;\nproxy_store        on;\nproxy_store_access user:rw group:rw all:r;\nproxy_temp_path    /data/temp;\n\nalias              /data/www/;\n}\n</code></pre> <p>\u6216\u8005\uff1a</p> <pre><code>location /images/ {\nroot               /data/www;\nerror_page         404 = @fetch;\n}\n\nlocation @fetch {\ninternal;\n\nproxy_pass         http://backend;\nproxy_store        on;\nproxy_store_access user:rw group:rw all:r;\nproxy_temp_path    /data/temp;\n\nroot               /data/www;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_store_access","title":"proxy_store_access","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_store_access <code>users:permissions ...</code>; \u9ed8\u8ba4 proxy_store_access user:rw; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u4e3a\u65b0\u521b\u5efa\u7684\u6587\u4ef6\u548c\u76ee\u5f55\u8bbe\u7f6e\u8bbf\u95ee\u6743\u9650\uff0c\u4f8b\u5982\uff1a</p> <pre><code>proxy_store_access user:rw group:rw all:r;\n</code></pre> <p>\u5982\u679c\u6307\u5b9a\u4e86\u4efb\u4f55 <code>group</code> \u6216 <code>all</code> \u8bbf\u95ee\u6743\u9650\uff0c\u5219\u53ef\u4ee5\u7701\u7565\u7528\u6237\u6743\u9650\uff1a</p> <pre><code>proxy_store_access group:rw all:r;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_temp_file_write_size","title":"proxy_temp_file_write_size","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_temp_file_write_size <code>size</code>; \u9ed8\u8ba4 proxy_temp_file_write_size 8k|16k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5f53\u542f\u7528\u7f13\u51b2\u4ece\u4ee3\u7406\u670d\u52a1\u5668\u5230\u4e34\u65f6\u6587\u4ef6\u7684\u54cd\u5e94\u65f6\uff0c\u9650\u5236\u4e00\u6b21\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u7684\u6570\u636e\u5927\u5c0f\uff08<code>size</code>\uff09\u3002 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>size</code> \u7531 proxy_buffer_size \u548c proxy_buffers \u6307\u4ee4\u8bbe\u7f6e\u7684\u4e24\u4e2a\u7f13\u51b2\u533a\u9650\u5236\u3002\u4e34\u65f6\u6587\u4ef6\u7684\u6700\u5927\u5927\u5c0f\u7531 proxy_max_temp_file_size \u6307\u4ee4\u8bbe\u7f6e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#proxy_temp_path","title":"proxy_temp_path","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_temp_path <code>path [level1 [level2 [level3]]]</code>; \u9ed8\u8ba4 proxy_temp_path proxy_temp; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u7528\u4e8e\u5b58\u50a8\u4e34\u65f6\u6587\u4ef6\u7684\u76ee\u5f55\uff0c\u5176\u4e2d\u5305\u542b\u4ece\u4ee3\u7406\u670d\u52a1\u5668\u63a5\u6536\u7684\u6570\u636e\u3002\u5728\u6307\u5b9a\u76ee\u5f55\u4e0b\u6700\u591a\u53ef\u6709\u4e09\u7ea7\u5b50\u76ee\u5f55\u3002\u4f8b\u5982\u5728\u4ee5\u4e0b\u914d\u7f6e</p> <pre><code>proxy_temp_path /spool/nginx/proxy_temp 1 2;\n</code></pre> <p>\u4e34\u65f6\u6587\u4ef6\u53ef\u80fd\u5982\u4e0b\uff1a</p> <pre><code>/spool/nginx/proxy_temp/7/45/00000123457\n</code></pre> <p>\u53e6\u8bf7\u53c2\u9605 proxy_cache_path \u6307\u4ee4\u7684 <code>use_temp_path</code> \u53c2\u6570\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#_3","title":"\u5185\u5d4c\u53d8\u91cf","text":"<p><code>ngx_http_proxy_module</code> \u6a21\u5757\u652f\u6301\u5185\u5d4c\u53d8\u91cf\uff0c\u53ef\u4f7f\u7528 proxy_set_header \u6307\u4ee4\u6765\u805a\u5408 header\uff1a</p> <ul> <li> <p><code>$proxy_host</code></p> <p>proxy_pass \u6307\u4ee4\u4e2d\u6307\u5b9a\u7684\u4ee3\u7406\u670d\u52a1\u5668\u7684\u540d\u79f0\u548c\u7aef\u53e3</p> </li> <li> <p><code>$proxy_port</code></p> <p>proxy_pass \u6307\u4ee4\u4e2d\u6307\u5b9a\u7684\u4ee3\u7406\u670d\u52a1\u5668\u7684\u7aef\u53e3\u6216\u534f\u8bae\u7684\u9ed8\u8ba4\u7aef\u53e3</p> </li> <li> <p><code>$proxy_add_x_forwarded_for</code></p> <p>X-Forwarded-For \u5ba2\u6237\u7aef\u8bf7\u6c42\u5934\u5b57\u6bb5\uff0c\u5176\u4e2d\u9644\u52a0\u4e86 <code>$remote_addr</code> \u53d8\u91cf\uff0c\u4ee5\u9017\u53f7\u5206\u5272\u3002\u5982\u679c\u5ba2\u6237\u7aef\u8bf7\u6c42\u5934\u4e2d\u4e0d\u5b58\u5728 X-Forwarded-For\u201d \u5b57\u6bb5\uff0c\u5219 <code>$proxy_add_x_forwarded_for</code> \u53d8\u91cf\u7b49\u4e8e <code>$remote_addr</code> \u53d8\u91cf\u3002</p> </li> </ul> <p>\u5f85\u7eed\u2026\u2026</p>"},{"location":"Modules-reference/http/ngx_http_proxy_module/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_proxy_module.html</p>"},{"location":"Modules-reference/http/ngx_http_random_index_module/","title":"ngx_http_random_index_module","text":"<p><code>ngx_http_random_index_module</code> \u6a21\u5757\u5904\u7406\u4ee5 <code>/</code> \u7ed3\u5c3e\u7684\u8bf7\u6c42\uff0c\u7136\u540e\u968f\u673a\u9009\u62e9\u76ee\u5f55\u4e2d\u7684\u4e00\u4e2a\u6587\u4ef6\u4f5c\u4e3a\u7d22\u5f15\u6587\u4ef6\u5c55\u793a\uff0c\u8be5\u6a21\u5757\u4f18\u5148\u4e8e ngx_http_index_module \u4e4b\u524d\u5904\u7406\u3002</p> <p>\u8be5\u6a21\u5757\u9ed8\u8ba4\u4e0d\u4f1a\u88ab\u6784\u5efa\u5230 nginx \u4e2d\uff0c\u9700\u8981\u5728\u7f16\u8bd1\u65f6\u52a0\u5165 <code>--with-http_random_index_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_random_index_module/#_1","title":"\u914d\u7f6e\u793a\u4f8b","text":"<pre><code>location / {\nrandom_index on;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_random_index_module/#random_index","title":"random_index","text":"- \u8bf4\u660e \u8bed\u6cd5 random_index <code>on</code> | <code>off</code>; \u9ed8\u8ba4 random_index off; \u4e0a\u4e0b\u6587 location <p>\u542f\u7528\u6216\u7981\u7528 <code>location</code> \u5468\u8fb9\u7684\u6a21\u5757\u5904\u7406\u3002</p>"},{"location":"Modules-reference/http/ngx_http_random_index_module/#_2","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/http/ngx_http_random_index_module.html</li> </ul>"},{"location":"Modules-reference/http/ngx_http_realip_module/","title":"ngx_http_realip_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>set_real_ip_from</li> <li>real_ip_header</li> <li>real_ip_recursive</li> </ul> </li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_http_realip_module</code> \u6a21\u5757\u7528\u4e8e\u5c06\u5ba2\u6237\u7aef\u5730\u5740\u548c\u53ef\u9009\u7aef\u53e3\u66f4\u6539\u4e3a\u53d1\u9001\u7684\u6307\u5b9a\u7684\u5934\u5b57\u6bb5\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\uff0c\u53ef\u5728\u6784\u5efa\u65f6\u4f7f\u7528 <code>--with-http_realip_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_realip_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>set_real_ip_from  192.168.1.0/24;\nset_real_ip_from  192.168.2.1;\nset_real_ip_from  2001:0db8::/32;\nreal_ip_header    X-Forwarded-For;\nreal_ip_recursive on;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_realip_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_realip_module/#set_real_ip_from","title":"set_real_ip_from","text":"- \u8bf4\u660e \u8bed\u6cd5 set_real_ip_from <code>address</code> | <code>CIDR</code> | <code>unix:</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u5df2\u77e5\u53ef\u53d1\u9001\u6b63\u786e\u66ff\u6362\u5730\u5740\u7684\u53ef\u4fe1\u5730\u5740\u3002\u5982\u679c\u6307\u5b9a\u4e86\u7279\u6b8a\u503c <code>unix:</code>\uff0c\u5219\u6240\u6709 UNIX \u57df\u5957\u63a5\u5b57\u90fd\u5c06\u53d7\u4fe1\u4efb\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e3b\u673a\u540d\uff081.13.1\uff09\u6307\u5b9a\u53ef\u4fe1\u5730\u5740\u3002</p> <p>\u4ece 1.3.0 \u7248\u672c\u548c 1.2.1 \u7248\u672c\u5f00\u59cb\u652f\u6301 IPv6 \u5730\u5740\u3002</p>"},{"location":"Modules-reference/http/ngx_http_realip_module/#real_ip_header","title":"real_ip_header","text":"- \u8bf4\u660e \u8bed\u6cd5 real_ip_header <code>field</code> | <code>X-Real-IP</code> | <code>X-Forwarded-For</code> | <code>proxy_protocol</code>; \u9ed8\u8ba4 real_ip_header X-Real-IP; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u8bf7\u6c42\u5934\u5b57\u6bb5\uff0c\u5176\u503c\u5c06\u7528\u4e8e\u66ff\u6362\u5ba2\u6237\u7aef\u5730\u5740\u3002</p> <p>\u5305\u542b\u53ef\u9009\u7aef\u53e3\u7684\u8bf7\u6c42\u5934\u5b57\u6bb5\u503c\u4e5f\u7528\u4e8e\u66ff\u6362\u5ba2\u6237\u7aef\u7aef\u53e3\uff081.11.0\uff09\u3002 \u5e94\u6839\u636e RFC 3986 \u6307\u5b9a\u5730\u5740\u548c\u7aef\u53e3\u3002</p> <p><code>proxy_protocol</code> \u53c2\u6570\uff081.5.12\uff09\u5c06\u5ba2\u6237\u7aef\u5730\u5740\u66f4\u6539\u4e3a PROXY \u534f\u8bae\u5934\u4e2d\u7684\u5730\u5740\u3002\u5fc5\u987b\u5148\u901a\u8fc7\u5728 listen \u6307\u4ee4\u4e2d\u8bbe\u7f6e <code>proxy_protocol</code> \u53c2\u6570\u6765\u542f\u7528 PROXY \u534f\u8bae\u3002</p>"},{"location":"Modules-reference/http/ngx_http_realip_module/#real_ip_recursive","title":"real_ip_recursive","text":"- \u8bf4\u660e \u8bed\u6cd5 real_ip_recursive <code>on</code> | <code>off</code>; \u9ed8\u8ba4 real_ip_recursive off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.3.0 \u7248\u672c\u548c 1.2.1 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5982\u679c\u7981\u7528\u9012\u5f52\u641c\u7d22\uff0c\u5219\u5339\u914d\u5176\u4e2d\u4e00\u4e2a\u53ef\u4fe1\u5730\u5740\u7684\u539f\u59cb\u5ba2\u6237\u7aef\u5730\u5740\u66ff\u6362\u4e3a real_ip_header \u6307\u4ee4\u5b9a\u4e49\u7684\u8bf7\u6c42\u5934\u5b57\u6bb5\u4e2d\u53d1\u9001\u7684\u6700\u540e\u4e00\u4e2a\u5730\u5740\u3002\u5982\u679c\u542f\u7528\u4e86\u9012\u5f52\u641c\u7d22\uff0c\u5219\u5339\u914d\u5176\u4e2d\u4e00\u4e2a\u53ef\u4fe1\u5730\u5740\u7684\u539f\u59cb\u5ba2\u6237\u7aef\u5730\u5740\u66ff\u6362\u4e3a\u8bf7\u6c42\u5934\u5b57\u6bb5\u4e2d\u53d1\u9001\u7684\u6700\u540e\u4e00\u4e2a\u975e\u53d7\u4fe1\u4efb\u5730\u5740\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_realip_module/#_3","title":"\u5185\u5d4c\u53d8\u91cf","text":"<ul> <li> <p><code>$realip_remote_addr</code></p> <p>\u539f\u59cb\u5ba2\u6237\u7aef\u5730\u5740</p> </li> <li> <p><code>$realip_remote_port</code></p> <p>\u539f\u59cb\u5ba2\u6237\u7aef\u7aef\u53e3</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_realip_module/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_realip_module.html</p>"},{"location":"Modules-reference/http/ngx_http_referer_module/","title":"ngx_http_referer_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>referer_hash_bucket_size</li> <li>referer_hash_max_size</li> <li>valid_referers</li> </ul> </li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_http_referer_module</code> \u6a21\u5757\u7528\u4e8e\u963b\u6b62 Referer \u5934\u5b57\u6bb5\u4e3a\u65e0\u6548\u503c\u7684\u8bf7\u6c42\u8bbf\u95ee\u7ad9\u70b9\u3002\u9700\u8bb0\u4f4f\u7684\u662f\uff0c\u4f7f\u7528\u9002\u5f53\u7684 Referer \u5b57\u6bb5\u503c\u6765\u4f2a\u9020\u8bf7\u6c42\u975e\u5e38\u5bb9\u6613\uff0c\u56e0\u6b64\u672c\u6a21\u5757\u7684\u9884\u671f\u76ee\u7684\u4e0d\u662f\u8981\u5f7b\u5e95\u963b\u6b62\u6b64\u7c7b\u8bf7\u6c42\uff0c\u800c\u662f\u963b\u6b62\u5e38\u89c4\u6d4f\u89c8\u5668\u53d1\u9001\u7684\u5927\u91cf\u6d41\u91cf\u8bf7\u6c42\u3002\u8fd8\u5e94\u8be5\u8003\u8651\u5230\uff0c\u5373\u4f7f\u662f\u6709\u6548\u8bf7\u6c42\uff0c\u5e38\u89c4\u6d4f\u89c8\u5668\u4e5f\u53ef\u80fd\u4e0d\u53d1\u9001 Referer \u5b57\u6bb5\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_referer_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>valid_referers none blocked server_names\n*.example.com example.* www.example.org/galleries/\n~\\.google\\.;\n\nif ($invalid_referer) {\nreturn 403;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_referer_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_referer_module/#referer_hash_bucket_size","title":"referer_hash_bucket_size","text":"- \u8bf4\u660e \u8bed\u6cd5 referer_hash_bucket_size <code>size</code>; \u9ed8\u8ba4 referer_hash_bucket_size 64; \u4e0a\u4e0b\u6587 server\u3001location <p>\u8bbe\u7f6e\u6709\u6548\u5f15\u7528\u54c8\u5e0c\u8868\u7684\u6876\u5927\u5c0f\u3002\u8bbe\u7f6e\u54c8\u5e0c\u8868\u7684\u8be6\u7ec6\u4fe1\u606f\u5728\u5355\u72ec\u7684\u6587\u6863\u4e2d\u63d0\u4f9b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_referer_module/#referer_hash_max_size","title":"referer_hash_max_size","text":"- \u8bf4\u660e \u8bed\u6cd5 referer_hash_max_size <code>size</code>; \u9ed8\u8ba4 referer_hash_max_size 2048; \u4e0a\u4e0b\u6587 server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.0.5 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u6709\u6548\u5f15\u7528\u54c8\u5e0c\u8868\u7684\u6700\u5927 <code>size</code>\u3002\u8bbe\u7f6e\u54c8\u5e0c\u8868\u7684\u8be6\u7ec6\u4fe1\u606f\u5728\u5355\u72ec\u7684\u6587\u6863\u4e2d\u63d0\u4f9b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_referer_module/#valid_referers","title":"valid_referers","text":"- \u8bf4\u660e \u8bed\u6cd5 valid_referers <code>none</code> | <code>blocked</code> | <code>server_names</code> | <code>string ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 server\u3001location <p>\u6307\u5b9a Referer \u8bf7\u6c42\u5934\u5b57\u6bb5\u503c\u5c06\u5bfc\u81f4\u5185\u5d4c\u7684 <code>$invalid_referer</code> \u53d8\u91cf\u8bbe\u7f6e\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002\u5426\u5219\uff0c\u53d8\u91cf\u5c06\u4e3a <code>1</code>\u3002\u5339\u914d\u641c\u7d22\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u3002</p> <p>\u53c2\u6570\u8bf4\u660e\u5982\u4e0b\uff1a</p> <ul> <li> <p><code>none</code></p> <p>\u8bf7\u6c42\u5934\u4e2d\u7f3a\u5c11 Referer \u5b57\u6bb5</p> </li> <li> <p><code>blocked</code></p> <p>Referer \u5b57\u6bb5\u51fa\u73b0\u5728\u8bf7\u6c42\u5934\u4e2d\uff0c\u4f46\u5176\u503c\u5df2\u88ab\u9632\u706b\u5899\u6216\u4ee3\u7406\u670d\u52a1\u5668\u5220\u9664\uff0c\u8fd9\u4e9b\u503c\u4e3a\u4e0d\u4ee5 <code>http://</code> \u6216 <code>https://</code> \u5f00\u5934\u7684\u5b57\u7b26\u4e32</p> </li> <li> <p><code>server_names</code></p> <p>Referer \u8bf7\u6c42\u5934\u5b57\u6bb5\u5305\u542b\u4e00\u4e2a\u670d\u52a1\u5668\u540d\u79f0</p> </li> <li> <p>\u4efb\u610f\u5b57\u7b26\u4e32</p> <p>\u5b9a\u4e49\u4e00\u4e2a\u670d\u52a1\u5668\u540d\u79f0\u548c\u4e00\u4e2a\u53ef\u9009\u7684 URI \u524d\u7f00\u3002\u670d\u52a1\u5668\u540d\u79f0\u7684\u5f00\u5934\u6216\u7ed3\u5c3e\u53ef\u4ee5\u5305\u542b<code>*</code>\u3002\u5728\u68c0\u67e5\u671f\u95f4\uff0cReferer \u5b57\u6bb5\u4e2d\u7684\u670d\u52a1\u5668\u7aef\u53e3\u88ab\u5ffd\u7565</p> </li> <li> <p>\u6b63\u5219\u8868\u8fbe\u5f0f</p> <p>\u7b2c\u4e00\u4e2a\u7b26\u53f7\u5e94\u4e3a <code>\u301c</code>\u3002\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8868\u8fbe\u5f0f\u53ea\u4e0e <code>http://</code> \u6216 <code>https://</code> \u4e4b\u540e\u7684\u6587\u672c\u5339\u914d\u3002</p> </li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>valid_referers none blocked server_names\n*.example.com example.* www.example.org/galleries/\n~\\.google\\.;\n</code></pre> <p></p>"},{"location":"Modules-reference/http/ngx_http_referer_module/#_3","title":"\u5185\u5d4c\u53d8\u91cf","text":"<ul> <li> <p><code>$invalid_referer</code></p> <p>\u5982\u679c Referer \u8bf7\u6c42\u5934\u5b57\u6bb5\u7684\u503c\u6709\u6548\uff0c\u5219\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u5426\u5219\u4e3a 1\u3002</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_referer_module/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_referer_module.html</p>"},{"location":"Modules-reference/http/ngx_http_rewrite_module/","title":"ngx_http_rewrite_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>break</li> <li>if</li> <li>return</li> <li>rewrite</li> <li>rewrite_log</li> <li>set</li> <li>uninitialized_variable_warn</li> </ul> </li> <li>\u5185\u90e8\u5b9e\u73b0</li> </ul> <p><code>ngx_http_rewrite_module</code> \u6a21\u5757\u4f7f\u7528 PCRE \u6b63\u5219\u8868\u8fbe\u5f0f\u66f4\u6539\u8bf7\u6c42 URI\u3001\u8fd4\u56de\u91cd\u5b9a\u5411\u548c\u6709\u6761\u4ef6\u5730\u9009\u62e9\u914d\u7f6e\u3002</p> <p>break\u3001if\u3001return\u3001rewrite \u548c set \u6307\u4ee4\u5c06\u6309\u4ee5\u4e0b\u987a\u5e8f\u5904\u7406\uff1a</p> <ul> <li>\u5728 server \u7ea7\u522b\u4e0b\uff0c\u8be5\u6a21\u5757\u7684\u6307\u4ee4\u6309\u987a\u5e8f\u6267\u884c</li> <li>\u91cd\u590d\u6267\u884c\uff1a<ul> <li>\u57fa\u4e8e\u8bf7\u6c42 URI \u641c\u7d22 location</li> <li>\u5728 location \u5185\u627e\u7684\u8be5\u6a21\u5757\u7684\u6307\u4ee4\u6309\u987a\u5e8f\u6267\u884c</li> <li>\u5982\u679c\u8bf7\u6c42 URI \u88ab\u91cd\u5199\uff0c\u5219\u91cd\u590d\u5faa\u73af\uff0c\u4f46\u4e0d\u8d85\u8fc7 10 \u6b21\u3002</li> </ul> </li> </ul> <p></p>"},{"location":"Modules-reference/http/ngx_http_rewrite_module/#_1","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_rewrite_module/#break","title":"break","text":"- \u8bf4\u660e \u8bed\u6cd5 break; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 server\u3001location\u3001if <p>\u505c\u6b62\u5904\u7406\u5f53\u524d\u7684 <code>ngx_http_rewrite_module</code> \u6307\u4ee4\u96c6\u3002</p> <p>\u5982\u679c\u5728\u8be5 location \u5185\u6307\u5b9a\u4e86\u6307\u4ee4\uff0c\u5219\u8bf7\u6c42\u7684\u4e0b\u4e00\u6b65\u5904\u7406\u5728\u8be5\u4f4d\u7f6e\u5c06\u7ee7\u7eed\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>if ($slow) {\nlimit_rate 10k;\nbreak;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_rewrite_module/#if","title":"if","text":"- \u8bf4\u660e \u8bed\u6cd5 if <code>(condition) { ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 server\u3001location <p>\u6307\u5b9a\u7684 <code>condition</code> \u6c42\u503c\u4e4b\u540e\uff0c\u5982\u679c\u4e3a <code>true</code>\uff0c\u5219\u6267\u884c\u5728\u5927\u62ec\u53f7\u5185\u6307\u5b9a\u7684\u8be5\u6a21\u5757\u7684\u6307\u4ee4\uff0c\u5e76\u5728 <code>if</code> \u6307\u4ee4\u5185\u4e3a\u8be5\u8bf7\u6c42\u5206\u914d\u914d\u7f6e\u3002<code>if</code> \u6307\u4ee4\u5185\u7684\u914d\u7f6e\u7ee7\u627f\u81ea\u4e0a\u4e00\u5c42\u7684\u914d\u7f6e\u7ea7\u522b\u3002</p> <p><code>condition</code> \u53ef\u4ee5\u662f\u4ee5\u4e0b\u4efb\u4f55\u4e00\u79cd\uff1a</p> <ul> <li> <p>\u53d8\u91cf\u540d\uff0c\u5982\u679c\u53d8\u91cf\u7684\u503c\u4e3a\u7a7a\u5b57\u7b26\u4e32\u6216 <code>0</code>\uff0c\u5219\u4e3a <code>false</code></p> <p>\u5728 1.0.1\u7248\u672c \u4e4b\u524d\uff0c\u4efb\u4f55\u4ee5 <code>0</code> \u5f00\u5934\u7684\u5b57\u7b26\u4e32\u90fd\u88ab\u89c6\u4e3a\u9519\u8bef\u503c\u3002</p> </li> <li> <p>\u4f7f\u7528 <code>=</code> \u548c <code>!=</code> \u8fd0\u7b97\u7b26\u6bd4\u8f83\u53d8\u91cf\u548c\u5b57\u7b26\u4e32</p> </li> <li> <p>\u4f7f\u7528 <code>~</code>\uff08\u533a\u5206\u5927\u5c0f\u5199\u7684\u5339\u914d\uff09\u548c <code>~*</code>\uff08\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\u5339\u914d\uff09\u8fd0\u7b97\u7b26\uff0c\u53d8\u91cf\u5c06\u4e0e\u6b63\u5219\u8868\u8fbe\u5f0f\u8fdb\u884c\u5339\u914d\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u53ef\u4ee5\u5305\u542b\u53ef\u4f9b\u4ee5\u540e\u5728 <code>$1..$9</code> \u53d8\u91cf\u4e2d\u91cd\u7528\u7684\u6355\u83b7\u3002\u53cd\u64cd\u4f5c\u7b26 <code>!~</code> \u548c <code>!~*</code> \u4e5f\u53ef\u7528\u3002\u5982\u679c\u6b63\u5219\u8868\u8fbe\u5f0f\u5305\u542b <code>}</code> \u6216 <code>;</code> \u5b57\u7b26\uff0c\u5219\u6574\u4e2a\u8868\u8fbe\u5f0f\u5e94\u4f7f\u7528\u5355\u5f15\u53f7\u6216\u53cc\u5f15\u53f7\u5305\u56f4\u8d77\u6765\u3002</p> </li> <li> <p>\u4f7f\u7528 <code>-f</code> \u548c <code>!-f</code> \u8fd0\u7b97\u7b26\u68c0\u67e5\u6587\u4ef6\u662f\u5426\u5b58\u5728</p> </li> <li> <p>\u4f7f\u7528 <code>-d</code> \u548c <code>!-d</code> \u8fd0\u7b97\u7b26\u68c0\u67e5\u76ee\u5f55\u662f\u5426\u5b58\u5728</p> </li> <li> <p>\u4f7f\u7528 <code>-e</code> \u548c <code>!-e</code> \u8fd0\u7b97\u7b26\u68c0\u67e5\u6587\u4ef6\u3001\u76ee\u5f55\u6216\u7b26\u53f7\u94fe\u63a5\u662f\u5426\u5b58\u5728</p> </li> <li> <p>\u4f7f\u7528 <code>-x</code> \u548c <code>!-x</code> \u8fd0\u7b97\u7b26\u68c0\u67e5\u662f\u5426\u4e3a\u53ef\u6267\u884c\u6587\u4ef6</p> </li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>if ($http_user_agent ~ MSIE) {\nrewrite ^(.*)$ /msie/$1 break;\n}\n\nif ($http_cookie ~* \"id=([^;]+)(?:;|$)\") {\nset $id $1;\n}\n\nif ($request_method = POST) {\nreturn 405;\n}\n\nif ($slow) {\nlimit_rate 10k;\n}\n\nif ($invalid_referer) {\nreturn 403;\n}\n</code></pre> <p><code>$invalid_referer</code> \u5185\u5d4c\u53d8\u91cf\u7684\u503c\u7531 valid_referers \u6307\u4ee4\u8bbe\u7f6e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_rewrite_module/#return","title":"return","text":"- \u8bf4\u660e \u8bed\u6cd5 return <code>code [text]</code>;return <code>code URL</code>;return <code>URL</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 server\u3001location\u3001if <p>\u505c\u6b62\u5904\u7406\u5e76\u5c06\u6307\u5b9a\u7684 <code>code</code> \u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u975e\u6807\u51c6\u4ee3\u7801 444 \u5728\u4e0d\u53d1\u9001\u54cd\u5e94\u5934\u7684\u60c5\u51b5\u4e0b\u5173\u95ed\u8fde\u63a5\u3002</p> <p>\u4ece 0.8.42 \u7248\u672c\u5f00\u59cb\uff0c\u53ef\u4ee5\u6307\u5b9a\u91cd\u5b9a\u5411 URL\uff08\u5bf9 301\u3001302\u3001303\u3001307 \u548c 308 \u4ee3\u7801\u6709\u6548\uff09\u6216\u54cd\u5e94\u6b63\u6587 <code>text</code>\uff08\u5bf9\u5176\u4ed6\u4ee3\u7801\u6709\u6548\uff09\u3002\u54cd\u5e94\u6b63\u6587\u548c\u91cd\u5b9a\u5411 URL \u90fd\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002\u7279\u6b8a\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u5c06\u91cd\u5b9a\u5411 URL \u6307\u5b9a\u4e3a\u6b64\u670d\u52a1\u5668\u7684\u672c\u5730 URI\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6839\u636e\u8bf7\u6c42\u6a21\u5f0f\uff08<code>$scheme</code>\uff09\u4ee5\u53ca server_name_in_redirect \u548c port_in_redirect \u6307\u4ee4\u5f62\u6210\u5b8c\u6574\u91cd\u5b9a\u5411 URL\u3002</p> <p>\u53e6\u5916\uff0c\u53ef\u4ee5\u5c06\u4ee3\u7801\u4e3a 302 \u7684\u4e34\u65f6\u91cd\u5b9a\u5411\u7684 <code>URL</code> \u6307\u5b9a\u4e3a\u552f\u4e00\u53c2\u6570\u3002\u8fd9\u6837\u7684\u53c2\u6570\u5e94\u8be5\u4ee5 <code>http://</code>\u3001<code>https://</code> \u6216 <code>$scheme</code> \u5b57\u7b26\u4e32\u5f00\u5934\u3002<code>URL</code> \u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002</p> <p>\u5728 0.7.51 \u7248\u672c\u4e4b\u524d\u53ea\u80fd\u8fd4\u56de\u4ee5\u4e0b\u4ee3\u7801\uff1a204\u3001400\u3001402-406\u3001408\u3001410\u3001411\u3001413\u3001416 \u548c 500-504\u3002</p> <p>\u5728 1.1.16 \u7248\u672c\u548c 1.0.13 \u7248\u672c\u4e4b\u524d\uff0c\u4ee3\u7801 307 \u4e0d\u88ab\u89c6\u4e3a\u91cd\u5b9a\u5411\u3002</p> <p>\u5728 1.13.0 \u7248\u672c\u4e4b\u524d\uff0c\u4ee3\u7801 308 \u4e0d\u88ab\u89c6\u4e3a\u91cd\u5b9a\u5411\u3002</p> <p>\u53e6\u8bf7\u53c2\u89c1 error_page \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_rewrite_module/#rewrite","title":"rewrite","text":"- \u8bf4\u660e \u8bed\u6cd5 rewrite <code>regex replacement [flag]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 server\u3001location\u3001if <p>\u5982\u679c\u6307\u5b9a\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u4e0e\u8bf7\u6c42 URI \u5339\u914d\uff0c\u5219 URI \u5c06\u6839\u636e <code>replacement</code> \u4e2d\u7684\u6307\u5b9a\u8fdb\u884c\u66f4\u6539\u3002<code>rewrite</code> \u6307\u4ee4\u6309\u7167\u5b83\u4eec\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u51fa\u73b0\u987a\u5e8f\u4f9d\u6b21\u6267\u884c\u3002\u53ef\u4ee5\u4f7f\u7528\u6807\u5fd7\u6765\u7ec8\u6b62\u6307\u4ee4\u7684\u4e0b\u4e00\u6b65\u5904\u7406\u3002\u5982\u679c\u66ff\u6362\u4ee5 <code>http://</code>\u3001<code>https://</code> \u6216 <code>$scheme</code> \u5f00\u5934\u7684\u5b57\u7b26\u4e32\uff0c\u5219\u5904\u7406\u6d41\u7a0b\u5c06\u505c\u6b62\u5e76\u5c06\u91cd\u5b9a\u5411\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</p> <p>\u53ef\u9009\u7684 <code>flag</code> \u53c2\u6570\u53ef\u4ee5\u662f\u4ee5\u4e0b\u4e4b\u4e00\uff1a</p> <ul> <li> <p><code>last</code></p> <p>\u505c\u6b62\u5904\u7406\u5f53\u524d\u7684 <code>ngx_http_rewrite_module</code> \u6307\u4ee4\u96c6\u5e76\u5f00\u59cb\u641c\u7d22\u65b0\u7684 location \u6765\u5339\u914d\u53d8\u66f4\u7684 URI</p> </li> <li> <p><code>break</code></p> <p>\u4e0e break \u6307\u4ee4\u4e00\u6837\uff0c\u505c\u6b62\u5904\u7406\u5f53\u524d\u7684 <code>ngx_http_rewrite_module</code> \u6307\u4ee4\u96c6;</p> </li> <li> <p><code>redirect</code></p> <p>\u8fd4\u56de\u5e26\u6709 302 \u4ee3\u7801\u7684\u4e34\u65f6\u91cd\u5b9a\u5411\uff0c\u5982\u679c\u66ff\u6362\u5b57\u7b26\u4e32\u4e0d\u4ee5 <code>http://</code>\u3001<code>https://</code> \u6216 <code>$scheme</code> \u5f00\u5934\uff0c\u5219\u751f\u6548</p> </li> <li> <p><code>permanent</code></p> <p>\u8fd4\u56de 301 \u4ee3\u7801\u7684\u6c38\u4e45\u91cd\u5b9a\u5411</p> </li> </ul> <p>\u5b8c\u6574\u91cd\u5b9a\u5411 URL \u6839\u636e\u8bf7\u6c42\u6a21\u5f0f\uff08<code>$scheme</code>\uff09\u4ee5\u53ca server_name_in_redirect \u548c port_in_redirect \u6307\u4ee4\u5f62\u6210\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>server {\n...\nrewrite ^(/download/.*)/media/(.*)\\..*$ $1/mp3/$2.mp3 last;\nrewrite ^(/download/.*)/audio/(.*)\\..*$ $1/mp3/$2.ra  last;\nreturn  403;\n...\n}\n</code></pre> <p>\u4f46\u662f\u5982\u679c\u8fd9\u4e9b\u6307\u4ee4\u653e\u5728 <code>/download/</code> \u4f4d\u7f6e\uff0c<code>last</code> \u6807\u5fd7\u5e94\u8be5\u7528 <code>break</code> \u66ff\u6362\uff0c\u5426\u5219 nginx \u4f1a\u4ea7\u751f 10 \u4e2a\u5faa\u73af\u5e76\u8fd4\u56de 500 \u9519\u8bef\uff1a</p> <pre><code>location /download/ {\nrewrite ^(/download/.*)/media/(.*)\\..*$ $1/mp3/$2.mp3 break;\nrewrite ^(/download/.*)/audio/(.*)\\..*$ $1/mp3/$2.ra  break;\nreturn  403;\n}\n</code></pre> <p>\u5982\u679c <code>replacement</code> \u5305\u542b\u65b0\u8bf7\u6c42\u53c2\u6570\uff0c\u5219\u5148\u524d\u7684\u8bf7\u6c42\u53c2\u6570\u5c06\u6700\u52a0\u5728\u5b83\u4eec\u4e4b\u540e\u3002\u5982\u679c\u4e0d\u5e0c\u671b\u8fd9\u6837\uff0c\u53ef\u5728 <code>replacement</code> \u7684\u672b\u5c3e\u52a0\u4e0a\u4e00\u4e2a\u95ee\u53f7\u53ef\u4ee5\u907f\u514d\u8ffd\u52a0\uff0c\u4f8b\u5982\uff1a</p> <pre><code>rewrite ^/users/(.*)$ /show?user=$1? last;\n</code></pre> <p>\u5982\u679c\u6b63\u5219\u8868\u8fbe\u5f0f\u5305\u542b <code>}</code> \u6216 <code>;</code> \u5b57\u7b26\uff0c\u5219\u6574\u4e2a\u8868\u8fbe\u5f0f\u5e94\u4f7f\u7528\u5355\u5f15\u53f7\u6216\u53cc\u5f15\u53f7\u5305\u56f4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_rewrite_module/#rewrite_log","title":"rewrite_log","text":"- \u8bf4\u660e \u8bed\u6cd5 rewrite_log <code>on</code> | <code>oof</code>; \u9ed8\u8ba4 rewrite_log off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001if <p>\u542f\u7528\u6216\u7981\u7528\u5728 <code>notice</code> \u7ea7\u522b\u5c06 <code>ngx_http_rewrite_module</code> \u6a21\u5757\u6307\u4ee4\u5904\u7406\u7ed3\u679c\u8bb0\u5f55\u5230 error_log \u4e2d\u3002</p>"},{"location":"Modules-reference/http/ngx_http_rewrite_module/#set","title":"set","text":"- \u8bf4\u660e \u8bed\u6cd5 set <code>$variable value</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 server\u3001location\u3001if <p>\u4e3a\u6307\u5b9a\u7684 <code>variable</code> \u8bbe\u7f6e\u4e00\u4e2a <code>value</code>\uff0c<code>value</code> \u53ef\u4ee5\u5305\u542b\u6587\u672c\u3001\u53d8\u91cf\u53ca\u5176\u7ec4\u5408\u3002</p>"},{"location":"Modules-reference/http/ngx_http_rewrite_module/#uninitialized_variable_warn","title":"uninitialized_variable_warn","text":"- \u8bf4\u660e \u8bed\u6cd5 uninitialized_variable_warn <code>on</code> | <code>oof</code>; \u9ed8\u8ba4 uninitialized_variable_warn on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001if <p>\u63a7\u5236\u662f\u5426\u8bb0\u5f55\u6709\u5173\u672a\u521d\u59cb\u5316\u53d8\u91cf\u7684\u8b66\u544a\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_rewrite_module/#_2","title":"\u5185\u90e8\u5b9e\u73b0","text":"<p><code>ngx_http_rewrite_module</code> \u6a21\u5757\u6307\u4ee4\u5728\u914d\u7f6e\u9636\u6bb5\u7f16\u8bd1\u4e3a\u5185\u90e8\u6307\u4ee4\uff0c\u5176\u5728\u8bf7\u6c42\u5904\u7406\u671f\u95f4\u88ab\u89e3\u91ca\u6267\u884c\u3002\u89e3\u91ca\u5668\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u865a\u62df\u6808\u673a\u5668\u3002</p> <p>\u4f8b\u5982\u4ee5\u4e0b\u6307\u4ee4\uff08directive\uff09\uff1a</p> <p><pre><code>location /download/ {\nif ($forbidden) {\nreturn 403;\n}\n\nif ($slow) {\nlimit_rate 10k;\n}\n\nrewrite ^/(download/.*)/media/(.*)\\..*$ /$1/mp3/$2.mp3 break;\n}\n</code></pre> \u5c06\u4f1a\u7ffb\u8bd1\u6210\u4ee5\u4e0b\u6307\u4ee4\uff08instruction\uff09\uff1a</p> <pre><code>variable $forbidden\ncheck against zero\n    return 403\n    end of code\nvariable $slow\ncheck against zero\nmatch of regular expression\ncopy \"/\"\ncopy $1\ncopy \"/mp3/\"\ncopy $2\ncopy \".mp3\"\nend of regular expression\nend of code\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u4e0a\u9762\u7684 limit_rate \u6307\u4ee4\u6ca1\u6709\u76f8\u5173\u6307\u4ee4\uff08instruction)\uff0c\u56e0\u4e3a\u5b83\u4e0e <code>ngx_http_rewrite_module</code> \u6a21\u5757\u65e0\u5173\u3002\u8fd9\u4e9b\u5355\u72ec\u914d\u7f6e\u662f\u4e3a if \u5757\u521b\u5efa\u7684\u3002\u5982\u679c\u6761\u4ef6\u6210\u7acb\uff0c\u5219\u4e3a\u6b64\u914d\u7f6e\u5206\u914d\u4e00\u4e2a\u8bf7\u6c42\uff0c\u5176\u4e2d <code>limit_rate</code> \u7b49\u4e8e 10k\u3002</p> <p>\u6307\u4ee4\uff1a</p> <pre><code>rewrite ^/(download/.*)/media/(.*)\\..*$ /$1/mp3/$2.mp3 break;\n</code></pre> <p>\u5982\u679c\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u7684\u7b2c\u4e00\u4e2a\u659c\u6760\u653e\u5728\u62ec\u53f7\u5185\uff0c\u53ef\u4ee5\u8ba9\u751f\u6210\u7684\u6307\u4ee4\uff08instruction\uff09\u53d8\u5f97\u66f4\u8f7b\uff1a</p> <pre><code>rewrite ^(/download/.*)/media/(.*)\\..*$ $1/mp3/$2.mp3 break;\n</code></pre> <p>\u751f\u6210\u7684\u6307\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>match of regular expression\ncopy $1\ncopy \"/mp3/\"\ncopy $2\ncopy \".mp3\"\nend of regular expression\nend of code\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_rewrite_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_rewrite_module.html</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/","title":"ngx_http_scgi_module","text":"<ul> <li>\u914d\u7f6e\u793a\u4f8b</li> <li>\u6307\u4ee4<ul> <li>scgi_bind</li> <li>scgi_buffer_size</li> <li>scgi_buffering</li> <li>scgi_buffers</li> <li>scgi_busy_buffers_size</li> <li>scgi_cache</li> <li>scgi_cache_background_update</li> <li>scgi_cache_bypass</li> <li>scgi_cache_key</li> <li>scgi_cache_lock</li> <li>scgi_cache_lock_age</li> <li>scgi_cache_lock_timeout</li> <li>scgi_cache_max_range_offset</li> <li>scgi_cache_methods</li> <li>scgi_cache_min_uses</li> <li>scgi_cache_path</li> <li>scgi_cache_purge</li> <li>scgi_cache_revalidate</li> <li>scgi_cache_use_stale</li> <li>scgi_cache_valid</li> <li>scgi_connect_timeout</li> <li>scgi_force_ranges</li> <li>scgi_hide_header</li> <li>scgi_ignore_client_abort</li> <li>scgi_ignore_headers</li> <li>scgi_intercept_errors</li> <li>scgi_limit_rate</li> <li>scgi_max_temp_file_size</li> <li>scgi_next_upstream</li> <li>scgi_next_upstream_timeout</li> <li>scgi_next_upstream_tries</li> <li>scgi_no_cache</li> <li>scgi_param</li> <li>scgi_pass</li> <li>scgi_pass_header</li> <li>scgi_pass_request_body</li> <li>scgi_pass_request_headers</li> <li>scgi_read_timeout</li> <li>scgi_request_buffering</li> <li>scgi_send_timeout</li> <li>scgi_socket_keepalive</li> <li>scgi_store</li> <li>scgi_store_access</li> <li>scgi_temp_file_write_size</li> <li>scgi_temp_path</li> </ul> </li> </ul> <p><code>ngx_http_scgi_module</code> \u6a21\u5757\u5141\u8bb8\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9 SCGI \u670d\u52a1\u5668\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#_1","title":"\u914d\u7f6e\u793a\u4f8b","text":"<pre><code>location / {\ninclude   scgi_params;\nscgi_pass localhost:9000;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_bind","title":"scgi_bind","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_bind <code>address [transparent] | off</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u4f7f\u7528\u53ef\u9009\u7aef\u53e3\uff081.11.2\uff09\u4ece\u6307\u5b9a\u7684\u672c\u5730 IP \u5730\u5740\u53d1\u51fa\u5230 SCGI \u670d\u52a1\u5668\u7684\u4f20\u51fa\u8fde\u63a5\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.3.12\uff09\u3002\u7279\u6b8a\u503c <code>off</code>\uff081.3.12\uff09\u53d6\u6d88\u4ece\u5148\u524d\u914d\u7f6e\u7ea7\u522b\u7ee7\u627f\u7684 <code>scgi_bind</code> \u6307\u4ee4\u7684\u4f5c\u7528\uff0c\u8be5\u6307\u4ee4\u5141\u8bb8\u7cfb\u7edf\u81ea\u52a8\u5206\u914d\u672c\u5730 IP \u5730\u5740\u548c\u7aef\u53e3\u3002</p> <p><code>transparent</code> \u53c2\u6570\uff081.11.0\uff09\u5141\u8bb8\u5230 SCGI \u670d\u52a1\u5668\u7684\u4f20\u51fa\u8fde\u63a5\u6e90\u81ea\u975e\u672c\u5730 IP \u5730\u5740\uff0c\u4f8b\u5982\uff0c\u6765\u81ea\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684\u771f\u5b9e IP \u5730\u5740\uff1a</p> <pre><code>scgi_bind $remote_addr transparent;\n</code></pre> <p>\u4e3a\u4e86\u4f7f\u6b64\u53c2\u6570\u8d77\u4f5c\u7528\uff0c\u901a\u5e38\u9700\u8981\u4f7f\u7528\u8d85\u7ea7\u7528\u6237\u6743\u9650\u8fd0\u884c nginx worker \u8fdb\u7a0b\u3002\u5728 Linux \u4e0a\uff0c\u4e0d\u9700\u8981\uff081.13.8\uff09\u50cf\u6307\u5b9a <code>transparent</code> \u53c2\u6570\u4e00\u6837\uff0cworker \u8fdb\u7a0b\u4ece master \u8fdb\u7a0b\u7ee7\u627f <code>CAP_NET_RAW</code> \u529f\u80fd\u3002\u8fd8\u9700\u8981\u914d\u7f6e\u5185\u6838\u8def\u7531\u8868\u4ee5\u62e6\u622a\u6765\u81ea SCGI \u670d\u52a1\u5668\u7684\u7f51\u7edc\u6d41\u91cf\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_buffer_size","title":"scgi_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_buffer_size <code>size</code>; \u9ed8\u8ba4 scgi_buffer_size 4k|8k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7528\u4e8e\u8bfb\u53d6\u4ece SCGI \u670d\u52a1\u5668\u63a5\u6536\u7684\u54cd\u5e94\u7684\u7b2c\u4e00\u90e8\u5206\u7684\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u8fd9\u90e8\u5206\u901a\u5e38\u5305\u542b\u4e00\u4e2a\u5c0f\u7684\u54cd\u5e94\u5934\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u51b2\u533a\u5927\u5c0f\u7b49\u4e8e\u4e00\u4e2a\u5185\u5b58\u9875\uff0c\u5373 4K \u6216 8K\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u5e73\u53f0\u3002\u7136\u800c\uff0c\u5b83\u53ef\u4ee5\u505a\u5f97\u66f4\u5c0f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_buffering","title":"scgi_buffering","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_buffering <code>on</code> | <code>off</code>; \u9ed8\u8ba4 scgi_buffering on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u6216\u7981\u7528\u7f13\u51b2\u6765\u81ea SCGI \u670d\u52a1\u5668\u7684\u54cd\u5e94\u3002</p> <p>\u542f\u7528\u7f13\u51b2\u540e\uff0cnginx \u4f1a\u5c3d\u5feb\u4ece SCGI \u670d\u52a1\u5668\u63a5\u6536\u54cd\u5e94\uff0c\u5e76\u5c06\u5176\u4fdd\u5b58\u5230 scgi_buffer_size \u548c scgi_buffers \u6307\u4ee4\u8bbe\u7f6e\u7684\u7f13\u51b2\u533a\u4e2d\u3002\u5982\u679c\u6574\u4e2a\u54cd\u5e94\u4e0d\u9002\u5408\u653e\u5165\u5185\u5b58\uff0c\u5219\u53ef\u4ee5\u5c06\u5176\u4e2d\u7684\u4e00\u90e8\u5206\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u7684\u4e34\u65f6\u6587\u4ef6\u4e2d\u3002\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u7531 scgi_max_temp_file_size \u548c scgi_temp_file_write_size \u6307\u4ee4\u63a7\u5236\u3002</p> <p>\u7981\u7528\u7f13\u51b2\u65f6\uff0c\u4f1a\u5728\u6536\u5230\u54cd\u5e94\u65f6\u7acb\u5373\u540c\u6b65\u4f20\u9012\u7ed9\u5ba2\u6237\u7aef\u3002nginx \u4e0d\u4f1a\u5c1d\u8bd5\u4ece SCGI \u670d\u52a1\u5668\u8bfb\u53d6\u6574\u4e2a\u54cd\u5e94\u3002nginx \u4e00\u6b21\u53ef\u4ee5\u4ece\u670d\u52a1\u5668\u63a5\u6536\u7684\u6570\u636e\u7684\u6700\u5927\u5927\u5c0f\u7531 scgi_buffer_size \u6307\u4ee4\u8bbe\u7f6e\u3002</p> <p>\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5728 X-Accel-Buffering \u54cd\u5e94\u5934\u5b57\u6bb5\u4e2d\u4f20\u9012 <code>yes</code> \u6216 <code>no</code> \u6765\u542f\u7528\u6216\u7981\u7528\u7f13\u51b2\u3002\u53ef\u4ee5\u4f7f\u7528 scgi_ignore_headers \u6307\u4ee4\u7981\u7528\u6b64\u529f\u80fd\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_buffers","title":"scgi_buffers","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_buffers <code>number size</code>; \u9ed8\u8ba4 scgi_buffers 8 4k|8k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7528\u4e8e\u4ece SCGI \u670d\u52a1\u5668\u8bfb\u53d6\u54cd\u5e94\u7684\u7f13\u51b2\u533a\u7684\u6570\u91cf\uff08<code>number</code>\uff09\u548c\u5927\u5c0f\uff08<code>size</code>\uff09\uff0c\u9002\u7528\u4e8e\u5355\u4e2a\u8fde\u63a5\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u51b2\u533a\u5927\u5c0f\u7b49\u4e8e\u4e00\u4e2a\u5185\u5b58\u9875\uff0c\u5373 4K \u6216 8K\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u5e73\u53f0\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_busy_buffers_size","title":"scgi_busy_buffers_size","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_busy_buffers_size <code>size</code>; \u9ed8\u8ba4 scgi_busy_buffers_size 8k|16k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5f53\u542f\u7528\u7f13\u51b2\u6765\u81ea SCGI \u670d\u52a1\u5668\u7684\u54cd\u5e94\u65f6\uff0c\u9650\u5236\u5728\u54cd\u5e94\u5c1a\u672a\u5b8c\u5168\u8bfb\u53d6\u65f6\u53ef\u80fd\u5fd9\u4e8e\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u54cd\u5e94\u7684\u7f13\u51b2\u533a\u7684\u603b\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u540c\u65f6\uff0c\u5176\u4f59\u7f13\u51b2\u533a\u53ef\u7528\u4e8e\u8bfb\u53d6\u54cd\u5e94\uff0c\u5982\u679c\u9700\u8981\uff0c\u8fd8\u53ef\u4ee5\u7f13\u51b2\u90e8\u5206\u54cd\u5e94\u4e34\u65f6\u6587\u4ef6\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>size</code> \u7531 scgi_buffer_size \u548c scgi_buffers \u6307\u4ee4\u8bbe\u7f6e\u7684\u4e24\u4e2a\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_cache","title":"scgi_cache","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_cache <code>zone</code> | <code>off</code>; \u9ed8\u8ba4 scgi_cache off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e00\u4e2a\u7528\u4e8e\u7f13\u5b58\u7684\u5171\u4eab\u5185\u5b58\u533a\u57df\u3002\u53ef\u4ee5\u5728\u591a\u4e2a\u5730\u65b9\u4f7f\u7528\u76f8\u540c\u7684\u533a\u57df\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.7.9\uff09\u3002<code>off</code> \u53c2\u6570\u7981\u7528\u4ece\u5148\u524d\u914d\u7f6e\u7ea7\u522b\u7ee7\u627f\u7684\u7f13\u5b58\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_cache_background_update","title":"scgi_cache_background_update","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_cache_background_update <code>on</code> | <code>off</code>; \u9ed8\u8ba4 scgi_cache_background_update off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.10 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5141\u8bb8\u542f\u52a8\u4e00\u4e2a\u540e\u53f0\u5b50\u8bf7\u6c42\u4ee5\u66f4\u65b0\u8fc7\u671f\u7684\u7f13\u5b58\u9879\uff0c\u540c\u65f6\u5c06\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u8bf7\u6ce8\u610f\uff0c\u5728\u66f4\u65b0\u65f6\u5fc5\u987b\u5141\u8bb8\u4f7f\u7528\u9648\u65e7\u7684\u7f13\u5b58\u54cd\u5e94\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_cache_bypass","title":"scgi_cache_bypass","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_cache_bypass <code>string ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e0d\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u54cd\u5e94\u7684\u6761\u4ef6\u3002\u5982\u679c\u5b57\u7b26\u4e32\u53c2\u6570\u4e2d\u6709\u4e00\u4e2a\u503c\u4e0d\u4e3a\u7a7a\u4e14\u4e0d\u7b49\u4e8e <code>0</code>\uff0c\u5219\u4e0d\u4f1a\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u54cd\u5e94\uff1a</p> <pre><code>scgi_cache_bypass $cookie_nocache $arg_nocache$arg_comment;\nscgi_cache_bypass $http_pragma    $http_authorization;\n</code></pre> <p>\u53ef\u4ee5\u4e0e scgi_no_cache \u6307\u4ee4\u4e00\u8d77\u4f7f\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_cache_key","title":"scgi_cache_key","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_cache_key <code>string</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e00\u4e2a\u7528\u4e8e\u7f13\u5b58\u7684 key\uff1a</p> <pre><code>scgi_cache_key localhost:9000$request_uri;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_cache_lock","title":"scgi_cache_lock","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_cache_lock <code>on</code> | <code>off</code>; \u9ed8\u8ba4 scgi_cache_lock off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.12 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u540e\uff0c\u5728\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9 SCGI \u670d\u52a1\u5668\uff0c\u4e00\u6b21\u53ea\u5141\u8bb8\u4e00\u4e2a\u8bf7\u6c42\u586b\u5145\u6839\u636e scgi_cache_key \u6307\u4ee4\u6807\u8bc6\u7684\u65b0\u7f13\u5b58\u5143\u7d20\u3002\u540c\u4e00\u7f13\u5b58\u5143\u7d20\u7684\u5176\u4ed6\u8bf7\u6c42\u5c06\u7b49\u5f85\u54cd\u5e94\u51fa\u73b0\u5728\u7f13\u5b58\u4e2d\u6216\u76f4\u5230 scgi_cache_lock_timeout \u6307\u4ee4\u8bbe\u7f6e\u7684\u65f6\u95f4\uff0c\u7f13\u5b58\u6b64\u5143\u7d20\u7684\u7f13\u5b58\u9501\u91ca\u653e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_cache_lock_age","title":"scgi_cache_lock_age","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_cache_lock_age <code>time</code>; \u9ed8\u8ba4 scgi_cache_lock_age 5s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.8 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5982\u679c\u4f20\u9012\u7ed9 SCGI \u670d\u52a1\u5668\u4ee5\u586b\u5145\u65b0\u7f13\u5b58\u5143\u7d20\u7684\u6700\u540e\u4e00\u4e2a\u8bf7\u6c42\u5728\u6307\u5b9a\u65f6\u95f4\uff08<code>time</code>\uff09\u5185\u6ca1\u6709\u5b8c\u6210\uff0c\u5219\u53ef\u4ee5\u5c06\u53e6\u4e00\u4e2a\u8bf7\u6c42\u4f20\u9012\u7ed9 SCGI \u670d\u52a1\u5668\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_cache_lock_timeout","title":"scgi_cache_lock_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_cache_lock_timeout <code>time</code>; \u9ed8\u8ba4 scgi_cache_lock_timeout 5s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.12 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e scgi_cache_lock \u7684\u8d85\u65f6\u65f6\u95f4\u3002\u5f53\u65f6\u95f4\u5230\u671f\u65f6\uff0c\u8bf7\u6c42\u5c06\u88ab\u4f20\u9012\u7ed9 SCGI \u670d\u52a1\u5668\uff0c\u4f46\u54cd\u5e94\u5c06\u4e0d\u4f1a\u88ab\u7f13\u5b58\u3002</p> <p>1.7.8 \u7248\u672c\u4e4b\u524d\u54cd\u5e94\u53ef\u4ee5\u88ab\u7f13\u5b58\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_cache_max_range_offset","title":"scgi_cache_max_range_offset","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_cache_max_range_offset <code>number</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.6 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u4e00\u4e2a\u5b57\u8282\u8303\u56f4\uff08byte-range\uff09\u8bf7\u6c42\u7684\u504f\u79fb\u91cf\uff08\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff09\u3002\u5982\u679c\u8303\u56f4\u8d85\u51fa\u504f\u79fb\u91cf\uff0c\u5219\u8303\u56f4\u8bf7\u6c42\u5c06\u4f20\u9012\u7ed9 SCGI \u670d\u52a1\u5668\uff0c\u5e76\u4e14\u4e0d\u4f1a\u7f13\u5b58\u54cd\u5e94\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_cache_methods","title":"scgi_cache_methods","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_cache_methods <code>GET \\| HEAD \\| POST ...</code>; \u9ed8\u8ba4 scgi_cache_methods GET HEAD; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5982\u679c\u6b64\u6307\u4ee4\u4e2d\u5217\u51fa\u4e86\u5ba2\u6237\u7aef\u8bf7\u6c42\u65b9\u6cd5\uff0c\u5219\u5c06\u7f13\u5b58\u54cd\u5e94\u3002<code>GET</code> \u548c <code>HEAD</code> \u65b9\u6cd5\u603b\u662f\u6dfb\u52a0\u5230\u5217\u8868\u4e2d\uff0c\u4f46\u5efa\u8bae\u660e\u786e\u6307\u5b9a\u5b83\u4eec\u3002\u53e6\u8bf7\u53c2\u89c1 scgi_no_cache \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_cache_min_uses","title":"scgi_cache_min_uses","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_cache_min_uses <code>number</code>; \u9ed8\u8ba4 scgi_cache_min_uses 1; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7f13\u5b58\u54cd\u5e94\u4e4b\u524d\u7684\u8bf7\u6c42\u6570\uff08<code>number</code>\uff09\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_cache_path","title":"scgi_cache_path","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_cache_path <code>path [levels=levels] [use_temp_path=on\\|off] keys_zone=name:size [inactive=time] [max_size=size] [manager_files=number] [manager_sleep=time] [manager_threshold=time] [loader_files=number] [loader_sleep=time] [loader_threshold=time] [purger=on\\|off] [purger_files=number] [purger_sleep=time] [purger_threshold=time]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u8bbe\u7f6e\u7f13\u5b58\u7684\u8def\u5f84\u548c\u5176\u4ed6\u53c2\u6570\u3002\u7f13\u5b58\u6570\u636e\u5b58\u50a8\u5728\u6587\u4ef6\u4e2d\u3002\u7f13\u5b58\u7684\u6587\u4ef6\u540d\u662f\u7531 cache_key \u7ecf\u8fc7 MD5 \u51fd\u6570\u5904\u7406\u751f\u6210\u3002<code>levels</code> \u53c2\u6570\u5b9a\u4e49\u7f13\u5b58\u7684\u5c42\u6b21\u7ea7\u522b\uff1a\u4ece 1 \u5230 3\uff0c\u6bcf\u4e2a\u7ea7\u522b\u63a5\u53d7\u503c\u4e3a 1 \u6216 2\u3002\u4f8b\u5982\uff0c\u5728\u4ee5\u4e0b\u914d\u7f6e\u4e2d</p> <pre><code>scgi_cache_path /data/nginx/cache levels=1:2 keys_zone=one:10m;\n</code></pre> <p>\u7f13\u5b58\u7684\u6587\u4ef6\u540d\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>/data/nginx/cache/c/29/b7f54b2df7773722d382f4809d65029c\n</code></pre> <p>\u9996\u5148\u5c06\u88ab\u7f13\u5b58\u7684\u54cd\u5e94\u5199\u5165\u4e34\u65f6\u6587\u4ef6\uff0c\u7136\u540e\u91cd\u547d\u540d\u8be5\u6587\u4ef6\u3002\u4ece 0.8.9 \u7248\u672c\u5f00\u59cb\uff0c\u4e34\u65f6\u6587\u4ef6\u548c\u7f13\u5b58\u53ef\u4ee5\u653e\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002\u4f46\u662f\uff0c\u8bf7\u6ce8\u610f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6587\u4ef6\u5c06\u8de8\u4e24\u4e2a\u6587\u4ef6\u7cfb\u7edf\u8fdb\u884c\u590d\u5236\uff0c\u800c\u4e0d\u662f\u7b80\u5355\u7684\u91cd\u547d\u540d\u64cd\u4f5c\u3002\u56e0\u6b64\uff0c\u5efa\u8bae\u5bf9\u4e8e\u4efb\u4f55\u6307\u5b9a\u4f4d\u7f6e\uff0c\u7f13\u5b58\u548c\u4fdd\u5b58\u4e34\u65f6\u6587\u4ef6\u7684\u76ee\u5f55\u90fd\u653e\u5728\u540c\u4e00\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002\u4e34\u65f6\u6587\u4ef6\u76ee\u5f55\u6839\u636e <code>use_temp_path</code> \u53c2\u6570\uff081.7.10\uff09\u800c\u8bbe\u7f6e\u3002\u5982\u679c\u7701\u7565\u6b64\u53c2\u6570\u6216\u5c06\u5176\u8bbe\u7f6e\u4e3a <code>on</code>\uff0c\u5219\u5c06\u4f7f\u7528 scgi_temp_path \u6307\u4ee4\u4e3a\u6307\u5b9a\u4f4d\u7f6e\u8bbe\u7f6e\u7684\u76ee\u5f55\u3002\u5982\u679c\u8be5\u503c\u8bbe\u7f6e\u4e3a <code>off</code>\uff0c\u5219\u4e34\u65f6\u6587\u4ef6\u5c06\u76f4\u63a5\u653e\u5165\u7f13\u5b58\u76ee\u5f55\u4e2d\u3002</p> <p>\u6b64\u5916\uff0c\u6240\u6709\u6d3b\u8dc3\u7684 key \u548c\u6709\u5173\u6570\u636e\u7684\u4fe1\u606f\u90fd\u5b58\u50a8\u5728\u5171\u4eab\u5185\u5b58\u533a\u57df\u4e2d\uff0c\u5176\u540d\u79f0\u548c\u5927\u5c0f\u7531 <code>keys_zone</code> \u53c2\u6570\u914d\u7f6e\u3002\u4e00\u5146\u5b57\u8282\u533a\u57df\u53ef\u4ee5\u5b58\u50a8\u5927\u7ea6 8000 \u4e2a key\u3002</p> <p>\u4f5c\u4e3a\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\uff0c\u5171\u4eab\u5b58\u50a8\u5668\u533a\u57df\u8fd8\u5b58\u50a8\u6269\u5c55\u7684\u7f13\u5b58\u4fe1\u606f\uff0c\u56e0\u6b64\uff0c\u9700\u8981\u4e3a\u76f8\u540c\u6570\u91cf\u7684 key \u6307\u5b9a\u66f4\u5927\u7684\u533a\u57df\u5927\u5c0f\u3002\u4f8b\u5982\uff0c\u4e00\u5146\u5b57\u8282\u533a\u57df\u53ef\u4ee5\u5b58\u50a8\u5927\u7ea6 4000 \u4e2a key\u3002</p> <p>\u5728 <code>inactive</code> \u53c2\u6570\u6307\u5b9a\u7684\u65f6\u95f4\u5185\u672a\u8bbf\u95ee\u7684\u7f13\u5b58\u6570\u636e\u5c06\u4ece\u7f13\u5b58\u4e2d\u5220\u9664\uff0c\u4e0d\u7ba1\u5176\u65b0\u65e7\u7a0b\u5ea6\u5982\u4f55\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>inactive</code> \u8bbe\u7f6e\u4e3a 10 \u5206\u949f\u3002</p> <p>\u7279\u6b8a\u7684**\u7f13\u5b58\u7ba1\u7406\u5668**\u8fdb\u7a0b\u76d1\u89c6 <code>max_size</code> \u53c2\u6570\u8bbe\u7f6e\u7684\u6700\u5927\u7f13\u5b58\u5927\u5c0f\u3002\u8d85\u8fc7\u6b64\u5927\u5c0f\u65f6\uff0c\u5b83\u4f1a\u5220\u9664\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u3002\u5728 <code>manager_files</code>\u3001<code>manager_threshold</code> \u548c <code>manager_sleep</code> \u53c2\u6570\uff081.11.5\uff09\u914d\u7f6e\u7684\u8fed\u4ee3\u4e2d\u5220\u9664\u6570\u636e\u3002\u5728\u4e00\u6b21\u8fed\u4ee3\u671f\u95f4\uff0c\u4e0d\u4f1a\u5220\u9664\u8d85\u8fc7 <code>manager_files</code> \u9879\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a 100\uff09\u3002\u4e00\u6b21\u8fed\u4ee3\u7684\u6301\u7eed\u65f6\u95f4\u53d7 <code>manager_threshold</code> \u53c2\u6570\u9650\u5236\uff08\u9ed8\u8ba4\u4e3a 200 \u6beb\u79d2\uff09\u3002\u5728\u8fed\u4ee3\u4e4b\u95f4\uff0c\u95f4\u9694\u65f6\u95f4\u7531 <code>manager_sleep</code> \u53c2\u6570\uff08\u9ed8\u8ba4\u4e3a 50 \u6beb\u79d2\uff09\u63a7\u5236\u3002</p> <p>\u542f\u52a8\u4e00\u5206\u949f\u540e\uff0c\u6fc0\u6d3b\u7279\u6b8a\u7684**\u7f13\u5b58\u52a0\u8f7d\u7a0b\u5e8f**\uff08cache loader\uff09\u8fdb\u7a0b\u3002\u5b83\u5c06\u6709\u5173\u5b58\u50a8\u5728\u6587\u4ef6\u7cfb\u7edf\u4e0a\u7684\u5148\u524d\u7f13\u5b58\u6570\u636e\u7684\u4fe1\u606f\u52a0\u8f7d\u5230\u7f13\u5b58\u533a\u3002\u52a0\u8f7d\u4e5f\u662f\u5728\u8fed\u4ee3\u4e2d\u5b8c\u6210\u7684\u3002\u5728\u4e00\u6b21\u8fed\u4ee3\u671f\u95f4\uff0c\u4e0d\u4f1a\u52a0\u8f7d\u8d85\u8fc7 <code>loader_files</code> \u9879\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a 100\uff09\u3002\u6b64\u5916\uff0c\u4e00\u6b21\u8fed\u4ee3\u7684\u6301\u7eed\u65f6\u95f4\u53d7 <code>loader_threshold</code> \u53c2\u6570\u9650\u5236\uff08\u9ed8\u8ba4\u4e3a 200 \u6beb\u79d2\uff09\u3002\u5728\u8fed\u4ee3\u4e4b\u95f4\uff0c\u7531 <code>loader_sleep</code> \u53c2\u6570\uff08\u9ed8\u8ba4\u4e3a 50 \u6beb\u79d2\uff09\u63a7\u5236\u95f4\u9694\u65f6\u95f4\u3002</p> <p>\u6b64\u5916\uff0c\u4ee5\u4e0b\u53c2\u6570\u4f5c\u4e3a\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\u63d0\u4f9b\uff1a</p> <ul> <li> <p><code>purger=on|off</code></p> <p>\u6307\u793a\u7f13\u5b58\u6e05\u9664\u7a0b\u5e8f\u662f\u5426\u4ece\u78c1\u76d8\u5220\u9664\u4e0e\u901a\u914d key \u5339\u914d\u7684\u7f13\u5b58\u9879\uff081.7.12\uff09\u3002\u5c06\u53c2\u6570\u8bbe\u7f6e\u4e3a <code>on</code>\uff08\u9ed8\u8ba4\u4e3a <code>off</code>\uff09\u5c06\u6fc0\u6d3b\u6e05\u9664\u7a0b\u5e8f\u8fdb\u7a0b\uff0c\u8be5\u8fdb\u7a0b\u5c06\u6c38\u4e45\u8fed\u4ee3\u6240\u6709\u7f13\u5b58\u6761\u76ee\u5e76\u5220\u9664\u4e0e\u901a\u914d key \u5339\u914d\u7684\u6761\u76ee\u3002</p> </li> <li> <p><code>purger_files=number</code></p> <p>\u8bbe\u7f6e\u4e00\u6b21\u8fed\u4ee3\u4e2d\u5c06\u626b\u63cf\u7684\u6761\u76ee\u6570\u91cf\uff081.7.12\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>purger_files</code> \u8bbe\u7f6e\u4e3a 10\u3002</p> </li> <li> <p><code>purger_threshold=number</code></p> <p>\u8bbe\u7f6e\u4e00\u6b21\u8fed\u4ee3\u7684\u6301\u7eed\u65f6\u95f4\uff081.7.12\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>purger_threshold</code> \u8bbe\u7f6e\u4e3a 50 \u6beb\u79d2\u3002</p> </li> <li> <p><code>purger_sleep=number</code></p> <p>\u8bbe\u7f6e\u8fed\u4ee3\u95f4\u7684\u95f4\u9694\u65f6\u95f4\uff081.7.12\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>purger_sleep</code> \u8bbe\u7f6e\u4e3a 50 \u6beb\u79d2\u3002</p> </li> </ul> <p>\u5728 1.7.3\u30011.7.7 \u548c 1.11.10 \u7248\u672c\u4e2d\uff0c\u7f13\u5b58\u5934\u683c\u5f0f\u5df2\u66f4\u6539\u3002\u5347\u7ea7\u5230\u8f83\u65b0\u7684 nginx \u7248\u672c\u540e\uff0c\u4ee5\u524d\u7f13\u5b58\u7684\u54cd\u5e94\u5c06\u88ab\u89c6\u4e3a\u65e0\u6548\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_cache_purge","title":"scgi_cache_purge","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_cache_purge <code>string ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5b9a\u4e49\u5c06\u8bf7\u6c42\u89c6\u4e3a\u7f13\u5b58\u6e05\u9664\u8bf7\u6c42\u7684\u6761\u4ef6\u3002\u5982\u679c\u5b57\u7b26\u4e32\u53c2\u6570\u5305\u542b\u4e00\u4e2a\u503c\u4e0d\u4e3a\u7a7a\u4e14\u4e0d\u7b49\u4e8e <code>0</code>\uff0c\u5219\u79fb\u9664\u6709\u76f8\u5e94\u7f13\u5b58 key \u7684\u7f13\u5b58\u9879\u3002\u901a\u8fc7\u8fd4\u56de 204\uff08\u65e0\u5185\u5bb9\uff09\u54cd\u5e94\u6765\u6307\u793a\u6210\u529f\u64cd\u4f5c\u7ed3\u679c\u3002</p> <p>\u5982\u679c\u6e05\u9664\u8bf7\u6c42\u7684\u7f13\u5b58 key \u4ee5\u661f\u53f7\uff08<code>*</code>\uff09\u7ed3\u5c3e\uff0c\u5219\u5c06\u4ece\u7f13\u5b58\u4e2d\u5220\u9664\u4e0e\u901a\u914d key \u5339\u914d\u7684\u6240\u6709\u7f13\u5b58\u9879\u3002\u4f46\u662f\uff0c\u8fd9\u4e9b\u9879\u5c06\u4fdd\u7559\u5728\u78c1\u76d8\u4e0a\uff0c\u76f4\u5230\u5b83\u4eec\u89c6\u4e3a\u975e\u6d3b\u52a8\u72b6\u6001\u800c\u88ab\u5220\u9664\uff0c\u6216\u7531\u7f13\u5b58\u6e05\u9664\u7a0b\u5e8f\uff081.7.12\uff09\u5904\u7406\uff0c\u6216\u8005\u5ba2\u6237\u7aef\u5c1d\u8bd5\u8bbf\u95ee\u5b83\u4eec\u3002</p> <p>\u914d\u7f6e\u793a\u4f8b\uff1a</p> <pre><code>scgi_cache_path /data/nginx/cache keys_zone=cache_zone:10m;\n\nmap $request_method $purge_method {\nPURGE   1;\ndefault 0;\n}\n\nserver {\n...\nlocation / {\nscgi_pass        backend;\nscgi_cache       cache_zone;\nscgi_cache_key   $uri;\nscgi_cache_purge $purge_method;\n}\n}\n</code></pre> <p>\u6b64\u529f\u80fd\u662f\u6211\u4eec\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_cache_revalidate","title":"scgi_cache_revalidate","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_cache_revalidate <code>on</code> | <code>off</code>; \u9ed8\u8ba4 scgi_cache_revalidate off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5bf9\u5e26\u6709 If-Modified-Since \u548c If-None-Match \u5934\u5b57\u6bb5\u7684\u6761\u4ef6\u8bf7\u6c42\u542f\u7528\u8fc7\u671f\u7f13\u5b58\u9879\u91cd\u65b0\u9a8c\u8bc1\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_cache_use_stale","title":"scgi_cache_use_stale","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_cache_use_stale <code>error \\| timeout \\| invalid_header \\| updating \\| http_500 \\| http_503 \\| http_403 \\| http_404 \\| http_429 \\| off ...</code>; \u9ed8\u8ba4 scgi_cache_use_stale off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u786e\u5b9a\u5728\u4e0e SCGI \u670d\u52a1\u5668\u901a\u4fe1\u671f\u95f4\u53d1\u751f\u9519\u8bef\u65f6\u53ef\u4ee5\u4f7f\u7528\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\u7684\u60c5\u51b5\u3002\u8be5\u6307\u4ee4\u7684\u53c2\u6570\u4e0e scgi_next_upstream \u6307\u4ee4\u7684\u53c2\u6570\u5339\u914d\u3002</p> <p><code>error</code> \u53c2\u6570\u5728\u65e0\u6cd5\u9009\u62e9\u5904\u7406\u8bf7\u6c42\u7684 SCGI \u670d\u52a1\u5668\u7684\u60c5\u51b5\u4e0b\u8fd8\u5141\u8bb8\u4f7f\u7528\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\u3002</p> <p>\u6b64\u5916\uff0c\u5982\u679c\u5f53\u524d\u6b63\u5728\u66f4\u65b0\uff0c\u5219 <code>updating</code> \u53c2\u6570\u5141\u8bb8\u4f7f\u7528\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\u3002\u8fd9\u5141\u8bb8\u5728\u66f4\u65b0\u7f13\u5b58\u6570\u636e\u65f6\u5c3d\u91cf\u51cf\u5c11 SCGI \u670d\u52a1\u5668\u7684\u8bbf\u95ee\u6b21\u6570\u3002</p> <p>\u5728\u54cd\u5e94\u53d8\u4e3a\u5931\u6548\u540e\uff0c\u4e5f\u53ef\u4ee5\u5728\u54cd\u5e94\u5934\u4e2d\u76f4\u63a5\u542f\u7528\u4f7f\u7528\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\u6307\u5b9a\u7684\u79d2\u6570\uff081.11.10\uff09\u3002\u8fd9\u6bd4\u4f7f\u7528\u6307\u4ee4\u53c2\u6570\u7684\u4f18\u5148\u7ea7\u4f4e\u3002</p> <ul> <li>Cache-Control \u5934\u5b57\u6bb5\u7684 **stale-while-revalidate**\u6269\u5c55\u5141\u8bb8\u4f7f\u7528\u9648\u65e7\u7684\u7f13\u5b58\u54cd\u5e94\uff08\u5982\u679c\u5f53\u524d\u6b63\u5728\u66f4\u65b0\uff09\u3002</li> <li>Cache-Control \u5934\u5b57\u6bb5\u7684 **stale-if-error**\u6269\u5c55\u5141\u8bb8\u5728\u51fa\u73b0\u9519\u8bef\u65f6\u4f7f\u7528\u9648\u65e7\u7684\u7f13\u5b58\u54cd\u5e94\u3002</li> </ul> <p>\u8981\u5728\u586b\u5145\u65b0\u7f13\u5b58\u5143\u7d20\u65f6\u6700\u5927\u5316\u51cf\u5c11 SCGI \u670d\u52a1\u5668\u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u53ef\u4ee5\u4f7f\u7528 scgi_cache_lock \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_cache_valid","title":"scgi_cache_valid","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_cache_valid <code>[code ...] time</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u4e0d\u540c\u54cd\u5e94\u7801\u7684\u7f13\u5b58\u65f6\u95f4\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u6307\u4ee4</p> <pre><code>scgi_cache_valid 200 302 10m;\nscgi_cache_valid 404      1m;\n</code></pre> <p>\u4e3a\u54cd\u5e94\u7801\u4e3a 200 \u548c 302 \u7684\u54cd\u5e94\u8bbe\u7f6e 10 \u5206\u949f\u7684\u7f13\u5b58\uff0c\u4e3a\u4ee3\u7801 404 \u7684\u54cd\u5e94\u8bbe\u7f6e 1 \u5206\u949f\u3002</p> <p>\u5982\u679c\u4ec5\u6307\u5b9a\u4e86\u7f13\u5b58\u65f6\u95f4</p> <pre><code>scgi_cache_valid 5m;\n</code></pre> <p>\u7136\u540e\u53ea\u7f13\u5b58 200\u3001301 \u548c 302 \u54cd\u5e94\u3002</p> <p>\u6b64\u5916\uff0c\u53ef\u4ee5\u6307\u5b9a <code>any</code> \u53c2\u6570\u6765\u7f13\u5b58\u4efb\u4f55\u54cd\u5e94\uff1a</p> <pre><code>scgi_cache_valid 200 302 10m;\nscgi_cache_valid 301      1h;\nscgi_cache_valid any      1m;\n</code></pre> <p>\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728\u54cd\u5e94\u5934\u4e2d\u8bbe\u7f6e\u7f13\u5b58\u7684\u53c2\u6570\u3002\u8fd9\u6bd4\u4f7f\u7528\u8be5\u6307\u4ee4\u8bbe\u7f6e\u7f13\u5b58\u65f6\u95f4\u7684\u4f18\u5148\u7ea7\u66f4\u9ad8\u3002</p> <ul> <li>X-Accel-Expires \u5934\u5b57\u6bb5\u662f\u4ee5\u79d2\u4e3a\u5355\u4f4d\u8bbe\u7f6e\u54cd\u5e94\u7684\u7f13\u5b58\u65f6\u95f4\u3002\u96f6\u503c\u7981\u7528\u54cd\u5e94\u7684\u7f13\u5b58\u3002\u5982\u679c\u503c\u4ee5 <code>@</code> \u524d\u7f00\u5f00\u5934\uff0c\u5219\u8bbe\u7f6e\u81ea Epoch \u4ee5\u6765\u7684\u7edd\u5bf9\u65f6\u95f4\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09\uff0c\u54cd\u5e94\u53ef\u4ee5\u7f13\u5b58\u3002</li> <li>\u5982\u679c\u5934\u4e0d\u5305\u62ec X-Accel-Expires \u5b57\u6bb5\uff0c\u5219\u53ef\u4ee5\u5728\u5934\u5b57\u6bb5 Expires \u6216 Cache-Control \u4e2d\u8bbe\u7f6e\u7f13\u5b58\u7684\u53c2\u6570\u3002</li> <li>\u5982\u679c\u5934\u5305\u542b Set-Cookie \u5b57\u6bb5\uff0c\u5219\u4e0d\u4f1a\u7f13\u5b58\u6b64\u7c7b\u54cd\u5e94\u3002</li> <li>\u5982\u679c\u5934\u5305\u542b\u6709\u7279\u6b8a\u503c <code>*</code> \u7684 Vary \u5b57\u6bb5\uff0c\u5219\u4e0d\u4f1a\u7f13\u5b58\u6b64\u7c7b\u54cd\u5e94\uff081.7.7\uff09\u3002\u5982\u679c\u5934\u5305\u542b\u5177\u6709\u53e6\u4e00\u4e2a\u503c\u7684 **Vary**\u5b57\u6bb5\uff0c\u5219\u5c06\u8003\u8651\u76f8\u5e94\u7684\u8bf7\u6c42\u5934\u5b57\u6bb5\u6765\u7f13\u5b58\u8fd9\u6837\u7684\u54cd\u5e94\uff081.7.7\uff09\u3002</li> </ul> <p>\u53ef\u4ee5\u4f7f\u7528 scgi_ignore_headers \u6307\u4ee4\u7981\u7528\u8fd9\u4e9b\u54cd\u5e94\u5934\u5b57\u6bb5\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u7684\u5904\u7406\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_connect_timeout","title":"scgi_connect_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_connect_timeout <code>time</code>; \u9ed8\u8ba4 scgi_connect_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e0e SCGI \u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u9700\u8981\u6ce8\u610f\u6b64\u8d85\u65f6\u901a\u5e38\u4e0d\u4f1a\u8d85\u8fc7 75 \u79d2\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_force_ranges","title":"scgi_force_ranges","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_force_ranges <code>on</code> | <code>off</code>; \u9ed8\u8ba4 scgi_force_ranges off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u65e0\u8bba\u8fd9\u4e9b\u54cd\u5e94\u4e2d\u7684 Accept-Ranges \u5b57\u6bb5\u5982\u4f55\uff0c\u90fd\u4e3a SCGI \u670d\u52a1\u5668\u7684\u7f13\u5b58\u548c\u672a\u7f13\u5b58\u54cd\u5e94\u542f\u7528\u5b57\u8282\u8303\u56f4\u652f\u6301\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_hide_header","title":"scgi_hide_header","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_hide_header <code>field</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnginx \u4e0d\u4f1a\u5c06 SCGI \u52a1\u5668\u7684\u54cd\u5e94\u4e2d\u7684\u5934\u5b57\u6bb5 Status \u548c X-Accel-... \u4f20\u9012\u7ed9\u5ba2\u6237\u7aef\u3002scgi_hide_header \u6307\u4ee4\u8bbe\u7f6e\u4e86\u4e0d\u4f1a\u4f20\u9012\u7684\u5176\u4ed6\u5b57\u6bb5\u3002\u76f8\u53cd\uff0c\u5982\u679c\u9700\u8981\u5141\u8bb8\u4f20\u9012\u5b57\u6bb5\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 scgi_pass_header \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_ignore_client_abort","title":"scgi_ignore_client_abort","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_ignore_client_abort <code>on</code> | <code>off</code>; \u9ed8\u8ba4 scgi_ignore_client_abort off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u786e\u5b9a\u5ba2\u6237\u7aef\u5728\u4e0d\u7b49\u5f85\u54cd\u5e94\u7684\u60c5\u51b5\u4e0b\u5173\u95ed\u8fde\u63a5\u65f6\u662f\u5426\u5e94\u5173\u95ed\u4e0e SCGI \u670d\u52a1\u5668\u7684\u8fde\u63a5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_ignore_headers","title":"scgi_ignore_headers","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_ignore_headers <code>field ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u7981\u7528\u4ece SCGI \u670d\u52a1\u5668\u5904\u7406\u67d0\u4e9b\u54cd\u5e94\u5934\u5b57\u6bb5\u3002\u53ef\u4ee5\u5ffd\u7565\u4ee5\u4e0b\u5b57\u6bb5\uff1aX-Accel-Redirect\u3001X-Accel-Expires\u3001X-Accel-Limit-Rate\uff081.1.6\uff09\u3001X-Accel-Buffering\uff081.1.6\uff09\u3001X-Accel-Charset\uff081.1.6\uff09\u3001Expires\u3001Cache-Control\u3001Set-Cookie\uff080.8.44\uff09\u548c Vary\uff081.7.7\uff09\u3002</p> <p>\u5982\u679c\u672a\u7981\u7528\uff0c\u5219\u5904\u7406\u8fd9\u4e9b\u5934\u5b57\u6bb5\u4f1a\u5f71\u54cd\u4ee5\u4e0b\uff1a</p> <ul> <li>X-Accel-Expires\u3001Expires\u3001Cache-Control\u3001Set-Cookie \u548c Vary \u8bbe\u7f6e\u54cd\u5e94\u7f13\u5b58\u7684\u53c2\u6570</li> <li>X-Accel-Redirect \u6267\u884c\u5185\u90e8\u91cd\u5b9a\u5411\u5230\u6307\u5b9a\u7684 URI</li> <li>X-Accel-Limit-Rate \u8bbe\u7f6e\u5411\u5ba2\u6237\u7aef\u4f20\u8f93\u54cd\u5e94\u7684\u901f\u7387\u9650\u5236</li> <li>X-Accel-Buffering \u542f\u7528\u6216\u7981\u7528\u7f13\u51b2\u54cd\u5e94</li> <li>X-Accel-Charset \u8bbe\u7f6e\u4e86\u6240\u9700\u7684\u54cd\u5e94\u5b57\u7b26\u96c6</li> </ul>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_intercept_errors","title":"scgi_intercept_errors","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_intercept_errors <code>on</code> | <code>off</code>; \u9ed8\u8ba4 scgi_intercept_errors off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u786e\u5b9a\u54cd\u5e94\u7801\u5927\u4e8e\u6216\u7b49\u4e8e 300 \u7684 SCGI \u670d\u52a1\u5668\u54cd\u5e94\u662f\u5e94\u8be5\u4f20\u9012\u7ed9\u5ba2\u6237\u7aef\u8fd8\u662f\u88ab\u62e6\u622a\u5e76\u91cd\u5b9a\u5411\u5230 nginx \u4ee5\u4fbf\u4f7f\u7528 error_page \u6307\u4ee4\u8fdb\u884c\u5904\u7406\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_limit_rate","title":"scgi_limit_rate","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_limit_rate <code>rate</code>; \u9ed8\u8ba4 scgi_limit_rate 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236\u4ece SCGI \u670d\u52a1\u5668\u8bfb\u53d6\u54cd\u5e94\u7684\u901f\u5ea6\u3002<code>rate</code> \u4ee5\u6bcf\u79d2\u5b57\u8282\u6570\u6307\u5b9a\u3002\u96f6\u503c\u7981\u7528\u901f\u7387\u9650\u5236\u3002\u6839\u636e\u8bf7\u6c42\u8bbe\u7f6e\u9650\u5236\uff0c\u56e0\u6b64\u5982\u679c nginx \u540c\u65f6\u6253\u5f00\u4e24\u4e2a\u5230 SCGI \u670d\u52a1\u5668\u7684\u8fde\u63a5\uff0c\u5219\u603b\u901f\u7387\u5c06\u662f\u6307\u5b9a\u9650\u5236\u7684\u4e24\u500d\u3002\u4ec5\u5f53\u542f\u7528\u4e86\u6765\u81ea SCGI \u670d\u52a1\u5668\u7684\u54cd\u5e94\u7f13\u51b2\u65f6\uff0c\u8be5\u9650\u5236\u624d\u6709\u6548\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_max_temp_file_size","title":"scgi_max_temp_file_size","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_max_temp_file_size <code>size</code>; \u9ed8\u8ba4 scgi_max_temp_file_size 1024m; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5f53\u542f\u7528\u6765\u81ea SCGI \u670d\u52a1\u5668\u7684\u54cd\u5e94\u7f13\u51b2\uff0c\u5e76\u4e14\u6574\u4e2a\u54cd\u5e94\u4e0d\u9002\u5408 scgi_buffer_size \u548c scgi_buffers \u6307\u4ee4\u8bbe\u7f6e\u7684\u7f13\u51b2\u533a\u65f6\uff0c\u54cd\u5e94\u7684\u4e00\u90e8\u5206\u53ef\u4ee5\u4fdd\u5b58\u5230\u4e34\u65f6\u6587\u4ef6\u4e2d\u3002\u8be5\u6307\u4ee4\u8bbe\u7f6e\u4e34\u65f6\u6587\u4ef6\u7684\u6700\u5927\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u4e00\u6b21\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u7684\u6570\u636e\u5927\u5c0f\u7531 scgi_temp_file_write_size \u6307\u4ee4\u8bbe\u7f6e\u3002</p> <p>\u96f6\u503c\u7981\u7528\u7f13\u51b2\u5bf9\u4e34\u65f6\u6587\u4ef6\u7684\u54cd\u5e94\u3002</p> <p>\u6b64\u9650\u5236\u4e0d\u9002\u7528\u4e8e\u88ab\u7f13\u5b58\u6216\u5b58\u50a8\u5728\u78c1\u76d8\u4e0a\u7684\u54cd\u5e94\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_next_upstream","title":"scgi_next_upstream","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_next_upstream <code>sierror \\| timeout \\| invalid_header \\| http_500 \\| http_503 \\| http_403 \\| http_404 \\| http_429 \\| non_idempotent \\| off ...</code>; \u9ed8\u8ba4 scgi_next_upstream error timeout; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u5b9a\u5e94\u5c06\u8bf7\u6c42\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u573a\u666f\uff1a</p> <ul> <li> <p><code>error</code></p> <p>\u4e0e\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\uff0c\u5411\u5176\u4f20\u9012\u8bf7\u6c42\u6216\u8bfb\u53d6\u54cd\u5e94\u5934\u65f6\u53d1\u751f\u9519\u8bef</p> </li> <li> <p><code>timeout</code></p> <p>\u5728\u4e0e\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\uff0c\u5411\u5176\u4f20\u9012\u8bf7\u6c42\u6216\u8bfb\u53d6\u54cd\u5e94\u5934\u65f6\u53d1\u751f\u8d85\u65f6</p> </li> <li> <p><code>invalid_header</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u7a7a\u7684\u6216\u65e0\u6548\u7684\u54cd\u5e94</p> </li> <li> <p><code>http_500</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 500 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_503</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 503 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_403</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 403 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_404</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 404 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_429</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 429 \u7684\u54cd\u5e94\uff081.11.13\uff09</p> </li> <li> <p><code>non_idempotent</code></p> <p>\u901a\u5e38\uff0c\u5982\u679c\u8bf7\u6c42\u5df2\u53d1\u9001\u5230\u4e0a\u6e38\u670d\u52a1\u5668\uff0c\u5219\u4f7f\u7528\u975e\u5e42\u7b49\u65b9\u6cd5\uff08<code>POST</code>\u3001<code>LOCK</code>\u3001<code>PATCH</code>\uff09\u7684\u8bf7\u6c42\u4e0d\u4f1a\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\uff081.9.13\uff09\uff0c\u542f\u7528\u6b64\u9009\u9879\u663e\u5f0f\u5141\u8bb8\u91cd\u8bd5\u6b64\u7c7b\u8bf7\u6c42</p> </li> <li> <p><code>off</code></p> <p>\u7981\u7528\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668</p> </li> </ul> <p>\u5e94\u8be5\u8bb0\u4f4f\uff0c\u53ea\u6709\u5728\u5c1a\u672a\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u4efb\u4f55\u5185\u5bb9\u7684\u60c5\u51b5\u4e0b\u624d\u80fd\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u5728\u4f20\u8f93\u54cd\u5e94\u7684\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\u6216\u8d85\u65f6\uff0c\u5219\u65e0\u6cd5\u4fee\u590d\u6b64\u95ee\u9898\u3002</p> <p>\u8be5\u6307\u4ee4\u8fd8\u5b9a\u4e49\u4e86\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u7684\u5931\u8d25\u5c1d\u8bd5\u3002<code>error</code>\u3001<code>timeout</code> \u548c <code>invalid_header</code> \u7684\u60c5\u51b5\u59cb\u7ec8\u88ab\u89c6\u4e3a\u5931\u8d25\u5c1d\u8bd5\uff0c\u5373\u4f7f\u5b83\u4eec\u672a\u5728\u6307\u4ee4\u4e2d\u6307\u5b9a\u3002<code>http_500</code>\u3001<code>http_503</code> \u548c <code>http_429</code> \u7684\u60c5\u51b5\u4ec5\u5728\u6307\u4ee4\u4e2d\u6307\u5b9a\u65f6\u624d\u88ab\u89c6\u4e3a\u5931\u8d25\u5c1d\u8bd5\u3002<code>http_403</code> \u548c <code>http_404</code> \u7684\u60c5\u51b5\u4ece\u672a\u88ab\u89c6\u4e3a\u5931\u8d25\u5c1d\u8bd5\u3002</p> <p>\u5c06\u8bf7\u6c42\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u53ef\u80fd\u4f1a\u53d7\u5230\u5c1d\u8bd5\u6b21\u6570\u548c\u65f6\u95f4\u7684\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_next_upstream_timeout","title":"scgi_next_upstream_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_next_upstream_timeout <code>time</code>; \u9ed8\u8ba4 scgi_next_upstream_timeout 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.5 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236\u8bf7\u6c42\u53ef\u4ee5\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u65f6\u95f4\u3002<code>0</code> \u503c\u5173\u95ed\u6b64\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_next_upstream_tries","title":"scgi_next_upstream_tries","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_next_upstream_tries <code>number</code>; \u9ed8\u8ba4 scgi_next_upstream_tries 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.5 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236\u5c06\u8bf7\u6c42\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u53ef\u80fd\u5c1d\u8bd5\u6b21\u6570\u3002<code>0</code> \u503c\u5173\u95ed\u6b64\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_no_cache","title":"scgi_no_cache","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_no_cache <code>string ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e0d\u5c06\u54cd\u5e94\u4fdd\u5b58\u5230\u7f13\u5b58\u7684\u6761\u4ef6\u3002\u5982\u679c\u5b57\u7b26\u4e32\u53c2\u6570\u6709\u4e00\u4e2a\u503c\u4e0d\u4e3a\u7a7a\u4e14\u4e0d\u7b49\u4e8e <code>0</code>\uff0c\u5219\u4e0d\u4f1a\u4fdd\u5b58\u54cd\u5e94\uff1a</p> <pre><code>scgi_no_cache $cookie_nocache $arg_nocache$arg_comment;\nscgi_no_cache $http_pragma    $http_authorization;\n</code></pre> <p>\u53ef\u4ee5\u4e0e scgi_cache_bypass \u6307\u4ee4\u4e00\u8d77\u4f7f\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_param","title":"scgi_param","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_param <code>parameter value [if_not_empty]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u4e00\u4e2a\u5e94\u4f20\u9012\u7ed9 SCGI \u670d\u52a1\u5668\u7684 <code>parameter</code>\u3002<code>value</code> \u53ef\u4ee5\u5305\u542b\u6587\u672c\u3001\u53d8\u91cf\u53ca\u5176\u7ec4\u5408\u3002\u5f53\u4e14\u4ec5\u5f53\u5728\u5f53\u524d\u7ea7\u522b\u4e0a\u6ca1\u6709\u5b9a\u4e49 <code>scgi_param</code> \u6307\u4ee4\u65f6\uff0c\u8fd9\u4e9b\u6307\u4ee4\u624d\u4ece\u5148\u524d\u7ea7\u522b\u7ee7\u627f\u3002</p> <p>\u5e94\u5c06\u6807\u51c6 CGI \u73af\u5883\u53d8\u91cf\u4f5c\u4e3a SCGI \u5934\u63d0\u4f9b\uff0c\u8bf7\u53c2\u9605\u5206\u53d1\u4e2d\u63d0\u4f9b\u7684 <code>scgi_params</code> \u6587\u4ef6\uff1a</p> <pre><code>location / {\ninclude scgi_params;\n...\n}\n</code></pre> <p>\u5982\u679c\u4f7f\u7528 <code>if_not_empty</code>\uff081.1.11\uff09\u6307\u5b9a\u4e86\u8be5\u6307\u4ee4\uff0c\u90a3\u4e48\u53ea\u6709\u5f53\u5b83\u7684\u503c\u4e0d\u4e3a\u7a7a\u65f6\uff0c\u8fd9\u4e2a\u53c2\u6570\u624d\u4f1a\u4f20\u9012\u7ed9\u670d\u52a1\u5668\uff1a</p> <pre><code>scgi_param HTTPS $https if_not_empty;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_pass","title":"scgi_pass","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_pass <code>address</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 location\u3001location \u4e2d\u7684 if <p>\u8bbe\u7f6e SCGI \u670d\u52a1\u5668\u7684\u5730\u5740\u3002\u5730\u5740\u53ef\u4ee5\u6307\u5b9a\u4e3a\u57df\u540d\u6216 IP \u5730\u5740\u4ee5\u53ca\u7aef\u53e3\uff1a</p> <pre><code>scgi_pass localhost:9000;\n</code></pre> <p>\u6216\u8005\u4f5c\u4e3a UNIX \u57df\u5957\u63a5\u5b57\u8def\u5f84\uff1a</p> <pre><code>scgi_pass unix:/tmp/scgi.socket;\n</code></pre> <p>\u5982\u679c\u57df\u540d\u89e3\u6790\u4e3a\u591a\u4e2a\u5730\u5740\uff0c\u5219\u6240\u6709\u8fd9\u4e9b\u5730\u5740\u90fd\u4ee5\u8f6e\u8bad\u65b9\u5f0f\u4f7f\u7528\u3002\u6b64\u5916\uff0c\u53ef\u4ee5\u5c06\u5730\u5740\u6307\u5b9a\u4e3a\u670d\u52a1\u5668\u7ec4\u3002</p> <p>\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5c06\u5730\u5740\u6307\u5b9a\u4e3a\u57df\u540d\uff0c\u5219\u5728\u6240\u63cf\u8ff0\u7684\u670d\u52a1\u5668\u7ec4\u4e2d\u641c\u7d22\u540d\u79f0\uff0c\u5982\u679c\u672a\u627e\u5230\uff0c\u5219\u4f7f\u7528\u89e3\u6790\u5668\u786e\u5b9a\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_pass_header","title":"scgi_pass_header","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_pass_header <code>field</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5141\u8bb8\u5c06\u5176\u4ed6\u7981\u7528\u7684\u5934\u5b57\u6bb5\u4ece SCGI \u670d\u52a1\u5668\u4f20\u9012\u5230\u5ba2\u6237\u7aef\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_pass_request_body","title":"scgi_pass_request_body","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_pass_request_body <code>on</code> | <code>off</code>; \u9ed8\u8ba4 scgi_pass_request_body on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u793a\u662f\u5426\u5c06\u539f\u59cb\u8bf7\u6c42\u6b63\u6587\u4f20\u9012\u7ed9 SCGI \u670d\u52a1\u5668\u3002\u53e6\u8bf7\u53c2\u89c1 scgi_pass_request_headers \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_pass_request_headers","title":"scgi_pass_request_headers","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_pass_request_headers <code>on</code> | <code>off</code>; \u9ed8\u8ba4 scgi_pass_request_headers on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u660e\u539f\u59cb\u8bf7\u6c42\u7684\u5934\u5b57\u6bb5\u662f\u5426\u4f20\u9012\u7ed9 SCGI \u670d\u52a1\u5668\u3002\u53e6\u8bf7\u53c2\u89c1 scgi_pass_request_body \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_read_timeout","title":"scgi_read_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_read_timeout <code>time</code>; \u9ed8\u8ba4 scgi_read_timeout 60s \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u4ece SCGI \u670d\u52a1\u5668\u8bfb\u53d6\u4e00\u4e2a\u54cd\u5e94\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u8d85\u65f6\u65f6\u95f4\u4ec5\u9488\u5bf9\u4e24\u4e2a\u8fde\u7eed\u7684\u8bfb\u64cd\u4f5c\uff0c\u800c\u4e0d\u662f\u6574\u4e2a\u54cd\u5e94\u4f20\u8f93\u3002\u5982\u679c SCGI \u670d\u52a1\u5668\u5728\u6b64\u65f6\u95f4\u5185\u672a\u4f20\u8f93\u4efb\u4f55\u5185\u5bb9\uff0c\u5219\u4f1a\u5173\u95ed\u8fde\u63a5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_socket_keepalive","title":"scgi_socket_keepalive","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_socket_keepalive <code>on</code> | <code>off</code>; \u9ed8\u8ba4 scgi_socket_keepalive off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.15.6 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u914d\u7f6e\u4e0e SCGI \u670d\u52a1\u5668\u7684\u4f20\u51fa\u8fde\u63a5\u7684 TCP keepalive \u884c\u4e3a\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u8bbe\u7f6e\u5bf9\u5957\u63a5\u5b57\u6709\u6548\u3002\u5982\u679c\u6307\u4ee4\u8bbe\u7f6e\u4e3a\u503c <code>on</code>\uff0c\u5219\u4e3a\u5957\u63a5\u5b57\u6253\u5f00 <code>SO_KEEPALIVE</code> \u5957\u63a5\u5b57\u9009\u9879\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_store","title":"scgi_store","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_store <code>on</code> | <code>off</code> | <code>string</code>; \u9ed8\u8ba4 scgi_store off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5141\u8bb8\u5c06\u6587\u4ef6\u4fdd\u5b58\u5230\u78c1\u76d8\u3002<code>on</code> \u53c2\u6570\u4f7f\u7528\u4e0e alias \u6216 root \u6307\u4ee4\u5bf9\u5e94\u7684\u8def\u5f84\u4fdd\u5b58\u6587\u4ef6\u3002<code>off</code> \u53c2\u6570\u7981\u7528\u6587\u4ef6\u4fdd\u5b58\u3002\u6b64\u5916\uff0c\u53ef\u4ee5\u4f7f\u7528\u5e26\u53d8\u91cf\u7684\u5b57\u7b26\u4e32\u663e\u5f0f\u8bbe\u7f6e\u6587\u4ef6\u540d\uff1a</p> <pre><code>scgi_store /data/www$original_uri;\n</code></pre> <p>\u6839\u636e\u63a5\u6536\u7684 Last-Modified \u54cd\u5e94\u5934\u5b57\u6bb5\u8bbe\u7f6e\u6587\u4ef6\u7684\u4fee\u6539\u65f6\u95f4\u3002\u9996\u5148\u5c06\u54cd\u5e94\u5199\u5165\u4e34\u65f6\u6587\u4ef6\uff0c\u7136\u540e\u91cd\u547d\u540d\u8be5\u6587\u4ef6\u3002\u4ece 0.8.9 \u7248\u672c\u5f00\u59cb\uff0c\u4e34\u65f6\u6587\u4ef6\u548c\u6301\u4e45\u5316\u5b58\u50a8\u53ef\u4ee5\u653e\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002\u4f46\u662f\uff0c\u8bf7\u6ce8\u610f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6587\u4ef6\u5c06\u8de8\u4e24\u4e2a\u6587\u4ef6\u7cfb\u7edf\u8fdb\u884c\u590d\u5236\uff0c\u800c\u4e0d\u662f\u7b80\u5355\u7684\u91cd\u547d\u540d\u64cd\u4f5c\u3002\u56e0\u6b64\uff0c\u5efa\u8bae\u5bf9\u4e8e\u4efb\u4f55\u6307\u5b9a\u4f4d\u7f6e\uff0c\u7531 scgi_temp_path \u6307\u4ee4\u8bbe\u7f6e\u7684\u4fdd\u5b58\u6587\u4ef6\u548c\u4fdd\u5b58\u4e34\u65f6\u6587\u4ef6\u7684\u76ee\u5f55\u90fd\u653e\u5728\u540c\u4e00\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002</p> <p>\u8be5\u6307\u4ee4\u53ef\u7528\u4e8e\u521b\u5efa\u9759\u6001\u4e0d\u53ef\u66f4\u6539\u6587\u4ef6\u7684\u672c\u5730\u526f\u672c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>location /images/ {\nroot              /data/www;\nerror_page        404 = /fetch$uri;\n}\n\nlocation /fetch/ {\ninternal;\n\nscgi_pass         backend:9000;\n...\n\nscgi_store        on;\nscgi_store_access user:rw group:rw all:r;\nscgi_temp_path    /data/temp;\n\nalias             /data/www/;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_store_access","title":"scgi_store_access","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_store_access <code>users:permissions ...</code>; \u9ed8\u8ba4 scgi_store_access user:rw; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u4e3a\u65b0\u521b\u5efa\u7684\u6587\u4ef6\u548c\u76ee\u5f55\u8bbe\u7f6e\u8bbf\u95ee\u6743\u9650\uff0c\u4f8b\u5982\uff1a</p> <pre><code>scgi_store_access user:rw group:rw all:r;\n</code></pre> <p>\u5982\u679c\u6307\u5b9a\u4e86 <code>group</code> \u6216 <code>all</code> \u8bbf\u95ee\u6743\u9650\uff0c\u5219\u53ef\u4ee5\u7701\u7565 <code>user</code> \u6743\u9650\uff1a</p> <pre><code>scgi_store_access group:rw all:r;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_temp_file_write_size","title":"scgi_temp_file_write_size","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_temp_file_write_size <code>size</code>; \u9ed8\u8ba4 scgi_temp_file_write_size 8k|16k \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5f53\u542f\u7528\u4ece SCGI \u670d\u52a1\u5668\u5230\u4e34\u65f6\u6587\u4ef6\u7684\u54cd\u5e94\u7f13\u51b2\u65f6\uff0c\u9650\u5236\u4e00\u6b21\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u7684\u6570\u636e\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>size</code> \u7531 scgi_buffer_size \u548c scgi_buffers \u6307\u4ee4\u8bbe\u7f6e\u7684\u4e24\u4e2a\u7f13\u51b2\u533a\u9650\u5236\u3002\u4e34\u65f6\u6587\u4ef6\u7684\u6700\u5927\u5927\u5c0f\u7531 scgi_max_temp_file_size \u6307\u4ee4\u8bbe\u7f6e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#scgi_temp_path","title":"scgi_temp_path","text":"- \u8bf4\u660e \u8bed\u6cd5 scgi_temp_path <code>path [level1 [level2 [level3]]]</code>; \u9ed8\u8ba4 scgi_temp_path scgi_temp \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e00\u4e2a\u7528\u4e8e\u5b58\u50a8\u4e34\u65f6\u6587\u4ef6\u7684\u76ee\u5f55\uff0c\u5176\u4e2d\u5305\u542b\u4ece SCGI \u670d\u52a1\u5668\u63a5\u6536\u7684\u6570\u636e\u3002\u5728\u6307\u5b9a\u76ee\u5f55\u4e0b\u6700\u591a\u53ef\u4ee5\u4f7f\u7528\u4e09\u7ea7\u5b50\u76ee\u5f55\u7ed3\u6784\u3002\u4f8b\u5982\u4ee5\u4e0b\u914d\u7f6e\uff1a</p> <pre><code>scgi_temp_path /spool/nginx/scgi_temp 1 2;\n</code></pre> <p>\u4e34\u65f6\u6587\u4ef6\u53ef\u80fd\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>/spool/nginx/scgi_temp/7/45/00000123457\n</code></pre> <p>\u53e6\u8bf7\u53c2\u89c1 scgi_cache_path \u6307\u4ee4\u7684 <code>use_temp_path</code> \u53c2\u6570\u3002</p>"},{"location":"Modules-reference/http/ngx_http_scgi_module/#_3","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/http/ngx_http_scgi_module.html</li> </ul>"},{"location":"Modules-reference/http/ngx_http_secure_link_module/","title":"ngx_http_secure_link_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>secure_link</li> <li>secure_link_md5</li> <li>secure_link_secret</li> </ul> </li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_http_secure_link_module</code> \u6a21\u5757\uff080.7.18\uff09\u7528\u4e8e\u68c0\u67e5\u8bf7\u6c42\u94fe\u63a5\u7684\u771f\u5b9e\u6027\uff0c\u4fdd\u62a4\u8d44\u6e90\u514d\u53d7\u672a\u7ecf\u6388\u6743\u7684\u8bbf\u95ee\uff0c\u5e76\u9650\u5236\u94fe\u63a5\u6709\u6548\u65f6\u957f\u3002</p> <p>\u901a\u8fc7\u5c06\u8bf7\u6c42\u4e2d\u4f20\u9012\u7684\u6821\u9a8c\u548c\u503c\u4e0e\u4e3a\u8bf7\u6c42\u8ba1\u7b97\u7684\u503c\u8fdb\u884c\u6bd4\u8f83\uff0c\u9a8c\u8bc1\u6240\u8bf7\u6c42\u94fe\u63a5\u7684\u771f\u5b9e\u6027\u3002\u5982\u679c\u94fe\u63a5\u6709\u6548\u65f6\u957f\u6709\u9650\u4e14\u65f6\u95f4\u5df2\u8fc7\uff0c\u5219\u94fe\u63a5\u5c06\u88ab\u89c6\u4e3a\u8fc7\u671f\u3002\u8fd9\u4e9b\u68c0\u67e5\u7684\u72b6\u6001\u5728 <code>$secure_link</code> \u53d8\u91cf\u4e2d\u53ef\u7528\u3002</p> <p>\u8be5\u6a21\u5757\u63d0\u4f9b\u4e24\u79cd\u66ff\u4ee3\u64cd\u4f5c\u6a21\u5f0f\u3002\u7b2c\u4e00\u79cd\u6a21\u5f0f\u7531 secure_link_secret \u6307\u4ee4\u542f\u7528\uff0c\u7528\u4e8e\u68c0\u67e5\u8bf7\u6c42\u94fe\u63a5\u7684\u771f\u5b9e\u6027\u4ee5\u53ca\u4fdd\u62a4\u8d44\u6e90\u514d\u53d7\u672a\u7ecf\u6388\u6743\u7684\u8bbf\u95ee\u3002\u7b2c\u4e8c\u79cd\u6a21\u5f0f\uff080.8.50\uff09\u7531 secure_link \u548c secure_link_md5 \u6307\u4ee4\u542f\u7528\uff0c\u4e5f\u7528\u4e8e\u9650\u5236\u94fe\u63a5\u7684\u6709\u6548\u671f\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\uff0c\u53ef\u4f7f\u7528 <code>--with-http_secure_link_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u5b83\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_secure_link_module/#_1","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_secure_link_module/#secure_link","title":"secure_link","text":"- \u8bf4\u660e \u8bed\u6cd5 secure_link <code>expression</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e00\u4e2a\u5305\u542b\u53d8\u91cf\u7684\u5b57\u7b26\u4e32\uff0c\u4ece\u4e2d\u63d0\u53d6\u94fe\u63a5\u7684\u6821\u9a8c\u548c\u503c\u548c\u6709\u6548\u671f\u3002</p> <p>\u8868\u8fbe\u5f0f\u4e2d\u4f7f\u7528\u7684\u53d8\u91cf\u901a\u5e38\u4e0e\u8bf7\u6c42\u76f8\u5173\u8054\u3002\u89c1\u4e0b\u9762\u7684\u4f8b\u5b50\u3002</p> <p>\u5c06\u4ece\u5b57\u7b26\u4e32\u4e2d\u63d0\u53d6\u7684\u6821\u9a8c\u548c\u503c\u4e0e secure_link_md5 \u6307\u4ee4\u5b9a\u4e49\u7684\u8868\u8fbe\u5f0f\u7684 MD5 \u54c8\u5e0c\u503c\u8fdb\u884c\u6bd4\u8f83\u3002\u5982\u679c\u6821\u9a8c\u548c\u4e0d\u540c\uff0c\u5219 <code>$secure_link</code> \u53d8\u91cf\u8bbe\u7f6e\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002\u5982\u679c\u6821\u9a8c\u548c\u76f8\u540c\uff0c\u5219\u68c0\u67e5\u94fe\u63a5\u6709\u6548\u671f\u3002\u5982\u679c\u94fe\u63a5\u7684\u6709\u6548\u671f\u6709\u9650\u4e14\u65f6\u95f4\u5df2\u8fc7\uff0c\u5219 <code>$secure_link</code> \u53d8\u91cf\u5c06\u8bbe\u7f6e\u4e3a <code>0</code>\u3002\u5426\u5219\uff0c\u5b83\u88ab\u8bbe\u7f6e\u4e3a <code>1</code>\u3002\u8bf7\u6c42\u4e2d\u4f20\u9012\u7684 MD5 \u54c8\u5e0c\u503c\u4f7f\u7528 base64url \u7f16\u7801\u3002</p> <p>\u5982\u679c\u94fe\u63a5\u7684\u6709\u6548\u65f6\u957f\u6709\u9650\uff0c\u5219\u81ea Epoch\uff08Thu, 01 Jan 1970 00:00:00 GMT\uff09\u4ee5\u79d2\u4e3a\u5355\u4f4d\u8bbe\u7f6e\u5230\u671f\u65f6\u95f4\u3002\u8be5\u503c\u5728 MD5 \u54c8\u5e0c\u4e4b\u540e\u7684\u8868\u8fbe\u5f0f\u4e2d\u6307\u5b9a\uff0c\u5e76\u4ee5\u9017\u53f7\u5206\u9694\u3002\u8bf7\u6c42\u4e2d\u4f20\u9012\u7684\u5230\u671f\u65f6\u95f4\u53ef\u901a\u8fc7 <code>$secure_link_expires</code> \u53d8\u91cf\u83b7\u5f97\uff0c\u4ee5\u4fbf\u5728 secure_link_md5 \u6307\u4ee4\u4e2d\u4f7f\u7528\u3002\u5982\u679c\u672a\u6307\u5b9a\u5230\u671f\u65f6\u95f4\uff0c\u5219\u94fe\u63a5\u5c06\u6709\u65e0\u9650\u6709\u6548\u65f6\u957f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_secure_link_module/#secure_link_md5","title":"secure_link_md5","text":"- \u8bf4\u660e \u8bed\u6cd5 secure_link_md5 <code>expression</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e00\u4e2a\u5c06\u4e3a\u5176\u8ba1\u7b97 MD5 \u54c8\u5e0c\u503c\u5e76\u4e0e\u8bf7\u6c42\u4e2d\u4f20\u9012\u7684\u503c\u8fdb\u884c\u6bd4\u8f83\u7684\u8868\u8fbe\u5f0f\u3002</p> <p>\u8868\u8fbe\u5f0f\u5e94\u5305\u542b\u94fe\u63a5\uff08\u8d44\u6e90\uff09\u7684\u4fdd\u62a4\u90e8\u5206\u548c\u79d8\u5bc6\u90e8\u5206\u3002\u5982\u679c\u94fe\u63a5\u7684\u6709\u6548\u5e02\u573a\u4e3a\u6709\u9650\uff0c\u5219\u8868\u8fbe\u5f0f\u8fd8\u5e94\u5305\u542b <code>$secure_link_expires</code>\u3002</p> <p>\u4e3a\u9632\u6b62\u672a\u7ecf\u6388\u6743\u7684\u8bbf\u95ee\uff0c\u8868\u8fbe\u5f0f\u53ef\u80fd\u5305\u542b\u6709\u5173\u5ba2\u6237\u7aef\u7684\u4e00\u4e9b\u4fe1\u606f\uff0c\u4f8b\u5982\u5176\u5730\u5740\u548c\u6d4f\u89c8\u5668\u7248\u672c\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>location /s/ {\nsecure_link $arg_md5,$arg_expires;\nsecure_link_md5 \"$secure_link_expires$uri$remote_addr secret\";\n\nif ($secure_link = \"\") {\nreturn 403;\n}\n\nif ($secure_link = \"0\") {\nreturn 410;\n}\n\n...\n}\n</code></pre> <p><code>/s/link?md5=_e4Nc3iduzkWRm01TBBNYw&amp;expires=2147483647</code> \u94fe\u63a5\u9650\u5236\u4e86 IP \u5730\u5740\u4e3a 127.0.0.1 \u7684\u5ba2\u6237\u7aef\u5bf9 <code>/s/link</code> \u8bbf\u95ee\u3002\u8be5\u94fe\u63a5\u7684\u6709\u6548\u65f6\u957f\u6709\u9650\uff0c\u76f4\u5230 2038 \u5e74 1 \u6708 19 \u65e5\uff08GMT\uff09\u3002</p> <p>\u5728 UNIX \u4e0a\uff0c<code>md5</code> \u8bf7\u6c42\u53c2\u6570\u503c\u53ef\u4ee5\u83b7\u53d6\u4e3a\uff1a</p> <pre><code>echo -n '2147483647/s/link127.0.0.1 secret' | \\\nopenssl md5 -binary | openssl base64 | tr +/ -_ | tr -d =\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_secure_link_module/#secure_link_secret","title":"secure_link_secret","text":"- \u8bf4\u660e \u8bed\u6cd5 secure_link_secret <code>word</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e00\u4e2a\u7528\u4e8e\u68c0\u67e5\u6240\u8bf7\u6c42\u94fe\u63a5\u771f\u5b9e\u6027\u7684\u6697\u8bed\uff08<code>word</code>\uff09\u3002</p> <p>\u8bf7\u6c42\u94fe\u63a5\u7684\u5b8c\u6574 URI \u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>/prefix/hash/link\n</code></pre> <p>\u5176\u4e2d <code>hash</code> \u662f\u9488\u5bf9\u94fe\u63a5\u548c\u6697\u8bed\u76f8\u8fde\u8ba1\u7b97\u7684 MD5 \u54c8\u5e0c\u7684\u5341\u516d\u8fdb\u5236\u8868\u793a\uff0c\u800c <code>prefix</code> \u662f\u6ca1\u6709\u659c\u6760\u7684\u4efb\u610f\u5b57\u7b26\u4e32\u3002</p> <p>\u5982\u679c\u8bf7\u6c42\u7684\u94fe\u63a5\u901a\u8fc7\u4e86\u771f\u5b9e\u6027\u68c0\u67e5\uff0c\u5219 <code>$secure_link</code> \u53d8\u91cf\u5c06\u8bbe\u7f6e\u4e3a\u4ece\u8bf7\u6c42 URI \u4e2d\u63d0\u53d6\u7684\u94fe\u63a5\u3002\u5426\u5219\uff0c<code>$secure_link</code> \u53d8\u91cf\u8bbe\u7f6e\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>location /p/ {\nsecure_link_secret secret;\n\nif ($secure_link = \"\") {\nreturn 403;\n}\n\nrewrite ^ /secure/$secure_link;\n}\n\nlocation /secure/ {\ninternal;\n}\n</code></pre> <p><code>/p/5e814704a28d9bc1914ff19fa0c4a00a/link</code> \u7684\u8bf7\u6c42\u5c06\u5728\u5185\u90e8\u91cd\u5b9a\u5411\u5230 <code>/secure/link</code>\u3002</p> <p>\u5728 UNIX \u4e0a\uff0c\u6b64\u793a\u4f8b\u7684\u54c8\u5e0c\u503c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u83b7\u5f97\uff1a</p> <pre><code>echo -n 'linksecret' | openssl md5 -hex\n</code></pre> <p></p>"},{"location":"Modules-reference/http/ngx_http_secure_link_module/#_2","title":"\u5185\u5d4c\u53d8\u91cf","text":"<ul> <li> <p><code>$secure_link</code></p> <p>\u94fe\u63a5\u68c0\u67e5\u7684\u72b6\u6001\u3002\u5177\u4f53\u503c\u53d6\u51b3\u4e8e\u6240\u9009\u7684\u64cd\u4f5c\u6a21\u5f0f\u3002</p> </li> <li> <p><code>$secure_link_expires</code></p> <p>\u8bf7\u6c42\u4e2d\u4f20\u9012\u7684\u94fe\u63a5\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u4ec5\u7528\u4e8e <code>secure_link_md5</code> \u6307\u4ee4\u3002</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_secure_link_module/#_3","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/http/ngx_http_secure_link_module.html</li> </ul>"},{"location":"Modules-reference/http/ngx_http_session_log_module/","title":"ngx_http_session_log_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>session_log</li> <li>session_log_format</li> <li>session_log_zone</li> </ul> </li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_http_session_log_module</code> \u6a21\u5757\u542f\u7528\u4f1a\u8bdd\u65e5\u5fd7\uff08\u591a\u4e2a HTTP \u8bf7\u6c42\u7684\u805a\u5408\uff09\uff0c\u800c\u4e0d\u662f\u5355\u4e2a HTTP \u8bf7\u6c42\u3002</p> <p>\u8be5\u6a21\u5757\u4f5c\u4e3a\u6211\u4eec\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\u63d0\u4f9b\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_session_log_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<p>\u4ee5\u4e0b\u914d\u7f6e\u6839\u636e\u8bf7\u6c42\u5ba2\u6237\u7aef\u7684\u5730\u5740\u548c User-Agent \u8bf7\u6c42\u5934\u5b57\u6bb5\u8bbe\u7f6e\u4f1a\u8bdd\u65e5\u5fd7\u5e76\u5c06\u8bf7\u6c42\u6620\u5c04\u5230\u4f1a\u8bdd\uff1a</p> <pre><code>session_log_zone /path/to/log format=combined\nzone=one:1m timeout=30s\nmd5=$binary_remote_addr$http_user_agent;\n\nlocation /media/ {\nsession_log one;\n}\n</code></pre> <p></p>"},{"location":"Modules-reference/http/ngx_http_session_log_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_session_log_module/#session_log","title":"session_log","text":"- \u8bf4\u660e \u8bed\u6cd5 session_log <code>name</code> | <code>off</code>; \u9ed8\u8ba4 session_log off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5141\u8bb8\u4f7f\u7528\u6307\u5b9a\u7684\u4f1a\u8bdd\u65e5\u5fd7\u3002\u7279\u6b8a\u503c <code>off</code> \u53d6\u6d88\u4ece\u5148\u524d\u914d\u7f6e\u7ea7\u522b\u7ee7\u627f\u7684\u6240\u6709 <code>session_log</code> \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_session_log_module/#session_log_format","title":"session_log_format","text":"- \u8bf4\u660e \u8bed\u6cd5 session_log_format <code>name string ...</code>; \u9ed8\u8ba4 session_log_format combined \"...\"; \u4e0a\u4e0b\u6587 http <p>\u6307\u5b9a\u65e5\u5fd7\u7684\u8f93\u51fa\u683c\u5f0f\u3002<code>$body_bytes_sent</code> \u53d8\u91cf\u7684\u503c\u805a\u5408\u5728\u4f1a\u8bdd\u7684\u6240\u6709\u8bf7\u6c42\u4e2d\u3002\u53ef\u7528\u4e8e\u8bb0\u5f55\u7684\u6240\u6709\u5176\u4ed6\u53d8\u91cf\u7684\u503c\u5bf9\u5e94\u4e8e\u4f1a\u8bdd\u4e2d\u7684\u7b2c\u4e00\u4e2a\u8bf7\u6c42\u3002</p>"},{"location":"Modules-reference/http/ngx_http_session_log_module/#session_log_zone","title":"session_log_zone","text":"- \u8bf4\u660e \u8bed\u6cd5 session_log_zone <code>path zone=name:size [format=format] [timeout=time] [id=id] [md5=md5]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u8bbe\u7f6e\u65e5\u5fd7\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u5e76\u914d\u7f6e\u7528\u4e8e\u5b58\u50a8\u5f53\u524d\u6d3b\u52a8\u4f1a\u8bdd\u7684\u5171\u4eab\u5185\u5b58\u533a\u57df\u3002</p> <p>\u53ea\u8981\u4f1a\u8bdd\u4e2d\u7684\u6700\u540e\u4e00\u4e2a\u8bf7\u6c42\u7ecf\u8fc7\u7684\u65f6\u95f4\u4e0d\u8d85\u8fc7\u6307\u5b9a\u7684 <code>timeout</code>\uff08\u9ed8\u8ba4\u4e3a 30 \u79d2\uff09\uff0c\u4f1a\u8bdd\u5c31\u88ab\u89c6\u4e3a\u6d3b\u52a8\u72b6\u6001\u3002\u4f1a\u8bdd\u4e0d\u518d\u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\u540e\u5c06\u88ab\u5199\u5165\u65e5\u5fd7\u3002</p> <p><code>id</code> \u53c2\u6570\u6807\u8bc6\u8bf7\u6c42\u6620\u5c04\u5230\u7684\u4f1a\u8bdd\u3002<code>id</code> \u53c2\u6570\u8bbe\u7f6e\u4e3a MD5 \u54c8\u5e0c\u7684\u5341\u516d\u8fdb\u5236\u5f62\u5f0f\uff08\u4f8b\u5982\uff0c\u4f7f\u7528\u53d8\u91cf\u4ece cookie \u4e2d\u83b7\u53d6\uff09\u3002\u5982\u679c\u672a\u6307\u5b9a\u6b64\u53c2\u6570\u6216\u4e0d\u662f\u6709\u6548\u7684 MD5 \u54c8\u5e0c\uff0c\u5219 nginx \u5c06\u6839\u636e <code>md5</code> \u53c2\u6570\u7684\u503c\u8ba1\u7b97 MD5 \u54c8\u5e0c\uff0c\u5e76\u4f7f\u7528\u6b64\u54c8\u5e0c\u521b\u5efa\u65b0\u4f1a\u8bdd\u3002<code>id</code> \u548c <code>md5</code> \u53c2\u6570\u90fd\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002</p> <p><code>format</code> \u53c2\u6570\u8bbe\u7f6e session_log_format \u6307\u4ee4\u914d\u7f6e\u7684\u81ea\u5b9a\u4e49\u4f1a\u8bdd\u65e5\u5fd7\u683c\u5f0f\u3002\u5982\u679c\u672a\u6307\u5b9a <code>format</code>\uff0c\u5219\u4f7f\u7528\u9884\u5b9a\u4e49\u7684 <code>combined</code>\u683c\u5f0f\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_session_log_module/#_3","title":"\u5185\u5d4c\u53d8\u91cf","text":"<p><code>ngx_http_session_log_module</code> \u6a21\u5757\u652f\u6301\u4e24\u4e2a\u5185\u5d4c\u53d8\u91cf\uff1a</p> <ul> <li> <p><code>$session_log_id</code></p> <p>\u5f53\u524d\u4f1a\u8bdd ID</p> </li> <li> <p><code>$session_log_binary_id</code></p> <p>\u4e8c\u8fdb\u5236\u5f62\u5f0f\u7684\u5f53\u524d\u4f1a\u8bdd ID\uff0816\u5b57\u8282\uff09\u3002</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_session_log_module/#_4","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/http/ngx_http_session_log_module.html</li> </ul>"},{"location":"Modules-reference/http/ngx_http_slice_module/","title":"ngx_http_slice_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>slice</li> </ul> </li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_http_slice_module</code> \u6a21\u5757\uff081.9.8\uff09\u662f\u4e00\u4e2a\u8fc7\u6ee4\u5668\uff0c\u5b83\u5c06\u8bf7\u6c42\u62c6\u5206\u4e3a\u5b50\u8bf7\u6c42\uff0c\u6bcf\u4e2a\u5b50\u8bf7\u6c42\u90fd\u8fd4\u56de\u4e00\u5b9a\u8303\u56f4\u7684\u54cd\u5e94\u3002\u8be5\u8fc7\u6ee4\u5668\u9488\u5bf9\u5927\u54cd\u5e94\u7f13\u5b58\u66f4\u52a0\u6709\u6548\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\uff0c\u53ef\u5728\u6784\u5efa nginx \u65f6\u4f7f\u7528 <code>--with-http_slice_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_slice_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location / {\nslice             1m;\nproxy_cache       cache;\nproxy_cache_key   $uri$is_args$args$slice_range;\nproxy_set_header  Range $slice_range;\nproxy_cache_valid 200 206 1h;\nproxy_pass        http://localhost:8000;\n}\n</code></pre> <p>\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u54cd\u5e94\u88ab\u62c6\u5206\u4e3a 1M \u5927\u5c0f\u7684\u53ef\u7f13\u5b58\u5207\u7247\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_slice_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_slice_module/#slice","title":"slice","text":"- \u8bf4\u660e \u8bed\u6cd5 slice <code>size</code>; \u9ed8\u8ba4 slice 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u5207\u7247\u7684 <code>size</code>\uff08\u5927\u5c0f\uff09\u3002\u96f6\u503c\u7981\u6b62\u5c06\u54cd\u5e94\u62c6\u5206\u4e3a\u5207\u7247\u3002\u8bf7\u6ce8\u610f\uff0c\u503c\u592a\u4f4e\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5185\u5b58\u4f7f\u7528\u8fc7\u591a\u5e76\u6253\u5f00\u5927\u91cf\u6587\u4ef6\u3002</p> <p>\u4e3a\u4e86\u4f7f\u5b50\u8bf7\u6c42\u8fd4\u56de\u6240\u9700\u7684\u8303\u56f4\uff0c<code>$slice_range</code> \u53d8\u91cf\u5e94\u4f5c\u4e3a Range \u8bf7\u6c42\u5934\u5b57\u6bb5\u4f20\u9012\u7ed9\u4ee3\u7406\u670d\u52a1\u5668\u3002\u5982\u679c\u542f\u7528\u4e86\u7f13\u5b58\uff0c\u5219\u5e94\u5c06 <code>$slice_range</code> \u6dfb\u52a0\u5230\u7f13\u5b58\u952e\uff0c\u5e76\u542f\u7528 206 \u72b6\u6001\u4ee3\u7801\u7684\u54cd\u5e94\u7f13\u5b58\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_slice_module/#_3","title":"\u5185\u5d4c\u53d8\u91cf","text":"<p><code>ngx_http_slice_module</code> \u6a21\u5757\u652f\u6301\u4ee5\u4e0b\u5185\u5d4c\u53d8\u91cf\uff1a</p> <ul> <li> <p><code>$slice_range</code></p> <p>HTTP \u5b57\u8282\u8303\u56f4\u683c\u5f0f\u7684\u5f53\u524d\u5207\u7247\u8303\u56f4\uff0c\u4f8b\u5982\uff1a<code>bytes=0-1048575</code>\u3002</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_slice_module/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_slice_module.html</p>"},{"location":"Modules-reference/http/ngx_http_spdy_module/","title":"ngx_http_spdy_module","text":"<ul> <li>\u5df2\u77e5\u95ee\u9898</li> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>spdy_chunk_size</li> <li>spdy_headers_comp</li> </ul> </li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p>\u8be5\u6a21\u5757\u5df2\u88ab <code>1.9.5</code> \u4e2d\u7684 ngx_http_v2_module \u6a21\u5757\u6240\u53d6\u4ee3\u3002</p> <p><code>ngx_http_spdy_module</code> \u6a21\u5757\u4e3a SPDY \u63d0\u4f9b\u5b9e\u9a8c\u6027\u652f\u6301\u3002\u76ee\u524d\uff0cSPDY \u534f\u8bae\u8349\u6848 3.1\u5df2\u5b9e\u65bd\u3002</p> <p>\u5728 1.5.10 \u7248\u4e4b\u524d\uff0c\u5df2\u5b9e\u65bd SPDY \u534f\u8bae\u8349\u6848 2\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\uff0c\u53ef\u5728\u6784\u5efa nginx \u65f6\u4f7f\u7528 <code>--with-http_spdy_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u5b83\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_spdy_module/#_1","title":"\u5df2\u77e5\u95ee\u9898","text":"<p>\u8be5\u6a21\u5757\u5904\u4e8e\u5b9e\u9a8c\u9636\u6bb5\uff0c\u8bf7\u6ce8\u610f\u98ce\u9669\u3002</p> <p>\u5f53\u524d\u7684 SPDY \u534f\u8bae\u5b9e\u73b0\u4e0d\u652f\u6301**\u670d\u52a1\u5668\u63a8\u9001**\u3002</p> <p>\u5728 1.5.9 \u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0cSPDY \u8fde\u63a5\u4e2d\u7684\u54cd\u5e94\u65e0\u6cd5\u505a\u5230\u901f\u7387\u9650\u5236\u3002</p> <p>\u65e0\u8bba proxy_request_buffering\u3001fastcgi_request_buffering\u3001uwsgi_request_buffering \u548c scgi_request_buffering \u6307\u4ee4\u4e3a\u4f55\u503c\uff0c\u90fd\u65e0\u6cd5\u7981\u7528\u5ba2\u6237\u7aef\u8bf7\u6c42\u4f53\u7f13\u51b2\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_spdy_module/#_2","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>server {\nlisten 443 ssl spdy;\n\nssl_certificate server.crt;\nssl_certificate_key server.key;\n...\n}\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u4e3a\u4e86\u5728\u540c\u4e00\u7aef\u53e3\u4e0a\u540c\u65f6\u63a5\u53d7 HTTPS \u548c SPDY \u8fde\u63a5\uff0c\u4f7f\u7528\u7684 OpenSSL \u5e93\u5e94\u652f\u6301 Next Protocol Negotiation TLS \u6269\u5c55\uff0c\u8be5\u6269\u5c55\u81ea OpenSSL 1.0.1 \u7248\u5f00\u59cb\u53ef\u7528\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_spdy_module/#_3","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_spdy_module/#spdy_chunk_size","title":"spdy_chunk_size","text":"- \u8bf4\u660e \u8bed\u6cd5 spdy_chunk_size <code>size</code>; \u9ed8\u8ba4 spdy_chunk_size 8k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.9 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u54cd\u5e94\u4f53\u5206\u5757\u7684\u6700\u5927\u5927\u5c0f\u3002\u503c\u592a\u4f4e\u4f1a\u5bfc\u81f4\u66f4\u9ad8\u7684\u5f00\u9500\u3002\u7531\u4e8e HOL \u963b\u585e\uff0c\u592a\u9ad8\u7684\u503c\u4f1a\u7834\u574f\u4f18\u5148\u7ea7\u3002</p>"},{"location":"Modules-reference/http/ngx_http_spdy_module/#spdy_headers_comp","title":"spdy_headers_comp","text":"- \u8bf4\u660e \u8bed\u6cd5 spdy_headers_comp <code>level</code>; \u9ed8\u8ba4 spdy_headers_comp 0; \u4e0a\u4e0b\u6587 http\u3001server <p>\u8bbe\u7f6e\u54cd\u5e94\u5934\u538b\u7f29\u7ea7\u522b\uff08<code>level</code>\uff09\uff0c\u8303\u56f4\u4ece <code>1</code>\uff08\u6700\u5feb\uff0c\u538b\u7f29\u7a0b\u5ea6\u8f83\u4f4e\uff09\u5230 <code>9</code>\uff08\u6700\u6162\uff0c\u538b\u7f29\u7a0b\u5ea6\u6700\u4f73\uff09\u3002\u7279\u6b8a\u503c <code>0</code> \u5c06\u5173\u95ed\u5934\u538b\u7f29\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_spdy_module/#_4","title":"\u5185\u5d4c\u53d8\u91cf","text":"<p><code>ngx_http_spdy_module</code> \u6a21\u5757\u652f\u6301\u4ee5\u4e0b\u5185\u5d4c\u53d8\u91cf\uff1a</p> <ul> <li> <p><code>$spdy</code></p> <p>SPDY \u8fde\u63a5\u7684 SPDY \u534f\u8bae\u7248\u672c\uff0c\u65e0\u5219\u4e3a\u7a7a\u5b57\u7b26\u4e32</p> </li> <li> <p><code>$spdy_request_priority</code></p> <p>\u8bf7\u6c42 SPDY \u8fde\u63a5\u7684\u4f18\u5148\u7ea7\uff0c\u65e0\u5219\u4e3a\u7a7a\u5b57\u7b26\u4e32</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_spdy_module/#_5","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_spdy_module.html</p>"},{"location":"Modules-reference/http/ngx_http_split_clients_module/","title":"ngx_http_split_clients_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>split_clients</li> </ul> </li> </ul> <p><code>ngx_http_split_clients_module</code> \u6a21\u5757\u7528\u4e8e\u521b\u5efa\u9002\u7528\u4e8e A/B \u6d4b\u8bd5\u7684\u53d8\u91cf\uff0c\u4e5f\u79f0\u4e3a\u62c6\u5206\u6d4b\u8bd5\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_split_clients_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>http {\nsplit_clients \"${remote_addr}AAA\" $variant {\n0.5%               .one;\n2.0%               .two;\n*                  \"\";\n}\n\nserver {\nlocation / {\nindex index${variant}.html;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_split_clients_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_split_clients_module/#split_clients","title":"split_clients","text":"- \u8bf4\u660e \u8bed\u6cd5 split_clients <code>string $variable { ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u521b\u5efa\u4e00\u4e2a\u7528\u4e8e A/B \u6d4b\u8bd5\u7684\u53d8\u91cf\u3002</p> <pre><code>split_clients \"${remote_addr}AAA\" $variant {\n0.5%               .one;\n2.0%               .two;\n*                  \"\";\n}\n</code></pre> <p>\u4f7f\u7528 MurmurHash2 \u5bf9\u539f\u59cb\u5b57\u7b26\u4e32\u7684\u503c\u8fdb\u884c\u54c8\u5e0c\u5904\u7406\u3002\u5728\u4ee5\u4e0a\u793a\u4f8b\u4e2d\uff0c\u54c8\u5e0c\u503c\u4ece 0 \u5230 21474835\uff080.5\uff05\uff09\u5bf9\u5e94 <code>$variant</code> \u53d8\u91cf\u7684\u503c\u4e3a <code>.one</code>\uff0c\u54c8\u5e0c\u503c\u4ece 21474836 \u5230 107374180\uff082\uff05\uff09\u5bf9\u5e94\u7684\u503c\u4e3a <code>.two</code>\uff0c\u54c8\u5e0c\u503c\u4ece 107374181 \u5230 4294967295 \u5bf9\u5e94\u503c\u4e3a <code>\"\"</code>\uff08\u7a7a\u5b57\u7b26\u4e32\uff09\u3002</p>"},{"location":"Modules-reference/http/ngx_http_split_clients_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_split_clients_module.html</p>"},{"location":"Modules-reference/http/ngx_http_ssi_module/","title":"ngx_http_ssi_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>ssi</li> <li>ssi_last_modified</li> <li>ssi_min_file_chunk</li> <li>ssi_silent_errors</li> <li>ssi_types</li> <li>ssi_value_length</li> </ul> </li> <li>SSI \u547d\u4ee4</li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_http_ssi_module</code> \u6a21\u5757\u662f\u4e00\u4e2a\u8fc7\u6ee4\u5668\uff0c\u5728\u7ecf\u8fc7\u5b83\u7684\u54cd\u5e94\u4e2d\u5904\u7406 SSI\uff08\u670d\u52a1\u5668\u7aef\u5305\u542b\uff09\u547d\u4ee4\u3002\u76ee\u524d\uff0c\u652f\u6301\u7684 SSI \u547d\u4ee4\u5217\u8868\u5e76\u4e0d\u5b8c\u6574\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_ssi_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location / {\nssi on;\n...\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_ssi_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_ssi_module/#ssi","title":"ssi","text":"- \u8bf4\u660e \u8bed\u6cd5 ssi <code>on</code> | <code>off</code>; \u9ed8\u8ba4 ssi off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location\u3001location \u4e2d\u7684 if <p>\u542f\u7528\u6216\u7981\u7528\u5904\u7406\u54cd\u5e94\u4e2d\u7684 SSI \u547d\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssi_module/#ssi_last_modified","title":"ssi_last_modified","text":"- \u8bf4\u660e \u8bed\u6cd5 ssi_last_modified <code>on</code> | <code>off</code>; \u9ed8\u8ba4 ssi_last_modified off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.1 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5141\u8bb8\u5728 SSI \u5904\u7406\u671f\u95f4\u4fdd\u7559\u539f\u59cb\u54cd\u5e94\u4e2d\u7684 Last-Modified \u5934\u5b57\u6bb5\uff0c\u4ee5\u4fbf\u4e8e\u54cd\u5e94\u7f13\u5b58\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728\u5904\u7406\u8fc7\u7a0b\u4e2d\u4fee\u6539\u54cd\u5e94\u5185\u5bb9\u65f6\u4f1a\u5220\u9664\u5934\u5b57\u6bb5\uff0c\u5e76\u4e14\u53ef\u80fd\u5305\u542b\u52a8\u6001\u751f\u6210\u7684\u5143\u7d20\u6216\u4e0e\u539f\u59cb\u54cd\u5e94\u65e0\u5173\u7684\u90e8\u5206\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssi_module/#ssi_min_file_chunk","title":"ssi_min_file_chunk","text":"- \u8bf4\u660e \u8bed\u6cd5 ssi_min_file_chunk <code>size</code>; \u9ed8\u8ba4 ssi_min_file_chunk 1k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u54cd\u5e94\u5b58\u50a8\u5728\u78c1\u76d8\u4e0a\u7684\u90e8\u5206\u7684\u6700\u5c0f\u5927\u5c0f\uff08<code>size</code>\uff09\uff0c\u4ece\u4f7f\u7528 sendfile \u53d1\u9001\u5b83\u4eec\u8d77\u751f\u6548\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssi_module/#ssi_silent_errors","title":"ssi_silent_errors","text":"- \u8bf4\u660e \u8bed\u6cd5 ssi_silent_errors <code>on</code> | <code>off</code>; \u9ed8\u8ba4 ssi_silent_errors off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5982\u679c\u542f\u7528\uff0c\u5219\u5728 SSI \u5904\u7406\u671f\u95f4\u53d1\u751f\u9519\u8bef\u65f6\uff0c\u7981\u6b62\u8f93\u51fa <code>[an error occurred while processing the directive]</code> \u5b57\u7b26\u4e32\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssi_module/#ssi_types","title":"ssi_types","text":"- \u8bf4\u660e \u8bed\u6cd5 ssi_types <code>mime-type ...</code>; \u9ed8\u8ba4 ssi_types text/html; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u9664\u4e86 text/html \u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u6307\u5b9a\u5728\u5176\u4ed6 MIME \u7c7b\u578b\u7684\u54cd\u5e94\u4e2d\u5904\u7406 SSI \u547d\u4ee4\u3002\u7279\u6b8a\u503c <code>*</code> \u5339\u914d\u4efb\u4f55 MIME \u7c7b\u578b\uff080.8.29\uff09\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssi_module/#ssi_value_length","title":"ssi_value_length","text":"- \u8bf4\u660e \u8bed\u6cd5 ssi_value_length <code>length</code>; \u9ed8\u8ba4 ssi_value_length 256; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e SSI \u547d\u4ee4\u4e2d\u53c2\u6570\u503c\u7684\u6700\u5927\u957f\u5ea6\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_ssi_module/#ssi_1","title":"SSI \u547d\u4ee4","text":"<p>SSI \u547d\u4ee4\u7684\u901a\u7528\u683c\u5f0f\uff1a</p> <pre><code>&lt;!--# command parameter1=value1 parameter2=value2 ... --&gt;\n</code></pre> <p>\u652f\u6301\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <ul> <li> <p><code>block</code></p> <p>\u5b9a\u4e49\u4e00\u4e2a\u53ef\u5728 <code>include</code> \u547d\u4ee4\u4e2d\u7528\u4f5c\u5b58\u6839\u7684\u5757\u3002\u8be5\u5757\u53ef\u4ee5\u5305\u542b\u5176\u4ed6 SSI \u547d\u4ee4\u3002\u8be5\u547d\u4ee4\u6709\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <ul> <li> <p><code>name</code></p> <p>\u5757\u540d\u79f0</p> </li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>&lt;!--# block name=\"one\" --&gt;\nstub\n&lt;!--# endblock --&gt;\n</code></pre> </li> <li> <p><code>config</code></p> <p>\u8bbe\u7f6eSSI\u5904\u7406\u671f\u95f4\u4f7f\u7528\u7684\u4e00\u4e9b\u53c2\u6570\uff0c\u5373\uff1a</p> <ul> <li> <p><code>errmsg</code></p> <p>\u5728 SSI \u5904\u7406\u671f\u95f4\u53d1\u751f\u9519\u8bef\u65f6\u8f93\u51fa\u7684\u5b57\u7b26\u4e32\u3002\u9ed8\u8ba4\u8f93\u51fa\u4ee5\u4e0b\u5b57\u7b26\u4e32\uff1a</p> <pre><code>[an error occurred while processing the directive]\n</code></pre> </li> <li> <p><code>timefmt</code></p> <p>\u4f20\u9012\u7ed9 <code>strftime()</code> \u51fd\u6570\u7684\u683c\u5f0f\u5316\u5b57\u7b26\u4e32\uff0c\u7528\u4e8e\u8f93\u51fa\u65e5\u671f\u548c\u65f6\u95f4\u3002\u9ed8\u8ba4\u4e3a\u4ee5\u4e0b\u683c\u5f0f\uff1a</p> <pre><code>\"%A, %d-%b-%Y %H:%M:%S %Z\"\n</code></pre> <p><code>\uff05s</code> \u683c\u5f0f\u9002\u5408\u4ee5\u79d2\u4e3a\u5355\u4f4d\u8f93\u51fa\u65f6\u95f4\u3002</p> </li> </ul> </li> <li> <p><code>echo</code></p> <p>\u8f93\u51fa\u4e00\u4e2a\u53d8\u91cf\u7684\u503c\u3002\u8be5\u547d\u4ee4\u6709\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <ul> <li> <p><code>var</code></p> <p>\u53d8\u91cf\u540d</p> </li> <li> <p><code>encoding</code></p> <p>\u7f16\u7801\u65b9\u5f0f\u3002\u53ef\u80fd\u7684\u503c\u5305\u62ec <code>none</code>\u3001<code>url</code> \u548c <code>entity</code>\u3002\u9ed8\u8ba4\u4f7f\u7528 <code>entity</code>\u3002</p> </li> <li> <p><code>default</code></p> <p>\u4e00\u4e2a\u975e\u6807\u51c6\u53c2\u6570\uff0c\u5982\u679c\u53d8\u91cf\u672a\u5b9a\u4e49\uff0c\u5219\u8f93\u51fa\u8bbe\u7f6e\u7684\u9ed8\u8ba4\u5b57\u7b26\u4e32\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8f93\u51fa <code>(none)</code>\u3002</p> <pre><code>&lt;!--# echo var=\"name\" default=\"no\" --&gt;\n</code></pre> <p>\u4ee5\u4e0a\u547d\u4ee4\u5c06\u66ff\u6362\u6210\u4ee5\u4e0b\u547d\u4ee4\u5e8f\u5217\uff1a</p> <pre><code>&lt;!--# if expr=\"$name\" --&gt;&lt;!--# echo var=\"name\" --&gt;&lt;!--#\nelse --&gt;no&lt;!--# endif --&gt;\n</code></pre> </li> </ul> </li> <li> <p><code>if</code></p> <p>\u6267\u884c\u6761\u4ef6\u5305\u542b\u3002\u652f\u6301\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>&lt;!--# if expr=\"...\" --&gt;\n...\n&lt;!--# elif expr=\"...\" --&gt;\n...\n&lt;!--# else --&gt;\n...\n&lt;!--# endif --&gt;\n</code></pre> <p>\u76ee\u524d\u4ec5\u652f\u6301\u4e00\u7ea7\u5d4c\u5957\u3002\u8be5\u547d\u4ee4\u6709\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <ul> <li> <p><code>expr</code></p> <p>\u8868\u8fbe\u5f0f\u3002\u4e00\u4e2a\u8868\u8fbe\u5f0f\u53ef\u4ee5\u662f\uff1a</p> <ul> <li> <p>\u53d8\u91cf\u5b58\u5728\u68c0\u67e5\uff1a</p> <pre><code>&lt;!--# if expr=\"$name\" --&gt;\n</code></pre> </li> <li> <p>\u53d8\u91cf\u4e0e\u6587\u672c\u6bd4\u8f83\uff1a</p> <pre><code>&lt;!--# if expr=\"$name = text\" --&gt;\n&lt;!--# if expr=\"$name != text\" --&gt;\n</code></pre> </li> <li> <p>\u53d8\u91cf\u4e0e\u6b63\u5219\u8868\u8fbe\u5f0f\u6bd4\u8f83\uff1a</p> <pre><code>&lt;!--# if expr=\"$name = /text/\" --&gt;\n&lt;!--# if expr=\"$name != /text/\" --&gt;\n</code></pre> </li> </ul> <p>\u5982\u679c\u4e00\u4e2a <code>text</code> \u5305\u542b\u53d8\u91cf\uff0c\u5219\u66ff\u6362\u5b83\u4eec\u7684\u503c\u3002\u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\u53ef\u4ee5\u5305\u542b\u4f4d\u7f6e\u548c\u547d\u540d\u6355\u83b7\uff0c\u4e4b\u540e\u53ef\u901a\u8fc7\u53d8\u91cf\u5f15\u7528\u4f7f\u7528\uff0c\u4f8b\u5982\uff1a</p> <pre><code>&lt;!--# if expr=\"$name = /(.+)@(?P&lt;domain&gt;.+)/\" --&gt;\n    &lt;!--# echo var=\"1\" --&gt;\n    &lt;!--# echo var=\"domain\" --&gt;\n&lt;!--# endif --&gt;\n</code></pre> </li> </ul> </li> <li> <p><code>include</code></p> <p>\u5c06\u53e6\u4e00\u4e2a\u8bf7\u6c42\u7684\u7ed3\u679c\u5305\u542b\u5230\u4e00\u4e2a\u54cd\u5e94\u4e2d\u3002\u8be5\u547d\u4ee4\u6709\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <ul> <li> <p><code>file</code></p> <p>\u6307\u5b9a\u4e00\u4e2a\u5305\u542b\u7684\u6587\u4ef6\uff0c\u4f8b\u5982\uff1a</p> <pre><code>&lt;!--# include file=\"footer.html\" --&gt;\n</code></pre> </li> <li> <p><code>virtual</code></p> <p>\u6307\u5b9a\u4e00\u4e2a\u5305\u542b\u7684\u8bf7\u6c42\uff0c\u4f8b\u5982\uff1a</p> <pre><code>&lt;!--# include virtual=\"/remote/body.php?argument=value\" --&gt;\n</code></pre> <p>\u6307\u5b9a\u5728\u4e00\u4e2a\u9875\u9762\u4e0a\u5e76\u7531\u4ee3\u7406\u6216 FastCGI/uwsgi/SCGI/gRPC \u670d\u52a1\u5668\u5904\u7406\u7684\u591a\u4e2a\u8bf7\u6c42\u5e76\u884c\u8fd0\u884c\u3002\u5982\u679c\u9700\u8981\u987a\u5e8f\u5904\u7406\uff0c\u5219\u5e94\u4f7f\u7528 <code>wait</code> \u53c2\u6570\u3002</p> </li> <li> <p><code>stub</code></p> <p>\u4e00\u4e2a\u975e\u6807\u51c6\u53c2\u6570\uff0c\u7528\u4e8e\u547d\u540d\u5757\uff0c\u5982\u679c\u8be5\u5757\u5305\u542b\u7684\u8bf7\u6c42\u5bfc\u81f4\u7a7a\u8bf7\u6c42\u4f53\u6216\u5728\u8bf7\u6c42\u5904\u7406\u671f\u95f4\u53d1\u751f\u9519\u8bef\uff0c\u5219\u5c06\u8f93\u51fa\u5176\u5185\u5bb9\uff0c\u4f8b\u5982\uff1a</p> <pre><code>&lt;!--# block name=\"one\" --&gt;&amp;nbsp;&lt;!--# endblock --&gt;\n&lt;!--# include virtual=\"/remote/body.php?argument=value\" stub=\"one\" --&gt;\n</code></pre> <p>\u5728\u5305\u542b\u7684\u8bf7\u6c42\u4e0a\u4e0b\u6587\u4e2d\u5904\u7406\u66ff\u6362\u5757\u5185\u5bb9\u3002</p> </li> <li> <p><code>wait</code></p> <p>\u4e00\u4e2a\u975e\u6807\u51c6\u53c2\u6570\uff0c\u5728\u7ee7\u7eed\u8fdb\u884c SSI \u5904\u7406\u4e4b\u524d\u7b49\u5f85\u8bf7\u6c42\u5b8c\u5168\u5b8c\u6210\uff0c\u4f8b\u5982\uff1a</p> <pre><code>&lt;!--# include virtual=\"/remote/body.php?argument=value\" wait=\"yes\" --&gt;\n</code></pre> </li> <li> <p><code>set</code></p> <p>\u4e00\u4e2a\u975e\u6807\u51c6\u53c2\u6570\uff0c\u5c06\u8bf7\u6c42\u5904\u7406\u7684\u6210\u529f\u7ed3\u679c\u5199\u5165\u6307\u5b9a\u53d8\u91cf\uff0c\u4f8b\u5982\uff1a</p> <pre><code>&lt;!--# include virtual=\"/remote/body.php?argument=value\" set=\"one\" --&gt;\n</code></pre> <p>\u54cd\u5e94\u7684\u6700\u5927\u5927\u5c0f\u7531 subrequest_output_buffer_size \u6307\u4ee4\uff081.13.10\uff09\u8bbe\u7f6e\uff1a</p> <pre><code>location /remote/ {\n    subrequest_output_buffer_size 64k;\n    ...\n}\n</code></pre> <p>\u5728 1.13.10 \u7248\u4e4b\u524d\uff0c\u53ea\u6709\u4f7f\u7528 ngx_http_proxy_module\u3001ngx_http_memcached_module\u3001ngx_http_fastcgi_module\uff081.5.6\uff09\u3001ngx_http_uwsgi_module\uff081.5.6\uff09\u548c ngx_http_scgi_module\uff081.5.6\uff09\u6a21\u5757\u83b7\u5f97\u7684\u54cd\u5e94\u7ed3\u679c\u624d\u80fd\u5199\u5165\u53d8\u91cf\u3002\u54cd\u5e94\u7684\u6700\u5927\u5927\u5c0f\u662f\u4f7f\u7528 proxy_buffer_size\u3001memcached_buffer_size\u3001fastcgi_buffer_size\u3001uwsgi_buffer_size \u548c scgi_buffer_size \u6307\u4ee4\u8bbe\u7f6e\u7684\u3002</p> </li> </ul> </li> <li> <p><code>set</code></p> <p>\u8bbe\u7f6e\u53d8\u91cf\u7684\u503c\u3002\u8be5\u547d\u4ee4\u6709\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <ul> <li> <p><code>var</code></p> <p>\u53d8\u91cf\u540d</p> </li> <li> <p><code>value</code></p> <p>\u53d8\u91cf\u503c\u3002\u5982\u679c\u6307\u5b9a\u7684\u503c\u5305\u542b\u53d8\u91cf\uff0c\u5219\u66ff\u6362\u5b83\u4eec\u7684\u503c\u3002</p> </li> </ul> </li> </ul> <p></p>"},{"location":"Modules-reference/http/ngx_http_ssi_module/#_3","title":"\u5185\u5d4c\u53d8\u91cf","text":"<p><code>ngx_http_ssi_module</code> \u6a21\u5757\u652f\u6301\u4e24\u4e2a\u5185\u5d4c\u53d8\u91cf\uff1a</p> <ul> <li> <p><code>$date_local</code></p> <p>\u5f53\u5730\u65f6\u533a\u7684\u5f53\u524d\u65f6\u95f4\u3002\u8be5\u683c\u5f0f\u7531 <code>config</code> \u547d\u4ee4\u548c <code>timefmt</code> \u53c2\u6570\u8bbe\u7f6e\u3002</p> </li> <li> <p><code>$date_gmt</code></p> <p>\u683c\u6797\u5a01\u6cbb\u6807\u51c6\u65f6\u95f4\u5f62\u5f0f\u7684\u5f53\u524d\u65f6\u95f4\uff0c\u8be5\u683c\u5f0f\u7531 <code>config</code> \u547d\u4ee4\u548c <code>timefmt</code> \u53c2\u6570\u8bbe\u7f6e\u3002</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_ssi_module/#_4","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/http/ngx_http_ssi_module.html</li> </ul>"},{"location":"Modules-reference/http/ngx_http_ssl_module/","title":"ngx_http_ssi_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>ssl</li> <li>ssl_buffer_size</li> <li>ssl_certificate</li> <li>ssl_certificate_key</li> <li>ssl_ciphers</li> <li>ssl_client_certificate</li> <li>ssl_crl</li> <li>ssl_dhparam</li> <li>ssl_early_data</li> <li>ssl_ecdh_curve</li> <li>ssl_password_file</li> <li>ssl_prefer_server_ciphers</li> <li>ssl_protocols</li> <li>ssl_session_cache</li> <li>ssl_session_ticket_key</li> <li>ssl_session_tickets</li> <li>ssl_session_timeout</li> <li>ssl_stapling</li> <li>ssl_stapling_file</li> <li>ssl_stapling_responder</li> <li>ssl_stapling_verify</li> <li>ssl_trusted_certificate</li> <li>ssl_verify_client</li> <li>ssl_verify_depth</li> </ul> </li> <li>\u9519\u8bef\u5904\u7406</li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_http_ssl_module</code> \u6a21\u5757\u4e3a HTTPS \u63d0\u4f9b\u5fc5\u8981\u7684\u652f\u6301\u3002</p> <p>\u9ed8\u8ba4\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\uff0c\u5728\u6784\u5efa\u65f6\u53ef\u4f7f\u7528 <code>--with-http_ssl_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p>\u8be5\u6a21\u5757\u4f9d\u8d56 OpenSSL \u5e93\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<p>\u4e3a\u51cf\u5c11 CPU \u7684\u8d1f\u8f7d\uff0c\u5efa\u8bae</p> <ul> <li>\u8bbe\u7f6e worker \u8fdb\u7a0b\u6570\u7b49\u4e8e CPU \u6838\u5fc3\u6570</li> <li>\u542f\u7528 keep-alive \u8fde\u63a5</li> <li>\u542f\u7528\u5171\u4eab\u4f1a\u8bdd\u7f13\u5b58</li> <li>\u7981\u7528\u5185\u7f6e\u4f1a\u8bdd\u7f13\u5b58</li> <li>\u53ef\u589e\u957f\u4f1a\u8bdd\u751f\u547d\u5468\u671f\uff08\u9ed8\u8ba4\u4e3a 5 \u5206\u949f\uff09</li> </ul> <pre><code>worker_processes auto;\n\nhttp {\n\n...\n\nserver {\nlisten              443 ssl;\nkeepalive_timeout   70;\n\nssl_protocols       TLSv1 TLSv1.1 TLSv1.2;\nssl_ciphers         AES128-SHA:AES256-SHA:RC4-SHA:DES-CBC3-SHA:RC4-MD5;\nssl_certificate     /usr/local/nginx/conf/cert.pem;\nssl_certificate_key /usr/local/nginx/conf/cert.key;\nssl_session_cache   shared:SSL:10m;\nssl_session_timeout 10m;\n\n...\n}\n</code></pre> <p></p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl","title":"ssl","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl <code>on</code> | <code>off</code>; \u9ed8\u8ba4 ssi off; \u4e0a\u4e0b\u6587 http\u3001server <p>\u8be5\u6307\u4ee4\u5728 1.15.0 \u7248\u672c\u4e2d\u5df2\u8fc7\u65f6\u3002\u5e94\u4f7f\u7528 listen \u6307\u4ee4\u7684 <code>ssl</code> \u53c2\u6570\u8bbe\u7f6e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_buffer_size","title":"ssl_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_buffer_size <code>size</code>; \u9ed8\u8ba4 ssl_buffer_size 16k; \u4e0a\u4e0b\u6587 http\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.9 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u53d1\u9001\u6570\u636e\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u3002</p> <p>\u7f13\u51b2\u533a\u9ed8\u8ba4\u5927\u5c0f\u4e3a 16k\uff0c\u5bf9\u5e94\u53d1\u9001\u5927\u54cd\u5e94\u65f6\u7684\u6700\u5c0f\u5f00\u9500\u3002\u8981\u5c06\u9996\u5b57\u8282\u65f6\u95f4\uff08TTFB\uff0cTime To First Byte\uff09\u51cf\u5230\u6700\u5c0f\uff0c\u8bbe\u7f6e\u8f83\u5c0f\u7684\u503c\u53ef\u80fd\u4f1a\u6709\u4e0d\u9519\u7684\u6548\u679c\uff0c\u5982\uff1a</p> <pre><code>ssl_buffer_size 4k;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_certificate","title":"ssl_certificate","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_certificate <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server <p>\u6307\u5b9a\u4e00\u4e2a\u6709\u7ed9\u5b9a\u865a\u62df\u670d\u52a1\u5668\u7684 PEM \u8bc1\u4e66\u6587\u4ef6\uff08<code>file</code>\uff09\u3002\u5982\u679c\u9664\u4e86\u4e3b\u8bc1\u4e66\u4e4b\u5916\u8fd8\u8981\u6307\u5b9a\u4e2d\u7ea7\u8bc1\u4e66\uff0c\u5219\u5e94\u6309\u4ee5\u4e0b\u987a\u5e8f\u5728\u540c\u4e00\u6587\u4ef6\u4e2d\u6307\u5b9a\u5b83\u4eec\uff1a\u9996\u5148\u662f\u4e3b\u8bc1\u4e66\uff0c\u7136\u540e\u662f\u4e2d\u7ea7\u8bc1\u4e66\u3002PEM \u683c\u5f0f\u7684\u5bc6\u94a5\u53ef\u4ee5\u653e\u5728\u540c\u4e00\u6587\u4ef6\u4e2d\u3002</p> <p>\u4ece 1.11.0 \u7248\u672c\u5f00\u59cb\uff0c\u53ef\u4ee5\u591a\u6b21\u6307\u5b9a\u6b64\u6307\u4ee4\u4ee5\u52a0\u8f7d\u4e0d\u540c\u7c7b\u578b\u7684\u8bc1\u4e66\uff0c\u4f8b\u5982\uff0cRSA \u548c ECDSA\uff1a</p> <pre><code>server {\nlisten              443 ssl;\nserver_name         example.com;\n\nssl_certificate     example.com.rsa.crt;\nssl_certificate_key example.com.rsa.key;\n\nssl_certificate     example.com.ecdsa.crt;\nssl_certificate_key example.com.ecdsa.key;\n\n...\n}\n</code></pre> <p>\u53ea\u6709 OpenSSL 1.0.2 \u6216\u66f4\u9ad8\u7248\u672c\u624d\u652f\u6301\u4e0d\u540c\u8bc1\u4e66\u7684\u72ec\u7acb\u8bc1\u4e66\u94fe\u3002\u5bf9\u4e8e\u65e7\u7248\u672c\uff0c\u53ea\u80fd\u4f7f\u7528\u4e00\u4e2a\u8bc1\u4e66\u94fe\u3002</p> <p>\u4ece 1.15.9 \u7248\u672c\u5f00\u59cb\uff0c\u4f7f\u7528 OpenSSL 1.0.2 \u6216\u66f4\u9ad8\u7248\u672c\u65f6\uff0c\u53ef\u5728 <code>file</code> \u6587\u4ef6\u540d\u4e2d\u4f7f\u7528\u53d8\u91cf\uff1a</p> <pre><code>ssl_certificate     $ssl_server_name.crt;\nssl_certificate_key $ssl_server_name.key;\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u4f7f\u7528\u53d8\u91cf\u610f\u5473\u7740\u6bcf\u6b21 SSL \u63e1\u624b\u90fd\u4f1a\u52a0\u8f7d\u8bc1\u4e66\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bf9\u6027\u80fd\u4ea7\u751f\u8d1f\u9762\u5f71\u54cd\u3002</p> <p>\u53ef\u4ee5\u6307\u5b9a\u503c <code>data:$variable</code> \u6765\u4ee3\u66ff <code>file</code>\uff081.15.10\uff09\uff0c\u8bc1\u4e66\u5c06\u4ece\u53d8\u91cf\u4e2d\u52a0\u8f7d\u800c\u4e0d\u4f7f\u7528\u4e2d\u95f4\u6587\u4ef6\u3002\u8bf7\u6ce8\u610f\uff0c\u4e0d\u6070\u5f53\u5730\u4f7f\u7528\u6b64\u8bed\u6cd5\u53ef\u80fd\u4f1a\u4ea7\u751f\u5b89\u5168\u9690\u60a3\uff0c\u4f8b\u5982\u5c06\u5bc6\u94a5\u6570\u636e\u5199\u5165\u9519\u8bef\u65e5\u5fd7\u3002</p> <p>\u8bb0\u4f4f\uff0c\u7531\u4e8e HTTPS \u534f\u8bae\u5bf9\u6700\u5927\u4e92\u64cd\u4f5c\u6027\u7684\u9650\u5236\uff0c\u865a\u62df\u670d\u52a1\u5668\u5e94\u76d1\u542c\u4e0d\u540c\u7684 IP \u5730\u5740\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_certificate_key","title":"ssl_certificate_key","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_certificate_key <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server <p>\u6307\u5b9a\u6709\u7ed9\u5b9a\u865a\u62df\u670d\u52a1\u5668\u7684 PEM \u5bc6\u94a5\u6587\u4ef6\u3002</p> <p>\u53ef\u4ee5\u6307\u5b9a\u503c <code>engine:name:id</code> \u6765\u4ee3\u66ff\u662f <code>file</code>\uff081.7.9\uff09\uff0c\u4ece OpenSSL \u5f15\u64ce <code>name</code> \u52a0\u8f7d\u6709\u6307\u5b9a <code>id</code> \u7684\u5bc6\u94a5\u3002</p> <p>\u53ef\u4ee5\u6307\u5b9a\u503c <code>data:$variable</code> \u66ff\u4ee3 <code>file</code>\uff081.15.10\uff09\uff0c\u5c06\u4ece\u53d8\u91cf\u52a0\u8f7d\u5bc6\u94a5\u800c\u4e0d\u4f7f\u7528\u4e2d\u95f4\u6587\u4ef6\u3002\u8bf7\u6ce8\u610f\uff0c\u4e0d\u6070\u5f53\u5730\u4f7f\u7528\u6b64\u8bed\u6cd5\u53ef\u80fd\u4f1a\u4ea7\u751f\u5b89\u5168\u9690\u60a3\uff0c\u4f8b\u5982\u5c06\u5bc6\u94a5\u6570\u636e\u5199\u5165\u9519\u8bef\u65e5\u5fd7\u3002</p> <p>\u4ece 1.15.9 \u7248\u672c\u5f00\u59cb\uff0c\u4f7f\u7528 OpenSSL 1.0.2 \u6216\u66f4\u9ad8\u7248\u672c\u65f6\uff0c\u53ef\u5728 <code>file</code> \u6587\u4ef6\u540d\u4e2d\u4f7f\u7528\u53d8\u91cf\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_ciphers","title":"ssl_ciphers","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_ciphers <code>ciphers</code>; \u9ed8\u8ba4 ssl_ciphers HIGH:!aNULL:!MD5; \u4e0a\u4e0b\u6587 http\u3001server <p>\u6307\u5b9a\u542f\u7528\u7684\u5bc6\u7801\u3002\u5bc6\u7801\u4ee5 OpenSSL \u5e93\u652f\u6301\u7684\u683c\u5f0f\u6307\u5b9a\uff0c\u4f8b\u5982\uff1a</p> <pre><code>ssl_ciphers ALL:!aNULL:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;\n</code></pre> <p>\u53ef\u4ee5\u4f7f\u7528 <code>openssl ciphers</code> \u547d\u4ee4\u67e5\u770b\u5b8c\u6574\u5217\u8868\u3002</p> <p>\u4ee5\u524d\u7248\u672c\u7684 nginx \u9ed8\u8ba4\u4f7f\u7528\u4e86\u4e0d\u540c\u7684\u5bc6\u7801\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_client_certificate","title":"ssl_client_certificate","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_client_certificate <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server <p>\u5982\u679c\u542f\u7528\u4e86 ssl_stapling\uff0c\u5219\u6307\u5b9a\u4e00\u4e2a\u6709\u53ef\u4fe1 CA \u7684 PEM \u8bc1\u4e66\u6587\u4ef6\uff0c\u8be5\u8bc1\u4e66\u7528\u4e8e\u9a8c\u8bc1\u5ba2\u6237\u7aef\u8bc1\u4e66\u548c OCSP \u54cd\u5e94\u3002</p> <p>\u8bc1\u4e66\u5217\u8868\u5c06\u88ab\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u3002\u5982\u679c\u4e0d\u9700\u8981\uff0c\u53ef\u4ee5\u4f7f\u7528 ssl_trusted_certificate \u6307\u4ee4\u8bbe\u7f6e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_crl","title":"ssl_crl","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_crl <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.8.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a PEM \u683c\u5f0f\u7684\u5df2\u540a\u9500\u8bc1\u4e66\uff08CRL\uff09\u6587\u4ef6\uff08<code>file</code>\uff09\uff0c\u7528\u4e8e\u9a8c\u8bc1\u5ba2\u6237\u7aef\u8bc1\u4e66\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_dhparam","title":"ssl_dhparam","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_dhparam <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.7.2 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u4e3a DHE \u5bc6\u7801\u6307\u5b9a DH \u53c2\u6570\u6587\u4ef6\u3002</p> <p>\u9ed8\u8ba4\u4e0d\u8bbe\u7f6e\u4efb\u4f55\u53c2\u6570\uff0c\u56e0\u6b64\u4e0d\u4f1a\u4f7f\u7528 DHE \u5bc6\u7801\u3002</p> <p>\u5728 1.11.0 \u7248\u4e4b\u524d\uff0c\u9ed8\u8ba4\u4f7f\u7528\u5185\u7f6e\u53c2\u6570\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_early_data","title":"ssl_early_data","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_early_data <code>on</code> | <code>off</code>; \u9ed8\u8ba4 ssl_early_data off; \u4e0a\u4e0b\u6587 http\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.15.3 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u6216\u7981\u7528 TLS 1.3 Early data\u3002</p> <p>\u5e26\u6709 Early data \u7684\u8bf7\u6c42\u5c06\u53d7\u5230\u91cd\u653e\u653b\u51fb\u3002\u4e3a\u4e86\u9632\u6b62\u5e94\u7528\u5c42\u53d7\u5230\u6b64\u7c7b\u653b\u51fb\uff0c\u5e94\u4f7f\u7528 $ssl_early_data \u53d8\u91cf\u907f\u514d\u3002</p> <pre><code>proxy_set_header Early-Data $ssl_early_data;\n</code></pre> <p>BoringSSL\u3001OpenSSL 1.1.1 \u6216\u66f4\u9ad8\u7248\u672c\uff081.15.4\uff09\u652f\u6301\u8be5\u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_ecdh_curve","title":"ssl_ecdh_curve","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_ecdh_curve <code>curve</code>; \u9ed8\u8ba4 ssl_ecdh_curve auto; \u4e0a\u4e0b\u6587 http\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.0 \u548c 1.0.6 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a ECDHE \u5bc6\u7801\u7684 <code>curve</code>\u3002</p> <p>\u4f7f\u7528 OpenSSL 1.0.2 \u6216\u66f4\u9ad8\u7248\u672c\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a curve\uff081.11.0\uff09\uff0c\u4f8b\u5982\uff1a</p> <pre><code>ssl_ecdh_curve prime256v1:secp384r1;\n</code></pre> <p>\u7279\u6b8a\u503c <code>auto</code>\uff081.11.0\uff09\u6307\u793a nginx \u5728\u4f7f\u7528 OpenSSL 1.0.2 \u6216\u66f4\u9ad8\u7248\u672c\u65f6\u4f7f\u7528\u5185\u7f6e\u5728 OpenSSL \u5e93\u4e2d\u7684\u5217\u8868\uff0c\u6216\u8005\u4f7f\u7528\u65e7\u7248\u672c\u7684 prime256v1\u3002</p> <p>\u5728 1.11.0 \u7248\u672c\u4e4b\u524d\uff0c\u9ed8\u8ba4\u4f7f\u7528 <code>prime256v1</code> curve\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_password_file","title":"ssl_password_file","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_password_file <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.3 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u4e00\u4e2a\u6709\u5bc6\u94a5\u7684\u6587\u4ef6\uff08<code>file</code>\uff09\uff0c\u6bcf\u4e2a\u5bc6\u7801\u6309\u884c\u6307\u5b9a\u3002\u5728\u52a0\u8f7d\u5bc6\u94a5\u65f6\u4f9d\u6b21\u5c1d\u8bd5\u3002</p> <p>\u4f8b\uff1a</p> <pre><code>http {\nssl_password_file /etc/keys/global.pass;\n...\n\nserver {\nserver_name www1.example.com;\nssl_certificate_key /etc/keys/first.key;\n}\n\nserver {\nserver_name www2.example.com;\n\n# named pipe can also be used instead of a file\nssl_password_file /etc/keys/fifo;\nssl_certificate_key /etc/keys/second.key;\n}\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_prefer_server_ciphers","title":"ssl_prefer_server_ciphers","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_prefer_server_ciphers <code>on</code> | <code>off</code>; \u9ed8\u8ba4 ssl_prefer_server_ciphers off; \u4e0a\u4e0b\u6587 http\u3001server <p>\u6307\u5b9a\u5728\u4f7f\u7528 SSLv3 \u548c TLS \u534f\u8bae\u65f6\uff0c\u670d\u52a1\u5668\u5bc6\u7801\u5e94\u4f18\u5148\u4e8e\u5ba2\u6237\u7aef\u5bc6\u7801\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_protocols","title":"ssl_protocols","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_protocols <code>[SSLv2] [SSLv3] [TLSv1] [TLSv1.1] [TLSv1.2] [TLSv1.3]</code>; \u9ed8\u8ba4 ssl_protocols TLSv1 TLSv1.1 TLSv1.2; \u4e0a\u4e0b\u6587 http\u3001server <p>\u542f\u7528\u6307\u5b9a\u7684\u534f\u8bae\u3002</p> <p>TLSv1.1 \u548c TLSv1.2 \u53c2\u6570\uff081.1.13\u30011.0.12\uff09\u4ec5\u5728\u4f7f\u7528 OpenSSL 1.0.1 \u6216\u66f4\u9ad8\u7248\u672c\u65f6\u6709\u6548\u3002</p> <p>\u4ec5\u5f53\u4f7f\u7528 TLSv1.3 \u652f\u6301\u6784\u5efa\u7684 OpenSSL 1.1.1 \u65f6\uff0cTLSv1.3 \u53c2\u6570\uff081.13.0\uff09\u624d\u6709\u6548\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_session_cache","title":"ssl_session_cache","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_session_cache <code>off \\| none \\| [builtin[:size]] [shared:name:size]</code>; \u9ed8\u8ba4 ssl_session_cache none; \u4e0a\u4e0b\u6587 http\u3001server <p>\u8bbe\u7f6e\u5b58\u50a8\u4f1a\u8bdd\u53c2\u6570\u7684\u7f13\u5b58\u7684\u7c7b\u578b\u548c\u5927\u5c0f\u3002\u7f13\u5b58\u53ef\u4ee5\u662f\u4ee5\u4e0b\u4efb\u4f55\u7c7b\u578b\uff1a</p> <ul> <li> <p><code>off</code></p> <p>\u5b8c\u5168\u7981\u6b62\u4f7f\u7528\u4f1a\u8bdd\u7f13\u5b58\uff1anginx \u660e\u786e\u544a\u8bc9\u5ba2\u6237\u7aef\u4f1a\u8bdd\u53ef\u80fd\u4e0d\u4f1a\u88ab\u91cd\u7528\u3002</p> </li> <li> <p><code>none</code></p> <p>\u8f7b\u5ea6\u7981\u6b62\u4f7f\u7528\u4f1a\u8bdd\u7f13\u5b58\uff1anginx \u544a\u8bc9\u5ba2\u6237\u7aef\u4f1a\u8bdd\u53ef\u4ee5\u91cd\u7528\uff0c\u4f46\u5b9e\u9645\u4e0a\u5e76\u4e0d\u4f1a\u5c06\u4f1a\u8bdd\u53c2\u6570\u5b58\u50a8\u5728\u7f13\u5b58\u4e2d\u3002</p> </li> <li> <p><code>builtin</code></p> <p>\u4e00\u4e2a\u7528 OpenSSL \u6784\u5efa\u7684\u7f13\u5b58\uff0c\u4ec5\u7531\u4e00\u4e2a worker \u8fdb\u7a0b\u4f7f\u7528\u3002\u7f13\u5b58\u5927\u5c0f\u5728\u4f1a\u8bdd\u4e2d\u6307\u5b9a\u3002\u5982\u679c\u672a\u6307\u5b9a\u5927\u5c0f\uff0c\u5219\u9ed8\u8ba4\u4e3a 20480 \u4e2a\u4f1a\u8bdd\u3002\u4f7f\u7528\u5185\u7f6e\u7f13\u5b58\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5185\u5b58\u788e\u7247\u3002</p> </li> <li> <p><code>shared</code></p> <p>\u6240\u6709 worker \u8fdb\u7a0b\u4e4b\u95f4\u5171\u4eab\u7684\u7f13\u5b58\u3002\u7f13\u5b58\u5927\u5c0f\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u6307\u5b9a\uff0c\u4e00\u5146\u5b57\u8282\u53ef\u4ee5\u5b58\u50a8\u5927\u7ea6 4000 \u4e2a\u4f1a\u8bdd\u3002\u6bcf\u4e2a\u5171\u4eab\u7f13\u5b58\u90fd\u5e94\u6709\u4e00\u4e2a\u4efb\u610f\u7684\u540d\u79f0\u3002\u53ef\u4ee5\u5728\u591a\u4e2a\u865a\u62df\u670d\u52a1\u5668\u4e2d\u4f7f\u7528\u6709\u76f8\u540c\u540d\u79f0\u7684\u7f13\u5b58\u3002</p> </li> </ul> <p>\u4e24\u79cd\u7f13\u5b58\u7c7b\u578b\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528\uff0c\u4f8b\u5982\uff1a</p> <pre><code>ssl_session_cache builtin:1000 shared:SSL:10m;\n</code></pre> <p>\u4f46\u53ea\u4f7f\u7528\u6ca1\u6709\u5185\u7f6e\u7f13\u5b58\u7684\u5171\u4eab\u7f13\u5b58\u4f1a\u66f4\u597d\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_session_ticket_key","title":"ssl_session_ticket_key","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_session_ticket_key <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u4e00\u4e2a\u7528\u4e8e\u52a0\u5bc6\u548c\u89e3\u5bc6 TLS \u4f1a\u8bdd ticket \u7684\u5bc6\u94a5\u6587\u4ef6\u3002\u5982\u679c\u5fc5\u987b\u5728\u591a\u4e2a\u670d\u52a1\u5668\u4e4b\u95f4\u5171\u4eab\u76f8\u540c\u7684\u5bc6\u94a5\uff0c\u5219\u8be5\u6307\u4ee4\u662f\u5fc5\u9700\u7684\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u968f\u673a\u751f\u6210\u7684\u5bc6\u94a5\u3002</p> <p>\u5982\u679c\u6307\u5b9a\u4e86\u591a\u4e2a\u5bc6\u94a5\uff0c\u5219\u4ec5\u4f7f\u7528\u7b2c\u4e00\u4e2a\u5bc6\u94a5\u6765\u52a0\u5bc6 TLS \u4f1a\u8bdd ticket\u3002\u5141\u8bb8\u914d\u7f6e\u79d8\u94a5\u8f6e\u8f6c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>ssl_session_ticket_key current.key;\nssl_session_ticket_key previous.key;\n</code></pre> <p>\u8be5\u6587\u4ef6\u5fc5\u987b\u5305\u542b 80 \u6216 48 \u4e2a\u5b57\u8282\u7684\u968f\u673a\u6570\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u521b\u5efa\uff1a</p> <pre><code>openssl rand 80 &gt; ticket.key\n</code></pre> <p>\u6839\u636e\u6587\u4ef6\u5927\u5c0f\uff0cAES256\uff08\u5bf9\u4e8e 80 \u5b57\u8282\u5bc6\u94a5\uff0c1.11.8\uff09\u6216 AES128\uff08\u5bf9\u4e8e 48 \u5b57\u8282\u5bc6\u94a5\uff09\u7528\u4e8e\u52a0\u5bc6\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_session_tickets","title":"ssl_session_tickets","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_session_tickets <code>on</code> | <code>off</code>; \u9ed8\u8ba4 ssl_session_tickets on; \u4e0a\u4e0b\u6587 http\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.9 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u901a\u8fc7 TLS \u4f1a\u8bdd ticket \u542f\u7528\u6216\u7981\u7528\u4f1a\u8bdd\u91cd\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_session_timeout","title":"ssl_session_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_session_timeout <code>time</code>; \u9ed8\u8ba4 ssl_session_timeout 5m; \u4e0a\u4e0b\u6587 http\u3001server <p>\u6307\u5b9a\u5ba2\u6237\u7aef\u53ef\u4ee5\u91cd\u7528\u4f1a\u8bdd\u53c2\u6570\u7684\u65f6\u95f4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_stapling","title":"ssl_stapling","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_stapling <code>on</code> | <code>off</code>; \u9ed8\u8ba4 ssl_stapling off; \u4e0a\u4e0b\u6587 http\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.3.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u6216\u7981\u7528\u670d\u52a1\u5668 OCSP stapling\uff1a</p> <pre><code>ssl_stapling on;\nresolver 192.0.2.1;\n</code></pre> <p>\u8981\u4f7f OCSP stapling \u8d77\u4f5c\u7528\uff0c\u5e94\u77e5\u9053\u670d\u52a1\u5668\u8bc1\u4e66\u9881\u53d1\u8005\u7684\u8bc1\u4e66\u3002\u5982\u679c ssl_certificate \u6587\u4ef6\u4e0d\u5305\u542b\u4e2d\u7ea7\u8bc1\u4e66\uff0c\u5219\u670d\u52a1\u5668\u8bc1\u4e66\u9881\u53d1\u8005\u7684\u8bc1\u4e66\u5e94\u5b58\u5728\u4e8e ssl_trusted_certificate \u6587\u4ef6\u4e2d\u3002</p> <p>\u8981\u89e3\u6790 OCSP \u54cd\u5e94\u5668\u4e3b\u673a\u540d\uff0c\u8fd8\u5e94\u6307\u5b9a resolver \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_stapling_file","title":"ssl_stapling_file","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_stapling_file <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.3.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u540e\uff0c\u5c06\u4ece\u6307\u5b9a\u7684\u6587\u4ef6\u4e2d\u83b7\u53d6 OCSP stapling \u54cd\u5e94\uff0c\u800c\u4e0d\u662f\u67e5\u8be2\u670d\u52a1\u5668\u8bc1\u4e66\u4e2d\u6307\u5b9a\u7684 OCSP \u54cd\u5e94\u5668\u3002</p> <p>\u8be5\u6587\u4ef6\u5e94\u4e3a DER \u683c\u5f0f\uff0c\u7531 <code>openssl ocsp</code> \u547d\u4ee4\u751f\u6210\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_stapling_responder","title":"ssl_stapling_responder","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_stapling_responder <code>url</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.3.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8986\u76d6 <code>Authority Information Access</code> \u8bc1\u4e66\u6269\u5c55\u4e2d\u6307\u5b9a\u7684 OCSP \u54cd\u5e94\u5668\u7684 URL\u3002</p> <p>\u4ec5\u652f\u6301 <code>http://</code> OCSP \u54cd\u5e94\u5668\uff08responder\uff09\uff1a</p> <pre><code>ssl_stapling_responder http://ocsp.example.com/;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_stapling_verify","title":"ssl_stapling_verify","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_stapling_verify <code>on</code> | <code>off</code>; \u9ed8\u8ba4 ssl_stapling_verify off; \u4e0a\u4e0b\u6587 http\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.3.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u6216\u7981\u7528\u670d\u52a1\u5668\u5bf9 OCSP \u54cd\u5e94\u7684\u9a8c\u8bc1\u3002</p> <p>\u8981\u4f7f\u9a8c\u8bc1\u751f\u6548\uff0c\u5e94\u4f7f\u7528 ssl_trusted_certificate \u6307\u4ee4\u5c06\u670d\u52a1\u5668\u8bc1\u4e66\u9881\u53d1\u8005\u7684\u8bc1\u4e66\u3001\u6839\u8bc1\u4e66\u548c\u6240\u6709\u4e2d\u7ea7\u8bc1\u4e66\u914d\u7f6e\u4e3a\u53d7\u4fe1\u4efb\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_trusted_certificate","title":"ssl_trusted_certificate","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_trusted_certificate <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.3.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5982\u679c\u542f\u7528\u4e86 ssl_stapling\uff0c\u5219\u6307\u5b9a\u4e00\u4e2a PEM \u683c\u5f0f\u7684\u53ef\u4fe1 CA \u8bc1\u4e66\u6587\u4ef6\uff0c\u8be5\u8bc1\u4e66\u7528\u4e8e\u9a8c\u8bc1\u5ba2\u6237\u7aef\u8bc1\u4e66\u548c OCSP \u54cd\u5e94\u3002</p> <p>\u4e0e ssl_client_certificate \u8bbe\u7f6e\u7684\u8bc1\u4e66\u4e0d\u540c\uff0c\u8fd9\u4e9b\u8bc1\u4e66\u7684\u5217\u8868\u4e0d\u4f1a\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_verify_client","title":"ssl_verify_client","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_verify_client <code>on</code> | <code>off</code> | <code>optional</code> | <code>optional_no_ca</code>; \u9ed8\u8ba4 ssl_stapling_verify off; \u4e0a\u4e0b\u6587 http\u3001server <p>\u542f\u7528\u5ba2\u6237\u7aef\u8bc1\u4e66\u9a8c\u8bc1\u3002\u9a8c\u8bc1\u7ed3\u679c\u5b58\u50a8\u5728 <code>$ssl_client_verify</code> \u53d8\u91cf\u4e2d\u3002</p> <p><code>optional</code> \u53c2\u6570\uff080.8.7+\uff09\u8bf7\u6c42\u5ba2\u6237\u7aef\u8bc1\u4e66\uff0c\u5e76\u5728\u8bc1\u4e66\u5b58\u5728\u65f6\u9a8c\u8bc1\u3002</p> <p><code>optional_no_ca</code> \u53c2\u6570\uff081.3.8\u30011.2.5\uff09\u8bf7\u6c42\u5ba2\u6237\u7aef\u8bc1\u4e66\uff0c\u4f46\u4e0d\u8981\u6c42\u5b83\u7531\u53d7\u4fe1\u4efb\u7684 CA \u8bc1\u4e66\u7b7e\u540d\u3002\u8fd9\u9002\u7528\u4e8e nginx \u5916\u90e8\u670d\u52a1\u6267\u884c\u5b9e\u9645\u8bc1\u4e66\u9a8c\u8bc1\u7684\u60c5\u51b5\u3002\u53ef\u4ee5\u901a\u8fc7 $ssl_client_cert \u53d8\u91cf\u8bbf\u95ee\u8bc1\u4e66\u5185\u5bb9\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#ssl_verify_depth","title":"ssl_verify_depth","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_verify_depth <code>number</code>; \u9ed8\u8ba4 ssl_verify_depth 1; \u4e0a\u4e0b\u6587 http\u3001server <p>\u8bbe\u7f6e\u5ba2\u6237\u7aef\u8bc1\u4e66\u94fe\u7684\u9a8c\u8bc1\u6df1\u5ea6\u3002</p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#_3","title":"\u9519\u8bef\u5904\u7406","text":"<p>ngx_http_ssl_module \u6a21\u5757\u652f\u6301\u51e0\u4e2a\u975e\u6807\u51c6\u9519\u8bef\u4ee3\u7801\uff0c\u53ef\u4ee5\u4f7f\u7528 error_page \u6307\u4ee4\u6765\u91cd\u5b9a\u5411\uff1a</p> <ul> <li> <p><code>495</code></p> <p>\u5ba2\u6237\u7aef\u8bc1\u4e66\u9a8c\u8bc1\u671f\u95f4\u53d1\u751f\u9519\u8bef</p> </li> <li> <p><code>496</code></p> <p>\u5ba2\u6237\u672a\u63d0\u4ea4\u6240\u9700\u8bc1\u4e66</p> </li> <li> <p><code>497</code></p> <p>\u5df2\u5c06\u5e38\u89c4\u8bf7\u6c42\u53d1\u9001\u5230 HTTPS \u7aef\u53e3</p> </li> </ul> <p>\u5728\u5b8c\u5168\u89e3\u6790\u8bf7\u6c42\u5e76\u4e14\u53d8\u91cf\uff08\u4f8b\u5982 <code>$request_uri</code>\u3001<code>$uri</code>\u3001<code>$args</code> \u548c\u5176\u4ed6\u53d8\u91cf\uff09\u53ef\u7528\u4e4b\u540e\uff0c\u5c31\u4f1a\u53d1\u751f\u91cd\u5b9a\u5411\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#_4","title":"\u5185\u5d4c\u53d8\u91cf","text":"<p><code>ngx_http_ssl_module</code> \u6a21\u5757\u652f\u6301\u4ee5\u4e0b\u5d4c\u5165\u53d8\u91cf\uff1a</p> <ul> <li> <p><code>$ssl_cipher</code></p> <p>\u8fd4\u56de\u7528\u4e8e\u4e00\u4e2a\u5df2\u5efa\u7acb\u7684 SSL \u8fde\u63a5\u7684\u5bc6\u7801\u5b57\u7b26\u4e32</p> </li> <li> <p><code>$ssl_ciphers</code></p> <p>\u8fd4\u56de\u5ba2\u6237\u7aef\u652f\u6301\u7684\u5bc6\u7801\u5217\u8868\uff081.11.7\uff09\u3002\u5df2\u77e5\u5bc6\u7801\u6309\u540d\u79f0\u5217\u51fa\uff0c\u672a\u77e5\u5219\u4ee5\u5341\u516d\u8fdb\u5236\u663e\u793a\uff0c\u4f8b\u5982\uff1a</p> <pre><code>AES128-SHA:AES256-SHA:0x00ff\n</code></pre> <p>\u4ec5\u5728\u4f7f\u7528 OpenSSL 1.0.2 \u6216\u66f4\u9ad8\u7248\u672c\u65f6\u624d\u5b8c\u5168\u652f\u6301\u8be5\u53d8\u91cf\u3002\u5bf9\u4e8e\u65e7\u7248\u672c\uff0c\u8be5\u53d8\u91cf\u4ec5\u9002\u7528\u4e8e\u65b0\u4f1a\u8bdd\uff0c\u4ec5\u5217\u51fa\u5df2\u77e5\u5bc6\u7801\u3002</p> </li> <li> <p><code>$ssl_client_escaped_cert</code></p> <p>\u4ee5 PEM \u683c\u5f0f\uff08urlencoded\uff09\u8fd4\u56de\u5df2\u5efa\u7acb SSL \u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66\uff081.13.5\uff09</p> </li> <li> <p><code>$ssl_client_cert</code></p> <p>\u4e3a\u5df2\u5efa\u7acb\u7684 SSL \u8fde\u63a5\u8fd4\u56de PEM \u683c\u5f0f\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66\u3002\u9664\u4e86\u7b2c\u4e00\u884c\uff0c\u524d\u9762\u7684\u6bcf\u4e00\u884c\u90fd\u5e26\u6709\u5236\u8868\u7b26\u3002\u8fd9\u9002\u7528\u4e8e proxy_set_header \u6307\u4ee4\u3002</p> <p>\u4e0d\u63a8\u8350\u4f7f\u7528\u8be5\u53d8\u91cf\uff0c\u5e94\u8be5\u4f7f\u7528 <code>$ssl_client_escaped_cert</code> \u53d8\u91cf\u3002</p> </li> <li> <p><code>$ssl_client_fingerprint</code></p> <p>\u8fd4\u56de\u5df2\u5efa\u7acb SSL \u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684 SHA1 \u6307\u7eb9\uff081.7.1\uff09</p> </li> <li> <p><code>$ssl_client_i_dn</code></p> <p>\u6839\u636e RFC 2253\uff081.11.6\uff09\uff0c\u4e3a\u5df2\u5efa\u7acb\u7684 SSL \u8fde\u63a5\u8fd4\u56de\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684 <code>issuer DN</code> \u5b57\u7b26\u4e32;</p> </li> <li> <p><code>$ssl_client_i_dn_legacy</code></p> <p>\u8fd4\u56de\u5df2\u5efa\u7acb\u7684 SSL \u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684 <code>issuer DN</code> \u5b57\u7b26\u4e32\u3002</p> <p>\u5728 1.11.6 \u7248\u4e4b\u524d\uff0c\u53d8\u91cf\u540d\u79f0\u4e3a <code>$ssl_client_i_dn</code>\u3002</p> </li> <li> <p><code>$ssl_client_raw_cert</code></p> <p>\u8fd4\u56de\u5df2\u5efa\u7acb SSL \u8fde\u63a5\u7684 PEM \u683c\u5f0f\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66</p> </li> <li> <p><code>$ssl_client_s_dn</code></p> <p>\u6839\u636e RFC 2253\uff081.11.6\uff09\uff0c\u4e3a\u5df2\u5efa\u7acb\u7684 SSL \u8fde\u63a5\u8fd4\u56de\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684 <code>subject DN</code> \u5b57\u7b26\u4e32</p> </li> <li> <p><code>$ssl_client_s_dn_legacy</code></p> <p>\u8fd4\u56de\u5df2\u5efa\u7acb SSL \u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684 <code>subject DN</code>\u5b57\u7b26\u4e32</p> <p>\u5728 1.11.6 \u7248\u4e4b\u524d\uff0c\u53d8\u91cf\u540d\u79f0\u4e3a <code>$ssl_client_s_dn</code>\u3002</p> </li> <li> <p><code>$ssl_client_serial</code></p> <p>\u8fd4\u56de\u5df2\u5efa\u7acb\u7684 SSL \u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684\u5e8f\u5217\u53f7</p> </li> <li> <p><code>$ssl_client_v_end</code></p> <p>\u8fd4\u56de\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684\u7ed3\u675f\u65e5\u671f\uff081.11.7\uff09</p> </li> <li> <p><code>$ssl_client_v_remain</code></p> <p>\u8fd4\u56de\u5ba2\u6237\u7aef\u8bc1\u4e66\u5230\u671f\u524d\u7684\u5929\u6570\uff081.11.7\uff09</p> </li> <li> <p><code>$ssl_client_v_start</code></p> <p>\u8fd4\u56de\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684\u5f00\u59cb\u65e5\u671f\uff081.11.7\uff09</p> </li> <li> <p><code>$ssl_client_verify</code></p> <p>\u8fd4\u56de\u5ba2\u6237\u7aef\u8bc1\u4e66\u9a8c\u8bc1\u7684\u7ed3\u679c\uff1a<code>SUCCESS</code>\u3001<code>FAILED:reason</code>\uff0c\u5982\u679c\u8bc1\u4e66\u4e0d\u5b58\u5728\u5219\u8fd4\u56de <code>NONE</code>\u3002</p> <p>\u5728 1.11.7 \u7248\u4e4b\u524d\uff0c<code>FAILED</code> \u7ed3\u679c\u4e0d\u5305\u542b\u539f\u56e0\u5b57\u7b26\u4e32</p> </li> <li> <p><code>$ssl_curves</code></p> <p>\u8fd4\u56de\u5ba2\u6237\u7aef\u652f\u6301\u7684 curve \u5217\u8868\uff081.11.7\uff09\u3002\u5df2\u77e5 curve \u6309\u540d\u79f0\u5217\u51fa\uff0c\u672a\u77e5\u4ee5\u5341\u516d\u8fdb\u5236\u663e\u793a\uff0c\u4f8b\u5982\uff1a</p> <pre><code>0x001d:prime256v1:secp521r1:secp384r1\n</code></pre> <p>\u4ec5\u5728\u4f7f\u7528 OpenSSL 1.0.2 \u6216\u66f4\u9ad8\u7248\u672c\u65f6\u624d\u652f\u6301\u8be5\u53d8\u91cf\u3002\u5bf9\u4e8e\u65e7\u7248\u672c\uff0c\u53d8\u91cf\u503c\u5c06\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002</p> <p>\u8be5\u53d8\u91cf\u4ec5\u9002\u7528\u4e8e\u65b0\u4f1a\u8bdd\u3002</p> </li> <li> <p><code>$ssl_early_data</code></p> <p>\u5982\u679c\u4f7f\u7528 TLS 1.3 Early data \u5e76\u4e14\u63e1\u624b\u672a\u5b8c\u6210\u5219\u8fd4\u56de <code>\"1\"</code>\uff0c\u5426\u5219\u8fd4\u56de <code>\"\"</code>\uff081.15.3\uff09\u3002</p> </li> <li> <p><code>$ssl_protocol</code></p> <p>\u8fd4\u56de\u5df2\u5efa\u7acb\u7684 SSL \u8fde\u63a5\u7684\u534f\u8bae</p> </li> <li> <p><code>$ssl_server_name</code></p> <p>\u8fd4\u56de\u901a\u8fc7 SNI\uff081.7.0\uff09\u8bf7\u6c42\u7684\u670d\u52a1\u5668\u540d\u79f0</p> </li> <li> <p><code>$ssl_session_id</code></p> <p>\u8fd4\u56de\u5df2\u5efa\u7acb\u7684 SSL \u8fde\u63a5\u7684\u4f1a\u8bdd\u6807\u8bc6</p> </li> <li> <p><code>$ssl_session_reused</code></p> <p>\u5982\u679c\u91cd\u7528 SSL \u4f1a\u8bdd\u5219\u8fd4\u56de <code>\"r\"</code>\uff0c\u5426\u5219\u8fd4\u56de <code>\".\"</code>\uff081.5.11\uff09\u3002</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_ssl_module/#_5","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/http/ngx_http_ssl_module.html</li> </ul>"},{"location":"Modules-reference/http/ngx_http_status_module/","title":"ngx_http_status_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>status</li> <li>status_format</li> <li>status_zone</li> </ul> </li> <li>\u6570\u636e</li> <li>\u517c\u5bb9\u6027</li> </ul> <p>1.13.10 \u7248\u672c\u8d77\uff0c\u8be5\u6a21\u5757\u88ab 1.13.3 \u4e2d\u7684 ngx_http_api_module \u6a21\u5757\u6240\u53d6\u4ee3\u3002</p> <p><code>ngx_http_status_module</code> \u6a21\u5757\u63d0\u4f9b\u4e86\u8bbf\u95ee\u5404\u79cd\u72b6\u6001\u4fe1\u606f\u7684\u63a5\u53e3\u3002</p> <p>\u8be5\u6a21\u5757\u4f5c\u4e3a\u6211\u4eec\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\u63d0\u4f9b\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_status_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>http {\nupstream backend {\nzone http_backend 64k;\n\nserver backend1.example.com weight=5;\nserver backend2.example.com;\n}\n\nproxy_cache_path /data/nginx/cache_backend keys_zone=cache_backend:10m;\n\nserver {\nserver_name backend.example.com;\n\nlocation / {\nproxy_pass  http://backend;\nproxy_cache cache_backend;\n\nhealth_check;\n}\n\nstatus_zone server_backend;\n}\n\nserver {\nlisten 127.0.0.1;\n\nlocation /upstream_conf {\nupstream_conf;\n}\n\nlocation /status {\nstatus;\n}\n\nlocation = /status.html {\n}\n}\n}\n\nstream {\nupstream backend {\nzone stream_backend 64k;\n\nserver backend1.example.com:12345 weight=5;\nserver backend2.example.com:12345;\n}\n\nserver {\nlisten      127.0.0.1:12345;\nproxy_pass  backend;\nstatus_zone server_backend;\nhealth_check;\n}\n}\n</code></pre> <p>\u4f7f\u7528\u6b64\u914d\u7f6e\u7684\u72b6\u6001\u8bf7\u6c42\u793a\u4f8b\uff1a</p> <pre><code>http://127.0.0.1/status\nhttp://127.0.0.1/status/nginx_version\nhttp://127.0.0.1/status/caches/cache_backend\nhttp://127.0.0.1/status/upstreams\nhttp://127.0.0.1/status/upstreams/backend\nhttp://127.0.0.1/status/upstreams/backend/peers/1\nhttp://127.0.0.1/status/upstreams/backend/peers/1/weight\nhttp://127.0.0.1/status/stream\nhttp://127.0.0.1/status/stream/upstreams\nhttp://127.0.0.1/status/stream/upstreams/backend\nhttp://127.0.0.1/status/stream/upstreams/backend/peers/1\nhttp://127.0.0.1/status/stream/upstreams/backend/peers/1/weight\n</code></pre> <p>\u7b80\u5355\u76d1\u89c6\u9875\u9762\u968f\u5206\u53d1\u5305\u4e00\u8d77\u63d0\u4f9b\uff0c\u4f7f\u7528\u9ed8\u8ba4\u914d\u7f6e\u53ef\u4ee5 <code>/status.html</code> \u8eab\u4efd\u8bbf\u95ee\u3002\u5b83\u9700\u8981\u914d\u7f6e location <code>/status</code> \u548c <code>/status.html</code>\uff0c\u5982\u4e0a\u6240\u793a\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_status_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_status_module/#status","title":"status","text":"- \u8bf4\u660e \u8bed\u6cd5 status; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 location <p>\u53ef\u4ee5\u4ece\u5305\u542b\u6709\u6307\u4ee4\u7684 location \u8bbf\u95ee\u72b6\u6001\u4fe1\u606f\u3002\u5e94\u9650\u5236\u8bbf\u95ee\u6b64 location\u3002</p>"},{"location":"Modules-reference/http/ngx_http_status_module/#status_format","title":"status_format","text":"- \u8bf4\u660e \u8bed\u6cd5 status_format <code>json</code>;  status_format <code>jsonp [callback]</code>; \u9ed8\u8ba4 <code>status_format json</code> \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u72b6\u6001\u4fe1\u606f\u4ee5 JSON \u683c\u5f0f\u8f93\u51fa\u3002</p> <p>\u6216\u4ee5\u8f93\u51fa\u4e3a JSONP \u683c\u5f0f\u8f93\u51fa\uff0c<code>callback</code> \u53c2\u6570\u6307\u5b9a\u56de\u8c03\u51fd\u6570\u7684\u540d\u79f0\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002\u5982\u679c\u7701\u7565\u53c2\u6570\uff0c\u6216\u8ba1\u7b97\u7684\u503c\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff0c\u5219\u4f7f\u7528 <code>\"ngx_status_jsonp_callback\"</code>\u3002</p>"},{"location":"Modules-reference/http/ngx_http_status_module/#status_zone","title":"status_zone","text":"- \u8bf4\u660e \u8bed\u6cd5 status_zone; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 server <p>\u5141\u8bb8\u5728\u6307\u5b9a\u7684 <code>zone</code> \u4e2d\u6536\u96c6\u865a\u62df http \u6216\u6d41\uff081.7.11\uff09\u670d\u52a1\u5668\u72b6\u6001\u4fe1\u606f\u3002\u591a\u4e2a\u670d\u52a1\u5668\u53ef\u80fd\u5171\u4eab\u540c\u4e00\u4e2a\u533a\u57df\uff08zone\uff09\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_status_module/#_3","title":"\u6570\u636e","text":"<p>\u63d0\u4f9b\u4ee5\u4e0b\u72b6\u6001\u4fe1\u606f\uff1a</p> <ul> <li> <p><code>version</code></p> <p>\u63d0\u4f9b\u7684\u6570\u636e\u96c6\u7684\u7248\u672c\u3002\u76ee\u524d\u7684\u7248\u672c\u662f 8\u3002</p> </li> <li> <p><code>nginx_version</code></p> <p>nginx \u7684\u7248\u672c\u3002</p> </li> <li> <p><code>nginx_build</code></p> <p>nginx \u7684\u6784\u5efa\u540d\u79f0\u3002</p> </li> <li> <p><code>address</code></p> <p>\u63a5\u53d7\u72b6\u6001\u8bf7\u6c42\u7684\u670d\u52a1\u5668\u7684\u5730\u5740\u3002</p> </li> <li> <p><code>generation</code></p> <p>\u914d\u7f6e\u91cd\u65b0\u52a0\u8f7d\u7684\u603b\u6570\u3002</p> </li> <li> <p><code>load_timestamp</code></p> <p>\u4e0a\u6b21\u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u7684\u65f6\u95f4\uff0c\u81ea Epoch \u540e\u7684\u6beb\u79d2\u6570\u3002</p> </li> <li> <p><code>timestamp</code></p> <p>Epoch \u540e\u7684\u5f53\u524d\u65f6\u95f4\uff08\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff09\u3002</p> </li> <li> <p><code>pid</code></p> <p>\u5904\u7406\u72b6\u6001\u8bf7\u6c42\u7684 worker \u8fdb\u7a0b\u7684 ID\u3002</p> </li> <li> <p><code>ppid</code></p> <p>\u542f\u52a8 worker \u8fdb\u7a0b\u7684\u4e3b\u8fdb\u7a0b\u7684 ID\u3002</p> </li> <li> <p><code>processes</code></p> <ul> <li> <p><code>respawned</code></p> <p>\u5f02\u5e38\u7ec8\u6b62\u548c\u91cd\u751f\u7684\u5b50\u8fdb\u7a0b\u7684\u603b\u6570\u3002</p> </li> </ul> </li> <li> <p><code>connections</code></p> <ul> <li> <p><code>accepted</code></p> <p>\u5df2\u63a5\u53d7\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u603b\u6570\u3002</p> </li> <li> <p><code>dropped</code></p> <p>\u5df2\u5220\u9664\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u603b\u6570\u3002</p> </li> <li> <p><code>active</code></p> </li> </ul> <p>\u5f53\u524d\u6d3b\u52a8\u5ba2\u6237\u7aef\u8fde\u63a5\u6570\u3002</p> <ul> <li><code>idle</code></li> </ul> <p>\u5f53\u524d\u7a7a\u95f2\u5ba2\u6237\u7aef\u8fde\u63a5\u6570\u3002</p> </li> <li> <p><code>ssl</code></p> <ul> <li> <p><code>handshakes</code></p> <p>SSL \u63e1\u624b\u6210\u529f\u7684\u603b\u6570\u3002</p> </li> <li> <p><code>handshakes_failed</code></p> <p>SSL \u63e1\u624b\u5931\u8d25\u7684\u603b\u6570\u3002</p> </li> <li> <p><code>session_reuses</code></p> <p>SSL \u63e1\u624b\u671f\u95f4\u4f1a\u8bdd\u200b\u200b\u91cd\u7528\u7684\u603b\u6b21\u6570\u3002</p> </li> </ul> </li> <li> <p><code>requests</code></p> <ul> <li> <p><code>total</code></p> <p>\u5ba2\u6237\u7aef\u8bf7\u6c42\u603b\u6b21\u6570\u3002</p> </li> <li> <p><code>current</code></p> <p>\u5f53\u524d\u7684\u5ba2\u6237\u7aef\u8bf7\u6c42\u6570\u3002</p> </li> </ul> </li> <li> <p><code>server_zones</code></p> <p>\u5bf9\u4e8e\u6bcf\u4e2a status_zone\uff1a</p> <ul> <li> <p><code>ngx_http_status_module.html</code></p> <p>\u5f53\u524d\u6b63\u5728\u5904\u7406\u7684\u5ba2\u6237\u7aef\u8bf7\u6c42\u6570\u3002</p> </li> <li> <p><code>requests</code></p> <p>\u4ece\u5ba2\u6237\u7aef\u6536\u5230\u7684\u5ba2\u6237\u7aef\u8bf7\u6c42\u603b\u6570\u3002</p> </li> <li> <p><code>responses</code></p> <ul> <li> <p><code>total</code></p> <p>\u53d1\u9001\u7ed9\u5ba2\u6237\u7684\u54cd\u5e94\u603b\u6570\u3002</p> </li> <li> <p><code>1xx, 2xx, 3xx, 4xx, 5xx</code></p> <p>\u72b6\u6001\u4ee3\u7801\u4e3a 1xx\u30012xx\u30013xx\u30014xx \u548c 5xx \u7684\u54cd\u5e94\u6570\u3002</p> </li> </ul> </li> <li> <p><code>discarded</code></p> <p>\u5728\u672a\u53d1\u9001\u54cd\u5e94\u7684\u60c5\u51b5\u4e0b\u5b8c\u6210\u7684\u8bf7\u6c42\u603b\u6570\u3002</p> </li> <li> <p><code>received</code></p> <p>\u4ece\u5ba2\u6237\u7aef\u6536\u5230\u7684\u603b\u5b57\u8282\u6570\u3002</p> </li> <li> <p><code>sent</code></p> <p>\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u7684\u603b\u5b57\u8282\u6570\u3002</p> </li> </ul> </li> <li> <p><code>slabs</code></p> <p>\u5bf9\u4e8e\u6bcf\u4e2a\u4f7f\u7528\u4e86 slab \u5206\u914d\u5668\u7684\u5171\u4eab\u5185\u5b58\u533a\u57df\uff1a</p> <ul> <li> <p><code>pages</code></p> <ul> <li> <p><code>used</code></p> <p>\u5f53\u524d\u4f7f\u7528\u7684\u5185\u5b58\u9875\u6570\u3002</p> </li> <li> <p><code>free</code></p> <p>\u5f53\u524d\u53ef\u7528\u5185\u5b58\u9875\u6570\u3002</p> </li> </ul> </li> <li> <p><code>slots</code></p> <p>\u5bf9\u4e8e\u6bcf\u4e2a\u5185\u5b58\u63d2\u69fd\u5927\u5c0f\uff088\u300116\u300132\u300164\u3001128 \u7b49\uff09\uff0c\u63d0\u4f9b\u4ee5\u4e0b\u6570\u636e\uff1a</p> <ul> <li> <p><code>used</code></p> <p>\u5f53\u524d\u4f7f\u7528\u7684\u5185\u5b58\u69fd\u6570\u3002</p> </li> <li> <p><code>free</code></p> <p>\u5f53\u524d\u53ef\u7528\u7684\u5185\u5b58\u69fd\u6570\u3002</p> </li> <li> <p><code>reqs</code></p> <p>\u5c1d\u8bd5\u5206\u914d\u6307\u5b9a\u5927\u5c0f\u5185\u5b58\u7684\u603b\u6b21\u6570\u3002</p> </li> <li> <p><code>fails</code></p> <p>\u5c1d\u8bd5\u5206\u914d\u6307\u5b9a\u5927\u5c0f\u5185\u5b58\u7684\u5931\u8d25\u6b21\u6570\u3002</p> </li> </ul> </li> </ul> </li> <li> <p><code>upstreams</code></p> <p>\u5bf9\u4e8e\u6bcf\u4e2a\u52a8\u6001\u53ef\u914d\u7f6e\u7ec4\uff0c\u63d0\u4f9b\u4ee5\u4e0b\u6570\u636e\uff1a</p> <ul> <li> <p><code>peers</code></p> <p>\u5bf9\u4e8e\u6bcf\u4e2a server\uff0c\u63d0\u4f9b\u4ee5\u4e0b\u6570\u636e\uff1a</p> <ul> <li> <p><code>id</code></p> <p>\u670d\u52a1\u5668\u7684 ID\u3002</p> </li> <li> <p><code>server</code></p> <p>\u4e00\u4e2a\u670d\u52a1\u5668\u5730\u5740\u3002</p> </li> <li> <p><code>name</code></p> <p>server \u6307\u4ee4\u4e2d\u6307\u5b9a\u7684\u670d\u52a1\u5668\u7684\u540d\u79f0\u3002</p> </li> <li> <p><code>service</code></p> <p>server \u6307\u4ee4\u7684\u670d\u52a1\u53c2\u6570\u503c\u3002</p> </li> <li> <p><code>backup</code></p> <p>\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u6307\u793a\u670d\u52a1\u5668\u662f\u5426\u4e3a\u5907\u4efd\u670d\u52a1\u5668\u3002</p> </li> <li> <p><code>weight</code></p> <p>\u670d\u52a1\u5668\u7684\u6743\u91cd\u3002</p> </li> <li> <p><code>state</code></p> <p>\u5f53\u524d\u72b6\u6001\uff0c\u53ef\u4ee5\u662f <code>up</code>\u3001<code>draining</code>\u3001<code>down</code>\u3001<code>unavail</code>\u3001<code>checking</code> \u6216 <code>unhealthy</code> \u4e4b\u4e00\u3002</p> </li> <li> <p><code>active</code></p> <p>\u5f53\u524d\u6d3b\u52a8\u8fde\u63a5\u6570\u3002</p> </li> <li> <p><code>max_conns</code></p> <p>\u670d\u52a1\u5668\u7684 max_conns \u9650\u5236\u3002</p> </li> <li> <p><code>requests</code></p> <p>\u8f6c\u53d1\u5230\u6b64\u670d\u52a1\u5668\u7684\u5ba2\u6237\u7aef\u8bf7\u6c42\u603b\u6570\u3002</p> </li> <li> <p><code>responses</code></p> <ul> <li> <p><code>total</code></p> <p>\u4ece\u6b64\u670d\u52a1\u5668\u83b7\u53d6\u7684\u54cd\u5e94\u603b\u6570\u3002</p> </li> <li> <p><code>1xx, 2xx, 3xx, 4xx, 5xx</code></p> <p>\u72b6\u6001\u4ee3\u7801\u4e3a 1xx\u30012xx\u30013xx\u30014xx \u548c 5xx \u7684\u54cd\u5e94\u6570\u3002</p> </li> </ul> </li> <li> <p><code>sent</code></p> <p>\u53d1\u9001\u5230\u6b64\u670d\u52a1\u5668\u7684\u603b\u5b57\u8282\u6570\u3002</p> </li> <li> <p><code>received</code></p> <p>\u4ece\u6b64\u670d\u52a1\u5668\u63a5\u6536\u7684\u603b\u5b57\u8282\u6570\u3002</p> </li> <li> <p><code>fails</code></p> <p>\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u5931\u8d25\u7684\u603b\u6b21\u6570\u3002</p> </li> <li> <p><code>unavail</code></p> <p>\u7531\u4e8e\u5c1d\u8bd5\u4e0d\u6210\u529f\u7684\u6b21\u6570\u8fbe\u5230 max_fails \u9608\u503c\uff0c\u670d\u52a1\u5668\u5bf9\u5ba2\u6237\u7aef\u8bf7\u6c42\u53d8\u4e3a\u4e0d\u53ef\u7528\u7684\u6b21\u6570\uff08\u72b6\u6001\u4e3a <code>unavail</code>\uff09\u3002</p> </li> <li> <p><code>health_checks</code></p> <ul> <li> <p><code>checks</code></p> <p>\u8fdb\u884c\u5065\u5eb7\u68c0\u67e5\u7684\u8bf7\u6c42\u603b\u6570\u3002</p> </li> <li> <p><code>fails</code></p> <p>\u5065\u5eb7\u68c0\u67e5\u5931\u8d25\u7684\u6b21\u6570\u3002</p> </li> <li> <p><code>unhealthy</code></p> <p>\u670d\u52a1\u5668\u53d8\u4e3a\u4e0d\u5065\u5eb7\u7684\u6b21\u6570\uff08\u72b6\u6001 <code>unhealthy</code>\uff09\u3002</p> </li> <li> <p><code>last_passed</code></p> <p>\u5e03\u5c14\u503c\uff0c\u8868\u793a\u4e0a\u6b21\u8fd0\u884c\u72b6\u51b5\u68c0\u67e5\u8bf7\u6c42\u662f\u5426\u6210\u529f\u5e76\u901a\u8fc7\u4e86\u6d4b\u8bd5\u3002</p> </li> </ul> </li> <li> <p><code>downtime</code></p> <p>\u670d\u52a1\u5668\u5904\u4e8e <code>unavail</code>\u3001<code>checking</code> \u548c <code>unhealthy</code> \u72b6\u6001\u7684\u603b\u65f6\u95f4\u3002</p> </li> <li> <p><code>downstart</code></p> <p>\u670d\u52a1\u5668\u53d8\u4e3a <code>unavail</code>\u3001<code>checking</code> \u6216 <code>unhealthy</code> \u65f6\u7684\u65f6\u95f4\uff08\u81ea Epoch \u4ee5\u6765\u7684\u6beb\u79d2\u6570\uff09\u3002</p> </li> <li> <p><code>selected</code></p> <p>\u4e0a\u6b21\u9009\u62e9\u7684\u670d\u52a1\u5668\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\u7684\u65f6\u95f4\uff08\u81ea Epoch \u4ee5\u6765\u7684\u6beb\u79d2\u6570\uff09\uff081.7.5\uff09\u3002</p> </li> <li> <p><code>header_time</code></p> <p>\u4ece\u670d\u52a1\u5668\u83b7\u53d6\u54cd\u5e94\u5934\u7684\u5e73\u5747\u65f6\u95f4\uff081.7.10\uff09\u3002\u5728 1.11.6 \u7248\u4e4b\u524d\uff0c\u8be5\u5b57\u6bb5\u4ec5\u5728\u4f7f\u7528 least_time \u8d1f\u8f7d\u5747\u8861\u65b9\u6cd5\u65f6\u53ef\u7528\u3002</p> </li> <li> <p><code>response_time</code></p> <p>\u4ece\u670d\u52a1\u5668\u83b7\u5f97\u5b8c\u6574\u54cd\u5e94\u7684\u5e73\u5747\u65f6\u95f4\uff081.7.10\uff09\u3002\u5728 1.11.6 \u7248\u4e4b\u524d\uff0c\u8be5\u5b57\u6bb5\u4ec5\u5728\u4f7f\u7528 least_time \u8d1f\u8f7d\u5747\u8861\u65b9\u6cd5\u65f6\u53ef\u7528\u3002</p> </li> </ul> </li> <li> <p><code>keepalive</code></p> <p>\u5f53\u524d\u7a7a\u95f2\u7684 keepalive \u8fde\u63a5\u6570\u3002</p> </li> <li> <p><code>zombies</code></p> <p>\u5f53\u524d\u4ece\u7ec4\u4e2d\u5220\u9664\u4f46\u4ecd\u5904\u7406\u6d3b\u52a8\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u670d\u52a1\u5668\u6570\u3002</p> </li> <li> <p><code>zone</code></p> <p>\u4fdd\u6301\u7ec4\u914d\u7f6e\u548c\u8fd0\u884c\u65f6\u72b6\u6001\u7684\u5171\u4eab\u5185\u5b58\u533a\u57df\u7684\u540d\u79f0\u3002</p> </li> <li> <p><code>queue</code></p> <p>\u5bf9\u4e8e\u8bf7\u6c42\u961f\u5217\uff0c\u63d0\u4f9b\u4ee5\u4e0b\u6570\u636e\uff1a</p> <ul> <li> <p><code>size</code></p> <p>\u961f\u5217\u4e2d\u5f53\u524d\u7684\u8bf7\u6c42\u6570\u3002</p> </li> <li> <p><code>max_size</code></p> <p>\u53ef\u4ee5\u540c\u65f6\u5728\u961f\u5217\u4e2d\u7684\u6700\u5927\u8bf7\u6c42\u6570\u3002</p> </li> <li> <p><code>overflows</code></p> <p>\u7531\u4e8e\u961f\u5217\u6ea2\u51fa\u800c\u62d2\u7edd\u7684\u8bf7\u6c42\u603b\u6570\u3002</p> </li> </ul> </li> </ul> </li> <li> <p><code>caches</code></p> <p>\u5bf9\u4e8e\u6bcf\u4e2a\u7f13\u5b58\uff08\u7531 proxy_cache_path \u7b49\u914d\u7f6e\uff09\uff1a</p> <ul> <li> <p><code>size</code></p> <p>\u5f53\u524d\u7f13\u5b58\u7684\u5927\u5c0f\u3002</p> </li> <li> <p><code>max_size</code></p> <p>\u914d\u7f6e\u4e2d\u6307\u5b9a\u7684\u7f13\u5b58\u6700\u5927\u5927\u5c0f\u9650\u5236\u3002</p> </li> <li> <p><code>cold</code></p> <p>\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u6807\u8bc6**\u7f13\u5b58\u52a0\u8f7d\u5668**\uff08cache loade\uff09\u8fdb\u7a0b\u662f\u5426\u4ecd\u5728\u5c06\u6570\u636e\u4ece\u78c1\u76d8\u52a0\u8f7d\u5230\u7f13\u5b58\u4e2d\u3002</p> </li> <li> <p><code>hit, stale, updating, revalidated</code></p> <ul> <li> <p><code>responses</code></p> <p>\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u7684\u54cd\u5e94\u603b\u6b21\u6570\uff08\u7531\u4e8e proxy_cache_use_stale \u7b49\u800c\u5bfc\u81f4\u7684\u547d\u4e2d\u6216\u8fc7\u65f6\u54cd\u5e94\uff09\u3002</p> </li> <li> <p><code>bytes</code></p> <p>\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u7684\u603b\u5b57\u8282\u6570\u3002</p> </li> </ul> </li> <li> <p><code>miss, expired, bypass</code></p> <ul> <li> <p><code>responses</code></p> <p>\u672a\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u7684\u54cd\u5e94\u603b\u6570\uff08\u7531\u4e8e proxy_cache_bypass \u7b49\u539f\u56e0\u5bfc\u81f4\u7684\u672a\u547d\u4e2d\u3001\u8fc7\u671f\u6216\u7ed5\u8fc7\uff09\u3002</p> </li> <li> <p><code>bytes</code></p> <p>\u4ece\u4ee3\u7406\u670d\u52a1\u5668\u8bfb\u53d6\u7684\u603b\u5b57\u8282\u6570\u3002</p> </li> <li> <p><code>responses_written</code></p> <p>\u5199\u5165\u7f13\u5b58\u7684\u54cd\u5e94\u603b\u6570\u3002</p> </li> <li> <p><code>bytes_written</code></p> <p>\u5199\u5165\u7f13\u5b58\u7684\u603b\u5b57\u8282\u6570\u3002</p> </li> </ul> </li> </ul> </li> <li> <p><code>stream</code></p> <ul> <li> <p><code>server_zones</code></p> <p>\u5bf9\u4e8e\u6bcf\u4e2a status_zone\uff1a</p> <ul> <li> <p><code>processing</code></p> <p>\u5f53\u524d\u6b63\u5728\u5904\u7406\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u6570\u3002</p> </li> <li> <p><code>connections</code></p> <p>\u4ece\u5ba2\u6237\u7aef\u63a5\u53d7\u7684\u8fde\u63a5\u603b\u6570\u3002</p> </li> <li> <p><code>sessions</code></p> <ul> <li> <p><code>total</code></p> <p>\u5df2\u5b8c\u6210\u7684\u5ba2\u6237\u4f1a\u8bdd\u603b\u6570\u3002</p> </li> <li> <p><code>2xx, 4xx, 5xx</code></p> <p>\u5df2\u5b8c\u6210\u7684\u4f1a\u8bdd\u6570\uff0c\u72b6\u6001\u4ee3\u7801\u4e3a 2xx\u30014xx \u6216 5xx\u3002</p> </li> </ul> </li> <li> <p><code>discarded</code></p> <p>\u5728\u4e0d\u521b\u5efa\u4f1a\u8bdd\u7684\u60c5\u51b5\u4e0b\u5b8c\u6210\u7684\u8fde\u63a5\u603b\u6570\u3002</p> </li> <li> <p><code>received</code></p> <p>\u4ece\u5ba2\u6237\u7aef\u6536\u5230\u7684\u603b\u5b57\u8282\u6570\u3002</p> </li> <li> <p><code>sent</code></p> <p>\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u7684\u603b\u5b57\u8282\u6570\u3002</p> </li> </ul> </li> <li> <p><code>upstreams</code></p> <p>\u5bf9\u4e8e\u6bcf\u4e2a\u52a8\u6001\u53ef\u914d\u7f6e\u7ec4\uff0c\u63d0\u4f9b\u4ee5\u4e0b\u6570\u636e\uff1a</p> <ul> <li> <p><code>peers</code></p> <p>\u5bf9\u4e8e\u6bcf\u4e2a\u670d\u52a1\u5668\uff0c\u63d0\u4f9b\u4ee5\u4e0b\u6570\u636e\uff1a</p> <ul> <li> <p><code>id</code></p> <p>\u670d\u52a1\u5668\u7684 ID\u3002</p> </li> <li> <p><code>server</code></p> <p>\u4e00\u4e2a\u670d\u52a1\u5668\u5730\u5740\u3002</p> </li> <li> <p><code>name</code></p> <p>server \u6307\u4ee4\u4e2d\u6307\u5b9a\u7684\u670d\u52a1\u5668\u7684\u540d\u79f0\u3002</p> </li> <li> <p><code>service</code></p> <p>server \u6307\u4ee4\u7684 servive \u53c2\u6570\u503c\u3002</p> </li> <li> <p><code>backup</code></p> <p>\u4e00\u4e2a\u5e03\u5c14\u503c\uff0c\u6807\u8bc6\u670d\u52a1\u5668\u662f\u5426\u4e3a\u4e00\u4e2a\u5907\u4efd\u670d\u52a1\u5668\u3002             - <code>weight</code></p> <p>\u670d\u52a1\u5668\u7684\u6743\u91cd\u3002</p> </li> <li> <p><code>state</code></p> <p>\u5f53\u524d\u72b6\u6001\uff0c\u53ef\u4ee5\u662f <code>up</code>\u3001<code>down</code>\u3001<code>unavail</code>\u3001<code>checking</code> \u6216 <code>unhealthy</code> \u4e4b\u4e00\u3002</p> </li> <li> <p><code>active</code></p> <p>\u5f53\u524d\u7684\u8fde\u63a5\u6570\u3002</p> </li> <li> <p><code>max_conns</code></p> <p>\u670d\u52a1\u5668\u7684 max_conns \u9650\u5236\u3002</p> </li> <li> <p><code>connections</code></p> <p>\u8f6c\u53d1\u5230\u6b64\u670d\u52a1\u5668\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u603b\u6570\u3002</p> </li> <li> <p><code>connect_time</code></p> <p>\u8fde\u63a5\u4e0a\u6e38\uff08upstream\uff09\u670d\u52a1\u5668\u7684\u5e73\u5747\u65f6\u95f4\u3002\u5728 1.11.6 \u7248\u4e4b\u524d\uff0c\u8be5\u5b57\u6bb5\u4ec5\u5728\u4f7f\u7528 least_time \u8d1f\u8f7d\u5747\u8861\u65b9\u6cd5\u65f6\u53ef\u7528\u3002</p> </li> <li> <p><code>first_byte_time</code></p> <p>\u63a5\u6536\u7b2c\u4e00\u4e2a\u6570\u636e\u5b57\u8282\u7684\u5e73\u5747\u65f6\u95f4\u3002\u5728 1.11.6 \u7248\u4e4b\u524d\uff0c\u8be5\u5b57\u6bb5\u4ec5\u5728\u4f7f\u7528 least_time \u8d1f\u8f7d\u5747\u8861\u65f6\u53ef\u7528\u3002</p> </li> <li> <p><code>response_time</code></p> <p>\u63a5\u6536\u6700\u540e\u4e00\u4e2a\u6570\u636e\u5b57\u8282\u7684\u5e73\u5747\u65f6\u95f4\u3002\u5728 1.11.6 \u7248\u4e4b\u524d\uff0c\u8be5\u5b57\u6bb5\u4ec5\u5728\u4f7f\u7528least_time \u8d1f\u8f7d\u5747\u8861\u65b9\u6cd5\u65f6\u53ef\u7528\u3002</p> </li> <li> <p><code>sent</code></p> <p>\u53d1\u9001\u5230\u6b64\u670d\u52a1\u5668\u7684\u603b\u5b57\u8282\u6570\u3002</p> </li> <li> <p><code>received</code></p> <p>\u4ece\u6b64\u670d\u52a1\u5668\u63a5\u6536\u7684\u603b\u5b57\u8282\u6570\u3002</p> </li> <li> <p><code>fails</code></p> <p>\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u5931\u8d25\u7684\u603b\u6b21\u6570\u3002</p> </li> <li> <p><code>unavail</code></p> <p>\u7531\u4e8e\u5c1d\u8bd5\u4e0d\u6210\u529f\u6b21\u6570\u8fbe\u5230 max_fails \u9608\u503c\uff0c\u670d\u52a1\u5668\u5bf9\u5ba2\u6237\u7aef\u8fde\u63a5\u53d8\u4e3a\u4e0d\u53ef\u7528\u7684\u6b21\u6570\uff08\u72b6\u6001\u4e3a <code>unavail</code>\uff09</p> </li> <li> <p><code>health_checks</code></p> <ul> <li> <p><code>checks</code></p> <p>\u5065\u5eb7\u68c0\u67e5\u7684\u8bf7\u6c42\u603b\u6570\u3002</p> </li> <li> <p><code>fails</code></p> <p>\u5065\u5eb7\u68c0\u67e5\u5931\u8d25\u7684\u6b21\u6570\u3002</p> </li> <li> <p><code>unhealthy</code></p> <p>\u670d\u52a1\u5668\u5904\u4e8e\u4e0d\u5065\u5eb7\u7684\u6b21\u6570\uff08\u72b6\u6001 <code>unhealthy</code>\uff09\u3002</p> </li> <li> <p><code>last_passed</code></p> <p>\u5e03\u5c14\u503c\uff0c\u8868\u793a\u4e0a\u6b21\u8fd0\u884c\u72b6\u51b5\u68c0\u67e5\u8bf7\u6c42\u662f\u5426\u6210\u529f\u5e76\u901a\u8fc7\u4e86\u6d4b\u8bd5\u3002</p> </li> </ul> </li> <li> <p><code>downtime</code></p> <p>\u670d\u52a1\u5668\u5904\u4e8e <code>unavail</code>\u3001<code>checking</code> \u548c <code>unhealthy</code> \u72b6\u6001\u7684\u603b\u65f6\u95f4\u3002</p> </li> <li> <p><code>downstart</code></p> <p>\u670d\u52a1\u5668\u53d8\u4e3a <code>unavail</code>\u3001<code>checking</code> \u6216 <code>unhealthy</code> \u65f6\u7684\u65f6\u95f4\uff08\u81ea Epoch \u4ee5\u6765\u7684\u6beb\u79d2\u6570\uff09\u3002</p> </li> <li> <p><code>selected</code></p> <p>\u4e0a\u6b21\u9009\u4e2d\u7684\u670d\u52a1\u5668\u5904\u7406\u8fde\u63a5\u7684\u65f6\u95f4\uff08\u81ea Epoch \u4ee5\u6765\u7684\u6beb\u79d2\u6570\uff09\u3002</p> </li> </ul> </li> <li> <p><code>zombies</code></p> <p>\u5f53\u524d\u5df2\u4ece\u7ec4\u4e2d\u5220\u9664\u4f46\u4ecd\u5904\u7406\u6d3b\u52a8\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u670d\u52a1\u5668\u6570\u3002</p> </li> <li> <p><code>zone</code></p> <p>\u4fdd\u6301\u7ec4\u914d\u7f6e\u548c\u8fd0\u884c\u65f6\u72b6\u6001\u7684\u5171\u4eab\u5185\u5b58\u533a\u57df\u7684\u540d\u79f0\u3002</p> </li> </ul> </li> </ul> </li> </ul> <p></p>"},{"location":"Modules-reference/http/ngx_http_status_module/#_4","title":"\u517c\u5bb9\u6027","text":"<ul> <li>\u7248\u672c 8 \u4e2d\u6dfb\u52a0\u4e86 http \u548c stream upstreams \u7684 zone \u5b57\u6bb5\u3002</li> <li>\u7248\u672c 8 \u4e2d\u6dfb\u52a0\u4e86 slab \u72b6\u6001\u6570\u636e\u3002</li> <li>\u7248\u672c 8 \u4e2d\u6dfb\u52a0\u4e86\u68c0\u67e5\u72b6\u6001\u3002</li> <li>\u7248\u672c 8 \u4e2d\u6dfb\u52a0\u4e86 http \u548c stream upstream \u7684 name \u548c service \u5b57\u6bb5\u3002</li> <li>\u7248\u672c 8 \u4e2d\u6dfb\u52a0\u4e86 nginx_build \u548c ppid \u5b57\u6bb5\u3002</li> <li>\u7248\u672c 7 \u4e2d\u6dfb\u52a0\u4e86 session \u72b6\u6001\u6570\u636e\u548c\u6d41 server_zones \u4e2d\u7684 discarded \u5b57\u6bb5\u3002</li> <li>zombies \u5b57\u6bb5\u662f\u4ece\u7248\u672c 6 \u7684 nginx \u8c03\u8bd5\u7248\u672c\u79fb\u8fc7\u6765\u7684\u3002</li> <li>\u7248\u672c 6 \u4e2d\u6dfb\u52a0\u4e86 ssl \u72b6\u6001\u6570\u636e\u3002</li> <li>server_zones \u4e2d\u7684 discarded \u5b57\u6bb5\u5df2\u5728\u7248\u672c 6 \u4e2d\u6dfb\u52a0\u3002</li> <li>queue \u72b6\u6001\u6570\u636e\u5df2\u5728\u7248\u672c 6 \u4e2d\u6dfb\u52a0\u3002</li> <li>pid \u5b57\u6bb5\u5df2\u5728\u7248\u672c 6 \u4e2d\u6dfb\u52a0\u3002</li> <li>upstreams \u4e2d\u7684\u670d\u52a1\u5668\u5217\u8868\u5df2\u79fb\u81f3\u7248\u672c 6 \u4e2d\u7684\u5bf9\u5e94\u9879\u3002</li> <li>\u5728\u7248\u672c 5 \u4e2d\u5220\u9664\u4e86 upstream \u670d\u52a1\u5668\u7684 <code>keepalive</code> \u5b57\u6bb5\u3002</li> <li>stream \u72b6\u6001\u6570\u636e\u5df2\u5728\u7248\u672c 5 \u4e2d\u6dfb\u52a0\u3002</li> <li>\u7248\u672c 5 \u4e2d\u6dfb\u52a0\u4e86 generation \u5b57\u6bb5\u3002</li> <li>processes\u4e2d\u7684 respawned \u5b57\u6bb5\u5df2\u5728\u7248\u672c 5 \u4e2d\u6dfb\u52a0\u3002</li> <li>\u7248\u672c 5 \u4e2d\u6dfb\u52a0\u4e86 upstreams \u4e2d\u7684 header_time \u548c response_time \u5b57\u6bb5\u3002</li> <li>\u7248\u672c 4 \u4e2d\u6dfb\u52a0\u4e86 upstreams \u4e2d\u7684 selected \u5b57\u6bb5\u3002</li> <li>\u7248\u672c 4 \u4e2d\u6dfb\u52a0\u4e86upstreams \u7684 draining \u72b6\u6001\u3002</li> <li>upstreams \u4e2d\u7684 id \u548c max_conns \u5b57\u6bb5\u5df2\u5728\u7248\u672c 3 \u4e2d\u6dfb\u52a0\u3002</li> <li>\u7248\u672c 3 \u4e2d\u6dfb\u52a0\u4e86 caches \u4e2d\u7684 <code>revalidated</code> \u5b57\u6bb5\u3002</li> <li>\u7248\u672c 2 \u4e2d\u6dfb\u52a0\u4e86 server_zones\u3001caches \u548c load_timestamp \u72b6\u6001\u6570\u636e\u3002</li> </ul>"},{"location":"Modules-reference/http/ngx_http_status_module/#_5","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/http/ngx_http_status_module.html</p>"},{"location":"Modules-reference/http/ngx_http_stub_status_module/","title":"ngx_http_stub_status_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>stub_status</li> </ul> </li> <li>\u6570\u636e</li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_http_stub_status_module</code> \u6a21\u5757\u63d0\u4f9b\u5bf9\u57fa\u672c\u72b6\u6001\u4fe1\u606f\u7684\u8bbf\u95ee\u7684\u652f\u6301\u3002</p> <p>\u9ed8\u8ba4\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\uff0c\u53ef\u5728\u6784\u5efa\u65f6\u4f7f\u7528 <code>--with-http_stub_status_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_stub_status_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location = /basic_status {\nstub_status;\n}\n</code></pre> <p>\u6b64\u914d\u7f6e\u5c06\u521b\u5efa\u4e00\u4e2a\u7b80\u5355\u7684\u7f51\u9875\uff0c\u5176\u57fa\u672c\u72b6\u6001\u6570\u636e\u53ef\u80fd\u5982\u4e0b\uff1a</p> <pre><code>Active connections: 291 \nserver accepts handled requests\n 16630948 16630948 31070465 \nReading: 6 Writing: 179 Waiting: 106 \n</code></pre> <p></p>"},{"location":"Modules-reference/http/ngx_http_stub_status_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_stub_status_module/#stub_status","title":"stub_status","text":"- \u8bf4\u660e \u8bed\u6cd5 stub_status; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 server\u3001location <p>\u53ef\u4ee5\u4ece\u5305\u542b\u8be5\u6307\u4ee4\u7684 location \u8bbf\u95ee\u57fa\u672c\u72b6\u6001\u4fe1\u606f\u3002</p> <p>\u5728 1.7.5 \u4e4b\u524d\u7684\u7248\u672c\u4e2d\uff0c\u6307\u4ee4\u8bed\u6cd5\u9700\u8981\u4e00\u4e2a\u4efb\u610f\u53c2\u6570\uff0c\u4f8b\u5982 <code>stub_status on</code>\u3002</p>"},{"location":"Modules-reference/http/ngx_http_stub_status_module/#_3","title":"\u6570\u636e","text":"<p>\u63d0\u4f9b\u4ee5\u4e0b\u72b6\u6001\u4fe1\u606f\uff1a</p> <ul> <li> <p><code>Active connections</code></p> <p>\u5f53\u524d\u6d3b\u52a8\u5ba2\u6237\u7aef\u8fde\u63a5\u6570\uff0c\u5305\u62ec\u7b49\u5f85\u8fde\u63a5\u3002</p> </li> <li> <p><code>accepts</code></p> <p>\u5df2\u63a5\u53d7\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\u603b\u6570\u3002</p> </li> <li> <p><code>handled</code></p> <p>\u5df2\u5904\u7406\u8fde\u63a5\u7684\u603b\u6570\u3002\u901a\u5e38\uff0c\u53c2\u6570\u503c\u4e0e <code>accept</code> \u76f8\u540c\uff0c\u9664\u975e\u5df2\u8fbe\u5230\u67d0\u4e9b\u8d44\u6e90\u9650\u5236\u9608\u503c\uff08\u4f8b\u5982\uff0cworker_connections \u9650\u5236\uff09\u3002</p> </li> <li> <p><code>requests</code></p> <p>\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u603b\u6570\u3002</p> </li> <li> <p><code>Reading</code></p> <p>nginx \u6b63\u5728\u8bfb\u53d6\u8bf7\u6c42\u5934\u7684\u5f53\u524d\u8fde\u63a5\u6570\u3002</p> </li> <li> <p><code>Writing</code></p> <p>nginx \u5c06\u54cd\u5e94\u5199\u56de\u5ba2\u6237\u7aef\u7684\u5f53\u524d\u8fde\u63a5\u6570\u3002</p> </li> <li> <p><code>Waiting</code></p> <p>\u5f53\u524d\u7b49\u5f85\u8bf7\u6c42\u7684\u7a7a\u95f2\u5ba2\u6237\u7aef\u8fde\u63a5\u6570\u3002</p> </li> </ul> <p></p>"},{"location":"Modules-reference/http/ngx_http_stub_status_module/#_4","title":"\u5185\u5d4c\u53d8\u91cf","text":"<p><code>ngx_http_stub_status_module</code> \u6a21\u5757\u652f\u6301\u4ee5\u4e0b\u5185\u5d4c\u53d8\u91cf\uff081.3.14\uff09\uff1a</p> <ul> <li> <p><code>$connections_active</code></p> <p>\u4e0e <code>Active connections</code> \u7684\u503c\u76f8\u540c</p> </li> <li> <p><code>$connections_reading</code></p> <p>\u4e0e <code>Reading</code> \u7684\u503c\u76f8\u540c</p> </li> <li> <p><code>$connections_writing</code></p> <p>\u4e0e <code>Writing</code> \u7684\u503c\u76f8\u540c</p> </li> <li> <p><code>$connections_waiting</code></p> <p>\u4e0e <code>Waiting</code> \u7684\u503c\u76f8\u540c</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_stub_status_module/#_5","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/http/ngx_http_stub_status_module.html</li> </ul>"},{"location":"Modules-reference/http/ngx_http_sub_module/","title":"ngx_http_sub_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>sub_filter</li> <li>sub_filter_last_modified</li> <li>sub_filter_once</li> <li>sub_filter_types</li> </ul> </li> </ul> <p><code>ngx_http_sub_module</code> \u6a21\u5757\u662f\u4e00\u4e2a\u8fc7\u6ee4\u5668\uff0c\u5b83\u901a\u8fc7\u66ff\u6362\u6307\u5b9a\u7684\u5b57\u7b26\u4e32\u6765\u4fee\u6539\u54cd\u5e94\u6570\u636e\u3002</p> <p>\u9ed8\u8ba4\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\uff0c\u53ef\u5728\u6784\u5efa\u65f6\u4f7f\u7528 <code>--with-http_sub_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_sub_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location / {\nsub_filter '&lt;a href=\"http://127.0.0.1:8080/'  '&lt;a href=\"https://$host/';\nsub_filter '&lt;img src=\"http://127.0.0.1:8080/' '&lt;img src=\"https://$host/';\nsub_filter_once on;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_sub_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_sub_module/#sub_filter","title":"sub_filter","text":"- \u8bf4\u660e \u8bed\u6cd5 sub_filter <code>string replacement</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u8981\u66ff\u6362\u7684\u5b57\u7b26\u4e32\uff08<code>string</code>\uff09\u548c\u8981\u66ff\u6362\u6210\u7684\u5b57\u7b26\u4e32\uff08<code>replacement</code>\uff09\u3002\u8981\u66ff\u6362\u7684\u5b57\u7b26\u4e32\u5339\u914d\u5ffd\u7565\u5927\u5c0f\u5199\u3002\u8981\u66ff\u6362\u7684\u5b57\u7b26\u4e32\uff081.9.4\uff09\u548c\u8981\u66ff\u6362\u6210\u7684\u5b57\u7b26\u4e32\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002\u53ef\u4ee5\u5728\u4e00\u4e2a\u914d\u7f6e\u7ea7\u522b\u6307\u5b9a\u51e0\u4e2a <code>sub_filter</code> \u6307\u4ee4\uff081.9.4\uff09\u3002\u5f53\u4e14\u4ec5\u5f53\u5728\u5f53\u524d\u7ea7\u522b\u4e0a\u6ca1\u6709\u5b9a\u4e49 <code>sub_filter</code> \u6307\u4ee4\u65f6\uff0c\u8fd9\u4e9b\u6307\u4ee4\u624d\u4ece\u4e0a\u7ea7\u7ee7\u627f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_sub_module/#sub_filter_last_modified","title":"sub_filter_last_modified","text":"- \u8bf4\u660e \u8bed\u6cd5 sub_filter_last_modified <code>on</code> | <code>off</code>; \u9ed8\u8ba4 sub_filter_last_modified off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.1 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5141\u8bb8\u5728\u66ff\u6362\u671f\u95f4\u4fdd\u7559\u539f\u59cb\u54cd\u5e94\u4e2d\u7684 Last-Modified \u5934\u5b57\u6bb5\uff0c\u7528\u4e8e\u54cd\u5e94\u7f13\u5b58\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728\u5904\u7406\u671f\u95f4\u4fee\u6539\u54cd\u5e94\u7684\u5185\u5bb9\u65f6\uff0c\u5c06\u5220\u9664\u5934\u5b57\u6bb5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_sub_module/#sub_filter_once","title":"sub_filter_once","text":"- \u8bf4\u660e \u8bed\u6cd5 sub_filter_once <code>on</code> | <code>off</code>; \u9ed8\u8ba4 sub_filter_once on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u53ea\u67e5\u627e\u4e00\u6b21\u8981\u66ff\u6362\u7684\u6bcf\u4e2a\u5b57\u7b26\u4e32\u6216\u91cd\u590d\u67e5\u627e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_sub_module/#sub_filter_types","title":"sub_filter_types","text":"- \u8bf4\u660e \u8bed\u6cd5 sub_filter_types <code>mime-type ...</code>; \u9ed8\u8ba4 sub_filter_types text/html; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u9664\u4e86 text/html \u4e4b\u5916\uff0c\u8fd8\u6307\u5b9a\u5728\u5176\u4ed6 MIME \u7c7b\u578b\u7684\u54cd\u5e94\u4e2d\u542f\u7528\u5b57\u7b26\u4e32\u66ff\u6362\u3002\u7279\u6b8a\u503c <code>*</code> \u5339\u914d\u4efb\u4f55 MIME \u7c7b\u578b\uff080.8.29\uff09\u3002</p>"},{"location":"Modules-reference/http/ngx_http_sub_module/#_3","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/http/ngx_http_sub_module.html</li> </ul>"},{"location":"Modules-reference/http/ngx_http_upstream_conf_module/","title":"ngx_http_upstream_conf_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>upstream_conf</li> </ul> </li> </ul> <p>\u76f4\u5230 1.13.10 \u7248\u672c\uff0c\u5b83\u88ab 1.13.3 \u4e2d\u7684 ngx_http_api_module \u6a21\u5757\u6240\u53d6\u4ee3\u3002</p> <p><code>ngx_http_upstream_conf_module</code> \u6a21\u5757\u5141\u8bb8\u901a\u8fc7\u7b80\u5355\u7684 HTTP \u63a5\u53e3\u5373\u65f6\u914d\u7f6e\u4e0a\u6e38\uff08upstream\uff09\u670d\u52a1\u5668\u7ec4\uff0c\u800c\u65e0\u9700\u91cd\u65b0\u542f\u52a8 nginx\u3002http \u6216\u6d41\u670d\u52a1\u5668\u7ec4\u5fc5\u987b\u9a7b\u7559\u5728\u5171\u4eab\u5185\u5b58\u4e2d\u3002</p> <p>\u8be5\u6a21\u5757\u4f5c\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u63d0\u4f9b\uff0c</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_upstream_conf_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>upstream backend {\nzone upstream_backend 64k;\n\n...\n}\n\nserver {\nlocation /upstream_conf {\nupstream_conf;\nallow 127.0.0.1;\ndeny all;\n}\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_upstream_conf_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_upstream_conf_module/#upstream_conf","title":"upstream_conf","text":"- \u8bf4\u660e \u8bed\u6cd5 upstream_conf; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 location <p>\u5728 location \u4e2d\u5f15\u5165\u8be5\u6307\u4ee4\uff0c\u5f00\u542f\u4e0a\u6e38\u914d\u7f6e HTTP \u63a5\u53e3\u3002 \u5e94\u9650\u5236\u8bbf\u95ee\u6b64 location\u3002</p> <p>\u914d\u7f6e\u547d\u4ee4\u53ef\u7528\u4e8e\uff1a</p> <ul> <li>\u67e5\u770b\u7ec4\u914d\u7f6e</li> <li>\u67e5\u770b\u3001\u4fee\u6539\u6216\u5220\u9664\u670d\u52a1\u5668</li> <li>\u6dfb\u52a0\u65b0\u670d\u52a1\u5668</li> </ul> <p>\u7531\u4e8e\u7ec4\u4e2d\u7684\u5730\u5740\u4e0d\u8981\u6c42\u552f\u4e00\uff0c\u56e0\u6b64\u7ec4\u4e2d\u7684\u670d\u52a1\u5668\u4f7f\u7528 ID \u5f15\u7528\u3002\u6dfb\u52a0\u65b0\u670d\u52a1\u5668\u6216\u67e5\u770b\u7ec4\u914d\u7f6e\u65f6\uff0c\u4f1a\u81ea\u52a8\u5206\u914d ID \u5e76\u663e\u793a ID\u3002</p> <p>\u914d\u7f6e\u547d\u4ee4\u4f5c\u4e3a\u8bf7\u6c42\u53c2\u6570\u4f20\u5165\uff0c\u4f8b\u5982\uff1a</p> <pre><code>http://127.0.0.1/upstream_conf?upstream=backend\n</code></pre> <p>\u652f\u6301\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <ul> <li> <p><code>stream=</code></p> <p>\u9009\u62e9\u4e00\u4e2a stream \u4e0a\u6e38\u670d\u52a1\u5668\u7ec4\u3002\u5982\u679c\u6ca1\u6709\u6b64\u53c2\u6570\uff0c\u5c06\u9009\u62e9\u4e00\u4e2a http \u4e0a\u6e38\u670d\u52a1\u5668\u7ec4\u3002</p> </li> <li> <p><code>upstream=name</code></p> <p>\u9009\u62e9\u8981\u4f7f\u7528\u7684\u7ec4\u3002\u6b64\u53c2\u6570\u662f\u5fc5\u9700\u7684\u3002</p> </li> <li> <p><code>id=number</code></p> <p>\u9009\u62e9\u4e00\u4e2a\u8981\u67e5\u770b\u3001\u4fee\u6539\u6216\u5220\u9664\u7684\u670d\u52a1\u5668\u3002</p> </li> <li> <p><code>remove=</code></p> <p>\u4ece\u7ec4\u4e2d\u5220\u9664\u4e00\u4e2a\u670d\u52a1\u5668\u3002</p> </li> <li> <p><code>add=</code></p> <p>\u5411\u7ec4\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u65b0\u670d\u52a1\u5668\u3002</p> </li> <li> <p><code>backup=</code></p> <p>\u9700\u8981\u6dfb\u52a0\u4e00\u4e2a\u5907\u7528\u670d\u52a1\u5668\u3002</p> <p>\u5728 1.7.2 \u7248\u4e4b\u524d\uff0c\u67e5\u770b\u3001\u4fee\u6539\u6216\u5220\u9664\u73b0\u6709\u5907\u7528\u670d\u52a1\u5668\u8fd8\u9700\u8981 <code>backup=</code> \u53c2\u6570\u3002</p> </li> <li> <p><code>server=address</code></p> <p>\u4e0e http \u6216 stream \u4e0a\u6e38\u670d\u52a1\u5668\u7684 <code>address</code> \u53c2\u6570\u76f8\u540c\u3002</p> <p>\u6dfb\u52a0\u670d\u52a1\u5668\u65f6\uff0c\u53ef\u4ee5\u5c06\u5176\u6307\u5b9a\u4e3a\u4e00\u4e2a\u57df\u540d\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u76d1\u89c6\u4e0e\u57df\u540d\u5bf9\u5e94\u7684 IP \u5730\u5740\u7684\u66f4\u6539\u5e76\u81ea\u52a8\u5e94\u7528\u4e8e\u4e0a\u6e38\u914d\u7f6e\uff0c\u65e0\u9700\u91cd\u65b0\u542f\u52a8 nginx\uff081.7.2\uff09\u3002\u8fd9\u9700\u8981 http \u6216 stream \u5757\u4e2d\u7684 <code>resolver</code> \u6307\u4ee4\u3002\u53e6\u8bf7\u53c2\u9605 http \u6216 stream \u4e0a\u6e38\u670d\u52a1\u5668\u7684 <code>resolve</code> \u53c2\u6570\u3002</p> </li> <li> <p><code>service=name</code></p> <p>\u4e0e http \u6216 stream \u4e0a\u6e38\u670d\u52a1\u5668\u7684 <code>service</code> \u53c2\u6570\u76f8\u540c\uff081.9.13\uff09\u3002</p> </li> <li> <p><code>weight=number</code></p> <p>\u4e0e http \u6216 stream \u4e0a\u6e38\u670d\u52a1\u5668\u7684 <code>weight</code> \u53c2\u6570\u76f8\u540c\u3002</p> </li> <li> <p><code>max_conns=number</code></p> <p>\u4e0e http \u6216 stream \u4e0a\u6e38\u670d\u52a1\u5668\u7684 <code>max_conns</code> \u53c2\u6570\u76f8\u540c\u3002</p> </li> <li> <p><code>max_fails=number</code></p> <p>\u4e0e http \u6216 stream \u4e0a\u6e38\u670d\u52a1\u5668\u7684 <code>max_fails</code> \u53c2\u6570\u76f8\u540c\u3002</p> </li> <li> <p><code>fail_timeout=time</code></p> <p>\u4e0e http \u6216 stream \u4e0a\u6e38\u670d\u52a1\u5668\u7684 <code>fail_timeout</code> \u53c2\u6570\u76f8\u540c\u3002</p> </li> <li> <p><code>slow_start=time</code></p> <p>\u4e0e http \u6216 stream \u4e0a\u6e38\u670d\u52a1\u5668\u7684 <code>slow_start</code> \u53c2\u6570\u76f8\u540c\u3002</p> </li> <li> <p><code>down=</code></p> <p>\u4e0e http \u6216 stream \u4e0a\u6e38\u670d\u52a1\u5668\u7684 <code>down</code> \u53c2\u6570\u76f8\u540c\u3002</p> </li> <li> <p><code>drain=</code>     \u5c06 http \u4e0a\u6e38\u670d\u52a1\u5668\u7f6e\u4e3a <code>draining</code> \u6a21\u5f0f\uff081.7.5\uff09\u3002\u5728\u6b64\u6a21\u5f0f\u4e0b\uff0c\u53ea\u6709\u7ed1\u5b9a\u5230\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u624d\u4f1a\u88ab\u4ee3\u7406\u3002</p> </li> <li> <p><code>up=</code></p> <p>\u4e0e http \u6216 stream \u4e0a\u6e38\u670d\u52a1\u5668\u7684 <code>down</code> \u53c2\u6570\u76f8\u53cd\u3002</p> </li> <li> <p><code>route=string</code></p> <p>\u4e0e http \u4e0a\u6e38\u670d\u52a1\u5668\u7684 <code>route</code> \u53c2\u6570\u76f8\u540c\u3002</p> </li> </ul> <p>\u524d\u4e09\u4e2a\u53c2\u6570\u4f1a\u9009\u62e9\u4e00\u4e2a\u5bf9\u8c61\u3002\u8fd9\u53ef\u4ee5\u662f\u6574\u4e2a http \u6216 stream \u4e0a\u6e38\u670d\u52a1\u5668\u7ec4\uff0c\u4e5f\u53ef\u4ee5\u662f\u7279\u5b9a\u670d\u52a1\u5668\u3002\u5982\u679c\u6ca1\u6709\u5176\u4ed6\u53c2\u6570\uff0c\u5219\u4f1a\u663e\u793a\u6240\u9009\u7ec4\u6216\u670d\u52a1\u5668\u7684\u914d\u7f6e\u3002</p> <p>\u4f8b\u5982\uff0c\u8981\u67e5\u770b\u6574\u4e2a\u7ec4\u7684\u914d\u7f6e\uff0c\u8bf7\u53d1\u9001\uff1a</p> <pre><code>http://127.0.0.1/upstream_conf?upstream=backend\n</code></pre> <p>\u8981\u67e5\u770b\u7279\u5b9a\u670d\u52a1\u5668\u7684\u914d\u7f6e\uff0c\u8fd8\u8981\u6307\u5b9a\u5176 ID\uff1a</p> <pre><code>http://127.0.0.1/upstream_conf?upstream=backend&amp;id=42\n</code></pre> <p>\u8981\u6dfb\u52a0\u65b0\u670d\u52a1\u5668\uff0c\u8bf7\u5728 <code>server=</code> \u53c2\u6570\u4e2d\u6307\u5b9a\u5176\u5730\u5740\u3002\u5982\u679c\u672a\u6307\u5b9a\u5176\u4ed6\u53c2\u6570\uff0c\u6dfb\u52a0\u670d\u52a1\u5668\u65f6\u5c06\u5176\u4ed6\u53c2\u6570\u8bbe\u7f6e\u4e3a\u5176\u9ed8\u8ba4\u503c\uff08\u8bf7\u53c2\u9605 http \u6216 stream \u7684 <code>server</code> \u6307\u4ee4\uff09\u3002</p> <p>\u4f8b\u5982\uff0c\u8981\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u4e3b\u670d\u52a1\u5668\uff0c\u8bf7\u53d1\u9001\uff1a</p> <pre><code>http://127.0.0.1/upstream_conf?add=&amp;upstream=backend&amp;server=127.0.0.1:8080\n</code></pre> <p>\u8981\u6dfb\u52a0\u4e00\u4e2a\u5907\u7528\u670d\u52a1\u5668\uff0c\u53d1\u9001\uff1a</p> <pre><code>http://127.0.0.1/upstream_conf?add=&amp;upstream=backend&amp;backup=&amp;server=127.0.0.1:8080\n</code></pre> <p>\u8981\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684\u4e3b\u670d\u52a1\u5668\uff0c\u5c06\u5176\u53c2\u6570\u8bbe\u7f6e\u4e3a\u975e\u9ed8\u8ba4\u503c\u5e76\u5c06\u5176\u6807\u8bb0\u4e3a <code>down</code>\uff0c\u53d1\u9001\uff1a</p> <pre><code>http://127.0.0.1/upstream_conf?add=&amp;upstream=backend&amp;server=127.0.0.1:8080&amp;weight=2&amp;down=\n</code></pre> <p>\u5220\u9664\u4e00\u4e2a\u670d\u52a1\u5668\uff0c\u6307\u5b9a\u5176 ID\uff1a</p> <pre><code>http://127.0.0.1/upstream_conf?remove=&amp;upstream=backend&amp;id=42\n</code></pre> <p>\u8bb2\u4e00\u4e2a\u73b0\u6709\u7684\u670d\u52a1\u5668\u6807\u8bb0\u4e3a <code>down</code>\uff0c\u53d1\u9001\uff1a</p> <pre><code>http://127.0.0.1/upstream_conf?upstream=backend&amp;id=42&amp;down=\n</code></pre> <p>\u4fee\u6539\u4e00\u4e2a\u73b0\u6709\u670d\u52a1\u5668\u7684\u5730\u5740\uff0c\u53d1\u9001\uff1a</p> <pre><code>http://127.0.0.1/upstream_conf?upstream=backend&amp;id=42&amp;server=192.0.2.3:8123\n</code></pre> <p>\u4fee\u6539\u4e00\u4e2a\u73b0\u6709\u670d\u52a1\u5668\u7684\u5176\u4ed6\u53c2\u6570\uff0c\u53d1\u9001\uff1a</p> <pre><code>http://127.0.0.1/upstream_conf?upstream=backend&amp;id=42&amp;max_fails=3&amp;weight=4\n</code></pre> <p>\u4ee5\u4e0a\u793a\u4f8b\u9002\u7528\u4e8e http \u4e0a\u6e38\u670d\u52a1\u5668\u7ec4\u3002stream \u4e0a\u6e38\u670d\u52a1\u5668\u7ec4\u9700\u8981\u52a0\u4e0a <code>stream=</code> \u53c2\u6570\u3002</p>"},{"location":"Modules-reference/http/ngx_http_upstream_conf_module/#_3","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/http/ngx_http_upstream_conf_module.html</li> </ul>"},{"location":"Modules-reference/http/ngx_http_upstream_hc_module/","title":"ngx_http_upstream_hc_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>health_check</li> <li>match</li> </ul> </li> </ul> <p><code>ngx_http_upstream_hc_module</code> \u6a21\u5757\u5141\u8bb8\u5bf9\u5468\u8fb9 location \u4e2d\u5f15\u7528\u7684\u7ec4\u4e2d\u7684\u670d\u52a1\u5668\u8fdb\u884c\u5b9a\u671f\u5065\u5eb7\u68c0\u67e5\u3002\u670d\u52a1\u5668\u7ec4\u5fc5\u987b\u9a7b\u7559\u5728\u5171\u4eab\u5185\u5b58\u4e2d\u3002</p> <p>\u5982\u679c\u5065\u5eb7\u68c0\u67e5\u5931\u8d25\uff0c\u5219\u670d\u52a1\u5668\u5c06\u88ab\u89c6\u4e3a\u8fd0\u884c\u72b6\u51b5\u4e0d\u4f73\u3002\u5982\u679c\u4e3a\u540c\u4e00\u7ec4\u670d\u52a1\u5668\u5b9a\u4e49\u4e86\u591a\u4e2a\u5065\u5eb7\u68c0\u67e5\uff0c\u5219\u4efb\u4f55\u68c0\u67e5\u7684\u5355\u4e2a\u6545\u969c\u90fd\u5c06\u4f7f\u76f8\u5e94\u7684\u670d\u52a1\u5668\u88ab\u89c6\u4e3a\u8fd0\u884c\u72b6\u51b5\u4e0d\u4f73\u3002\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e0d\u4f1a\u4f20\u9012\u5230\u5904\u4e8e checking \u72b6\u6001\u7684\u670d\u52a1\u5668\u548c\u4e0d\u5065\u5eb7\u7684\u670d\u52a1\u5668\u3002</p> <p>\u8bf7\u6ce8\u610f\uff0c\u4e0e\u5065\u5eb7\u68c0\u67e5\u4e00\u8d77\u4f7f\u7528\u65f6\uff0c\u5927\u591a\u6570\u53d8\u91cf\u90fd\u5c06\u4e3a\u7a7a\u503c\u3002</p> <p>\u8be5\u6a21\u5757\u4f5c\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u63d0\u4f9b\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_upstream_hc_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>upstream dynamic {\nzone upstream_dynamic 64k;\n\nserver backend1.example.com      weight=5;\nserver backend2.example.com:8080 fail_timeout=5s slow_start=30s;\nserver 192.0.2.1                 max_fails=3;\n\nserver backup1.example.com:8080  backup;\nserver backup2.example.com:8080  backup;\n}\n\nserver {\nlocation / {\nproxy_pass http://dynamic;\nhealth_check;\n}\n}\n</code></pre> <p>\u4f7f\u7528\u6b64\u914d\u7f6e\uff0cnginx \u5c06\u6bcf\u9694\u4e94\u79d2\u5411 <code>backend</code> \u7ec4\u4e2d\u7684\u6bcf\u4e2a\u670d\u52a1\u5668\u53d1\u9001 <code>/</code> \u8bf7\u6c42\u3002\u5982\u679c\u53d1\u751f\u4efb\u4f55\u901a\u4fe1\u9519\u8bef\u6216\u8d85\u65f6\uff0c\u6216\u4ee3\u7406\u670d\u52a1\u5668\u4ee5 2xx \u6216 3xx \u4ee5\u5916\u7684\u72b6\u6001\u7801\u54cd\u5e94\uff0c\u5219\u5065\u5eb7\u68c0\u67e5\u5c06\u5931\u8d25\uff0c\u5e76\u4e14\u670d\u52a1\u5668\u5c06\u88ab\u89c6\u4e3a\u8fd0\u884c\u72b6\u51b5\u4e0d\u4f73\u3002</p> <p>\u53ef\u4ee5\u914d\u7f6e\u5065\u5eb7\u68c0\u67e5\u4ee5\u6d4b\u8bd5\u54cd\u5e94\u7684\u72b6\u6001\u7801\u3001\u67d0\u4e9b\u5934\u5b57\u6bb5\u53ca\u5176\u503c\u7684\u5b58\u5728\u4ee5\u53ca\u62a5\u6587\u4f53\u3002\u6d4b\u8bd5\u4f7f\u7528 match \u6307\u4ee4\u5355\u72ec\u914d\u7f6e\uff0c\u5e76\u5728 health_check \u6307\u4ee4\u7684 <code>match</code> \u53c2\u6570\u4e2d\u5f15\u7528\uff1a</p> <pre><code>http {\nserver {\n...\nlocation / {\nproxy_pass http://backend;\nhealth_check match=welcome;\n}\n}\n\nmatch welcome {\nstatus 200;\nheader Content-Type = text/html;\nbody ~ \"Welcome to nginx!\";\n}\n}\n</code></pre> <p>\u6b64\u914d\u7f6e\u663e\u793a\uff0c\u53d1\u8d77\u4f20\u9012\u4e00\u4e2a\u5065\u5eb7\u68c0\u67e5\uff0c\u5065\u5eb7\u68c0\u67e5\u8bf7\u6c42\u7684\u54cd\u5e94\u5e94\u8be5\u4e3a\u6210\u529f\uff0c\u72b6\u6001\u7801\u4e3a 200\uff0c\u5e76\u5728\u6b63\u6587\u4e2d\u5305\u542b <code>Welcome to nginx!</code>\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_upstream_hc_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_upstream_hc_module/#health_check","title":"health_check","text":"- \u8bf4\u660e \u8bed\u6cd5 health_check <code>[parameters]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 location <p>\u542f\u7528\u5bf9\u5468\u8fb9 location \u4e2d\u5f15\u7528\u7684\u7ec4\u4e2d\u7684\u670d\u52a1\u5668\u5b9a\u671f\u5065\u5eb7\u68c0\u67e5\u3002</p> <p>\u652f\u6301\u4ee5\u4e0b\u53ef\u9009\u53c2\u6570\uff1a</p> <ul> <li> <p><code>interval=time</code></p> <p>\u8bbe\u7f6e\u4e24\u6b21\u8fde\u7eed\u5065\u5eb7\u68c0\u67e5\u4e4b\u95f4\u7684\u95f4\u9694\u65f6\u95f4\uff0c\u9ed8\u8ba4\u4e3a 5 \u79d2</p> </li> <li> <p><code>jitter=time</code></p> <p>\u8bbe\u7f6e\u6bcf\u4e2a\u5065\u5eb7\u68c0\u67e5\u968f\u673a\u5ef6\u8fdf\u7684\u65f6\u95f4\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6ca1\u6709\u5ef6\u8fdf</p> </li> <li> <p><code>fails=number</code></p> <p>\u8bbe\u7f6e\u7279\u5b9a\u670d\u52a1\u5668\u7684\u8fde\u7eed\u5931\u8d25\u5065\u5eb7\u68c0\u67e5\u7684\u6570\u91cf\uff0c\u5728\u6b64\u4e4b\u540e\uff0c\u6b64\u670d\u52a1\u5668\u5c06\u88ab\u89c6\u4e3a\u4e0d\u5065\u5eb7\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a 1\u3002</p> </li> <li> <p><code>passes=number</code></p> <p>\u8bbe\u7f6e\u7279\u5b9a\u670d\u52a1\u5668\u7684\u8fde\u7eed\u901a\u8fc7\u5065\u5eb7\u68c0\u67e5\u7684\u6570\u91cf\uff0c\u5728\u6b64\u4e4b\u540e\u670d\u52a1\u5668\u5c06\u88ab\u89c6\u4e3a\u5065\u5eb7\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a 1\u3002</p> </li> <li> <p><code>uri=uri</code></p> <p>\u5b9a\u4e49\u5065\u5eb7\u68c0\u67e5\u8bf7\u6c42\u4e2d\u4f7f\u7528\u7684 URI\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a <code>/</code>\u3002</p> </li> <li> <p><code>mandatory</code></p> <p>\u8bbe\u7f6e\u670d\u52a1\u5668\u7684\u521d\u59cb checking \u72b6\u6001\uff0c\u76f4\u5230\u7b2c\u4e00\u6b21\u8fd0\u884c\u5065\u5eb7\u68c0\u67e5\u5b8c\u6210\uff081.11.7\uff09\u3002\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e0d\u4f1a\u4f20\u9012\u5230\u5904\u4e8e checking \u72b6\u6001\u7684\u670d\u52a1\u5668\u3002\u5982\u679c\u672a\u6307\u5b9a\u53c2\u6570\uff0c\u5219\u670d\u52a1\u5668\u5f00\u59cb\u5c06\u88ab\u89c6\u4e3a\u5065\u5eb7\u3002</p> </li> <li> <p><code>match=name</code></p> <p>\u6307\u5b9a <code>match</code> \u5757\u914d\u7f6e\u6d4b\u8bd5\uff0c\u4e3a\u54cd\u5e94\u901a\u8fc7\u6d4b\u8bd5\u505a\u53c2\u7167\uff0c\u4ee5\u4fbf\u901a\u8fc7\u5065\u5eb7\u68c0\u67e5\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u54cd\u5e94\u7684\u72b6\u6001\u7801\u5e94\u4e3a 2xx \u6216 3xx\u3002</p> </li> <li> <p><code>port=number</code></p> <p>\u5b9a\u4e49\u8fde\u63a5\u5230\u670d\u52a1\u5668\u4ee5\u6267\u884c\u5065\u5eb7\u68c0\u67e5\u65f6\u4f7f\u7528\u7684\u7aef\u53e3\uff081.9.7\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7b49\u4e8e server \u7aef\u53e3\u3002</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_upstream_hc_module/#match","title":"match","text":"- \u8bf4\u660e \u8bed\u6cd5 match <code>name { ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u5b9a\u4e49\u7528\u4e8e\u9a8c\u8bc1\u5065\u5eb7\u68c0\u67e5\u8bf7\u6c42\u7684\u54cd\u5e94\u7684\u5177\u540d\u6d4b\u8bd5\u96c6\u3002</p> <p>\u53ef\u4ee5\u5728\u54cd\u5e94\u4e2d\u6d4b\u8bd5\u4ee5\u4e0b\u9879\u76ee\uff1a</p> <ul> <li> <p><code>status 200;</code></p> <p>\u72b6\u6001\u7801\u4e3a 200</p> </li> <li> <p><code>status ! 500;</code></p> <p>\u72b6\u6001\u7801\u975e 500</p> </li> <li> <p><code>status 200 204;</code></p> <p>\u72b6\u6001\u7801\u4e3a 200 \u6216 204</p> </li> <li> <p><code>status ! 301 302;</code></p> <p>\u72b6\u6001\u7801\u65e2\u4e0d\u662f 301 \u4e5f\u4e0d\u662f 302</p> </li> <li> <p><code>status 200-399;</code></p> <p>\u72b6\u6001\u7801\u5728 200 \u5230 399 \u4e4b\u95f4</p> </li> <li> <p><code>status ! 400-599;</code></p> <p>\u72b6\u6001\u7801\u4e0d\u5728 400 \u5230 599 \u4e4b\u95f4</p> </li> <li> <p><code>status 301-303 307;</code></p> <p>\u72b6\u6001\u7801\u4e3a 301\u3001302\u3001303 \u6216 307</p> </li> <li> <p><code>header Content-Type = text/html;</code></p> <p>header \u5305\u542b\u503c\u4e3a <code>text/html</code> \u7684 Content-Type</p> </li> <li> <p><code>header Content-Type != text/html;</code></p> <p>header \u5305\u542b Content-Type\uff0c\u5176\u503c\u4e0d\u662f <code>text/html</code></p> </li> <li> <p><code>header Connection ~ close;</code></p> <p>header \u5305\u542b Connection \uff0c\u5176\u503c\u4e0e\u6b63\u5219\u8868\u8fbe\u5f0f <code>close</code> \u5339\u914d</p> </li> <li> <p><code>header Connection !~ close;</code></p> <p>header \u5305\u542b Connection\uff0c\u5176\u503c\u4e0e\u6b63\u5219\u8868\u8fbe\u5f0f <code>close</code> \u4e0d\u5339\u914d</p> </li> <li> <p><code>header Host;</code></p> <p>header \u5305\u542b Host</p> </li> <li> <p><code>header ! X-Accel-Redirect;</code></p> <p>header \u6ca1\u6709 X-Accel-Redirect</p> </li> <li> <p><code>body ~ \"Welcome to nginx!\";</code></p> <p>\u6b63\u6587\u5185\u5bb9\u5339\u914d\u6b63\u5219\u8868\u8fbe\u5f0f <code>Welcome to nginx!</code></p> </li> <li> <p><code>body !~ \"Welcome to nginx!\";</code></p> <p>\u6b63\u6587\u5185\u5bb9\u4e0d\u7b26\u5408\u6b63\u5219\u8868\u8fbe\u5f0f <code>Welcome to nginx!</code></p> </li> <li> <p><code>require $variable ...;</code></p> <p>\u6240\u6709\u6307\u5b9a\u7684\u53d8\u91cf\u90fd\u4e0d\u4e3a\u7a7a\u4e14\u4e0d\u7b49\u4e8e <code>\"0\"</code>\uff081.15.9\uff09\u3002</p> </li> </ul> <p>\u5982\u679c\u6307\u5b9a\u4e86\u591a\u4e2a\u6d4b\u8bd5\uff0c\u5219\u54cd\u5e94\u4ec5\u5728\u5339\u914d\u6240\u6709\u6d4b\u8bd5\u65f6\u624d\u5339\u914d\u3002</p> <p>\u4ec5\u68c0\u67e5\u54cd\u5e94\u4f53\u7684\u524d 256k \u6570\u636e\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code># status is 200, content type is \"text/html\",\n# and body contains \"Welcome to nginx!\"\nmatch welcome {\nstatus 200;\nheader Content-Type = text/html;\nbody ~ \"Welcome to nginx!\";\n}\n# status is not one of 301, 302, 303, or 307, and header does not have \"Refresh:\"\nmatch not_redirect {\nstatus ! 301-303 307;\nheader ! Refresh;\n}\n# status ok and not in maintenance mode\nmatch server_ok {\nstatus 200-399;\nbody !~ \"maintenance mode\";\n}\n# status is 200 or 204\nmap $upstream_status $good_status {\n200 1;\n204 1;\n}\n\nmatch server_ok {\nrequire $good_status;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_upstream_hc_module/#_3","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/http/ngx_http_upstream_hc_module.html</li> </ul>"},{"location":"Modules-reference/http/ngx_http_upstream_module/","title":"ngx_http_upstream_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>upstream</li> <li>server</li> <li>zone</li> <li>state</li> <li>hash</li> <li>ip_hash</li> <li>keepalive</li> <li>keepalive_requests</li> <li>keepalive_timeout</li> <li>ntlm</li> <li>least_conn</li> <li>least_time</li> <li>queue</li> <li>random</li> <li>sticky</li> <li>sticky_cookie_insert</li> </ul> </li> <li>\u5185\u90e8\u53d8\u91cf</li> </ul> <p><code>ngx_http_upstream_module</code> \u6a21\u5757\u7528\u4e8e\u5b9a\u4e49\u53ef\u88ab proxy_pass\u3001fastcgi_pass\u3001uwsgi_pass\u3001scgi_pass\u3001memcached_pass \u548c grpc_pass \u6307\u4ee4\u5f15\u7528\u7684\u670d\u52a1\u5668\u7ec4\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>upstream backend {\nserver backend1.example.com       weight=5;\nserver backend2.example.com:8080;\nserver unix:/tmp/backend3;\n\nserver backup1.example.com:8080   backup;\nserver backup2.example.com:8080   backup;\n}\n\nserver {\nlocation / {\nproxy_pass http://backend;\n}\n}\n</code></pre> <p>\u52a8\u6001\u53ef\u914d\u7f6e\u7ec4\u5b9a\u671f\u5065\u5eb7\u68c0\u67e5\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\uff1a</p> <pre><code>resolver 10.0.0.1;\n\nupstream dynamic {\nzone upstream_dynamic 64k;\n\nserver backend1.example.com      weight=5;\nserver backend2.example.com:8080 fail_timeout=5s slow_start=30s;\nserver 192.0.2.1                 max_fails=3;\nserver backend3.example.com      resolve;\nserver backend4.example.com      service=http resolve;\n\nserver backup1.example.com:8080  backup;\nserver backup2.example.com:8080  backup;\n}\n\nserver {\nlocation / {\nproxy_pass http://dynamic;\nhealth_check;\n}\n}\n</code></pre> <p></p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_upstream_module/#upstream","title":"upstream","text":"- \u8bf4\u660e \u8bed\u6cd5 upstream <code>name { ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u5b9a\u4e49\u4e00\u7ec4\u670d\u52a1\u5668\u3002\u670d\u52a1\u5668\u53ef\u4ee5\u76d1\u542c\u4e0d\u540c\u7684\u7aef\u53e3\u3002\u6b64\u5916\uff0c\u53ef\u4ee5\u6df7\u5408\u76d1\u542c TCP \u548c UNIX \u57df\u5957\u63a5\u5b57\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>upstream backend {\nserver backend1.example.com weight=5;\nserver 127.0.0.1:8080       max_fails=3 fail_timeout=30s;\nserver unix:/tmp/backend3;\n\nserver backup1.example.com  backup;\n}\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u52a0\u6743\u8f6e\u8be2\u5747\u8861\u7b97\u6cd5\u5728\u670d\u52a1\u5668\u95f4\u5206\u914d\u8bf7\u6c42\u3002\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u6bcf 7 \u4e2a\u8bf7\u6c42\u5c06\u6309\u5982\u4e0b\u65b9\u5f0f\u5206\u53d1\uff1a5 \u4e2a\u8bf7\u6c42\u8f6c\u5230 <code>backend1.example.com</code>\uff0c\u53e6\u5916 2 \u4e2a\u8bf7\u6c42\u5206\u522b\u8f6c\u53d1\u7ed9\u7b2c\u4e8c\u4e2a\u548c\u7b2c\u4e09\u4e2a\u670d\u52a1\u5668\u3002\u5982\u679c\u5728\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u671f\u95f4\u53d1\u751f\u9519\u8bef\uff0c\u8bf7\u6c42\u5c06\u88ab\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\uff0c\u4f9d\u6b64\u7c7b\u63a8\uff0c\u76f4\u5230\u5c1d\u8bd5\u5b8c\u6240\u6709\u6b63\u5e38\u7684\u670d\u52a1\u5668\u3002\u5982\u679c\u65e0\u6cd5\u4ece\u8fd9\u4e9b\u670d\u52a1\u5668\u4e2d\u83b7\u5f97\u6210\u529f\u54cd\u5e94\uff0c\u5219\u5ba2\u6237\u7aef\u5c06\u63a5\u6536\u5230\u4e0e\u6700\u540e\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u901a\u4fe1\u7ed3\u679c\u3002</p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#server","title":"server","text":"- \u8bf4\u660e \u8bed\u6cd5 server <code>address [parameters]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream <p>\u5b9a\u4e49\u670d\u52a1\u5668\u7684\u5730\u5740\uff08<code>address</code>\uff09\u548c\u5176\u4ed6\u53c2\u6570\uff08<code>parameters</code>\uff09\u3002\u53ef\u4ee5\u5c06\u5730\u5740\u6307\u5b9a\u4e3a\u57df\u540d\u6216 IP \u5730\u5740\uff0c\u7aef\u53e3\u53ef\u9009\uff0c\u6216\u8005\u6307\u5b9a\u4e3a\u4ee5 <code>unix:</code> \u4e3a\u524d\u7f00\u7684 UNIX \u57df\u5957\u63a5\u5b57\u8def\u5f84\u3002\u5982\u679c\u672a\u6307\u5b9a\u7aef\u53e3\uff0c\u5219\u4f7f\u7528 80 \u7aef\u53e3\u3002\u89e3\u6790\u4e3a\u591a\u4e2a IP \u5730\u5740\u7684\u57df\u540d\u4e00\u6b21\u5b9a\u4e49\u591a\u4e2a\u670d\u52a1\u5668\u3002</p> <p>\u53ef\u5b9a\u4e49\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <ul> <li> <p><code>weight=number</code></p> <p>\u8bbe\u7f6e\u670d\u52a1\u5668\u7684\u6743\u91cd\uff0c\u9ed8\u8ba4\u4e3a 1\u3002</p> </li> <li> <p><code>max_conns=number</code></p> <p>\u9650\u5236\u4e0e\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u6700\u5927\u5e76\u53d1\u6d3b\u52a8\u8fde\u63a5\u6570\uff08<code>number</code>\uff09\uff081.11.5\uff09\u3002\u9ed8\u8ba4\u503c\u4e3a\u96f6\uff0c\u8868\u793a\u6ca1\u6709\u9650\u5236\u3002\u5982\u679c\u670d\u52a1\u5668\u7ec4\u4e0d\u9a7b\u7559\u5728\u5171\u4eab\u5185\u5b58\u4e2d\uff0c\u5219\u6bcf\u4e2aworker \u8fdb\u7a0b\u7684\u9650\u5236\u90fd\u6709\u6548\u3002</p> <p>\u5982\u679c\u542f\u7528\u4e86\u7a7a\u95f2 keepalive \u8fde\u63a5\u3001\u591a\u4e2a worker \u8fdb\u7a0b\u548c\u5171\u4eab\u5185\u5b58\uff0c\u5219\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u6d3b\u52a8\u548c\u7a7a\u95f2\u8fde\u63a5\u603b\u6570\u53ef\u80fd\u4f1a\u8d85\u8fc7 <code>max_conns</code> \u7684\u503c\u3002</p> <p>\u81ea 1.5.9 \u7248\u672c\u81f3 1.11.5 \u7248\u672c\u4e4b\u524d\uff0c\u6b64\u53c2\u6570\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u3002</p> </li> <li> <p><code>max_fails=number</code></p> <p>\u8bbe\u7f6e\u5728 <code>fail_timeout</code> \u53c2\u6570\u8bbe\u7f6e\u7684\u65f6\u95f4\u5185\u53d1\u751f\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u7684\u5931\u8d25\u91cd\u8bd5\u6700\u5927\u6b21\u6570\uff0c\u4ee5\u8003\u8651\u670d\u52a1\u5668\u5728 <code>fail_timeout</code> \u53c2\u6570\u8bbe\u7f6e\u7684\u65f6\u95f4\u5185\u4e0d\u53ef\u7528\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5931\u8d25\u5c1d\u8bd5\u6b21\u6570\u8bbe\u7f6e\u4e3a 1\u3002\u96f6\u503c\u5219\u7981\u6b62\u91cd\u8bd5\u8ba1\u6570\u3002\u5931\u8d25\u5c1d\u8bd5\u7531 proxy_next_upstream\u3001fastcgi_next_upstream\u3001uwsgi_next_upstream\u3001scgi_next_upstream\u3001memcached_next_upstream \u548c grpc_next_upstream \u6307\u4ee4\u5b9a\u4e49\u3002</p> </li> <li> <p><code>fail_timeout=time</code></p> <p>\u8bbe\u7f6e</p> <ul> <li>\u5728\u65f6\u95f4\u8303\u56f4\u5185\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u7684\u5931\u8d25\u5c1d\u8bd5\u8fbe\u5230\u6307\u5b9a\u6b21\u6570\uff0c\u5e94\u5c06\u670d\u52a1\u5668\u89c6\u4e3a\u4e0d\u53ef\u7528</li> <li>\u670d\u52a1\u5668\u88ab\u89c6\u4e3a\u4e0d\u53ef\u7528\u7684\u65f6\u957f</li> </ul> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u53c2\u6570\u8bbe\u7f6e\u4e3a 10 \u79d2\u3002</p> </li> <li> <p><code>backup</code></p> <p>\u5c06\u670d\u52a1\u5668\u6807\u8bb0\u4e3a\u5907\u7528\u670d\u52a1\u5668\u3002\u5f53\u4e3b\u670d\u52a1\u5668\u4e0d\u53ef\u7528\u65f6\uff0c\u5b83\u5c06\u63a5\u6536\u8bf7\u6c42\u3002</p> </li> <li> <p><code>down</code></p> <p>\u5c06\u670d\u52a1\u5668\u6807\u8bb0\u4e3a\u6c38\u4e45\u4e0d\u53ef\u7528\u3002</p> </li> </ul> <p>\u6b64\u5916\uff0c\u4ee5\u4e0b\u53c2\u6570\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\uff1a</p> <ul> <li> <p><code>resolve</code></p> <p>\u76d1\u63a7\u4e0e\u670d\u52a1\u5668\u57df\u540d\u5bf9\u5e94\u7684 IP \u5730\u5740\u7684\u53d8\u66f4\uff0c\u5e76\u81ea\u52a8\u4fee\u6539 upstream \u914d\u7f6e\uff0c\u65e0\u9700\u91cd\u65b0\u542f\u52a8 nginx\uff081.5.12\uff09\u3002\u670d\u52a1\u5668\u7ec4\u5fc5\u987b\u9a7b\u7559\u5728\u5171\u4eab\u5185\u5b58\u4e2d\u3002</p> <p>\u8981\u4f7f\u6b64\u53c2\u6570\u8d77\u4f5c\u7528\uff0c\u5fc5\u987b\u5728 http \u5757\u4e2d\u6307\u5b9a resolver \u6307\u4ee4\uff1a</p> <pre><code>http {\nresolver 10.0.0.1;\n\nupstream u {\nzone ...;\n...\nserver example.com resolve;\n}\n}\n</code></pre> </li> <li> <p><code>route=string</code></p> <p>\u8bbe\u7f6e\u670d\u52a1\u5668\u8def\u7531\u540d\u79f0\u3002</p> </li> <li> <p><code>service=name</code></p> <p>\u80fd\u591f\u89e3\u6790 DNS SRV \u8bb0\u5f55\u5e76\u8bbe\u7f6e\u670d\u52a1\u540d\u79f0\uff081.9.13\uff09\u3002\u8981\u4f7f\u6b64\u53c2\u6570\u8d77\u4f5c\u7528\uff0c\u5fc5\u987b\u4e3a\u670d\u52a1\u5668\u6307\u5b9a resolve \u53c2\u6570\u5e76\u6307\u5b9a\u4e0d\u5e26\u7aef\u53e3\u53f7\u7684\u4e3b\u673a\u540d\u3002</p> <p>\u5982\u679c\u670d\u52a1\u540d\u79f0\u4e0d\u5305\u542b\u70b9\uff08<code>.</code>\uff09\uff0c\u5219\u6784\u9020\u7b26\u5408 RFC \u7684\u540d\u79f0\uff0c\u5e76\u5c06 TCP \u534f\u8bae\u6dfb\u52a0\u5230\u670d\u52a1\u524d\u7f00\u3002\u4f8b\u5982\uff0c\u8981\u67e5\u627e <code>_http._tcp.backend.example.com</code> SRV \u8bb0\u5f55\uff0c\u5fc5\u987b\u6307\u5b9a\u8be5\u6307\u4ee4\uff1a</p> <pre><code>server backend.example.com service=http resolve;\n</code></pre> <p>\u5982\u679c\u670d\u52a1\u540d\u79f0\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u70b9\uff0c\u5219\u901a\u8fc7\u52a0\u5165\u670d\u52a1\u524d\u7f00\u548c\u670d\u52a1\u5668\u540d\u79f0\u6765\u6784\u9020\u540d\u79f0\u3002\u4f8b\u5982\uff0c\u8981\u67e5\u627e <code>_http._tcp.backend.example.com\u548cserver1.backend.example.com</code> SRV \u8bb0\u5f55\uff0c\u5fc5\u987b\u6307\u5b9a\u6307\u4ee4\uff1a</p> <pre><code>server backend.example.com service=_http._tcp resolve;\nserver example.com service=server1.backend resolve;\n</code></pre> <p>\u6700\u9ad8\u4f18\u5148\u7ea7\u7684 SRV \u8bb0\u5f55\uff08\u5177\u6709\u76f8\u540c\u6700\u4f4e\u4f18\u5148\u7ea7\u503c\u7684\u8bb0\u5f55\uff09\u88ab\u89e3\u6790\u4e3a\u4e3b\u670d\u52a1\u5668\uff0c\u5176\u4f59 SRV \u8bb0\u5f55\u88ab\u89e3\u6790\u4e3a\u5907\u4efd\u670d\u52a1\u5668\u3002\u5982\u679c\u4e3a\u670d\u52a1\u5668\u6307\u5b9a\u4e86 backup \u53c2\u6570\uff0c\u5219\u9ad8\u4f18\u5148\u7ea7 SRV \u8bb0\u5f55\u5c06\u89e3\u6790\u4e3a\u5907\u4efd\u670d\u52a1\u5668\uff0c\u5176\u4f59 SRV \u8bb0\u5f55\u5c06\u88ab\u5ffd\u7565\u3002</p> </li> <li> <p><code>slow_start=time</code></p> <p>\u5f53\u4e0d\u5065\u5eb7\u7684\u670d\u52a1\u5668\u53d8\u6210\u5065\u5eb7\u72b6\u6001\u65f6\uff0c\u6216\u8005\u670d\u52a1\u5668\u5728\u4e00\u6bb5\u65f6\u95f4\u88ab\u8ba4\u4e3a\u4e0d\u53ef\u7528\u540e\u53d8\u5f97\u53ef\u7528\u65f6\uff0c\u8bbe\u7f6e\u670d\u52a1\u5668\u5c06\u5176\u6743\u91cd\u4ece\u96f6\u6062\u590d\u5230\u6807\u79f0\u503c\u7684\u65f6\u95f4\uff08<code>time</code>\uff09\u3002\u9ed8\u8ba4\u503c\u4e3a\u96f6\uff0c\u5373\u7981\u7528\u6162\u542f\u52a8\u3002</p> <p>\u8be5\u53c2\u6570\u4e0d\u80fd\u4e0e hash \u548c ip_hash \u8d1f\u8f7d\u5747\u8861\u65b9\u5f0f\u4e00\u8d77\u4f7f\u7528\u3002</p> </li> <li> <p><code>drain</code></p> <p>\u4f7f\u670d\u52a1\u5668\u8fdb\u5165 draining \u6a21\u5f0f\uff081.13.6\uff09\u3002\u5728\u6b64\u6a21\u5f0f\u4e0b\uff0c\u53ea\u6709\u7ed1\u5b9a\u5230\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u624d\u4f1a\u88ab\u4ee3\u7406\u3002</p> <p>\u5728 1.13.6 \u7248\u4e4b\u524d\uff0c\u53ea\u80fd\u4f7f\u7528 API \u200b\u200b\u6a21\u5757\u66f4\u6539\u53c2\u6570\u3002</p> <p>\u5982\u679c\u7ec4\u4e2d\u53ea\u6709\u5355\u4e2a\u670d\u52a1\u5668\uff0c\u5219\u5ffd\u7565 <code>max_fails</code>\u3001<code>fail_timeout</code> \u548c <code>slow_start</code> \u53c2\u6570\uff0c\u5e76\u4e14\u6c38\u8fdc\u4e0d\u4f1a\u5c06\u6b64\u7c7b\u670d\u52a1\u5668\u89c6\u4e3a\u4e0d\u53ef\u7528\u3002</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#zone","title":"zone","text":"- \u8bf4\u660e \u8bed\u6cd5 zone <code>name [size]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.9.0 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5b9a\u4e49\u5171\u4eab\u5185\u5b58\u533a\u57df\u7684\u540d\u79f0\uff08<code>name</code>\uff09\u548c\u5927\u5c0f\uff08<code>size</code>\uff09\uff0c\u8be5\u533a\u57df\u5728 wo'r'kr\u4e4b\u95f4\u5171\u4eab\u7ec4\u914d\u7f6e\u548c\u8fd0\u884c\u65f6\u72b6\u6001\u3002\u51e0\u4e2a\u7ec4\u53ef\u80fd\u5171\u4eab\u540c\u4e00\u4e2a\u533a\u57df\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4ec5\u9700\u6307\u5b9a\u4e00\u6b21\u5927\u5c0f\uff08<code>size</code>\uff09\u5373\u53ef\u3002</p> <p>\u6b64\u5916\uff0c\u4f5c\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\uff0c\u6b64\u7c7b\u7ec4\u5141\u8bb8\u66f4\u6539\u7ec4\u6210\u5458\u8eab\u4efd\u6216\u4fee\u6539\u7279\u5b9a\u670d\u52a1\u5668\u7684\u8bbe\u7f6e\uff0c\u65e0\u9700\u91cd\u65b0\u542f\u52a8 nginx\u3002 \u53ef\u4ee5\u901a\u8fc7 API \u6a21\u5757\uff081.13.3\uff09\u8bbf\u95ee\u914d\u7f6e\u3002</p> <p>\u5728 1.13.3 \u7248\u4e4b\u524d\uff0c\u53ea\u80fd\u901a\u8fc7 upstream_conf \u5904\u7406\u7684\u7279\u6b8a location \u8bbf\u95ee\u914d\u7f6e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#state","title":"state","text":"- \u8bf4\u660e \u8bed\u6cd5 state <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.9.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u4e00\u4e2a\u4fdd\u6301\u52a8\u6001\u53ef\u914d\u7f6e\u7ec4\u72b6\u6001\u7684\u6587\u4ef6\uff08<code>file</code>\uff09\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>state /var/lib/nginx/state/servers.conf; # path for Linux\nstate /var/db/nginx/state/servers.conf;  # path for FreeBSD\n</code></pre> <p>\u8be5\u72b6\u6001\u76ee\u524d\u4ec5\u9650\u4e8e\u6709\u53c2\u6570\u7684\u670d\u52a1\u5668\u5217\u8868\u3002\u89e3\u6790\u914d\u7f6e\u65f6\u4f1a\u8bfb\u53d6\u6587\u4ef6\uff0c\u6bcf\u6b21\u66f4\u6539 upstream \u914d\u7f6e\u65f6\u90fd\u4f1a\u66f4\u65b0\u8be5\u6587\u4ef6\u3002\u5e94\u907f\u514d\u76f4\u63a5\u66f4\u6539\u6587\u4ef6\u5185\u5bb9\u3002\u8be5\u6307\u4ee4\u4e0d\u80fd\u4e0e server \u6307\u4ee4\u4e00\u8d77\u4f7f\u7528\u3002</p> <p>\u914d\u7f6e\u91cd\u65b0\u52a0\u8f7d\u6216\u4e8c\u8fdb\u5236\u5347\u7ea7\u671f\u95f4\u6240\u505a\u7684\u66f4\u6539\u53ef\u80fd\u4f1a\u4e22\u5931\u3002</p> <p>\u8be5\u6307\u4ee4\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u3002</p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#hash","title":"hash","text":"- \u8bf4\u660e \u8bed\u6cd5 hash <code>key [consistent]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.2 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u670d\u52a1\u5668\u7ec4\u7684\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\uff0c\u5176\u4e2d\u5ba2\u6237\u7aef/\u670d\u52a1\u5668\u6620\u5c04\u57fa\u4e8e\u54c8\u5e0c <code>key</code> \u503c\u3002<code>key</code> \u53ef\u4ee5\u5305\u542b\u6587\u672c\u3001\u53d8\u91cf\u53ca\u5176\u7ec4\u5408\u3002\u8bf7\u6ce8\u610f\uff0c\u4ece\u7ec4\u4e2d\u6dfb\u52a0\u6216\u5220\u9664\u670d\u52a1\u5668\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5927\u90e8\u5206 key \u91cd\u65b0\u6620\u5c04\u5230\u4e0d\u540c\u7684\u670d\u52a1\u5668\u3002\u8be5\u65b9\u6cd5\u4e0e Cache::Memcached Perl \u5e93\u517c\u5bb9\u3002</p> <p>\u5982\u679c\u6307\u5b9a\u4e86 <code>consistent</code> \u53c2\u6570\uff0c\u5219\u5c06\u4f7f\u7528 ketama \u4e00\u81f4\u6027\u54c8\u5e0c\u7b56\u7565\u3002\u8be5\u7b56\u7565\u786e\u4fdd\u5728\u5411\u7ec4\u4e2d\u6dfb\u52a0\u6216\u5220\u9664\u670d\u52a1\u5668\u65f6\uff0c\u53ea\u6709\u5c11\u6570 key \u88ab\u91cd\u65b0\u6620\u5c04\u5230\u4e0d\u540c\u7684\u670d\u52a1\u5668\u3002\u8fd9\u6709\u52a9\u4e8e\u4e3a\u7f13\u5b58\u670d\u52a1\u5668\u5b9e\u73b0\u66f4\u9ad8\u7684\u7f13\u5b58\u547d\u4e2d\u7387\u3002\u8be5\u65b9\u6cd5\u4e0e Cache::Memcached::Fast Perl \u5e93\u517c\u5bb9\uff0c<code>ketama_points</code> \u53c2\u6570\u8bbe\u7f6e\u4e3a 160\u3002</p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#ip_hash","title":"ip_hash","text":"- \u8bf4\u660e \u8bed\u6cd5 ip_hash; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream <p>\u6307\u5b9a\u4e00\u4e2a\u7ec4\u5e94\u4f7f\u7528\u57fa\u4e8e\u5ba2\u6237\u7aef IP \u5730\u5740\u5728\u670d\u52a1\u5668\u4e4b\u95f4\u5206\u53d1\u8bf7\u6c42\u7684\u8d1f\u8f7d\u5747\u8861\u65b9\u5f0f\u3002\u5ba2\u6237\u7aef IPv4 \u5730\u5740\u7684\u524d\u4e09\u4e2a\u516b\u4f4d\u5b57\u8282\u6216\u6574\u4e2a IPv6 \u5730\u5740\u4f5c\u4e3a\u54c8\u5e0c key\u3002\u8be5\u65b9\u6cd5\u786e\u4fdd\u6765\u81ea\u540c\u4e00\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u59cb\u7ec8\u4f20\u9012\u5230\u540c\u4e00\u670d\u52a1\u5668\uff0c\u9664\u975e\u670d\u52a1\u5668\u4e0d\u53ef\u7528\u3002\u540e\u4e00\u79cd\u60c5\u51b5\u4e0b\uff0c\u5ba2\u6237\u7aef\u8bf7\u6c42\u5c06\u88ab\u4f20\u9012\u5230\u53e6\u4e00\u4e2a\u670d\u52a1\u5668\u3002\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u59cb\u7ec8\u662f\u540c\u4e00\u53f0\u670d\u52a1\u5668\u3002</p> <p>\u4ece 1.3.2 \u548c 1.2.2 \u7248\u672c\u5f00\u59cb\u652f\u6301 IPv6 \u5730\u5740\u3002</p> <p>\u5982\u679c\u9700\u8981\u4e34\u65f6\u5220\u9664\u5176\u4e2d\u4e00\u4e2a\u670d\u52a1\u5668\uff0c\u5219\u5e94\u4f7f\u7528 <code>down</code> \u53c2\u6570\u8fdb\u884c\u6807\u8bb0\uff0c\u4ee5\u4fdd\u7559\u5ba2\u6237\u7aef IP \u5730\u5740\u7684\u5f53\u524d\u54c8\u5e0c\u503c\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>upstream backend {\nip_hash;\n\nserver backend1.example.com;\nserver backend2.example.com;\nserver backend3.example.com down;\nserver backend4.example.com;\n}\n</code></pre> <p>\u5728 1.3.1 \u548c 1.2.2 \u7248\u672c\u4e4b\u524d\uff0c\u4f7f\u7528 <code>ip_hash</code> \u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u65e0\u6cd5\u4e3a\u670d\u52a1\u5668\u6307\u5b9a\u6743\u91cd\u3002</p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#keepalive","title":"keepalive","text":"- \u8bf4\u660e \u8bed\u6cd5 keepalive <code>connections</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.4 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6fc0\u6d3b\u7f13\u5b58\u4ee5\u8fde\u63a5\u5230 upstream \u670d\u52a1\u5668\u3002</p> <p><code>connections</code> \u53c2\u6570\u8bbe\u7f6e\u5728\u6bcf\u4e2a worker\uff08worker\uff09\u7684\u7f13\u5b58\u4e2d\u4fdd\u7559\u7684 upstream \u670d\u52a1\u5668\u7684\u6700\u5927\u7a7a\u95f2 keepalive \u8fde\u63a5\u6570\u3002\u8d85\u8fc7\u6b64\u6570\u91cf\u65f6\uff0c\u5c06\u5173\u95ed\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u8fde\u63a5\u3002</p> <p>\u9700\u8981\u7279\u522b\u6ce8\u610f\u7684\u662f\uff0c<code>keepalive</code> \u6307\u4ee4\u4e0d\u9650\u5236 nginx worker \u8fdb\u7a0b\u53ef\u4ee5\u6253\u5f00\u7684 upstream \u670d\u52a1\u5668\u7684\u8fde\u63a5\u603b\u6570\u3002<code>connections</code> \u53c2\u6570\u5e94\u8bbe\u7f6e\u4e3a\u8db3\u591f\u5c0f\u7684\u6570\u5b57\uff0c\u4ee5\u4fbf upstream \u670d\u52a1\u5668\u4e5f\u53ef\u4ee5\u5904\u7406\u65b0\u7684\u4f20\u5165\u8fde\u63a5\u3002</p> <p>\u4f7f\u7528 keepalive \u8fde\u63a5\u7684 memcached  upstream \u793a\u4f8b\u914d\u7f6e\uff1a</p> <pre><code>upstream memcached_backend {\nserver 127.0.0.1:11211;\nserver 10.0.0.2:11211;\n\nkeepalive 32;\n}\n\nserver {\n...\n\nlocation /memcached/ {\nset $memcached_key $uri;\nmemcached_pass memcached_backend;\n}\n\n}\n</code></pre> <p>\u5bf9\u4e8e HTTP\uff0cproxy_http_version \u6307\u4ee4\u5e94\u8bbe\u7f6e\u4e3a <code>1.1</code>\uff0c\u5e76\u4e14\u5e94\u6e05\u9664 Connection header \u5b57\u6bb5\uff1a</p> <pre><code>upstream http_backend {\nserver 127.0.0.1:8080;\n\nkeepalive 16;\n}\n\nserver {\n...\n\nlocation /http/ {\nproxy_pass http://http_backend;\nproxy_http_version 1.1;\nproxy_set_header Connection \"\";\n...\n}\n}\n</code></pre> <p>\u6216\u8005\uff0c\u53ef\u4ee5\u901a\u8fc7\u5c06 Connection: Keep-Alive header \u5b57\u6bb5\u4f20\u9012\u7ed9 upstream \u670d\u52a1\u5668\u6765\u4f7f\u7528 HTTP/1.0 \u6301\u4e45\u8fde\u63a5\uff0c\u4f46\u4e0d\u5efa\u8bae\u4f7f\u7528\u6b64\u65b9\u6cd5\u3002</p> <p>\u5bf9\u4e8e FastCGI \u670d\u52a1\u5668\uff0c\u9700\u8981\u8bbe\u7f6e fastcgi_keep_conn \u624d\u80fd\u4f7f keepalive \u8fde\u63a5\u6b63\u5e38\u5de5\u4f5c\uff1a</p> <pre><code>upstream fastcgi_backend {\nserver 127.0.0.1:9000;\n\nkeepalive 8;\n}\n\nserver {\n...\n\nlocation /fastcgi/ {\nfastcgi_pass fastcgi_backend;\nfastcgi_keep_conn on;\n...\n}\n}\n</code></pre> <p>\u4f7f\u7528\u9664\u9ed8\u8ba4\u8f6e\u8be2\u65b9\u6cd5\u4e4b\u5916\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u7b56\u7565\u65f6\uff0c\u5fc5\u987b\u5728 <code>keepalive</code> \u6307\u4ee4\u4e4b\u524d\u6fc0\u6d3b\u5b83\u4eec\u3002</p> <p>SCGI \u548c uwsgi \u534f\u8bae\u6ca1\u6709 keepalive \u8fde\u63a5\u7684\u6982\u5ff5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#keepalive_requests","title":"keepalive_requests","text":"- \u8bf4\u660e \u8bed\u6cd5 keepalive_requests <code>number</code>; \u9ed8\u8ba4 keepalive_requests 100; \u4e0a\u4e0b\u6587 upstream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.15.3 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u53ef\u901a\u8fc7\u4e00\u4e2a keepalive \u8fde\u63a5\u63d0\u4f9b\u7684\u6700\u5927\u8bf7\u6c42\u6570\u3002\u5728\u8fbe\u5230\u6700\u5927\u8bf7\u6c42\u6570\u540e\uff0c\u8fde\u63a5\u5c06\u5173\u95ed\u3002</p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#keepalive_timeout","title":"keepalive_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 keepalive_timeout <code>timeout</code>; \u9ed8\u8ba4 keepalive_timeout 60s; \u4e0a\u4e0b\u6587 upstream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.15.3 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\uff0c\u5728\u6b64\u671f\u95f4\u4e0e upstream \u670d\u52a1\u5668\u7684\u7a7a\u95f2 keepalive \u8fde\u63a5\u5c06\u4fdd\u6301\u6253\u5f00\u72b6\u6001\u3002</p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#ntlm","title":"ntlm","text":"- \u8bf4\u660e \u8bed\u6cd5 ntlm; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.9.2 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5141\u8bb8\u4f7f\u7528 NTLM \u8eab\u4efd\u9a8c\u8bc1\u4ee3\u7406\u8bf7\u6c42\u3002\u4e00\u65e6\u5ba2\u6237\u7aef\u53d1\u9001\u6709\u4ee5 <code>Negotiate</code> \u6216 <code>NTLM</code> \u5f00\u5934\u7684 <code>Authorization</code> header \u5b57\u6bb5\u503c\u7684\u8bf7\u6c42\uff0cupstream \u8fde\u63a5\u5c06\u7ed1\u5b9a\u5230\u5ba2\u6237\u7aef\u8fde\u63a5\u3002\u4e4b\u540e\u7684\u5ba2\u6237\u7aef\u8bf7\u6c42\u5c06\u901a\u8fc7\u76f8\u540c\u7684 upstream \u8fde\u63a5\u8fdb\u884c\u4ee3\u7406\uff0c\u4ece\u800c\u4fdd\u6301\u8eab\u4efd\u9a8c\u8bc1\u4e0a\u4e0b\u6587\u3002</p> <p>\u4e3a\u4e86\u4f7f NTLM \u8eab\u4efd\u9a8c\u8bc1\u751f\u6548\uff0c\u5fc5\u987b\u542f\u7528\u4e0e upstream \u670d\u52a1\u5668\u7684 keepalive \u8fde\u63a5\u3002proxy_http_version \u6307\u4ee4\u5e94\u8bbe\u7f6e\u4e3a <code>1.1</code>\uff0c\u5e76\u4e14\u5e94\u6e05\u9664 Connection header \u5b57\u6bb5\uff1a</p> <pre><code>upstream http_backend {\nserver 127.0.0.1:8080;\n\nntlm;\n}\n\nserver {\n...\n\nlocation /http/ {\nproxy_pass http://http_backend;\nproxy_http_version 1.1;\nproxy_set_header Connection \"\";\n...\n}\n}\n</code></pre> <p>\u4f7f\u7528\u9664\u9ed8\u8ba4\u8f6e\u8be2\u7b56\u7565\u4e4b\u5916\u7684\u8d1f\u8f7d\u5747\u8861\u5668\u7b56\u7565\u65f6\uff0c\u5fc5\u987b\u5728 <code>ntlm</code> \u6307\u4ee4\u4e4b\u524d\u6fc0\u6d3b\u5b83\u4eec\u3002</p> <p>\u8be5\u6307\u4ee4\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u3002</p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#least_conn","title":"least_conn","text":"- \u8bf4\u660e \u8bed\u6cd5 least_conn; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.3.1 \u548c 1.2.2 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u7ec4\u5e94\u4f7f\u7528\u5c06\u8bf7\u6c42\u4f20\u9012\u5230\u6d3b\u52a8\u8fde\u63a5\u6570\u6700\u5c11\u7684\u670d\u52a1\u5668\uff0c\u540c\u65f6\u8003\u8651\u670d\u52a1\u5668\u6743\u91cd\u7684\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u3002\u5982\u679c\u591a\u4e2a\u540c\u6837\u7684\u670d\u52a1\u5668\uff0c\u5219\u4f7f\u7528\u52a0\u6743\u8f6e\u8be2\u5747\u8861\u65b9\u5f0f\u4f9d\u6b21\u5c1d\u8bd5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#least_time","title":"least_time","text":"- \u8bf4\u660e \u8bed\u6cd5 least_time <code>header</code> | <code>last_byte</code> | <code>[inflight]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.10 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u7ec4\u5e94\u4f7f\u7528\u5c06\u8bf7\u6c42\u4f20\u9012\u5230\u6709\u6700\u77ed\u5e73\u5747\u54cd\u5e94\u65f6\u95f4\u548c\u6700\u5c11\u6d3b\u52a8\u8fde\u63a5\u6570\u7684\u670d\u52a1\u5668\uff0c\u540c\u65f6\u8003\u8651\u670d\u52a1\u5668\u6743\u91cd\u7684\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u3002\u5982\u679c\u6709\u591a\u4e2a\u540c\u6837\u7684\u670d\u52a1\u5668\uff0c\u5219\u4f7f\u7528\u52a0\u6743\u8f6e\u8be2\u5747\u8861\u65b9\u5f0f\u4f9d\u6b21\u5c1d\u8bd5\u3002</p> <p>\u5982\u679c\u6307\u5b9a\u4e86 <code>header</code> \u53c2\u6570\uff0c\u5219\u4f7f\u7528\u63a5\u6536\u54cd\u5e94\u5934\u7684\u65f6\u95f4\u3002\u5982\u679c\u6307\u5b9a\u4e86 <code>last_byte</code> \u53c2\u6570\uff0c\u5219\u4f7f\u7528\u63a5\u6536\u5b8c\u6574\u54cd\u5e94\u7684\u65f6\u95f4\u3002\u5982\u679c\u6307\u5b9a\u4e86 <code>inflight</code> \u53c2\u6570\uff081.11.6\uff09\uff0c\u5219\u8fd8\u4f1a\u8003\u8651\u4e0d\u5b8c\u6574\u7684\u8bf7\u6c42\u3002</p> <p>\u5728 1.11.6 \u7248\u672c\u4e4b\u524d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u8003\u8651\u672a\u5b8c\u6210\u7684\u8bf7\u6c42\u3002</p> <p>\u8be5\u6307\u4ee4\u4f5c\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u63d0\u4f9b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#queue","title":"queue","text":"- \u8bf4\u660e \u8bed\u6cd5 queue <code>number [timeout=time]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.12 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5982\u679c\u5728\u5904\u7406\u8bf7\u6c42\u65f6\u65e0\u6cd5\u7acb\u5373\u9009\u62e9 upstream \u670d\u52a1\u5668\uff0c\u5219\u8bf7\u6c42\u5c06\u88ab\u653e\u5728\u961f\u5217\u4e2d\u3002\u8be5\u6307\u4ee4\u6307\u5b9a\u53ef\u4ee5\u540c\u65f6\u5728\u961f\u5217\u4e2d\u7684\u6700\u5927\u8bf7\u6c42\u6570\uff08<code>number</code>\uff09\u3002\u5982\u679c\u961f\u5217\u5df2\u6ee1\uff0c\u6216\u8005\u5728\u8d85\u65f6\u53c2\u6570\uff08<code>timeout</code>\uff09\u6307\u5b9a\u7684\u65f6\u95f4\u6bb5\u5185\u65e0\u6cd5\u9009\u62e9\u8981\u4f20\u9012\u8bf7\u6c42\u7684\u670d\u52a1\u5668\uff0c\u5219\u4f1a\u5c06 502 (Bad Gateway) \u9519\u8bef\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</p> <p><code>timeout</code> \u53c2\u6570\u7684\u9ed8\u8ba4\u503c\u4e3a 60 \u79d2\u3002</p> <p>\u4f7f\u7528\u9664\u9ed8\u8ba4\u7684\u8f6e\u8be2\u7b56\u7565\u4e4b\u5916\u7684\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u65f6\uff0c\u5fc5\u987b\u5728 <code>queue</code> \u6307\u4ee4\u4e4b\u524d\u6fc0\u6d3b\u5b83\u4eec\u3002</p> <p>\u8be5\u6307\u4ee4\u4f5c\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u63d0\u4f9b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#random","title":"random","text":"- \u8bf4\u660e \u8bed\u6cd5 random <code>[two [method]]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.15.1 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u7ec4\u5e94\u4f7f\u7528\u5c06\u8bf7\u6c42\u968f\u673a\u4f20\u9012\u7ed9\u670d\u52a1\u5668\uff0c\u540c\u65f6\u8003\u8651\u670d\u52a1\u5668\u6743\u91cd\u7684\u8d1f\u8f7d\u5747\u8861\u7b56\u7565\u3002</p> <p>\u53ef\u9009\u7684 <code>two</code> \u53c2\u6570\u6307\u793a nginx \u968f\u673a\u9009\u62e9\u4e24\u4e2a\u670d\u52a1\u5668\uff0c\u7136\u540e\u4f7f\u7528\u6307\u5b9a\u7684\u65b9\u6cd5\uff08<code>method</code>\uff09\u9009\u62e9\u670d\u52a1\u5668\u3002\u9ed8\u8ba4\u65b9\u6cd5\u662f <code>least_conn</code>\uff0c\u5b83\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u6d3b\u52a8\u8fde\u63a5\u6570\u6700\u5c11\u7684\u670d\u52a1\u5668\u3002</p> <p><code>least_time</code> \u65b9\u6cd5\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u5e73\u5747\u54cd\u5e94\u65f6\u95f4\u6700\u77ed\u4e14\u6d3b\u52a8\u8fde\u63a5\u6570\u6700\u5c11\u7684\u670d\u52a1\u5668\u3002\u5982\u679c\u6307\u5b9a\u4e86 <code>least_time=header</code>\uff0c\u5219\u4f7f\u7528\u63a5\u6536\u54cd\u5e94\u5934\u7684\u65f6\u95f4\u3002\u5982\u679c\u6307\u5b9a\u4e86 <code>least_time=last_byte</code>\uff0c\u5219\u4f7f\u7528\u63a5\u6536\u5b8c\u6574\u54cd\u5e94\u7684\u65f6\u95f4\u3002</p> <p><code>least_time</code> \u65b9\u6cd5\u4f5c\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u63d0\u4f9b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#sticky","title":"sticky","text":"- \u8bf4\u660e \u8bed\u6cd5 sticky <code>cookie name [expires=time] [domain=domain] [httponly] [secure] [path=path]</code>;sticky <code>route $variable ...</code>;sticky <code>learn create=$variable lookup=$variable zone=name:size [timeout=time] [header] [sync]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u4f1a\u8bdd\u5173\u8054\uff0c\u8fd9\u4f1a\u5c06\u6765\u81ea\u540c\u4e00\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u4f20\u9012\u5230\u4e00\u7ec4\u670d\u52a1\u5668\u4e2d\u7684\u540c\u4e00\u670d\u52a1\u5668\u3002\u6709\u4e09\u79cd\u65b9\u6cd5\u53ef\u4f9b\u9009\u62e9\uff1a</p> <ul> <li> <p><code>cookie</code></p> <p>\u4f7f\u7528 <code>cookie</code> \u65b9\u6cd5\u65f6\uff0c\u6709\u5173\u6307\u5b9a\u670d\u52a1\u5668\u7684\u4fe1\u606f\u5c06\u5728 nginx \u751f\u6210\u7684 HTTP cookie \u4e2d\u4f20\u9012\uff1a</p> <pre><code>upstream backend {\nserver backend1.example.com;\nserver backend2.example.com;\n\nsticky cookie srv_id expires=1h domain=.example.com path=/;\n}\n</code></pre> <p>\u6765\u81ea\u5c1a\u672a\u7ed1\u5b9a\u5230\u7279\u5b9a\u670d\u52a1\u5668\u7684\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u5c06\u7531\u914d\u7f6e\u7684\u5747\u8861\u65b9\u6cd5\u9009\u62e9\u670d\u52a1\u5668\u4f20\u9012\u3002\u4f7f\u7528\u6b64 cookie \u7684\u540e\u7eed\u8bf7\u6c42\u5c06\u4f20\u9012\u5230\u6307\u5b9a\u7684\u670d\u52a1\u5668\u3002\u5982\u679c\u6307\u5b9a\u7684\u670d\u52a1\u5668\u65e0\u6cd5\u5904\u7406\u8bf7\u6c42\uff0c\u5219\u9009\u62e9\u65b0\u670d\u52a1\u5668\uff0c\u4e0e\u5ba2\u6237\u7aef\u672a\u7ed1\u5b9a\u7279\u5b9a\u670d\u52a1\u5668\u7684\u60c5\u51b5\u4e00\u6837\u5904\u7406\u3002</p> <p>\u7b2c\u4e00\u4e2a\u53c2\u6570\u8bbe\u7f6e\u4e3a\u8981\u5ba1\u67e5\u6216\u68c0\u67e5\u7684 cookie \u7684\u540d\u79f0\u3002cookie \u503c\u662f\u4e00\u4e2a IP \u5730\u5740\u548c\u7aef\u53e3\u7684 MD5 \u54c8\u5e0c\u503c\u6216 UNIX \u57df\u5957\u63a5\u5b57\u8def\u5f84\u7684\u5341\u516d\u8fdb\u5236\u8868\u793a\u5f62\u5f0f\u3002\u4f46\u5982\u679c\u6307\u5b9a\u4e86 server \u6307\u4ee4\u7684 <code>route</code> \u53c2\u6570\uff0c\u5219 cookie \u503c\u5c06\u662f <code>route</code> \u53c2\u6570\u7684\u503c\uff1a</p> <pre><code>upstream backend {\nserver backend1.example.com route=a;\nserver backend2.example.com route=b;\n\nsticky cookie srv_id expires=1h domain=.example.com path=/;\n}\n</code></pre> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c<code>srv_id</code> cookie \u7684\u503c\u5c06\u662f <code>a</code> \u6216 <code>b</code>\u3002</p> <p>\u5176\u4ed6\u53c2\u6570\u5982\u4e0b\uff1a</p> <ul> <li> <p><code>expires=time</code></p> <p>\u8bbe\u7f6e\u6d4f\u89c8\u5668\u4fdd\u7559 cookie \u7684\u65f6\u95f4\uff08<code>time</code>\uff09\u3002\u7279\u6b8a\u503c <code>max</code> \u5c06 cookie \u8bbe\u7f6e\u5728 <code>31 Dec 2037 23:55:55 GMT</code> \u65f6\u5230\u671f\u3002\u5982\u679c\u672a\u6307\u5b9a\u53c2\u6570\uff0ccookie \u5c06\u5728\u6d4f\u89c8\u5668\u4f1a\u8bdd\u7ed3\u675f\u65f6\u5230\u671f\u3002</p> </li> <li> <p><code>domain=domain</code></p> <p>\u5b9a\u4e49 cookie \u7684\u57df\uff08<code>domain</code>\uff09\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.11.5\uff09\u3002</p> </li> <li> <p><code>httponly</code></p> <p>\u5c06 <code>HttpOnly</code> \u5c5e\u6027\u6dfb\u52a0\u5230 cookie \u4e2d\uff081.7.11\uff09\u3002</p> </li> <li> <p><code>secure</code></p> <p>\u5c06 <code>Secure</code> \u5c5e\u6027\u6dfb\u52a0\u5230 cookie \u4e2d\uff081.7.11\uff09\u3002</p> </li> <li> <p><code>path=path</code></p> <p>\u5b9a\u4e49 cookie \u7684\u8bbe\u7f6e\u8def\u5f84\uff08<code>path</code>\uff09\u3002</p> </li> </ul> <p>\u88ab\u7701\u7565\u53c2\u6570\u5c06\u4e0d\u4f1a\u88ab\u8bbe\u7f6e\u5728 cookie \u4e2d\u3002</p> </li> <li> <p><code>route</code></p> <p>\u4f7f\u7528 <code>route</code> \u65b9\u6cd5\u65f6\uff0c\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u5728\u6536\u5230\u7b2c\u4e00\u4e2a\u8bf7\u6c42\u65f6\u4e3a\u5ba2\u6237\u7aef\u5206\u914d\u8def\u7531\u3002\u6765\u81ea\u6b64\u5ba2\u6237\u7aef\u7684\u6240\u6709\u540e\u7eed\u8bf7\u6c42\u5c06\u5728 cookie \u6216 URI \u4e2d\u643a\u5e26\u8def\u7531\u4fe1\u606f\u3002\u6b64\u4fe1\u606f\u5c06\u4e0e server \u6307\u4ee4\u7684 <code>route</code> \u53c2\u6570\u8fdb\u884c\u6bd4\u8f83\uff0c\u4ee5\u6807\u8bc6\u5e94\u5c06\u8bf7\u6c42\u4ee3\u7406\u5230\u54ea\u4e2a\u670d\u52a1\u5668\u3002\u5982\u679c\u672a\u6307\u5b9a <code>route</code> \u53c2\u6570\uff0c\u5219\u8def\u7531\u540d\u79f0\u5c06\u662f IP \u5730\u5740\u548c\u7aef\u53e3\u7684 MD5 \u54c8\u5e0c\u503c\u6216 UNIX \u57df\u5957\u63a5\u5b57\u8def\u5f84\u7684\u5341\u516d\u8fdb\u5236\u8868\u793a\u5f62\u5f0f\u3002\u5982\u679c\u6307\u5b9a\u7684\u670d\u52a1\u5668\u65e0\u6cd5\u5904\u7406\u8bf7\u6c42\uff0c\u5219\u4f7f\u7528\u914d\u7f6e\u7684\u5747\u8861\u7b56\u7565\u9009\u62e9\u65b0\u670d\u52a1\u5668\uff0c\u4e0e\u8bf7\u6c42\u4e2d\u6ca1\u6709\u8def\u7531\u4fe1\u606f\u7684\u60c5\u51b5\u5904\u7406\u65b9\u5f0f\u4e00\u6837\u3002</p> <p><code>route</code> \u65b9\u6cd5\u7684\u53c2\u6570\u6307\u5b9a\u53ef\u80fd\u5305\u542b\u8def\u7531\u4fe1\u606f\u7684\u53d8\u91cf\u3002\u7b2c\u4e00\u4e2a\u975e\u7a7a\u53d8\u91cf\u7528\u4e8e\u67e5\u627e\u5339\u914d\u670d\u52a1\u5668\u3002</p> </li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>```nginx\nmap $cookie_jsessionid $route_cookie {\n    ~.+\\.(?P&lt;route&gt;\\w+)$ $route;\n}\n\nmap $request_uri $route_uri {\n    ~jsessionid=.+\\.(?P&lt;route&gt;\\w+)$ $route;\n}\n\nupstream backend {\n    server backend1.example.com route=a;\n    server backend2.example.com route=b;\n\n    sticky route $route_cookie $route_uri;\n}\n```\n\n\u6b64\u5904\uff0c\u8def\u7531\u53d6\u81ea `JSESSIONID` cookie\uff08\u5982\u679c\u8bf7\u6c42\u4e2d\u5b58\u5728\uff09\u3002\u5426\u5219\uff0c\u4f7f\u7528\u6765\u81ea URI \u7684\u8def\u7531\u3002\n</code></pre> <ul> <li> <p><code>learn</code></p> <p>\u5f53\u4f7f\u7528 <code>learn</code> \u65b9\u6cd5\uff081.7.1\uff09\u65f6\uff0cnginx \u4f1a\u5206\u6790 upstream \u670d\u52a1\u5668\u54cd\u5e94\u5e76\u4e86\u89e3\u7ecf\u5e38\u5728 HTTP cookie \u4e2d\u4f20\u9012\u7684\u670d\u52a1\u5668\u4f1a\u8bdd\u3002</p> <pre><code>upstream backend {\nserver backend1.example.com:8080;\nserver backend2.example.com:8081;\n\nsticky learn\ncreate=$upstream_cookie_examplecookie\nlookup=$cookie_examplecookie\nzone=client_sessions:1m;\n}\n</code></pre> <p>\u5728\u8be5\u793a\u4f8b\u4e2d\uff0c upstream \u670d\u52a1\u5668\u901a\u8fc7\u5728\u54cd\u5e94\u4e2d\u8bbe\u7f6e cookie <code>EXAMPLECOOKIE</code> \u6765\u521b\u5efa\u4f1a\u8bdd\u3002\u4f7f\u7528\u6b64 cookie \u7684\u5176\u4ed6\u8bf7\u6c42\u5c06\u4f20\u9012\u5230\u540c\u4e00\u670d\u52a1\u5668\u3002\u5982\u679c\u670d\u52a1\u5668\u65e0\u6cd5\u5904\u7406\u8bf7\u6c42\uff0c\u5219\u9009\u62e9\u65b0\u670d\u52a1\u5668\uff0c\u4e0e\u5ba2\u6237\u7aef\u5c1a\u672a\u7ed1\u5b9a\u7279\u5b9a\u670d\u52a1\u5668\u7684\u60c5\u51b5\u4e00\u6837\u3002</p> <p>\u53c2\u6570 <code>create</code> \u548c <code>lookup</code> \u5206\u522b\u6307\u793a\u5982\u4f55\u521b\u5efa\u65b0\u4f1a\u8bdd\u548c\u641c\u7d22\u73b0\u6709\u4f1a\u8bdd\u7684\u53d8\u91cf\u3002\u4e24\u4e2a\u53c2\u6570\u53ef\u4ee5\u591a\u6b21\u6307\u5b9a\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4f7f\u7528\u7b2c\u4e00\u4e2a\u975e\u7a7a\u53d8\u91cf\u3002</p> <p>\u4f1a\u8bdd\u5b58\u50a8\u5728\u5171\u4eab\u5185\u5b58\u533a\u57df\u4e2d\uff0c\u5176\u540d\u79f0\uff08<code>name</code>\uff09\u548c\u5927\u5c0f\uff08<code>size</code>\uff09\u7531 <code>zone</code> \u53c2\u6570\u914d\u7f6e\u3002\u4e00\u5146\u5b57\u8282\u533a\u57df\u53ef\u4ee5\u5728 64 \u4f4d\u5e73\u53f0\u4e0a\u5b58\u50a8\u5927\u7ea6 4000 \u4e2a\u4f1a\u8bdd\u3002\u5728 <code>timeout</code> \u53c2\u6570\u6307\u5b9a\u7684\u65f6\u95f4\u5185\u672a\u8bbf\u95ee\u7684\u4f1a\u8bdd\u5c06\u4ece\u533a\u57df\u4e2d\u5220\u9664\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e\u4e3a 10 \u5206\u949f\u3002</p> <p><code>header</code> \u53c2\u6570\uff081.13.1\uff09\u5141\u8bb8\u5728\u4ece upstream \u670d\u52a1\u5668\u63a5\u6536\u54cd\u5e94\u5934\u4e4b\u540e\u7acb\u5373\u521b\u5efa\u4f1a\u8bdd\u3002</p> <p><code>sync</code> \u53c2\u6570\uff081.13.8\uff09\u542f\u7528\u5171\u4eab\u5185\u5b58\u533a\u57df\u540c\u6b65\u3002</p> </li> </ul> <p>\u8be5\u6307\u4ee4\u4f5c\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u63d0\u4f9b\u3002</p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#sticky_cookie_insert","title":"sticky_cookie_insert","text":"- \u8bf4\u660e \u8bed\u6cd5 sticky_cookie_insert <code>name [expires=time] [domain=domain] [path=path]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream <p>\u4ece 1.5.7 \u7248\u672c\u5f00\u59cb\uff0c\u8be5\u6307\u4ee4\u5df2\u8fc7\u65f6\u3002\u5e94\u4f7f\u7528\u65b0\u7684 sticky \u6307\u4ee4\u4ee3\u66ff\uff1a</p> <pre><code>sticky cookie name [expires=time] [domain=domain] [path=path];\n</code></pre> <p></p>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#_3","title":"\u5185\u90e8\u53d8\u91cf","text":"<p><code>ngx_http_upstream_module</code> \u6a21\u5757\u652f\u6301\u4ee5\u4e0b\u5185\u90e8\u53d8\u91cf\uff1a</p> <p></p> <ul> <li> <p><code>$upstream_addr</code></p> <p>\u4fdd\u5b58 IP \u5730\u5740\u548c\u7aef\u53e3\uff0c\u6216 upstream \u670d\u52a1\u5668\u7684 UNIX \u57df\u5957\u63a5\u5b57\u7684\u8def\u5f84\u3002\u5982\u679c\u5728\u8bf7\u6c42\u5904\u7406\u671f\u95f4\u63a5\u89e6\u4e86\u591a\u4e2a\u670d\u52a1\u5668\uff0c\u5219\u5b83\u4eec\u7684\u5730\u5740\u7528\u9017\u53f7\u5206\u9694\uff0c\u4f8b\u5982 <code>192.168.1.1:80, 192.168.1.2:80, unix:/tmp/sock</code>\u3002\u5982\u679c\u4ece\u4e00\u4e2a\u670d\u52a1\u5668\u7ec4\u5230\u53e6\u4e00\u4e2a\u670d\u52a1\u5668\u7ec4\u7684\u5185\u90e8\u53d1\u751f\u91cd\u5b9a\u5411\uff0c\u7531 <code>X-Accel-Redirect</code> \u6216 <code>error_page</code> \u53d1\u8d77\uff0c\u5219\u6765\u81ea\u4e0d\u540c\u7ec4\u7684\u670d\u52a1\u5668\u5730\u5740\u7531\u5192\u53f7\u5206\u9694\uff0c\u4f8b\u5982 <code>192.168.1.1:80, 192.168.1.2:80, unix:/tmp/sock : 192.168.10.1:80, 192.168.10.2:80</code>\u3002 \u5982\u679c\u65e0\u6cd5\u9009\u62e9\u670d\u52a1\u5668\uff0c\u5219\u53d8\u91cf\u5c06\u4fdd\u7559\u670d\u52a1\u5668\u7ec4\u7684\u540d\u79f0\u3002</p> </li> <li> <p><code>$upstream_bytes_received</code></p> <p>\u4ece upstream \u670d\u52a1\u5668\uff081.11.4\uff09\u63a5\u6536\u7684\u5b57\u8282\u6570\u3002\u6765\u81ea\u591a\u4e2a\u8fde\u63a5\u7684\u503c\u7531\u9017\u53f7\u548c\u5192\u53f7\u5206\u9694\uff0c\u53c2\u8003 $upstream_addr \u53d8\u91cf\u4e2d\u7684\u5730\u5740\u683c\u5f0f\u3002</p> </li> <li> <p><code>$upstream_bytes_sent</code></p> <p>\u53d1\u9001\u5230 upstream \u670d\u52a1\u5668\u7684\u5b57\u8282\u6570\uff081.15.8\uff09\u3002\u6765\u81ea\u591a\u4e2a\u8fde\u63a5\u7684\u503c\u7531\u9017\u53f7\u548c\u5192\u53f7\u5206\u9694\uff0c\u53c2\u8003 $upstream_addr \u53d8\u91cf\u4e2d\u7684\u5730\u5740\u683c\u5f0f\u3002</p> </li> <li> <p><code>$upstream_cache_status</code></p> <p>\u4fdd\u5b58\u8bbf\u95ee\u54cd\u5e94\u7f13\u5b58\u7684\u72b6\u6001\uff080.8.3\uff09\u3002\u72b6\u6001\u53ef\u4ee5\u662f <code>MISS</code>\u3001<code>BYPASS</code>\u3001<code>EXPIRED</code>\u3001<code>STALE</code>\u3001<code>UPDATING</code>\u3001<code>REVALIDATED</code> \u6216 <code>HIT</code>\u3002</p> </li> <li> <p><code>$upstream_connect_time</code></p> <p>\u4fdd\u5b58\u4e0e upstream \u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u6240\u82b1\u8d39\u7684\u65f6\u95f4\uff081.9.1\uff09\uff0c\u65f6\u95f4\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff0c\u7cbe\u5ea6\u4e3a\u6beb\u79d2\u3002\u5728 SSL \u7684\u60c5\u51b5\u4e0b\uff0c\u5305\u542b\u63e1\u624b\u65f6\u95f4\u3002\u591a\u4e2a\u8fde\u63a5\u7684\u65f6\u95f4\u7528\u9017\u53f7\u548c\u5192\u53f7\u5206\u9694\uff0c\u53c2\u8003 $upstream_addr \u53d8\u91cf\u4e2d\u7684\u5730\u5740\u683c\u5f0f\u3002</p> </li> <li> <p><code>$upstream_cookie_name</code></p> <p>upstream \u670d\u52a1\u5668\u5728 <code>Set-Cookie</code> \u54cd\u5e94\u5934\u5b57\u6bb5\uff081.7.1\uff09\u4e2d\u53d1\u9001\u7684\u6709\u6307\u5b9a\u540d\u79f0\u7684 cookie\u3002\u4ec5\u4fdd\u5b58\u6700\u540e\u4e00\u53f0\u670d\u52a1\u5668\u54cd\u5e94\u4e2d\u7684 cookie\u3002</p> </li> <li> <p><code>$upstream_header_time</code></p> <p>\u4fdd\u5b58\u4ece upstream \u670d\u52a1\u5668\u63a5\u6536\u54cd\u5e94\u5934\u6240\u82b1\u8d39\u7684\u65f6\u95f4\uff081.7.10\uff09\uff0c\u65f6\u95f4\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff0c\u7cbe\u5ea6\u4e3a\u6beb\u79d2\u3002\u591a\u4e2a\u54cd\u5e94\u7684\u65f6\u95f4\u7528\u9017\u53f7\u548c\u5192\u53f7\u5206\u9694\uff0c\u53c2\u8003 $upstream_addr \u53d8\u91cf\u4e2d\u7684\u5730\u5740\u683c\u5f0f\u3002</p> </li> <li> <p><code>$upstream_http_name</code></p> <p>\u4fdd\u5b58\u670d\u52a1\u5668\u54cd\u5e94\u5934\u5b57\u6bb5\u3002\u4f8b\u5982\uff0c<code>Server</code> \u54cd\u5e94\u5934\u5b57\u6bb5\u53ef\u901a\u8fc7 <code>$upstream_http_server</code> \u53d8\u91cf\u83b7\u5f97\u3002\u5c06\u5934\u5b57\u6bb5\u540d\u79f0\u8f6c\u6362\u4e3a\u53d8\u91cf\u540d\u79f0\u7684\u89c4\u5219\u4e0e\u4ee5 $http_ \u524d\u7f00\u5f00\u5934\u7684\u53d8\u91cf\u76f8\u540c\u3002\u4ec5\u4fdd\u5b58\u6700\u540e\u4e00\u4e2a\u670d\u52a1\u5668\u54cd\u5e94\u4e2d\u7684\u5934\u5b57\u6bb5\u3002</p> </li> <li> <p><code>$upstream_queue_time</code></p> <p>\u4fdd\u5b58\u8bf7\u6c42\u5728 upstream \u961f\u5217\u4e2d\u82b1\u8d39\u7684\u65f6\u95f4\uff081.13.9\uff09\uff0c\u65f6\u95f4\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff0c\u7cbe\u5ea6\u4e3a\u6beb\u79d2\u3002\u591a\u4e2a\u54cd\u5e94\u7684\u65f6\u95f4\u7528\u9017\u53f7\u548c\u5192\u53f7\u5206\u9694\uff0c\u53c2\u8003 $upstream_addr \u53d8\u91cf\u4e2d\u7684\u5730\u5740\u683c\u5f0f\u3002</p> </li> <li> <p><code>$upstream_response_length</code></p> <p>\u4fdd\u5b58\u4ece upstream \u670d\u52a1\u5668\u83b7\u5f97\u7684\u54cd\u5e94\u957f\u5ea6\uff080.7.27\uff09\uff0c\u957f\u5ea6\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\u3002\u591a\u4e2a\u54cd\u5e94\u7684\u957f\u5ea6\u7528\u9017\u53f7\u548c\u5192\u53f7\u5206\u9694\uff0c\u53c2\u8003 $upstream_addr \u53d8\u91cf\u4e2d\u7684\u5730\u5740\u683c\u5f0f\u3002</p> </li> <li> <p><code>$upstream_response_time</code></p> <p>\u4fdd\u5b58\u4ece upstream \u670d\u52a1\u5668\u63a5\u6536\u54cd\u5e94\u6240\u82b1\u8d39\u7684\u65f6\u95f4\uff0c\u65f6\u95f4\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff0c\u7cbe\u5ea6\u4e3a\u6beb\u79d2\u3002\u591a\u4e2a\u54cd\u5e94\u7684\u65f6\u95f4\u7528\u9017\u53f7\u548c\u5192\u53f7\u5206\u9694\uff0c\u53c2\u8003 $upstream_addr \u53d8\u91cf\u4e2d\u7684\u5730\u5740\u683c\u5f0f\u3002</p> </li> <li> <p><code>$upstream_status</code></p> <p>\u4fdd\u5b58\u4ece upstream \u670d\u52a1\u5668\u83b7\u5f97\u7684\u54cd\u5e94\u7684\u72b6\u6001\u4ee3\u7801\u3002\u591a\u4e2a\u54cd\u5e94\u7684\u72b6\u6001\u4ee3\u7801\u7528\u9017\u53f7\u548c\u5192\u53f7\u5206\u9694\uff0c\u5982 $upstream_addr \u53d8\u91cf\u4e2d\u7684\u5730\u5740\u683c\u5f0f\u3002\u5982\u679c\u6ca1\u6709\u670d\u52a1\u5668\u88ab\u9009\u4e2d\uff0c\u8be5\u53d8\u91cf\u7684\u503c\u5c06\u4e3a 502 (Bad Gateway) \u72b6\u6001\u7801\u3002</p> </li> <li> <p><code>$upstream_trailer_name</code></p> <p>\u4fdd\u5b58\u4ece upstream \u670d\u52a1\u5668\uff081.13.10\uff09\u83b7\u5f97\u7684\u54cd\u5e94\u7ed3\u675f\u65f6\u7684\u5b57\u6bb5\u3002</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_upstream_module/#_4","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/http/ngx_http_upstream_module.html</li> </ul>"},{"location":"Modules-reference/http/ngx_http_userid_module/","title":"ngx_http_userid_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>userid</li> <li>userid_domain</li> <li>userid_expires</li> <li>userid_mark</li> <li>userid_name</li> <li>userid_p3p</li> <li>userid_path</li> <li>userid_service</li> </ul> </li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_http_userid_module</code> \u6a21\u5757\u8bbe\u7f6e\u65b9\u4fbf\u5ba2\u6237\u7aef\u8bc6\u522b\u7684 cookie\u3002\u53ef\u4ee5\u4f7f\u7528\u5185\u5d4c\u53d8\u91cf uid_got](#uid_got) \u548c [uid_set \u8bb0\u5f55\u5df2\u63a5\u6536\u548c\u8bbe\u7f6e\u7684 cookie\u3002\u8be5\u6a21\u5757\u4e0e Apache \u7684 mod_uid \u6a21\u5757\u517c\u5bb9\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_userid_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>userid         on;\nuserid_name    uid;\nuserid_domain  example.com;\nuserid_path    /;\nuserid_expires 365d;\nuserid_p3p     'policyref=\"/w3c/p3p.xml\", CP=\"CUR ADM OUR NOR STA NID\"';\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_userid_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_userid_module/#userid","title":"userid","text":"- \u8bf4\u660e \u8bed\u6cd5 userid <code>on</code> | <code>v1</code> | <code>log</code> | <code>off</code>; \u9ed8\u8ba4 userid off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u6216\u7981\u7528\u8bbe\u7f6e cookie \u548c\u8bb0\u5f55\u63a5\u53d7\u5230\u7684 cookie\uff1a</p> <ul> <li> <p><code>on</code></p> <p>\u542f\u7528\u7248\u672c 2 cookie \u8bbe\u7f6e\u5e76\u8bb0\u5f55\u63a5\u6536\u5230\u7684 cookie</p> </li> <li> <p><code>v1</code></p> <p>\u542f\u7528\u7248\u672c 1 cookie \u8bbe\u7f6e\u5e76\u8bb0\u5f55\u63a5\u6536\u5230\u7684 cookie</p> </li> <li> <p><code>log</code></p> <p>\u7981\u7528 cookie \u8bbe\u7f6e\uff0c\u4f46\u5141\u8bb8\u8bb0\u5f55\u63a5\u6536\u5230\u7684 cookie</p> </li> <li> <p><code>off</code></p> <p>\u7981\u7528 cookie \u8bbe\u7f6e\u548c\u8bb0\u5f55\u63a5\u6536\u5230\u7684 cookie</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_userid_module/#userid_domain","title":"userid_domain","text":"- \u8bf4\u660e \u8bed\u6cd5 userid_domain <code>name</code> | <code>none</code>; \u9ed8\u8ba4 userid_domain none; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u4e3a\u8bbe\u7f6e\u7684 cookie \u5b9a\u4e49\u57df\u3002<code>none</code> \u53c2\u6570\u7981\u7528 cookie \u57df\u8bbe\u7f6e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_userid_module/#userid_expires","title":"userid_expires","text":"- \u8bf4\u660e \u8bed\u6cd5 userid_expires <code>time</code> | <code>max</code> | <code>off</code>; \u9ed8\u8ba4 userid_expires off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u6d4f\u89c8\u5668\u4fdd\u7559 cookie \u7684\u65f6\u95f4\uff08<code>time</code>\uff09\u3002\u7279\u6b8a\u503c <code>max</code> \u5c06 cookie \u8bbe\u7f6e\u5728 <code>31 Dec 2037 23:55:55 GMT</code> \u65f6\u5230\u671f\u3002\u5982\u679c\u672a\u6307\u5b9a\u53c2\u6570\uff0ccookie \u5c06\u5728\u6d4f\u89c8\u5668\u4f1a\u8bdd\u7ed3\u675f\u65f6\u5230\u671f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_userid_module/#userid_mark","title":"userid_mark","text":"- \u8bf4\u660e \u8bed\u6cd5 userid_mark <code>letter</code> | <code>digit</code> | <code>=</code> | <code>off</code>; \u9ed8\u8ba4 userid_mark off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5982\u679c\u53c2\u6570\u4e0d\u662f <code>off</code>\uff0c\u5219\u542f\u7528 cookie \u6807\u8bb0\u673a\u5236\u5e76\u8bbe\u7f6e\u7528\u4f5c\u6807\u8bb0\u7684\u5b57\u7b26\u3002\u6b64\u673a\u5236\u7528\u4e8e\u5728\u4fdd\u7559\u5ba2\u6237\u7aef\u6807\u8bc6\u7b26\u7684\u540c\u65f6\u6dfb\u52a0\u6216\u66f4\u6539 userid_p3p \u548c/\u6216 cookie \u7684\u8fc7\u671f\u65f6\u95f4\u3002\u6807\u8bb0\u53ef\u4ee5\u662f\u82f1\u6587\u5b57\u6bcd\uff08\u533a\u5206\u5927\u5c0f\u5199\uff09\u3001\u6570\u5b57\u6216 <code>=</code> \u5b57\u7b26\u7684\u4efb\u4f55\u5b57\u7b26\u3002</p> <p>\u5982\u679c\u8bbe\u7f6e\u4e86\u6807\u8bb0\uff0c\u5219\u5c06\u5176\u4e0e cookie \u4e2d\u4f20\u9012\u7684\u5ba2\u6237\u7aef\u6807\u8bc6\u7b26\u7684 base64 \u5f62\u5f0f\u4e2d\u7684\u7b2c\u4e00\u4e2a\u586b\u5145\u7b26\u53f7\u8fdb\u884c\u6bd4\u8f83\u3002\u5982\u679c\u5b83\u4eec\u4e0d\u5339\u914d\uff0c\u5219\u4f1a\u91cd\u65b0\u53d1\u9001\u5e26\u6709\u6307\u5b9a\u6807\u8bb0\u3001\u5230\u671f\u65f6\u95f4\u548c P3P \u5934\u7684 cookie\u3002</p>"},{"location":"Modules-reference/http/ngx_http_userid_module/#userid_name","title":"userid_name","text":"- \u8bf4\u660e \u8bed\u6cd5 userid_name <code>name</code>; \u9ed8\u8ba4 userid_name uid; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e cookie \u7684\u540d\u79f0\u3002</p>"},{"location":"Modules-reference/http/ngx_http_userid_module/#userid_p3p","title":"userid_p3p","text":"- \u8bf4\u660e \u8bed\u6cd5 userid_p3p <code>string</code> | <code>none</code>; \u9ed8\u8ba4 userid_p3p none; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u5c06\u4e0e cookie \u4e00\u8d77\u53d1\u9001\u7684 P3P \u5934\u5b57\u6bb5\u7684\u503c\u3002\u5982\u679c\u6307\u4ee4\u8bbe\u7f6e\u4e3a\u7279\u6b8a\u503c <code>none</code>\uff0c\u5219\u4e0d\u4f1a\u5728\u54cd\u5e94\u4e2d\u53d1\u9001 P3P \u5934\u3002</p>"},{"location":"Modules-reference/http/ngx_http_userid_module/#userid_path","title":"userid_path","text":"- \u8bf4\u660e \u8bed\u6cd5 userid_path <code>path</code>; \u9ed8\u8ba4 userid_path /; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u4e3a\u8bbe\u7f6e\u7684 cookie \u5b9a\u4e49\u8def\u5f84\u3002</p>"},{"location":"Modules-reference/http/ngx_http_userid_module/#userid_service","title":"userid_service","text":"- \u8bf4\u660e \u8bed\u6cd5 userid_service <code>number</code>; \u9ed8\u8ba4 userid_service \u670d\u52a1\u5668\u7684 IP \u5730\u5740; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5982\u679c\u6807\u8bc6\u7b26\u7531\u591a\u4e2a\u670d\u52a1\u5668\uff08\u670d\u52a1\uff09\u53d1\u51fa\uff0c\u5219\u5e94\u4e3a\u6bcf\u4e2a\u670d\u52a1\u5206\u914d\u5176\u81ea\u5df1\u7684\u7f16\u53f7\uff08<code>number</code>\uff09\uff0c\u4ee5\u786e\u4fdd\u5ba2\u6237\u7aef\u6807\u8bc6\u7b26\u662f\u552f\u4e00\u7684\u3002 \u5bf9\u4e8e\u7248\u672c 1 cookie\uff0c\u9ed8\u8ba4\u503c\u4e3a\u96f6\u3002\u5bf9\u4e8e\u7248\u672c 2 cookie\uff0c\u9ed8\u8ba4\u503c\u662f\u4ece\u670d\u52a1\u5668 IP \u5730\u5740\u7684\u6700\u540e\u56db\u4e2a\u516b\u4f4d\u5b57\u8282\u7ec4\u6210\u7684\u6570\u5b57\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_userid_module/#_3","title":"\u5185\u5d4c\u53d8\u91cf","text":"<p><code>ngx_http_userid_module</code> \u6a21\u5757\u652f\u6301\u4ee5\u4e0b\u5185\u5d4c\u53d8\u91cf\uff1a</p> <p></p> <ul> <li> <p><code>$uid_got</code></p> <p>cookie \u540d\u79f0\u548c\u6536\u5230\u7684\u5ba2\u6237\u7aef\u6807\u8bc6\u7b26</p> </li> <li> <p><code>$uid_reset</code></p> <p>\u5982\u679c\u53d8\u91cf\u8bbe\u7f6e\u4e3a\u975e\u7a7a\u5b57\u7b26\u4e32\u4e14\u975e <code>\"0\"</code>\uff0c\u5219\u91cd\u7f6e\u5ba2\u6237\u7aef\u6807\u8bc6\u7b26\u3002\u7279\u6b8a\u503c <code>log</code> \u4f1a\u5c06\u5173\u4e8e\u91cd\u7f6e\u6807\u8bc6\u7b26\u7684\u6d88\u606f\u8f93\u51fa\u5230 error_log\u3002</p> </li> </ul> <p></p> <ul> <li> <p><code>$uid_set</code></p> <p>cookie \u540d\u79f0\u548c\u5df2\u53d1\u9001\u7684\u5ba2\u6237\u7aef\u6807\u8bc6\u7b26</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_userid_module/#_4","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/http/ngx_http_userid_module.html</li> </ul>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/","title":"ngx_http_uwsgi_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>uwsgi_bind</li> <li>uwsgi_buffer_size</li> <li>uwsgi_buffering</li> <li>uwsgi_buffers</li> <li>uwsgi_busy_buffers_size</li> <li>uwsgi_cache</li> <li>uwsgi_cache_background_update</li> <li>uwsgi_cache_bypass</li> <li>uwsgi_cache_key</li> <li>uwsgi_cache_lock</li> <li>uwsgi_cache_lock_age</li> <li>uwsgi_cache_lock_timeout</li> <li>uwsgi_cache_max_range_offset</li> <li>uwsgi_cache_methods</li> <li>uwsgi_cache_min_uses</li> <li>uwsgi_cache_path</li> <li>uwsgi_cache_purge</li> <li>uwsgi_cache_revalidate</li> <li>uwsgi_cache_use_stale</li> <li>uwsgi_cache_valid</li> <li>uwsgi_connect_timeout</li> <li>uwsgi_force_ranges</li> <li>uwsgi_hide_header</li> <li>uwsgi_ignore_client_abort</li> <li>uwsgi_ignore_headers</li> <li>uwsgi_intercept_errors</li> <li>uwsgi_limit_rate</li> <li>uwsgi_max_temp_file_size</li> <li>uwsgi_modifier1</li> <li>uwsgi_modifier2</li> <li>uwsgi_next_upstream</li> <li>uwsgi_next_upstream_timeout</li> <li>uwsgi_next_upstream_tries</li> <li>uwsgi_no_cache</li> <li>uwsgi_param</li> <li>uwsgi_pass</li> <li>uwsgi_pass_header</li> <li>uwsgi_pass_request_body</li> <li>uwsgi_pass_request_headers</li> <li>uwsgi_read_timeout</li> <li>uwsgi_request_buffering</li> <li>uwsgi_send_timeout</li> <li>uwsgi_socket_keepalive</li> <li>uwsgi_ssl_certificate</li> <li>uwsgi_ssl_certificate_key</li> <li>uwsgi_ssl_ciphers</li> <li>uwsgi_ssl_crl</li> <li>uwsgi_ssl_name</li> <li>uwsgi_ssl_password_file</li> <li>uwsgi_ssl_protocols</li> <li>uwsgi_ssl_server_name</li> <li>uwsgi_ssl_session_reuse</li> <li>uwsgi_ssl_trusted_certificate</li> <li>uwsgi_ssl_verify</li> <li>uwsgi_ssl_verify_depth</li> <li>uwsgi_store</li> <li>uwsgi_store_access</li> <li>uwsgi_temp_file_write_size</li> <li>uwsgi_temp_path</li> </ul> </li> </ul> <p><code>ngx_http_uwsgi_module</code> \u6a21\u5757\u5141\u8bb8\u5c06\u8bf7\u6c42\u4f20\u9012\u5230 uwsgi \u670d\u52a1\u5668\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location / {\ninclude    uwsgi_params;\nuwsgi_pass localhost:9000;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_bind","title":"uwsgi_bind","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_bind <code>address [transparent]</code> | <code>off</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u4f7f\u5230 uwsgi \u670d\u52a1\u5668\u7684\u4f20\u51fa\u8fde\u63a5\u6e90\u81ea\u6709\u4e00\u4e2a\u53ef\u9009\u7aef\u53e3\uff081.11.2\uff09\u7684\u6307\u5b9a\u672c\u5730 IP \u5730\u5740\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.3.12\uff09\u3002\u7279\u6b8a\u503c <code>off</code>\uff081.3.12\uff09\u53d6\u6d88\u4ece\u5148\u524d\u7684\u914d\u7f6e\u7ea7\u522b\u7ee7\u627f\u7684 <code>uwsgi_bind</code> \u6307\u4ee4\u7684\u4f5c\u7528\uff0c\u8fd9\u4f7f\u7cfb\u7edf\u53ef\u4ee5\u81ea\u52a8\u5206\u914d\u672c\u5730 IP \u5730\u5740\u548c\u7aef\u53e3\u3002</p> <p><code>transparent</code> \u53c2\u6570\uff081.11.0\uff09\u5141\u8bb8\u5230 uwsgi \u670d\u52a1\u5668\u7684\u4f20\u51fa\u8fde\u63a5\u6765\u81ea\u975e\u672c\u5730 IP \u5730\u5740\uff0c\u4f8b\u5982\uff0c\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u771f\u5b9e IP \u5730\u5740\uff1a</p> <pre><code>uwsgi_bind $remote_addr transparent;\n</code></pre> <p>\u4e3a\u4e86\u4f7f\u8be5\u53c2\u6570\u8d77\u4f5c\u7528\uff0c\u901a\u5e38\u5fc5\u987b\u4f7f\u7528\u8d85\u7ea7\u7528\u6237\u7279\u6743\u8fd0\u884c nginx \u5de5\u4f5c\u8fdb\u7a0b\u3002\u5728 Linux \u4e0a\u4e0d\u9700\u8981\u8fd9\u6837\u505a\uff081.13.8\uff09\uff0c\u5c31\u50cf\u6307\u5b9a\u4e86 <code>transparent</code> \u53c2\u6570\u4e00\u6837\uff0c\u5de5\u4f5c\u8fdb\u7a0b\u4ece\u4e3b\u8fdb\u7a0b\u7ee7\u627f <code>CAP_NET_RAW</code> \u529f\u80fd\u3002\u8fd8\u5fc5\u987b\u914d\u7f6e\u5185\u6838\u8def\u7531\u8868\u4ee5\u62e6\u622a\u6765\u81ea uwsgi \u670d\u52a1\u5668\u7684\u7f51\u7edc\u6d41\u91cf\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_buffer_size","title":"uwsgi_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_buffer_size <code>size</code>; \u9ed8\u8ba4 uwsgi_buffer_size 4k|8k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u7528\u4e8e\u8bfb\u53d6\u4ece uwsgi \u670d\u52a1\u5668\u63a5\u6536\u5230\u7684\u54cd\u5e94\u7684\u7b2c\u4e00\u90e8\u5206\u7684\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u8fd9\u90e8\u5206\u901a\u5e38\u5305\u542b\u4e00\u4e2a\u5c0f\u7684\u54cd\u5e94\u5934\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u51b2\u533a\u5927\u5c0f\u7b49\u4e8e\u4e00\u4e2a\u5185\u5b58\u9875\u3002\u6839\u636e\u5e73\u53f0\u7684\u4e0d\u540c\uff0c\u5b83\u53ef\u4ee5\u662f 4K \u6216 8K\u3002\u4f46\u662f\uff0c\u5b83\u53ef\u4ee5\u66f4\u5c0f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_buffering","title":"uwsgi_buffering","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_buffering <code>on</code> | <code>off</code>; \u9ed8\u8ba4 uwsgi_buffering on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u542f\u7528\u6216\u7981\u7528\u6765\u81ea uwsgi \u670d\u52a1\u5668\u7684\u54cd\u5e94\u7f13\u51b2\u3002</p> <p>\u542f\u7528\u7f13\u51b2\u540e\uff0cnginx \u4f1a\u5c3d\u5feb\u4ece uwsgi \u670d\u52a1\u5668\u6536\u5230\u54cd\u5e94\uff0c\u5e76\u5c06\u5176\u4fdd\u5b58\u5230 uwsgi_buffer_size \u548c uwsgi_buffers \u6307\u4ee4\u8bbe\u7f6e\u7684\u7f13\u51b2\u533a\u4e2d\u3002\u5982\u679c\u6574\u4e2a\u54cd\u5e94\u90fd\u65e0\u6cd5\u5bb9\u7eb3\u5230\u5185\u5b58\u4e2d\uff0c\u5219\u53ef\u4ee5\u5c06\u4e00\u90e8\u5206\u54cd\u5e94\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u7684\u4e34\u65f6\u6587\u4ef6\u4e2d\u3002\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u7531 uwsgi_max_temp_file_size \u548c uwsgi_temp_file_write_size \u6307\u4ee4\u63a7\u5236\u3002</p> <p>\u7981\u7528\u7f13\u51b2\u540e\uff0c\u4e00\u65e6\u6536\u5230\u54cd\u5e94\u5c31\u7acb\u5373\u540c\u6b65\u4f20\u9012\u5230\u5ba2\u6237\u7aef\u3002nginx \u4e0d\u4f1a\u5c1d\u8bd5\u4ece uwsgi \u670d\u52a1\u5668\u8bfb\u53d6\u6574\u4e2a\u54cd\u5e94\u3002nginx \u4e00\u6b21\u53ef\u4ee5\u4ece\u670d\u52a1\u5668\u63a5\u6536\u7684\u6700\u5927\u6570\u636e\u5927\u5c0f\u7531 uwsgi_buffer_size \u6307\u4ee4\u8bbe\u7f6e\u3002</p> <p>\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5728 <code>X-Accel-Buffering</code> \u54cd\u5e94\u5934\u5b57\u6bb5\u4e2d\u4f20\u9012 <code>yes</code> \u6216 <code>no</code> \u6765\u542f\u7528\u6216\u7981\u7528\u7f13\u51b2\u3002\u53ef\u4ee5\u4f7f\u7528 uwsgi_ignore_headers \u6307\u4ee4\u7981\u7528\u6b64\u529f\u80fd\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_buffers","title":"uwsgi_buffers","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_buffers <code>number size</code>; \u9ed8\u8ba4 uwsgi_buffers 8 4k|8k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u4e3a\u5355\u4e2a\u8fde\u63a5\u8bbe\u7f6e\u7528\u4e8e\u4ece uwsgi \u670d\u52a1\u5668\u8bfb\u53d6\u54cd\u5e94\u7684\u7f13\u51b2\u533a\u7684\u6570\u91cf\u548c\u5927\u5c0f\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u51b2\u533a\u5927\u5c0f\u7b49\u4e8e\u4e00\u4e2a\u5185\u5b58\u9875\u3002\u6839\u636e\u5e73\u53f0\u7684\u4e0d\u540c\uff0c\u5b83\u53ef\u4ee5\u662f 4K \u6216 8K\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_busy_buffers_size","title":"uwsgi_busy_buffers_size","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_busy_buffers_size <code>size</code>; \u9ed8\u8ba4 uwsgi_busy_buffers_size 8k|16k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5f53\u542f\u7528\u6765\u81ea uwsgi \u670d\u52a1\u5668\u7684\u54cd\u5e94\u7f13\u51b2\u540e\uff0c\u5c06\u9650\u5236\u5728\u5c1a\u672a\u5b8c\u5168\u8bfb\u53d6\u54cd\u5e94\u65f6\u6b63\u5fd9\u4e8e\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u54cd\u5e94\u7684\u7f13\u51b2\u533a\u7684\u603b\u5927\u5c0f\u3002\u540c\u65f6\uff0c\u5176\u4f59\u7684\u7f13\u51b2\u533a\u53ef\u7528\u4e8e\u8bfb\u53d6\u54cd\u5e94\uff0c\u5e76\u5728\u9700\u8981\u65f6\u5c06\u54cd\u5e94\u7684\u4e00\u90e8\u5206\u7f13\u51b2\u5230\u4e34\u65f6\u6587\u4ef6\u4e2d\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5927\u5c0f\u53d7 uwsgi_buffer_size \u548c uwsgi_buffers \u6307\u4ee4\u8bbe\u7f6e\u7684\u4e24\u4e2a\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_cache","title":"uwsgi_cache","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_cache <code>on</code> | <code>off</code>; \u9ed8\u8ba4 uwsgi_cache off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u7528\u4e8e\u7f13\u5b58\u7684\u5171\u4eab\u5185\u5b58\u533a\u57df\u3002\u540c\u4e00\u533a\u57df\u53ef\u4ee5\u5728\u591a\u4e2a\u5730\u65b9\u4f7f\u7528\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.7.9\uff09\u3002<code>off</code> \u53c2\u6570\u7981\u7528\u4ece\u5148\u524d\u914d\u7f6e\u7ea7\u522b\u7ee7\u627f\u7684\u7f13\u5b58\u914d\u7f6e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_cache_background_update","title":"uwsgi_cache_background_update","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_cache_background_update <code>on</code> | <code>off</code>; \u9ed8\u8ba4 uwsgi_cache_background_update off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.10 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5141\u8bb8\u542f\u52a8\u540e\u53f0\u5b50\u8bf7\u6c42\u4ee5\u66f4\u65b0\u8fc7\u671f\u7684\u7f13\u5b58\u9879\uff0c\u540c\u65f6\u5c06\u9648\u65e7\u7684\u7f13\u5b58\u54cd\u5e94\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u8bf7\u6ce8\u610f\uff0c\u6709\u5fc5\u8981\u5728\u66f4\u65b0\u65f6\u5141\u8bb8\u4f7f\u7528\u8fc7\u671f\u7684\u7f13\u5b58\u54cd\u5e94\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_cache_bypass","title":"uwsgi_cache_bypass","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_cache_bypass <code>string ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.10 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5b9a\u4e49\u4e0d\u4ece\u7f13\u5b58\u83b7\u53d6\u54cd\u5e94\u7684\u6761\u4ef6\u3002\u5982\u679c\u5b57\u7b26\u4e32\u53c2\u6570\u4e2d\u6709\u4e00\u4e2a\u503c\u4e0d\u4e3a\u7a7a\u4e14\u4e0d\u7b49\u4e8e <code>0</code>\uff0c\u5219\u4e0d\u4f1a\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u54cd\u5e94\uff1a</p> <pre><code>uwsgi_cache_bypass $cookie_nocache $arg_nocache$arg_comment;\nuwsgi_cache_bypass $http_pragma    $http_authorization;\n</code></pre> <p>\u53ef\u4ee5\u4e0e uwsgi_no_cache \u6307\u4ee4\u4e00\u8d77\u4f7f\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_cache_key","title":"uwsgi_cache_key","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_cache_key <code>string</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u7528\u4e8e\u7f13\u5b58\u7684 key\uff0c\u4f8b\u5982</p> <pre><code>uwsgi_cache_key localhost:9000$request_uri;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_cache_lock","title":"uwsgi_cache_lock","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_cache_lock <code>on</code> | <code>off</code>; \u9ed8\u8ba4 uwsgi_cache_lock off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.12 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u540e\uff0c\u4e00\u6b21\u4ec5\u5141\u8bb8\u4e00\u4e2a\u8bf7\u6c42\u901a\u8fc7\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9 uwsgi \u670d\u52a1\u5668\u6765\u586b\u5145\u6839\u636e uwsgi_cache_key \u6307\u4ee4\u6807\u8bc6\u7684\u65b0\u7f13\u5b58\u5143\u7d20\u3002\u5728 uwsgi_cache_lock_timeout \u6307\u4ee4\u8bbe\u7f6e\u7684\u65f6\u95f4\u4e4b\u524d\uff0c\u540c\u4e00\u7f13\u5b58\u5143\u7d20\u7684\u5176\u4ed6\u8bf7\u6c42\u5c06\u7b49\u5f85\u54cd\u5e94\u51fa\u73b0\u5728\u7f13\u5b58\u4e2d\uff0c\u6216\u8005\u7b49\u5f85\u7f13\u5b58\u9501\u5b9a\u91ca\u653e\u8be5\u5143\u7d20\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_cache_lock_age","title":"uwsgi_cache_lock_age","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_cache_lock_age <code>time</code>; \u9ed8\u8ba4 uwsgi_cache_lock_age 5s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.8 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5982\u679c\u6700\u540e\u4e00\u6b21\u4f20\u9012\u7ed9 uwsgi \u670d\u52a1\u5668\u7528\u4e8e\u586b\u5145\u65b0\u7f13\u5b58\u5143\u7d20\u7684\u8bf7\u6c42\u5728\u6307\u5b9a\u65f6\u95f4\uff08<code>time</code>\uff09\u5185\u672a\u5b8c\u6210\uff0c\u5219\u53ef\u80fd\u518d\u6709\u4e00\u4e2a\u8bf7\u6c42\u4f20\u9012\u7ed9 uwsgi \u670d\u52a1\u5668\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_cache_lock_timeout","title":"uwsgi_cache_lock_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_cache_lock_timeout <code>time</code>; \u9ed8\u8ba4 uwsgi_cache_lock_timeout 5s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.12 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u4e3a uwsgi_cache_lock \u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u3002\u65f6\u95f4\u5230\u65f6\uff0c\u8bf7\u6c42\u5c06\u88ab\u4f20\u9012\u5230 uwsgi \u670d\u52a1\u5668\uff0c\u4f46\u54cd\u5e94\u5c06\u4e0d\u4f1a\u88ab\u7f13\u5b58\u3002</p> <p>\u5728 1.7.8 \u7248\u672c\u4e4b\u524d\uff0c\u53ef\u4ee5\u7f13\u5b58\u54cd\u5e94\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_cache_max_range_offset","title":"uwsgi_cache_max_range_offset","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_cache_max_range_offset <code>number</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.6 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u5b57\u8282\u8303\u56f4\uff08byte-range\uff09\u8bf7\u6c42\u7684\u5b57\u8282\u504f\u79fb\u91cf\u3002\u5982\u679c\u8303\u56f4\u8d85\u51fa\u504f\u79fb\u91cf\uff0c\u5219\u8303\u56f4\u8bf7\u6c42\u5c06\u4f20\u9012\u5230 uwsgi \u670d\u52a1\u5668\uff0c\u5e76\u4e14\u4e0d\u4f1a\u7f13\u5b58\u54cd\u5e94\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_cache_methods","title":"uwsgi_cache_methods","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_cache_methods <code>GET</code> | <code>HEAD</code> | <code>POST ...</code>; \u9ed8\u8ba4 uwsgi_cache_methods GET HEAD; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5982\u679c\u6b64\u6307\u4ee4\u4e2d\u5217\u51fa\u4e86\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u65b9\u6cd5\uff0c\u5219\u5c06\u7f13\u5b58\u54cd\u5e94\u3002\u5efa\u8bae\u663e\u5f0f\u6307\u5b9a <code>GET</code> \u548c <code>HEAD</code> \u65b9\u6cd5\uff0c\u867d\u7136\u5b83\u4eec\u59cb\u7ec8\u6dfb\u52a0\u5728\u5217\u8868\u4e2d\u3002\u53e6\u8bf7\u53c2\u89c1 uwsgi_no_cache \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_cache_min_uses","title":"uwsgi_cache_min_uses","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_cache_min_uses <code>number</code>; \u9ed8\u8ba4 uwsgi_cache_min_uses 1; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u8bf7\u6c42\u6570\uff08<code>number</code>\uff09\uff0c\u4e4b\u540e\u5c06\u7f13\u5b58\u54cd\u5e94\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_cache_path","title":"uwsgi_cache_path","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_cache_path <code>path [levels=levels] [use_temp_path=on\\|off] keys_zone=name:size [inactive=time] [max_size=size] [manager_files=number] [manager_sleep=time] [manager_threshold=time] [loader_files=number] [loader_sleep=time] [loader_threshold=time] [purger=on\\|off] [purger_files=number] [purger_sleep=time] [purger_threshold=time]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http <p>\u8bbe\u7f6e\u7f13\u5b58\u7684\u8def\u5f84\u548c\u5176\u4ed6\u53c2\u6570\u3002\u7f13\u5b58\u6570\u636e\u5b58\u50a8\u5728\u6587\u4ef6\u4e2d\u3002\u7f13\u5b58\u4e2d\u7684\u6587\u4ef6\u540d\u662f\u5c06\u7f13\u5b58 key \u7ecf\u8fc7 MD5 \u8ba1\u7b97\u540e\u5f97\u5230\u3002<code>levels</code> \u53c2\u6570\u5b9a\u4e49\u7f13\u5b58\u7684\u5c42\u6b21\u7ed3\u6784\u7ea7\u522b\uff1a\u4ece 1 \u5230 3\uff0c\u6bcf\u4e2a\u7ea7\u522b\u63a5\u53d7\u503c 1 \u6216 2\u3002\u4f8b\u5982\uff0c\u5728\u4ee5\u4e0b\u914d\u7f6e\u4e2d</p> <pre><code>uwsgi_cache_path /data/nginx/cache levels=1:2 keys_zone=one:10m;\n</code></pre> <p>\u7f13\u5b58\u4e2d\u7684\u6587\u4ef6\u540d\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>/data/nginx/cache/c/29/b7f54b2df7773722d382f4809d65029c\n</code></pre> <p>\u9996\u5148\u5c06\u7f13\u5b58\u7684\u54cd\u5e94\u5199\u5165\u4e34\u65f6\u6587\u4ef6\uff0c\u7136\u540e\u91cd\u547d\u540d\u8be5\u6587\u4ef6\u3002\u4ece 0.8.9 \u7248\u672c\u5f00\u59cb\uff0c\u4e34\u65f6\u6587\u4ef6\u548c\u7f13\u5b58\u53ef\u4ee5\u653e\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002\u4f46\u8bf7\u6ce8\u610f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6587\u4ef6\u8de8\u8d8a\u4e86\u4e24\u4e2a\u6587\u4ef6\u7cfb\u7edf\u590d\u5236\uff0c\u800c\u4e0d\u662f\u7b80\u5355\u7684\u91cd\u547d\u540d\u64cd\u4f5c\u3002\u56e0\u6b64\uff0c\u5efa\u8bae\u5bf9\u4e8e\u4efb\u4f55\u7ed9\u5b9a\u4f4d\u7f6e\uff0c\u5c06\u7f13\u5b58\u548c\u4e34\u65f6\u6587\u4ef6\u4fdd\u5b58\u76ee\u5f55\u90fd\u653e\u5728\u540c\u4e00\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002\u57fa\u4e8e <code>use_temp_path</code> \u53c2\u6570\uff081.7.10\uff09\u8bbe\u7f6e\u4e34\u65f6\u6587\u4ef6\u7684\u76ee\u5f55\uff0c\u5982\u679c\u7701\u7565\u6b64\u53c2\u6570\u6216\u5c06\u5176\u8bbe\u7f6e\u4e3a <code>on</code> \u503c\uff0c\u5219\u5c06\u4f7f\u7528 uwsgi_temp_path \u6307\u4ee4\u6307\u5b9a\u7684\u76ee\u5f55\u3002\u5982\u679c\u5c06\u8be5\u503c\u8bbe\u7f6e\u4e3a <code>off</code>\uff0c\u5219\u4e34\u65f6\u6587\u4ef6\u5c06\u76f4\u63a5\u653e\u7f6e\u5728\u7f13\u5b58\u76ee\u5f55\u4e2d\u3002</p> <p>\u6b64\u5916\uff0c\u6240\u6709\u6d3b\u8dc3\u7684 key \u548c\u6709\u5173\u6570\u636e\u7684\u4fe1\u606f\u90fd\u5b58\u50a8\u5728\u5171\u4eab\u5b58\u50a8\u533a\u4e2d\uff0c\u8be5\u5b58\u50a8\u533a\u7684 <code>name</code> \u548c <code>size</code> \u7531 <code>keys_zone</code> \u53c2\u6570\u914d\u7f6e\u3002\u4e00\u4e2a 1 \u5146\u5b57\u8282\u7684\u533a\u57df\u53ef\u4ee5\u5b58\u50a8\u5927\u7ea6 8000 \u4e2a key\u3002</p> <p>\u4f5c\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\uff0c\u5171\u4eab\u5185\u5b58\u533a\u57df\u8fd8\u5b58\u50a8\u7f13\u5b58\u6269\u5c55\u4fe1\u606f\uff0c\u56e0\u6b64\uff0c\u9700\u8981\u4e3a\u76f8\u540c\u6570\u91cf\u7684 key \u6307\u5b9a\u66f4\u5927\u7684\u533a\u57df\u5927\u5c0f\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a 1MB \u7684\u533a\u57df\u53ef\u4ee5\u5b58\u50a8\u5927\u7ea6 4000 \u4e2a key\u3002</p> <p>\u5728 <code>inactive</code> \u53c2\u6570\u6307\u5b9a\u7684\u65f6\u95f4\u5185\u672a\u8bbf\u95ee\u7684\u7f13\u5b58\u6570\u636e\uff0c\u65e0\u8bba\u5176\u65b0\u9c9c\u5ea6\u5982\u4f55\uff0c\u90fd\u5c06\u4ece\u7f13\u5b58\u4e2d\u5220\u9664\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>inactive</code> \u8bbe\u7f6e\u4e3a 10 \u5206\u949f\u3002</p> <p>\u7279\u6b8a\u7684\u300c\u7f13\u5b58\u7ba1\u7406\u5668\u300d\uff08cache manager\uff09\u8fdb\u7a0b\u76d1\u89c6\u7684\u6700\u5927\u7f13\u5b58\u5927\u5c0f\u7531 <code>max_size</code> \u53c2\u6570\u8bbe\u7f6e\u3002\u5f53\u8d85\u8fc7\u6b64\u5927\u5c0f\u65f6\uff0c\u5b83\u5c06\u5220\u9664\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u3002\u5728\u7531 <code>manager_files</code>\u3001<code>manager_threshold</code> \u548c <code>manager_sleep</code> \u53c2\u6570\uff081.11.5\uff09\u914d\u7f6e\u7684\u8fed\u4ee3\u4e2d\u5220\u9664\u6570\u636e\u3002\u5728\u4e00\u6b21\u8fed\u4ee3\u4e2d\uff0c\u6700\u591a\u5220\u9664 <code>manager_files</code> \u9879\uff08\u9ed8\u8ba4\u4e3a 100\uff09\u3002\u4e00\u6b21\u8fed\u4ee3\u7684\u6301\u7eed\u65f6\u95f4\u53d7 <code>manager_threshold</code> \u53c2\u6570\u9650\u5236\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a 200 \u6beb\u79d2\uff09\u3002\u5728\u8fed\u4ee3\u4e4b\u95f4\uff0c\u5c06\u6267\u884c\u7531 <code>manager_sleep</code> \u53c2\u6570\u914d\u7f6e\u7684\u95f4\u9694\u65f6\u95f4\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a 50 \u6beb\u79d2\uff09\u3002</p> <p>\u542f\u52a8\u540e\u4e00\u5206\u949f\uff0c\u300c\u7f13\u5b58\u52a0\u8f7d\u5668\u300d\uff08cache loader\uff09\u8fdb\u7a0b\u88ab\u6fc0\u6d3b\u3002\u5b83\u5c06\u6709\u5173\u5b58\u50a8\u5728\u6587\u4ef6\u7cfb\u7edf\u4e0a\u7684\u5148\u524d\u7f13\u5b58\u6570\u636e\u7684\u4fe1\u606f\u52a0\u8f7d\u5230\u7f13\u5b58\u533a\u57df\u4e2d\u3002\u52a0\u8f7d\u4e5f\u4ee5\u8fed\u4ee3\u65b9\u5f0f\u5b8c\u6210\u3002\u5728\u4e00\u6b21\u8fed\u4ee3\u4e2d\uff0c\u6700\u591a\u52a0\u8f7d <code>loader_files</code> \u9879\uff08\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a 100\uff09\u3002\u6b64\u5916\uff0c\u4e00\u6b21\u8fed\u4ee3\u7684\u6301\u7eed\u65f6\u95f4\u53d7 <code>loader_threshold</code> \u53c2\u6570\u9650\u5236\uff08\u9ed8\u8ba4\u4e3a 200 \u6beb\u79d2\uff09\u3002\u5728\u8fed\u4ee3\u4e4b\u95f4\uff0c\u5c06\u6267\u884c\u7531 <code>loader_sleep</code> \u53c2\u6570\u914d\u7f6e\u7684\u6682\u505c\u65f6\u95f4\uff08\u9ed8\u8ba4\u4e3a 50 \u6beb\u79d2\uff09\u3002</p> <p>\u6b64\u5916\uff0c\u4ee5\u4e0b\u53c2\u6570\u4f5c\u4e3a\u6211\u4eec\u7684\u5546\u4e1a\u8ba2\u8d2d\u90e8\u5206\uff1a</p> <ul> <li> <p><code>purger=on|off</code></p> <p>\u6307\u793a\u662f\u5426\u7531\u7f13\u5b58\u6e05\u9664\u5668\uff081.7.12\uff09\u4ece\u78c1\u76d8\u4e0a\u5220\u9664\u4e0e\u901a\u914d\u7b26\u5339\u914d\u7684\u7f13\u5b58\u6761\u76ee\u3002\u5c06\u53c2\u6570\u8bbe\u7f6e\u4e3a <code>on</code>\uff08\u9ed8\u8ba4\u4e3a <code>off</code>\uff09\u5c06\u6fc0\u6d3b\u300c\u7f13\u5b58\u6e05\u9664\u5668\u300d\u8fdb\u7a0b\uff0c\u8be5\u8fc7\u7a0b\u5c06\u6c38\u4e45\u6027\u5730\u904d\u5386\u6240\u6709\u7f13\u5b58\u6761\u76ee\uff0c\u5e76\u5220\u9664\u4e0e\u901a\u914d\u7b26\u5339\u914d\u7684\u6761\u76ee\u3002</p> </li> <li> <p><code>purger_files=number</code></p> <p>\u8bbe\u7f6e\u4e00\u6b21\u8fed\u4ee3\uff081.7.12\uff09\u671f\u95f4\u8981\u626b\u63cf\u7684\u6761\u76ee\u6570\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>purger_files</code> \u8bbe\u7f6e\u4e3a 10\u3002</p> </li> <li> <p><code>purger_threshold=number</code></p> <p>\u8bbe\u7f6e\u4e00\u6b21\u8fed\u4ee3\u7684\u6301\u7eed\u65f6\u95f4\uff081.7.12\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>purger_threshold</code> \u8bbe\u7f6e\u4e3a 50 \u6beb\u79d2\u3002</p> </li> <li> <p><code>purger_sleep=number</code></p> </li> </ul> <p>\u8bbe\u7f6e\u8fed\u4ee3\u4e4b\u95f4\u7684\u6682\u505c\u65f6\u95f4\uff081.7.12\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>purger_sleep</code> \u8bbe\u7f6e\u4e3a 50 \u6beb\u79d2\u3002</p> <p>\u5728 1.7.3\u30011.7.7 \u548c 1.11.10 \u7248\u672c\u4e2d\uff0c\u7f13\u5b58\u5934\u683c\u5f0f\u5df2\u66f4\u6539\u3002\u5347\u7ea7\u5230\u8f83\u65b0\u7684 nginx \u7248\u672c\u540e\uff0c\u4ee5\u524d\u7f13\u5b58\u7684\u54cd\u5e94\u5c06\u88ab\u89c6\u4e3a\u65e0\u6548\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_cache_purge","title":"uwsgi_cache_purge","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_cache_purge <code>string ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5b9a\u4e49\u5c06\u8bf7\u6c42\u89c6\u4e3a\u7f13\u5b58\u6e05\u9664\u8bf7\u6c42\u7684\u6761\u4ef6\u3002\u5982\u679c\u5b57\u7b26\u4e32\u53c2\u6570\u4e2d\u6709\u4e00\u4e2a\u503c\u4e0d\u4e3a\u7a7a\u4e14\u4e0d\u7b49\u4e8e <code>0</code>\uff0c\u5219\u5c06\u5220\u9664\u6709\u76f8\u5e94\u7f13\u5b58\u952e\u7684\u7f13\u5b58\u6761\u76ee\u3002\u8fd4\u56de 204\uff08No Content\uff09\u54cd\u5e94\u6307\u793a\u6210\u529f\u64cd\u4f5c\u7684\u7ed3\u679c\u3002</p> <p>\u5982\u679c\u6e05\u9664\u8bf7\u6c42\u7684\u7f13\u5b58\u952e\u4ee5\u661f\u53f7\uff08<code>*</code>\uff09\u7ed3\u5c3e\uff0c\u5219\u6240\u6709\u4e0e\u901a\u914d\u7b26\u5339\u914d\u7684\u7f13\u5b58\u6761\u76ee\u90fd\u5c06\u4ece\u7f13\u5b58\u4e2d\u5220\u9664\u3002\u4f46\u662f\uff0c\u8fd9\u4e9b\u6761\u76ee\u5c06\u4fdd\u7559\u5728\u78c1\u76d8\u4e0a\uff0c\u76f4\u5230\u56e0\u4e0d\u6d3b\u8dc3\u800c\u5c06\u5176\u5220\u9664\u6216\u7531\u7f13\u5b58\u6e05\u9664\u7a0b\u5e8f\uff081.7.12\uff09\u5904\u7406\u6216\u5ba2\u6237\u7aef\u5c1d\u8bd5\u8bbf\u95ee\u5b83\u4eec\u4e3a\u6b62\u3002</p> <p>\u914d\u7f6e\u793a\u4f8b\uff1a</p> <pre><code>uwsgi_cache_path /data/nginx/cache keys_zone=cache_zone:10m;\n\nmap $request_method $purge_method {\nPURGE   1;\ndefault 0;\n}\n\nserver {\n...\nlocation / {\nuwsgi_pass        backend;\nuwsgi_cache       cache_zone;\nuwsgi_cache_key   $uri;\nuwsgi_cache_purge $purge_method;\n}\n}\n</code></pre> <p>\u6b64\u529f\u80fd\u662f\u6211\u4eec\u7684\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\u5185\u5bb9\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_cache_revalidate","title":"uwsgi_cache_revalidate","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_cache_revalidate <code>on</code> | <code>off</code>; \u9ed8\u8ba4 uwsgi_cache_revalidate off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u4f7f\u7528\u5e26\u6709 <code>If-Modified-Since</code> \u548c <code>If-None-Match</code> \u5934\u5b57\u6bb5\u7684\u6761\u4ef6\u8bf7\u6c42\u91cd\u65b0\u9a8c\u8bc1\u8fc7\u671f\u7f13\u5b58\u9879\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_cache_use_stale","title":"uwsgi_cache_use_stale","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_cache_use_stale <code>uwsgi_cache_use_stale error \\| timeout \\| invalid_header \\| updating \\| http_500 \\| http_503 \\| http_403 \\| http_404 \\| http_429 \\| off ...</code>; \u9ed8\u8ba4 uwsgi_cache_use_stale off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u786e\u5b9a\u5728\u4e0e uwsgi \u670d\u52a1\u5668\u901a\u4fe1\u671f\u95f4\u53d1\u751f\u9519\u8bef\u65f6\u5728\u4ec0\u4e48\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4f7f\u7528\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\u3002\u8be5\u6307\u4ee4\u7684\u53c2\u6570\u4e0e uwsgi_next_upstream \u6307\u4ee4\u7684\u53c2\u6570\u5339\u914d\u3002</p> <p>\u5982\u679c\u65e0\u6cd5\u9009\u62e9 uwsgi \u670d\u52a1\u5668\u6765\u5904\u7406\u8bf7\u6c42\uff0c\u5219 <code>error</code> \u53c2\u6570\u8fd8\u5141\u8bb8\u4f7f\u7528\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\u3002</p> <p>\u6b64\u5916\uff0c\u5982\u679c\u5f53\u524d\u6b63\u5728\u66f4\u65b0 <code>updating</code> \u53c2\u6570\uff0c\u5219\u5141\u8bb8\u4f7f\u7528\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\u3002\u8fd9\u6837\u53ef\u4ee5\u5728\u66f4\u65b0\u7f13\u5b58\u7684\u6570\u636e\u65f6\u6700\u5927\u7a0b\u5ea6\u5730\u51cf\u5c11\u5bf9 uwsgi \u670d\u52a1\u5668\u7684\u8bbf\u95ee\u6b21\u6570\u3002</p> <p>\u5728\u54cd\u5e94\u8fc7\u65f6\uff081.11.10\uff09\u4e4b\u540e\uff0c\u8fd8\u53ef\u4ee5\u5728\u54cd\u5e94\u5934\u4e2d\u76f4\u63a5\u542f\u7528\u4f7f\u7528\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\u5e76\u6307\u5b9a\u7684\u79d2\u6570\u3002\u4e0e\u4f7f\u7528\u6307\u4ee4\u53c2\u6570\u76f8\u6bd4\uff0c\u5b83\u7684\u4f18\u5148\u7ea7\u8f83\u4f4e\u3002</p> <ul> <li>\u5982\u679c <code>Cache-Control</code> \u5934\u5b57\u6bb5\u7684 stale-while-revalidate \u6269\u5c55\u5f53\u524d\u6b63\u5728\u66f4\u65b0\uff0c\u5219\u5141\u8bb8\u4f7f\u7528\u8fc7\u65f6\u7684\u7f13\u5b58\u54cd\u5e94\u3002</li> <li><code>Cache-Control</code> \u5934\u5b57\u6bb5\u7684 stale-if-error \u6269\u5c55\u5141\u8bb8\u5728\u53d1\u751f\u9519\u8bef\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528\u8fc7\u671f\u7f13\u5b58\u7684\u54cd\u5e94\u3002</li> </ul> <p>\u4e3a\u4e86\u5728\u586b\u5145\u65b0\u7684\u7f13\u5b58\u5143\u7d20\u65f6\u6700\u5927\u7a0b\u5ea6\u5730\u51cf\u5c11\u5bf9 uwsgi \u670d\u52a1\u5668\u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u53ef\u4ee5\u4f7f\u7528 uwsgi_cache_lock \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_cache_valid","title":"uwsgi_cache_valid","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_cache_valid <code>[code ...] time</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u4e0d\u540c\u54cd\u5e94\u72b6\u6001\u7801\u7684\u7f13\u5b58\u65f6\u95f4\u3002\u4f8b\u5982\u4ee5\u4e0b\u6307\u4ee4\uff1a</p> <pre><code>uwsgi_cache_valid 200 302 10m;\nuwsgi_cache_valid 404      1m;\n</code></pre> <p>\u4e3a\u72b6\u6001\u7801\u4e3a 200 \u548c 302 \u7684\u54cd\u5e94\u8bbe\u7f6e 10 \u5206\u949f\u7684\u7f13\u5b58\u65f6\u957f\uff0c\u4e3a\u72b6\u6001\u7801\u4e3a 404 \u7684\u54cd\u5e94\u8bbe\u7f6e 1 \u5206\u949f\u7f13\u5b58\u65f6\u957f\u3002</p> <p>\u5982\u679c\u4ec5\u6307\u5b9a\u7f13\u5b58\u65f6\u95f4\uff1a</p> <pre><code>uwsgi_cache_valid 5m;\n</code></pre> <p>\u90a3\u4e48\u4ec5\u7f13\u5b58\u72b6\u6001\u7801\u4e3a 200\u3001301 \u548c 302 \u7684\u54cd\u5e94\u3002</p> <p>\u53e6\u5916\uff0c\u53ef\u4ee5\u6307\u5b9a <code>any</code> \u53c2\u6570\u6765\u7f13\u5b58\u4efb\u4f55\u54cd\u5e94\uff1a</p> <pre><code>uwsgi_cache_valid 200 302 10m;\nuwsgi_cache_valid 301      1h;\nuwsgi_cache_valid any      1m;\n</code></pre> <p>\u7f13\u5b58\u53c2\u6570\u4e5f\u53ef\u4ee5\u76f4\u63a5\u5728\u54cd\u5e94\u5934\u4e2d\u8bbe\u7f6e\u3002\u8fd9\u6bd4\u4f7f\u7528\u6307\u4ee4\u8bbe\u7f6e\u7f13\u5b58\u65f6\u95f4\u5177\u6709\u66f4\u9ad8\u7684\u4f18\u5148\u7ea7\u3002</p> <ul> <li><code>X-Accel-Expires</code> \u5934\u5b57\u6bb5\u4ee5\u79d2\u4e3a\u5355\u4f4d\u8bbe\u7f6e\u54cd\u5e94\u7684\u7f13\u5b58\u65f6\u95f4\u3002\u96f6\u503c\u7981\u7528\u7f13\u5b58\u54cd\u5e94\u3002\u5982\u679c\u8be5\u503c\u4ee5 <code>@</code> \u524d\u7f00\u5f00\u5934\uff0c\u5219\u5b83\u8bbe\u7f6e\u81ea Epoch \u4ee5\u6765\u7684\u7edd\u5bf9\u65f6\u95f4\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09\uff0c\u76f4\u5230\u6b64\u65f6\u95f4\u4e3a\u6b62\uff0c\u54cd\u5e94\u90fd\u53ef\u4ee5\u88ab\u7f13\u5b58\u3002</li> <li>\u5982\u679c\u5934\u4e0d\u5305\u62ec <code>X-Accel-Expires</code> \u5b57\u6bb5\uff0c\u5219\u53ef\u4ee5\u5728\u5934\u5b57\u6bb5 <code>Expires</code> \u6216 <code>Cache-Control</code> \u4e2d\u8bbe\u7f6e\u7f13\u5b58\u53c2\u6570\u3002</li> <li>\u5982\u679c\u5934\u4e2d\u5305\u542b <code>Set-Cookie</code> \u5b57\u6bb5\uff0c\u5219\u4e0d\u4f1a\u7f13\u5b58\u6b64\u7c7b\u54cd\u5e94\u3002</li> <li>\u5982\u679c\u5934\u5305\u542b\u5e26\u6709\u7279\u6b8a\u503c <code>*</code> \u7684 <code>Vary</code> \u5b57\u6bb5\uff0c\u5219\u4e0d\u4f1a\u7f13\u5b58\u6b64\u7c7b\u54cd\u5e94\uff081.7.7\uff09\u3002\u5982\u679c\u5934\u5305\u542b\u5e26\u6709\u53e6\u4e00\u4e2a\u503c\u7684 <code>Vary</code> \u5b57\u6bb5\uff0c\u5219\u5c06\u8003\u8651\u4f7f\u7528\u8be5\u8bf7\u6c42\u5934\u5b57\u6bb5\uff081.7.7\uff09\u6765\u7f13\u5b58\u6b64\u7c7b\u54cd\u5e94\u3002</li> </ul> <p>\u53ef\u4ee5\u4f7f\u7528 uwsgi_ignore_headers \u6307\u4ee4\u7981\u7528\u5bf9\u8fd9\u4e9b\u54cd\u5e94\u5934\u5b57\u6bb5\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u7684\u5904\u7406\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_connect_timeout","title":"uwsgi_connect_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_connect_timeout <code>time</code>; \u9ed8\u8ba4 uwsgi_connect_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u7528\u4e8e\u4e0e uwsgi \u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u8bf7\u6ce8\u610f\uff0c\u6b64\u8d85\u65f6\u65f6\u95f4\u901a\u5e38\u4e0d\u80fd\u8d85\u8fc7 75 \u79d2\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_force_ranges","title":"uwsgi_force_ranges","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_force_ranges <code>on</code> | <code>off</code>; \u9ed8\u8ba4 uwsgi_force_ranges off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5bf9\u6765\u81ea uwsgi \u670d\u52a1\u5668\u7684\u7f13\u5b58\u548c\u672a\u7f13\u5b58\u54cd\u5e94\u5747\u542f\u7528\u5b57\u8282\u8303\u56f4\uff08byte-range\uff09\u652f\u6301\uff0c\u5ffd\u7565\u8fd9\u4e9b\u54cd\u5e94\u4e2d\u7684 <code>Accept-Ranges</code> \u5b57\u6bb5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_hide_header","title":"uwsgi_hide_header","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_hide_header <code>field</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnginx \u4e0d\u4f1a\u5c06 uwsgi \u670d\u52a1\u5668\u7684\u54cd\u5e94\u4e2d\u7684\u5934\u5b57\u6bb5 <code>Status</code> \u548c <code>X-Accel-...</code> \u4f20\u9012\u7ed9\u5ba2\u6237\u7aef\u3002<code>uwsgi_hide_header</code> \u6307\u4ee4\u8bbe\u7f6e\u4e86\u4e0d\u4f1a\u4f20\u9012\u7684\u5176\u4ed6\u5b57\u6bb5\u3002\u76f8\u53cd\uff0c\u5982\u679c\u9700\u8981\u5141\u8bb8\u4f20\u9012\u5b57\u6bb5\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 uwsgi_pass_header \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_ignore_client_abort","title":"uwsgi_ignore_client_abort","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_ignore_client_abort <code>on</code> | <code>off</code>; \u9ed8\u8ba4 uwsgi_ignore_client_abort off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u786e\u5b9a\u5728\u5ba2\u6237\u7aef\u4e0d\u7b49\u5f85\u54cd\u5e94\u5c31\u5173\u95ed\u8fde\u63a5\u65f6\u662f\u5426\u5e94\u5173\u95ed\u4e0e uwsgi \u670d\u52a1\u5668\u7684\u8fde\u63a5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_ignore_headers","title":"uwsgi_ignore_headers","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_ignore_headers <code>field ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u7981\u7528\u6765\u81ea uwsgi \u670d\u52a1\u5668\u7684\u67d0\u4e9b\u54cd\u5e94\u6807\u5934\u5b57\u6bb5\u7684\u5904\u7406\u3002\u53ef\u4ee5\u5ffd\u7565\u4ee5\u4e0b\u5b57\u6bb5\uff1a<code>X-Accel-Redirect</code>\u3001<code>X-Accel-Expires</code>\u3001<code>X-Accel-Limit-Rate</code>\uff081.1.6\uff09\u3001<code>X-Accel-Buffering</code>\uff081.1.6\uff09 \u3001<code>X-Accel-Charset</code>\uff081.1.6\uff09\u3001<code>Expires</code>\u3001<code>Cache-Control</code>\u3001<code>Set-Cookie</code>\uff080.8.44\uff09\u548c <code>Vary</code>\uff081.7.7\uff09\u3002</p> <p>\u5982\u679c\u672a\u7981\u7528\uff0c\u5219\u5904\u7406\u8fd9\u4e9b\u5934\u5b57\u6bb5\u4f1a\u505a\u4ee5\u4e0b\u5904\u7406\uff1a</p> <ul> <li><code>X-Accel-Expires</code>\u3001<code>Expires</code>\u3001<code>Cache-Control</code>\u3001<code>Set-Cookie</code> \u548c <code>Vary</code> \u8bbe\u7f6e\u54cd\u5e94\u7f13\u5b58\u7684\u53c2\u6570</li> <li><code>X-Accel-Redirect</code> \u6267\u884c\u5185\u90e8\u91cd\u5b9a\u5411\u5230\u6307\u5b9a\u7684 URI</li> <li><code>X-Accel-Limit-Rate</code> \u8bbe\u7f6e\u5c06\u54cd\u5e94\u4f20\u8f93\u5230\u5ba2\u6237\u7aef\u7684\u901f\u7387\u9650\u5236</li> <li><code>X-Accel-Buffering</code> \u542f\u7528\u6216\u7981\u7528\u54cd\u5e94\u7684\u7f13\u51b2</li> <li><code>X-Accel-Charset</code> \u8bbe\u7f6e\u54cd\u5e94\u7684\u6240\u9700\u5b57\u7b26\u96c6</li> </ul>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_intercept_errors","title":"uwsgi_intercept_errors","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_intercept_errors <code>on</code> | <code>off</code>; \u9ed8\u8ba4 uwsgi_intercept_errors off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u786e\u5b9a\u662f\u5426\u5e94\u5c06\u6709\u5927\u4e8e\u6216\u7b49\u4e8e 300 \u7684\u72b6\u6001\u7801\u7684 uwsgi \u670d\u52a1\u5668\u54cd\u5e94\u4f20\u9012\u7ed9\u5ba2\u6237\u7aef\uff0c\u6216\u8005\u5e94\u5c06\u5176\u62e6\u622a\u5e76\u91cd\u5b9a\u5411\u5230 nginx \u4ee5\u4f7f\u7528 error_page \u6307\u4ee4\u8fdb\u884c\u5904\u7406\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_limit_rate","title":"uwsgi_limit_rate","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_limit_rate <code>rate</code>; \u9ed8\u8ba4 uwsgi_limit_rate 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236\u4ece uwsgi \u670d\u52a1\u5668\u8bfb\u53d6\u54cd\u5e94\u7684\u901f\u5ea6\u3002\u8be5\u901f\u7387\u4ee5\u6bcf\u79d2\u5b57\u8282\u6570\u6307\u5b9a\u3002\u96f6\u503c\u7981\u7528\u901f\u7387\u9650\u5236\u3002\u8be5\u9650\u5236\u662f\u6309\u8bf7\u6c42\u8bbe\u7f6e\u7684\uff0c\u56e0\u6b64\uff0c\u5982\u679c nginx \u540c\u65f6\u6253\u5f00\u4e24\u4e2a\u4e0e uwsgi \u670d\u52a1\u5668\u7684\u8fde\u63a5\uff0c\u5219\u603b\u901f\u7387\u5c06\u662f\u6307\u5b9a\u9650\u5236\u7684\u4e24\u500d\u3002\u4ec5\u5f53\u542f\u7528\u4e86\u6765\u81ea uwsgi \u670d\u52a1\u5668\u7684\u54cd\u5e94\u7f13\u51b2\u65f6\uff0c\u6b64\u9650\u5236\u624d\u6709\u6548\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_max_temp_file_size","title":"uwsgi_max_temp_file_size","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_max_temp_file_size <code>size</code>; \u9ed8\u8ba4 uwsgi_max_temp_file_size 1024m; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5982\u679c\u542f\u7528\u4e86\u6765\u81ea uwsgi \u670d\u52a1\u5668\u7684\u54cd\u5e94\u7f13\u51b2\uff0c\u5e76\u4e14\u6574\u4e2a\u54cd\u5e94\u4e0d\u9002\u5408 uwsgi_buffer_size \u548c uwsgi_buffers \u6307\u4ee4\u8bbe\u7f6e\u7684\u7f13\u51b2\u533a\uff0c\u5219\u53ef\u4ee5\u5c06\u4e00\u90e8\u5206\u54cd\u5e94\u4fdd\u5b58\u5230\u4e34\u65f6\u6587\u4ef6\u4e2d\u3002\u8be5\u6307\u4ee4\u8bbe\u7f6e\u4e34\u65f6\u6587\u4ef6\u7684\u6700\u5927\u5927\u5c0f\u3002\u4e00\u6b21\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u7684\u6570\u636e\u5927\u5c0f\u7531 uwsgi_temp_file_write_size \u6307\u4ee4\u8bbe\u7f6e\u3002</p> <p>\u96f6\u503c\u7981\u7528\u5bf9\u4e34\u65f6\u6587\u4ef6\u7684\u54cd\u5e94\u7f13\u51b2\u3002</p> <p>\u6b64\u9650\u5236\u4e0d\u9002\u7528\u4e8e\u5c06\u88ab\u7f13\u5b58\u6216\u5b58\u50a8\u5728\u78c1\u76d8\u4e0a\u7684\u54cd\u5e94\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_modifier1","title":"uwsgi_modifier1","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_modifier1 <code>number</code>; \u9ed8\u8ba4 uwsgi_modifier1 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e uwsgi \u6570\u636e\u5305\u5934\u4e2d\u7684 <code>modify1</code> \u5b57\u6bb5\u7684\u503c\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_modifier2","title":"uwsgi_modifier2","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_modifier2 <code>number</code>; \u9ed8\u8ba4 uwsgi_modifier2 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e uwsgi \u6570\u636e\u5305\u5934\u4e2d\u7684 <code>modify2</code> \u5b57\u6bb5\u7684\u503c\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_next_upstream","title":"uwsgi_next_upstream","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_next_upstream <code>error \\| timeout \\| invalid_header \\| http_500 \\| http_503 \\| http_403 \\| http_404 \\| http_429 \\| non_idempotent \\| off ...</code>; \u9ed8\u8ba4 uwsgi_next_upstream error timeout; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u5b9a\u5728\u54ea\u79cd\u60c5\u51b5\u4e0b\u5c06\u8bf7\u6c42\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\uff1a</p> <ul> <li> <p><code>error</code></p> <p>\u4e0e\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\uff0c\u5411\u670d\u52a1\u5668\u4f20\u9012\u8bf7\u6c42\u6216\u8bfb\u53d6\u54cd\u5e94\u5934\u65f6\u53d1\u751f\u9519\u8bef</p> </li> <li> <p><code>timeout</code></p> <p>\u4e0e\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\uff0c\u5411\u670d\u52a1\u5668\u4f20\u9012\u8bf7\u6c42\u6216\u8bfb\u53d6\u54cd\u5e94\u6807\u5934\u65f6\u53d1\u751f\u8d85\u65f6</p> </li> <li> <p><code>invalid_header</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u4e86\u7a7a\u7684\u6216\u65e0\u6548\u7684\u54cd\u5e94</p> </li> <li> <p><code>http_500</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u72b6\u6001\u7801\u4e3a 500 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_503</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u54cd\u5e94\uff0c\u72b6\u6001\u7801\u4e3a 503</p> </li> <li> <p><code>http_403</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u54cd\u5e94\uff0c\u72b6\u6001\u7801\u4e3a 403</p> </li> <li> <p><code>http_404</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u4e86\u72b6\u6001\u7801\u4e3a 404 \u7684\u54cd\u5e94</p> </li> <li> <p><code>http_429</code></p> <p>\u670d\u52a1\u5668\u8fd4\u56de\u54cd\u5e94\uff0c\u72b6\u6001\u7801\u4e3a 429\uff081.11.13\uff09</p> </li> <li> <p><code>non_idempotent</code></p> <p>\u901a\u5e38\uff0c\u5982\u679c\u8bf7\u6c42\u5df2\u53d1\u9001\u5230\u4e0a\u6e38\u670d\u52a1\u5668\uff0c\u5219\u975e\u7b49\u5e42\u65b9\u6cd5\uff08<code>POST</code>\u3001<code>LOCK</code>\u3001<code>PATCH</code>\uff09\u7684\u8bf7\u6c42\u4e0d\u4f1a\u4f20\u9012\u5230\u4e0b\u4e00\u670d\u52a1\u5668\uff081.9.13\uff09\uff1b\u660e\u786e\u542f\u7528\u6b64\u9009\u9879\u5c06\u5141\u8bb8\u91cd\u8bd5\u6b64\u7c7b\u8bf7\u6c42</p> </li> <li> <p><code>off</code></p> <p>\u7981\u6b62\u5c06\u8bf7\u6c42\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668</p> </li> </ul> <p>\u5e94\u8be5\u8bb0\u4f4f\u7684\u662f\uff0c\u53ea\u6709\u5728\u8fd8\u6ca1\u6709\u4efb\u4f55\u5185\u5bb9\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u6709\u53ef\u80fd\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e0b\u4e00\u53f0\u670d\u52a1\u5668\u3002\u5373\uff0c\u5982\u679c\u5728\u54cd\u5e94\u7684\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\u6216\u8d85\u65f6\uff0c\u5219\u65e0\u6cd5\u89e3\u51b3\u8be5\u95ee\u9898\u3002</p> <p>\u8be5\u6307\u4ee4\u8fd8\u5b9a\u4e49\u4e86\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u7684\u4e00\u4e2a\u5931\u8d25\u5c1d\u8bd5\u3002<code>error</code>\u3001<code>timeout</code> \u548c <code>invalid_header</code> \u7684\u60c5\u51b5\u59cb\u7ec8\u88ab\u8ba4\u4e3a\u662f\u5931\u8d25\u5c1d\u8bd5\uff0c\u5373\u4f7f\u672a\u5728\u6307\u4ee4\u4e2d\u6307\u5b9a\u5b83\u4eec\u4e5f\u662f\u5982\u6b64\u3002\u4ec5\u5f53\u5728\u6307\u4ee4\u4e2d\u6307\u5b9a\u4e86 <code>http_500</code>\u3001<code>http_503</code> \u548c <code>http_429</code> \u7684\u60c5\u51b5\u65f6\uff0c\u5b83\u4eec\u624d\u88ab\u8ba4\u4e3a\u662f\u5931\u8d25\u5c1d\u8bd5\u3002\u6c38\u8fdc\u4e0d\u4f1a\u5c06 <code>http_403</code> \u548c <code>http_404</code> \u7684\u60c5\u51b5\u89c6\u4e3a\u5931\u8d25\u5c1d\u8bd5\u3002</p> <p>\u5c06\u8bf7\u6c42\u4f20\u9012\u5230\u4e0b\u4e00\u53f0\u670d\u52a1\u5668\u53ef\u80fd\u53d7\u5230\u5c1d\u8bd5\u6b21\u6570\u548c\u65f6\u95f4\u7684\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_next_upstream_timeout","title":"uwsgi_next_upstream_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_next_upstream_timeout <code>time</code>; \u9ed8\u8ba4 uwsgi_next_upstream_timeout 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.5 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236\u5c06\u8bf7\u6c42\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u8d85\u65f6\u65f6\u95f4\u3002<code>0</code> \u503c\u5173\u95ed\u6b64\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_next_upstream_tries","title":"uwsgi_next_upstream_tries","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_next_upstream_tries <code>number</code>; \u9ed8\u8ba4 uwsgi_next_upstream_tries 0; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.5 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236\u5c06\u8bf7\u6c42\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u53ef\u80fd\u5c1d\u8bd5\u6b21\u6570\u3002<code>0</code> \u503c\u5173\u95ed\u6b64\u9650\u5236\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_no_cache","title":"uwsgi_no_cache","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_no_cache <code>string ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e0d\u5c06\u54cd\u5e94\u4fdd\u5b58\u5230\u7f13\u5b58\u7684\u6761\u4ef6\u3002\u5982\u679c\u5b57\u7b26\u4e32\u53c2\u6570\u4e2d\u5b58\u5728\u4e00\u4e2a\u503c\u4e0d\u4e3a\u7a7a\u4e14\u4e0d\u7b49\u4e8e <code>0</code>\uff0c\u5219\u5c06\u4e0d\u4fdd\u5b58\u54cd\u5e94\uff1a</p> <pre><code>uwsgi_no_cache $cookie_nocache $arg_nocache$arg_comment;\nuwsgi_no_cache $http_pragma    $http_authorization;\n</code></pre> <p>\u53ef\u4ee5\u4e0e uwsgi_cache_bypass \u6307\u4ee4\u4e00\u8d77\u4f7f\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_param","title":"uwsgi_param","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_param <code>parameter value [if_not_empty]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u4e00\u4e2a\u5e94\u8be5\u4f20\u9012\u7ed9 uwsgi \u670d\u52a1\u5668\u7684\u53c2\u6570\uff08<code>parameter</code>\uff09\u3002\u8be5\u503c\u53ef\u4ee5\u5305\u542b\u6587\u672c\u3001\u53d8\u91cf\u53ca\u5176\u7ec4\u5408\u3002\u5f53\u4e14\u4ec5\u5f53\u5f53\u524d\u7ea7\u522b\u4e0a\u6ca1\u6709\u5b9a\u4e49 uwsgi_param \u6307\u4ee4\u65f6\uff0c\u8fd9\u4e9b\u6307\u4ee4\u624d\u4ece\u4e0a\u4e00\u7ea7\u7ee7\u627f\u3002</p> <p>\u6807\u51c6 CGI \u73af\u5883\u53d8\u91cf\u5e94\u4f5c\u4e3a uwsgi \u5934\u63d0\u4f9b\uff0c\u8bf7\u53c2\u9605\u53d1\u884c\u7248\u4e2d\u63d0\u4f9b\u7684 <code>uwsgi_params</code> \u6587\u4ef6\uff1a</p> <pre><code>location / {\ninclude uwsgi_params;\n...\n}\n</code></pre> <p>\u5982\u679c\u4f7f\u7528 <code>if_not_empty</code>\uff081.1.11\uff09\u6307\u5b9a\u4e86\u6307\u4ee4\uff0c\u5219\u4ec5\u5f53\u5176\u503c\u4e0d\u4e3a\u7a7a\u65f6\uff0c\u6b64\u7c7b\u53c2\u6570\u624d\u4f1a\u4f20\u9012\u7ed9\u670d\u52a1\u5668\uff1a</p> <pre><code>uwsgi_param HTTPS $https if_not_empty;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_pass","title":"uwsgi_pass","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_pass <code>[protocol://]address</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e uwsgi \u670d\u52a1\u5668\u7684\u534f\u8bae\u548c\u5730\u5740\u3002<code>protocol</code> \u53ef\u4ee5\u6307\u5b9a <code>uwsgi</code> \u6216 <code>suwsgi</code>\uff08\u5b89\u5168\u7684 uwsgi\uff0c\u57fa\u4e8e SSL \u7684 uwsgi\uff09\u3002\u5730\u5740\uff08<code>address</code>\uff09\u53ef\u4ee5\u6307\u5b9a\u4e3a\u57df\u540d\u6216 IP \u5730\u5740\u4ee5\u53ca\u7aef\u53e3\uff1a</p> <pre><code>uwsgi_pass localhost:9000;\nuwsgi_pass uwsgi://localhost:9000;\nuwsgi_pass suwsgi://[2001:db8::1]:9090;\n</code></pre> <p>\u6216\u4e3a UNIX \u57df\u5957\u63a5\u5b57\u8def\u5f84\uff1a</p> <pre><code>uwsgi_pass unix:/tmp/uwsgi.socket;\n</code></pre> <p>\u5982\u679c\u4e00\u4e2a\u57df\u540d\u89e3\u6790\u4e3a\u591a\u4e2a\u5730\u5740\uff0c\u5219\u6240\u6709\u8fd9\u4e9b\u5730\u5740\u90fd\u5c06\u4ee5\u8f6e\u8be2\u65b9\u5f0f\u4f7f\u7528\u3002\u53e6\u5916\uff0c\u53ef\u4ee5\u5c06\u5730\u5740\u6307\u5b9a\u4e3a\u4e00\u4e2a\u670d\u52a1\u5668\u7ec4\u3002</p> <p>\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5c06\u5730\u5740\u6307\u5b9a\u4e3a\u57df\u540d\uff0c\u5219\u5728\u63cf\u8ff0\u7684\u670d\u52a1\u5668\u7ec4\u4e2d\u641c\u7d22\u8be5\u540d\u79f0\uff0c\u5982\u679c\u627e\u4e0d\u5230\uff0c\u5219\u4f7f\u7528\u89e3\u6790\u5668\u786e\u5b9a\u8be5\u540d\u79f0\u3002</p> <p>\u4ece 1.5.8 \u7248\u672c\u5f00\u59cb\u652f\u6301\u5b89\u5168\u7684 uwsgi \u534f\u8bae\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_pass_header","title":"uwsgi_pass_header","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_pass_header <code>field</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5141\u8bb8\u5c06\u539f\u672c\u5df2\u7981\u7528\u7684\u5934\u5b57\u6bb5\u4ece uwsgi \u670d\u52a1\u5668\u4f20\u9012\u5230\u5ba2\u6237\u7aef\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_pass_request_body","title":"uwsgi_pass_request_body","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_pass_request_body <code>on</code> | <code>off</code>; \u9ed8\u8ba4 uwsgi_pass_request_body on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u793a\u662f\u5426\u5c06\u539f\u59cb\u8bf7\u6c42\u4f53\u4f20\u9012\u5230 uwsgi \u670d\u52a1\u5668\u3002\u53e6\u8bf7\u53c2\u89c1 uwsgi_pass_request_headers \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_pass_request_headers","title":"uwsgi_pass_request_headers","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_pass_request_headers <code>on</code> | <code>off</code>; \u9ed8\u8ba4 uwsgi_pass_request_headers on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u793a\u662f\u5426\u5c06\u539f\u59cb\u8bf7\u6c42\u7684\u5934\u5b57\u6bb5\u4f20\u9012\u5230 uwsgi \u670d\u52a1\u5668\u3002\u53e6\u8bf7\u53c2\u89c1 uwsgi_pass_request_body \u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_read_timeout","title":"uwsgi_read_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_read_timeout <code>time</code>; \u9ed8\u8ba4 uwsgi_read_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u4e3a\u4ece uwsgi \u670d\u52a1\u5668\u8bfb\u53d6\u54cd\u5e94\u5b9a\u4e49\u4e00\u4e2a\u8d85\u65f6\u65f6\u95f4\u3002\u8d85\u65f6\u65f6\u95f4\u4ec5\u5728\u4e24\u6b21\u8fde\u7eed\u7684\u8bfb\u53d6\u64cd\u4f5c\u4e4b\u95f4\u8ba1\u7b97\uff0c\u800c\u4e0d\u662f\u6574\u4e2a\u4f20\u8f93\u54cd\u5e94\u3002\u5982\u679c uwsgi \u670d\u52a1\u5668\u5728\u6b64\u65f6\u95f4\u5185\u672a\u4f20\u8f93\u4efb\u4f55\u5185\u5bb9\uff0c\u5219\u8fde\u63a5\u5df2\u5173\u95ed\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_request_buffering","title":"uwsgi_request_buffering","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_request_buffering <code>on</code> | <code>off</code>; \u9ed8\u8ba4 uwsgi_request_buffering on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.11 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u6216\u7981\u7528\u5ba2\u6237\u7aef\u8bf7\u6c42\u4f53\u7f13\u51b2\u3002</p> <p>\u542f\u7528\u7f13\u51b2\u540e\uff0c\u5728\u5c06\u8bf7\u6c42\u53d1\u9001\u5230 uwsgi \u670d\u52a1\u5668\u4e4b\u524d\uff0c\u5c06\u4ece\u5ba2\u6237\u7aef\u8bfb\u53d6\u6574\u4e2a\u8bf7\u6c42\u4f53\u3002</p> <p>\u7981\u7528\u7f13\u51b2\u540e\uff0c\u8bf7\u6c42\u4f53\u5c06\u5728\u6536\u5230\u8bf7\u6c42\u540e\u7acb\u5373\u53d1\u9001\u5230 uwsgi \u670d\u52a1\u5668\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u679c ngin \u5df2\u7ecf\u5f00\u59cb\u53d1\u9001\u8bf7\u6c42\u4f53\uff0c\u5219\u8be5\u8bf7\u6c42\u65e0\u6cd5\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u3002</p> <p>\u5f53\u4f7f\u7528 HTTP/1.1 \u5206\u5757\u4f20\u8f93\u7f16\u7801\u53d1\u9001\u539f\u59cb\u8bf7\u6c42\u6b63\u6587\u65f6\uff0c\u65e0\u8bba\u6307\u4ee4\u503c\u5982\u4f55\uff0c\u90fd\u5c06\u5bf9\u8bf7\u6c42\u6b63\u6587\u8fdb\u884c\u7f13\u51b2\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_send_timeout","title":"uwsgi_send_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_send_timeout <code>time</code>; \u9ed8\u8ba4 uwsgi_send_timeout 60s; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u5c06\u8bf7\u6c42\u4f20\u8f93\u5230 uwsgi \u670d\u52a1\u5668\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u8d85\u65f6\u65f6\u95f4\u4ec5\u5728\u4e24\u4e2a\u8fde\u7eed\u7684\u5199\u64cd\u4f5c\u4e4b\u95f4\u8ba1\u7b97\uff0c\u800c\u4e0d\u662f\u6574\u4e2a\u8bf7\u6c42\u7684\u4f20\u8f93\u3002\u5982\u679c uwsgi \u670d\u52a1\u5668\u5728\u6b64\u65f6\u95f4\u5185\u672a\u6536\u5230\u4efb\u4f55\u4fe1\u606f\uff0c\u5219\u8fde\u63a5\u5df2\u5173\u95ed\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_socket_keepalive","title":"uwsgi_socket_keepalive","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_socket_keepalive <code>on</code> | <code>off</code>; \u9ed8\u8ba4 uwsgi_socket_keepalive off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.15.6 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u4e3a\u4e0e uwsgi \u670d\u52a1\u5668\u7684\u4f20\u51fa\u8fde\u63a5\u914d\u7f6e TCP keepalive \u884c\u4e3a\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u8bbe\u7f6e\u5bf9\u5957\u63a5\u5b57\u6709\u6548\u3002\u5982\u679c\u6307\u4ee4\u8bbe\u7f6e\u4e3a <code>on</code> \u503c\uff0c\u5219\u5c06\u4e3a\u5957\u63a5\u5b57\u6253\u5f00 <code>SO_KEEPALIVE</code> \u5957\u63a5\u5b57\u9009\u9879\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_ssl_certificate","title":"uwsgi_ssl_certificate","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_ssl_certificate <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.8 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u4e00\u4e2aPEM \u683c\u5f0f\u7684\u8bc1\u4e66\u6587\u4ef6\uff0c\u7528\u4e8e\u5bf9\u53d7\u4fdd\u62a4\u7684 uwsgi \u670d\u52a1\u5668\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_ssl_certificate_key","title":"uwsgi_ssl_certificate_key","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_ssl_certificate_key <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.8 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u4e00\u4e2aPEM \u683c\u5f0f\u7684\u5bc6\u94a5\u6587\u4ef6\uff0c\u7528\u4e8e\u5bf9\u53d7\u4fdd\u62a4\u7684 uwsgi \u670d\u52a1\u5668\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u3002</p> <p>\u53ef\u4ee5\u6307\u5b9a\u503c <code>engine:name:id</code> \u6765\u4ee3\u66ff\u6587\u4ef6\uff08<code>file</code>\uff09\uff081.7.9\uff09\uff0c\u8be5\u6587\u4ef6\u4ece OpenSSL \u5f15\u64ce\u540d\u79f0\uff08<code>name</code>\uff09\u4e2d\u52a0\u8f7d\u6709\u6307\u5b9a ID \u7684\u5bc6\u94a5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_ssl_ciphers","title":"uwsgi_ssl_ciphers","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_ssl_ciphers <code>ciphers</code>; \u9ed8\u8ba4 uwsgi_ssl_ciphers DEFAULT; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.8 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u4e3a\u5bf9\u53d7\u4fdd\u62a4\u7684 uwsgi \u670d\u52a1\u5668\u7684\u8bf7\u6c42\u6307\u5b9a\u542f\u7528\u5bc6\u7801\u3002\u5bc6\u7801\u4ee5 OpenSSL \u5e93\u53ef\u4ee5\u7406\u89e3\u7684\u683c\u5f0f\u6307\u5b9a\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 <code>openssl ciphers</code> \u547d\u4ee4\u67e5\u770b\u5b8c\u6574\u5217\u8868\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_ssl_crl","title":"uwsgi_ssl_crl","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_ssl_crl <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.0 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u4e00\u4e2a PEM \u683c\u5f0f\u5e26\u6709\u540a\u9500\u8bc1\u4e66\uff08CRL\uff09\u7684\u6587\u4ef6\uff0c\u7528\u4e8e\u9a8c\u8bc1\u53d7\u4fdd\u62a4\u7684 uwsgi \u670d\u52a1\u5668\u7684\u8bc1\u4e66\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_ssl_name","title":"uwsgi_ssl_name","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_ssl_name <code>name</code>; \u9ed8\u8ba4 uwsgi_ssl_name host from uwsgi_pass; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.0 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5141\u8bb8\u8986\u76d6\u7528\u4e8e\u9a8c\u8bc1\u53d7\u4fdd\u62a4\u7684 uwsgi \u670d\u52a1\u5668\u7684\u8bc1\u4e66\u7684\u670d\u52a1\u5668\u540d\u79f0\uff0c\u5e76\u5728\u4e0e\u53d7\u4fdd\u62a4\u7684 uwsgi \u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u65f6\u901a\u8fc7 SNI \u4f20\u9012\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528 uwsgi_pass \u7684\u4e3b\u673a\u90e8\u5206\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_ssl_password_file","title":"uwsgi_ssl_password_file","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_ssl_password_file <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.8 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u4e00\u4e2a\u5e26\u6709\u5bc6\u94a5\u7684\u6587\u4ef6\uff0c\u6bcf\u4e2a\u53e3\u4ee4\u5728\u5355\u72ec\u7684\u884c\u4e0a\u6307\u5b9a\u3002\u52a0\u8f7d\u5bc6\u94a5\u65f6\u4f9d\u6b21\u5c1d\u8bd5\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_ssl_protocols","title":"uwsgi_ssl_protocols","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_ssl_protocols <code>[SSLv2] [SSLv3] [TLSv1] [TLSv1.1] [TLSv1.2] [TLSv1.3]</code>; \u9ed8\u8ba4 uwsgi_ssl_protocols TLSv1 TLSv1.1 TLSv1.2; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.8 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5f53\u8bf7\u6c42\u4e00\u4e2a\u53d7\u4fdd\u62a4\u7684 uwsgi \u670d\u52a1\u5668\u65f6\uff0c\u542f\u7528\u6307\u5b9a\u534f\u8bae\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_ssl_server_name","title":"uwsgi_ssl_server_name","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_ssl_server_name <code>on</code> | <code>off</code>; \u9ed8\u8ba4 uwsgi_ssl_server_name off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.0 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u4e0e\u53d7\u4fdd\u62a4\u7684 uwsgi \u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u542f\u7528\u6216\u7981\u7528\u901a\u8fc7 TLS \u670d\u52a1\u5668\u540d\u79f0\u6307\u793a\u6269\u5c55\uff08SNI\uff0cRFC 6066\uff09\u4f20\u9012\u670d\u52a1\u5668\u540d\u79f0\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_ssl_session_reuse","title":"uwsgi_ssl_session_reuse","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_ssl_session_reuse <code>on</code> | <code>off</code>; \u9ed8\u8ba4 uwsgi_ssl_session_reuse on; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.8 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u786e\u5b9a\u5728\u4f7f\u7528\u53d7\u4fdd\u62a4\u7684 uwsgi \u670d\u52a1\u5668\u65f6\u662f\u5426\u53ef\u4ee5\u91cd\u7528 SSL \u4f1a\u8bdd\u3002\u5982\u679c\u65e5\u5fd7\u4e2d\u51fa\u73b0\u9519\u8bef <code>SSL3_GET_FINISHED:digest check failed</code>\uff0c\u8bf7\u5c1d\u8bd5\u7981\u7528\u4f1a\u8bdd\u91cd\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_ssl_trusted_certificate","title":"uwsgi_ssl_trusted_certificate","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_ssl_trusted_certificate <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.0 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u4e00\u4e2a PEM \u683c\u5f0f\u7684\u53d7\u4fe1\u4efb CA \u8bc1\u4e66\u6587\u4ef6\uff08<code>file</code>\uff09\uff0c\u8be5\u8bc1\u4e66\u7528\u4e8e\u9a8c\u8bc1\u53d7\u4fdd\u62a4\u7684 uwsgi \u670d\u52a1\u5668\u7684\u8bc1\u4e66\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_ssl_verify","title":"uwsgi_ssl_verify","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_ssl_verify <code>on</code> | <code>off</code>; \u9ed8\u8ba4 uwsgi_ssl_verify off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.0 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u6216\u7981\u7528\u5bf9\u53d7\u4fdd\u62a4\u7684 uwsgi \u670d\u52a1\u5668\u8bc1\u4e66\u7684\u9a8c\u8bc1\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_ssl_verify_depth","title":"uwsgi_ssl_verify_depth","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_ssl_verify_depth <code>number</code>; \u9ed8\u8ba4 uwsgi_ssl_verify_depth 1; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.0 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5728\u53d7\u4fdd\u62a4\u7684 uwsgi \u670d\u52a1\u5668\u8bc1\u4e66\u94fe\u4e2d\u8bbe\u7f6e\u9a8c\u8bc1\u6df1\u5ea6\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_store","title":"uwsgi_store","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_store <code>on</code> | <code>off</code> | <code>string</code>; \u9ed8\u8ba4 uwsgi_store off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5141\u8bb8\u5c06\u6587\u4ef6\u4fdd\u5b58\u5230\u78c1\u76d8\u3002<code>on</code> \u53c2\u6570\u4fdd\u5b58\u6587\u4ef6\u7684\u8def\u5f84\u76f8\u5bf9\u4e8e alias \u6216 root \u6307\u4ee4\u3002<code>off</code> \u53c2\u6570\u7981\u7528\u6587\u4ef6\u4fdd\u5b58\u3002\u53e6\u5916\uff0c\u53ef\u4ee5\u4f7f\u7528\u5e26\u6709\u53d8\u91cf\u7684\u5b57\u7b26\u4e32\u6765\u663e\u5f0f\u8bbe\u7f6e\u6587\u4ef6\u540d\uff1a</p> <pre><code>uwsgi_store /data/www$original_uri;\n</code></pre> <p>\u6839\u636e\u6536\u5230\u7684 Last-Modified \u54cd\u5e94\u5934\u5b57\u6bb5\u8bbe\u7f6e\u6587\u4ef6\u7684\u4fee\u6539\u65f6\u95f4\u3002\u9996\u5148\u5c06\u54cd\u5e94\u5199\u5165\u4e34\u65f6\u6587\u4ef6\uff0c\u7136\u540e\u91cd\u547d\u540d\u8be5\u6587\u4ef6\u3002\u4ece 0.8.9 \u7248\u672c\u5f00\u59cb\uff0c\u53ef\u4ee5\u5c06\u4e34\u65f6\u6587\u4ef6\u548c\u6301\u4e45\u5b58\u50a8\u653e\u5728\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002\u4f46\u8bf7\u6ce8\u610f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6587\u4ef6\u9700\u8981\u8de8\u4e24\u4e2a\u6587\u4ef6\u7cfb\u7edf\u590d\u5236\uff0c\u800c\u4e0d\u662f\u7b80\u5355\u7684\u91cd\u547d\u540d\u64cd\u4f5c\u3002\u56e0\u6b64\uff0c\u5efa\u8bae\u5c06 uwsgi_temp_path \u6307\u4ee4\u8bbe\u7f6e\u7684\u6587\u4ef6\u4fdd\u5b58\u76ee\u5f55\u548c\u4e34\u65f6\u6587\u4ef6\u4fdd\u5b58\u76ee\u5f55\u653e\u5728\u540c\u4e00\u6587\u4ef6\u7cfb\u7edf\u4e0a\u3002</p> <p>\u8be5\u6307\u4ee4\u53ef\u7528\u4e8e\u521b\u5efa\u9759\u6001\u4e0d\u53ef\u66f4\u6539\u6587\u4ef6\u7684\u672c\u5730\u526f\u672c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>location /images/ {\nroot               /data/www;\nerror_page         404 = /fetch$uri;\n}\n\nlocation /fetch/ {\ninternal;\n\nuwsgi_pass         backend:9000;\n...\n\nuwsgi_store        on;\nuwsgi_store_access user:rw group:rw all:r;\nuwsgi_temp_path    /data/temp;\n\nalias              /data/www/;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_store_access","title":"uwsgi_store_access","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_store_access <code>users:permissions ...</code>; \u9ed8\u8ba4 uwsgi_store_access user:rw; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u65b0\u521b\u5efa\u7684\u6587\u4ef6\u548c\u76ee\u5f55\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u4f8b\u5982\uff1a</p> <pre><code>uwsgi_store_access user:rw group:rw all:r;\n</code></pre> <p>\u5982\u679c\u6307\u5b9a\u4e86\u4efb\u4f55 <code>group</code> \u6216 <code>all</code> \u8bbf\u95ee\u6743\u9650\uff0c\u5219\u53ef\u4ee5\u5ffd\u7565 <code>user</code> \u6743\u9650\uff1a</p> <pre><code>uwsgi_store_access group:rw all:r;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_temp_file_write_size","title":"uwsgi_temp_file_write_size","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_temp_file_write_size <code>size</code>; \u9ed8\u8ba4 uwsgi_temp_file_write_size 8k|16k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5f53\u542f\u7528\u4ece uwsgi \u670d\u52a1\u5668\u5230\u4e34\u65f6\u6587\u4ef6\u7684\u54cd\u5e94\u7f13\u51b2\u65f6\uff0c\u9650\u5236\u4e00\u6b21\u5199\u5165\u4e34\u65f6\u6587\u4ef6\u7684\u6570\u636e\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5927\u5c0f\u53d7 uwsgi_buffer_size \u548c uwsgi_buffers \u6307\u4ee4\u8bbe\u7f6e\u7684\u4e24\u4e2a\u7f13\u51b2\u533a\u7684\u9650\u5236\u3002\u4e34\u65f6\u6587\u4ef6\u7684\u6700\u5927\u5927\u5c0f\u7531 uwsgi_max_temp_file_size \u6307\u4ee4\u8bbe\u7f6e\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#uwsgi_temp_path","title":"uwsgi_temp_path","text":"- \u8bf4\u660e \u8bed\u6cd5 uwsgi_temp_path <code>path [level1 [level2 [level3]]]</code>; \u9ed8\u8ba4 uwsgi_temp_path uwsgi_temp; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49\u4e00\u4e2a\u76ee\u5f55\uff0c\u7528\u4e8e\u5b58\u50a8\u4ece uwsgi \u670d\u52a1\u5668\u63a5\u6536\u5230\u7684\u6570\u636e\u7684\u4e34\u65f6\u6587\u4ef6\u3002\u5728\u6307\u5b9a\u76ee\u5f55\u4e0b\u6700\u591a\u53ef\u4ee5\u4f7f\u7528\u4e09\u7ea7\u5b50\u76ee\u5f55\u5c42\u6b21\u7ed3\u6784\u3002\u4f8b\u5982\u4ee5\u4e0b\u914d\u7f6e\uff1a</p> <pre><code>uwsgi_temp_path /spool/nginx/uwsgi_temp 1 2;\n</code></pre> <p>\u4e34\u65f6\u6587\u4ef6\u53ef\u80fd\u5982\u4e0b\uff1a</p> <pre><code>/spool/nginx/uwsgi_temp/7/45/00000123457\n</code></pre> <p>\u53e6\u8bf7\u53c2\u89c1 uwsgi_cache_path \u6307\u4ee4\u7684 <code>use_temp_path</code> \u53c2\u6570\u3002</p>"},{"location":"Modules-reference/http/ngx_http_uwsgi_module/#_3","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/http/ngx_http_uwsgi_module.html</li> </ul>"},{"location":"Modules-reference/http/ngx_http_v2_module/","title":"ngx_http_v2_module","text":"<ul> <li>\u5df2\u77e5\u95ee\u9898</li> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>http2_body_preread_size</li> <li>http2_chunk_size</li> <li>http2_idle_timeout</li> <li>http2_max_concurrent_pushes</li> <li>http2_max_concurrent_streams</li> <li>http2_max_field_size</li> <li>http2_max_header_size</li> <li>http2_max_requests</li> <li>http2_push</li> <li>http2_push_preload</li> <li>http2_recv_buffer_size</li> <li>http2_recv_timeout</li> </ul> </li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_http_v2_module</code> \u6a21\u5757\uff081.9.5\uff09\u63d0\u4f9b\u5bf9 HTTP/2 \u7684\u652f\u6301\u5e76\u53d6\u4ee3\u4e86 ngx_http_spdy_module \u6a21\u5757\u3002</p> <p>\u9ed8\u8ba4\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\uff0c\u53ef\u4f7f\u7528 <code>--with-http_v2_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_v2_module/#_1","title":"\u5df2\u77e5\u95ee\u9898","text":"<p>\u5728 1.9.14 \u7248\u672c\u4e4b\u524d\uff0c\u65e0\u8bba proxy_request_buffering\u3001fastcgi_request_buffering\u3001uwsgi_request_buffering \u548c scgi_request_buffering \u6307\u4ee4\u503c\u5982\u4f55\u8bbe\u7f6e\uff0c\u90fd\u65e0\u6cd5\u7981\u7528\u5ba2\u6237\u7aef\u8bf7\u6c42\u4f53\u7f13\u51b2\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_v2_module/#_2","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>server {\nlisten 443 ssl http2;\n\nssl_certificate server.crt;\nssl_certificate_key server.key;\n}\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u901a\u8fc7 TLS \u63a5\u53d7 HTTP/2 \u8fde\u63a5\u9700\u8981\u300c\u5e94\u7528\u5c42\u534f\u8bae\u534f\u5546\u300d\uff08Application-Layer Protocol Negotiation\uff0cALPN\uff09TLS \u6269\u5c55\u652f\u6301\uff0c\u8be5\u652f\u6301\u4ec5\u5728 OpenSSL 1.0.2 \u7248\u672c\u4e4b\u540e\u53ef\u7528\u3002\u4f7f\u7528\u300c\u6b21\u534f\u8bae\u534f\u5546\u300d\uff08Next Protocol Negotiation\uff0cNPN\uff09TLS \u6269\u5c55\uff08\u81ea OpenSSL 1.0.1 \u7248\u672c\u8d77\u53ef\u7528\uff09\u4e0d\u80fd\u4fdd\u8bc1\u751f\u6548\u3002</p> <p>\u53e6\u5916\uff0c\u5982\u679c ssl_prefer_server_ciphers \u6307\u4ee4\u8bbe\u7f6e\u4e3a <code>on</code> \u503c\uff0c\u5219\u5e94\u5c06\u5bc6\u7801\u914d\u7f6e\u4e3a\u7b26\u5408 RFC 7540 \u4e2d\u7684\u9644\u5f55 A \u9ed1\u540d\u5355 \u5e76\u7531\u5ba2\u6237\u7aef\u652f\u6301\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_v2_module/#_3","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_v2_module/#http2_body_preread_size","title":"http2_body_preread_size","text":"- \u8bf4\u660e \u8bed\u6cd5 http2_body_preread_size <code>size</code>; \u9ed8\u8ba4 http2_body_preread_size 64k; \u4e0a\u4e0b\u6587 http\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.0 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u5728\u5f00\u59cb\u5904\u7406\u4e4b\u524d\u53ef\u80fd\u88ab\u4fdd\u5b58\u7684\u8bf7\u6c42\u4f53\u4e2d\u7684\u6bcf\u4e2a\u8bf7\u6c42\u7684\u7f13\u51b2\u533a\u5927\u5c0f\uff08<code>size</code>\uff09\u3002</p>"},{"location":"Modules-reference/http/ngx_http_v2_module/#http2_chunk_size","title":"http2_chunk_size","text":"- \u8bf4\u660e \u8bed\u6cd5 http2_chunk_size <code>size</code>; \u9ed8\u8ba4 http2_chunk_size 8k; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u8bbe\u7f6e\u54cd\u5e94\u4f53\u5207\u7247\u7684\u6700\u5927\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u503c\u592a\u4f4e\u4f1a\u5bfc\u81f4\u66f4\u9ad8\u7684\u5f00\u9500\u3002\u7531\u4e8e HOL \u963b\u585e\uff0c\u8fc7\u9ad8\u7684\u503c\u4f1a\u7834\u574f\u4f18\u5148\u7ea7\u3002</p>"},{"location":"Modules-reference/http/ngx_http_v2_module/#http2_idle_timeout","title":"http2_idle_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 http2_idle_timeout <code>time</code>; \u9ed8\u8ba4 http2_idle_timeout 3m; \u4e0a\u4e0b\u6587 http\u3001server <p>\u8bbe\u7f6e\u8fde\u63a5\u5173\u95ed\u540e\u7684\u4e0d\u6d3b\u52a8\u8d85\u65f6\u65f6\u95f4\u3002</p>"},{"location":"Modules-reference/http/ngx_http_v2_module/#http2_max_concurrent_pushes","title":"http2_max_concurrent_pushes","text":"- \u8bf4\u660e \u8bed\u6cd5 http2_max_concurrent_pushes <code>number</code>; \u9ed8\u8ba4 http2_max_concurrent_pushes 10; \u4e0a\u4e0b\u6587 http\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.13.9 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236\u4e00\u4e2a\u8fde\u63a5\u7684\u6700\u5927\u5e76\u53d1\u63a8\u9001\u8bf7\u6c42\u6570\u3002</p>"},{"location":"Modules-reference/http/ngx_http_v2_module/#http2_max_concurrent_streams","title":"http2_max_concurrent_streams","text":"- \u8bf4\u660e \u8bed\u6cd5 http2_max_concurrent_streams <code>number</code>; \u9ed8\u8ba4 http2_max_concurrent_streams 128; \u4e0a\u4e0b\u6587 http\u3001server <p>\u8bbe\u7f6e\u4e00\u4e2a\u8fde\u63a5\u7684\u6700\u5927\u5e76\u53d1 HTTP/2 \u6d41\u6570\u91cf\u3002</p>"},{"location":"Modules-reference/http/ngx_http_v2_module/#http2_max_field_size","title":"http2_max_field_size","text":"- \u8bf4\u660e \u8bed\u6cd5 http2_max_field_size <code>size</code>; \u9ed8\u8ba4 http2_max_field_size 4k; \u4e0a\u4e0b\u6587 http\u3001server <p>\u9650\u5236 HPACK \u538b\u7f29\u7684\u8bf7\u6c42\u5934\u5b57\u6bb5\u7684\u6700\u5927\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u8be5\u9650\u5236\u540c\u6837\u9002\u7528\u4e8e\u5b57\u6bb5\u540d\u548c\u503c\u3002\u8bf7\u6ce8\u610f\uff0c\u5982\u679c\u4f7f\u7528\u4e86\u970d\u592b\u66fc\u7f16\u7801\uff0c\u5219\u89e3\u538b\u7f29\u540e\u7684\u5b57\u6bb5\u540d\u548c\u503c\u5b57\u7b26\u4e32\u7684\u5b9e\u9645\u5927\u5c0f\u53ef\u80fd\u4f1a\u66f4\u5927\u3002\u5bf9\u4e8e\u5927\u591a\u6570\u8bf7\u6c42\uff0c\u9ed8\u8ba4\u9650\u5236\u5e94\u8be5\u8db3\u591f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_v2_module/#http2_max_header_size","title":"http2_max_header_size","text":"- \u8bf4\u660e \u8bed\u6cd5 http2_max_header_size <code>size</code>; \u9ed8\u8ba4 http2_max_header_size 16k; \u4e0a\u4e0b\u6587 http\u3001server <p>\u9650\u5236 HPACK \u89e3\u538b\u7f29\u540e\u6574\u4e2a\u8bf7\u6c42\u5934\u5217\u8868\u7684\u6700\u5927\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u5bf9\u4e8e\u5927\u591a\u6570\u8bf7\u6c42\uff0c\u9ed8\u8ba4\u9650\u5236\u5e94\u8be5\u8db3\u591f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_v2_module/#http2_max_requests","title":"http2_max_requests","text":"- \u8bf4\u660e \u8bed\u6cd5 http2_max_requests <code>number</code>; \u9ed8\u8ba4 http2_max_requests 1000; \u4e0a\u4e0b\u6587 http\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.6 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a HTTP/2 \u8fde\u63a5\u63d0\u4f9b\u670d\u52a1\u7684\u6700\u5927\u8bf7\u6c42\u6570\u91cf\uff08<code>number</code>\uff09\uff08\u5305\u62ec\u63a8\u9001\u8bf7\u6c42\uff09\uff0c\u4e4b\u540e\u4e0b\u4e00\u4e2a\u5ba2\u6237\u7aef\u8bf7\u6c42\u5c06\u5bfc\u81f4\u8fde\u63a5\u5173\u95ed\u4ee5\u53ca\u9700\u8981\u5efa\u7acb\u65b0\u8fde\u63a5\u3002</p> <p>\u8981\u91ca\u653e\u6bcf\u4e2a\u8fde\u63a5\u7684\u5185\u5b58\u5206\u914d\uff0c\u5fc5\u987b\u5b9a\u671f\u5173\u95ed\u8fde\u63a5\u3002\u56e0\u6b64\uff0c\u8bbe\u7f6e\u8fc7\u591a\u7684\u6700\u5927\u8bf7\u6c42\u6570\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5185\u5b58\u4f7f\u7528\u8fc7\u591a\uff0c\u56e0\u6b64\u4e0d\u5efa\u8bae\u8fd9\u6837\u505a\u3002</p>"},{"location":"Modules-reference/http/ngx_http_v2_module/#http2_push","title":"http2_push","text":"- \u8bf4\u660e \u8bed\u6cd5 http2_push <code>uri</code> | <code>off</code>; \u9ed8\u8ba4 http2_push off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.13.9 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u62a2\u5148\u5411\u6307\u5b9a\u7684 <code>uri</code> \u53d1\u9001\uff08\u63a8\u9001\uff09\u8bf7\u6c42\u4ee5\u53ca\u5bf9\u539f\u59cb\u8bf7\u6c42\u54cd\u5e94\u3002\u4ec5\u5904\u7406\u6709\u7edd\u5bf9\u8def\u5f84\u7684\u76f8\u5bf9 URI\uff0c\u4f8b\u5982\uff1a</p> <pre><code>http2_push /static/css/main.css;\n</code></pre> <p><code>uri</code> \u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002</p> <p>\u53ef\u4ee5\u5728\u540c\u4e00\u914d\u7f6e\u7ea7\u522b\u4e0a\u6307\u5b9a\u51e0\u4e2a <code>http2_push</code> \u6307\u4ee4\u3002<code>off</code> \u53c2\u6570\u53d6\u6d88\u4ece\u5176\u4ed6\u914d\u7f6e\u7ea7\u522b\u7ee7\u627f\u7684 <code>http2_push</code> \u6307\u4ee4\u7684\u4f5c\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_v2_module/#http2_push_preload","title":"http2_push_preload","text":"- \u8bf4\u660e \u8bed\u6cd5 http2_push_preload <code>on</code> | <code>off</code>; \u9ed8\u8ba4 http2_push_preload off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.13.9 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u5c06 Link \u54cd\u5e94\u5934\u5b57\u6bb5\u4e2d\u6307\u5b9a\u7684\u9884\u52a0\u8f7d\u94fe\u63a5\u81ea\u52a8\u8f6c\u6362\u4e3a\u63a8\u9001\u8bf7\u6c42\u7684\u529f\u80fd\u3002</p>"},{"location":"Modules-reference/http/ngx_http_v2_module/#http2_recv_buffer_size","title":"http2_recv_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 http2_recv_buffer_size <code>size</code>; \u9ed8\u8ba4 http2_recv_buffer_size 256k; \u4e0a\u4e0b\u6587 http <p>\u8bbe\u7f6e\u6bcf\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u8f93\u5165\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff08<code>size</code>\uff09\u3002</p>"},{"location":"Modules-reference/http/ngx_http_v2_module/#http2_recv_timeout","title":"http2_recv_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 http2_recv_timeout <code>time</code>; \u9ed8\u8ba4 http2_recv_timeout 30s; \u4e0a\u4e0b\u6587 http\u3001server <p>\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u4ee5\u4ece\u5ba2\u6237\u7aef\u83b7\u5f97\u66f4\u591a\u6570\u636e\uff0c\u7136\u540e\u5173\u95ed\u8fde\u63a5\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_v2_module/#_4","title":"\u5185\u5d4c\u53d8\u91cf","text":"<p><code>ngx_http_userid_module</code> \u6a21\u5757\u652f\u6301\u4ee5\u4e0b\u5185\u5d4c\u53d8\u91cf\uff1a</p> <ul> <li> <p><code>$http2</code></p> <p>\u534f\u5546\u7684\u534f\u8bae\u6807\u8bc6\u7b26\uff1a<code>h2</code> \u7528\u4e8e TLS HTTP/2\uff0c<code>h2c</code> \u7528\u4e8e\u5728\u660e\u6587 TCP HTTP/2\uff0c\u5426\u5219\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002</p> </li> </ul>"},{"location":"Modules-reference/http/ngx_http_v2_module/#_5","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/http/ngx_http_v2_module.html</li> </ul>"},{"location":"Modules-reference/http/ngx_http_xslt_module/","title":"ngx_http_xslt_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>xml_entities</li> <li>xslt_last_modified</li> <li>xslt_param</li> <li>xslt_string_param</li> <li>xslt_stylesheet</li> <li>xslt_types</li> </ul> </li> </ul> <p><code>ngx_http_xslt_module</code>\uff080.7.8+\uff09\u662f\u4e00\u4e2a\u8fc7\u6ee4\u5668\uff0c\u53ef\u4f7f\u7528\u4e00\u4e2a\u6216\u591a\u4e2a XSLT \u6837\u5f0f\u8868\u6765\u8f6c\u6362 XML \u54cd\u5e94\u3002</p> <p>\u9ed8\u8ba4\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\uff0c\u53ef\u5728\u6784\u5efa\u65f6\u4f7f\u7528 <code>--with-http_xslt_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p>\u8be5\u6a21\u5757\u96e8\u6765 libxml2 \u548c libxslt \u5e93\u3002</p> <p></p>"},{"location":"Modules-reference/http/ngx_http_xslt_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>location / {\nxml_entities    /site/dtd/entities.dtd;\nxslt_stylesheet /site/xslt/one.xslt param=value;\nxslt_stylesheet /site/xslt/two.xslt;\n}\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_xslt_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/http/ngx_http_xslt_module/#xml_entities","title":"xml_entities","text":"- \u8bf4\u660e \u8bed\u6cd5 xml_entities <code>path</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u6307\u5b9a\u58f0\u660e\u5b57\u7b26\u5b9e\u4f53\u7684 DTD \u6587\u4ef6\u3002\u8be5\u6587\u4ef6\u5728\u914d\u7f6e\u9636\u6bb5\u7f16\u8bd1\u3002\u51fa\u4e8e\u6280\u672f\u539f\u56e0\uff0c\u8be5\u6a21\u5757\u65e0\u6cd5\u5728\u5df2\u5904\u7406\u7684 XML \u4e2d\u4f7f\u7528\u5916\u90e8\u5b50\u96c6\u58f0\u660e\uff0c\u56e0\u6b64\u5c06\u5176\u5ffd\u7565\uff0c\u53ef\u4f7f\u7528\u4e13\u95e8\u5b9a\u4e49\u7684\u6587\u4ef6\u3002\u8be5\u6587\u4ef6\u4e0d\u5e94\u63cf\u8ff0 XML \u7ed3\u6784\u3002\u4ec5\u58f0\u660e\u6240\u9700\u7684\u5b57\u7b26\u5b9e\u4f53\u5c31\u8db3\u591f\u4e86\uff0c\u4f8b\u5982\uff1a</p> <pre><code>&lt;!ENTITY nbsp \"&amp;#xa0;\"&gt;\n</code></pre>"},{"location":"Modules-reference/http/ngx_http_xslt_module/#xslt_last_modified","title":"xslt_last_modified","text":"- \u8bf4\u660e \u8bed\u6cd5 xslt_last_modified <code>on</code> | <code>off</code>; \u9ed8\u8ba4 xslt_last_modified off; \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.1 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5141\u8bb8\u5728 XSLT \u8f6c\u6362\u671f\u95f4\u4fdd\u7559\u539f\u59cb\u54cd\u5e94\u4e2d\u7684 <code>Last-Modified</code> \u5934\u5b57\u6bb5\uff0c\u4ee5\u65b9\u4fbf\u54cd\u5e94\u7f13\u5b58\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728\u8f6c\u6362\u671f\u95f4\u4fee\u6539\u54cd\u5e94\u7684\u5185\u5bb9\u65f6\uff0c\u5c06\u5220\u9664\u5934\u5b57\u6bb5\uff0c\u5e76\u4e14\u8be5\u5934\u5b57\u6bb5\u53ef\u80fd\u5305\u542b\u52a8\u6001\u751f\u6210\u7684\u5143\u7d20\u6216\u7247\u6bb5\uff0c\u8fd9\u4e9b\u5143\u7d20\u6216\u7247\u6bb5\u72ec\u7acb\u4e8e\u539f\u59cb\u54cd\u5e94\u66f4\u6539\u3002</p>"},{"location":"Modules-reference/http/ngx_http_xslt_module/#xslt_param","title":"xslt_param","text":"- \u8bf4\u660e \u8bed\u6cd5 xslt_param <code>parameter value</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.18 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5b9a\u4e49 XSLT \u6837\u5f0f\u8868\u7684\u53c2\u6570\u3002\u8be5\u503c\uff08<code>value</code>\uff09\u4e3a XPath \u8868\u8fbe\u5f0f\u3002<code>value</code> \u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002\u8981\u5c06\u5b57\u7b26\u4e32\u503c\u4f20\u9012\u7ed9\u6837\u5f0f\u8868\uff0c\u53ef\u4f7f\u7528 xslt_string_param \u6307\u4ee4\u3002</p> <p>\u53ef\u4ee5\u6709\u591a\u4e2a <code>xslt_param</code> \u6307\u4ee4\u3002\u5f53\u4e14\u4ec5\u5f53\u5f53\u524d\u7ea7\u522b\u4e0a\u6ca1\u6709\u5b9a\u4e49 <code>xslt_param</code> \u548c xslt_string_param \u6307\u4ee4\u65f6\uff0c\u8fd9\u4e9b\u6307\u4ee4\u624d\u4ece\u4e0a\u4e00\u7ea7\u7ee7\u627f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_xslt_module/#xslt_string_param","title":"xslt_string_param","text":"- \u8bf4\u660e \u8bed\u6cd5 xslt_string_param <code>parameter value</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.18 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5b9a\u4e49 XSLT \u6837\u5f0f\u8868\u7684\u5b57\u7b26\u4e32\u53c2\u6570\u3002<code>value</code> \u4e2d\u7684 XPath \u8868\u8fbe\u5f0f\u4e0d\u4f1a\u88ab\u89e3\u91ca\u3002<code>value</code> \u53ef\u4ee5\u5305\u542b\u53d8\u91cf\u3002</p> <p>\u53ef\u4ee5\u6709\u591a\u4e2a <code>xslt_string_param</code> \u6307\u4ee4\u3002\u5f53\u4e14\u4ec5\u5f53\u5f53\u524d\u7ea7\u522b\u4e0a\u6ca1\u6709\u5b9a\u4e49 xslt_param \u548c <code>xslt_string_param</code> \u6307\u4ee4\u65f6\uff0c\u8fd9\u4e9b\u6307\u4ee4\u624d\u4ece\u4e0a\u4e00\u7ea7\u7ee7\u627f\u3002</p>"},{"location":"Modules-reference/http/ngx_http_xslt_module/#xslt_stylesheet","title":"xslt_stylesheet","text":"- \u8bf4\u660e \u8bed\u6cd5 xslt_stylesheet <code>stylesheet [parameter=value ...]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u5b9a\u4e49 XSLT \u6837\u5f0f\u8868\u53ca\u5176\u53ef\u9009\u53c2\u6570\u3002\u5728\u914d\u7f6e\u9636\u6bb5\u5c06\u7f16\u8bd1\u6837\u5f0f\u8868\u3002</p> <p>\u53ef\u4ee5\u5355\u72ec\u6307\u5b9a\u53c2\u6570\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>:</code> \u5b9a\u754c\u7b26\u5c06\u5176\u5206\u7ec4\u5728\u4e00\u884c\u4e2d\u3002\u5982\u679c\u53c2\u6570\u5305\u542b <code>:</code> \u5b57\u7b26\uff0c\u5219\u5e94\u5c06\u5176\u8f6c\u4e49\u4e3a <code>\uff053A</code>\u3002\u53e6\u5916\uff0c<code>libxslt</code> \u8981\u6c42\u5c06\u5305\u542b\u975e\u5b57\u6bcd\u6570\u5b57\u5b57\u7b26\u7684\u53c2\u6570\u62ec\u5728\u5355\u5f15\u53f7\u6216\u53cc\u5f15\u53f7\u4e2d\uff0c\u4f8b\u5982\uff1a</p> <pre><code>param1='http%3A//www.example.com':param2=value2\n</code></pre> <p>\u53c2\u6570\u63cf\u8ff0\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff0c\u4f8b\u5982\uff0c\u6574\u884c\u53c2\u6570\u53ef\u4ee5\u53d6\u81ea\u5355\u4e2a\u53d8\u91cf\uff1a</p> <pre><code>location / {\nxslt_stylesheet /site/xslt/one.xslt\n$arg_xslt_params\nparam1='$value1':param2=value2\nparam3=value3;\n}\n</code></pre> <p>\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\u6837\u5f0f\u8868\u3002\u5b83\u4eec\u5c06\u6309\u6307\u5b9a\u987a\u5e8f\u5e94\u7528\u3002</p>"},{"location":"Modules-reference/http/ngx_http_xslt_module/#xslt_types","title":"xslt_types","text":"- \u8bf4\u660e \u8bed\u6cd5 xslt_types <code>mime-type ...</code>; \u9ed8\u8ba4 xslt_types text/xml; \u4e0a\u4e0b\u6587 http\u3001server\u3001location <p>\u9664\u4e86 <code>text/xml</code> \u4e4b\u5916\uff0c\u8fd8\u542f\u7528\u6709\u6307\u5b9a MIME \u7c7b\u578b\u7684\u54cd\u5e94\u7684\u8f6c\u6362\u3002\u7279\u6b8a\u503c <code>*</code> \u4e0e\u4efb\u4f55 MIME \u7c7b\u578b\uff080.8.29\uff09\u5339\u914d\u3002\u5982\u679c\u8f6c\u6362\u7ed3\u679c\u662f HTML \u54cd\u5e94\uff0c\u5219\u5176 MIME \u7c7b\u578b\u5c06\u66f4\u6539\u4e3a <code>text/html</code>\u3002</p>"},{"location":"Modules-reference/http/ngx_http_xslt_module/#_3","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/http/ngx_http_xslt_module.html</li> </ul>"},{"location":"Modules-reference/mail/ngx_mail_auth_http_module/","title":"ngx_mail_auth_http_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>auth_http</li> <li>auth_http_header</li> <li>auth_http_pass_client_cert</li> <li>auth_http_timeout</li> </ul> </li> <li>\u534f\u8bae</li> </ul>"},{"location":"Modules-reference/mail/ngx_mail_auth_http_module/#_1","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/mail/ngx_mail_auth_http_module/#auth_http","title":"auth_http","text":"- \u8bf4\u660e \u8bed\u6cd5 auth_http <code>URL</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 mail\u3001server <p>\u8bbe\u7f6e HTTP \u8ba4\u8bc1\u670d\u52a1\u5668\u7684 URL\u3002\u534f\u8bae\u63cf\u8ff0\u5982\u4e0b\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_auth_http_module/#auth_http_header","title":"auth_http_header","text":"- \u8bf4\u660e \u8bed\u6cd5 auth_http_header <code>header value</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 mail\u3001server <p>\u5c06\u6307\u5b9a\u7684\u5934\u9644\u52a0\u5230\u53d1\u9001\u5230\u8eab\u4efd\u9a8c\u8bc1\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u3002\u8be5\u5934\u53ef\u4ee5\u7528\u4f5c\u5171\u4eab\u5bc6\u94a5\uff0c\u4ee5\u9a8c\u8bc1\u8bf7\u6c42\u6765\u81ea nginx\u3002\u4f8b\u5982\uff1a</p> <pre><code>auth_http_header X-Auth-Key \"secret_string\";\n</code></pre>"},{"location":"Modules-reference/mail/ngx_mail_auth_http_module/#auth_http_pass_client_cert","title":"auth_http_pass_client_cert","text":"- \u8bf4\u660e \u8bed\u6cd5 auth_http_pass_client_cert <code>on</code> | <code>off</code>; \u9ed8\u8ba4 auth_http_pass_client_cert off; \u4e0a\u4e0b\u6587 mail\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.11 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5c06 Auth-SSL-Cert \u5934\u548c PEM \u683c\u5f0f\uff08\u5df2\u7f16\u7801\uff09\u7684\u5ba2\u6237\u7aef\u8bc1\u4e66\u9644\u52a0\u5230\u53d1\u9001\u5230\u8eab\u4efd\u9a8c\u8bc1\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_auth_http_module/#auth_http_timeout","title":"auth_http_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 auth_http_timeout <code>time</code> \u9ed8\u8ba4 auth_http_timeout 60s; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u8bbe\u7f6e\u4e0e\u8ba4\u8bc1\u670d\u52a1\u5668\u901a\u4fe1\u7684\u8d85\u65f6\u65f6\u95f4\u3002</p> <p></p>"},{"location":"Modules-reference/mail/ngx_mail_auth_http_module/#_2","title":"\u534f\u8bae","text":"<p>HTTP \u534f\u8bae\u7528\u4e8e\u4e0e\u8eab\u4efd\u9a8c\u8bc1\u670d\u52a1\u5668\u8fdb\u884c\u901a\u4fe1\u3002\u54cd\u5e94\u6b63\u6587\u4e2d\u7684\u6570\u636e\u5c06\u88ab\u5ffd\u7565\uff0c\u4fe1\u606f\u4ec5\u5728\u5934\u4e2d\u4f20\u9012\u3002</p> <p>\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u793a\u4f8b\uff1a</p> <p>\u8bf7\u6c42\uff1a</p> <pre><code>GET /auth HTTP/1.0\nHost: localhost\nAuth-Method: plain # plain/apop/cram-md5/external\nAuth-User: user\nAuth-Pass: password\nAuth-Protocol: imap # imap/pop3/smtp\nAuth-Login-Attempt: 1\nClient-IP: 192.0.2.42\nClient-Host: client.example.org\n</code></pre> <p>\u597d\u7684\u54cd\u5e94\uff1a</p> <pre><code>HTTP/1.0 200 OK\nAuth-Status: OK\nAuth-Server: 198.51.100.1\nAuth-Port: 143\n</code></pre> <p>\u574f\u7684\u54cd\u5e94\uff1a</p> <pre><code>HTTP/1.0 200 OK\nAuth-Status: Invalid login or password\nAuth-Wait: 3\n</code></pre> <p>\u5982\u679c\u6ca1\u6709 Auth-Wait \u5934\uff0c\u5219\u5c06\u8fd4\u56de\u9519\u8bef\u5e76\u5173\u95ed\u8fde\u63a5\u3002\u5f53\u524d\u5b9e\u73b0\u4e3a\u6bcf\u6b21\u8eab\u4efd\u9a8c\u8bc1\u5c1d\u8bd5\u5206\u914d\u5185\u5b58\u3002\u4ec5\u5728\u4f1a\u8bdd\u7ed3\u675f\u65f6\u624d\u91ca\u653e\u5185\u5b58\u3002\u56e0\u6b64\uff0c\u5fc5\u987b\u9650\u5236\u5355\u4e2a\u4f1a\u8bdd\u4e2d\u65e0\u6548\u8eab\u4efd\u9a8c\u8bc1\u5c1d\u8bd5\u7684\u6b21\u6570 \u2014 \u670d\u52a1\u5668\u5fc5\u987b\u5728 10-20 \u6b21\u5c1d\u8bd5\u540e\u54cd\u5e94\u4e0d\u5e26 Auth-Wait \u5934\uff08\u5c1d\u8bd5\u6b21\u6570\u5728 Auth-Login-Attempt \u5934\u4e2d\u4f20\u9012\uff09\u3002</p> <p>\u4f7f\u7528 APOP \u6216 CRAM-MD5 \u65f6\uff0c\u8bf7\u6c42-\u54cd\u5e94\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>GET /auth HTTP/1.0\nHost: localhost\nAuth-Method: apop\nAuth-User: user\nAuth-Salt: &lt;238188073.1163692009@mail.example.com&gt;\nAuth-Pass: auth_response\nAuth-Protocol: imap\nAuth-Login-Attempt: 1\nClient-IP: 192.0.2.42\nClient-Host: client.example.org\n</code></pre> <p>\u597d\u7684\u54cd\u5e94\uff1a</p> <pre><code>HTTP/1.0 200 OK\nAuth-Status: OK\nAuth-Server: 198.51.100.1\nAuth-Port: 143\nAuth-Pass: plain-text-pass\n</code></pre> <p>\u5982\u679c\u54cd\u5e94\u4e2d\u5b58\u5728 Auth-User \u5934\uff0c\u5b83\u5c06\u8986\u76d6\u7528\u4e8e\u4e0e\u540e\u7aef\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u540d\u3002</p> <p>\u5bf9\u4e8e SMTP\uff0c\u54cd\u5e94\u8fd8\u8003\u8651\u4e86 Auth-Error-Code \u5934 \u2014 \u5982\u679c\u5b58\u5728\uff0c\u5219\u5728\u53d1\u751f\u9519\u8bef\u65f6\u7528\u4f5c\u54cd\u5e94\u4ee3\u7801\u3002\u5426\u5219\uff0c\u5c06 535 5.7.0 \u4ee3\u7801\u6dfb\u52a0\u5230 Auth-Status \u5934\u4e2d\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u4ece\u8eab\u4efd\u9a8c\u8bc1\u670d\u52a1\u5668\u6536\u5230\u4ee5\u4e0b\u54cd\u5e94\uff1a</p> <pre><code>HTTP/1.0 200 OK\nAuth-Status: Temporary server problem, try again later\nAuth-Error-Code: 451 4.3.0\nAuth-Wait: 3\n</code></pre> <p>\u5219 SMTP \u5ba2\u6237\u7aef\u5c06\u6536\u5230\u9519\u8bef</p> <pre><code>451 4.3.0 Temporary server problem, try again later\n</code></pre> <p>\u5982\u679c\u4ee3\u7406 SMTP \u4e0d\u9700\u8981\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5219\u8bf7\u6c42\u5c06\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>GET /auth HTTP/1.0\nHost: localhost\nAuth-Method: none\nAuth-User:\nAuth-Pass:\nAuth-Protocol: smtp\nAuth-Login-Attempt: 1\nClient-IP: 192.0.2.42\nClient-Host: client.example.org\nAuth-SMTP-Helo: client.example.org\nAuth-SMTP-From: MAIL FROM: &lt;&gt;\nAuth-SMTP-To: RCPT TO: &lt;postmaster@mail.example.com&gt;\n</code></pre> <p>\u5bf9\u4e8e SSL/TLS \u5ba2\u6237\u7aef\u8fde\u63a5\uff081.7.11\uff09\uff0c\u6dfb\u52a0\u4e86 Auth-SSL \u5934\uff0c\u5e76\u4e14 Auth-SSL-Verify \u5c06\u5305\u542b\u5ba2\u6237\u7aef\u8bc1\u4e66\u9a8c\u8bc1\u7684\u7ed3\u679c\uff08\u5982\u679c\u542f\u7528\uff09\uff1a<code>SUCCESS</code>\u3001<code>FAILED:reason</code> \u548c <code>NONE</code>\uff08\u5982\u679c\u4e0d\u5b58\u5728\u8bc1\u4e66\uff09\u3002</p> <p>\u5728 1.11.7 \u7248\u672c\u4e4b\u524d\uff0c<code>FAILED</code> \u7ed3\u679c\u4e0d\u5305\u542b\u539f\u56e0\u5b57\u7b26\u4e32\u3002</p> <p>\u5b58\u5728\u5ba2\u6237\u7aef\u8bc1\u4e66\u65f6\uff0c\u5176\u8be6\u7ec6\u4fe1\u606f\u5c06\u5728\u4ee5\u4e0b\u8bf7\u6c42\u5934\u4e2d\u4f20\u9012\uff1aAuth-SSL-Subject\u3001Auth-SSL-Issuer\u3001Auth-SSL-Serial \u548c Auth-SSL-Fingerprint\u3002\u5982\u679c\u542f\u7528\u4e86 auth_http_pass_client_cert\uff0c\u5219\u8bc1\u4e66\u672c\u8eab\u5c06\u5728 Auth-SSL-Cert \u5934\u4e2d\u4f20\u9012\u3002\u8be5\u8bf7\u6c42\u5c06\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>GET /auth HTTP/1.0\nHost: localhost\nAuth-Method: plain\nAuth-User: user\nAuth-Pass: password\nAuth-Protocol: imap\nAuth-Login-Attempt: 1\nClient-IP: 192.0.2.42\nAuth-SSL: on\nAuth-SSL-Verify: SUCCESS\nAuth-SSL-Subject: /CN=example.com\nAuth-SSL-Issuer: /CN=example.com\nAuth-SSL-Serial: C07AD56B846B5BFF\nAuth-SSL-Fingerprint: 29d6a80a123d13355ed16b4b04605e29cb55a5ad\n</code></pre>"},{"location":"Modules-reference/mail/ngx_mail_auth_http_module/#_3","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/mail/ngx_mail_auth_http_module.html</li> </ul>"},{"location":"Modules-reference/mail/ngx_mail_core_module/","title":"ngx_mail_core_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>listen</li> <li>mail</li> <li>protocol</li> <li>resolver</li> <li>resolver_timeout</li> <li>server</li> <li>server_name</li> <li>timeout</li> </ul> </li> </ul> <p>\u9ed8\u8ba4\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\uff0c\u53ef\u4f7f\u7528 <code>--with-mail</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p></p>"},{"location":"Modules-reference/mail/ngx_mail_core_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>worker_processes 1;\n\nerror_log /var/log/nginx/error.log info;\n\nevents {\nworker_connections  1024;\n}\n\nmail {\nserver_name       mail.example.com;\nauth_http         localhost:9000/cgi-bin/nginxauth.cgi;\n\nimap_capabilities IMAP4rev1 UIDPLUS IDLE LITERAL+ QUOTA;\n\npop3_auth         plain apop cram-md5;\npop3_capabilities LAST TOP USER PIPELINING UIDL;\n\nsmtp_auth         login plain cram-md5;\nsmtp_capabilities \"SIZE 10485760\" ENHANCEDSTATUSCODES 8BITMIME DSN;\nxclient           off;\n\nserver {\nlisten   25;\nprotocol smtp;\n}\nserver {\nlisten   110;\nprotocol pop3;\nproxy_pass_error_message on;\n}\nserver {\nlisten   143;\nprotocol imap;\n}\nserver {\nlisten   587;\nprotocol smtp;\n}\n}\n</code></pre>"},{"location":"Modules-reference/mail/ngx_mail_core_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/mail/ngx_mail_core_module/#listen","title":"listen","text":"- \u8bf4\u660e \u8bed\u6cd5 listen <code>address:port [ssl] [backlog=number] [rcvbuf=size] [sndbuf=size] [bind] [ipv6only=on\\|off] [so_keepalive=on\\|off\\|[keepidle]:[keepintvl]:[keepcnt]]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 server <p>\u4e3a\u5c06\u63a5\u53d7\u8bf7\u6c42\u7684\u670d\u52a1\u5668\u7684\u5957\u63a5\u5b57\u8bbe\u7f6e\u5730\u5740\uff08<code>address</code>\uff09\u548c\u7aef\u53e3\uff08<code>port</code>\uff09\u3002\u53ef\u4ee5\u4ec5\u6307\u5b9a\u7aef\u53e3\u3002\u5730\u5740\u4e5f\u53ef\u4ee5\u662f\u4e3b\u673a\u540d\uff0c\u4f8b\u5982\uff1a</p> <pre><code>listen 127.0.0.1:110;\nlisten *:110;\nlisten 110;     # same as *:110\nlisten localhost:110;\n</code></pre> <p>IPv6 \u5730\u5740\u5728\u65b9\u62ec\u53f7\u4e2d\u6307\u5b9a\uff080.7.58\uff09\uff1a</p> <pre><code>listen [::1]:110;\nlisten [::]:110;\n</code></pre> <p>UNIX \u57df\u5957\u63a5\u5b57\u4f7f\u7528 <code>unix:</code> \u524d\u7f00\u6307\u5b9a\uff081.3.5\uff09\uff1a</p> <pre><code>listen unix:/var/run/nginx.sock;\n</code></pre> <p>\u4e0d\u540c\u7684\u670d\u52a1\u5668\u5fc5\u987b\u4fa6\u542c\u4e0d\u540c\u7684 <code>address:port</code> \u5bf9\uff0c\u4e0d\u80fd\u91cd\u590d\u3002</p> <p><code>ssl</code> \u53c2\u6570\u6307\u5b9a\u8be5\u7aef\u53e3\u4e0a\u63a5\u53d7\u7684\u6240\u6709\u8fde\u63a5\u5747\u5e94\u4ee5 SSL \u6a21\u5f0f\u5de5\u4f5c\u3002</p> <p><code>listen</code> \u6307\u4ee4\u53ef\u4ee5\u6307\u5b9a\u51e0\u4e2a\u989d\u5916\u7684\u53c2\u6570\u7ed9\u5957\u63a5\u5b57\u76f8\u5173\u7684\u7cfb\u7edf\u8c03\u7528\u3002</p> <ul> <li> <p><code>backlog=number</code></p> <p>\u5728 <code>listen()</code> \u8c03\u7528\u4e2d\u8bbe\u7f6e <code>backlog</code> \u53c2\u6570\uff0c\u8be5\u53c2\u6570\u9650\u5236\u6302\u8d77\u7684\u8fde\u63a5\u961f\u5217\u7684\u6700\u5927\u957f\u5ea6\uff081.9.2\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5728 FreeBSD\u3001DragonFly BSD \u548c mac OS\u4e0a\uff0c<code>backlog</code> \u8bbe\u7f6e\u4e3a -1\uff0c\u800c\u5728\u5176\u4ed6\u5e73\u53f0\u4e0a\u5219\u8bbe\u7f6e\u4e3a 511\u3002</p> </li> <li> <p><code>rcvbuf=size</code></p> <p>\u8bbe\u7f6e\u4fa6\u542c\u5957\u63a5\u5b57\u7684\u63a5\u6536\u7f13\u51b2\u533a\u5927\u5c0f\uff08<code>SO_RCVBUF</code> \u9009\u9879\uff09\uff081.11.13\uff09\u3002</p> </li> <li> <p><code>sndbuf=size</code></p> <p>\u8bbe\u7f6e\u4fa6\u542c\u5957\u63a5\u5b57\u7684\u53d1\u9001\u7f13\u51b2\u533a\u5927\u5c0f\uff08<code>SO_SNDBUF</code> \u9009\u9879\uff09\uff081.11.13\uff09\u3002</p> </li> <li> <p><code>bind</code></p> <p>\u6b64\u53c2\u6570\u6307\u793a\u5bf9\u7ed9\u5b9a\u7684 <code>address:port</code> \u5bf9\u8fdb\u884c\u5355\u72ec\u7684 <code>bind()</code> \u8c03\u7528\u3002\u4e8b\u5b9e\u4e0a\uff0c\u5982\u679c\u6709\u591a\u4e2a\u6709\u76f8\u540c\u7aef\u53e3\u4f46\u5730\u5740\u4e0d\u540c\u7684 <code>listen</code> \u6307\u4ee4\uff0c\u5e76\u4e14\u5176\u4e2d\u4e00\u4e2a <code>listen</code> \u6307\u4ee4\u5728\u7ed9\u5b9a\u7aef\u53e3\uff08<code>*:port</code>\uff09\u7684\u6240\u6709\u5730\u5740\u4e0a\u76d1\u542c\uff0cnginx \u53ea\u4f1a\u5c06\u7ed1\u5b9a\uff08<code>bind()</code>\uff09\u5230 <code>*:port</code>\u3002\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c06\u8fdb\u884c <code>getsockname()</code> \u7cfb\u7edf\u8c03\u7528\uff0c\u4ee5\u786e\u5b9a\u63a5\u53d7\u8fde\u63a5\u7684\u5730\u5740\u3002\u5982\u679c\u4f7f\u7528 <code>ipv6only</code> \u6216 <code>so_keepalive</code> \u53c2\u6570\uff0c\u5219\u5bf9\u4e8e\u7ed9\u5b9a\u7684 <code>address:port</code> \u5bf9\uff0c\u5c06\u59cb\u7ec8\u8fdb\u884c\u5355\u72ec\u7684 <code>bind()</code> \u8c03\u7528\u3002</p> </li> <li> <p><code>ipv6only=on|off</code></p> <p>\u6b64\u53c2\u6570\u786e\u5b9a\uff08\u901a\u8fc7 <code>IPV6_V6ONLY</code> \u5957\u63a5\u5b57\u9009\u9879\uff09\u76d1\u542c\u901a\u914d\u7b26\u5730\u5740 <code>[::]</code> \u7684 IPv6 \u5957\u63a5\u5b57\u662f\u5426\u4ec5\u63a5\u53d7 IPv6 \u8fde\u63a5\uff0c\u8fd8\u662f\u63a5\u53d7 IPv6 \u548c IPv4 \u8fde\u63a5\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6b64\u53c2\u6570\u662f\u6253\u5f00\u7684\u3002\u542f\u52a8\u65f6\u53ea\u80fd\u8bbe\u7f6e\u4e00\u6b21\u3002</p> </li> <li> <p><code>so_keepalive=on|off|[keepidle]:[keepintvl]:[keepcnt]</code></p> <p>\u6b64\u53c2\u6570\u4e3a\u76d1\u542c\u5957\u63a5\u5b57\u914d\u7f6e\u300cTCP keepalive\u300d\u884c\u4e3a\u3002\u5982\u679c\u7701\u7565\u6b64\u53c2\u6570\uff0c\u5219\u5957\u63a5\u5b57\u7684\u64cd\u4f5c\u7cfb\u7edf\u8bbe\u7f6e\u5c06\u751f\u6548\u3002\u5982\u679c\u5c06\u5176\u8bbe\u7f6e\u4e3a\u503c <code>on</code>\uff0c\u5219\u4f1a\u4e3a\u5957\u63a5\u5b57\u6253\u5f00 <code>SO_KEEPALIVE</code> \u9009\u9879\u3002\u5982\u679c\u5c06\u5176\u8bbe\u7f6e\u4e3a\u503c <code>off</code>\uff0c\u5219\u5c06\u5173\u95ed\u5957\u63a5\u5b57 <code>SO_KEEPALIVE</code> \u9009\u9879\u3002\u67d0\u4e9b\u64cd\u4f5c\u7cfb\u7edf\u652f\u6301\u4f7f\u7528 <code>TCP_KEEPIDLE</code>\u3001<code>TCP_KEEPINTVL</code> \u548c <code>TCP_KEEPCNT</code> \u5957\u63a5\u5b57\u9009\u9879\u5728\u6bcf\u4e2a\u5957\u63a5\u5b57\u7684\u57fa\u7840\u4e0a\u8bbe\u7f6e TCP Keepalive \u53c2\u6570\u3002\u5728\u6b64\u7c7b\u7cfb\u7edf\uff08\u5f53\u524d\u4e3a Linux 2.4+\u3001NetBSD 5+ \u548c FreeBSD 9.0-STABLE\uff09\u4e0a\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>keepidle</code>\u3001<code>keepintvl</code> \u548c <code>keepcnt</code> \u53c2\u6570\u8fdb\u884c\u914d\u7f6e\u3002\u53ef\u4ee5\u7701\u7565\u4e00\u4e2a\u6216\u4e24\u4e2a\u53c2\u6570\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u76f8\u5e94\u5957\u63a5\u5b57\u9009\u9879\u7684\u7cfb\u7edf\u9ed8\u8ba4\u8bbe\u7f6e\u5c06\u751f\u6548\u3002\u4f8b\u5982\uff0c</p> <pre><code>so_keepalive=30m::10\n</code></pre> <p>\u4f1a\u5c06\u95f2\u7f6e\u8d85\u65f6\u65f6\u95f4\uff08<code>TCP_KEEPIDLE</code>\uff09\u8bbe\u7f6e\u4e3a 30 \u5206\u949f\uff0c\u5c06\u63a2\u6d4b\u95f4\u9694\uff08<code>TCP_KEEPINTVL</code>\uff09\u4fdd\u7559\u4e3a\u7cfb\u7edf\u9ed8\u8ba4\u503c\uff0c\u5e76\u5c06\u63a2\u6d4b\u8ba1\u6570\uff08<code>TCP_KEEPCNT</code>\uff09\u8bbe\u7f6e\u4e3a 10 \u4e2a\u63a2\u6d4b\u3002</p> </li> </ul>"},{"location":"Modules-reference/mail/ngx_mail_core_module/#mail","title":"mail","text":"- \u8bf4\u660e \u8bed\u6cd5 mail <code>{ ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 main <p>\u5728\u6307\u5b9a\u7684\u90ae\u4ef6\u670d\u52a1\u5668\u6307\u4ee4\u4e2d\u63d0\u4f9b\u914d\u7f6e\u6587\u4ef6\u4e0a\u4e0b\u6587\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_core_module/#protocol","title":"protocol","text":"- \u8bf4\u660e \u8bed\u6cd5 protocol <code>imap</code> | <code>pop3</code> | <code>smtp</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 server <p>\u8bbe\u7f6e\u4ee3\u7406\u670d\u52a1\u5668\u7684\u534f\u8bae\u3002\u652f\u6301\u7684\u534f\u8bae\u6709 IMAP\u3001POP3 \u548c SMTP\u3002</p> <p>\u5982\u679c\u672a\u8bbe\u7f6e\u8be5\u6307\u4ee4\uff0c\u5219\u53ef\u4ee5\u57fa\u4e8e listen \u6307\u4ee4\u4e2d\u6307\u5b9a\u7684\u4e3a\u4eba\u719f\u77e5\u7684\u9ed8\u8ba4\u7aef\u53e3\u6765\u81ea\u52a8\u68c0\u6d4b\u534f\u8bae\uff1a</p> <ul> <li><code>imap</code>\uff1a143\u3001993</li> <li><code>pop3</code>\uff1a110\u3001995</li> <li><code>smtp</code>\uff1a25\u3001587\u3001465</li> </ul> <p>\u53ef\u4ee5\u4f7f\u7528\u914d\u7f6e\u53c2\u6570 <code>--without-mail_imap_module</code>\u3001<code>--without-mail_pop3_module</code> \u548c <code>--without-mail_smtp_module</code> \u7981\u7528\u4e0d\u5fc5\u8981\u7684\u534f\u8bae\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_core_module/#resolver","title":"resolver","text":"- \u8bf4\u660e \u8bed\u6cd5 resolver <code>address ... [valid=time] [ipv6=on\\|off] [status_zone=zone]</code>;resolver <code>off</code> \u9ed8\u8ba4 resolver off; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u914d\u7f6e\u7528\u4e8e\u67e5\u627e\u5ba2\u6237\u7aef\u4e3b\u673a\u540d\u4ee5\u5c06\u5176\u4f20\u9012\u7ed9\u8eab\u4efd\u9a8c\u8bc1\u670d\u52a1\u5668\u7684\u540d\u79f0\u670d\u52a1\u5668\uff0c\u4ee5\u53ca\u4ee3\u7406 SMTP \u65f6\u7684 XCLIENT \u547d\u4ee4\u3002 \u4f8b\u5982\uff1a</p> <pre><code>resolver 127.0.0.1 [::1]:5353;\n</code></pre> <p>\u53ef\u4ee5\u4f7f\u7528\u53ef\u9009\u7aef\u53e3\uff081.3.1\u30011.2.2\uff09\u5c06\u5730\u5740\u6307\u5b9a\u4e3a\u57df\u540d\u6216 IP \u5730\u5740\u3002\u5982\u679c\u672a\u6307\u5b9a\u7aef\u53e3\uff0c\u5219\u4f7f\u7528\u7aef\u53e3 53\u3002\u4ee5\u8f6e\u8be2\u65b9\u5f0f\u67e5\u8be2\u540d\u79f0\u670d\u52a1\u5668\u3002</p> <p>\u5728 1.1.7 \u7248\u672c\u4e4b\u524d\uff0c\u53ea\u80fd\u914d\u7f6e\u4e00\u4e2a\u540d\u79f0\u670d\u52a1\u5668\u3002\u4ece 1.3.1 \u548c 1.2.2 \u7248\u672c\u5f00\u59cb\uff0c\u652f\u6301\u4f7f\u7528 IPv6 \u5730\u5740\u6307\u5b9a\u540d\u79f0\u670d\u52a1\u5668\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnginx \u5c06\u5728\u89e3\u6790\u65f6\u540c\u65f6\u67e5\u627e IPv4 \u548c IPv6 \u5730\u5740\u3002\u5982\u679c\u4e0d\u9700\u8981\u67e5\u627e IPv6 \u5730\u5740\uff0c\u5219\u53ef\u4ee5\u6307\u5b9a <code>ipv6=off</code> \u53c2\u6570\u3002</p> <p>\u4ece 1.5.8 \u7248\u672c\u5f00\u59cb\uff0c\u652f\u6301\u5c06\u540d\u79f0\u89e3\u6790\u4e3a IPv6 \u5730\u5740\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnginx \u4f7f\u7528\u54cd\u5e94\u7684 TTL \u503c\u7f13\u5b58\u5e94\u7b54\u3002\u53ef\u9009\u7684 <code>valid</code> \u53c2\u6570\u53ef\u8986\u76d6\u5b83\uff1a</p> <pre><code>resolver 127.0.0.1 [::1]:5353 valid=30s;\n</code></pre> <p>\u57281.1.9 \u7248\u672c\u4e4b\u524d\uff0c\u65e0\u6cd5\u8c03\u6574\u7f13\u5b58\u65f6\u95f4\uff0cnginx \u59cb\u7ec8\u5c06\u5e94\u7b54\u7f13\u5b58 5 \u5206\u949f\u3002</p> <p>\u4e3a\u9632\u6b62 DNS \u6b3a\u9a97\uff0c\u5efa\u8bae\u5728\u9002\u5f53\u5b89\u5168\u7684\u53d7\u4fe1\u4efb\u672c\u5730\u7f51\u7edc\u4e2d\u914d\u7f6e DNS \u670d\u52a1\u5668\u3002</p> <p>\u53ef\u9009\u7684 <code>status_zone</code> \u53c2\u6570\uff081.17.1\uff09\u542f\u7528\u5bf9\u6307\u5b9a\u533a\u57df\u4e2d\u7684\u8bf7\u6c42\u548c\u54cd\u5e94\u7684 DNS \u670d\u52a1\u5668\u7edf\u8ba1\u4fe1\u606f\u7684[\u6536\u96c6]\u529f\u80fd(../http/ngx_http_api_module.md#resolvers_)\u3002\u8be5\u53c2\u6570\u4e3a\u6211\u4eec\u7684\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u3002</p> <p>\u7279\u6b8a\u503c <code>off</code> \u7981\u7528\u89e3\u6790\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_core_module/#resolver_timeout","title":"resolver_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 resolver_timeout <code>time</code>; \u9ed8\u8ba4 resolver_timeout 30s; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u8bbe\u7f6e DNS \u64cd\u4f5c\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u4f8b\u5982\uff1a</p> <pre><code>resolver_timeout 5s;\n</code></pre>"},{"location":"Modules-reference/mail/ngx_mail_core_module/#server","title":"server","text":"- \u8bf4\u660e \u8bed\u6cd5 server <code>{ ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 mail <p>\u8bbe\u7f6e\u670d\u52a1\u5668\u7684\u914d\u7f6e\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_core_module/#server_name","title":"server_name","text":"- \u8bf4\u660e \u8bed\u6cd5 server_name <code>name</code>; \u9ed8\u8ba4 server_name hostname; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u8bbe\u7f6e\u670d\u52a1\u5668\u540d\u79f0\uff0c\u5728\u4ee5\u4e0b\u573a\u666f\u4e2d\u4f7f\u7528\u7684\uff1a</p> <ul> <li>\u6700\u5f00\u59cb\u7684 POP3/SMTP \u670d\u52a1\u5668\u95ee\u5019\u8bed\u4e2d</li> <li>SASL CRAM-MD5 \u8eab\u4efd\u9a8c\u8bc1\u4e2d\u7684\u76d0\u503c\u4e2d</li> <li>\u5982\u679c\u542f\u7528\u4e86 XCLIENT \u547d\u4ee4\u7684\u4f20\u9012\uff0c\u5219\u5728\u8fde\u63a5\u5230 SMTP \u540e\u7aef\u65f6\uff0c\u5728 <code>EHLO</code> \u547d\u4ee4\u4e2d</li> </ul> <p>\u5982\u679c\u672a\u6307\u5b9a\u6307\u4ee4\uff0c\u5219\u4f7f\u7528\u8ba1\u7b97\u673a\u7684\u4e3b\u673a\u540d\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_core_module/#timeout","title":"timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 timeout <code>time</code>; \u9ed8\u8ba4 timeout 60s; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\uff0c\u5728\u4ee3\u7406\u5230\u540e\u7aef\u5f00\u59cb\u4e4b\u524d\u4f7f\u7528\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_core_module/#_3","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/mail/ngx_mail_core_module.html</li> </ul>"},{"location":"Modules-reference/mail/ngx_mail_imap_module/","title":"ngx_mail_imap_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>imap_auth</li> <li>imap_capabilities</li> <li>imap_client_buffer</li> </ul> </li> </ul>"},{"location":"Modules-reference/mail/ngx_mail_imap_module/#_1","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/mail/ngx_mail_imap_module/#imap_auth","title":"imap_auth","text":"- \u8bf4\u660e \u8bed\u6cd5 imap_auth <code>method ...</code>; \u9ed8\u8ba4 imap_auth plain; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u4e3a IMAP \u5ba2\u6237\u7aef\u8bbe\u7f6e\u5141\u8bb8\u7684\u8ba4\u8bc1\u65b9\u6cd5\u3002\u652f\u6301\u7684\u65b9\u6cd5\u6709\uff1a</p> <ul> <li> <p><code>login</code></p> <p>AUTH=LOGIN - <code>plain</code></p> <p>AUTH=PLAIN - <code>cram-md5</code></p> <p>AUTH=CRAM-MD5\u3002\u4e3a\u4e86\u4f7f\u6b64\u65b9\u6cd5\u6b63\u5e38\u5de5\u4f5c\uff0c\u5bc6\u7801\u4e0d\u80fd\u52a0\u5bc6\u5b58\u50a8\u3002</p> </li> <li> <p><code>external</code></p> <p>AUTH EXTERNAL\uff081.11.6\uff09\u3002</p> </li> </ul>"},{"location":"Modules-reference/mail/ngx_mail_imap_module/#imap_capabilities","title":"imap_capabilities","text":"- \u8bf4\u660e \u8bed\u6cd5 imap_capabilities <code>extension ...</code>; \u9ed8\u8ba4 imap_capabilities IMAP4 IMAP4rev1 UIDPLUS; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u8bbe\u7f6e\u54cd\u5e94 <code>CAPABILITY</code> \u547d\u4ee4\u4f20\u9012\u7ed9\u5ba2\u6237\u7aef\u7684 IMAP \u534f\u8bae \u6269\u5c55\u5217\u8868\u3002\u6839\u636e starttls \u6307\u4ee4\u503c\uff0cimap_auth \u6307\u4ee4\u548c STARTTLS \u4e2d\u6307\u5b9a\u7684\u8ba4\u8bc1\u65b9\u6cd5\u5c06\u81ea\u52a8\u6dfb\u52a0\u5230\u6b64\u5217\u8868\u4e2d\u3002</p> <p>\u6307\u5b9a\u88ab\u4ee3\u7406\u5ba2\u6237\u7aef\u7684 IMAP \u540e\u7aef\u652f\u6301\u7684\u6269\u5c55\uff08\u5f53 nginx \u900f\u660e\u5730\u4ee3\u7406\u5230\u540e\u7aef\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\uff0c\u5982\u679c\u8fd9\u4e9b\u6269\u5c55\u4e0e\u8ba4\u8bc1\u540e\u4f7f\u7528\u7684\u547d\u4ee4\u76f8\u5173\uff09\uff0c\u5219\u662f\u6709\u610f\u4e49\u7684\u3002</p> <p>\u76ee\u524d\u7684\u6807\u51c6\u6269\u5c55\u540d\u5355\u5df2\u53d1\u5e03\u5728 www.iana.org\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_imap_module/#imap_client_buffer","title":"imap_client_buffer","text":"- \u8bf4\u660e \u8bed\u6cd5 imap_client_buffer <code>size</code>; \u9ed8\u8ba4 imap_client_buffer 4k|8k; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u8bbe\u7f6e IMAP \u547d\u4ee4\u8bfb\u53d6\u7f13\u51b2\u533a\u5927\u5c0f\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u51b2\u533a\u5927\u5c0f\u7b49\u4e8e\u4e00\u4e2a\u5185\u5b58\u9875\u9762\u30024K \u6216 8K\uff0c\u53d6\u51b3\u4e8e\u5e73\u53f0\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_imap_module/#_2","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/mail/ngx_mail_imap_module.html</p>"},{"location":"Modules-reference/mail/ngx_mail_pop3_module/","title":"ngx_mail_pop3_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>pop3_auth</li> <li>pop3_capabilities</li> </ul> </li> </ul>"},{"location":"Modules-reference/mail/ngx_mail_pop3_module/#_1","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/mail/ngx_mail_pop3_module/#pop3_auth","title":"pop3_auth","text":"- \u8bf4\u660e \u8bed\u6cd5 pop3_auth <code>method ...</code>; \u9ed8\u8ba4 pop3_auth plain; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u4e3a POP3 \u5ba2\u6237\u7aef\u8bbe\u7f6e\u5141\u8bb8\u7684\u8ba4\u8bc1\u65b9\u6cd5\u3002\u652f\u6301\u7684\u65b9\u6cd5\u6709\uff1a</p> <ul> <li> <p><code>plain</code></p> <p>USER/PASS\u3001AUTH PLAIN\u3001AUTH LOGIN\u3002\u4e0d\u53ef\u80fd\u7981\u7528\u8fd9\u4e9b\u65b9\u6cd5\u3002 - <code>apop</code></p> <p>APOP\u3002\u4e3a\u4e86\u4f7f\u6b64\u65b9\u6cd5\u6b63\u5e38\u5de5\u4f5c\uff0c\u5bc6\u7801\u4e0d\u80fd\u52a0\u5bc6\u5b58\u50a8\u3002 - <code>cram-md5</code></p> <p>AUTH CRAM-MD5\u3002\u4e3a\u4e86\u4f7f\u6b64\u65b9\u6cd5\u6b63\u5e38\u5de5\u4f5c\uff0c\u5bc6\u7801\u4e0d\u80fd\u52a0\u5bc6\u5b58\u50a8\u3002</p> </li> <li> <p><code>external</code></p> <p>AUTH EXTERNAL\uff081.11.6\uff09\u3002</p> </li> </ul>"},{"location":"Modules-reference/mail/ngx_mail_pop3_module/#pop3_capabilities","title":"pop3_capabilities","text":"- \u8bf4\u660e \u8bed\u6cd5 pop3_capabilities <code>extension ...</code>; \u9ed8\u8ba4 pop3_capabilities TOP USER UIDL; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u8bbe\u7f6e\u54cd\u5e94 <code>CAPA</code> \u547d\u4ee4\u4f20\u9001\u7ed9\u5ba2\u6237\u7aef\u7684 POP3 \u534f\u8bae \u6269\u5c55\u5217\u8868\u3002\u6839\u636e starttls \u6307\u4ee4\u503c\uff0cpop3_auth \u6307\u4ee4\uff08SASL \u6269\u5c55\uff09\u548c STLS \u4e2d\u6307\u5b9a\u7684\u8ba4\u8bc1\u65b9\u6cd5\u5c06\u81ea\u52a8\u6dfb\u52a0\u5230\u6b64\u5217\u8868\u3002</p> <p>\u6307\u5b9a\u5ba2\u6237\u7aef\u4ee3\u7406\u7684 POP3 \u540e\u7aef\u652f\u6301\u7684\u6269\u5c55\uff08\u5f53 nginx \u900f\u660e\u5730\u4ee3\u7406\u5230\u540e\u7aef\u7684\u5ba2\u6237\u7aef\u8fde\u63a5\uff0c\u5982\u679c\u8fd9\u4e9b\u6269\u5c55\u4e0e\u8ba4\u8bc1\u540e\u4f7f\u7528\u7684\u547d\u4ee4\u76f8\u5173\uff09\uff0c\u5219\u662f\u6709\u610f\u4e49\u7684\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_pop3_module/#_2","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/mail/ngx_mail_pop3_module.html</p>"},{"location":"Modules-reference/mail/ngx_mail_proxy_module/","title":"ngx_mail_proxy_module","text":"<ul> <li>\u6307\u4ee4<ul> <li>proxy_buffer</li> <li>proxy_pass_error_message</li> <li>proxy_timeout</li> <li>xclient</li> </ul> </li> </ul>"},{"location":"Modules-reference/mail/ngx_mail_proxy_module/#_1","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/mail/ngx_mail_proxy_module/#proxy_buffer","title":"proxy_buffer","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_buffer <code>size</code>; \u9ed8\u8ba4 proxy_buffer 4k|8k \u4e0a\u4e0b\u6587 mail\u3001server <p>\u8bbe\u7f6e\u7528\u4e8e\u4ee3\u7406\u7684\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u51b2\u533a\u5927\u5c0f\u7b49\u4e8e\u4e00\u4e2a\u5185\u5b58\u9875\u3002\u6839\u636e\u5e73\u53f0\u7684\u4e0d\u540c\uff0c\u5b83\u53ef\u4ee5\u662f 4K \u6216 8K\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_proxy_module/#proxy_pass_error_message","title":"proxy_pass_error_message","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_pass_error_message <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_pass_error_message off; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u6307\u793a\u662f\u5426\u5c06\u540e\u7aef\u8eab\u4efd\u9a8c\u8bc1\u671f\u95f4\u83b7\u5f97\u7684\u9519\u8bef\u6d88\u606f\u4f20\u9012\u7ed9\u5ba2\u6237\u7aef\u3002</p> <p>\u901a\u5e38\uff0c\u5982\u679c nginx \u4e2d\u7684\u8eab\u4efd\u9a8c\u8bc1\u6210\u529f\uff0c\u5219\u540e\u7aef\u65e0\u6cd5\u8fd4\u56de\u9519\u8bef\u3002\u5982\u679c\u4ecd\u7136\u8fd4\u56de\u9519\u8bef\uff0c\u5219\u8868\u793a\u53d1\u751f\u4e86\u4e00\u4e9b\u5185\u90e8\u9519\u8bef\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u540e\u7aef\u6d88\u606f\u53ef\u80fd\u5305\u542b\u4e0d\u5e94\u663e\u793a\u7ed9\u5ba2\u6237\u7aef\u7684\u4fe1\u606f\u3002\u4f46\u662f\uff0c\u5bf9\u4e8e\u67d0\u4e9b POP3 \u670d\u52a1\u5668\uff0c\u54cd\u5e94\u4e00\u4e2a\u5bc6\u7801\u9519\u8bef\u4fe1\u606f\u662f\u6b63\u5e38\u73b0\u8c61\u3002\u4f8b\u5982\uff0cCommuniGatePro \u901a\u8fc7\u5b9a\u671f\u8f93\u51fa\u8eab\u4efd\u9a8c\u8bc1\u9519\u8bef\u6765\u901a\u77e5\u7528\u6237\u90ae\u7bb1\u6ea2\u51fa\u6216\u5176\u4ed6\u4e8b\u4ef6\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5e94\u542f\u7528\u8be5\u6307\u4ee4\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_proxy_module/#proxy_timeout","title":"proxy_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_timeout <code>timeout</code>; \u9ed8\u8ba4 proxy_timeout 24h; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u8bbe\u7f6e\u5ba2\u6237\u7aef\u6216\u4ee3\u7406\u670d\u52a1\u5668\u8fde\u63a5\u4e0a\u4e24\u6b21\u8fde\u7eed\u7684\u8bfb\u53d6\u6216\u5199\u5165\u64cd\u4f5c\u4e4b\u95f4\u7684\u8d85\u65f6\uff08<code>timeout</code>\uff09\u3002\u5982\u679c\u5728\u6b64\u65f6\u95f4\u5185\u6ca1\u6709\u6570\u636e\u4f20\u8f93\uff0c\u5219\u8fde\u63a5\u5c06\u5173\u95ed\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_proxy_module/#xclient","title":"xclient","text":"- \u8bf4\u660e \u8bed\u6cd5 xclient <code>on</code> | <code>off</code>; \u9ed8\u8ba4 xclient on; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u8fde\u63a5\u5230 SMTP \u540e\u7aef\u65f6\uff0c\u542f\u7528\u6216\u7981\u7528 XCLIENT \u547d\u4ee4\u4e0e\u5ba2\u6237\u7aef\u53c2\u6570\u7684\u4f20\u9012\u3002</p> <p>\u501f\u52a9 <code>XCLIENT</code>\uff0cMTA \u80fd\u591f\u5c06\u5ba2\u6237\u7aef\u4fe1\u606f\u5199\u5165\u65e5\u5fd7\u5e76\u57fa\u4e8e\u6b64\u6570\u636e\u5e94\u7528\u5404\u79cd\u9650\u5236\u3002</p> <p>\u5982\u679c\u542f\u7528\u4e86 <code>XCLIENT</code>\uff0c\u5219 nginx \u5728\u8fde\u63a5\u5230\u540e\u7aef\u65f6\u4f1a\u4f20\u9012\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <ul> <li>\u9644\u5e26\u670d\u52a1\u5668\u540d\u79f0\u7684 EHLO</li> <li><code>XCLIENT</code></li> <li>\u7531\u5ba2\u6237\u4f20\u9012\u7684 <code>EHLO</code> \u6216 <code>HELO</code></li> </ul> <p>\u5982\u679c\u5ba2\u6237\u7aef IP \u5730\u5740\u627e\u5230\u7684\u540d\u79f0\u6307\u5411\u76f8\u540c\u7684\u5730\u5740\uff0c\u5219\u4f1a\u5728 <code>XCLIENT</code> \u547d\u4ee4\u7684 <code>NAME</code> \u53c2\u6570\u4e2d\u4f20\u9012\u8be5\u540d\u79f0\u3002\u5982\u679c\u627e\u4e0d\u5230\u540d\u79f0\u3001\u6307\u5411\u5176\u4ed6\u5730\u5740\u6216\u672a\u6307\u5b9a\u89e3\u6790\u5668\uff0c\u5219\u5728 <code>NAME</code> \u53c2\u6570\u4e2d\u4f20\u9012 <code>[UNAVAILABLE]</code>\u3002\u5982\u679c\u5728\u89e3\u6790\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\uff0c\u5219\u4f7f\u7528 <code>[TEMPUNAVAIL]</code> \u503c\u3002</p> <p>\u5982\u679c\u7981\u7528\u4e86 <code>XCLIENT</code>\uff0c\u5219\u5982\u679c\u5ba2\u6237\u7aef\u5df2\u901a\u8fc7 <code>EHLO</code>\uff0c\u5219 nginx \u5728\u8fde\u63a5\u5230\u540e\u7aef\u65f6\u5c06\u4f7f\u7528\u670d\u52a1\u5668\u540d\u79f0\u4f20\u9012 EHLO \u547d\u4ee4\uff1b\u5426\u5219\uff0c\u4f7f\u7528\u670d\u52a1\u5668\u540d\u79f0\u4f20\u9012 <code>HELO</code>\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_proxy_module/#_2","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/mail/ngx_mail_proxy_module.html</li> </ul>"},{"location":"Modules-reference/mail/ngx_mail_smtp_module/","title":"ngx_mail_smtp_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>ngx_mail_smtp_module</li> <li>smtp_capabilities</li> </ul> </li> </ul>"},{"location":"Modules-reference/mail/ngx_mail_smtp_module/#_1","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/mail/ngx_mail_smtp_module/#smtp_auth","title":"smtp_auth","text":"- \u8bf4\u660e \u8bed\u6cd5 smtp_auth <code>method ...</code>; \u9ed8\u8ba4 smtp_auth login plain; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u4e3a SMTP \u5ba2\u6237\u7aef\u8bbe\u7f6e SASL \u8ba4\u8bc1 \u7684\u5141\u8bb8\u65b9\u6cd5\u3002\u652f\u6301\u7684\u65b9\u6cd5\u6709\uff1a</p> <ul> <li> <p><code>login</code></p> <p>AUTH LOGIN - <code>plain</code></p> <p>AUTH PLAIN - <code>cram-md5</code></p> <p>AUTH CRAM-MD5\u3002\u4e3a\u4e86\u4f7f\u6b64\u65b9\u6cd5\u6b63\u5e38\u5de5\u4f5c\uff0c\u5bc6\u7801\u4e0d\u52a0\u5bc6\u5b58\u50a8\u3002 - <code>external</code></p> <p>AUTH EXTERNAL\uff081.11.6\uff09\u3002 - <code>none</code></p> <p>\u4e0d\u9700\u8981\u9a8c\u8bc1</p> </li> </ul>"},{"location":"Modules-reference/mail/ngx_mail_smtp_module/#smtp_capabilities","title":"smtp_capabilities","text":"- \u8bf4\u660e \u8bed\u6cd5 smtp_capabilities <code>extension ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 mail\u3001server <p>\u8bbe\u7f6e\u4f20\u9001\u7ed9\u5ba2\u6237\u7aef\u54cd\u5e94 <code>EHLO</code> \u547d\u4ee4\u7684 SMTP \u534f\u8bae\u6269\u5c55\u5217\u8868\u3002\u6839\u636e starttls \u6307\u4ee4\u503c\uff0csmtp_auth \u6307\u4ee4\u548c STARTTLS \u4e2d\u6307\u5b9a\u7684\u8ba4\u8bc1\u65b9\u6cd5\u5c06\u81ea\u52a8\u6dfb\u52a0\u5230\u6b64\u5217\u8868\u4e2d\u3002</p> <p>\u6307\u5b9a\u88ab\u4ee3\u7406\u5ba2\u6237\u7aef\u7684 MTA \u652f\u6301\u6269\u5c55\u662f\u6709\u610f\u4e49\u7684\uff08\u5f53 nginx \u900f\u660e\u5730\u5c06\u5ba2\u6237\u7aef\u8fde\u63a5\u4ee3\u7406\u5230\u540e\u7aef\uff0c\u5982\u679c\u8fd9\u4e9b\u6269\u5c55\u4e0e\u8ba4\u8bc1\u540e\u4f7f\u7528\u7684\u547d\u4ee4\u76f8\u5173\uff09\u3002</p> <p>\u76ee\u524d\u7684\u6807\u51c6\u6269\u5c55\u540d\u5355\u5df2\u53d1\u5e03\u5728 www.iana.org\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_smtp_module/#_2","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/mail/ngx_mail_smtp_module.html</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/","title":"ngx_mail_ssl_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>ssl</li> <li>ssl_certificate</li> <li>ssl_certificate_key</li> <li>ssl_ciphers</li> <li>ssl_client_certificate</li> <li>ssl_crl</li> <li>ssl_dhparam</li> <li>ssl_ecdh_curve</li> <li>ssl_password_file</li> <li>ssl_prefer_server_ciphers</li> <li>ssl_protocols</li> <li>ssl_session_cache</li> <li>ssl_session_ticket_key</li> <li>ssl_session_tickets</li> <li>ssl_session_timeout</li> <li>ssl_trusted_certificate</li> <li>ssl_verify_client</li> <li>ssl_verify_depth</li> <li>starttls</li> </ul> </li> </ul> <p><code>ngx_mail_ssl_module</code> \u6a21\u5757\u53ef\u8ba9\u90ae\u4ef6\u4ee3\u7406\u670d\u52a1\u5668\u652f\u6301 SSL/TLS \u534f\u8bae\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\uff0c\u53ef\u5728\u6784\u5efa\u65f6\u4f7f\u7528 <code>--with-mail_ssl_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u5b83\u3002</p> <p>\u8be5\u6a21\u5757\u4f9d\u8d56 OpenSSL \u5e93\u3002</p> <p></p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<p>\u4e3a\u4e86\u51cf\u8f7b\u5904\u7406\u5668\u8d1f\u8f7d\uff0c\u5efa\u8bae\uff1a</p> <ul> <li>\u5c06 worker \u8fdb\u7a0b\u6570\u8bbe\u7f6e\u4e3a\u4e0e\u5904\u7406\u5668\u6570\u91cf\u76f8\u7b49</li> <li>\u542f\u7528\u5171\u4eab\u4f1a\u8bdd\u7f13\u5b58</li> <li>\u7981\u7528\u5185\u7f6e\u7684\u4f1a\u8bdd\u7f13\u5b58</li> <li>\u53ef\u4ee5\u5ef6\u957f\u4f1a\u8bdd\u7684\u751f\u547d\u5468\u671f\uff08\u9ed8\u8ba4\u4e3a 5 \u5206\u949f\uff09</li> </ul> <pre><code>worker_processes auto;\n\nmail {\n\n...\n\nserver {\nlisten              993 ssl;\n\nssl_protocols       TLSv1 TLSv1.1 TLSv1.2;\nssl_ciphers         AES128-SHA:AES256-SHA:RC4-SHA:DES-CBC3-SHA:RC4-MD5;\nssl_certificate     /usr/local/nginx/conf/cert.pem;\nssl_certificate_key /usr/local/nginx/conf/cert.key;\nssl_session_cache   shared:SSL:10m;\nssl_session_timeout 10m;\n\n...\n}\n</code></pre> <p></p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl","title":"ssl","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl <code>on</code> | <code>off</code>; \u9ed8\u8ba4 ssl off; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u8be5\u6307\u4ee4\u5728 1.15.0 \u7248\u672c\u4e2d\u5df2\u5e9f\u5f03\uff0c\u8bf7\u6539\u7528 listen \u6307\u4ee4\u7684 <code>ssl</code> \u53c2\u6570\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_certificate","title":"ssl_certificate","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_certificate <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 mail\u3001server <p>\u4e3a\u7ed9\u5b9a\u670d\u52a1\u5668\u6307\u5b9a\u4e00\u4e2a PEM \u683c\u5f0f\u7684\u8bc1\u4e66\u6587\u4ef6\uff08<code>file</code>\uff09\u3002\u5982\u679c\u9664\u4e3b\u8bc1\u4e66\u4e4b\u5916\u8fd8\u8981\u6307\u5b9a\u4e2d\u95f4\u8bc1\u4e66\uff0c\u5219\u5e94\u5728\u540c\u4e00\u6587\u4ef6\u4e2d\u6309\u4ee5\u4e0b\u987a\u5e8f\u6307\u5b9a\u5b83\u4eec\uff1a\u9996\u5148\u662f\u4e3b\u8bc1\u4e66\uff0c\u7136\u540e\u662f\u4e2d\u95f4\u8bc1\u4e66\u3002PEM \u683c\u5f0f\u7684\u5bc6\u94a5\u53ef\u4ee5\u653e\u5728\u540c\u4e00\u6587\u4ef6\u4e2d\u3002</p> <p>\u4ece 1.11.0 \u7248\u5f00\u59cb\uff0c\u53ef\u4ee5\u591a\u6b21\u58f0\u660e\u8be5\u6307\u4ee4\u6765\u52a0\u8f7d\u4e0d\u540c\u7c7b\u578b\u7684\u8bc1\u4e66\uff0c\u4f8b\u5982 RSA \u548c ECDSA\uff1a</p> <pre><code>server {\nlisten              993 ssl;\n\nssl_certificate     example.com.rsa.crt;\nssl_certificate_key example.com.rsa.key;\n\nssl_certificate     example.com.ecdsa.crt;\nssl_certificate_key example.com.ecdsa.key;\n\n...\n}\n</code></pre> <p>\u4ec5 OpenSSL 1.0.2 \u6216\u66f4\u9ad8\u7248\u672c\u652f\u6301\u4e0d\u540c\u8bc1\u4e66\u7684\u72ec\u7acb\u8bc1\u4e66\u94fe\u3002\u5bf9\u4e8e\u8f83\u65e7\u7684\u7248\u672c\uff0c\u53ea\u80fd\u4f7f\u7528\u4e00\u4e2a\u8bc1\u4e66\u94fe\u3002</p> <p>\u53ef\u4ee5\u6307\u5b9a <code>data:certificate</code> \u503c\u6765\u4ee3\u66ff <code>file</code>\uff081.15.10\uff09\uff0c\u65e0\u9700\u4f7f\u7528\u6587\u4ef6\u5373\u53ef\u52a0\u8f7d\u8bc1\u4e66\u3002\u8bf7\u6ce8\u610f\uff0c\u9519\u8bef\u4f7f\u7528\u6b64\u8bed\u6cd5\u53ef\u80fd\u4f1a\u5e26\u6765\u5b89\u5168\u9690\u60a3\uff0c\u4f8b\u5982\u5c06\u5bc6\u94a5\u6570\u636e\u5199\u5165\u9519\u8bef\u65e5\u5fd7\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_certificate_key","title":"ssl_certificate_key","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_certificate_key <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 mail\u3001server <p>\u7ed9\u670d\u52a1\u5668\u6307\u5b9a\u4e00\u4e2a PEM \u683c\u5f0f\u7684\u5bc6\u94a5\u6587\u4ef6\uff08<code>file</code>\uff09\u3002</p> <p>\u53ef\u4ee5\u6307\u5b9a <code>engine:name:id</code> \u6765\u4ee3\u66ff <code>file</code>\uff081.7.9\uff09\uff0cNginx \u5c06\u4ece\u540d\u79f0\u4e3a <code>name</code>\u00a0\u7684 OpenSSL \u5f15\u64ce\u4e2d\u4e2d\u52a0\u8f7d id \u4e3a <code>id</code> \u7684\u5bc6\u94a5\u3002</p> <p>\u53ef\u4ee5\u6307\u5b9a <code>data:key</code> \u503c\u6765\u4ee3\u66ff <code>file</code>\uff081.15.10\uff09\uff0c\u65e0\u9700\u4f7f\u7528\u6587\u4ef6\u5c31\u53ef\u4ee5\u52a0\u8f7d\u5bc6\u94a5\u3002\u8bf7\u6ce8\u610f\uff0c\u9519\u8bef\u4f7f\u7528\u6b64\u8bed\u6cd5\u53ef\u80fd\u4f1a\u5e26\u6765\u5b89\u5168\u9690\u60a3\uff0c\u4f8b\u5982\u5c06\u5bc6\u94a5\u6570\u636e\u5199\u5165\u9519\u8bef\u65e5\u5fd7\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_ciphers","title":"ssl_ciphers","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_ciphers <code>ciphers</code> \u9ed8\u8ba4 ssl_ciphers HIGH:!aNULL:!MD5; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u6307\u5b9a\u542f\u7528\u7684\u52a0\u5bc6\u7b97\u6cd5\u3002\u4ec5\u53ef\u6307\u5b9a OpenSSL \u5e93\u652f\u6301\u7684\u7b97\u6cd5\uff0c\u4f8b\u5982\uff1a</p> <pre><code>ssl_ciphers ALL:!aNULL:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;\n</code></pre> <p>\u53ef\u4ee5\u4f7f\u7528 <code>openssl ciphers</code> \u547d\u4ee4\u67e5\u770b\u5b8c\u6574\u5217\u8868\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u65e9\u671f\u7248\u672c\u7684 nginx \u4f7f\u7528\u4e86\u4e0d\u540c\u7684\u52a0\u5bc6\u7b97\u6cd5\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_client_certificate","title":"ssl_client_certificate","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_client_certificate <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 mail\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.11 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u4e00\u4e2a PEM \u683c\u5f0f\u7684\u53d7\u4fe1\u4efb CA \u8bc1\u4e66\u6587\u4ef6\uff0c\u7528\u4e8e\u9a8c\u8bc1\u5ba2\u6237\u7aef\u8bc1\u4e66\u3002</p> <p>\u8bc1\u4e66\u5217\u8868\u5c06\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002\u5982\u679c\u4e0d\u5e0c\u671b\u8fd9\u6837\u505a\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 ssl_trusted_certificate  \u6307\u4ee4\u914d\u7f6e\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_crl","title":"ssl_crl","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_crl <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 mail\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.11 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u4e00\u4e2a PEM \u683c\u5f0f\u7684\u540a\u9500\u8bc1\u4e66\uff08CRL\uff09\u6587\u4ef6\uff0c\u7528\u4e8e\u9a8c\u8bc1\u5ba2\u6237\u7aef\u8bc1\u4e66\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_dhparam","title":"ssl_dhparam","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_dhparam <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 mail\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 0.7.2 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u4e00\u4e2a\u5e26\u6709 DHE \u5bc6\u7801\u7684 DH \u53c2\u6570\u7684\u6587\u4ef6\uff08<code>file</code>\uff09\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e0d\u8bbe\u7f6e\u4efb\u4f55\u53c2\u6570\uff0c\u56e0\u6b64\u4e0d\u4f7f\u7528 DHE \u5bc6\u7801\u3002</p> <p>\u5728 1.11.0 \u7248\u4e4b\u524d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f7f\u7528\u5185\u7f6e\u53c2\u6570\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_ecdh_curve","title":"ssl_ecdh_curve","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_ecdh_curve <code>curve</code>; \u9ed8\u8ba4 ssl_ecdh_curve auto; \u4e0a\u4e0b\u6587 mail\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.1.0 \u548c 1.0.6 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u4e3a ECDHE \u7b97\u6cd5\u6307\u5b9a\u4e00\u4e2a\u692d\u5706\u66f2\u7ebf\u65b9\u6848\uff08<code>curve</code>\uff09\u3002</p> <p>\u4f7f\u7528 OpenSSL 1.0.2 \u6216\u66f4\u9ad8\u7248\u672c\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u591a\u4e2a\u66f2\u7ebf\uff081.11.0\uff09\uff0c\u4f8b\u5982\uff1a</p> <pre><code>ssl_ecdh_curve prime256v1:secp384r1;\n</code></pre> <p>\u5f53\u4f7f\u7528 OpenSSL 1.0.2 \u6216\u66f4\u9ad8\u7248\u672c\u6216\u5e26\u6709\u8f83\u65e7\u7248\u672c\u7684 <code>prime256v1</code> \u65f6\uff0c\u7279\u6b8a\u503c <code>auto</code>\uff081.11.0\uff09\u6307\u793a nginx \u4f7f\u7528\u5185\u7f6e\u5728 OpenSSL \u5e93\u4e2d\u7684\u5217\u8868\u3002</p> <p>\u5728 1.11.0 \u7248\u4e4b\u524d\uff0c\u9ed8\u8ba4\u4f7f\u7528 <code>prime256v1</code> \u66f2\u7ebf\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_password_file","title":"ssl_password_file","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_password_file <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 mail\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.3 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u4e00\u4e2a\u4fdd\u5b58\u6709\u5bc6\u94a5\u5bc6\u7801\u7684\u6587\u4ef6\uff0c\u6bcf\u4e2a\u5bc6\u7801\u72ec\u5360\u4e00\u884c\u3002 \u52a0\u8f7d\u5bc6\u94a5\u65f6\u4f9d\u6b21\u5c1d\u8bd5\u4f7f\u7528\u8fd9\u4e9b\u5bc6\u7801\u3002</p> <p>\u4f8b\uff1a</p> <pre><code>mail {\nssl_password_file /etc/keys/global.pass;\n...\n\nserver {\nserver_name mail1.example.com;\nssl_certificate_key /etc/keys/first.key;\n}\n\nserver {\nserver_name mail2.example.com;\n\n# named pipe can also be used instead of a file\nssl_password_file /etc/keys/fifo;\nssl_certificate_key /etc/keys/second.key;\n}\n}\n</code></pre>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_prefer_server_ciphers","title":"ssl_prefer_server_ciphers","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_prefer_server_ciphers <code>on</code> | <code>off</code>; \u9ed8\u8ba4 ssl_prefer_server_ciphers off; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u6307\u5b9a\u5f53\u4f7f\u7528 SSLv3 \u548c TLS \u534f\u8bae\u65f6\uff0c\u670d\u52a1\u5668\u52a0\u5bc6\u7b97\u6cd5\u5e94\u4f18\u5148\u4e8e\u5ba2\u6237\u7aef\u52a0\u5bc6\u7b97\u6cd5\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_protocols","title":"ssl_protocols","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl <code>[SSLv2] [SSLv3] [TLSv1] [TLSv1.1] [TLSv1.2] [TLSv1.3]</code>; \u9ed8\u8ba4 sssl_protocols TLSv1 TLSv1.1 TLSv1.2; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u542f\u7528\u6307\u5b9a\u7684\u534f\u8bae\u3002</p> <p><code>TLSv1.1</code> \u548c <code>TLSv1.2</code> \u53c2\u6570\uff081.1.13\u30011.0.12\uff09\u4ec5\u5728\u4f7f\u7528 OpenSSL 1.0.1 \u6216\u66f4\u9ad8\u7248\u672c\u65f6\u6709\u6548\u3002</p> <p><code>TLSv1.3</code> \u53c2\u6570\uff081.13.0\uff09\u4ec5\u5728 OpenSSL 1.1.1 \u6784\u5efa\u65f6\u4f7f\u7528\u4e86 TLSv1.3 \u652f\u6301\u6709\u6548\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_session_cache","title":"ssl_session_cache","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_session_cache <code>on</code> | <code>none</code> | <code>[builtin[:size]] [shared:name:size]</code>; \u9ed8\u8ba4 ssl_session_cache none; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u8bbe\u7f6e\u5b58\u50a8\u4f1a\u8bdd\u53c2\u6570\u7684\u7f13\u5b58\u7684\u7c7b\u578b\u548c\u5927\u5c0f\u3002\u7f13\u5b58\u53ef\u4ee5\u662f\u4ee5\u4e0b\u4efb\u4f55\u7c7b\u578b\uff1a</p> <ul> <li> <p><code>off</code></p> <p>\u4e25\u683c\u7981\u6b62\u4f7f\u7528\u4f1a\u8bdd\u7f13\u5b58\uff1anginx \u660e\u786e\u544a\u77e5\u5ba2\u6237\u7aef\u7981\u6b62\u91cd\u590d\u4f7f\u7528\u4f1a\u8bdd\u3002</p> </li> <li> <p><code>none</code></p> <p>\u7981\u6b62\u4f7f\u7528\u4f1a\u8bdd\u7f13\u5b58\uff1anginx \u544a\u8bc9\u5ba2\u6237\u7aef\u4f1a\u8bdd\u53ef\u4ee5\u91cd\u7528\uff0c\u4f46\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\u5728\u7f13\u5b58\u4e2d\u5b58\u50a8\u4f1a\u8bdd\u53c2\u6570\u3002</p> </li> <li> <p><code>builtin</code></p> <p>\u5185\u7f6e\u7684 OpenSSL \u7f13\u5b58\uff0c\u4ec5\u7531\u4e00\u4e2a worker \u8fdb\u7a0b\u4f7f\u7528\u3002\u7f13\u5b58\u5927\u5c0f\u5728\u4f1a\u8bdd\u4e2d\u6307\u5b9a\u3002\u5982\u679c\u672a\u6307\u5b9a\u5927\u5c0f\uff0c\u5219\u9ed8\u8ba4\u4e3a 20480 \u4e2a\u4f1a\u8bdd\u3002\u4f7f\u7528\u5185\u7f6e\u7f13\u5b58\u53ef\u80fd\u5bfc\u81f4\u5185\u5b58\u788e\u7247\u3002</p> </li> <li> <p><code>shared</code></p> <p>\u6240\u6709 worker \u8fdb\u7a0b\u4e4b\u95f4\u5171\u4eab\u7684\u7f13\u5b58\u3002\u7f13\u5b58\u5927\u5c0f\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff0c\u4e00\u5146\u5b57\u8282\u53ef\u4ee5\u5b58\u50a8\u5927\u7ea6 4000 \u4e2a\u4f1a\u8bdd\u3002\u6bcf\u4e2a\u5171\u4eab\u7f13\u5b58\u90fd\u6709\u4e00\u4e2a\u4efb\u610f\u7684\u540d\u79f0\u3002\u76f8\u540c\u540d\u79f0\u7684\u7f13\u5b58\u53ef\u4ee5\u5728\u591a\u4e2a\u670d\u52a1\u5668\u4e2d\u4f7f\u7528\u3002</p> </li> </ul> <p>\u4e24\u79cd\u7f13\u5b58\u7c7b\u578b\u53ef\u4ee5\u540c\u65f6\u4f7f\u7528\uff0c\u4f8b\u5982\uff1a</p> <pre><code>ssl_session_cache builtin:1000 shared:SSL:10m;\n</code></pre> <p>\u4f46\u4ec5\u4f7f\u7528\u5171\u4eab\u7f13\u5b58\u800c\u4e0d\u4f7f\u7528\u5185\u7f6e\u7f13\u5b58\uff0c\u6548\u7387\u4f1a\u66f4\u9ad8\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_session_ticket_key","title":"ssl_session_ticket_key","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_session_ticket_key <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 mail\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u4e00\u4e2a\u5e26\u6709\u7528\u4e8e\u52a0\u5bc6\u548c\u89e3\u5bc6 TLS \u4f1a\u8bdd\u7968\u8bc1\u7684\u5bc6\u94a5\u6587\u4ef6\u3002\u5982\u679c\u5fc5\u987b\u5728\u591a\u4e2a\u670d\u52a1\u5668\u4e4b\u95f4\u5171\u4eab\u540c\u4e00\u5bc6\u94a5\uff0c\u5219\u8be5\u6307\u4ee4\u662f\u5fc5\u9700\u7684\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u968f\u673a\u751f\u6210\u7684\u5bc6\u94a5\u3002</p> <p>\u5982\u679c\u6307\u5b9a\u4e86\u591a\u4e2a\u5bc6\u94a5\uff0c\u4ec5\u7b2c\u4e00\u4e2a\u5bc6\u94a5\u88ab\u7528\u4e8e\u52a0\u5bc6 TLS \u4f1a\u8bdd\u7968\u8bc1\u3002\u53ef\u914d\u7f6e key \u8f6e\u8f6c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>ssl_session_ticket_key current.key;\nssl_session_ticket_key previous.key;\n</code></pre> <p>\u8be5\u6587\u4ef6\uff08<code>file</code>\uff09\u5fc5\u987b\u5305\u542b 80 \u6216 48 \u4e2a\u5b57\u8282\u7684\u968f\u673a\u6570\u636e\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u521b\u5efa\uff1a</p> <pre><code>openssl rand 80&gt; ticket.key\n</code></pre> <p>\u6839\u636e\u6587\u4ef6\u5927\u5c0f\uff0c\u4f7f\u7528 AES256\uff08\u9488\u5bf9 80 \u5b57\u8282\u7684 key\uff0c1.11.8\uff09\u6216 AES128\uff08\u9488\u5bf9 48 \u5b57\u8282\u7684 key\uff09\u8fdb\u884c\u52a0\u5bc6\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_session_tickets","title":"ssl_session_tickets","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_session_tickets <code>on</code> | <code>off</code>; \u9ed8\u8ba4 ssl_session_tickets on; \u4e0a\u4e0b\u6587 mail\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.5.9 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u901a\u8fc7 TLS \u4f1a\u8bdd\u7968\u8bc1\u542f\u7528\u6216\u7981\u7528\u4f1a\u8bdd\u590d\u7528\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_session_timeout","title":"ssl_session_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_session_timeout <code>time</code>; \u9ed8\u8ba4 ssl_session_timeout 5m; \u4e0a\u4e0b\u6587 mail\u3001server <p>\u6307\u5b9a\u5ba2\u6237\u7aef\u53ef\u4ee5\u91cd\u7528\u4f1a\u8bdd\u53c2\u6570\u7684\u65f6\u95f4\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_trusted_certificate","title":"ssl_trusted_certificate","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_trusted_certificate <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 mail\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.11 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u4e00\u4e2a\u5e26\u6709\u7528\u4e8e\u9a8c\u8bc1\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684 PEM \u683c\u5f0f\u7684\u53d7\u4fe1\u4efb CA \u8bc1\u4e66\u6587\u4ef6\u3002</p> <p>\u4e0e ssl_client_certificate \u8bbe\u7f6e\u7684\u8bc1\u4e66\u76f8\u53cd\uff0c\u8fd9\u4e9b\u8bc1\u4e66\u7684\u5217\u8868\u4e0d\u4f1a\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_verify_client","title":"ssl_verify_client","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_verify_client <code>on</code> | <code>none</code> | <code>optional</code> | <code>optional_no_ca</code>; \u9ed8\u8ba4 ssl_verify_client off; \u4e0a\u4e0b\u6587 mail\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.11 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u5ba2\u6237\u7aef\u8bc1\u4e66\u7684\u9a8c\u8bc1\u3002\u9a8c\u8bc1\u7ed3\u679c\u5728\u8eab\u4efd\u9a8c\u8bc1\u8bf7\u6c42\u7684 Auth-SSL-Verify \u5934\u4e2d\u4f20\u9012\u3002</p> <p><code>optional</code> \u53c2\u6570\u8bf7\u6c42\u5ba2\u6237\u7aef\u8bc1\u4e66\u5e76\u9a8c\u8bc1\u8be5\u8bc1\u4e66\u662f\u5426\u5b58\u5728\u3002</p> <p><code>optional_no_ca</code> \u53c2\u6570\u8bf7\u6c42\u5ba2\u6237\u7aef\u8bc1\u4e66\uff0c\u4f46\u4e0d\u9700\u8981\u7531\u53d7\u4fe1\u4efb\u7684 CA \u8bc1\u4e66\u5bf9\u5176\u8fdb\u884c\u7b7e\u540d\uff0c\u9002\u5408\u5728 nginx \u5916\u90e8\u7684\u670d\u52a1\u6267\u884c\u5b9e\u9645\u8bc1\u4e66\u9a8c\u8bc1\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528\u3002\u901a\u8fc7\u53d1\u9001\u5230\u8eab\u4efd\u9a8c\u8bc1\u670d\u52a1\u5668\u7684\u8bf7\u6c42\u53ef\u4ee5\u8bbf\u95ee\u8bc1\u4e66\u7684\u5185\u5bb9\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#ssl_verify_depth","title":"ssl_verify_depth","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_verify_depth <code>number</code>; \u9ed8\u8ba4 ssl_verify_depth 1; \u4e0a\u4e0b\u6587 mail\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.7.11 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u5ba2\u6237\u7aef\u8bc1\u4e66\u94fe\u7684\u9a8c\u8bc1\u6df1\u5ea6\u3002</p>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#starttls","title":"starttls","text":"- \u8bf4\u660e \u8bed\u6cd5 starttls <code>on</code> | <code>off</code> | <code>only</code>; \u9ed8\u8ba4 starttls off; \u4e0a\u4e0b\u6587 mail\u3001server <ul> <li> <p><code>on</code></p> <p>\u5141\u8bb8\u5bf9 POP3 \u4f7f\u7528 <code>STLS</code> \u547d\u4ee4\uff0c\u5bf9 IMAP \u548c SMTP \u4f7f\u7528 <code>STARTTLS</code> \u547d\u4ee4</p> </li> <li> <p><code>off</code></p> <p>\u62d2\u7edd\u4f7f\u7528 <code>STLS</code> \u548c <code>STARTTLS</code> \u547d\u4ee4</p> </li> <li> <p><code>only</code></p> <p>\u8981\u6c42\u521d\u6b65\u7684 TLS \u8f6c\u6362</p> </li> </ul>"},{"location":"Modules-reference/mail/ngx_mail_ssl_module/#_3","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/mail/ngx_mail_ssl_module.html</li> </ul>"},{"location":"Modules-reference/stream/ngx_stream_access_module/","title":"ngx_stream_access_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>allow</li> <li>deny</li> </ul> </li> </ul> <p><code>ngx_stream_access_module</code> \u6a21\u5757\uff081.9.2\uff09\u5141\u8bb8\u5bf9\u67d0\u4e9b\u5ba2\u6237\u7aef\u5730\u5740\u9650\u5236\u8bbf\u95ee\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_access_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>server {\n...\ndeny  192.168.1.1;\nallow 192.168.1.0/24;\nallow 10.1.1.0/16;\nallow 2001:0db8::/32;\ndeny  all;\n}\n</code></pre> <p>\u6309\u987a\u5e8f\u68c0\u67e5\u89c4\u5219\uff0c\u76f4\u5230\u627e\u5230\u7b2c\u4e00\u4e2a\u5339\u914d\u9879\u3002\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u4ec5\u5141\u8bb8 IPv4 \u7f51\u7edc <code>10.1.1.0/16</code> \u548c <code>192.168.1.0/24</code>\uff08\u4e0d\u5305\u62ec\u5730\u5740 <code>192.168.1.1</code>\uff09\u548c IPv6 \u7f51\u7edc<code>2001:0db8::/32</code> \u8fdb\u884c\u8bbf\u95ee\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_access_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/stream/ngx_stream_access_module/#allow","title":"allow","text":"- \u8bf4\u660e \u8bed\u6cd5 allow <code>address</code> | <code>CIDR</code> | <code>unix:</code> | <code>all</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream\u3001server <p>\u5141\u8bb8\u6307\u5b9a\u7684\u7f51\u7edc\u6216\u5730\u5740\u8bbf\u95ee\u3002\u5982\u679c\u6307\u5b9a\u4e86\u503c <code>unix:</code>\uff0c\u5219\u5141\u8bb8\u8bbf\u95ee\u6240\u6709 UNIX \u57df\u5957\u63a5\u5b57\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_access_module/#deny","title":"deny","text":"- \u8bf4\u660e \u8bed\u6cd5 deny <code>address</code> | <code>CIDR</code> | <code>unix:</code> | <code>all</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream\u3001server <p>\u62d2\u7edd\u6307\u5b9a\u7684\u7f51\u7edc\u6216\u5730\u5740\u8bbf\u95ee\u3002\u5982\u679c\u6307\u5b9a\u4e86\u503c <code>unix:</code>\uff0c\u5219\u62d2\u7edd\u6240\u6709 UNIX \u57df\u5957\u63a5\u5b57\u7684\u8bbf\u95ee\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_access_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/stream/ngx_stream_access_module.html</p>"},{"location":"Modules-reference/stream/ngx_stream_core_module/","title":"ngx_stream_core_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>listen</li> <li>preread_buffer_size</li> <li>preread_timeout</li> <li>proxy_protocol_timeout</li> <li>resolver</li> <li>resolver_timeout</li> <li>server</li> <li>stream</li> <li>tcp_nodelay</li> <li>variables_hash_bucket_size</li> <li>variables_hash_max_size</li> </ul> </li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_stream_core_module</code> \u6a21\u5757\u81ea\u7248\u672c 1.9.0 \u8d77\u53ef\u7528\u3002\u9ed8\u8ba4\u6784\u5efa\u60c5\u51b5\u4e0b\u4e0d\u5305\u542b\u6a21\u5757\uff0c\u53ef\u5728\u6784\u5efa\u65f6\u4f7f\u7528 <code>--with-stream</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_core_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>worker_processes auto;\n\nerror_log /var/log/nginx/error.log info;\n\nevents {\nworker_connections  1024;\n}\n\nstream {\nupstream backend {\nhash $remote_addr consistent;\n\nserver backend1.example.com:12345 weight=5;\nserver 127.0.0.1:12345            max_fails=3 fail_timeout=30s;\nserver unix:/tmp/backend3;\n}\n\nupstream dns {\nserver 192.168.0.1:53535;\nserver dns.example.com:53;\n}\n\nserver {\nlisten 12345;\nproxy_connect_timeout 1s;\nproxy_timeout 3s;\nproxy_pass backend;\n}\n\nserver {\nlisten 127.0.0.1:53 udp reuseport;\nproxy_timeout 20s;\nproxy_pass dns;\n}\n\nserver {\nlisten [::1]:12345;\nproxy_pass unix:/tmp/stream.socket;\n}\n}\n</code></pre>"},{"location":"Modules-reference/stream/ngx_stream_core_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/stream/ngx_stream_core_module/#listen","title":"listen","text":"- \u8bf4\u660e \u8bed\u6cd5 listen <code>address:port [ssl] [udp] [proxy_protocol] [backlog=number] [rcvbuf=size] [sndbuf=size] [bind] [ipv6only=on\\|off] [reuseport] [so_keepalive=on\\|off\\|[keepidle]:[keepintvl]:[keepcnt]]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 server <p>\u4e3a\u63a5\u53d7\u8fde\u63a5\u670d\u52a1\u5668\u7684 socket \u8bbe\u7f6e <code>address</code> \u548c <code>port</code>\u3002\u53ef\u4ec5\u6307\u5b9a\u7aef\u53e3\u3002\u5730\u5740\u4e5f\u53ef\u4ee5\u662f\u4e3b\u673a\u540d\uff0c\u4f8b\u5982\uff1a</p> <pre><code>listen 127.0.0.1:12345;\nlisten *:12345;\nlisten 12345;     # same as *:12345\nlisten localhost:12345;\n</code></pre> <p>IPv6 \u5730\u5740\u9700\u8981\u5728\u65b9\u62ec\u53f7\u4e2d\u6307\u5b9a\uff1a</p> <pre><code>listen [::1]:12345;\nlisten [::]:12345;\n</code></pre> <p>UNIX \u57df\u5957\u63a5\u5b57\u52a1\u5fc5\u52a0\u4e0a <code>unix:</code> \u524d\u7f00\uff1a</p> <pre><code>listen unix:/var/run/nginx.sock;\n</code></pre> <p><code>ssl</code> \u53c2\u6570\u5141\u8bb8\u7aef\u53e3\u4e0a\u63a5\u53d7\u7684\u6240\u6709\u8fde\u63a5\u90fd\u5728 SSL \u6a21\u5f0f\u4e0b\u5de5\u4f5c\u3002</p> <p><code>udp</code> \u53c2\u6570\u914d\u7f6e\u4e00\u4e2a\u76d1\u542c socket \u4ee5\u5904\u7406\u6570\u636e\u62a5\uff081.9.13\uff09\u3002</p> <p><code>proxy_protocol</code> \u53c2\u6570\uff081.11.4\uff09\u5141\u8bb8\u6307\u5b9a\u7aef\u53e3\u4e0a\u63a5\u53d7\u7684\u6240\u6709\u8fde\u63a5\u90fd\u4f7f\u7528 PROXY \u534f\u8bae\u3002</p> <p>\u81ea 1.13.11 \u7248\u672c\u8d77\u652f\u6301 PROXY \u534f\u8bae\u7248\u672c 2\u3002</p> <p><code>listen</code> \u6307\u4ee4\u6709\u51e0\u4e2a\u4e13\u95e8\u4e0e\u5957\u63a5\u5b57\u76f8\u5173\u7684\u7cfb\u7edf\u8c03\u7528\u7684\u9644\u52a0\u53c2\u6570\u3002</p> <ul> <li> <p><code>backlog=number</code></p> <p>\u5728 <code>listen()</code> \u8c03\u7528\u4e2d\u8bbe\u7f6e <code>backlog</code> \u53c2\u6570\uff0c\u8be5\u53c2\u6570\u9650\u5236\u6302\u8d77\u8fde\u63a5\u961f\u5217\u7684\u6700\u5927\u957f\u5ea6\uff081.9.2\uff09\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>backlog</code> \u5728 FreeBSD\u3001DragonFly BSD \u548c macOS \u4e0a\u8bbe\u7f6e\u4e3a -1\uff0c\u5728\u5176\u4ed6\u5e73\u53f0\u4e0a\u8bbe\u7f6e\u4e3a 511\u3002</p> </li> <li> <p><code>rcvbuf=size</code></p> <p>\u8bbe\u7f6e\u76d1\u542c\u5957\u63a5\u5b57\u7684\u63a5\u6536\u7f13\u51b2\u533a\u5927\u5c0f\uff08<code>SO_RCVBUF</code> \u9009\u9879\uff09\uff081.11.13\uff09\u3002</p> </li> <li> <p><code>sndbuf=size</code></p> <p>\u8bbe\u7f6e\u76d1\u542c\u5957\u63a5\u5b57\u7684\u53d1\u9001\u7f13\u51b2\u533a\u5927\u5c0f\uff08<code>SO_SNDBUF</code> \u9009\u9879\uff09\uff081.11.13\uff09\u3002</p> </li> <li> <p><code>bind</code></p> <p>\u6b64\u53c2\u6570\u5bf9\u7ed9\u5b9a\u7684 <code>address:port</code> \u5bf9\u8fdb\u884c\u5355\u72ec\u7684 <code>bind()</code> \u8c03\u7528\u3002\u4e8b\u5b9e\u4e0a\uff0c\u5982\u679c\u5b58\u5728\u51e0\u4e2a\u5177\u6709\u76f8\u540c\u7aef\u53e3\u4f46\u5730\u5740\u4e0d\u540c\u7684 <code>listen</code> \u6307\u4ee4\uff0c\u5e76\u4e14\u5176\u4e2d\u4e00\u4e2a <code>listen</code> \u6307\u4ee4\u76d1\u542c\u7ed9\u5b9a\u7684\u7aef\u53e3\uff08<code>*:port</code>\uff09\u7684\u6240\u6709\u5730\u5740\uff0c\u5219 nginx \u5c06 <code>bind()</code> \u4ec5\u9650\u4e8e <code>*:port</code> \u8303\u56f4\u3002\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5c06\u8c03\u7528 <code>getsockname()</code> \u7cfb\u7edf\u8c03\u7528\u4ee5\u786e\u5b9a\u63a5\u53d7\u8fde\u63a5\u7684\u5730\u5740\u3002\u5982\u679c\u4f7f\u7528\u4e86 <code>ipv6only</code> \u6216 <code>so_keepalive</code> \u53c2\u6570\uff0c\u90a3\u4e48\u5bf9\u4e8e\u6307\u5b9a\u7684<code>address:port</code> \u5bf9\u5c06\u59cb\u7ec8\u5bf9 <code>bind()</code> \u5355\u72ec\u8c03\u7528\u3002</p> </li> <li> <p><code>ipv6only=on|off</code></p> <p>\u6b64\u53c2\u6570\u786e\u5b9a\uff08\u901a\u8fc7 <code>IPV6_V6ONLY</code> \u5957\u63a5\u5b57\u9009\u9879\uff09\u76d1\u542c\u901a\u914d\u7b26\u5730\u5740 <code>[::]</code> \u7684 IPv6 \u5957\u63a5\u5b57\u662f\u63a5\u53d7 IPv6 \u548c IPv4 \u8fde\u63a5\u8fd8\u662f\u4ec5\u63a5\u53d7 IPv6 \u8fde\u63a5\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6b64\u53c2\u6570\u5904\u4e8e\u542f\u7528\u72b6\u6001\u3002\u5b83\u53ea\u80fd\u5728\u542f\u52a8\u65f6\u8bbe\u7f6e\u4e00\u6b21\u3002</p> </li> <li> <p><code>reuseport</code></p> <p>\u6b64\u53c2\u6570\uff081.9.1\uff09\u8868\u793a\u4e3a\u6bcf\u4e2a worker \u8fdb\u7a0b\u521b\u5efa\u4e00\u4e2a\u5355\u72ec\u7684\u76d1\u542c\u5957\u63a5\u5b57\uff08\u5728 Linux 3.9+ \u548c DragonFly BSD \u4e0a\u4f7f\u7528 <code>SO_REUSEPORT</code> \u5957\u63a5\u5b57\u9009\u9879\uff0c\u5728 FreeBSD 12+ \u4e0a\u4f7f\u7528 <code>SO_REUSEPORT_LB</code>\uff09\uff0c\u5141\u8bb8\u5185\u6838\u5728 worker \u8fdb\u7a0b\u4e4b\u95f4\u5206\u914d\u4f20\u5165\u8fde\u63a5\u3002\u76ee\u524d\u4ec5\u9002\u7528\u4e8e Linux 3.9+\u3001DragonFly BSD \u548c FreeBSD 12+\uff081.15.1\uff09\u3002</p> <p>\u4e0d\u6070\u5f53\u5730\u4f7f\u7528\u6b64\u9009\u9879\u53ef\u80fd\u4f1a\u4ea7\u751f\u5b89\u5168\u9690\u60a3\u3002</p> </li> <li> <p><code>so_keepalive=on|off|[keepidle]:[keepintvl]:[keepcnt]</code></p> <p>\u6b64\u53c2\u6570\u914d\u7f6e\u76d1\u542c\u5957\u63a5\u5b57\u7684 TCP keepalive \u884c\u4e3a\u3002\u5982\u679c\u7701\u7565\u6b64\u53c2\u6570\uff0c\u5c06\u542f\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u5957\u63a5\u5b57\u8bbe\u7f6e\u3002\u5982\u679c\u5c06\u5176\u8bbe\u7f6e\u4e3a\u503c <code>on</code>\uff0c\u5219\u4e3a\u5957\u63a5\u5b57\u6253\u5f00 <code>SO_KEEPALIVE</code> \u9009\u9879\u3002\u5982\u679c\u5c06\u5176\u503c\u8bbe\u7f6e\u4e3a <code>off</code>\uff0c\u5219\u4e3a\u5957\u63a5\u5b57\u5173\u95ed <code>SO_KEEPALIVE</code> \u9009\u9879\u3002\u67d0\u4e9b\u64cd\u4f5c\u7cfb\u7edf\u652f\u6301\u4f7f\u7528 <code>TCP_KEEPIDLE</code>\u3001<code>TCP_KEEPINTVL</code> \u548c <code>TCP_KEEPCNT</code> \u5957\u63a5\u5b57\u9009\u9879\u5728\u6bcf\u4e2a\u5957\u63a5\u5b57\u7684\u57fa\u7840\u4e0a\u8bbe\u7f6e TCP keepalive \u53c2\u6570\u3002\u5728\u6b64\u7c7b\u7cfb\u7edf\u4e0a\uff08\u76ee\u524d\u6709 Linux 2.4+\u3001NetBSD 5+ \u548c FreeBSD 9.0-STABLE\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>keepidle</code>\u3001<code>keepintvl</code> \u548c<code>keepcnt</code> \u53c2\u6570\u914d\u7f6e\u3002\u53ef\u7701\u7565\u4e00\u4e24\u4e2a\u53c2\u6570\uff0c\u5728\u8be5\u60c5\u51b5\u4e0b\uff0c\u76f8\u5e94\u5957\u63a5\u5b57\u9009\u9879\u7684\u7cfb\u7edf\u9ed8\u8ba4\u8bbe\u7f6e\u5c06\u751f\u6548\u3002\u4f8b\u5982\uff0c</p> <pre><code>so_keepalive=30m::10\n</code></pre> <p>\u5c06\u8bbe\u7f6e\u7a7a\u95f2\u8d85\u65f6\uff08<code>TCP_KEEPIDLE</code>\uff09\u4e3a 30 \u5206\u949f\uff0c\u63a2\u6d4b\u95f4\u9694\uff08<code>TCP_KEEPINTVL</code>\uff09\u4fdd\u7559\u4e3a\u7cfb\u7edf\u9ed8\u8ba4\u503c\uff0c\u5c06\u63a2\u6d4b\u5305\u6570\uff08<code>TCP_KEEPCNT</code>\uff09\u8bbe\u7f6e\u4e3a 10 \u4e2a\u3002</p> </li> </ul> <p>\u4e0d\u540c\u7684\u670d\u52a1\u5668\u5fc5\u987b\u4fa6\u542c\u4e0d\u540c\u7684 <code>address:port</code> \u5bf9\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_core_module/#preread_buffer_size","title":"preread_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 preread_buffer_size <code>size</code>; \u9ed8\u8ba4 preread_buffer_size 16k; \u4e0a\u4e0b\u6587 stream\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.5 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u9884\u8bfb\u7f13\u51b2\u533a\u7684 <code>size</code>\uff08\u5927\u5c0f\uff09\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_core_module/#preread_timeout","title":"preread_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 preread_timeout <code>timeout</code>; \u9ed8\u8ba4 preread_timeout 30s; \u4e0a\u4e0b\u6587 stream\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.5 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u9884\u8bfb\u7f13\u51b2\u533a\u7684 <code>timeout</code>\uff08\u8d85\u65f6\u65f6\u95f4\uff09\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_core_module/#proxy_protocol_timeout","title":"proxy_protocol_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_protocol_timeout <code>timeout</code>; \u9ed8\u8ba4 proxy_protocol_timeout 30s; \u4e0a\u4e0b\u6587 stream\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.4 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u8bfb\u53d6 PROXY \u534f\u8bae\u5934\u5b8c\u6210\u7684 <code>timeout</code>\uff08\u8d85\u65f6\u65f6\u95f4\uff09\u3002\u5982\u679c\u5728\u6b64\u65f6\u95f4\u5185\u672a\u4f20\u8f93\u5b8c\u6574\u4e2a\u5934\uff0c\u5219\u5173\u95ed\u8fde\u63a5\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_core_module/#resolver","title":"resolver","text":"- \u8bf4\u660e \u8bed\u6cd5 resolver <code>address ... [valid=time] [ipv6=on\\|off]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.3 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5c06\u7528\u4e8e\u89e3\u6790\u4e0a\u6e38\u670d\u52a1\u5668\u540d\u79f0\u7684\u57df\u540d\u670d\u52a1\u5668\uff08Name Server\uff09\u914d\u7f6e\u5230\u5730\u5740\u5217\u8868\u4e2d\uff0c\u4f8b\u5982\uff1a</p> <pre><code>resolver 127.0.0.1 [::1]:5353;\n</code></pre> <p>\u53ef\u4ee5\u5c06\u5730\u5740\u6307\u5b9a\u4e3a\u4e00\u4e2a\u57df\u540d\u6216 IP \u5730\u5740\uff0c\u4ee5\u53ca\u53ef\u9644\u5e26\u4e00\u4e2a\u53ef\u9009\u7aef\u53e3\u3002\u5982\u679c\u672a\u6307\u5b9a\u7aef\u53e3\uff0c\u5219\u4f7f\u7528 53 \u7aef\u53e3\u3002\u57df\u540d\u670d\u52a1\u5668\u5c06\u4ee5\u5faa\u73af\u65b9\u5f0f\u67e5\u8be2\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnginx \u5c06\u5728\u89e3\u6790\u65f6\u67e5\u627e IPv4 \u548c IPv6 \u5730\u5740\u3002\u5982\u679c\u4e0d\u9700\u8981\u67e5\u627e IPv6 \u5730\u5740\uff0c\u53ef\u4ee5\u914d\u7f6e <code>ipv6=off</code> \u53c2\u6570\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnginx \u4f7f\u7528\u54cd\u5e94 TTL \u503c\u7f13\u5b58\u54cd\u5e94\u3002\u53ef\u9009\u7684 <code>valid</code> \u53c2\u6570\u53ef\u6539\u5199\u8be5\u884c\u4e3a\uff1a</p> <pre><code>resolver 127.0.0.1 [::1]:5353 valid=30s;\n</code></pre> <p>\u5728 1.11.3 \u7248\u672c\u4e4b\u524d\uff0c\u8be5\u6307\u4ee4\u4e3a\u6211\u4eec\u5546\u4e1a\u8ba2\u9605\u7684\u4e00\u90e8\u5206\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_core_module/#server","title":"server","text":"- \u8bf4\u660e \u8bed\u6cd5 server <code>{ ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream <p>\u914d\u7f6e server\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_core_module/#stream","title":"stream","text":"- \u8bf4\u660e \u8bed\u6cd5 stream <code>{ ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 main <p>\u4e3a\u6307\u5b9a stream server \u6307\u4ee4\u7684\u63d0\u4f9b\u914d\u7f6e\u6587\u4ef6\u4e0a\u4e0b\u6587\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_core_module/#tcp_nodelay","title":"tcp_nodelay","text":"- \u8bf4\u660e \u8bed\u6cd5 tcp_nodelay <code>on</code> | <code>off</code>; \u9ed8\u8ba4 tcp_nodelay on; \u4e0a\u4e0b\u6587 stream\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.9.4 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u542f\u7528\u6216\u7981\u7528 <code>TCP_NODELAY</code> \u9009\u9879\u3002\u8be5\u9009\u9879\u5bf9\u5ba2\u6237\u7aef\u548c\u4ee3\u7406\u670d\u52a1\u5668\u8fde\u63a5\u90fd\u6709\u4f5c\u7528\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_core_module/#variables_hash_bucket_size","title":"variables_hash_bucket_size","text":"- \u8bf4\u660e \u8bed\u6cd5 variables_hash_bucket_size <code>size</code>; \u9ed8\u8ba4 variables_hash_bucket_size 64; \u4e0a\u4e0b\u6587 stream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.11.2 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u53d8\u91cf\u54c8\u5e0c\u8868\u7684\u6876\u5927\u5c0f\u3002\u8bbe\u7f6e\u54c8\u5e0c\u8868\u7684\u8be6\u7ec6\u4fe1\u606f\u5728\u5355\u72ec\u7684\u6587\u6863\u6709\u8be6\u7ec6\u8bf4\u660e\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_core_module/#_3","title":"\u5185\u5d4c\u53d8\u91cf","text":"<p><code>ngx_stream_core_module</code> \u6a21\u5757\u81ea 1.11.2 \u7248\u672c\u8d77\u652f\u6301\u53d8\u91cf\u3002</p> <ul> <li> <p><code>$binary_remote_addr</code></p> <p>\u5ba2\u6237\u7aef\u5730\u5740\u91c7\u7528\u4e8c\u8fdb\u5236\u5f62\u5f0f\uff0c\u503c\u7684\u957f\u5ea6\u59cb\u7ec8\u4e3a IPv4 \u5730\u5740\u7684 4 \u4e2a\u5b57\u8282\u6216 IPv6 \u5730\u5740\u7684 16 \u4e2a\u5b57\u8282</p> </li> <li> <p><code>$bytes_received</code></p> <p>\u4ece\u5ba2\u6237\u7aef\u6536\u5230\u7684\u5b57\u8282\u6570\uff081.11.4\uff09</p> </li> <li> <p><code>$bytes_sent</code></p> <p>\u53d1\u9001\u5230\u5ba2\u6237\u7aef\u7684\u5b57\u8282\u6570</p> </li> <li> <p><code>$connection</code></p> <p>\u8fde\u63a5\u5e8f\u5217\u53f7</p> </li> <li> <p><code>$hostname</code></p> <p>\u4e3b\u673a\u540d</p> </li> <li> <p><code>$msec</code></p> <p>\u4ee5\u79d2\u4e3a\u5355\u4f4d\u7684\u5f53\u524d\u65f6\u95f4\uff08\u7cbe\u5ea6\u4e3a\u6beb\u79d2\uff09</p> </li> <li> <p><code>$nginx_version</code></p> <p>nginx \u7248\u672c</p> </li> <li> <p><code>$pid</code></p> <p>worker \u8fdb\u7a0b PID</p> </li> <li> <p><code>$protocol</code></p> <p>\u7528\u4e8e\u4e0e\u5ba2\u6237\u7aef\u901a\u4fe1\u7684\u534f\u8bae\uff1a<code>TCP</code> \u6216 <code>UDP</code>\uff081.11.4\uff09</p> </li> <li> <p><code>$proxy_protocol_addr</code></p> <p>\u6765\u81ea PROXY \u534f\u8bae\u5934\u7684\u5ba2\u6237\u7aef\u5730\u5740\uff0c\u5426\u5219\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff081.11.4\uff09</p> <p>\u5fc5\u987b\u5148\u5728 listen \u6307\u4ee4\u4e2d\u8bbe\u7f6e <code>proxy_protocol</code> \u53c2\u6570\u6765\u542f\u7528 PROXY \u534f\u8bae\u3002</p> </li> <li> <p><code>$proxy_protocol_port</code></p> <p>\u6765\u81ea PROXY \u534f\u8bae\u5934\u7684\u5ba2\u6237\u7aef\u7aef\u53e3\uff0c\u5426\u5219\u4e3a\u7a7a\u5b57\u7b26\u4e32\uff081.11.4\uff09</p> <p>\u5fc5\u987b\u5148\u5728 listen \u6307\u4ee4\u4e2d\u8bbe\u7f6e <code>proxy_protocol</code> \u53c2\u6570\u6765\u542f\u7528 PROXY \u534f\u8bae\u3002</p> </li> <li> <p><code>$remote_addr</code></p> <p>\u5ba2\u6237\u5730\u5740</p> </li> <li> <p><code>$remote_port</code></p> <p>\u5ba2\u6237\u7aef\u7aef\u53e3</p> </li> <li> <p><code>$server_addr</code></p> <p>\u63a5\u53d7\u8fde\u63a5\u7684\u670d\u52a1\u5668\u5730\u5740</p> <p>\u8ba1\u7b97\u6b64\u53d8\u91cf\u7684\u503c\u901a\u5e38\u9700\u8981\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\u3002\u4e3a\u907f\u514d\u7cfb\u7edf\u8c03\u7528\uff0clisten \u6307\u4ee4\u5fc5\u987b\u6307\u5b9a\u5730\u5740\u5e76\u4f7f\u7528 <code>bind</code> \u53c2\u6570\u3002</p> </li> <li> <p><code>$server_port</code></p> <p>\u63a5\u53d7\u8fde\u63a5\u7684\u670d\u52a1\u5668\u7aef\u53e3</p> </li> <li> <p><code>$session_time</code></p> <p>\u4f1a\u8bdd\u6301\u7eed\u65f6\u95f4\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09\uff0c\u7cbe\u5ea6\u4e3a\u6beb\u79d2\uff081.11.4\uff09</p> </li> <li> <p><code>$status</code></p> <p>\u4f1a\u8bdd\u72b6\u6001\uff081.11.4\uff09\uff0c\u53ef\u4ee5\u662f\u4ee5\u4e0b\u4e4b\u4e00\uff1a</p> <ul> <li> <p><code>200</code></p> <p>\u4f1a\u8bdd\u6210\u529f\u5b8c\u6210</p> </li> <li> <p><code>400</code></p> <p>\u65e0\u6cd5\u89e3\u6790\u5ba2\u6237\u7aef\u6570\u636e\uff0c\u4f8b\u5982 PROXY \u534f\u8bae\u5934</p> </li> <li> <p><code>403</code></p> <p>\u7981\u6b62\u8bbf\u95ee\u3002\u4f8b\u5982\uff0c\u5f53\u67d0\u4e9b\u5ba2\u6237\u7aef\u5730\u5740\u8bbf\u95ee\u53d7\u9650\u65f6</p> </li> <li> <p><code>500</code></p> <p>\u5185\u90e8\u670d\u52a1\u5668\u9519\u8bef</p> </li> <li> <p><code>502</code></p> <p>\u9519\u8bef\u7f51\u5173\uff0c\u4f8b\u5982\uff0c\u5982\u679c\u65e0\u6cd5\u9009\u62e9\u6216\u5230\u8fbe\u4e0a\u6e38\u670d\u52a1\u5668\u3002</p> </li> <li> <p><code>503</code></p> <p>\u670d\u52a1\u4e0d\u53ef\u7528\uff0c\u4f8b\u5982\uff0c\u5f53\u8bbf\u95ee\u53d7\u8fde\u63a5\u6570\u53d7\u9650\u65f6</p> </li> </ul> </li> <li> <p><code>$time_iso8601</code></p> <p>\u672c\u5730\u65f6\u95f4\u91c7\u7528 ISO 8601 \u6807\u51c6\u683c\u5f0f</p> </li> <li> <p><code>$time_local</code></p> <p>\u901a\u7528\u65e5\u5fd7\uff08Common Log\uff09\u683c\u5f0f\u7684\u672c\u5730\u65f6\u95f4</p> </li> </ul>"},{"location":"Modules-reference/stream/ngx_stream_core_module/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/stream/ngx_stream_core_module.html</p>"},{"location":"Modules-reference/stream/ngx_stream_geo_module/","title":"ngx_stream_geo_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>geo</li> </ul> </li> </ul> <p><code>ngx_stream_geo_module</code> \u6a21\u5757\uff081.11.3\uff09\u7528\u4e8e\u521b\u5efa\u4f9d\u8d56\u4e8e\u5ba2\u6237\u7aef IP \u5730\u5740\u7684\u53d8\u91cf\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_geo_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>geo $geo {\ndefault        0;\n\n127.0.0.1      2;\n192.168.1.0/24 1;\n10.1.0.0/16    1;\n\n::1            2;\n2001:0db8::/32 1;\n}\n</code></pre>"},{"location":"Modules-reference/stream/ngx_stream_geo_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/stream/ngx_stream_geo_module/#geo","title":"geo","text":"- \u8bf4\u660e \u8bed\u6cd5 geo <code>[$address] $variable { ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream <p>\u63cf\u8ff0\u6307\u5b9a\u53d8\u91cf\u7684\u503c\u4e0e\u5ba2\u6237\u7aef IP \u5730\u5740\u7684\u4f9d\u8d56\u5173\u7cfb\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5730\u5740\u53d6\u81ea <code>$remote_addr</code> \u53d8\u91cf\uff0c\u4f46\u4e5f\u53ef\u4ee5\u4ece\u5176\u4ed6\u53d8\u91cf\u4e2d\u83b7\u53d6\uff0c\u4f8b\u5982\uff1a</p> <pre><code>geo $arg_remote_addr $geo {\n...;\n}\n</code></pre> <p>\u7531\u4e8e\u53d8\u91cf\u4ec5\u5728\u4f7f\u7528\u65f6\u8fdb\u884c\u6c42\u503c\uff0c\u56e0\u6b64\u5373\u4f7f\u5b58\u5728\u5927\u91cf\u5df2\u58f0\u660e\u7684 <code>geo</code> \u53d8\u91cf\u589e\u52a0\u8fde\u63a5\u5904\u7406\u7684\u989d\u5916\u6210\u672c\u3002</p> <p>\u5982\u679c\u53d8\u91cf\uff08<code>$variable</code>\uff09\u7684\u503c\u4e0d\u662f\u6709\u6548\u7684 IP \u5730\u5740\uff0c\u5219\u4f7f\u7528 <code>255.255.255.255</code> \u5730\u5740\u3002</p> <p>\u5730\u5740\uff08<code>$address</code>\uff09\u53ef\u4e3a CIDR \u8bb0\u6cd5\u4e2d\u7684\u524d\u7f00\uff08\u5305\u62ec\u5355\u4e2a\u5730\u5740\uff09\u6216\u4f5c\u4e3a\u8303\u56f4\u3002</p> <p>\u8fd8\u652f\u6301\u4ee5\u4e0b\u7279\u6b8a\u53c2\u6570\uff1a</p> <ul> <li> <p><code>delete</code></p> <p>\u5220\u9664\u6307\u5b9a\u7684\u7f51\u7edc</p> </li> <li> <p><code>default</code></p> <p>\u5982\u679c\u5ba2\u6237\u7aef\u5730\u5740\u4e0e\u6240\u6709\u6307\u5b9a\u7684\u5730\u5740\u90fd\u4e0d\u5339\u914d\uff0c\u5219\u8bbe\u7f6e\u4e3a\u8be5\u53d8\u91cf\u7684\u503c\u3002\u5f53\u4ee5 CIDR \u8bb0\u6cd5\u6307\u5b9a\u5730\u5740\u65f6\uff0c\u4f7f\u7528 <code>0.0.0.0/0</code> \u548c <code>::/0</code> \u800c\u4e0d\u662f\u9ed8\u8ba4\u503c\u3002\u5982\u679c\u672a\u6307\u5b9a <code>default</code>\uff0c\u5219\u9ed8\u8ba4\u503c\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002</p> </li> <li> <p><code>include</code></p> <p>\u5305\u542b\u4e00\u4e2a\u6709\u5730\u5740\u548c\u503c\u7684\u6587\u4ef6\uff0c\u6587\u4ef6\u4e2d\u53ef\u4ee5\u6709\u591a\u4e2a\u8bb0\u5f55\u3002</p> </li> <li> <p><code>ranges</code></p> <p>\u8868\u793a\u5730\u5740\u6307\u5b9a\u4e3a\u8303\u56f4\u5f62\u5f0f\u3002\u8fd9\u4e2a\u53c2\u6570\u5e94\u8be5\u653e\u5728\u7b2c\u4e00\u4e2a\u3002\u8981\u52a0\u5feb\u5730\u7406\u6570\u636e\u7684\u52a0\u8f7d\u901f\u5ea6\uff0c\u5730\u5740\u5e94\u6309\u5347\u5e8f\u6392\u5217\u3002</p> </li> </ul> <p>\u793a\u4f8b\uff1a</p> <pre><code>geo $country {\ndefault        ZZ;\ninclude        conf/geo.conf;\ndelete         127.0.0.0/16;\n\n127.0.0.0/24   US;\n127.0.0.1/32   RU;\n10.1.0.0/16    RU;\n192.168.1.0/24 UK;\n}\n</code></pre> <p><code>conf/geo.conf</code> \u6587\u4ef6\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>10.2.0.0/16    RU;\n192.168.2.0/24 RU;\n</code></pre> <p>\u4f7f\u7528\u6700\u4f73\u5339\u914d\u7684\u503c\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e 127.0.0.1 \u5730\u5740\uff0c\u5c06\u9009\u62e9\u503c <code>RU</code>\uff0c\u800c\u4e0d\u662f <code>US</code>\u3002</p> <p>\u8303\u56f4\u6307\u5b9a\u793a\u4f8b\uff1a</p> <pre><code>geo $country {\nranges;\ndefault                   ZZ;\n127.0.0.0-127.0.0.0       US;\n127.0.0.1-127.0.0.1       RU;\n127.0.0.1-127.0.0.255     US;\n10.1.0.0-10.1.255.255     RU;\n192.168.1.0-192.168.1.255 UK;\n}\n</code></pre>"},{"location":"Modules-reference/stream/ngx_stream_geo_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/stream/ngx_stream_geo_module.html</p>"},{"location":"Modules-reference/stream/ngx_stream_geoip_module/","title":"ngx_stream_geoip_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>geoip_country</li> <li>geoip_city</li> <li>geoip_org</li> </ul> </li> </ul> <p><code>ngx_stream_geoip_module</code> \u6a21\u5757\uff081.11.3\uff09\u4f7f\u7528\u9884\u7f16\u8bd1\u7684 MaxMind \u6570\u636e\u5e93\u521b\u5efa\u4f9d\u8d56\u4e8e\u5ba2\u6237\u7aef IP \u5730\u5740\u7684\u53d8\u91cf\u3002</p> <p>\u4f7f\u7528\u652f\u6301 IPv6 \u7684\u6570\u636e\u5e93\u65f6\uff0c\u67e5\u627e IPv4 \u5730\u5740\u5c06\u8f6c\u4e3a\u67e5\u627e IPv4 \u6620\u5c04\u7684 IPv6 \u5730\u5740\u3002</p> <p>\u9ed8\u8ba4\u6784\u5efa\u4e0d\u5305\u542b\u6b64\u6a21\u5757\uff0c\u53ef\u5728\u6784\u5efa\u65f6\u4f7f\u7528 <code>--with-stream_geoip_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p>\u8be5\u6a21\u5757\u9700\u8981 MaxMind GeoIP \u5e93\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_geoip_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>stream {\ngeoip_country         GeoIP.dat;\ngeoip_city            GeoLiteCity.dat;\n\nmap $geoip_city_continent_code $nearest_server {\ndefault        example.com;\nEU          eu.example.com;\nNA          na.example.com;\nAS          as.example.com;\n}\n...\n}\n</code></pre>"},{"location":"Modules-reference/stream/ngx_stream_geoip_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/stream/ngx_stream_geoip_module/#geoip_country","title":"geoip_country","text":"- \u8bf4\u660e \u8bed\u6cd5 geoip_country <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream <p>\u6307\u5b9a\u7528\u4e8e\u6839\u636e\u5ba2\u6237\u7aef IP \u5730\u5740\u786e\u5b9a\u56fd\u5bb6\u7684\u6570\u636e\u5e93\u3002\u4f7f\u7528\u6b64\u6570\u636e\u5e93\u65f6\uff0c\u4ee5\u4e0b\u53d8\u91cf\u53ef\u7528\uff1a</p> <ul> <li> <p><code>$geoip_country_code</code></p> <p>\u4e24\u4e2a\u5b57\u6bcd\u8868\u793a\u7684\u56fd\u5bb6\u4ee3\u7801\uff0c\u6bd4\u5982 <code>RU</code>\u3001<code>US</code></p> </li> <li> <p><code>$geoip_country_code3</code></p> <p>\u4e09\u4e2a\u5b57\u6bcd\u8868\u793a\u7684\u56fd\u5bb6\u4ee3\u7801\uff0c\u6bd4\u5982 <code>RUS</code>\u3001<code>USA</code></p> </li> <li> <p><code>$geoip_country_name</code></p> <p>\u56fd\u5bb6\u540d\u79f0\uff0c\u6bd4\u5982 <code>Russian Federation</code>\u3001<code>United States</code></p> </li> </ul>"},{"location":"Modules-reference/stream/ngx_stream_geoip_module/#geoip_city","title":"geoip_city","text":"- \u8bf4\u660e \u8bed\u6cd5 geoip_city <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream <p>\u6307\u5b9a\u7528\u4e8e\u6839\u636e\u5ba2\u6237\u7aef IP \u5730\u5740\u786e\u5b9a\u56fd\u5bb6\u3001\u5730\u533a\u548c\u57ce\u5e02\u7684\u6570\u636e\u5e93\u3002\u4f7f\u7528\u6b64\u6570\u636e\u5e93\u65f6\uff0c\u4ee5\u4e0b\u53d8\u91cf\u53ef\u7528\uff1a</p> <ul> <li> <p><code>$geoip_area_code</code></p> <p>\u7535\u8bdd\u533a\u53f7\uff08\u4ec5\u9650\u7f8e\u56fd\uff09</p> <p>\u56e0\u4e3a\u4f7f\u7528\u5230\u8fc7\u65f6\u7684\u6570\u636e\u5e93\u5b57\u6bb5\uff0c\u6b64\u53d8\u91cf\u53ef\u80fd\u5305\u542b\u8fc7\u65f6\u7684\u4fe1\u606f\u3002</p> </li> <li> <p><code>$geoip_city_continent_code</code></p> <p>\u4e24\u4e2a\u5b57\u6bcd\u8868\u793a\u7684\u5927\u9646\u4ee3\u7801\uff0c\u6bd4\u5982 <code>RU</code>\u3001<code>US</code></p> </li> <li> <p><code>$geoip_city_country_code</code></p> <p>\u4e24\u4e2a\u5b57\u6bcd\u8868\u793a\u7684\u56fd\u5bb6\u4ee3\u7801\uff0c\u6bd4\u5982 <code>RU</code>\u3001<code>US</code></p> </li> <li> <p><code>$geoip_city_country_code3</code></p> <p>\u4e09\u4e2a\u5b57\u6bcd\u8868\u793a\u7684\u56fd\u5bb6\u4ee3\u7801\uff0c\u6bd4\u5982 <code>RUS</code>\u3001<code>USA</code></p> </li> <li> <p><code>$geoip_city_country_name</code></p> <p>\u56fd\u5bb6\u540d\u79f0\uff0c\u6bd4\u5982 <code>Russian Federation</code>\u3001<code>United States</code></p> </li> <li> <p><code>$geoip_dma_code</code></p> <p>\u7f8e\u56fd DMA \u533a\u57df\u4ee3\u7801\uff08\u4e5f\u79f0\u4e3a**\u90fd\u5e02\u4ee3\u7801**\uff09\uff0c\u6839\u636e Google AdWords API \u4e2d\u7684\u5730\u7406\u4f4d\u7f6e\u5b9a\u4f4d\u3002</p> </li> <li> <p><code>$geoip_latitude</code></p> <p>\u7ef4\u5ea6</p> </li> <li> <p><code>$geoip_longitude</code></p> <p>\u7ecf\u5ea6</p> </li> <li> <p><code>$geoip_region</code></p> <p>\u53cc\u7b26\u53f7\u56fd\u5bb6\u533a\u57df\u4ee3\u7801\uff08\u5730\u533a\u3001\u9886\u571f\u3001\u5dde\u3001\u7701\u3001\u8054\u90a6\u571f\u5730\u7b49\uff09\uff0c\u4f8b\u5982 <code>48</code>\u3001<code>DC</code>\u3002</p> </li> <li> <p><code>$geoip_region_name</code></p> <p>\u56fd\u5bb6\u5730\u533a\u540d\u79f0\uff08\u5730\u533a\u3001\u9886\u571f\u3001\u5dde\u3001\u7701\u3001\u8054\u90a6\u571f\u5730\u7b49\uff09\uff0c\u4f8b\u5982\uff1a<code>Moscow City</code>\u3001<code>District of Columbia</code>\u3002</p> </li> <li> <p><code>$geoip_city</code></p> <p>\u57ce\u5e02\u540d\u79f0\uff0c\u4f8b\u5982\uff1a<code>Moscow\u201d</code>\u3001<code>Washington</code>\u3002</p> </li> <li> <p><code>$geoip_postal_code</code></p> <p>\u90ae\u653f\u7f16\u7801</p> </li> </ul>"},{"location":"Modules-reference/stream/ngx_stream_geoip_module/#geoip_org","title":"geoip_org","text":"- \u8bf4\u660e \u8bed\u6cd5 geoip_org <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream <p>\u6307\u5b9a\u7528\u4e8e\u6839\u636e\u5ba2\u6237\u7aef IP \u5730\u5740\u786e\u5b9a\u7ec4\u7ec7\u7684\u6570\u636e\u5e93\u3002\u4f7f\u7528\u6b64\u6570\u636e\u5e93\u65f6\uff0c\u4ee5\u4e0b\u53d8\u91cf\u53ef\u7528\uff1a</p> <ul> <li> <p><code>$geoip_org</code></p> <p>\u7ec4\u7ec7\u540d\u79f0\uff0c\u4f8b\u5982\uff1a<code>The University of Melbourne</code>\u3002</p> </li> </ul>"},{"location":"Modules-reference/stream/ngx_stream_geoip_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/stream/ngx_stream_geoip_module.html</p>"},{"location":"Modules-reference/stream/ngx_stream_js_module/","title":"ngx_stream_js_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>js_access</li> <li>js_filter</li> <li>js_include</li> <li>js_preread</li> <li>js_set</li> </ul> </li> <li>\u4f1a\u8bdd\u5bf9\u8c61\u5c5e\u6027</li> </ul> <p><code>ngx_stream_js_module</code> \u6a21\u5757\u7528\u4e8e\u5728 njs \u4e2d\u5b9e\u73b0\u5904\u7406\u7a0b\u5e8f \u2014\u2014 \u8fd9\u662f JavaScript \u8bed\u8a00\u7684\u4e00\u4e2a\u5b50\u96c6\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\u3002\u53ef\u5728\u6b64\u5904\u4e0b\u8f7d\u548c\u5b89\u88c5\u8bf4\u660e\u3002</p> <p></p> <p>\u6b64\u793a\u4f8b\u9002\u7528\u4e8e njs 0.2.4 \u53ca\u66f4\u9ad8\u7248\u672c\u3002\u5bf9\u4e8e njs 0.2.3 \u53ca\u66f4\u65e9\u7248\u672c\uff0c\u8bf7\u4f7f\u7528\u6b64\u793a\u4f8b\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_js_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>load_module modules/ngx_stream_js_module.so;\n...\n\nstream {\njs_include stream.js;\n\njs_set $bar bar;\njs_set $req_line req_line;\n\nserver {\nlisten 12345;\n\njs_preread preread;\nreturn     $req_line;\n}\n\nserver {\nlisten 12346;\n\njs_access  access;\nproxy_pass 127.0.0.1:8000;\njs_filter  header_inject;\n}\n}\n\nhttp {\nserver {\nlisten 8000;\nlocation / {\nreturn 200 $http_foo\\n;\n}\n}\n}\n</code></pre> <p><code>stream.js</code> \u5185\u5bb9\uff1a</p> <pre><code>var line = '';\n\nfunction bar(s) {\nvar v = s.variables;\ns.log(\"hello from bar() handler!\");\nreturn \"bar-var\" + v.remote_port + \"; pid=\" + v.pid;\n}\n\nfunction preread(s) {\ns.on('upload', function (data, flags) {\nvar n = data.indexOf('\\n');\nif (n != -1) {\nline = data.substr(0, n);\ns.done();\n}\n});\n}\n\nfunction req_line(s) {\nreturn line;\n}\n\n// Read HTTP request line.\n// Collect bytes in 'req' until\n// request line is read.\n// Injects HTTP header into a client's request\n\nvar my_header =  'Foo: foo';\nfunction header_inject(s) {\nvar req = '';\ns.on('upload', function(data, flags) {\nreq += data;\nvar n = req.search('\\n');\nif (n != -1) {\nvar rest = req.substr(n + 1);\nreq = req.substr(0, n + 1);\ns.send(req + my_header + '\\r\\n' + rest, flags);\ns.off('upload');\n}\n});\n}\n\nfunction access(s) {\nif (s.remoteAddress.match('^192.*')) {\ns.abort();\nreturn;\n}\n\ns.allow();\n}\n</code></pre> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_js_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/stream/ngx_stream_js_module/#js_access","title":"js_access","text":"- \u8bf4\u660e \u8bed\u6cd5 js_access <code>function</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream\u3001server <p>\u8bbe\u7f6e\u4e00\u4e2a\u5c06\u5728 access \u9636\u6bb5\u8c03\u7528\u7684 njs \u51fd\u6570\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_js_module/#js_filter","title":"js_filter","text":"- \u8bf4\u660e \u8bed\u6cd5 js_filter <code>function</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream\u3001server <p>\u8bbe\u7f6e\u4e00\u4e2a\u6570\u636e\u8fc7\u6ee4\u5668\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_js_module/#js_include","title":"js_include","text":"- \u8bf4\u660e \u8bed\u6cd5 js_include <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream <p>\u6307\u5b9a\u4e00\u4e2a\u4f7f\u7528 njs \u5b9e\u73b0\u670d\u52a1\u5668\u548c\u53d8\u91cf\u5904\u7406\u7a0b\u5e8f\u7684\u6587\u4ef6\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_js_module/#js_preread","title":"js_preread","text":"- \u8bf4\u660e \u8bed\u6cd5 js_preread <code>function</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream\u3001server <p>\u8bbe\u7f6e\u4e00\u4e2a\u5c06\u5728 preread \u9636\u6bb5\u8c03\u7528\u7684 njs \u51fd\u6570\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_js_module/#js_set","title":"js_set","text":"- \u8bf4\u660e \u8bed\u6cd5 js_set <code>function</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream <p>\u8bbe\u7f6e\u4e00\u4e2a\u7528\u4e8e\u6307\u5b9a\u53d8\u91cf\u7684 njs \u51fd\u6570\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_js_module/#_3","title":"\u4f1a\u8bdd\u5bf9\u8c61\u5c5e\u6027","text":"<p>\u6bcf\u4e00\u4e2a\u6d41 njs \u5904\u7406\u7a0b\u5e8f\u90fd\u4f1a\u63a5\u6536\u4e00\u4e2a\u53c2\u6570\uff0c\u4e00\u4e2a\u6d41\u4f1a\u8bdd\u5bf9\u8c61\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_js_module/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/stream/ngx_stream_js_module.html</p>"},{"location":"Modules-reference/stream/ngx_stream_keyval_module/","title":"ngx_stream_keyval_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>keyval</li> <li>keyval_zone</li> </ul> </li> </ul> <p><code>ngx_stream_keyval_module</code> \u6a21\u5757\uff081.13.7\uff09\u53ef\u7528\u4e8e\u521b\u5efa\u53d8\u91cf\uff0c\u53d8\u91cf\u7684\u503c\u4ece\u7531 API \u7ba1\u7406\u7684\u952e\u503c\u5bf9\u4e2d\u83b7\u53d6\u3002</p> <p>\u6b64\u6a21\u5757\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_keyval_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>http {\n\nserver {\n...\nlocation /api {\napi write=on;\n}\n}\n}\n\nstream {\n\nkeyval_zone zone=one:32k state=one.keyval;\nkeyval      $ssl_server_name $name zone=one;\n\nserver {\nlisten              12345 ssl;\nproxy_pass          $name;\nssl_certificate     /usr/local/nginx/conf/cert.pem;\nssl_certificate_key /usr/local/nginx/conf/cert.key;\n}\n}\n</code></pre>"},{"location":"Modules-reference/stream/ngx_stream_keyval_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/stream/ngx_stream_keyval_module/#keyval","title":"keyval","text":"- \u8bf4\u660e \u8bed\u6cd5 keyval <code>key $variable zone=name</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream <p>\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 <code>$variable</code>\uff0c\u5176\u503c\u5728\u952e\u503c\u6570\u636e\u5e93\u4e2d\u901a\u8fc7 key \u67e5\u627e\u3002\u5339\u914d\u89c4\u5219\u7531 keyval_zone \u6307\u4ee4\u7684 type \u53c2\u6570\u5b9a\u4e49\u3002\u6570\u636e\u5e93\u5b58\u50a8\u5728 <code>zone</code> \u53c2\u6570\u6307\u5b9a\u7684\u5171\u4eab\u5185\u5b58\u533a\u57df\u4e2d\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_keyval_module/#keyval_zone","title":"keyval_zone","text":"- \u8bf4\u660e \u8bed\u6cd5 keyval_zone <code>zone=name:size [state=file] [timeout=time] [type=string\\|ip\\|prefix] [sync]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream <p>\u8bbe\u7f6e\u7ef4\u6301\u952e\u503c\u6570\u636e\u5e93\u7684\u5171\u4eab\u5185\u5b58\u533a\u57df\u7684\u540d\u79f0\uff08<code>name</code>\uff09\u548c\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u952e\u503c\u5bf9\u901a\u8fc7 API \u8fdb\u884c\u7ba1\u7406\u3002</p> <p>\u53ef\u9009\u7684 <code>state</code> \u53c2\u6570\u6307\u5b9a\u4e00\u4e2a\u6587\u4ef6\uff08<code>file</code>\uff09\uff0c\u8be5\u6587\u4ef6\u4ee5 JSON \u683c\u5f0f\u4fdd\u5b58\u952e\u503c\u6570\u636e\u5e93\u7684\u5f53\u524d\u72b6\u6001\uff0c\u5e76\u5728\u91cd\u65b0\u542f\u52a8 nginx \u65f6\u4fdd\u6301\u4e0d\u53d8\u3002</p> <p>\u53ef\u9009\u7684 <code>timeout</code> \u53c2\u6570\uff081.15.0\uff09\u8bbe\u7f6e\u5c06\u952e\u503c\u5bf9\u4ece\u533a\u57df\u4e2d\u5220\u9664\u7684\u65f6\u95f4\u3002</p> <p>\u53ef\u9009\u7684 <code>type</code> \u53c2\u6570\uff081.17.1\uff09\u6fc0\u6d3b\u4e00\u4e2a\u989d\u5916\u7684\u7d22\u5f15\uff0c\u8be5\u7d22\u5f15\u9488\u5bf9\u67d0\u79cd\u7c7b\u578b\u7684\u952e\u5339\u914d\u8fdb\u884c\u4e86\u4f18\u5316\uff0c\u5339\u914d\u89c4\u5219\u5728\u8ba1\u7b97\u952e\u503c <code>$variable</code> \u65f6\u5b9a\u4e49\u3002</p> <p>\u7d22\u5f15\u5b58\u50a8\u5728\u76f8\u540c\u7684\u5171\u4eab\u5b58\u50a8\u533a\u4e2d\uff0c\u56e0\u6b64\u9700\u8981\u989d\u5916\u7684\u5b58\u50a8\u3002</p> <ul> <li> <p><code>type=string</code></p> <p>\u9ed8\u8ba4\u914d\u7f6e\uff0c\u4e0d\u542f\u7528\u7d22\u5f15\uff1b\u4f7f\u7528\u8bb0\u5f55 key \u548c\u4e00\u4e2a\u641c\u7d22 key \u7684\u5b8c\u5168\u5339\u914d\u6765\u6267\u884c\u53d8\u91cf\u67e5\u627e</p> </li> <li> <p><code>type=ip</code></p> <p>\u641c\u7d22 key \u662f IPv4 \u6216 IPv6 \u5730\u5740\u6216 CIDR \u8303\u56f4\u7684\u6587\u5b57\u8868\u793a\uff1b\u8981\u5339\u914d\u8bb0\u5f55 key\uff0c\u641c\u7d22 key \u5fc5\u987b\u5c5e\u4e8e\u8bb0\u5f55 key \u6307\u5b9a\u7684\u5b50\u7f51\u6216\u4e0e IP \u5730\u5740\u5b8c\u5168\u5339\u914d</p> </li> <li> <p><code>type=prefix</code></p> <p>\u4f7f\u7528\u8bb0\u5f55 key \u548c\u641c\u7d22 key \u7684\u524d\u7f00\u5339\u914d\uff081.17.5\uff09\u6267\u884c\u53d8\u91cf\u67e5\u627e\uff1b\u8981\u4e0e\u8bb0\u5f55 key \u5339\u914d\uff0c\u8bb0\u5f55 key \u5fc5\u987b\u662f\u641c\u7d22 key \u7684\u524d\u7f00</p> </li> </ul> <p>\u53ef\u9009\u7684 <code>sync</code> \u53c2\u6570\uff081.15.0\uff09\u542f\u7528\u5171\u4eab\u5185\u5b58\u533a\u57df\u540c\u6b65\u3002\u540c\u6b65\u8981\u6c42\u8bbe\u7f6e\u8d85\u65f6\uff08<code>timeout</code>\uff09\u53c2\u6570\u3002</p> <p>\u5982\u679c\u542f\u7528\u4e86\u540c\u6b65\uff0c\u5219\u5c06\u4ec5\u5728\u76ee\u6807\u7fa4\u96c6\u8282\u70b9\u4e0a\u6267\u884c\u952e\u503c\u5bf9\uff08\u65e0\u8bba\u662f\u4e00\u4e2a\u8fd8\u662f\u5168\u90e8\uff09\u7684\u5220\u9664\u64cd\u4f5c\u3002\u7ecf\u8fc7 <code>timeout</code> \u65f6\u95f4\u540e\uff0c\u5c06\u5220\u9664\u5176\u4ed6\u7fa4\u96c6\u8282\u70b9\u4e0a\u76f8\u540c\u7684\u952e\u503c\u5bf9\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_keyval_module/#_3","title":"\u539f\u6587\u6863","text":"<ul> <li>http://nginx.org/en/docs/stream/ngx_stream_keyval_module.html</li> </ul>"},{"location":"Modules-reference/stream/ngx_stream_limit_conn_module/","title":"ngx_stream_limit_conn_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>limit_conn</li> <li>limit_conn_log_level</li> <li>limit_conn_zone</li> </ul> </li> </ul> <p><code>ngx_stream_limit_conn_module</code> \u6a21\u5757\uff081.9.3\uff09\u7528\u4e8e\u9650\u5236\u6bcf\u4e2a\u5b9a\u4e49\u7684 key \u7684\u8fde\u63a5\u6570\uff0c\u7279\u522b\u662f\u6765\u81ea\u5355\u4e2a IP \u5730\u5740\u7684\u8fde\u63a5\u6570\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_limit_conn_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>stream {\nlimit_conn_zone $binary_remote_addr zone=addr:10m;\n\n...\n\nserver {\n\n...\n\nlimit_conn           addr 1;\nlimit_conn_log_level error;\n}\n}\n</code></pre>"},{"location":"Modules-reference/stream/ngx_stream_limit_conn_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/stream/ngx_stream_limit_conn_module/#limit_conn","title":"limit_conn","text":"- \u8bf4\u660e \u8bed\u6cd5 limit_conn <code>zone number</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream\u3001server <p>\u8bbe\u7f6e\u5171\u4eab\u5185\u5b58\u533a\u57df\u548c\u7ed9\u5b9a key \u7684\u6700\u5927\u5141\u8bb8\u8fde\u63a5\u6570\u3002\u8d85\u8fc7\u6b64\u9650\u5236\u65f6\uff0c\u670d\u52a1\u5668\u5c06\u5173\u95ed\u8fde\u63a5\u3002\u4f8b\u5982\uff0c\u4ee5\u4e0b\u6307\u4ee4\uff1a</p> <pre><code>limit_conn_zone $binary_remote_addr zone=addr:10m;\n\nserver {\n...\nlimit_conn addr 1;\n}\n</code></pre> <p>\u6bcf\u6b21\u53ea\u5141\u8bb8\u4e00\u4e2a IP \u5730\u5740\u4e00\u4e2a\u8fde\u63a5\u3002</p> <p>\u5982\u679c\u6307\u5b9a\u4e86\u51e0\u4e2a <code>limit_conn</code> \u6307\u4ee4\uff0c\u5219\u5c06\u5e94\u7528\u6240\u6709\u5df2\u914d\u7f6e\u7684\u9650\u5236\u3002</p> <p>\u5f53\u4e14\u4ec5\u5f53\u5f53\u524d\u7ea7\u522b\u6ca1\u6709 <code>limit_conn</code> \u6307\u4ee4\u65f6\uff0c\u6307\u4ee4\u624d\u4ece\u4e0a\u7ea7\u7ee7\u627f\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_limit_conn_module/#limit_conn_log_level","title":"limit_conn_log_level","text":"- \u8bf4\u660e \u8bed\u6cd5 limit_conn_log_level <code>info</code> | <code>notice</code> | <code>warn</code> | <code>error</code>; \u9ed8\u8ba4 limit_conn_log_level error; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u4e3a\u670d\u52a1\u5668\u9650\u5236\u8fde\u63a5\u6570\u8bbe\u7f6e\u65e5\u5fd7\u8bb0\u5f55\u7ea7\u522b\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_limit_conn_module/#limit_conn_zone","title":"limit_conn_zone","text":"- \u8bf4\u660e \u8bed\u6cd5 limit_conn_zone <code>key zone=name:size</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream <p>\u4e3a\u6307\u5b9a\u7684\u5171\u4eab\u5185\u5b58\u533a\u57df\u8bbe\u7f6e\u53c2\u6570\uff0c\u8be5\u533a\u57df\u5c06\u4fdd\u7559\u5404\u79cd key \u7684\u72b6\u6001\u3002\u5c24\u5176\u662f\u72b6\u6001\u5305\u62ec\u5f53\u524d\u7684\u8fde\u63a5\u6570\u3002<code>key</code> \u53ef\u4ee5\u5305\u542b\u6587\u672c\u3001\u53d8\u91cf\u53ca\u5176\u7ec4\u5408\uff081.11.2\uff09\u3002\u4e0d\u8ba1\u7b97 key \u4e3a\u7a7a\u7684\u8fde\u63a5\u3002\u7528\u6cd5\u793a\u4f8b\uff1a</p> <pre><code>limit_conn_zone $binary_remote_addr zone=addr:10m;\n</code></pre> <p>\u4e0a\u8ff0\u4e2d\uff0ckey \u662f\u4e00\u4e2a <code>$binary_remote_addr</code> \u53d8\u91cf\u8bbe\u7f6e\u7684\u5ba2\u6237\u7aef IP \u5730\u5740\u3002<code>$binary_remote_addr</code> \u7684\u5927\u5c0f\u4e3a IPv4 \u5730\u5740\u7684 4 \u4e2a\u5b57\u8282\u6216 IPv6 \u5730\u5740\u7684 16 \u4e2a\u5b57\u8282\u3002\u5b58\u50a8\u72b6\u6001\u5728 32 \u4f4d\u5e73\u53f0\u4e0a\u603b\u662f\u5360\u7528 32 \u6216 64 \u5b57\u8282\uff0c\u5728 64 \u4f4d\u5e73\u53f0\u4e0a\u5360\u7528 64 \u5b57\u8282\u3002\u4e00\u5146\u5b57\u8282\u533a\u57df\u53ef\u4ee5\u4fdd\u7559\u5927\u7ea6 32,000 \u4e2a 32 \u5b57\u8282\u72b6\u6001\u6216\u5927\u7ea6 16,000 \u4e2a 64 \u5b57\u8282\u72b6\u6001\u3002\u5982\u679c\u533a\u57df\u5b58\u50a8\u8017\u5c3d\uff0c\u670d\u52a1\u5668\u5c06\u5173\u95ed\u8fde\u63a5\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_limit_conn_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/stream/ngx_stream_limit_conn_module.html</p>"},{"location":"Modules-reference/stream/ngx_stream_log_module/","title":"ngx_stream_log_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>access_log</li> <li>log_format</li> <li>open_log_file_cache</li> </ul> </li> </ul> <p><code>ngx_stream_log_module</code> \u6a21\u5757\uff081.11.4\uff09\u6309\u6307\u5b9a\u7684\u683c\u5f0f\u5199\u5165\u4f1a\u8bdd\u65e5\u5fd7\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_log_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>log_format basic '$remote_addr [$time_local] '\n'$protocol $status $bytes_sent $bytes_received '\n'$session_time';\n\naccess_log /spool/logs/nginx-access.log basic buffer=32k;\n</code></pre>"},{"location":"Modules-reference/stream/ngx_stream_log_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/stream/ngx_stream_log_module/#access_log","title":"access_log","text":"- \u8bf4\u660e \u8bed\u6cd5 access_log <code>path format [buffer=size] [gzip[=level]] [flush=time] [if=condition]</code>;access_log <code>off</code>; \u9ed8\u8ba4 access_log off; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u8bbe\u7f6e\u7f13\u51b2\u65e5\u5fd7\u5199\u5165\u7684\u8def\u5f84\u3001\u683c\u5f0f\u548c\u914d\u7f6e\u3002\u53ef\u4ee5\u5728\u540c\u4e00\u7ea7\u522b\u6307\u5b9a\u591a\u4e2a\u65e5\u5fd7\u3002\u53ef\u901a\u8fc7\u5728\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e2d\u6307\u5b9a <code>syslog:</code> \u524d\u7f00\u6765\u914d\u7f6e\u8bb0\u5f55\u5230 syslog\u3002\u7279\u6b8a\u503c <code>off</code> \u53d6\u6d88\u5f53\u524d\u7ea7\u522b\u7684\u6240\u6709 <code>access_log</code> \u6307\u4ee4\u3002</p> <p>\u5982\u679c\u4f7f\u7528 <code>buffer</code> \u6216 <code>gzip</code> \u53c2\u6570\uff0c\u5219\u5c06\u7f13\u51b2 log \u7684\u5199\u5165\u3002</p> <p>\u7f13\u51b2\u533a\u5927\u5c0f\u4e0d\u5f97\u8d85\u8fc7\u78c1\u76d8\u6587\u4ef6\u7684\u539f\u5b50\u5199\u5165\u5927\u5c0f\u3002\u5bf9\u4e8e FreeBSD \u800c\u8a00\uff0c\u8fd9\u4e2a\u5927\u5c0f\u662f\u65e0\u9650\u5236\u7684\u3002</p> <p>\u542f\u7528\u7f13\u51b2\u540e\uff0c\u4ee5\u4e0b\u60c5\u51b5\u6570\u636e\u5c06\u5199\u5165\u6587\u4ef6\uff1a</p> <ul> <li>\u5982\u679c\u4e0b\u4e00\u4e2a\u65e5\u5fd7\u884c\u4e0d\u80fd\u653e\u5165\u7f13\u51b2\u533a</li> <li>\u5982\u679c\u7f13\u51b2\u7684\u6570\u636e\u65e9\u4e8e <code>flush</code> \u53c2\u6570\u6307\u5b9a\u7684\u6570\u636e</li> <li>\u5f53 worker \u8fdb\u7a0b\u91cd\u65b0\u6253\u5f00\u65e5\u5fd7\u6587\u4ef6\u6216\u6b63\u5728\u5173\u95ed\u65f6</li> </ul> <p>\u5982\u679c\u4f7f\u7528 <code>gzip</code> \u53c2\u6570\uff0c\u5c06\u5199\u5165\u6587\u4ef6\u4e4b\u524d\u5c06\u538b\u7f29\u7f13\u51b2\u7684\u6570\u636e\u3002\u538b\u7f29\u7ea7\u522b\u53ef\u4ee5\u8bbe\u7f6e\u4e3a 1\uff08\u6700\u5feb\uff0c\u538b\u7f29\u7ea7\u522b\u4f4e\uff09\u5230 9\uff08\u6700\u6162\uff0c\u538b\u7f29\u7ea7\u522b\u6700\u9ad8\uff09\u4e4b\u95f4\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f13\u51b2\u533a\u5927\u5c0f\u7b49\u4e8e 64K \u5b57\u8282\uff0c\u538b\u7f29\u7ea7\u522b\u8bbe\u7f6e\u4e3a 1\u3002\u7531\u4e8e\u6570\u636e\u662f\u4ee5\u539f\u5b50\u5757\u538b\u7f29\uff0c\u56e0\u6b64\u65e5\u5fd7\u6587\u4ef6\u53ef\u4ee5\u968f\u65f6\u901a\u8fc7 <code>zcat</code> \u89e3\u538b\u7f29\u6216\u8bfb\u53d6\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>access_log /path/to/log.gz basic gzip flush=5m;\n</code></pre> <p>\u8981\u4f7f gzip \u538b\u7f29\u8d77\u4f5c\u7528\uff0c\u5fc5\u987b\u5728\u6784\u5efa nginx \u4f7f\u7528 zlib \u5e93\u3002</p> <p>\u6587\u4ef6\u8def\u5f84\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff0c\u4f46\u662f\u8fd9\u6837\u7684\u65e5\u5fd7\u6709\u4e00\u4e9b\u7ea6\u675f\uff1a</p> <ul> <li>\u88ab worker \u8fdb\u7a0b\u4f7f\u7528\u51ed\u636e\u7684\u7528\u6237\u5e94\u5177\u6709\u5728\u5177\u6709\u6b64\u7c7b\u65e5\u5fd7\u7684\u76ee\u5f55\u4e2d\u521b\u5efa\u6587\u4ef6\u7684\u6743\u9650</li> <li>\u7f13\u51b2\u5199\u5165\u5c06\u4e0d\u8d77\u4f5c\u7528</li> <li>\u6bcf\u4e2a\u65e5\u5fd7\u5199\u5165\u90fd\u4f1a\u6253\u5f00\u548c\u5173\u95ed\u6587\u4ef6\u3002\u4f46\u662f\uff0c\u7531\u4e8e\u9891\u7e41\u4f7f\u7528\u7684\u6587\u4ef6\u7684\u63cf\u8ff0\u7b26\u53ef\u4ee5\u5b58\u50a8\u5728\u7f13\u5b58\u4e2d\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728 open_log_file_cache \u6307\u4ee4\u7684 <code>valid</code> \u53c2\u6570\u6307\u5b9a\u7684\u65f6\u95f4\u5185\u7ee7\u7eed\u5199\u5165\u65e7\u6587\u4ef6</li> </ul> <p><code>if</code> \u53c2\u6570\u542f\u7528\u6761\u4ef6\u65e5\u5fd7\u3002\u5982\u679c <code>condition</code> \u8ba1\u503c\u4e3a 0 \u6216\u7a7a\u5b57\u7b26\u4e32\uff0c\u5219\u4e0d\u4f1a\u8bb0\u5f55\u4f1a\u8bdd\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_log_module/#log_format","title":"log_format","text":"- \u8bf4\u660e \u8bed\u6cd5 log_format <code>name [escape=default\\|json\\|none] string ...</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream <p>\u6307\u5b9a\u65e5\u5fd7\u683c\u5f0f\uff0c\u4f8b\u5982\uff1a</p> <pre><code>log_format proxy '$remote_addr [$time_local] '\n'$protocol $status $bytes_sent $bytes_received '\n'$session_time \"$upstream_addr\" '\n'\"$upstream_bytes_sent\" \"$upstream_bytes_received\" \"$upstream_connect_time\"';\n</code></pre> <p><code>escape</code> \u53c2\u6570\uff081.11.8\uff09\u5141\u8bb8\u5728\u53d8\u91cf\u4e2d\u8bbe\u7f6e\u8f6c\u4e49\u7684 <code>json</code> \u6216 <code>default</code> \u5b57\u7b26\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528 <code>default</code> \u8f6c\u4e49\u3002 <code>none</code> \u53c2\u6570\uff081.13.10\uff09\u7981\u7528\u8f6c\u4e49\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_log_module/#open_log_file_cache","title":"open_log_file_cache","text":"- \u8bf4\u660e \u8bed\u6cd5 open_log_file_cache <code>max=N [inactive=time] [min_uses=N] [valid=time]</code>;open_log_file_cache <code>off</code>; \u9ed8\u8ba4 open_log_file_cache off; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u5b9a\u4e49\u4e00\u4e2a\u7f13\u5b58\uff0c\u7528\u4e8e\u5b58\u50a8\u540d\u79f0\u4e2d\u5305\u542b\u53d8\u91cf\u7684\u5e38\u7528\u65e5\u5fd7\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002\u8be5\u6307\u4ee4\u6709\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <ul> <li> <p><code>max</code></p> <p>\u8bbe\u7f6e\u7f13\u5b58\u4e2d\u7684\u6700\u5927\u63cf\u8ff0\u7b26\u6570\uff0c\u5982\u679c\u7f13\u5b58\u53d8\u6ee1\uff0c\u5219\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\uff08LRU\uff09\u7684\u63cf\u8ff0\u7b26\u5c06\u88ab\u5173\u95ed</p> </li> <li> <p><code>inactive</code></p> <p>\u5982\u679c\u5728\u6b64\u671f\u95f4\u6ca1\u6709\u53d1\u751f\u8bbf\u95ee\uff0c\u5219\u8bbe\u7f6e\u5173\u95ed\u7f13\u5b58\u63cf\u8ff0\u7b26\u7684\u65f6\u95f4\u3002\u9ed8\u8ba4\u4e3a 10 \u79d2</p> </li> <li> <p><code>min_uses</code></p> <p>\u8bbe\u7f6e\u5728 <code>inactive</code> \u53c2\u6570\u5b9a\u4e49\u7684\u65f6\u95f4\u5185\u6587\u4ef6\u4f7f\u7528\u7684\u6700\u5c0f\u6570\u91cf\uff0c\u4f7f\u63cf\u8ff0\u7b26\u5728\u7f13\u5b58\u4e2d\u4fdd\u6301\u6253\u5f00\u72b6\u6001\u3002\u9ed8\u8ba4\u4e3a 1</p> </li> <li> <p><code>valid</code></p> <p>\u8bbe\u7f6e\u68c0\u67e5\u540c\u540d\u6587\u4ef6\u662f\u5426\u4ecd\u7136\u5b58\u5728\u7684\u65f6\u95f4\u3002\u9ed8\u8ba4\u4e3a 60 \u79d2</p> </li> <li> <p><code>off</code></p> <p>\u7981\u7528\u7f13\u5b58</p> </li> </ul> <p>\u7528\u6cd5\u793a\u4f8b\uff1a</p> <pre><code>open_log_file_cache max=1000 inactive=20s valid=1m min_uses=2;\n</code></pre>"},{"location":"Modules-reference/stream/ngx_stream_log_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/stream/ngx_stream_log_module.html</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/","title":"ngx_stream_proxy_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>proxy_bind</li> <li>proxy_buffer_size</li> <li>proxy_connect_timeout</li> <li>proxy_download_rate</li> <li>proxy_next_upstream</li> <li>proxy_next_upstream_timeout</li> <li>proxy_next_upstream_tries</li> <li>proxy_pass</li> <li>proxy_protocol</li> <li>proxy_requests</li> <li>proxy_responses</li> <li>proxy_session_drop</li> <li>proxy_socket_keepalive</li> <li>proxy_ssl</li> <li>proxy_ssl_certificate</li> <li>proxy_ssl_certificate_key</li> <li>proxy_ssl_ciphers</li> <li>proxy_ssl_crl</li> <li>proxy_ssl_name</li> <li>proxy_ssl_password_file</li> <li>proxy_ssl_protocols</li> <li>proxy_ssl_server_name</li> <li>proxy_ssl_session_reuse</li> <li>proxy_ssl_trusted_certificate</li> <li>proxy_ssl_verify</li> <li>proxy_ssl_verify_depth</li> <li>proxy_timeout</li> <li>proxy_upload_rate</li> </ul> </li> </ul> <p><code>ngx_stream_proxy_module</code> \u6a21\u5757\uff081.9.0\uff09\u5141\u8bb8\u901a\u8fc7 TCP\u3001UDP\uff081.9.13\uff09\u548c UNIX \u57df\u5957\u63a5\u5b57\u4ee3\u7406\u6570\u636e\u6d41\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>server {\nlisten 127.0.0.1:12345;\nproxy_pass 127.0.0.1:8080;\n}\n\nserver {\nlisten 12345;\nproxy_connect_timeout 1s;\nproxy_timeout 1m;\nproxy_pass example.com:12345;\n}\n\nserver {\nlisten 53 udp reuseport;\nproxy_timeout 20s;\nproxy_pass dns.example.com:53;\n}\n\nserver {\nlisten [::1]:12345;\nproxy_pass unix:/tmp/stream.socket;\n}\n</code></pre>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_bind","title":"proxy_bind","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_bind <code>address [transparent]</code> | <code>off</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.9.2 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u4f7f\u5230\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u51fa\u7ad9\u8fde\u63a5\u6e90\u81ea\u6307\u5b9a\u7684\u672c\u5730 IP \u5730\u5740\uff08<code>address</code>\uff09\u3002\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.11.2\uff09\u3002\u7279\u6b8a\u503c <code>off</code> \u6307\u5b9a\u4e0d\u7ee7\u627f\u4e0a\u7ea7 <code>proxy_bind</code> \u6307\u4ee4\u914d\u7f6e\uff0c\u8fd9\u4f7f\u7cfb\u7edf\u53ef\u4ee5\u81ea\u52a8\u5206\u914d\u672c\u5730 IP \u5730\u5740\u3002</p> <p><code>transparent</code> \u53c2\u6570\uff081.11.0\uff09\u5141\u8bb8\u5230\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u51fa\u7ad9\u8fde\u63a5\u6e90\u81ea\u975e\u672c\u5730 IP \u5730\u5740\uff0c\u4f8b\u5982\uff0c\u6765\u81ea\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684\u771f\u5b9e IP \u5730\u5740\uff1a</p> <pre><code>proxy_bind $remote_addr transparent;\n</code></pre> <p>\u4e3a\u4e86\u4f7f\u6b64\u53c2\u6570\u751f\u6548\uff0c\u901a\u5e38\u5fc5\u987b\u4f7f\u7528\u8d85\u7ea7\u7528\u6237\u7279\u6743\u8fd0\u884c nginx worker \u8fdb\u7a0b\u3002\u5728 Linux\u4e0a\uff0c\u5982\u679c\u6307\u5b9a\u4e86 <code>transparent</code> \u5219\u4e0d\u9700\u8981\uff081.13.8\uff09\uff0cworker \u8fdb\u7a0b\u4ece master \u8fdb\u7a0b\u7ee7\u627f <code>CAP_NET_RAW</code> \u80fd\u529b\u3002\u8fd8\u9700\u8981\u914d\u7f6e\u5185\u6838\u8def\u7531\u8868\u4ee5\u62e6\u622a\u6765\u81ea\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u7f51\u7edc\u6d41\u91cf\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_buffer_size","title":"proxy_buffer_size","text":"- \u8bf4\u660e \u8bed\u6cd5 limit_conn_log_level <code>size</code>; \u9ed8\u8ba4 proxy_buffer_size 16k; \u4e0a\u4e0b\u6587 stream\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.9.4 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u8bfb\u53d6\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u6570\u636e\u7684\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff08<code>size</code>\uff09\u3002\u4e5f\u7528\u4e8e\u8bbe\u7f6e\u8bfb\u53d6\u5ba2\u6237\u7aef\u6570\u636e\u7684\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff08<code>size</code>\uff09\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_connect_timeout","title":"proxy_connect_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_connect_timeout <code>time</code>; \u9ed8\u8ba4 proxy_connect_timeout 60s; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u8bbe\u7f6e\u4e0e\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_download_rate","title":"proxy_download_rate","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_download_rate <code>rate</code>; \u9ed8\u8ba4 proxy_download_rate 0; \u4e0a\u4e0b\u6587 stream\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.9.3 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236\u8bfb\u53d6\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u6570\u636e\u7684\u901f\u7387\u3002<code>rate</code> \u4ee5\u6bcf\u79d2\u5b57\u8282\u6570\u6307\u5b9a\u3002\u96f6\u503c\u7981\u7528\u901f\u7387\u9650\u5236\u3002\u8be5\u9650\u5236\u662f\u9488\u5bf9\u6bcf\u4e2a\u8fde\u63a5\u8bbe\u7f6e\u7684\uff0c\u56e0\u6b64\uff0c\u5982\u679c nginx \u540c\u65f6\u6253\u5f00\u4e24\u4e2a\u4e0e\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8fde\u63a5\uff0c\u5219\u603b\u901f\u7387\u5c06\u662f\u6307\u5b9a\u9650\u5236\u901f\u7387\u7684\u4e24\u500d\u3002</p> <p>\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.17.0\uff09\u3002\u5982\u679c\u9700\u8981\u6839\u636e\u7279\u5b9a\u6761\u4ef6\u9650\u5236\u901f\u7387\uff0c\u53ef\u53c2\u8003\u4ee5\u4e0b\u914d\u7f6e\u793a\u4f8b\uff1a</p> <pre><code>map $slow $rate {\n1     4k;\n2     8k;\n}\n\nproxy_download_rate $rate;\n</code></pre>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_next_upstream","title":"proxy_next_upstream","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_next_upstream <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_next_upstream on; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u5f53\u8fde\u63a5\u65e0\u6cd5\u4e0e\u67d0\u4e2a\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u662f\u5426\u5c06\u5ba2\u6237\u7aef\u8fde\u63a5\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u3002</p> <p>\u5c06\u8fde\u63a5\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u53ef\u80fd\u4f1a\u53d7\u5230\u5c1d\u8bd5\u6b21\u6570\u548c\u65f6\u95f4\u7684\u9650\u5236\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_next_upstream_timeout","title":"proxy_next_upstream_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_next_upstream_timeout <code>time</code>; \u9ed8\u8ba4 proxy_next_upstream_timeout 0; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u8bbe\u7f6e\u5c06\u8fde\u63a5\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u8d85\u65f6\u65f6\u95f4\u3002<code>0</code> \u503c\u5173\u95ed\u6b64\u9650\u5236\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_next_upstream_tries","title":"proxy_next_upstream_tries","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_next_upstream_tries <code>number</code>; \u9ed8\u8ba4 proxy_next_upstream_tries 0; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u8bbe\u7f6e\u5c06\u8fde\u63a5\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\u7684\u5c1d\u8bd5\u6b21\u6570\u3002<code>0</code> \u503c\u5173\u95ed\u6b64\u9650\u5236\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_pass","title":"proxy_pass","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_pass <code>address</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 server <p>\u8bbe\u7f6e\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u5730\u5740\u3002\u8be5\u5730\u5740\u53ef\u4ee5\u6307\u5b9a\u4e3a\u4e00\u4e2a\u57df\u540d\u6216 IP \u5730\u5740\u4ee5\u53ca\u7aef\u53e3\uff1a</p> <pre><code>proxy_pass localhost:12345;\n</code></pre> <p>\u6216\u4f5c\u4e3a UNIX \u57df\u5957\u63a5\u5b57\u8def\u5f84\uff1a</p> <pre><code>proxy_pass unix:/tmp/stream.socket;\n</code></pre> <p>\u5982\u679c\u4e00\u4e2a\u57df\u540d\u89e3\u6790\u4e3a\u591a\u4e2a\u5730\u5740\uff0c\u5219\u6240\u6709\u8fd9\u4e9b\u5730\u5740\u90fd\u5c06\u4ee5\u8f6e\u8be2\u7684\u65b9\u5f0f\u4f7f\u7528\u3002\u53e6\u5916\uff0c\u53ef\u4ee5\u5c06\u5730\u5740\u6307\u5b9a\u4e3a\u4e00\u4e2a\u670d\u52a1\u5668\u7ec4\u3002</p> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528\u53d8\u91cf\uff081.11.3\uff09\u6307\u5b9a\u5730\u5740\uff1a</p> <pre><code>proxy_pass $upstream;\n</code></pre> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5728\u914d\u7f6e\u7684\u670d\u52a1\u5668\u7ec4\u4e2d\u67e5\u627e\u670d\u52a1\u5668\u540d\u79f0\uff0c\u5982\u679c\u627e\u4e0d\u5230\uff0c\u5219\u4f7f\u7528\u4e00\u4e2a resolver\u786e\u5b9a\u670d\u52a1\u5668\u540d\u79f0\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_protocol","title":"proxy_protocol","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_protocol <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_protocol off; \u4e0a\u4e0b\u6587 stream\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.9.2 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u4e3a\u5230\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8fde\u63a5\u542f\u7528 PROXY \u534f\u8bae\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_requests","title":"proxy_requests","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_requests <code>number</code>; \u9ed8\u8ba4 proxy_requests 0; \u4e0a\u4e0b\u6587 stream\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.15.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u4e22\u5f03\u5ba2\u6237\u7aef\u548c\u73b0\u6709 UDP \u6d41\u4f1a\u8bdd\u4e4b\u95f4\u7ed1\u5b9a\u7684\u5ba2\u6237\u7aef\u6570\u636e\u62a5\u7684\u6570\u91cf\u3002\u5728\u6536\u5230\u6307\u5b9a\u6570\u91cf\u7684\u6570\u636e\u62a5\u540e\uff0c\u6765\u81ea\u540c\u4e00\u5ba2\u6237\u7aef\u7684\u4e0b\u4e00\u4e2a\u6570\u636e\u62a5\u5c06\u542f\u52a8\u4e00\u4e2a\u65b0\u4f1a\u8bdd\u3002\u5f53\u6240\u6709\u5ba2\u6237\u7aef\u6570\u636e\u62a5\u90fd\u53d1\u9001\u5230\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u5e76\u63a5\u6536\u5230\u9884\u671f\u7684\u54cd\u5e94\u6570\u65f6\uff0c\u6216\u8005\u8fbe\u5230\u8d85\u65f6\u65f6\u95f4\u65f6\uff0c\u4f1a\u8bdd\u5c06\u7ec8\u6b62\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_responses","title":"proxy_responses","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_responses <code>number</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.9.13 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u5982\u679c\u4f7f\u7528 UDP \u534f\u8bae\uff0c\u8bbe\u7f6e\u54cd\u5e94\u5ba2\u6237\u7aef\u6570\u636e\u62a5\u4e2d\u6765\u81ea\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u6570\u636e\u62a5\u671f\u671b\u6570\u3002\u8be5\u6570\u5b57\u7528\u4f5c\u4f1a\u8bdd\u7ec8\u6b62\u7684\u63d0\u793a\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6570\u636e\u62a5\u7684\u6570\u91cf\u4e0d\u53d7\u9650\u5236\u3002</p> <p>\u5982\u679c\u6307\u5b9a\u96f6\u503c\uff0c\u5219\u4e0d\u4f1a\u54cd\u5e94\u3002\u4f46\u5982\u679c\u6536\u5230\u54cd\u5e94\u5e76\u4e14\u4f1a\u8bdd\u4ecd\u672a\u5b8c\u6210\uff0c\u5219\u8be5\u54cd\u5e94\u5c06\u88ab\u5904\u7406\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_session_drop","title":"proxy_session_drop","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_session_drop <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_session_drop off; \u4e0a\u4e0b\u6587 stream\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.15.8 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u8bbe\u7f6e\u5728\u5c06\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u4ece\u7ec4\u4e2d\u5220\u9664\u6216\u6807\u8bb0\u4e3a\u6c38\u4e45\u4e0d\u53ef\u7528\u540e\uff0c\u662f\u5426\u53ef\u4ee5\u7ec8\u6b62\u4e0e\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u6240\u6709\u4f1a\u8bdd\u3002\u5728\u91cd\u65b0\u89e3\u6790\u6216\u4f7f\u7528\u4e86 API <code>DELETE</code> \u547d\u4ee4\u65f6\uff0c\u53ef\u80fd\u4f1a\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u3002\u5982\u679c\u670d\u52a1\u5668\u5904\u4e8e\u4e0d\u5065\u5eb7\u72b6\u6001\u6216\u4f7f\u7528 API PATCH \u547d\u4ee4\u4fee\u6539\uff0c\u670d\u52a1\u5668\u53ef\u6807\u8bb0\u4e3a\u6c38\u4e45\u4e0d\u53ef\u7528\u3002\u5f53\u4e3a\u5ba2\u6237\u7aef\u6216\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u5904\u7406\u4e0b\u4e00\u4e2a\u8bfb\u53d6\u6216\u5199\u5165\u4e8b\u4ef6\u65f6\uff0c\u6bcf\u4e2a\u4f1a\u8bdd\u90fd\u4f1a\u7ec8\u6b62\u3002</p> <p>\u8be5\u6307\u4ee4\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_socket_keepalive","title":"proxy_socket_keepalive","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_socket_keepalive <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_socket_keepalive off; \u4e0a\u4e0b\u6587 stream\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.15.6 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u4e3a\u5230\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u51fa\u7ad9\u8fde\u63a5\u914d\u7f6e TCP keepalive \u884c\u4e3a\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u8bbe\u7f6e\u5f71\u54cd\u5230\u5957\u63a5\u5b57\u3002\u5982\u679c\u6307\u4ee4\u8bbe\u7f6e\u4e3a <code>on</code> \u503c\uff0c\u5219\u5c06\u4e3a\u5957\u63a5\u5b57\u6253\u5f00 <code>SO_KEEPALIVE</code> \u5957\u63a5\u5b57\u9009\u9879\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_ssl","title":"proxy_ssl","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_ssl off; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u4e3a\u5230\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8fde\u63a5\u542f\u7528 SSL/TLS \u534f\u8bae\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_ssl_certificate","title":"proxy_ssl_certificate","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_certificate <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream\u3001server <p>\u6307\u5b9a\u4e00\u4e2a PEM \u683c\u5f0f\u7684\u8bc1\u4e66\u6587\u4ef6\uff0c\u7528\u4e8e\u9a8c\u8bc1\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8eab\u4efd\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_ssl_certificate_key","title":"proxy_ssl_certificate_key","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_certificate_key <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream\u3001server <p>\u6307\u5b9a\u4e00\u4e2a PEM \u683c\u5f0f\u7684\u79c1\u94a5\u6587\u4ef6\uff0c\u7528\u4e8e\u9a8c\u8bc1\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8eab\u4efd\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_ssl_ciphers","title":"proxy_ssl_ciphers","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_ciphers <code>ciphers</code>; \u9ed8\u8ba4 proxy_ssl_ciphers DEFAULT; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u6307\u5b9a\u8fde\u63a5\u5230\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u542f\u7528\u7684\u5bc6\u7801\u7b97\u6cd5\u3002\u5bc6\u7801\u7b97\u6cd5\u9700\u8981 OpenSSL \u5e93\u652f\u6301\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 <code>openssl ciphers</code> \u547d\u4ee4\u67e5\u770b\u5b8c\u6574\u7684\u7b97\u6cd5\u652f\u6301\u5217\u8868\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_ssl_crl","title":"proxy_ssl_crl","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_crl <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream\u3001server <p>\u6307\u5b9a\u4e00\u4e2a PEM \u683c\u5f0f\u7684\u540a\u9500\u8bc1\u4e66\uff08CRL\uff09\u6587\u4ef6\uff0c\u7528\u4e8e\u9a8c\u8bc1\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8bc1\u4e66\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_ssl_name","title":"proxy_ssl_name","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_name <code>name</code>; \u9ed8\u8ba4 proxy_ssl_name \u6765\u81ea proxy_pass \u7684 host; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u5141\u8bb8\u8986\u76d6\u7528\u4e8e\u9a8c\u8bc1\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u8bc1\u4e66\u7684\u670d\u52a1\u5668\u540d\u79f0\uff0c\u5e76\u5728\u4e0e\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u65f6\u901a\u8fc7 SNI \u4f20\u9012\u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528\u53d8\u91cf\uff081.11.3\uff09\u6307\u5b9a\u670d\u52a1\u5668\u540d\u79f0\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528 proxy_pass \u5730\u5740\u7684\u4e3b\u673a\u90e8\u5206\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_ssl_password_file","title":"proxy_ssl_password_file","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_password_file <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream\u3001server <p>\u6307\u5b9a\u4e00\u4e2a\u4fdd\u5b58\u6709\u5bc6\u94a5\u5bc6\u7801\u7684\u6587\u4ef6\uff0c\u6bcf\u4e2a\u5bc6\u7801\u72ec\u5360\u4e00\u884c\u3002\u52a0\u8f7d\u5bc6\u94a5\u65f6\u4f9d\u6b21\u5c1d\u8bd5\u4f7f\u7528\u8fd9\u4e9b\u5bc6\u7801\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_ssl_protocols","title":"proxy_ssl_protocols","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_protocols <code>[SSLv2] [SSLv3] [TLSv1] [TLSv1.1] [TLSv1.2] [TLSv1.3]</code>; \u9ed8\u8ba4 proxy_ssl_protocols TLSv1 TLSv1.1 TLSv1.2; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u4e3a\u5230\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8fde\u63a5\u542f\u7528\u6307\u5b9a\u534f\u8bae\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_ssl_server_name","title":"proxy_ssl_server_name","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_server_name <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_ssl_server_name off; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u4e0e\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u542f\u7528\u6216\u7981\u7528\u901a\u8fc7 TLS \u670d\u52a1\u5668\u540d\u79f0\u6307\u793a\u6269\u5c55\uff08SNI\u3001RFC 6066\uff09\u4f20\u9012\u670d\u52a1\u5668\u540d\u79f0\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_ssl_session_reuse","title":"proxy_ssl_session_reuse","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_session_reuse <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_ssl_session_reuse on; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u5728\u4f7f\u7528\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u65f6\u662f\u5426\u53ef\u4ee5\u91cd\u7528 SSL \u4f1a\u8bdd\u3002\u5982\u679c\u65e5\u5fd7\u4e2d\u51fa\u73b0\u9519\u8bef <code>SSL3_GET_FINISHED:digest check failed</code>\uff0c\u8bf7\u5c1d\u8bd5\u7981\u7528\u4f1a\u8bdd\u91cd\u7528\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_ssl_trusted_certificate","title":"proxy_ssl_trusted_certificate","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_trusted_certificate <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream\u3001server <p>\u6307\u5b9a\u4e00\u4e2a PEM \u683c\u5f0f\u7684\u53ef\u4fe1 CA \u8bc1\u4e66\u6587\u4ef6\uff0c\u8be5\u8bc1\u4e66\u7528\u4e8e\u9a8c\u8bc1\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u8bc1\u4e66\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_ssl_verify","title":"proxy_ssl_verify","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_verify <code>on</code> | <code>off</code>; \u9ed8\u8ba4 proxy_ssl_verify off; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u542f\u7528\u6216\u7981\u7528\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u8bc1\u4e66\u9a8c\u8bc1\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_ssl_verify_depth","title":"proxy_ssl_verify_depth","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_ssl_verify_depth <code>number</code>; \u9ed8\u8ba4 proxy_ssl_verify_depth 1; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u8bbe\u7f6e\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u8bc1\u4e66\u94fe\u9a8c\u8bc1\u6df1\u5ea6\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_timeout","title":"proxy_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_timeout <code>timeout</code>; \u9ed8\u8ba4 proxy_timeout 10m; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u8bbe\u7f6e\u5ba2\u6237\u7aef\u6216\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u8fde\u63a5\u4e24\u6b21\u8fde\u7eed\u8bfb\u53d6\u6216\u5199\u5165\u64cd\u4f5c\u4e4b\u95f4\u7684\u8d85\u65f6\u65f6\u95f4\uff08<code>timeout</code>\uff09\u3002\u5982\u679c\u5728\u6b64\u65f6\u95f4\u5185\u6ca1\u6709\u6570\u636e\u4f20\u8f93\uff0c\u5219\u8fde\u63a5\u5c06\u5173\u95ed\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#proxy_upload_rate","title":"proxy_upload_rate","text":"- \u8bf4\u660e \u8bed\u6cd5 proxy_upload_rate <code>rate</code>; \u9ed8\u8ba4 proxy_upload_rate 0; \u4e0a\u4e0b\u6587 stream\u3001server \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.9.3 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u9650\u5236\u8bfb\u53d6\u5ba2\u6237\u7aef\u6570\u636e\u7684\u901f\u7387\u3002\u8be5\u901f\u7387\u4ee5\u6bcf\u79d2\u5b57\u8282\u6570\u6307\u5b9a\u3002\u96f6\u503c\u7981\u7528\u901f\u7387\u9650\u5236\u3002\u8be5\u9650\u5236\u53ea\u9488\u5bf9\u5355\u4e2a\u8fde\u63a5\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u540c\u65f6\u6253\u5f00\u4e24\u4e2a\u8fde\u63a5\uff0c\u5219\u603b\u901f\u7387\u5c06\u662f\u6307\u5b9a\u9650\u5236\u901f\u7387\u7684\u4e24\u500d\u3002</p> <p>\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u53d8\u91cf\uff081.17.0\uff09\u3002\u5982\u679c\u9700\u8981\u6839\u636e\u7279\u5b9a\u6761\u4ef6\u8bbe\u7f6e\u9650\u5236\u901f\u7387\uff0c\u53ef\u53c2\u8003\u4ee5\u4e0b\u914d\u7f6e\u793a\u4f8b\uff1a</p> <pre><code>map $slow $rate {\n1     4k;\n2     8k;\n}\n\nproxy_upload_rate $rate;\n</code></pre>"},{"location":"Modules-reference/stream/ngx_stream_proxy_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/stream/ngx_stream_proxy_module.html</p>"},{"location":"Modules-reference/stream/ngx_stream_realip_module/","title":"ngx_stream_realip_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>set_real_ip_from</li> </ul> </li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_stream_realip_module</code> \u6a21\u5757\u7528\u4e8e\u5c06\u5ba2\u6237\u7aef\u5730\u5740\u548c\u7aef\u53e3\u66f4\u6539\u4e3a PROXY \u534f\u8bae\u5934\uff081.11.4\uff09\u4e2d\u53d1\u9001\u3002\u5fc5\u987b\u5148\u5728 <code>listen</code> \u6307\u4ee4\u4e2d\u8bbe\u7f6e proxy_protocol \u53c2\u6570\u624d\u80fd\u542f\u7528 PROXY \u534f\u8bae\u3002</p> <p>\u8be5\u6a21\u5757\u4e0d\u662f\u9ed8\u8ba4\u6784\u5efa\u7684\uff0c\u60a8\u53ef\u4ee5\u5728\u6784\u5efa\u65f6\u4f7f\u7528 <code>--with-stream_realip_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_realip_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>listen 12345 proxy_protocol;\n\nset_real_ip_from  192.168.1.0/24;\nset_real_ip_from  192.168.2.1;\nset_real_ip_from  2001:0db8::/32;\n</code></pre>"},{"location":"Modules-reference/stream/ngx_stream_realip_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/stream/ngx_stream_realip_module/#set_real_ip_from","title":"set_real_ip_from","text":"- \u8bf4\u660e \u8bed\u6cd5 set_real_ip_from <code>address</code> | <code>CIDR</code> | <code>unix:</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream\u3001server <p>\u5b9a\u4e49\u5df2\u77e5\u53ef\u53d1\u9001\u6b63\u786e\u66ff\u6362\u5730\u5740\u7684\u53d7\u4fe1\u4efb\u5730\u5740\u3002\u5982\u679c\u6307\u5b9a\u4e86\u7279\u6b8a\u503c <code>unix:</code>\uff0c\u5219\u6240\u6709 UNIX \u57df\u5957\u63a5\u5b57\u5c06\u88ab\u4fe1\u4efb\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_realip_module/#_3","title":"\u5185\u5d4c\u53d8\u91cf","text":"<ul> <li> <p><code>$realip_remote_addr</code></p> <p>\u4fdd\u7559\u539f\u59cb\u5ba2\u6237\u7aef\u5730\u5740 - <code>$realip_remote_port</code></p> <p>\u4fdd\u7559\u539f\u59cb\u7684\u5ba2\u6237\u7aef\u7aef\u53e3</p> </li> </ul>"},{"location":"Modules-reference/stream/ngx_stream_realip_module/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/stream/ngx_stream_realip_module.html</p>"},{"location":"Modules-reference/stream/ngx_stream_return_module/","title":"ngx_stream_return_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>return</li> </ul> </li> </ul> <p><code>ngx_stream_return_module</code> \u6a21\u5757\uff081.11.2\uff09\u5141\u8bb8\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u6307\u5b9a\u7684\u503c\uff0c\u7136\u540e\u5173\u95ed\u8fde\u63a5\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_return_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>server {\nlisten 12345;\nreturn $time_iso8601;\n}\n</code></pre>"},{"location":"Modules-reference/stream/ngx_stream_return_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/stream/ngx_stream_return_module/#return","title":"return","text":"- \u8bf4\u660e \u8bed\u6cd5 return <code>value</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 server <p>\u6307\u5b9a\u8981\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u7684\u503c\u3002\u8be5\u503c\u53ef\u4ee5\u5305\u542b\u6587\u672c\u3001\u53d8\u91cf\u53ca\u5176\u7ec4\u5408\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_return_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/stream/ngx_stream_return_module.html</p>"},{"location":"Modules-reference/stream/ngx_stream_split_clients_module/","title":"ngx_stream_split_clients_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>split_clients</li> </ul> </li> </ul> <p><code>ngx_stream_split_clients_module</code> \u6a21\u5757\uff081.11.3\uff09\u521b\u5efa\u9002\u7528\u4e8e A/B \u6d4b\u8bd5\u7684\u53d8\u91cf\uff0c\u4e5f\u79f0\u4e3a\u62c6\u5206\u6d4b\u8bd5\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_split_clients_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>stream {\n...\nsplit_clients \"${remote_addr}AAA\" $upstream {\n0.5%                feature_test1;\n2.0%                feature_test2;\n*                   production;\n}\n\nserver {\n...\nproxy_pass $upstream;\n}\n}\n</code></pre>"},{"location":"Modules-reference/stream/ngx_stream_split_clients_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/stream/ngx_stream_split_clients_module/#split_clients","title":"split_clients","text":"- \u8bf4\u660e \u8bed\u6cd5 split_clients <code>string $variable { ... }</code> \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream <p>\u4e3a A/B \u6d4b\u8bd5\u521b\u5efa\u4e00\u4e2a\u53d8\u91cf\uff0c\u4f8b\u5982\uff1a</p> <pre><code>split_clients \"${remote_addr}AAA\" $variant {\n0.5%               .one;\n2.0%               .two;\n*                  \"\";\n}\n</code></pre> <p>\u4f7f\u7528 MurmurHash2 \u5bf9\u539f\u59cb\u5b57\u7b26\u4e32\u7684\u503c\u8fdb\u884c\u54c8\u5e0c\u5904\u7406\u3002\u5728\u7ed9\u51fa\u7684\u4f8b\u5b50\u4e2d\uff0c\u4ece 0 \u5230 21474835 \uff080.5\uff05\uff09\u7684\u54c8\u5e0c\u503c\u5bf9\u5e94\u4e8e <code>$variant</code> \u53d8\u91cf\u7684\u503c <code>.one</code>\uff0c\u4ece 21474836 \u5230 107374180 \uff082\uff05\uff09\u7684\u54c8\u5e0c\u503c\u5bf9\u5e94\u4e8e\u503c <code>.two</code>\uff0c\u54c8\u5e0c\u503c\u4ece 107374181 \u5230 4294967295 \u5bf9\u5e94\u4e8e\u503c <code>\"\"</code>\uff08\u7a7a\u5b57\u7b26\u4e32\uff09\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_split_clients_module/#_3","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/stream/ngx_stream_split_clients_module.html</p>"},{"location":"Modules-reference/stream/ngx_stream_ssl_preread_module/","title":"ngx_stream_ssl_preread_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>ssl_preread</li> </ul> </li> <li>\u5185\u5d4c\u53d8\u91cf</li> </ul> <p><code>ngx_stream_ssl_preread_module</code> \u6a21\u5757\uff081.11.5\uff09\u5141\u8bb8\u4ece ClientHello \u6d88\u606f\u4e2d\u63d0\u53d6\u4fe1\u606f\uff0c\u800c\u4e0d\u4f1a\u7ec8\u6b62 SSL/TLS\uff0c\u4f8b\u5982\u63d0\u53d6\u901a\u8fc7 SNI \u8bf7\u6c42\u7684\u670d\u52a1\u5668\u540d\u79f0\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u6784\u5efa\u6b64\u6a21\u5757\uff0c\u60a8\u53ef\u4ee5\u5728\u6784\u5efa\u65f6\u4f7f\u7528 <code>--with-stream_ssl_preread_module</code> \u914d\u7f6e\u53c2\u6570\u542f\u7528\u6b64\u6a21\u5757\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_ssl_preread_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>map $ssl_preread_server_name $name {\nbackend.example.com      backend;\ndefault                  backend2;\n}\n\nupstream backend {\nserver 192.168.0.1:12345;\nserver 192.168.0.2:12345;\n}\n\nupstream backend2 {\nserver 192.168.0.3:12345;\nserver 192.168.0.4:12345;\n}\n\nserver {\nlisten      12346;\nproxy_pass  $name;\nssl_preread on;\n}\n</code></pre>"},{"location":"Modules-reference/stream/ngx_stream_ssl_preread_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/stream/ngx_stream_ssl_preread_module/#google_perftools_profiles","title":"google_perftools_profiles","text":"- \u8bf4\u660e \u8bed\u6cd5 ssl_preread <code>on</code> | <code>off</code>; \u9ed8\u8ba4 ssl_preread off; \u4e0a\u4e0b\u6587 stream\u3001server <p>\u542f\u7528\u5728\u9884\u8bfb\u9636\u6bb5 \u4ece ClientHello \u6d88\u606f\u4e2d\u63d0\u53d6\u4fe1\u606f\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_ssl_preread_module/#_3","title":"\u5185\u5d4c\u53d8\u91cf","text":"<ul> <li> <p><code>$ssl_preread_server_name</code></p> <p>\u8fd4\u56de\u901a\u8fc7 SNI \u8bf7\u6c42\u7684\u670d\u52a1\u5668\u540d\u79f0</p> </li> </ul>"},{"location":"Modules-reference/stream/ngx_stream_ssl_preread_module/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/ngx_google_perftools_module.html</p>"},{"location":"Modules-reference/stream/ngx_stream_upstream_module/","title":"ngx_stream_upstream_module","text":"<ul> <li>\u793a\u4f8b\u914d\u7f6e</li> <li>\u6307\u4ee4<ul> <li>upstream</li> <li>server</li> <li>zone</li> <li>state</li> <li>hash</li> <li>least_conn</li> <li>least_time</li> <li>random</li> <li>resolver</li> <li>resolver_timeout</li> </ul> </li> <li>\u5185\u90e8\u53d8\u91cf</li> </ul> <p><code>ngx_stream_upstream_module</code> \u6a21\u5757\uff081.9.0\uff09\u7528\u4e8e\u5b9a\u4e49\u53ef\u4ee5\u7531 proxy_pass \u6307\u4ee4\u5f15\u7528\u7684\u670d\u52a1\u5668\u7ec4\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_upstream_module/#_1","title":"\u793a\u4f8b\u914d\u7f6e","text":"<pre><code>upstream backend {\nhash $remote_addr consistent;\n\nserver backend1.example.com:12345  weight=5;\nserver backend2.example.com:12345;\nserver unix:/tmp/backend3;\n\nserver backup1.example.com:12345   backup;\nserver backup2.example.com:12345   backup;\n}\n\nserver {\nlisten 12346;\nproxy_pass backend;\n}\n</code></pre> <p>\u62e5\u6709\u5b9a\u671f\u8fd0\u884c\u5065\u5eb7\u68c0\u67e5\u7684\u52a8\u6001\u53ef\u914d\u7f6e\u7ec4\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\uff1a</p> <pre><code>resolver 10.0.0.1;\n\nupstream dynamic {\nzone upstream_dynamic 64k;\n\nserver backend1.example.com:12345 weight=5;\nserver backend2.example.com:12345 fail_timeout=5s slow_start=30s;\nserver 192.0.2.1:12345            max_fails=3;\nserver backend3.example.com:12345 resolve;\nserver backend4.example.com       service=http resolve;\n\nserver backup1.example.com:12345  backup;\nserver backup2.example.com:12345  backup;\n}\n\nserver {\nlisten 12346;\nproxy_pass dynamic;\nhealth_check;\n}\n</code></pre> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_upstream_module/#_2","title":"\u6307\u4ee4","text":""},{"location":"Modules-reference/stream/ngx_stream_upstream_module/#upstream","title":"upstream","text":"- \u8bf4\u660e \u8bed\u6cd5 upstream <code>name { ... }</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 stream <p>\u5b9a\u4e49\u4e00\u7ec4\u670d\u52a1\u5668\u3002\u670d\u52a1\u5668\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u7aef\u53e3\u4e0a\u76d1\u542c\u3002\u6b64\u5916\uff0c\u53ef\u4ee5\u5c06\u76d1\u542c TCP \u548c UNIX \u57df\u5957\u63a5\u5b57\u7684\u670d\u52a1\u5668\u6df7\u5408\u4f7f\u7528\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>upstream backend {\nserver backend1.example.com:12345 weight=5;\nserver 127.0.0.1:12345            max_fails=3 fail_timeout=30s;\nserver unix:/tmp/backend2;\nserver backend3.example.com:12345 resolve;\n\nserver backup1.example.com:12345  backup;\n}\n</code></pre> <p>\u9ed8\u8ba4\u4f7f\u7528\u52a0\u6743\u8f6e\u8be2\u5747\u8861\u7b97\u6cd5\u5728\u670d\u52a1\u5668\u95f4\u5206\u914d\u8fde\u63a5\u3002\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u6bcf 7 \u4e2a\u8fde\u63a5\u5c06\u5982\u4e0b\u5206\u914d\uff1a5 \u4e2a\u8fde\u63a5\u8f6c\u5230 <code>backend1.example.com:12345</code>\uff0c\u4e00\u4e2a\u8fde\u63a5\u5230\u7b2c\u4e8c\u4e2a\u548c\u7b2c\u4e09\u4e2a\u670d\u52a1\u5668\u3002\u5982\u679c\u5728\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u671f\u95f4\u53d1\u751f\u9519\u8bef\uff0c\u5219\u8fde\u63a5\u5c06\u88ab\u4f20\u9012\u5230\u4e0b\u4e00\u4e2a\u670d\u52a1\u5668\uff0c\u4f9d\u6b64\u7c7b\u63a8\uff0c\u76f4\u5230\u5c1d\u8bd5\u5b8c\u6240\u6709\u6b63\u5e38\u8fd0\u884c\u7684\u670d\u52a1\u5668\u4e3a\u6b62\u3002\u5982\u679c\u4e0e\u6240\u6709\u670d\u52a1\u5668\u7684\u901a\u4fe1\u90fd\u5931\u8d25\uff0c\u5219\u8fde\u63a5\u5c06\u5173\u95ed\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_upstream_module/#server","title":"server","text":"- \u8bf4\u660e \u8bed\u6cd5 server <code>address [parameters]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream <p>\u5b9a\u4e49\u670d\u52a1\u5668\u7684\u5730\u5740\uff08<code>address</code>\uff09\u548c\u5176\u4ed6\u53c2\u6570\u3002\u8be5\u5730\u5740\u53ef\u4ee5\u6307\u5b9a\u4e3a\u5e26\u6709\u7aef\u53e3\u7684\u57df\u540d\u6216 IP \u5730\u5740\uff0c\u4e5f\u53ef\u4ee5\u6307\u5b9a\u524d\u7f00\u4e3a <code>unix</code> \u7684 UNIX \u57df\u5957\u63a5\u5b57\u8def\u5f84\u3002\u89e3\u6790\u4e3a\u591a\u4e2a IP \u5730\u5740\u7684\u57df\u540d\u4e00\u6b21\u5b9a\u4e49\u4e86\u591a\u4e2a\u670d\u52a1\u5668\u3002</p> <p>\u53ef\u4ee5\u5b9a\u4e49\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <ul> <li> <p><code>weight=number</code></p> <p>\u8bbe\u7f6e\u670d\u52a1\u5668\u7684\u6743\u91cd\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e3a 1\u3002</p> </li> <li> <p><code>max_conns=number</code></p> <p>\u9650\u5236\u5230\u88ab\u4ee3\u7406\u670d\u52a1\u5668\u7684\u6700\u5927\u540c\u65f6\u8fde\u63a5\u6570\uff081.11.5\uff09\u3002\u9ed8\u8ba4\u503c\u4e3a\u96f6\uff0c\u8868\u793a\u6ca1\u6709\u9650\u5236\u3002\u5982\u679c\u670d\u52a1\u5668\u7ec4\u672a\u9a7b\u7559\u5728\u5171\u4eab\u5185\u5b58\u4e2d\uff0c\u5219\u6b64\u9650\u5236\u5728\u6bcf\u4e2a worker \u8fdb\u7a0b\u4e2d\u5747\u6709\u6548\u3002</p> <p>\u5728 1.11.5 \u7248\u672c\u4e4b\u524d\uff0c\u6b64\u53c2\u6570\u4f5c\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u3002</p> </li> <li> <p><code>max_fails=number</code></p> <p>\u8bbe\u7f6e\u5728 <code>fail_timeout</code> \u53c2\u6570\u8bbe\u7f6e\u7684\u65f6\u95f4\u5185\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u7684\u5931\u8d25\u5c1d\u8bd5\u6b21\u6570\uff0c\u4ee5\u4fbf\u8ba4\u5b9a\u670d\u52a1\u5668\u5728 <code>fail_timeout</code> \u53c2\u6570\u8bbe\u7f6e\u7684\u65f6\u95f4\u5185\u4e0d\u53ef\u7528\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5931\u8d25\u5c1d\u8bd5\u7684\u6b21\u6570\u8bbe\u7f6e\u4e3a 1\u3002\u96f6\u503c\u5c06\u7981\u7528\u5c1d\u8bd5\u8bb0\u5f55\u3002\u5728\u8fd9\u91cc\uff0c\u5f53\u4e0e\u670d\u52a1\u5668\u6b63\u5728\u5efa\u7acb\u8fde\u63a5\u4e2d\uff0c\u5931\u8d25\u5c1d\u8bd5\u5c06\u662f\u4e00\u4e2a\u9519\u8bef\u6216\u8d85\u65f6\u3002</p> </li> <li> <p><code>fail_timeout=time</code></p> <p>\u8bbe\u7f6e</p> <ul> <li>\u5728\u65f6\u95f4\u8303\u56f4\u5185\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u7684\u5931\u8d25\u5c1d\u8bd5\u8fbe\u5230\u6307\u5b9a\u6b21\u6570\uff0c\u5e94\u5c06\u670d\u52a1\u5668\u89c6\u4e3a\u4e0d\u53ef\u7528</li> <li>\u670d\u52a1\u5668\u88ab\u89c6\u4e3a\u4e0d\u53ef\u7528\u7684\u65f6\u957f</li> </ul> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8be5\u53c2\u6570\u8bbe\u7f6e\u4e3a 10 \u79d2\u3002</p> </li> <li> <p><code>backup</code></p> <p>\u5c06\u670d\u52a1\u5668\u6807\u8bb0\u4e3a\u5907\u7528\u670d\u52a1\u5668\u3002\u5f53\u4e3b\u670d\u52a1\u5668\u4e0d\u53ef\u7528\u65f6\uff0c\u8fde\u63a5\u5c06\u4f20\u9012\u5230\u5907\u7528\u670d\u52a1\u5668\u3002</p> <p>\u8be5\u53c2\u6570\u4e0d\u80fd\u4e0e hash \u548c random \u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u4e00\u8d77\u4f7f\u7528\u3002</p> </li> <li> <p><code>down</code></p> <p>\u5c06\u670d\u52a1\u5668\u6807\u8bb0\u4e3a\u6c38\u4e45\u4e0d\u53ef\u7528\u3002</p> </li> </ul> <p>\u6b64\u5916\uff0c\u4ee5\u4e0b\u53c2\u6570\u4f5c\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u63d0\u4f9b\uff1a</p> <ul> <li> <p><code>resolve</code></p> <p>\u76d1\u89c6\u4e0e\u670d\u52a1\u5668\u57df\u540d\u76f8\u5bf9\u5e94\u7684 IP \u5730\u5740\u7684\u66f4\u6539\uff0c\u5e76\u81ea\u52a8\u4fee\u6539 upstream \u914d\u7f6e\uff0c\u800c\u65e0\u9700\u91cd\u65b0\u542f\u52a8 nginx\u3002\u670d\u52a1\u5668\u7ec4\u5fc5\u987b\u9a7b\u7559\u5728\u5171\u4eab\u5185\u5b58\u4e2d\u3002</p> <p>\u4e3a\u4e86\u4f7f\u6b64\u53c2\u6570\u751f\u6548\uff0c\u5fc5\u987b\u5728 stream \u5757\u6216\u76f8\u5e94\u7684 upstream \u5757\u4e2d\u6307\u5b9a <code>resolver</code> \u6307\u4ee4\u3002</p> </li> <li> <p><code>service=name</code></p> <p>\u542f\u7528 DNS SRV \u8bb0\u5f55\u7684\u89e3\u6790\u5e76\u8bbe\u7f6e\u670d\u52a1\u540d\u79f0\uff081.9.13\uff09\u3002\u4e3a\u4e86\u4f7f\u6b64\u53c2\u6570\u751f\u6548\uff0c\u5fc5\u987b\u4e3a\u670d\u52a1\u5668\u6307\u5b9a resolve \u53c2\u6570\uff0c\u5e76\u6307\u5b9a\u4e0d\u5e26\u7aef\u53e3\u53f7\u7684\u4e3b\u673a\u540d\u3002</p> <p>\u5982\u679c\u670d\u52a1\u540d\u79f0\u4e0d\u5305\u542b\u70b9\uff08<code>.</code>\uff09\uff0c\u5219\u6784\u9020\u7b26\u5408 RFC \u7684\u540d\u79f0\uff0c\u5e76\u5c06 TCP \u534f\u8bae\u6dfb\u52a0\u5230\u670d\u52a1\u524d\u7f00\u3002\u4f8b\u5982\uff0c\u8981\u67e5\u627e <code>_http._tcp.backend.example.com</code> SRV \u8bb0\u5f55\uff0c\u5fc5\u987b\u6307\u5b9a\u6307\u4ee4\uff1a</p> <p>\u5982\u679c\u670d\u52a1\u540d\u79f0\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u70b9\uff08<code>.</code>\uff09\uff0c\u5219\u901a\u8fc7\u5c06\u670d\u52a1\u524d\u7f00\u548c\u670d\u52a1\u5668\u540d\u79f0\u7ed3\u5408\u5728\u4e00\u8d77\u6765\u6784\u9020\u540d\u79f0\u3002\u4f8b\u5982\uff0c\u8981\u67e5\u627e <code>_http._tcp.backend.example.com</code> \u548c <code>server1.backend.example.com</code> SRV \u8bb0\u5f55\uff0c\u5fc5\u987b\u6307\u5b9a\u6307\u4ee4\uff1a</p> <pre><code>server backend.example.com service=_http._tcp resolve;\nserver example.com service=server1.backend resolve;\n</code></pre> <p>\u6700\u9ad8\u4f18\u5148\u7ea7\u7684 SRV \u8bb0\u5f55\uff08\u5177\u6709\u76f8\u540c\u7684\u6700\u4f4e\u4f18\u5148\u7ea7\u503c\u7684\u8bb0\u5f55\uff09\u88ab\u89e3\u6790\u4e3a\u4e3b\u670d\u52a1\u5668\uff0c\u5176\u4f59\u7684 SRV \u8bb0\u5f55\u88ab\u89e3\u6790\u4e3a\u5907\u7528\u670d\u52a1\u5668\u3002\u5982\u679c\u4e3a\u670d\u52a1\u5668\u6307\u5b9a\u4e86 backup \u53c2\u6570\uff0c\u5219\u5c06\u9ad8\u4f18\u5148\u7ea7 SRV \u8bb0\u5f55\u89e3\u6790\u4e3a\u5907\u7528\u670d\u52a1\u5668\uff0c\u5176\u4f59\u7684 SRV \u8bb0\u5f55\u5c06\u88ab\u5ffd\u7565\u3002</p> </li> <li> <p><code>slow_start=time</code></p> <p>\u8bbe\u7f6e\u5f53\u670d\u52a1\u5668\u4ece\u975e\u5065\u5eb7\u72b6\u6001\u8f6c\u4e3a\u5065\u5eb7\u72b6\u6001\u6216\u4e00\u6bb5\u65f6\u95f4\u4e0d\u53ef\u7528\u540e\u8f6c\u4e3a\u53ef\u7528\u72b6\u6001\uff0c\u670d\u52a1\u5668\u5c06\u5176\u6743\u91cd\u4ece 0 \u6062\u590d\u5230\u539f\u503c\u7684\u65f6\u95f4\uff08<code>time</code>\uff09\u3002\u9ed8\u8ba4\u503c\u4e3a\u96f6\uff0c\u5373\u7981\u7528\u6b64\u529f\u80fd\u3002</p> <p>\u8be5\u53c2\u6570\u4e0d\u80fd\u4e0e hash \u548c random \u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u4e00\u8d77\u4f7f\u7528\u3002</p> </li> </ul> <p>\u5982\u679c\u7ec4\u4e2d\u53ea\u6709\u4e00\u53f0\u670d\u52a1\u5668\uff0c\u5219\u5c06\u5ffd\u7565 <code>max_fails</code>\u3001<code>fail_timeout</code> \u548c <code>slow_start</code> \u53c2\u6570\uff0c\u8fd9\u6837\u7684\u670d\u52a1\u5668\u5c06\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u89c6\u4e3a\u4e0d\u53ef\u7528\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_upstream_module/#zone","title":"zone","text":"- \u8bf4\u660e \u8bed\u6cd5 zone <code>name [size]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream <p>\u5b9a\u4e49\u5171\u4eab\u5185\u5b58\u533a\u57df\u7684\u540d\u79f0\uff08<code>name</code>\uff09\u548c\u5927\u5c0f\uff08<code>size</code>\uff09\uff0c\u4ee5\u5b58\u50a8 worker \u8fdb\u7a0b\u4e4b\u95f4\u5171\u4eab\u7684\u7ec4\u914d\u7f6e\u548c\u8fd0\u884c\u65f6\u72b6\u6001\u3002\u591a\u4e2a\u7ec4\u53ef\u5171\u4eab\u540c\u4e00\u533a\u57df\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4ec5\u6307\u5b9a\u4e00\u6b21\u5927\u5c0f\u5c31\u8db3\u591f\u4e86\u3002</p> <p>\u53e6\u5916\uff0c\u5728\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u4e2d\uff0c\u6b64\u7c7b\u7ec4\u5141\u8bb8\u66f4\u6539\u7ec4\u6210\u5458\u8eab\u4efd\u6216\u4fee\u6539\u7279\u5b9a\u670d\u52a1\u5668\u7684\u8bbe\u7f6e\uff0c\u800c\u65e0\u9700\u91cd\u65b0\u542f\u52a8 nginx\u3002\u53ef\u901a\u8fc7 API \u6a21\u5757\uff081.13.3\uff09\u8bbf\u95ee\u8be5\u914d\u7f6e\u3002</p> <p>\u5728 1.13.3 \u7248\u672c\u4e4b\u524d\uff0c\u53ea\u80fd\u8bbf\u95ee\u7279\u6b8a\u7684 location \u6765\u901a\u8fc7 upstream_conf \u5904\u7406\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_upstream_module/#state","title":"state","text":"- \u8bf4\u660e \u8bed\u6cd5 state <code>file</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.9.7 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u4e00\u4e2a\u6587\u4ef6\u7528\u4e8e\u4fdd\u5b58\u52a8\u6001\u53ef\u914d\u7f6e\u7ec4\u7684\u72b6\u6001\u3002</p> <p>\u793a\u4f8b\uff1a</p> <pre><code>state /var/lib/nginx/state/servers.conf; # path for Linux\nstate /var/db/nginx/state/servers.conf;  # path for FreeBSD\n</code></pre> <p>\u5f53\u524d\u72b6\u6001\u4ec5\u9650\u4e8e\u5e26\u6709\u53c2\u6570\u7684\u670d\u52a1\u5668\u5217\u8868\u3002\u89e3\u6790\u914d\u7f6e\u65f6\u4f1a\u8bfb\u53d6\u8be5\u6587\u4ef6\uff0c\u5e76\u4e14\u6bcf\u6b21\u66f4\u6539 upstream \u914d\u7f6e\u65f6\u90fd\u4f1a\u66f4\u65b0\u8be5\u6587\u4ef6\u3002\u5e94\u907f\u514d\u76f4\u63a5\u66f4\u6539\u6587\u4ef6\u5185\u5bb9\u3002\u8be5\u6307\u4ee4\u4e0d\u80fd\u4e0e server \u6307\u4ee4\u4e00\u8d77\u4f7f\u7528\u3002</p> <p>\u5728\u914d\u7f6e\u91cd\u65b0\u52a0\u8f7d\u6216\u4e8c\u8fdb\u5236\u5347\u7ea7\u671f\u95f4\u6240\u505a\u7684\u66f4\u6539\u53ef\u80fd\u4f1a\u4e22\u5931\u3002</p> <p>\u8be5\u6307\u4ee4\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_upstream_module/#hash","title":"hash","text":"- \u8bf4\u660e \u8bed\u6cd5 hash <code>key [consistent]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream <p>\u6307\u5b9a\u670d\u52a1\u5668\u7ec4\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\uff0c\u5728\u8be5\u670d\u52a1\u5668\u7ec4\u4e2d\uff0c\u5ba2\u6237\u7aef\u2014\u2014\u670d\u52a1\u5668\u7684\u6620\u5c04\u57fa\u4e8e\u54c8\u5e0c\u952e\u503c\uff08key/value\uff09\u3002key \u53ef\u4ee5\u5305\u542b\u6587\u672c\u3001\u53d8\u91cf\u53ca\u5176\u7ec4\u5408\uff081.11.2\uff09\u3002 \u7528\u6cd5\u793a\u4f8b\uff1a</p> <pre><code>hash $remote_addr;\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u4ece\u7ec4\u4e2d\u6dfb\u52a0\u6216\u5220\u9664\u670d\u52a1\u5668\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5927\u91cf key \u91cd\u65b0\u6620\u5c04\u5230\u5176\u4ed6\u670d\u52a1\u5668\u3002\u8be5\u65b9\u6cd5\u4e0e Cache::Memcached Perl \u5e93\u517c\u5bb9\u3002</p> <p>\u5982\u679c\u6307\u5b9a\u4e86 <code>consistent</code> \u53c2\u6570\uff0c\u5219\u5c06\u4f7f\u7528 ketama \u4e00\u81f4\u6027\u54c8\u5e0c\u7b97\u6cd5\u3002\u8be5\u65b9\u6cd5\u53ef\u786e\u4fdd\u5728\u5c06\u670d\u52a1\u5668\u6dfb\u52a0\u5230\u7ec4\u4e2d\u6216\u4ece\u7ec4\u4e2d\u5220\u9664\u670d\u52a1\u5668\u65f6\uff0c\u53ea\u6709\u5f88\u5c11\u7684 key \u88ab\u91cd\u65b0\u6620\u5c04\u5230\u4e0d\u540c\u7684\u670d\u52a1\u5668\u3002\u8fd9\u6709\u52a9\u4e8e\u7f13\u5b58\u670d\u52a1\u5668\u5b9e\u73b0\u66f4\u9ad8\u7684\u7f13\u5b58\u547d\u4e2d\u7387\u3002\u8be5\u65b9\u6cd5\u4e0e <code>ketama_points</code> \u53c2\u6570\u8bbe\u7f6e\u4e3a 160 \u7684 Cache::Memcached::Fast Perl \u5e93\u517c\u5bb9\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_upstream_module/#least_conn","title":"least_conn","text":"- \u8bf4\u660e \u8bed\u6cd5 least_conn; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream <p>\u6307\u5b9a\u7ec4\u4f7f\u7528\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\uff0c\u5176\u5c06\u8fde\u63a5\u4f20\u9012\u5230\u6d3b\u52a8\u8fde\u63a5\u6570\u6700\u5c11\u7684\u670d\u52a1\u5668\uff0c\u540c\u65f6\u8981\u8003\u8651\u670d\u52a1\u5668\u7684\u6743\u91cd\u3002\u5982\u679c\u6709\u591a\u4e2a\u8fd9\u6837\u7684\u670d\u52a1\u5668\uff0c\u5219\u4f9d\u6b21\u4f7f\u7528\u52a0\u6743\u8f6e\u8be2\u5747\u8861\u7b97\u6cd5\u8fdb\u884c\u5c1d\u8bd5\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_upstream_module/#least_time","title":"least_time","text":"- \u8bf4\u660e \u8bed\u6cd5 least_time <code>connect</code> | <code>first_byte</code> | <code>last_byte</code> <code>[inflight]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream <p>\u6307\u5b9a\u7ec4\u5e94\u4f7f\u7528\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\uff0c\u5176\u5c06\u8fde\u63a5\u4f20\u9012\u5230\u5e73\u5747\u65f6\u95f4\u6700\u5c11\u4e14\u6d3b\u52a8\u8fde\u63a5\u6570\u6700\u5c11\u7684\u670d\u52a1\u5668\uff0c\u540c\u65f6\u8003\u8651\u670d\u52a1\u5668\u7684\u6743\u91cd\u3002\u5982\u679c\u6709\u591a\u4e2a\u8fd9\u6837\u7684\u670d\u52a1\u5668\uff0c\u5219\u4f9d\u6b21\u4f7f\u7528\u52a0\u6743\u8f6e\u8be2\u5747\u8861\u7b97\u6cd5\u8fdb\u884c\u5c1d\u8bd5\u3002</p> <p>\u5982\u679c\u6307\u5b9a\u4e86 <code>connect</code> \u53c2\u6570\uff0c\u5219\u4f7f\u7528\u8fde\u63a5\u5230 upstream \u670d\u52a1\u5668\u7684\u65f6\u95f4\u3002\u5982\u679c\u6307\u5b9a\u4e86 <code>first_byte</code> \u53d8\u91cf\uff0c\u5219\u4f7f\u7528\u63a5\u6536\u6570\u636e\u7684\u9996\u5b57\u8282\u7684\u65f6\u95f4\u3002\u5982\u679c\u6307\u5b9a\u4e86 <code>last_byte</code>\uff0c\u5219\u4f7f\u7528\u63a5\u6536\u6570\u636e\u5c3e\u5b57\u8282\u7684\u65f6\u95f4\u3002\u5982\u679c\u6307\u5b9a\u4e86 <code>inflight</code> \u53c2\u6570\uff081.11.6\uff09\uff0c\u8fd8\u5c06\u8003\u8651\u4e0d\u5b8c\u6574\u8fde\u63a5\u3002</p> <p>\u5728 1.11.6 \u7248\u672c\u4e4b\u524d\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u8003\u8651\u4e0d\u5b8c\u6574\u7684\u8fde\u63a5\u3002</p> <p>\u8be5\u6307\u4ee4\u4f5c\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_upstream_module/#random","title":"random","text":"- \u8bf4\u660e \u8bed\u6cd5 random <code>[two [method]]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.15.1 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u6307\u5b9a\u7ec4\u5e94\u4f7f\u7528\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\uff0c\u5176\u5c06\u8fde\u63a5\u4f20\u9012\u5230\u968f\u673a\u9009\u62e9\u7684\u670d\u52a1\u5668\uff0c\u540c\u65f6\u8981\u8003\u8651\u670d\u52a1\u5668\u7684\u6743\u91cd\u3002</p> <p>\u53ef\u9009\u7684\u4e24\u4e2a\u53c2\u6570\u6307\u793a nginx \u968f\u673a\u9009\u62e9\u4e24\u4e2a\u670d\u52a1\u5668\uff0c\u7136\u540e\u4f7f\u7528\u6307\u5b9a\u7684\u7b97\u6cd5\uff08<code>method</code>\uff09\u9009\u62e9\u4e00\u4e2a\u670d\u52a1\u5668\u3002\u9ed8\u8ba4\u65b9\u6cd5\u662f <code>minimum_conn</code>\uff0c\u5b83\u5c06\u8fde\u63a5\u4f20\u9012\u5230\u6d3b\u52a8\u8fde\u63a5\u6570\u6700\u5c11\u7684\u670d\u52a1\u5668\u3002</p> <p><code>minimum_time</code> \u7b97\u6cd5\u5c06\u8fde\u63a5\u4f20\u9012\u5230\u5e73\u5747\u65f6\u95f4\u6700\u5c11\u4e14\u6d3b\u52a8\u8fde\u63a5\u6570\u6700\u5c11\u7684\u670d\u52a1\u5668\u3002\u5982\u679c\u6307\u5b9a\u4e86 <code>least_time=connect</code> \u53c2\u6570\uff0c\u5219\u4f7f\u7528\u8fde\u63a5\u5230 upstream \u670d\u52a1\u5668\u7684\u65f6\u95f4\u3002\u5982\u679c\u6307\u5b9a\u4e86 <code>least_time=first_byte</code> \u53c2\u6570\uff0c\u5219\u4f7f\u7528\u63a5\u6536\u6570\u636e\u7684\u9996\u5b57\u8282\u7684\u65f6\u95f4\u3002\u5982\u679c\u6307\u5b9a\u4e86 <code>least_time=last_byte</code>\uff0c\u5982\u679c\u6307\u5b9a\u4e86 <code>last_byte</code>\uff0c\u5219\u4f7f\u7528\u63a5\u6536\u6570\u636e\u5c3e\u5b57\u8282\u7684\u65f6\u95f4\u3002</p> <p><code>least_time</code> \u7b97\u6cd5\u662f\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_upstream_module/#resolver","title":"resolver","text":"- \u8bf4\u660e \u8bed\u6cd5 resolver <code>address ... [valid=time] [ipv6=on\\|off] [status_zone=zone]</code>; \u9ed8\u8ba4 \u2014\u2014 \u4e0a\u4e0b\u6587 upstream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.17.5 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u914d\u7f6e\u7528\u4e8e\u5c06 upstream \u670d\u52a1\u5668\u7684\u540d\u79f0\u89e3\u6790\u4e3a\u5730\u5740\u7684\u540d\u79f0\u670d\u52a1\u5668\uff0c\u4f8b\u5982\uff1a</p> <pre><code>resolver 127.0.0.1 [::1]:5353;\n</code></pre> <p>\u53ef\u4ee5\u5c06\u5730\u5740\u6307\u5b9a\u4e3a\u57df\u540d\u6216 IP \u5730\u5740\uff0c\u914d\u7f6e\u4e00\u4e2a\u53ef\u9009\u7aef\u53e3\u3002\u5982\u679c\u672a\u6307\u5b9a\u7aef\u53e3\uff0c\u5219\u4f7f\u7528 53 \u7aef\u53e3\u3002\u4ee5\u8f6e\u8be2\u7b97\u6cd5\u67e5\u627e\u540d\u79f0\u670d\u52a1\u5668\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnginx \u5728\u89e3\u6790\u65f6\u5c06\u540c\u65f6\u67e5\u627e IPv4 \u548c IPv6 \u5730\u5740\u3002\u5982\u679c\u4e0d\u9700\u8981\u67e5\u627e IPv6 \u5730\u5740\uff0c\u5219\u53ef\u4ee5\u6307\u5b9a <code>ipv6=off</code> \u53c2\u6570\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cnginx \u4f7f\u7528\u54cd\u5e94\u7684 TTL \u503c\u7f13\u5b58\u56de\u590d\u3002\u53ef\u9009\u7684 <code>valid</code> \u53c2\u6570\u8986\u76d6\u9ed8\u8ba4\u884c\u4e3a\uff1a</p> <pre><code>resolver 127.0.0.1 [::1]:5353 valid=30s;\n</code></pre> <p>\u4e3a\u9632\u6b62 DNS \u6b3a\u9a97\uff0c\u5efa\u8bae\u5728\u4e00\u4e2a\u53d7\u5230\u4fdd\u62a4\u7684\u53ef\u4fe1\u672c\u5730\u7f51\u7edc\u4e2d\u914d\u7f6e DNS \u670d\u52a1\u5668\u3002</p> <p>\u53ef\u9009\u7684 <code>status_zone</code> \u53c2\u6570\u542f\u7528\u5bf9\u6307\u5b9a\u533a\u57df\u4e2d\u8bf7\u6c42\u548c\u54cd\u5e94\u7684 DNS \u670d\u52a1\u5668\u7edf\u8ba1\u4fe1\u606f\u7684\u6536\u96c6\u3002</p> <p>\u8be5\u6307\u4ee4\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u3002</p>"},{"location":"Modules-reference/stream/ngx_stream_upstream_module/#resolver_timeout","title":"resolver_timeout","text":"- \u8bf4\u660e \u8bed\u6cd5 resolver_timeout <code>time</code>; \u9ed8\u8ba4 resolver_timeout 30s; \u4e0a\u4e0b\u6587 upstream \u63d0\u793a \u8be5\u6307\u4ee4\u5728 1.17.5 \u7248\u672c\u4e2d\u51fa\u73b0 <p>\u4e3a\u540d\u79f0\u89e3\u6790\u8bbe\u7f6e\u4e00\u4e2a\u8d85\u65f6\u65f6\u95f4\uff0c\u4f8b\u5982\uff1a</p> <pre><code>resolver_timeout 5s;\n</code></pre> <p>\u8be5\u6307\u4ee4\u4e3a\u5546\u4e1a\u8ba2\u9605\u90e8\u5206\u3002</p> <p></p>"},{"location":"Modules-reference/stream/ngx_stream_upstream_module/#_3","title":"\u5185\u90e8\u53d8\u91cf","text":"<p><code>ngx_stream_upstream_module</code> \u6a21\u5757\u652f\u6301\u4ee5\u4e0b\u5185\u90e8\u53d8\u91cf\uff1a</p> <ul> <li> <p><code>$upstream_addr</code></p> <p>\u4fdd\u7559 IP \u5730\u5740\u548c\u7aef\u53e3\u6216 upstream \u670d\u52a1\u5668\u7684 UNIX \u57df\u5957\u63a5\u5b57\uff081.11.4\uff09\u8def\u5f84\u3002\u5982\u679c\u5728\u4ee3\u7406\u8fc7\u7a0b\u4e2d\u8054\u7cfb\u4e86\u591a\u4e2a\u670d\u52a1\u5668\uff0c\u5219\u5b83\u4eec\u7684\u5730\u5740\u7528\u9017\u53f7\u5206\u9694\uff0c\u4f8b\u5982 <code>192.168.1.1:12345, 192.168.1.2:12345, unix:/tmp/sock</code>\u3002\u5982\u679c\u65e0\u6cd5\u9009\u62e9\u670d\u52a1\u5668\uff0c\u5219\u8be5\u53d8\u91cf\u5c06\u4fdd\u7559\u670d\u52a1\u5668\u7ec4\u7684\u540d\u79f0\u3002</p> </li> <li> <p><code>$upstream_bytes_received</code></p> <p>\u4ece upstream \u670d\u52a1\u5668\u6536\u5230\u7684\u5b57\u8282\u6570\uff081.11.4\uff09\u3002\u6765\u81ea\u591a\u4e2a\u8fde\u63a5\u7684\u503c\u4f7f\u7528\u9017\u53f7\u5206\u9694\uff0c\u53c2\u8003 <code>$upstream_addr</code> \u53d8\u91cf\u4e2d\u7684\u5730\u5740\u3002</p> </li> <li> <p><code>$upstream_bytes_sent</code></p> <p>\u53d1\u9001\u5230 upstream \u670d\u52a1\u5668\u7684\u5b57\u8282\u6570\uff081.11.4\uff09\u3002\u6765\u81ea\u591a\u4e2a\u8fde\u63a5\u7684\u503c\u4f7f\u7528\u9017\u53f7\u5206\u9694\uff0c\u53c2\u8003 <code>$upstream_addr</code> \u53d8\u91cf\u4e2d\u7684\u5730\u5740\u3002</p> </li> <li> <p><code>$upstream_connect_time</code></p> <p>\u8fde\u63a5 upstream \u670d\u52a1\u5668\u7684\u65f6\u95f4\uff081.11.4\uff09\uff0c\u65f6\u95f4\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002\u591a\u4e2a\u8fde\u63a5\u7684\u65f6\u95f4\u7528\u9017\u53f7\u5206\u9694\uff0c\u53c2\u8003 <code>$upstream_addr</code> \u53d8\u91cf\u4e2d\u7684\u5730\u5740\u3002</p> </li> <li> <p><code>$upstream_first_byte_time</code></p> <p>\u63a5\u6536\u6570\u636e\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u65f6\u95f4\uff081.11.4\uff09\uff0c\u65f6\u95f4\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff0c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u3002\u591a\u4e2a\u8fde\u63a5\u7684\u65f6\u95f4\u7528\u9017\u53f7\u5206\u9694\uff0c\u53c2\u8003 <code>$upstream_addr</code> \u53d8\u91cf\u4e2d\u7684\u5730\u5740\u3002</p> </li> <li> <p><code>$upstream_session_time</code></p> <p>\u4f1a\u8bdd\u6301\u7eed\u65f6\u95f4\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\uff081.11.4\uff09\u3002\u591a\u4e2a\u8fde\u63a5\u7684\u65f6\u95f4\u7528\u9017\u53f7\u5206\u9694\uff0c\u53c2\u8003 <code>$upstream_addr</code> \u53d8\u91cf\u4e2d\u7684\u5730\u5740\u3002</p> </li> </ul>"},{"location":"Modules-reference/stream/ngx_stream_upstream_module/#_4","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/docs/stream/ngx_stream_upstream_module.html</p>"},{"location":"Others/linux%E5%8C%85/","title":"Linux\u5305","text":""},{"location":"Others/linux%E5%8C%85/#nginxlinux","title":"nginx\uff1aLinux \u8f6f\u4ef6\u5305","text":"<p>\u76ee\u524d\uff0cnginx \u8f6f\u4ef6\u652f\u6301\u4ee5\u4e0b Linux \u53d1\u884c\u7248\uff1a</p> <p>RHEL/CentOS\uff1a</p> \u7248\u672c \u652f\u6301\u5e73\u53f0 6.x x86_64\uff0ci386 7.x x86_64\uff0cppc64le <p>Debian\uff1a</p> \u7248\u672c \u4ee3\u53f7 \u652f\u6301\u5e73\u53f0 7.x wheezy x86_64\uff0ci386 8.x jessie x86_64\uff0ci386 9.x stretch x86_64\uff0ci386 <p>Ubuntu\uff1a</p> \u7248\u672c \u4ee3\u53f7 \u652f\u6301\u5e73\u53f0 12.04 precise x86_64\uff0ci386 14.04 trusty x86_64\uff0ci386, aarch64/arm64 16.04 xenial x86_64\uff0ci386, ppc64el\uff0caarch64/arm64 16.10 yakkety x86_64\uff0ci386 <p>SLES\uff1a</p> \u7248\u672c \u652f\u6301\u5e73\u53f0 12 x86_64 <p>\u8981\u542f\u7528 Linux \u8f6f\u4ef6\u5305\u7684\u81ea\u52a8\u66f4\u65b0\uff0c\u53ef\u8bbe\u7f6e RHEL/CentOS \u53d1\u884c\u7248\u7684 yum \u4ed3\u5e93\uff08repository\uff09\uff0cDebian/Ubuntu \u53d1\u884c\u7248\u7684 apt \u4ed3\u5e93\u6216 SLES \u7684 zypper \u4ed3\u5e93\u3002</p>"},{"location":"Others/linux%E5%8C%85/#_1","title":"\u7a33\u5b9a\u7248\u672c\u7684\u9884\u6784\u5efa\u8f6f\u4ef6\u5305","text":"<p>\u8981\u8bbe\u7f6e RHEL/CentOS \u7684 yum \u4ed3\u5e93\uff0c\u8bf7\u521b\u5efa\u540d\u4e3a <code>/etc/yum.repos.d/nginx.repo</code> \u7684\u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>[nginx]\nname=nginx repo\nbaseurl=http://nginx.org/packages/OS/OSRELEASE/$basearch/\ngpgcheck=0\nenabled=1\n</code></pre> <p>\u6839\u636e\u6240\u4f7f\u7528\u7684\u53d1\u884c\u7248\uff0c\u4f7f\u7528 <code>rhel</code> \u6216 <code>centos</code> \u66ff\u6362\u6389 <code>OS</code>\uff0c\u5bf9\u4e8e 6.x \u6216 7.x \u7248\u672c\uff0c\u5c06 <code>OSRELEASE</code> \u66ff\u6362\u4e3a <code>6</code> \u6216 <code>7</code>\u3002</p> <p>\u5bf9\u4e8e Debian/Ubuntu\uff0c\u4e3a\u4e86\u9a8c\u8bc1 nginx \u4ed3\u5e93\u7b7e\u540d\uff0c\u5e76\u4e14\u5728\u5b89\u88c5 nginx \u8f6f\u4ef6\u5305\u65f6\u6d88\u9664\u5173\u4e8e\u7f3a\u5c11 PGP \u5bc6\u94a5\u7684\u8b66\u544a\uff0c\u9700\u8981\u5c06\u7528\u4e8e\u5c06 nginx \u8f6f\u4ef6\u5305\u548c\u4ed3\u5e93\u7b7e\u7f72\u7684\u5bc6\u94a5\u6dfb\u52a0\u5230 <code>apt</code> \u7a0b\u5e8f\u5bc6\u94a5\u73af\u4e2d\u3002\u8bf7\u4ece\u6211\u4eec\u7684\u7f51\u7ad9\u4e0b\u8f7d\u6b64\u5bc6\u94a5\uff0c\u5e76\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5c06\u5176\u6dfb\u52a0\u5230 <code>apt</code> \u7a0b\u5e8f\u5bc6\u94a5\u73af\uff1a</p> <pre><code>sudo apt-key add nginx_signing.key\n</code></pre> <p>\u5bf9\u4e8e Debian\uff0c\u4f7f\u7528 Debian \u53d1\u884c\u7248\u4ee3\u53f7\u66ff\u6362\u6389 <code>codename</code>\uff0c\u5e76\u5c06\u4ee5\u4e0b\u5185\u5bb9\u8ffd\u52a0\u5230 <code>/etc/apt/sources.list</code> \u6587\u4ef6\u672b\u5c3e\uff1a</p> <pre><code>deb http://nginx.org/packages/debian/ codename nginx\ndeb-src http://nginx.org/packages/debian/ codename nginx\n</code></pre> <p>\u5bf9\u4e8e Ubuntu\uff0c\u4f7f\u7528 Ubuntu \u53d1\u884c\u7248\u4ee3\u53f7\u66ff\u6362\u6389 <code>codename</code>\uff0c\u5e76\u5c06\u4ee5\u4e0b\u5185\u5bb9\u8ffd\u52a0\u5230 <code>/etc/apt/sources.list</code> \u6587\u4ef6\u672b\u5c3e\uff1a</p> <pre><code>deb http://nginx.org/packages/ubuntu/ codename nginx\ndeb-src http://nginx.org/packages/ubuntu/ codename nginx\n</code></pre> <p>\u5bf9\u4e8e Debian/Ubuntu\uff0c\u8bf7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>apt-get update\napt-get install nginx\n</code></pre> <p>\u5bf9\u4e8e SLES\uff0c\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>zypper addrepo -G -t yum -c 'http://nginx.org/packages/sles/12' nginx\n</code></pre>"},{"location":"Others/linux%E5%8C%85/#_2","title":"\u4e3b\u7ebf\u7248\u672c\u7684\u9884\u6784\u5efa\u8f6f\u4ef6\u5305","text":"<p>\u8981\u8bbe\u7f6e RHEL/CentOS \u7684 yum \u4ed3\u5e93\uff0c\u8bf7\u521b\u5efa\u540d\u4e3a <code>/etc/yum.repos.d/nginx.repo</code> \u7684\u6587\u4ef6\uff0c\u5176\u4e2d\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>[nginx]\nname=nginx repo\nbaseurl=http://nginx.org/packages/mainline/OS/OSRELEASE/$basearch/\ngpgcheck=0\nenabled=1\n</code></pre> <p>\u6839\u636e\u6240\u4f7f\u7528\u7684\u53d1\u884c\u7248\uff0c\u4f7f\u7528 <code>rhel</code> \u6216 <code>centos</code> \u66ff\u6362\u6389 <code>OS</code>\uff0c\u5bf9\u4e8e 6.x \u6216 7.x \u7248\u672c\uff0c\u5c06 <code>OSRELEASE</code> \u66ff\u6362\u4e3a <code>6</code> \u6216 <code>7</code>\u3002</p> <p>\u5bf9\u4e8e Debian/Ubuntu\uff0c\u4e3a\u4e86\u9a8c\u8bc1 nginx \u4ed3\u5e93\u7b7e\u540d\uff0c\u5e76\u4e14\u5728\u5b89\u88c5 nginx \u8f6f\u4ef6\u5305\u65f6\u6d88\u9664\u5173\u4e8e\u7f3a\u5c11 PGP \u5bc6\u94a5\u7684\u8b66\u544a\uff0c\u5fc5\u987b\u5c06\u7528\u4e8e\u5c06 nginx \u8f6f\u4ef6\u5305\u548c\u4ed3\u5e93\u7b7e\u7f72\u7684\u5bc6\u94a5\u6dfb\u52a0\u5230 <code>apt</code> \u7a0b\u5e8f\u5bc6\u94a5\u73af\u4e2d\u3002\u8bf7\u4ece\u6211\u4eec\u7684\u7f51\u7ad9\u4e0b\u8f7d\u6b64 \u5bc6\u94a5\uff0c\u5e76\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5c06\u5176\u6dfb\u52a0\u5230 <code>apt</code> \u7a0b\u5e8f\u5bc6\u94a5\u73af\uff1a</p> <pre><code>sudo apt-key add nginx_signing.key\n</code></pre> <p>\u5bf9\u4e8e Debian\uff0c\u4f7f\u7528 Debian \u53d1\u884c\u7248\u4ee3\u53f7\u66ff\u6362 <code>codename</code>\uff0c\u5e76\u5c06\u4ee5\u4e0b\u5185\u5bb9\u8ffd\u52a0\u5230 <code>/etc/apt/sources.list</code> \u6587\u4ef6\u672b\u5c3e\uff1a</p> <pre><code>deb http://nginx.org/packages/mainline/debian/ codename nginx\ndeb-src http://nginx.org/packages/mainline/debian/ codename nginx\n</code></pre> <p>\u5bf9\u4e8e Ubuntu\uff0c\u4f7f\u7528 Ubuntu \u53d1\u884c\u7248\u4ee3\u53f7\u66ff\u6362 <code>codename</code>\uff0c\u5e76\u5c06\u4ee5\u4e0b\u5185\u5bb9\u8ffd\u52a0\u5230 <code>/etc/apt/sources.list</code> \u6587\u4ef6\u672b\u5c3e\uff1a</p> <pre><code>deb http://nginx.org/packages/mainline/ubuntu/ codename nginx\ndeb-src http://nginx.org/packages/mainline/ubuntu/ codename nginx\n</code></pre> <p>\u5bf9\u4e8e Debian/Ubuntu\uff0c\u8bf7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>apt-get update\napt-get install nginx\n</code></pre> <p>\u5bf9\u4e8e SLES\uff0c\u8bf7\u8fd0\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>zypper addrepo -G -t yum -c 'http://nginx.org/packages/mainline/sles/12' nginx\n</code></pre>"},{"location":"Others/linux%E5%8C%85/#_3","title":"\u6e90\u7801\u5305","text":"<p>\u6e90\u7801\u5305\u53ef\u4ee5\u5728 \u6e90\u7801\u5305\u5e93 \u4e2d\u627e\u5230\u3002</p> <p><code>default</code> \u5206\u652f\u4fdd\u5b58\u5f53\u524d\u4e3b\u7ebf\u7248\u672c\u7684\u6e90\u7801\u5305\uff0c\u800c <code>stable-*</code> \u5206\u652f\u5305\u542b\u4e86\u7a33\u5b9a\u7248\u672c\u7684\u6700\u65b0\u6e90\u7801\u3002\u8981\u6784\u5efa\u4e8c\u8fdb\u5236\u5305\uff0c\u8bf7\u5728 Debian/Ubuntu \u4e0a\u7684 <code>debian/</code> \u76ee\u5f55\u6216\u5728 RHEL/CentOS/SLES \u4e0a\u7684 <code>rpm/SPECS/</code> \u4e2d\u8fd0\u884c <code>make</code>\u3002</p> <p>\u6e90\u7801\u5305\u5728 \u7c7b BSD \u7684\u4e24\u9879\u6761\u6b3e\u8bb8\u53ef\u8bc1 \u4e0b\u53d1\u884c\uff0c\u4e0e nginx \u76f8\u540c\u3002</p>"},{"location":"Others/linux%E5%8C%85/#_4","title":"\u52a8\u6001\u6a21\u5757","text":"<p>\u4e3b nginx \u5305\u4f7f\u7528\u4e86\u6240\u6709\u6a21\u5757\u8fdb\u884c\u6784\u5efa\uff0c\u6ca1\u6709\u4f7f\u7528\u5230\u9644\u52a0\u5e93\uff0c\u4ee5\u907f\u514d\u989d\u5916\u7684\u4f9d\u8d56\u3002\u81ea 1.9.11 \u7248\u672c\u5f00\u59cb\uff0cnginx \u652f\u6301 \u52a8\u6001\u6a21\u5757\uff0c\u5e76\u5c06\u4ee5\u4e0b\u6a21\u5757\u6784\u5efa\u4e3a\u52a8\u6001\u6a21\u5757\uff0c\u4ee5\u72ec\u7acb\u8f6f\u4ef6\u5305\u7684\u5f62\u5f0f\u53d1\u5e03\uff1a</p> <pre><code>nginx-module-geoip\nnginx-module-image-filter\nnginx-module-njs\nnginx-module-perl\nnginx-module-xslt\n</code></pre>"},{"location":"Others/linux%E5%8C%85/#_5","title":"\u7b7e\u540d","text":"<p>RPM \u8f6f\u4ef6\u5305\u548c Debian/Ubuntu \u4ed3\u5e93\u90fd\u4f7f\u7528\u6570\u5b57\u7b7e\u540d\u6765\u9a8c\u8bc1\u4e0b\u8f7d\u5305\u7684\u5b8c\u6574\u6027\u548c\u6765\u6e90\u3002\u4e3a\u4e86\u68c0\u67e5\u7b7e\u540d\uff0c\u9700\u8981\u4e0b\u8f7d nginx \u7b7e\u540d\u5bc6\u94a5 \u5e76\u5c06\u5176\u5bfc\u5165 rpm \u6216 apt \u7a0b\u5e8f\u5bc6\u94a5\u73af\uff1a</p> <p>\u5728 Debian/Ubuntu \u4e0a\uff1a</p> <pre><code>sudo apt-key add nginx_signing.key\n</code></pre> <p>\u5728 RHEL/CentOS \u4e0a\uff1b</p> <pre><code>sudo rpm --import nginx_signing.key\n</code></pre> <p>\u5728 SLES \u4e0a\uff1a</p> <pre><code>sudo rpm --import nginx_signing.key\n</code></pre> <p>Debian/Ubuntu/SLES \u7b7e\u540d\u9ed8\u8ba4\u60c5\u51b5\u88ab\u68c0\u67e5\uff0c\u4f46\u662f\u5728 RHEL/CentOS \u4e0a\uff0c\u9700\u8981\u5728 <code>/etc/yum.repos.d/nginx.repo</code> \u6587\u4ef6\u4e2d\u8fdb\u884c\u8bbe\u7f6e\uff1a</p> <pre><code>gpgcheck= 1\n</code></pre> <p>\u7531\u4e8e\u6211\u4eec\u7684 PGP \u5bc6\u94a5 \u548c\u8f6f\u4ef6\u5305\u90fd\u4f4d\u4e8e\u540c\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\uff0c\u56e0\u6b64\u5b83\u4eec\u90fd\u662f\u53ef\u4fe1\u7684\u3002\u5f3a\u70c8\u5efa\u8bae\u53e6\u884c\u9a8c\u8bc1\u4e0b\u8f7d\u7684 PGP \u5bc6\u94a5\u7684\u771f\u5b9e\u6027\u3002PGP \u5177\u6709\u201cWeb of Trust\u201d\uff08\u4fe1\u4efb\u7f51\u7edc\uff09\u7684\u6982\u5ff5\uff0c\u5f53\u4e00\u4e2a\u5bc6\u94a5\u662f\u7531\u522b\u4eba\u7684\u5bc6\u94a5\u7b7e\u7f72\u7684\uff0c\u800c\u53e6\u4e00\u4e2a\u5bc6\u94a5\u5219\u7531\u53e6\u4e00\u4e2a\u5bc6\u94a5\u7b7e\u540d\u3002\u5b83\u901a\u5e38\u53ef\u4ee5\u5efa\u7acb\u4e00\u4e2a\u4ece\u4efb\u610f\u5bc6\u94a5\u5230\u60a8\u77e5\u9053\u548c\u4fe1\u4efb\u7684\u67d0\u4eba\u7684\u5bc6\u94a5\uff0c\u4ece\u800c\u9a8c\u8bc1\u94fe\u4e2d\u7b2c\u4e00\u4e2a\u5bc6\u94a5\u7684\u771f\u5b9e\u6027\u3002\u8fd9\u4e2a\u6982\u5ff5\u5728 GPG Mini Howto \u4e2d\u6709\u8be6\u7ec6\u63cf\u8ff0\u3002\u6211\u4eec\u7684\u94a5\u5319\u6709\u8db3\u591f\u7684\u7b7e\u540d\uff0c\u5176\u771f\u5b9e\u6027\u6bd4\u8f83\u5bb9\u6613\u68c0\u67e5\u3002</p>"},{"location":"Others/linux%E5%8C%85/#_6","title":"\u539f\u6587\u6863","text":"<p>http://nginx.org/en/linux_packages.html#distributions</p>"}]}