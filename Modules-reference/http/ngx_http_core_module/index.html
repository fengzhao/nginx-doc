<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="nginx docs"><meta name=author content=fengzhao><link href=https://nginx.fengzhao.me/Modules-reference/http/ngx_http_core_module/ rel=canonical><link href=../ngx_http_charset_module/ rel=prev><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.6"><title>ngx_http_core_module - nginx docs</title><link rel=stylesheet href=../../../assets/stylesheets/main.558e4712.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../../stylesheets/extra.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#ngx_http_core_module class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../.. title="nginx docs" class="md-header__button md-logo" aria-label="nginx docs" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> nginx docs </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> ngx_http_core_module </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary data-md-color-accent aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=查找> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/fengzhao/nginx-doc title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> fengzhao/nginx-doc </div> </a> </div> </nav> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../index.md class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../resources.md class=md-tabs__link> 学习资源 </a> </li> <li class=md-tabs__item> <a href=../../../Introduction/%E5%88%9D%E5%AD%A6%E8%80%85%E6%8C%87%E5%8D%97/ class=md-tabs__link> 介绍 </a> </li> <li class=md-tabs__item> <a href=../../../foundmental/suoyin.md class=md-tabs__link> </a> </li> <li class=md-tabs__item> <a href=../../%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/ class="md-tabs__link md-tabs__link--active"> Modules-reference </a> </li> <li class=md-tabs__item> <a href=../../../optimize/1.overview.md class=md-tabs__link> MySQL调优 </a> </li> <li class=md-tabs__item> <a href=../../../postgresql/01.postgresql简介.md class=md-tabs__link> PostgreSQL </a> </li> <li class=md-tabs__item> <a href=../../../mongodb/01.简介.md class=md-tabs__link> MongoDB </a> </li> <li class=md-tabs__item> <a href=../../../redis/01.redis简介.md class=md-tabs__link> Redis </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="nginx docs" class="md-nav__button md-logo" aria-label="nginx docs" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> nginx docs </label> <div class=md-nav__source> <a href=https://github.com/fengzhao/nginx-doc title=前往仓库 class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> fengzhao/nginx-doc </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../index.md class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../../resources.md class=md-nav__link> 学习资源 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 tabindex=0 aria-expanded=false> 介绍 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=介绍 data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> 介绍 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Introduction/%E5%88%9D%E5%AD%A6%E8%80%85%E6%8C%87%E5%8D%97/ class=md-nav__link> 0. 初学者指南 </a> </li> <li class=md-nav__item> <a href=../../../Introduction/%E5%AE%89%E8%A3%85nginx/ class=md-nav__link> 1. 安装nginx </a> </li> <li class=md-nav__item> <a href=../../../Introduction/%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0/ class=md-nav__link> 2. 命令行参数 </a> </li> <li class=md-nav__item> <a href=../../../Introduction/%E6%8E%A7%E5%88%B6nginx/ class=md-nav__link> 3. 控制nginx </a> </li> <li class=md-nav__item> <a href=../../../Introduction/%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%8D%E7%A7%B0/ class=md-nav__link> 4. 服务器名称 </a> </li> <li class=md-nav__item> <a href=../../../Introduction/Nginx%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E8%AF%B7%E6%B1%82/ class=md-nav__link> 5. Nginx如何处理请求 </a> </li> <li class=md-nav__item> <a href=../../../Introduction/%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97%E5%88%B0syslog/ class=md-nav__link> 6. 记录日志到syslog </a> </li> <li class=md-nav__item> <a href=../../../Introduction/%E8%BF%9E%E6%8E%A5%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F/ class=md-nav__link> 7. 连接处理方式 </a> </li> <li class=md-nav__item> <a href=../../../basic/8.MySQL字符集和排序规则.md class=md-nav__link> 8. MySQL字符集和排序规则 </a> </li> <li class=md-nav__item> <a href=../../../basic/9.mysql_architecture.md class=md-nav__link> 9. MySQL逻辑架构和性能优化概述 </a> </li> <li class=md-nav__item> <a href=../../../basic/10.sql-Transaction.md class=md-nav__link> 10. 数据库事务和锁 </a> </li> <li class=md-nav__item> <a href=../../../basic/Facts.md class=md-nav__link> 11. Facts 数据 </a> </li> <li class=md-nav__item> <a href=../../../basic/12.MySQL内存概述.md class=md-nav__link> 12. MySQL内存概述 </a> </li> <li class=md-nav__item> <a href=../../../basic/Conditionals-loop.md class=md-nav__link> 13. 条件判断与循环 </a> </li> <li class=md-nav__item> <a href=../../../basic/Blocks.md class=md-nav__link> 14. Blocks </a> </li> <li class=md-nav__item> <a href=../../../basic/Playbook-features.md class=md-nav__link> 15. Playbook 高级特性 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 tabindex=0 aria-expanded=false> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../foundmental/suoyin.md class=md-nav__link> 1.索引相关 </a> </li> <li class=md-nav__item> <a href=../../../dev/02.数据库设计.md class=md-nav__link> 2.数据库设计 </a> </li> <li class=md-nav__item> <a href=../../../dev/03.在线DDL.md class=md-nav__link> 3.在线DDL </a> </li> <li class=md-nav__item> <a href=../../../dev/04.MySQL连表查询算法.md class=md-nav__link> 4.联表算法 </a> </li> <li class=md-nav__item> <a href=../../../dev/05.MySQL-insert语法.md class=md-nav__link> 5.insert语法 </a> </li> <li class=md-nav__item> <a href=../../../advanced/dynamic-inventory.md class=md-nav__link> 使用动态主机管理云服务 </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_4_7 type=checkbox id=__nav_4_7> <label class=md-nav__link for=__nav_4_7 tabindex=0 aria-expanded=false> Ansible 安全 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible 安全" data-md-level=2> <label class=md-nav__title for=__nav_4_7> <span class="md-nav__icon md-icon"></span> Ansible 安全 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../advanced/security/index.md class=md-nav__link> Ansible 控制节点安全 </a> </li> <li class=md-nav__item> <a href=../../../advanced/security/firewall.md class=md-nav__link> - 节点安全: 防火墙设置 </a> </li> <li class=md-nav__item> <a href=../../../advanced/security/ssh-2step.md class=md-nav__link> - 节点安全: ssh登录二次验证 </a> </li> <li class=md-nav__item> <a href=../../../advanced/security/audit.md class=md-nav__link> - 节点安全: 命令审计 </a> </li> <li class=md-nav__item> <a href=../../../advanced/security/vault-hosts.md class=md-nav__link> - 节点安全: 加密主机清单 </a> </li> <li class=md-nav__item> <a href=../../../advanced/security/filter-command.md class=md-nav__link> 过滤 Ansible 危险指令 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_4_8 type=checkbox id=__nav_4_8> <label class=md-nav__link for=__nav_4_8 tabindex=0 aria-expanded=false> Ansible 实践 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible 实践" data-md-level=2> <label class=md-nav__title for=__nav_4_8> <span class="md-nav__icon md-icon"></span> Ansible 实践 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../advanced/practice/snippets.md class=md-nav__link> Ansible Task片段 </a> </li> <li class=md-nav__item> <a href=../../../advanced/practice/jenkins-and-ansible.md class=md-nav__link> 在 Jenkins 中使用 Ansible </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../advanced/ara.md class=md-nav__link> 使用 ARA 记录 Ansible 执行结果 </a> </li> <li class=md-nav__item> <a href=../../../advanced/ansible-cmdb.md class=md-nav__link> 使用 Ansible-cmdb </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_5 type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5 tabindex=0 aria-expanded=true> Modules-reference <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Modules-reference data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Modules-reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD/ class=md-nav__link> 核心功能 </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_5_2 type=checkbox id=__nav_5_2 checked> <label class=md-nav__link for=__nav_5_2 tabindex=0 aria-expanded=true> HTTP <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=HTTP data-md-level=2> <label class=md-nav__title for=__nav_5_2> <span class="md-nav__icon md-icon"></span> HTTP </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ngx_http_access_module/ class=md-nav__link> ngx_http_access_module </a> </li> <li class=md-nav__item> <a href=../ngx_http_addition_module/ class=md-nav__link> ngx_http_addition_module </a> </li> <li class=md-nav__item> <a href=../ngx_http_auth_basic_module/ class=md-nav__link> ngx_http_auth_basic_module </a> </li> <li class=md-nav__item> <a href=../ngx_http_auth_jwt_module/ class=md-nav__link> ngx_http_auth_jwt_module </a> </li> <li class=md-nav__item> <a href=../ngx_http_auth_request_module/ class=md-nav__link> ngx_http_auth_request_module </a> </li> <li class=md-nav__item> <a href=../ngx_http_autoindex_module/ class=md-nav__link> ngx_http_autoindex_module </a> </li> <li class=md-nav__item> <a href=../ngx_http_browser_module/ class=md-nav__link> ngx_http_browser_module </a> </li> <li class=md-nav__item> <a href=../ngx_http_charset_module/ class=md-nav__link> ngx_http_charset_module </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> ngx_http_core_module <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> ngx_http_core_module </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 指令 </a> <nav class=md-nav aria-label=指令> <ul class=md-nav__list> <li class=md-nav__item> <a href=#absolute_redirect class=md-nav__link> absolute_redirect </a> </li> <li class=md-nav__item> <a href=#aio class=md-nav__link> aio </a> </li> <li class=md-nav__item> <a href=#aio_write class=md-nav__link> aio_write </a> </li> <li class=md-nav__item> <a href=#alias class=md-nav__link> alias </a> </li> <li class=md-nav__item> <a href=#chunked_transfer_encoding class=md-nav__link> chunked_transfer_encoding </a> </li> <li class=md-nav__item> <a href=#client_body_buffer_size class=md-nav__link> client_body_buffer_size </a> </li> <li class=md-nav__item> <a href=#client_body_in_file_only class=md-nav__link> client_body_in_file_only </a> </li> <li class=md-nav__item> <a href=#client_body_in_single_buffer class=md-nav__link> client_body_in_single_buffer </a> </li> <li class=md-nav__item> <a href=#client_body_temp_path class=md-nav__link> client_body_temp_path </a> </li> <li class=md-nav__item> <a href=#client_body_timeout class=md-nav__link> client_body_timeout </a> </li> <li class=md-nav__item> <a href=#client_header_buffer_size class=md-nav__link> client_header_buffer_size </a> </li> <li class=md-nav__item> <a href=#client_header_timeout class=md-nav__link> client_header_timeout </a> </li> <li class=md-nav__item> <a href=#client_max_body_size class=md-nav__link> client_max_body_size </a> </li> <li class=md-nav__item> <a href=#connection_pool_size class=md-nav__link> connection_pool_size </a> </li> <li class=md-nav__item> <a href=#default_type class=md-nav__link> default_type </a> </li> <li class=md-nav__item> <a href=#directio class=md-nav__link> directio </a> </li> <li class=md-nav__item> <a href=#directio_alignment class=md-nav__link> directio_alignment </a> </li> <li class=md-nav__item> <a href=#disable_symlinks class=md-nav__link> disable_symlinks </a> </li> <li class=md-nav__item> <a href=#error_page class=md-nav__link> error_page </a> </li> <li class=md-nav__item> <a href=#etag class=md-nav__link> etag </a> </li> <li class=md-nav__item> <a href=#http class=md-nav__link> http </a> </li> <li class=md-nav__item> <a href=#if_modified_since class=md-nav__link> if_modified_since </a> </li> <li class=md-nav__item> <a href=#ignore_invalid_headers class=md-nav__link> ignore_invalid_headers </a> </li> <li class=md-nav__item> <a href=#internal class=md-nav__link> internal </a> </li> <li class=md-nav__item> <a href=#keepalive_disable class=md-nav__link> keepalive_disable </a> </li> <li class=md-nav__item> <a href=#keepalive_requests class=md-nav__link> keepalive_requests </a> </li> <li class=md-nav__item> <a href=#keepalive_timeout class=md-nav__link> keepalive_timeout </a> </li> <li class=md-nav__item> <a href=#large_client_header_buffers class=md-nav__link> large_client_header_buffers </a> </li> <li class=md-nav__item> <a href=#limit_except class=md-nav__link> limit_except </a> </li> <li class=md-nav__item> <a href=#limit_rate class=md-nav__link> limit_rate </a> </li> <li class=md-nav__item> <a href=#lingering_time class=md-nav__link> lingering_time </a> </li> <li class=md-nav__item> <a href=#lingering_timeout class=md-nav__link> lingering_timeout </a> </li> <li class=md-nav__item> <a href=#listen class=md-nav__link> listen </a> </li> <li class=md-nav__item> <a href=#location class=md-nav__link> location </a> </li> <li class=md-nav__item> <a href=#log_not_found class=md-nav__link> log_not_found </a> </li> <li class=md-nav__item> <a href=#log_subrequest class=md-nav__link> log_subrequest </a> </li> <li class=md-nav__item> <a href=#max_ranges class=md-nav__link> max_ranges </a> </li> <li class=md-nav__item> <a href=#merge_slashes class=md-nav__link> merge_slashes </a> </li> <li class=md-nav__item> <a href=#msie_padding class=md-nav__link> msie_padding </a> </li> <li class=md-nav__item> <a href=#msie_refresh class=md-nav__link> msie_refresh </a> </li> <li class=md-nav__item> <a href=#open_file_cache class=md-nav__link> open_file_cache </a> </li> <li class=md-nav__item> <a href=#open_file_cache_errors class=md-nav__link> open_file_cache_errors </a> </li> <li class=md-nav__item> <a href=#open_file_cache_min_uses class=md-nav__link> open_file_cache_min_uses </a> </li> <li class=md-nav__item> <a href=#open_file_cache_valid class=md-nav__link> open_file_cache_valid </a> </li> <li class=md-nav__item> <a href=#output_buffers class=md-nav__link> output_buffers </a> </li> <li class=md-nav__item> <a href=#port_in_redirect class=md-nav__link> port_in_redirect </a> </li> <li class=md-nav__item> <a href=#postpone_output class=md-nav__link> postpone_output </a> </li> <li class=md-nav__item> <a href=#read_ahead class=md-nav__link> read_ahead </a> </li> <li class=md-nav__item> <a href=#recursive_error_pages class=md-nav__link> recursive_error_pages </a> </li> <li class=md-nav__item> <a href=#request_pool_size class=md-nav__link> request_pool_size </a> </li> <li class=md-nav__item> <a href=#reset_timedout_connection class=md-nav__link> reset_timedout_connection </a> </li> <li class=md-nav__item> <a href=#resolver class=md-nav__link> resolver </a> </li> <li class=md-nav__item> <a href=#satisfy class=md-nav__link> satisfy </a> </li> <li class=md-nav__item> <a href=#send_lowat class=md-nav__link> send_lowat </a> </li> <li class=md-nav__item> <a href=#send_timeout class=md-nav__link> send_timeout </a> </li> <li class=md-nav__item> <a href=#sendfile class=md-nav__link> sendfile </a> </li> <li class=md-nav__item> <a href=#sendfile_max_chunk class=md-nav__link> sendfile_max_chunk </a> </li> <li class=md-nav__item> <a href=#server class=md-nav__link> server </a> </li> <li class=md-nav__item> <a href=#server_name class=md-nav__link> server_name </a> </li> <li class=md-nav__item> <a href=#server_name_in_redirect class=md-nav__link> server_name_in_redirect </a> </li> <li class=md-nav__item> <a href=#server_names_hash_bucket_size class=md-nav__link> server_names_hash_bucket_size </a> </li> <li class=md-nav__item> <a href=#server_names_hash_max_size class=md-nav__link> server_names_hash_max_size </a> </li> <li class=md-nav__item> <a href=#server_tokens class=md-nav__link> server_tokens </a> </li> <li class=md-nav__item> <a href=#tcp_nodelay class=md-nav__link> tcp_nodelay </a> </li> <li class=md-nav__item> <a href=#tcp_nopush class=md-nav__link> tcp_nopush </a> </li> <li class=md-nav__item> <a href=#try_files class=md-nav__link> try_files </a> </li> <li class=md-nav__item> <a href=#types_hash_bucket_size class=md-nav__link> types_hash_bucket_size </a> </li> <li class=md-nav__item> <a href=#types_hash_max_size class=md-nav__link> types_hash_max_size </a> </li> <li class=md-nav__item> <a href=#underscores_in_headers class=md-nav__link> underscores_in_headers </a> </li> <li class=md-nav__item> <a href=#variables_hash_bucket_size class=md-nav__link> variables_hash_bucket_size </a> </li> <li class=md-nav__item> <a href=#variables_hash_max_size class=md-nav__link> variables_hash_max_size </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 内嵌变量 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 原文档 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../dev/modules/module-doc.md class=md-nav__link> module 的帮助文档 </a> </li> <li class=md-nav__item> <a href=../../../dev/modules/module-architecture.md class=md-nav__link> module 架构 </a> </li> <li class=md-nav__item> <a href=../../../dev/modules/module-utilities.md class=md-nav__link> module 工具类 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../dev/pycharm-remote-development.md class=md-nav__link> 使用 PyCharm 远程开发 </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_5_4 type=checkbox id=__nav_5_4> <label class=md-nav__link for=__nav_5_4 tabindex=0 aria-expanded=false> Ansible 调试 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Ansible 调试" data-md-level=2> <label class=md-nav__title for=__nav_5_4> <span class="md-nav__icon md-icon"></span> Ansible 调试 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../dev/debug/verbose-debug.md class=md-nav__link> 详细输出 </a> </li> <li class=md-nav__item> <a href=../../../dev/debug/pdb.md class=md-nav__link> pdb 本地调试 </a> </li> <li class=md-nav__item> <a href=../../../dev/debug/pycharm.md class=md-nav__link> PyCharm 远程调试 </a> </li> <li class=md-nav__item> <a href=../../../dev/debug/module-debug.md class=md-nav__link> 模块调试 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_5_5 type=checkbox id=__nav_5_5> <label class=md-nav__link for=__nav_5_5 tabindex=0 aria-expanded=false> Module 开发 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Module 开发" data-md-level=2> <label class=md-nav__title for=__nav_5_5> <span class="md-nav__icon md-icon"></span> Module 开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../dev/modules/index.md class=md-nav__link> Module 开发说明 </a> </li> <li class=md-nav__item> <a href=../../../dev/modules/remote_copy.md class=md-nav__link> 创建一个简单的module </a> </li> <li class=md-nav__item> <a href=../../../dev/modules/huawei-switch.md class=md-nav__link> module 示例: 连接华为交换机 </a> </li> <li class=md-nav__item> <a href=../../../dev/modules/module-outher-dev.md class=md-nav__link> module 示例: 其他语言开发 </a> </li> <li class=md-nav__item> <a href=../../../dev/modules/module-shell-dir.md class=md-nav__link> module 示例: dir </a> </li> <li class=md-nav__item> <a href=../../../dev/modules/module-docker-facts.md class=md-nav__link> module 示例: docker_facts </a> </li> <li class=md-nav__item> <a href=../../../dev/modules/module-wechat.md class=md-nav__link> module 示例: wechat </a> </li> <li class=md-nav__item> <a href=../../../dev/modules/module-return.md class=md-nav__link> module 的返回值 </a> </li> <li class=md-nav__item> <a href=../../../dev/modules/module-doc.md class=md-nav__link> module 的帮助文档 </a> </li> <li class=md-nav__item> <a href=../../../dev/modules/module-architecture.md class=md-nav__link> module 架构 </a> </li> <li class=md-nav__item> <a href=../../../dev/modules/module-utilities.md class=md-nav__link> module 工具类 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_5_6 type=checkbox id=__nav_5_6> <label class=md-nav__link for=__nav_5_6 tabindex=0 aria-expanded=false> Plugin 开发 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Plugin 开发" data-md-level=2> <label class=md-nav__title for=__nav_5_6> <span class="md-nav__icon md-icon"></span> Plugin 开发 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../dev/plugins/index.md class=md-nav__link> Plugin 开发说明 </a> </li> <li class=md-nav__item> <a href=../../../dev/plugins/Action-hello.md class=md-nav__link> Action 示例: hello </a> </li> <li class=md-nav__item> <a href=../../../dev/plugins/Callback-BlackHole.md class=md-nav__link> Callback 示例: BlackHole </a> </li> <li class=md-nav__item> <a href=../../../dev/plugins/Filter-split.md class=md-nav__link> Filter 示例: split </a> </li> <li class=md-nav__item> <a href=../../../dev/plugins/Inventory-csv.md class=md-nav__link> Inventory 示例: csv </a> </li> <li class=md-nav__item> <a href=../../../dev/plugins/Lookup-github-status.md class=md-nav__link> Lookup 示例: github_status </a> </li> <li class=md-nav__item> <a href=../../../dev/plugins/Vars-csv-vars.md class=md-nav__link> Vars 示例: csv_vars </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_5_7 type=checkbox id=__nav_5_7> <label class=md-nav__link for=__nav_5_7 tabindex=0 aria-expanded=false> API 使用 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="API 使用" data-md-level=2> <label class=md-nav__title for=__nav_5_7> <span class="md-nav__icon md-icon"></span> API 使用 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../dev/api/index.md class=md-nav__link> API 使用说明 </a> </li> <li class=md-nav__item> <a href=../../../dev/api/api-task.md class=md-nav__link> 使用 API 运行任务 </a> </li> <li class=md-nav__item> <a href=../../../dev/api/api-playbook.md class=md-nav__link> 使用 API 运行 Palybook </a> </li> <li class=md-nav__item> <a href=../../../dev/api/api-suitable.md class=md-nav__link> 使用 suitable </a> </li> <li class=md-nav__item> <a href=../../../dev/api/api-ansible-runner.md class=md-nav__link> 使用 ansible runner </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 tabindex=0 aria-expanded=false> MySQL调优 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=MySQL调优 data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> MySQL调优 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../optimize/1.overview.md class=md-nav__link> 调优概述 </a> </li> <li class=md-nav__item> <a href=../../../optimize/many_tables.md class=md-nav__link> 数据大小 </a> </li> <li class=md-nav__item> <a href=../../../ui/awx.md class=md-nav__link> Ansible Awx </a> </li> <li class=md-nav__item> <a href=../../../optimize/.md class=md-nav__link> 数据库结构调优 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 tabindex=0 aria-expanded=false> PostgreSQL <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=PostgreSQL data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> PostgreSQL </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../postgresql/01.postgresql简介.md class=md-nav__link> 0. PostgreSQL简介 </a> </li> <li class=md-nav__item> <a href=../../../postgresql/02.postgresql安装.md class=md-nav__link> 1. PogreSQL安装 </a> </li> <li class=md-nav__item> <a href=../../../postgresql/03.体系架构.md class=md-nav__link> 2. PogreSQL体系架构 </a> </li> <li class=md-nav__item> <a href=../../../postgresql/04.常用SQL.md class=md-nav__link> 3. 常用SQL </a> </li> <li class=md-nav__item> <a href=../../../postgresql/05.继承表.md class=md-nav__link> 4. 继承 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 tabindex=0 aria-expanded=false> MongoDB <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=MongoDB data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> MongoDB </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../mongodb/01.简介.md class=md-nav__link> 0. MongoDB概述 </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_8_2 type=checkbox id=__nav_8_2> <label class=md-nav__link for=__nav_8_2 tabindex=0 aria-expanded=false> 认证 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=认证 data-md-level=2> <label class=md-nav__title for=__nav_8_2> <span class="md-nav__icon md-icon"></span> 认证 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../roles/auth/kerberos-client.md class=md-nav__link> kerberos-client </a> </li> <li class=md-nav__item> <a href=../../../roles/auth/kerberos-server.md class=md-nav__link> kerberos-server </a> </li> <li class=md-nav__item> <a href=../../../roles/auth/openldap.md class=md-nav__link> openldap </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_9 type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 tabindex=0 aria-expanded=false> Redis <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Redis data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Redis </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../redis/01.redis简介.md class=md-nav__link> 0. redis概述 </a> </li> <li class=md-nav__item> <a href=../../../redis/02.redis客户端.md class=md-nav__link> 2. redis客户端 </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_9_3 type=checkbox id=__nav_9_3> <label class=md-nav__link for=__nav_9_3 tabindex=0 aria-expanded=false> 认证 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=认证 data-md-level=2> <label class=md-nav__title for=__nav_9_3> <span class="md-nav__icon md-icon"></span> 认证 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../roles/auth/kerberos-client.md class=md-nav__link> kerberos-client </a> </li> <li class=md-nav__item> <a href=../../../roles/auth/kerberos-server.md class=md-nav__link> kerberos-server </a> </li> <li class=md-nav__item> <a href=../../../roles/auth/openldap.md class=md-nav__link> openldap </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 指令 </a> <nav class=md-nav aria-label=指令> <ul class=md-nav__list> <li class=md-nav__item> <a href=#absolute_redirect class=md-nav__link> absolute_redirect </a> </li> <li class=md-nav__item> <a href=#aio class=md-nav__link> aio </a> </li> <li class=md-nav__item> <a href=#aio_write class=md-nav__link> aio_write </a> </li> <li class=md-nav__item> <a href=#alias class=md-nav__link> alias </a> </li> <li class=md-nav__item> <a href=#chunked_transfer_encoding class=md-nav__link> chunked_transfer_encoding </a> </li> <li class=md-nav__item> <a href=#client_body_buffer_size class=md-nav__link> client_body_buffer_size </a> </li> <li class=md-nav__item> <a href=#client_body_in_file_only class=md-nav__link> client_body_in_file_only </a> </li> <li class=md-nav__item> <a href=#client_body_in_single_buffer class=md-nav__link> client_body_in_single_buffer </a> </li> <li class=md-nav__item> <a href=#client_body_temp_path class=md-nav__link> client_body_temp_path </a> </li> <li class=md-nav__item> <a href=#client_body_timeout class=md-nav__link> client_body_timeout </a> </li> <li class=md-nav__item> <a href=#client_header_buffer_size class=md-nav__link> client_header_buffer_size </a> </li> <li class=md-nav__item> <a href=#client_header_timeout class=md-nav__link> client_header_timeout </a> </li> <li class=md-nav__item> <a href=#client_max_body_size class=md-nav__link> client_max_body_size </a> </li> <li class=md-nav__item> <a href=#connection_pool_size class=md-nav__link> connection_pool_size </a> </li> <li class=md-nav__item> <a href=#default_type class=md-nav__link> default_type </a> </li> <li class=md-nav__item> <a href=#directio class=md-nav__link> directio </a> </li> <li class=md-nav__item> <a href=#directio_alignment class=md-nav__link> directio_alignment </a> </li> <li class=md-nav__item> <a href=#disable_symlinks class=md-nav__link> disable_symlinks </a> </li> <li class=md-nav__item> <a href=#error_page class=md-nav__link> error_page </a> </li> <li class=md-nav__item> <a href=#etag class=md-nav__link> etag </a> </li> <li class=md-nav__item> <a href=#http class=md-nav__link> http </a> </li> <li class=md-nav__item> <a href=#if_modified_since class=md-nav__link> if_modified_since </a> </li> <li class=md-nav__item> <a href=#ignore_invalid_headers class=md-nav__link> ignore_invalid_headers </a> </li> <li class=md-nav__item> <a href=#internal class=md-nav__link> internal </a> </li> <li class=md-nav__item> <a href=#keepalive_disable class=md-nav__link> keepalive_disable </a> </li> <li class=md-nav__item> <a href=#keepalive_requests class=md-nav__link> keepalive_requests </a> </li> <li class=md-nav__item> <a href=#keepalive_timeout class=md-nav__link> keepalive_timeout </a> </li> <li class=md-nav__item> <a href=#large_client_header_buffers class=md-nav__link> large_client_header_buffers </a> </li> <li class=md-nav__item> <a href=#limit_except class=md-nav__link> limit_except </a> </li> <li class=md-nav__item> <a href=#limit_rate class=md-nav__link> limit_rate </a> </li> <li class=md-nav__item> <a href=#lingering_time class=md-nav__link> lingering_time </a> </li> <li class=md-nav__item> <a href=#lingering_timeout class=md-nav__link> lingering_timeout </a> </li> <li class=md-nav__item> <a href=#listen class=md-nav__link> listen </a> </li> <li class=md-nav__item> <a href=#location class=md-nav__link> location </a> </li> <li class=md-nav__item> <a href=#log_not_found class=md-nav__link> log_not_found </a> </li> <li class=md-nav__item> <a href=#log_subrequest class=md-nav__link> log_subrequest </a> </li> <li class=md-nav__item> <a href=#max_ranges class=md-nav__link> max_ranges </a> </li> <li class=md-nav__item> <a href=#merge_slashes class=md-nav__link> merge_slashes </a> </li> <li class=md-nav__item> <a href=#msie_padding class=md-nav__link> msie_padding </a> </li> <li class=md-nav__item> <a href=#msie_refresh class=md-nav__link> msie_refresh </a> </li> <li class=md-nav__item> <a href=#open_file_cache class=md-nav__link> open_file_cache </a> </li> <li class=md-nav__item> <a href=#open_file_cache_errors class=md-nav__link> open_file_cache_errors </a> </li> <li class=md-nav__item> <a href=#open_file_cache_min_uses class=md-nav__link> open_file_cache_min_uses </a> </li> <li class=md-nav__item> <a href=#open_file_cache_valid class=md-nav__link> open_file_cache_valid </a> </li> <li class=md-nav__item> <a href=#output_buffers class=md-nav__link> output_buffers </a> </li> <li class=md-nav__item> <a href=#port_in_redirect class=md-nav__link> port_in_redirect </a> </li> <li class=md-nav__item> <a href=#postpone_output class=md-nav__link> postpone_output </a> </li> <li class=md-nav__item> <a href=#read_ahead class=md-nav__link> read_ahead </a> </li> <li class=md-nav__item> <a href=#recursive_error_pages class=md-nav__link> recursive_error_pages </a> </li> <li class=md-nav__item> <a href=#request_pool_size class=md-nav__link> request_pool_size </a> </li> <li class=md-nav__item> <a href=#reset_timedout_connection class=md-nav__link> reset_timedout_connection </a> </li> <li class=md-nav__item> <a href=#resolver class=md-nav__link> resolver </a> </li> <li class=md-nav__item> <a href=#satisfy class=md-nav__link> satisfy </a> </li> <li class=md-nav__item> <a href=#send_lowat class=md-nav__link> send_lowat </a> </li> <li class=md-nav__item> <a href=#send_timeout class=md-nav__link> send_timeout </a> </li> <li class=md-nav__item> <a href=#sendfile class=md-nav__link> sendfile </a> </li> <li class=md-nav__item> <a href=#sendfile_max_chunk class=md-nav__link> sendfile_max_chunk </a> </li> <li class=md-nav__item> <a href=#server class=md-nav__link> server </a> </li> <li class=md-nav__item> <a href=#server_name class=md-nav__link> server_name </a> </li> <li class=md-nav__item> <a href=#server_name_in_redirect class=md-nav__link> server_name_in_redirect </a> </li> <li class=md-nav__item> <a href=#server_names_hash_bucket_size class=md-nav__link> server_names_hash_bucket_size </a> </li> <li class=md-nav__item> <a href=#server_names_hash_max_size class=md-nav__link> server_names_hash_max_size </a> </li> <li class=md-nav__item> <a href=#server_tokens class=md-nav__link> server_tokens </a> </li> <li class=md-nav__item> <a href=#tcp_nodelay class=md-nav__link> tcp_nodelay </a> </li> <li class=md-nav__item> <a href=#tcp_nopush class=md-nav__link> tcp_nopush </a> </li> <li class=md-nav__item> <a href=#try_files class=md-nav__link> try_files </a> </li> <li class=md-nav__item> <a href=#types_hash_bucket_size class=md-nav__link> types_hash_bucket_size </a> </li> <li class=md-nav__item> <a href=#types_hash_max_size class=md-nav__link> types_hash_max_size </a> </li> <li class=md-nav__item> <a href=#underscores_in_headers class=md-nav__link> underscores_in_headers </a> </li> <li class=md-nav__item> <a href=#variables_hash_bucket_size class=md-nav__link> variables_hash_bucket_size </a> </li> <li class=md-nav__item> <a href=#variables_hash_max_size class=md-nav__link> variables_hash_max_size </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 内嵌变量 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 原文档 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=ngx_http_core_module>ngx_http_core_module<a class=headerlink href=#ngx_http_core_module title="Permanent link">&para;</a></h1> <ul> <li><a href=#directives>指令</a><ul> <li><a href=#absolute_redirect>absolute_redirect</a></li> <li><a href=#aio>aio</a></li> <li><a href=#aio_write>aio_write</a></li> <li><a href=#alias>alias</a></li> <li><a href=#chunked_transfer_encoding>chunked_transfer_encoding</a></li> <li><a href=#client_body_buffer_size>client_body_buffer_size</a></li> <li><a href=#client_body_in_file_only>client_body_in_file_only</a></li> <li><a href=#client_body_in_single_buffer>client_body_in_single_buffer</a></li> <li><a href=#client_body_temp_path>client_body_temp_path</a></li> <li><a href=#client_body_timeout>client_body_timeout</a></li> <li><a href=#client_header_buffer_size>client_header_buffer_size</a></li> <li><a href=#client_header_timeout>client_header_timeout</a></li> <li><a href=#client_max_body_size>client_max_body_size</a></li> <li><a href=#connection_pool_size>connection_pool_size</a></li> <li><a href=#default_type>default_type</a></li> <li><a href=#directio>directio</a></li> <li><a href=#directio_alignment>directio_alignment</a></li> <li><a href=#disable_symlinks>disable_symlinks</a></li> <li><a href=#error_page>error_page</a></li> <li><a href=#etag>etag</a></li> <li><a href=#http>http</a></li> <li><a href=#if_modified_since>if_modified_since</a></li> <li><a href=#ignore_invalid_headers>ignore_invalid_headers</a></li> <li><a href=#internal>internal</a></li> <li><a href=#keepalive_disable>keepalive_disable</a></li> <li><a href=#keepalive_requests>keepalive_requests</a></li> <li><a href=#keepalive_timeout>keepalive_timeout</a></li> <li><a href=#large_client_header_buffers>large_client_header_buffers</a></li> <li><a href=#limit_except>limit_except</a></li> <li><a href=#limit_rate>limit_rate</a></li> <li><a href=#limit_rate_after>limit_rate_after</a></li> <li><a href=#lingering_close>lingering_close</a></li> <li><a href=#lingering_time>lingering_time</a></li> <li><a href=#lingering_timeout>lingering_timeout</a></li> <li><a href=#listen>listen</a></li> <li><a href=#location>location</a></li> <li><a href=#log_not_found>log_not_found</a></li> <li><a href=#log_subrequest>log_subrequest</a></li> <li><a href=#max_ranges>max_ranges</a></li> <li><a href=#merge_slashes>merge_slashes</a></li> <li><a href=#msie_padding>msie_padding</a></li> <li><a href=#msie_refresh>msie_refresh</a></li> <li><a href=#open_file_cache>open_file_cache</a></li> <li><a href=#open_file_cache_errors>open_file_cache_errors</a></li> <li><a href=#open_file_cache_min_uses>open_file_cache_min_uses</a></li> <li><a href=#open_file_cache_valid>open_file_cache_valid</a></li> <li><a href=#output_buffers>output_buffers</a></li> <li><a href=#port_in_redirect>port_in_redirect</a></li> <li><a href=#postpone_output>postpone_output</a></li> <li><a href=#read_ahead>read_ahead</a></li> <li><a href=#recursive_error_pages>recursive_error_pages</a></li> <li><a href=#request_pool_size>request_pool_size</a></li> <li><a href=#reset_timedout_connection>reset_timedout_connection</a></li> <li><a href=#resolver>resolver</a></li> <li><a href=#resolver_timeout>resolver_timeout</a></li> <li><a href=#root>root</a></li> <li><a href=#satisfy>satisfy</a></li> <li><a href=#send_lowat>send_lowat</a></li> <li><a href=#send_timeout>send_timeout</a></li> <li><a href=#sendfile>sendfile</a></li> <li><a href=#sendfile_max_chunk>sendfile_max_chunk</a></li> <li><a href=#server>server</a></li> <li><a href=#server_name>server_name</a></li> <li><a href=#server_name_in_redirect>server_name_in_redirect</a></li> <li><a href=#server_names_hash_bucket_size>server_names_hash_bucket_size</a></li> <li><a href=#server_names_hash_max_size>server_names_hash_max_size</a></li> <li><a href=#server_tokens>server_tokens</a></li> <li><a href=#tcp_nodelay>tcp_nodelay</a></li> <li><a href=#tcp_nopush>tcp_nopush</a></li> <li><a href=#try_files>try_files</a></li> <li><a href=#types>types</a></li> <li><a href=#types_hash_bucket_size>types_hash_bucket_size</a></li> <li><a href=#types_hash_max_size>types_hash_max_size</a></li> <li><a href=#underscores_in_headers>underscores_in_headers</a></li> <li><a href=#variables_hash_bucket_size>variables_hash_bucket_size</a></li> <li><a href=#variables_hash_max_size>variables_hash_max_size</a></li> </ul> </li> <li><a href=#embedded_variables>内嵌变量</a></li> </ul> <p><a id=directives></a></p> <h2 id=_1>指令<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <h3 id=absolute_redirect>absolute_redirect<a class=headerlink href=#absolute_redirect title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>absolute_redirect</strong> <code>on</code> &#124; <code>off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>absolute_redirect on;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> <tr> <td align=left><strong>提示</strong></td> <td align=left>该指令在 1.11.8 版本中出现</td> </tr> </tbody> </table> <p>如果禁用，nginx 发出的重定向将是相对的。</p> <p>另请参阅 <a href=#server_name_in_redirect>server_name_in_redirect</a> 和 <a href=#port_in_redirect>port_in_redirect</a> 指令。</p> <h3 id=aio>aio<a class=headerlink href=#aio title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>aio</strong> <code>on</code> &#124; <code>off</code> &#124; <code>threads[=pool]</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>aio off;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> <tr> <td align=left><strong>提示</strong></td> <td align=left>该指令在 0.8.11 版本中出现</td> </tr> </tbody> </table> <p>启用或禁用在 FreeBSD 和 Linux 上使用异步文件 I/O（AIO）：</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/video/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>aio</span><span class=w>            </span><span class=no>on</span><span class=p>;</span>
<span class=w>    </span><span class=kn>output_buffers</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=mi>64k</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>在 FreeBSD 上，AIO 从 FreeBSD 4.3 开始可用。在 FreeBSD 11.0 之前，可以将 AIO 静态链接到内核中：</p> <div class=highlight><pre><span></span><code><span class=k>options</span><span class=w> </span><span class=s>VFS_AIO</span>
</code></pre></div> <p>或作为一个内核可加载模块动态加载：</p> <div class=highlight><pre><span></span><code><span class=k>kldload</span><span class=w> </span><span class=s>aio</span>
</code></pre></div> <p>在 Linux 上，AIO 从内核版本为 2.6.22 开始可用。此外，有必要启用 <a href=#directio>directio</a>，否则读取将被阻塞：</p> <p><div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/video/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>aio</span><span class=w>            </span><span class=no>on</span><span class=p>;</span>
<span class=w>    </span><span class=kn>directio</span><span class=w>       </span><span class=mi>512</span><span class=p>;</span>
<span class=w>    </span><span class=kn>output_buffers</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=mi>128k</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> 在 Linux 上，<a href=#directio>directio</a> 只能用于读取 512 字节边界对齐的块（或 XFS 4K）。文件未对齐的末端以阻塞模式读取。对于字节范围请求和不是从文件开头开始的 FLV 请求也是如此：在文件的开头和结尾读取未对齐的数据将被阻塞。</p> <p>当在 Linux 上启用 AIO 和 <a href=#sendfile>sendfile</a> 时，AIO 用于大于或等于 <a href=#directio>directio</a> 指令指定大小的文件，而 <a href=#sendfile>sendfile</a> 用于较小的文件（禁用 <a href=#directio>directio</a> 时也是如此）。</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/video/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>sendfile</span><span class=w>       </span><span class=no>on</span><span class=p>;</span>
<span class=w>    </span><span class=kn>aio</span><span class=w>            </span><span class=no>on</span><span class=p>;</span>
<span class=w>    </span><span class=kn>directio</span><span class=w>       </span><span class=mi>8m</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>最后，可以使用多线程（1.7.11）读取和<a href=#sendfile>发送</a>文件，不会阻塞工作进程：</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/video/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>sendfile</span><span class=w>       </span><span class=no>on</span><span class=p>;</span>
<span class=w>    </span><span class=kn>aio</span><span class=w>            </span><span class=s>threads</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>读取和发送文件操作被卸载到指定<a href=#thread_pool>池</a>中的线程。如果省略池名称，则使用名称为 <code>default</code> 的池。池名也可以用变量设置：</p> <div class=highlight><pre><span></span><code><span class=k>aio</span><span class=w> </span><span class=s>threads=pool</span><span class=nv>$disk</span><span class=p>;</span>
</code></pre></div> <p>默认情况下，多线程是禁用状态，它应该使用 <code>--with-threads</code> 配置参数启用。目前，多线程仅与 <a href=http://nginx.org/en/docs/events.html#epoll>epoll</a>、<a href=http://nginx.org/en/docs/events.html#kqueue>kqueue</a> 和 <a href=http://nginx.org/en/docs/events.html#eventport>eventport</a> 方式兼容。仅在 Linux 上支持多线程发送文件。</p> <p>另请参见 <a href=#sendfile>sendfile</a> 指令。</p> <h3 id=aio_write>aio_write<a class=headerlink href=#aio_write title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>aio_write</strong> <code>on</code> &#124; <code>off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>aio_write off;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> <tr> <td align=left><strong>提示</strong></td> <td align=left>该指令在 1.9.13 版本中出现</td> </tr> </tbody> </table> <p>如果启用 <a href=#aio>aio</a>，则指定是否写入文件。目前，这仅在使用 aio 线程时有效，并且仅限于将从代理服务器接收的数据写入临时文件。</p> <h3 id=alias>alias<a class=headerlink href=#alias title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>alias</strong> <code>path</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>——</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>location</td> </tr> </tbody> </table> <p>定义指定 location 的替换。例如，使用以下配置</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/i/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>alias</span><span class=w> </span><span class=s>/data/w3/images/</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p><code>/i/top.gif</code> 的请求，将发送 <code>/data/w3/images/top.gif</code> 文件。</p> <p><code>path</code> 值可以包含变量，除 <code>$document_root</code> 和 <code>$realpath_root</code> 外。</p> <p>如果在使用正则表达式定义的 location 内使用了别名，那么这种正则表达式应该包含捕获，并且别名应该引用这些捕获（0.7.40），例如：</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=p>~</span><span class=w> </span><span class=sr>^/users/(.+\.(?:gif|jpe?g|png))$</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>alias</span><span class=w> </span><span class=s>/data/w3/images/</span><span class=nv>$1</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>当 location 与指令值的最后一部分匹配时：</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/images/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>alias</span><span class=w> </span><span class=s>/data/w3/images/</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>更好的方式是使用 <a href=#root>root</a> 指令：</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/images/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>root</span><span class=w> </span><span class=s>/data/w3</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <h3 id=chunked_transfer_encoding>chunked_transfer_encoding<a class=headerlink href=#chunked_transfer_encoding title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>chunked_transfer_encoding</strong> <code>on</code> &#124; <code>off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>chunked_transfer_encoding on;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>允许在 HTTP/1.1 中禁用分块传输编码。在使用的软件未能支持分块编码时它可能会派上用场。</p> <h3 id=client_body_buffer_size>client_body_buffer_size<a class=headerlink href=#client_body_buffer_size title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>client_body_buffer_size</strong> <code>size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>client_body_buffer_size 8k</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>设置读取客户端请求体的缓冲区大小。如果请求体大于缓冲区，则整个体或仅将其部分写入<a href=#client_body_temp_path>临时文件</a>。默认情况下，缓冲区大小等于两个内存页。在 x86、其他 32 位平台和 x86-64 上是 8K。在其他 64 位平台上通常为 16K。</p> <h3 id=client_body_in_file_only>client_body_in_file_only<a class=headerlink href=#client_body_in_file_only title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>client_body_in_file_only</strong> <code>on</code> &#124; <code>clean</code> &#124; <code>off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>client_body_in_file_only off;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>确定 nginx 是否应将整个客户端请求体保存到文件中。可以在调试期间或使用 <code>$request_body_file</code> 变量或模块 <a href=../ngx_http_perl_module/ >ngx_http_perl_module</a> 的 <a href=../ngx_http_perl_module/#methods>$r-&gt;request_body_file</a> 方法时使用此指令。</p> <p>当设置为 <code>on</code> 值时，临时文件在请求处理后不会被删除。</p> <p>值 <code>clean</code> 会将请求处理后剩下的临时文件删除。</p> <h3 id=client_body_in_single_buffer>client_body_in_single_buffer<a class=headerlink href=#client_body_in_single_buffer title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>client_body_in_single_buffer</strong> <code>on</code> &#124; <code>off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>client_body_in_single_buffer off;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>确定 nginx 是否应将整个客户端请求体保存在单个缓冲区中。在使用 <code>$request_body</code> 变量时，建议使用该指令，用来保存涉及的复制操作次数。</p> <h3 id=client_body_temp_path>client_body_temp_path<a class=headerlink href=#client_body_temp_path title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>client_body_temp_path</strong> <code>path [level1 [level2 [level3]]]</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>client_body_temp_path client_body_temp;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>定义用于存储持有客户端请求主体的临时文件的目录。最多可以在指定目录下使用三级子目录层次结构。例如以下配置</p> <div class=highlight><pre><span></span><code><span class=k>client_body_temp_path</span><span class=w> </span><span class=s>/spool/nginx/client_temp</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
</code></pre></div> <p>临时文件的路径可以如下：</p> <div class=highlight><pre><span></span><code><span class=k>/spool/nginx/client_temp/7/45/00000123457</span>
</code></pre></div> <h3 id=client_body_timeout>client_body_timeout<a class=headerlink href=#client_body_timeout title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>client_body_timeout</strong> <code>time</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>client_body_timeout 60s;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>定义读取客户端请求正文的超时时间。超时设置仅是在两个连续读操作之间的时间间隔，而不是整个请求体的传输过程。如果客户端在此时间内没有发送任何内容，则会将 408（请求超时）错误返回给客户端。</p> <h3 id=client_header_buffer_size>client_header_buffer_size<a class=headerlink href=#client_header_buffer_size title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>client_header_buffer_size</strong> <code>size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>client_header_buffer_size 1k;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server</td> </tr> </tbody> </table> <p>设置读取客户端请求头的缓冲区大小。对于大多数请求，1K 字节的缓冲区就足够了。但是，如果请求中包含长 cookie，或者来自 WAP 客户端，则可能 1K 是不适用的。如果请求行或请求头域不适合此缓冲区，则会分配由 <a href=#large_client_header_buffers>large_client_header_buffers</a> 指令配置的较大缓冲区。</p> <h3 id=client_header_timeout>client_header_timeout<a class=headerlink href=#client_header_timeout title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>client_header_timeout</strong> <code>time</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>client_header_timeout 60s;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server</td> </tr> </tbody> </table> <p>定义读取客户端请求头的超时时间。如果客户端在这段时间内没有传输整个报头，则将 408（请求超时）错误返回给客户端。</p> <h3 id=client_max_body_size>client_max_body_size<a class=headerlink href=#client_max_body_size title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>client_header_timeout</strong> <code>size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>client_max_body_size 1m;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>在 <strong>Content-Length</strong> 请求头域中指定客户端请求体的最大允许大小。如果请求的大小超过配置值，则将 413 （请求实体过大）错误返回给客户端。请注意，浏览器无法正确显示此错误。将 <code>size</code> 设置为 0 将禁用检查客户端请求正文大小。</p> <h3 id=connection_pool_size>connection_pool_size<a class=headerlink href=#connection_pool_size title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>connection_pool_size</strong> <code>size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>connection_pool_size 256</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server</td> </tr> </tbody> </table> <p>允许精确调整每个连接的内存分配。该指令对性能影响最小，一般不建议使用。默认情况下，32 位平台上的大小为 256 字节，64 位平台上为 512 字节。</p> <blockquote> <p>在 1.9.8 版本之前，所有平台上的默认值都为 256。</p> </blockquote> <h3 id=default_type>default_type<a class=headerlink href=#default_type title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>default_type</strong> <code>mime-type</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>default_type text/plain;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>定义响应的默认 MIME 类型。可以使用 <a href=#types>types</a> 指令对 MIME 类型的文件扩展名进行映射。</p> <h3 id=directio>directio<a class=headerlink href=#directio title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>directio</strong> <code>size</code> | <code>off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>directio off;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>开启当读取大于或等于指定大小的文件时，使用 <code>O_DIRECT</code> 标志（FreeBSD、Linux）、<code>F_NOCACHE</code> 标志（macOS）或 <code>directio()</code> 函数（Solaris）。该指令自动禁用（0.7.15）给定请求使用的 <a href=#sendfile>sendfile</a>。它可以用于服务大文件：</p> <div class=highlight><pre><span></span><code><span class=k>directio</span><span class=w> </span><span class=mi>4m</span><span class=p>;</span>
</code></pre></div> <p>或当在 Linux 上使用 <a href=#aio>aio</a> 时。</p> <h3 id=directio_alignment>directio_alignment<a class=headerlink href=#directio_alignment title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>directio_alignment</strong> <code>size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>directio_alignment 512;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> <tr> <td align=left><strong>提示</strong></td> <td align=left>该指令在 0.8.11 版本中出现</td> </tr> </tbody> </table> <p>设置 <a href=#directio>directio</a> 的对齐方式。在大多数情况下，512 字节的对齐就足够了。但是，在 Linux 下使用 XFS 时，需要增加到 4K。</p> <h3 id=disable_symlinks>disable_symlinks<a class=headerlink href=#disable_symlinks title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>disable_symlinks</strong> <code>off</code>; <br> <strong>disable_symlinks on</strong> | <code>if_not_owner [from=part]</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>disable_symlinks off;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> <tr> <td align=left><strong>提示</strong></td> <td align=left>该指令在 1.1.15 版本中出现</td> </tr> </tbody> </table> <p>确定打开文件时应如何处理符号链接：</p> <ul> <li> <p><code>off</code></p> <p>允许路径名中的符号链接的，不执行检查。这是默认行为。 - <code>on</code></p> <p>如果路径名存在是符号链接的组件，则拒绝对文件的访问。</p> </li> <li> <p><code>if_not_owner</code></p> <p>如果路径名存在是符号链接的组件，并且链接指向的链接和对象为不同所有者，则拒绝访问文件。</p> </li> <li> <p><code>from=part</code></p> <p>当检查符号链接（参数 <code>on</code> 和 <code>if_not_owner</code>）时，通常会检查路径名的所有组件。可以通过另外指定 <code>from=part</code> 参数来避免检查路径名的初始部分中的符号链接。在这种情况下，只能从指定的初始部分后面的路径名组件检查符号链接。如果该值不是检查的路径名的初始部分，则会检查整个路径名，相当于没有指定此参数。如果该值与整个文件名匹配，则不会检查符号链接。参数值可以包含变量。</p> </li> </ul> <p>例如：</p> <div class=highlight><pre><span></span><code><span class=k>disable_symlinks</span><span class=w> </span><span class=no>on</span><span class=w> </span><span class=s>from=</span><span class=nv>$document_root</span><span class=p>;</span>
</code></pre></div> <p>此指令仅适用于具有 <code>openat()</code> 和 <code>fstatat()</code> 接口的系统。这样的系统包括现代版本的FreeBSD、Linux 和 Solaris。</p> <p>参数 <code>on</code> 和 <code>if_not_owner</code> 增加了处理开销。</p> <blockquote> <p>在不支持打开目录仅用于搜索的系统上，要使用这些参数，需要 worker 进程对所有正在检查的目录具有读取权限。</p> <p><a href=../ngx_http_autoindex_module/ >ngx_http_autoindex_module</a>、<a href=../ngx_http_random_index_module/ >ngx_http_random_index_module</a> 和 <a href=../ngx_http_dav_module/ >ngx_http_dav_module</a> 模块目前忽略此指令。</p> </blockquote> <h3 id=error_page>error_page<a class=headerlink href=#error_page title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>error_page</strong> <code>code ... [=[response]] uri</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>——</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location、location 中的 if</td> </tr> </tbody> </table> <p>定义针对指定错误显示的 URI。<code>uri</code> 值可以包含变量。</p> <p>例如：</p> <div class=highlight><pre><span></span><code><span class=k>error_page</span><span class=w> </span><span class=mi>404</span><span class=w>             </span><span class=s>/404.html</span><span class=p>;</span>
<span class=k>error_page</span><span class=w> </span><span class=mi>500</span><span class=w> </span><span class=mi>502</span><span class=w> </span><span class=mi>503</span><span class=w> </span><span class=mi>504</span><span class=w> </span><span class=s>/50x.html</span><span class=p>;</span>
</code></pre></div> <p>这会导致客户端请求方法更改为 <code>GET</code>，内部重定向到指定的 <code>uri</code>（除 <code>GET</code> 和 <code>HEAD</code> 之外的所有方法）。</p> <p>此外，可以使用 <code>=response</code> 语法将修改响应代码，例如：</p> <div class=highlight><pre><span></span><code><span class=k>error_page</span><span class=w> </span><span class=mi>404</span><span class=w> </span><span class=p>=</span><span class=mi>200</span><span class=w> </span><span class=s>/empty.gif</span><span class=p>;</span>
</code></pre></div> <p>如果错误响应是由代理服务器或 FastCGI/uwsgi/SCGI 服务器处理，并且服务器可能返回不同的响应代码（例如，200、302、401 或 404），则可以使用其返回的代码进行响应：</p> <div class=highlight><pre><span></span><code><span class=k>error_page</span><span class=w> </span><span class=mi>404</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>/404.php</span><span class=p>;</span>
</code></pre></div> <p>如果在内部重定向时不需要更改 URI 和方法，则可以将错误处理传递给一个命名了的 location：</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>error_page</span><span class=w> </span><span class=mi>404</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>@fallback</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>location</span><span class=w> </span><span class=s>@fallback</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://backend</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <blockquote> <p>如果 <code>uri</code> 处理导致发生错误，最后发生错误的状态代码将返回给客户端。</p> </blockquote> <p>也可以使用 URL 重定向进行错误处理：</p> <div class=highlight><pre><span></span><code><span class=k>error_page</span><span class=w> </span><span class=mi>403</span><span class=w>      </span><span class=s>http://example.com/forbidden.html</span><span class=p>;</span>
<span class=k>error_page</span><span class=w> </span><span class=mi>404</span><span class=w> </span><span class=p>=</span><span class=mi>301</span><span class=w> </span><span class=s>http://example.com/notfound.html</span><span class=p>;</span>
</code></pre></div> <p>在这种情况下，默认将响应代码 302 返回给客户端。它只能是重定向状态代码其中之一（301、302、303、307 和 308）。</p> <blockquote> <p>在 1.1.16 和 1.0.13 版本之前，代码 307 没有被视为重定向。</p> <p>直到 1.13.0 版本，代码 308 才被视为重定向。</p> </blockquote> <p>当且仅当没有在当前级别上定义 error_page 指令时，指令才从上一级继承这些特性。</p> <h3 id=etag>etag<a class=headerlink href=#etag title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>etag</strong> <code>on</code> | <code>off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>etag on;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> <tr> <td align=left><strong>提示</strong></td> <td align=left>该指令在 1.3.3 版本中出现</td> </tr> </tbody> </table> <p>启用或禁用自动生成静态资源 <strong>ETag</strong> 响应头字段。</p> <h3 id=http>http<a class=headerlink href=#http title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>http</strong> <code>{ ... }</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>——</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>main</td> </tr> </tbody> </table> <p>提供指定 HTTP server 指令的配置文件上下文。</p> <h3 id=if_modified_since>if_modified_since<a class=headerlink href=#if_modified_since title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>if_modified_since</strong> <code>off</code> | <code>exact</code> | <code>before</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>if_modified_since exact;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> <tr> <td align=left><strong>提示</strong></td> <td align=left>该指令在 0.7.24 版本中出现</td> </tr> </tbody> </table> <p>指定如何将响应的修改时间与 <strong>If-Modified-Since</strong> 请求头字段中的时间进行比较：</p> <ul> <li> <p><code>off</code></p> <p>忽略 <strong>If-Modified-Since</strong> 请求头字段（0.7.34） - <code>exact</code></p> <p>完全匹配 - <code>before</code></p> <p>响应的修改时间小于或等于 <strong>If-Modified-Since</strong> 请求头字段中的时间</p> </li> </ul> <h3 id=ignore_invalid_headers>ignore_invalid_headers<a class=headerlink href=#ignore_invalid_headers title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>ignore_invalid_headers</strong> <code>on</code> | <code>off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>ignore_invalid_headers on;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server</td> </tr> </tbody> </table> <p>控制是否应忽略具有无效名称的头字段。有效名称由英文字母、数字、连字符或下划线组成（由 <a href=#underscores_in_headers>underscores_in_headers</a> 指令控制）。</p> <p>如果在 <a href=#server>server</a> 级别指定了该指令，则其值仅在 server 为默认 server 时使用。指定的值也适用于监听相同地址和端口的所有虚拟服务器。</p> <h3 id=internal>internal<a class=headerlink href=#internal title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>internal</strong>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>——</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>location</td> </tr> </tbody> </table> <p>指定给定的 location 只能用于内部请求。对于外部请求，返回客户端错误 404（未找到）。内部请求如下：</p> <ul> <li>请求由 <a href=#error_page>error_page</a>、<a href=#index>index</a>、<a href=#random_index>random_index</a> 和 <a href=#try_files>try_files</a> 指令重定向</li> <li>来 upstream server 的 <strong>X-Accel-Redirect</strong> 响应头字段重定向的请求</li> <li>由 <a href=../ngx_http_ssi_module/ >ngx_http_ssi_module</a> 模块的 <code>include virtual</code> 命令、<a href=../ngx_http_addition_module/ >ngx_http_addition_module</a> 模块指令和 <a href=../ngx_http_auth_request_module/#auth_request>auth_request</a> 和 <a href=../ngx_http_mirror_module/#mirror>mirror</a> 指令组成的子请求</li> <li>由 <a href=../ngx_http_rewrite_module/#rewrite>rewrite</a> 指令更改的请求</li> </ul> <p>示例：</p> <div class=highlight><pre><span></span><code><span class=k>error_page</span><span class=w> </span><span class=mi>404</span><span class=w> </span><span class=s>/404.html</span><span class=p>;</span>

<span class=k>location</span><span class=w> </span><span class=s>/404.html</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>internal</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <blockquote> <p>每个请求限制 10 个内部重定向，以防止不正确配置引发的请求处理死循环。如果达到此限制，则返回错误 500（内部服务器错误）。在这种情况下，可以在错误日志中看到 <code>rewrite or internal redirection cycle</code> 消息。</p> </blockquote> <h3 id=keepalive_disable>keepalive_disable<a class=headerlink href=#keepalive_disable title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>keepalive_disable</strong> <code>none</code> | <code>browser ...</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>keepalive_disable msie6;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>禁用与行为异常的浏览器保持连接。<code>browser</code> 参数指定哪些浏览器将受到影响。一旦接收到 POST 请求，值 <code>msie6</code> 将禁用与旧版本 MSIE 保持连接。值 <code>safari</code> 禁用与 macOS 和类似 MacOS 的操作系统上的 Safari 和 Safari 浏览器保持连接。值 <code>none</code> 启用与所有浏览器保持连接。</p> <blockquote> <p>在 1.1.18 版本之前，值 <code>safari</code> 匹配所有操作系统上的所有 Safari 和类 Safari 浏览器，并且默认情况下，禁用与它们保持连接。</p> </blockquote> <h3 id=keepalive_requests>keepalive_requests<a class=headerlink href=#keepalive_requests title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>keepalive_requests</strong> <code>number</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>keepalive_requests 100;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> <tr> <td align=left><strong>提示</strong></td> <td align=left>该指令在 0.8.0 版本中出现</td> </tr> </tbody> </table> <p>设置通过一个保持活动（keep-alive）连接可以提供的最大请求数。在发出的请求达到最大数量后，连接将被关闭。</p> <h3 id=keepalive_timeout>keepalive_timeout<a class=headerlink href=#keepalive_timeout title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>keepalive_timeout</strong> <code>timeout</code> <code>[header_timeout]</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>keepalive_timeout 75s;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>第一个参数设置一个超时时间，keep-alive 客户端连接将在服务端保持打开状态。零值将禁用 keep-alive 客户端连接。可选的第二个参数在 <strong>Keep-Alive: timeout=<code>time</code></strong> 响应头域中设置一个值。两个参数可能不同。</p> <p>Mozilla 和 Konqueror 会识别 **Keep-Alive: timeout=<code>time</code> 头字段。MSIE 在大约在 60 秒钟内自行关闭 keep-alive 连接。</p> <h3 id=large_client_header_buffers>large_client_header_buffers<a class=headerlink href=#large_client_header_buffers title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>large_client_header_buffers</strong> <code>number size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>arge_client_header_buffers 4 8k;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server</td> </tr> </tbody> </table> <p>设置用于读取大客户端请求头的缓冲区的最大 <code>number</code>（数量）和 <code>size</code>（大小）。请求行不能超过一个缓冲区的大小，否则将返回 414（请求 URI 太长）错误给客户端。请求头字段也不能超过一个缓冲区的大小，否则将返回 400（错误请求）错误给客户端。缓冲区只能按需分配。默认情况下，缓冲区大小等于 8K 字节。如果在请求处理结束之后，连接被转换为 keep-alive 状态，这些缓冲区将被释放。</p> <h3 id=limit_except>limit_except<a class=headerlink href=#limit_except title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>limit_except</strong> <code>method ... { ... }</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>——</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>location</td> </tr> </tbody> </table> <p>限制给定的 location 内允许的 HTTP 方法。<code>method</code> 参数可以是以下之一：<code>GET</code>、<code>HEAD</code>、<code>POST</code>、<code>PUT</code>、<code>DELETE</code>、<code>MKCOL</code>、<code>COPY</code>、<code>MOVE</code>、<code>OPTIONS</code>、<code>PROPFIND</code>、<code>PROPPATCH</code>、<code>LOCK</code>、<code>UNLOCK</code> 或 <code>PATCH</code>。允许 <code>GET</code> 方法也将使得 <code>HEAD</code>方法被允许。可以使用 <a href=../ngx_http_access_module/ >ngx_http_access_module</a> 和 <a href=../ngx_http_auth_basic_module/ >ngx_http_auth_basic_module</a> 模块指令来限制对其他方法的访问：</p> <div class=highlight><pre><span></span><code><span class=k>limit_except</span><span class=w> </span><span class=s>GET</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>allow</span><span class=w> </span><span class=mi>192</span><span class=s>.168.1.0/32</span><span class=p>;</span>
<span class=w>    </span><span class=kn>deny</span><span class=w>  </span><span class=s>all</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>请注意，这将限制访问除 <code>GET</code> 和 <code>HEAD</code> 之外的所有方法。</p> <h3 id=limit_rate>limit_rate<a class=headerlink href=#limit_rate title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>limit_rate</strong> <code>rate</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>limit_rate 0;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location、location 中的 if</td> </tr> </tbody> </table> <p>限制客户端的响应传输速率。<code>rate</code> 以字节/秒为单位。零值将禁用速率限制。限制设置是针对每个请求，因此如果客户端同时打开两个连接，则整体速率将是指定限制的两倍。</p> <p>也可以在 <code>$limit_rate</code> 变量中设置速率限制。根据某些条件来限制速率可能会有用：</p> <div class=highlight><pre><span></span><code><span class=k>server</span><span class=w> </span><span class=p>{</span>

<span class=w>    </span><span class=kn>if</span><span class=w> </span><span class=s>(</span><span class=nv>$slow</span><span class=s>)</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kn>set</span><span class=w> </span><span class=nv>$limit_rate</span><span class=w> </span><span class=mi>4k</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>

<span class=w>    </span><span class=kn>...</span>
<span class=err>}</span>
</code></pre></div> <p>也可以在代理服务器响应的 <strong>X-Accel-Limit-Rate</strong> 头字段中设置速率限制。可以使用 <a href=../ngx_http_proxy_module/#proxy_ignore_headers>proxy_ignore_headers</a>、<a href=../ngx_http_fastcgi_module/#fastcgi_ignore_headers>fastcgi_ignore_headers</a>、<a href=../ngx_http_uwsgi_module/#uwsgi_ignore_headers>uwsgi_ignore_headers</a> 和 <a href=../ngx_http_scgi_module/#scgi_ignore_headers>scgi_ignore_headers</a> 指令禁用此功能。</p> <h3 id=lingering_time>lingering_time<a class=headerlink href=#lingering_time title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>lingering_time</strong> <code>time</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>lingering_time 30s;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>当 <a href=./#lingering_close>lingering_close</a> 生效时，该指令指定 nginx 处理（读取和忽略）来自客户端的额外数据的最长时间。之后，连接将被关闭，即使还有更多的数据。</p> <h3 id=lingering_timeout>lingering_timeout<a class=headerlink href=#lingering_timeout title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>lingering_timeout</strong> <code>time</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>lingering_timeout 5s;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>当 <a href=./#lingering_close>lingering_close</a> 生效时，该指令指定更多的客户端数据到达的最长等待时间。如果在此期间未收到数据，则关闭连接。否则，读取和忽略数据，nginx 再次开始等待更多的数据。<strong>wait-read-ignore</strong> 循环被重复，但不再由 <a href=#lingering_time>lingering_time</a> 指令指定。</p> <h3 id=listen>listen<a class=headerlink href=#listen title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>listen</strong> <code>address[:port] [default_server] [ssl] [http2 \| spdy] [proxy_protocol] [setfib=number] [fastopen=number] [backlog=number] [rcvbuf=size] [sndbuf=size] [accept_filter=filter] [deferred] [bind] [ipv6only=on\|off] [reuseport] [so_keepalive=on\|off\|[keepidle]:[keepintvl]:[keepcnt]]</code>; <br> <strong>listen</strong> <code>port [default_server] [ssl] [http2 \| spdy] [proxy_protocol] [setfib=number] [fastopen=number] [backlog=number] [rcvbuf=size] [sndbuf=size] [accept_filter=filter] [deferred] [bind] [ipv6only=on\|off] [reuseport] [so_keepalive=on\|off\|[keepidle]:[keepintvl]:[keepcnt]]</code>; <br> <strong>listen</strong> <code>unix:path [default_server] [ssl] [http2 \| spdy] [proxy_protocol] [backlog=number] [rcvbuf=size] [sndbuf=size] [accept_filter=filter] [deferred] [bind] [so_keepalive=on\|off\|[keepidle]:[keepintvl]:[keepcnt]]</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>listen *:80 | *:8000;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>server</td> </tr> </tbody> </table> <p>设置 IP 的 <code>address</code> （地址）和 <code>port</code> （端口），或服务器接受请求的 UNIX 域套接字的 <code>path</code> （路径）。可以同时指定 <code>addres</code> （地址）和 <code>port</code> （端口），也可以只指定 <code>address</code> （地址）或 <code>port</code> （端口）。<code>address</code> 也可以是主机名，例如：</p> <p><div class=highlight><pre><span></span><code><span class=k>listen</span><span class=w> </span><span class=n>127.0.0.1</span><span class=p>:</span><span class=mi>8000</span><span class=p>;</span>
<span class=k>listen</span><span class=w> </span><span class=mi>127</span><span class=s>.0.0.1</span><span class=p>;</span>
<span class=k>listen</span><span class=w> </span><span class=mi>8000</span><span class=p>;</span>
<span class=k>listen</span><span class=w> </span><span class=s>*:8000</span><span class=p>;</span>
<span class=k>listen</span><span class=w> </span><span class=n>localhost</span><span class=p>:</span><span class=mi>8000</span><span class=p>;</span>
</code></pre></div> IPv6 地址（0.7.36）在方括号中指定：</p> <p><div class=highlight><pre><span></span><code><span class=k>listen</span><span class=w> </span><span class=s>[::]:8000</span><span class=p>;</span>
<span class=k>listen</span><span class=w> </span><span class=s>[::1]</span><span class=p>;</span>
</code></pre></div> UNIX 域套接字（0.8.21）用 <code>unix:</code> 前缀指定：</p> <div class=highlight><pre><span></span><code><span class=k>listen</span><span class=w> </span><span class=s>unix:/var/run/nginx.sock</span><span class=p>;</span>
</code></pre></div> <p>如果只指定 <code>address</code>，则使用 80 端口。</p> <p>如果指令不存在，那么如果 nginx 是以超级用户权限运行，则使用 <code>*:80</code>，否则使用 <code>*:8000</code>。</p> <p><code>default_server</code> 参数（如果存在）将使得服务器成为指定 <code>address:port</code> 对的默认服务器。如果没有指令有 <code>default_server</code> 参数，那么具有 <code>address:port</code> 对的第一个服务器将是该对的默认服务器。</p> <blockquote> <p>在 0.8.21 之前的版本中，此参数简单地命名为 <code>default</code>。</p> </blockquote> <p><code>ssl</code> 参数（0.7.14）允许指定该端口上接受的所有连接都应该工作在 SSL 模式。这样可以为处理 HTTP 和 HTTPS 请求的服务器提供更紧凑的<a href=介绍/配置HTTPS服务器.md#single_http_https_server>配置</a>。</p> <p><code>http2</code> 参数（1.9.5）配置端口接受 <a href=../ngx_http_v2_module/ >HTTP/2</a> 连接。通常，为了能够工作，还应该指定 <code>ssl</code> 参数，但也可以将 nginx 配置为接受没有 SSL 的 HTTP/2 连接。</p> <p><code>spdy</code> 参数（1.3.15 — 1.9.4）允许在此端口上接受 <a href=../ngx_http_spdy_module/ >SPDY</a> 连接。通常，为了能够工作，还应该指定 <code>ssl</code> 参数，但也可以将 nginx 配置为接受没有 SSL 的 SPDY 连接。</p> <p><code>proxy_protocol</code> 参数（1.5.12）允许指定此端口上接受的所有连接都应使用 <a href=http://www.haproxy.org/download/1.5/doc/proxy-protocol.txt>PROXY 协议</a>。</p> <p><code>listen</code> 指令可以有特定于套接字相关系统调用的几个附加参数。这些参数可以在任何 <code>listen</code> 指令中指定，但对于给定的 <code>address:port</code> 只能使用一次。</p> <blockquote> <p>在 0.8.21 之前的版本中，它们只能在 <code>listen</code> 指令中与默认参数一起指定。</p> </blockquote> <ul> <li> <p><code>setfib=number</code></p> <p>此参数（0.8.44）设置相关联的路由表，监听套接字的 FIB（<code>SO_SETFIB</code> 选项）。目前只适用于 FreeBSD。 - <code>fastopen=number</code></p> <p>为侦听套接字启用 <strong><a href=http://en.wikipedia.org/wiki/TCP_Fast_Open>TCP Fast Open</a></strong> （1.5.8），并限制尚未完成三次握手的连接队列的最大长度。</p> <blockquote> <p>不要启用此功能，除非服务器可以一次处理接收多个<a href=https://tools.ietf.org/html/rfc7413#section-6.1>相同的 SYN 包的数据</a>。 - <code>backlog=number</code></p> </blockquote> <p>在 <code>listen()</code> 调用中设置限制挂起连接队列的最大长度的<code>backlog</code> 参数。默认情况下，FreeBSD、DragonFly BSD 和 macOS 上的 <code>backlog</code> 设置为 -1，在其他平台上设置为 511。 - <code>rcvbuf=size</code></p> <p>设置侦听套接字的接收缓冲区大小（<code>SO_RCVBUF</code> 选项）。 - <code>sndbuf=size</code></p> <p>设置侦听套接字的发送缓冲区大小（<code>SO_SNDBUF</code> 选项）。 - <code>accept_filter=filter</code></p> <p>为侦听套接字设置接受过滤器（<code>SO_ACCEPTFILTER</code> 选项）的名称，该套接字将传入的连接在传递给 <code>accept()</code> 之前进行过滤。这只适用于 FreeBSD 和 NetBSD 5.0+。可设置值<a href=http://man.freebsd.org/accf_data>dataready</a> 或 <a href=http://man.freebsd.org/accf_http>httpready</a>。 - <code>deferred</code></p> <p>指示在 Linux 上使用延迟 <code>accept()</code>（<code>TCP_DEFER_ACCEPT</code> 套接字选项）。 - <code>bind</code></p> <p>指示为给定的 <code>address:port</code> 对单独进行 <code>bind()</code> 调用。这是有用的，因为如果有多个有相同端口但不同地址的 <code>listen</code> 指令，并且其中一个 <code>listen</code> 指令监听给定端口（<code>*:port</code>）的所有地址，则 nginx 将 <code>bind()</code> 应用到<code>*:port</code>。应该注意的是，在这种情况下将会进行 <code>getsockname()</code> 系统调用，以确定接受该连接的地址。如果使用 <code>setfib</code>、<code>backlog</code>、<code>rcvbuf</code>、<code>sndbuf</code>、<code>accept_filter</code>、<code>deferred</code>、<code>ipv6only</code> 或 <code>so_keepalive</code> 参数，那么对于给定的 <code>address:port</code> 对将始终进行单独的 <code>bind()</code> 调用。 - <code>ipv6only=ON|OFF</code></p> <p>此参数（0.7.42）确定（通过 <code>IPV6_V6ONLY</code> 套接字选项）一个监听通配符地址 <code>[::]</code> 的 IPv6 套接字是否仅接受 IPv6 连接或 IPv6 和 IPv4 连接。此参数默认为开启。它只能在启动时设置一次。</p> <blockquote> <p>在 1.3.4 版本之前，如果省略该参数，则操作系统的设置将对于套接字产生影响。 - <code>reuseport</code></p> </blockquote> <p>此参数（1.9.1）指示为每个工作进程创建一个单独的监听套接字（使用 <code>SO_REUSEPORT</code> 套接字选项），允许内核在工作进程之间分配传入的连接。目前只适用于 Linux 3.9+ 和 DragonFly BSD。</p> <blockquote> <p>不当地使用此选项可能会带来安全<a href=http://man7.org/linux/man-pages/man7/socket.7.html>隐患</a>。 - <code>SO_KEEPALIVE=ON|OFF|[keepidle]:[keepintvl]:[keepcnt]</code></p> </blockquote> <p>此参数（1.1.11）配置监听套接字的 <strong>TCP keepalive</strong> 行为。如果省略此参数，则操作系统的设置将对套接字产生影响。如果设置为 <code>on</code>，则套接字将打开 <code>SO_KEEPALIVE</code> 选项。如果设置为 <code>off</code>，则 <code>SO_KEEPALIVE</code> 选项将被关闭。一些操作系统支持在每个套接字上使用 <code>TCP_KEEPIDLE</code>、<code>TCP_KEEPINTVL</code> 和 <code>TCP_KEEPCNT</code> 套接字选项来设置 TCP keepalive 参数。在这样的系统上（目前为 Linux 2.4+、NetBSD 5+ 和 FreeBSD 9.0-STABLE），可以使用 <code>keepidle</code>、<code>keepintvl</code>和 <code>keepcnt</code> 参数进行配置。可以省略一个或两个参数，在这种情况下，相应套接字选项的系统默认设置将生效。例如，</p> <div class=highlight><pre><span></span><code><span class=k>SO_KEEPALIVE=30m::10</span>
</code></pre></div> <p>将空闲超时（<code>TCP_KEEPIDLE</code>）设置为 30 分钟，将探测间隔（<code>TCP_KEEPINTVL</code>）设置为系统默认值，并将探测数量（<code>TCP_KEEPCNT</code>）设置为 10 个探测。</p> </li> </ul> <p>示例：</p> <div class=highlight><pre><span></span><code><span class=k>listen</span><span class=w> </span><span class=mi>127</span><span class=s>.0.0.1</span><span class=w> </span><span class=s>default_server</span><span class=w> </span><span class=s>accept_filter=dataready</span><span class=w> </span><span class=s>backlog=1024</span><span class=p>;</span>
</code></pre></div> <h3 id=location>location<a class=headerlink href=#location title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>location</strong> <code>[ = \| ~ \| ~* \| ^~ ] uri { ... }</code>; <br> <strong>location</strong> <code>@name { ... }</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>——</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>server、location</td> </tr> </tbody> </table> <p>根据请求 URI 设置配置。</p> <p>在解码以 <code>％XX</code> 形式编码的文本，解析对相对路径组件 <code>.</code> 和<code>..</code> 的引用并且将两个或更多个相邻斜线<a href=#merge_slashes>压缩</a>成单斜线之后，对规范化的 URI 执行匹配。</p> <p>location 可以由前缀字符串定义，也可以由正则表达式定义。正则表达式前面使用<code>~*</code>修正符（用于不区分大小写的匹配）或 <code>~</code> 修正符（用于区分大小写的匹配）指定。要查找匹配给定请求的 location，nginx 首先检查使用前缀字符串（前缀 location）定义的 location。期间，前缀最长的 location 被匹配选中并记住。然后按照它们在配置文件中出现的顺序检查正则表达式。正则表达式的搜索将在第一次匹配时终止，并使用相应的配置。如果找不到正则表达式的匹配，则使用先前记住的前缀 location 的配置。</p> <p>location 块可以嵌套，除了下面提到的一些例外。</p> <p>对于不区分大小写的操作系统，如 macOS 和 Cygwin，与前缀字符串匹配忽略大小写（0.7.7）。但是，比较仅限于一个字节的区域设置。</p> <p>正则表达式可以包含捕获（0.7.40），之后可以在其他指令中使用。</p> <p>如果最长匹配的前缀 location 具有 <code>^~</code> 修正符，则不检查正则表达式。</p> <p>另外，使用 <code>=</code> 修正符可以使 URI 和 location 的匹配精确。如果找到完全匹配，则搜索结束。例如，如果 <code>/</code> 请求频繁，那么定义 <code>location=/</code> 会加快这些请求的处理速度，因为搜索在第一次比较之后会立即终止。这样的 location 不能包含嵌套 location。</p> <blockquote> <p>从 0.7.1 到 0.8.41 版本，如果请求与没有 <code>=</code> 和 <code>^~</code> 修正符的前缀 location 匹配，则搜索也会终止，并且不再检查正则表达式。</p> </blockquote> <p>下面举一个例子来说明：</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>[</span><span class=w> </span><span class=s>configuration</span><span class=w> </span><span class=s>A</span><span class=w> </span><span class=s>]</span>
<span class=err>}</span>

<span class=s>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>[</span><span class=w> </span><span class=s>configuration</span><span class=w> </span><span class=s>B</span><span class=w> </span><span class=s>]</span>
<span class=err>}</span>

<span class=s>location</span><span class=w> </span><span class=s>/documents/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>[</span><span class=w> </span><span class=s>configuration</span><span class=w> </span><span class=s>C</span><span class=w> </span><span class=s>]</span>
<span class=err>}</span>

<span class=s>location</span><span class=w> </span><span class=s>^~</span><span class=w> </span><span class=s>/images/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>[</span><span class=w> </span><span class=s>configuration</span><span class=w> </span><span class=s>D</span><span class=w> </span><span class=s>]</span>
<span class=err>}</span>

<span class=s>location</span><span class=w> </span><span class=p>~</span><span class=sr>*</span><span class=w> </span><span class=s>\.(gif|jpg|jpeg)</span>$<span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>[</span><span class=w> </span><span class=s>configuration</span><span class=w> </span><span class=s>E</span><span class=w> </span><span class=s>]</span>
<span class=err>}</span>
</code></pre></div> <p><code>/</code> 请求将与配置 A 匹配，<code>/index.html</code> 请求将匹配配置 B，<code>/documents/document.html</code> 请求将匹配配置 C，<code>/images/1.gif</code> 请求将匹配配置 D，<code>/documents/1.jpg</code> 请求将匹配配置 E。</p> <p><code>@</code> 前缀定义了一个命名 location。这样的 location 不用于常规的请求处理，而是用于请求重定向。它们不能嵌套，也不能包含嵌套的 location。</p> <p>如果某个 location 由以斜杠字符结尾的前缀字符串定义，并且请求由 <a href=../ngx_http_proxy_module/#proxy_pass>proxy_pass</a>、<a href=../ngx_http_fastcgi_module/#fastcgi_pass>fastcgi_pass</a>、<a href=../ngx_http_uwsgi_module/#uwsgi_pass>uwsgi_pass</a>、<a href=../ngx_http_scgi_module/#scgi_pass>scgi_pass</a> 或 <a href=../ngx_http_memcached_module/#memcached_pass>memcached_pa​​ss</a> 中的一个进行处理，则会执行特殊处理。为了响应 URI 为该字符串的请求，但没有以斜杠结尾，带有 301 代码的永久重定向将返回所请求的 URI，并附上斜线。如果不需要，可以像以下这样定义 URI 和 location 的精确匹配：</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/user/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://user.example.com</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>location</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>/user</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://login.example.com</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <h3 id=log_not_found>log_not_found<a class=headerlink href=#log_not_found title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>log_not_found</strong> <code>on \| off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>log_not_found on;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>启用或禁用将文件未找到错误记录到 <a href=#error_log>error_log</a> 中。</p> <h3 id=log_subrequest>log_subrequest<a class=headerlink href=#log_subrequest title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>log_subrequest</strong> <code>on \| off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>log_subrequest off;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>启用或禁用将子请求记录到 <a href=../ngx_http_log_module/#access_log>access_log</a> 中。</p> <h3 id=max_ranges>max_ranges<a class=headerlink href=#max_ranges title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>merge_slashes</strong> <code>number</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>——</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> <tr> <td align=left><strong>提示</strong></td> <td align=left>该指令在 1.1.2 版本中出现</td> </tr> </tbody> </table> <p>限制 byte-range 请求中允许的最大范围数。如果没有指定字节范围，则处理超出限制的请求。 默认情况下，范围的数量不受限制。零值将完全禁用 byte-range 支持。</p> <h3 id=merge_slashes>merge_slashes<a class=headerlink href=#merge_slashes title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>merge_slashes</strong> <code>on \| off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>merge_slashes on;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server</td> </tr> </tbody> </table> <p>启用或禁用将 URI 中两个或多个相邻斜线压缩为单斜线。</p> <p>请注意，压缩对于正确匹配前缀字符串和正则表达式的 location 非常重要。没有它，将不匹配 <code>//scripts/one.php</code> 请求：</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/scripts/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>...</span>
<span class=err>}</span>
</code></pre></div> <p>并可能被作为一个静态文件处理。因此它需要被转换成 <code>/scripts/one.php</code>。</p> <p>因为 base64 在内部使用 <code>/</code> 字符，所以如果 URI 包含 base64 编码的名称，则可能需要关闭压缩。但是，出于安全考虑，最好不要关闭压缩。</p> <p>如果该指令是在 <a href=#server>server</a> 级别指定的，则仅在 server 是默认 server 时才使用该指令。指定的值也适用于监听相同地址和端口的所有虚拟服务器。</p> <h3 id=msie_padding>msie_padding<a class=headerlink href=#msie_padding title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>msie_padding</strong> <code>on \| off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>msie_padding on;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>启用或禁用向状态超过 400 的 MSIE 客户端响应添加注释以将响应大小增加到 512 字节。</p> <h3 id=msie_refresh>msie_refresh<a class=headerlink href=#msie_refresh title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>msie_refresh</strong> <code>on \| off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>msie_refresh off;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>启用或禁用发布刷新替代 MSIE 客户端重定向。</p> <h3 id=open_file_cache>open_file_cache<a class=headerlink href=#open_file_cache title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>open_file_cache</strong> <code>off</code>; <br> <strong>open_file_cache</strong> <code>max=N [inactive=time]</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>open_file_cache off;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>配置一个缓存，可以存储：</p> <ul> <li>打开文件描述符、大小和修改时间</li> <li>有关目录是否存在信息</li> <li>文件查找错误，如**找不到文件**、**没有读取权限**等</li> </ul> <blockquote> <p>应该通过 <a href=#open_file_cache_errors>open_file_cache_errors</a> 指令分别启用缓存错误。</p> </blockquote> <p>该指令有以下参数：</p> <ul> <li> <p><code>max</code></p> <p>设置缓存中元素的最大数量。在缓存溢出时，最近最少使用的（LRU）元素将被移除 - <code>inactive</code></p> <p>定义一个时间，在这个时间之后，元素在缓存中将被删除，默认是 60 秒 - <code>off</code></p> <p>禁用缓存</p> </li> </ul> <p>示例：</p> <div class=highlight><pre><span></span><code><span class=k>open_file_cache</span><span class=w>          </span><span class=s>max=1000</span><span class=w> </span><span class=s>inactive=20s</span><span class=p>;</span>
<span class=k>open_file_cache_valid</span><span class=w>    </span><span class=s>30s</span><span class=p>;</span>
<span class=k>open_file_cache_min_uses</span><span class=w> </span><span class=mi>2</span><span class=p>;</span>
<span class=k>open_file_cache_errors</span><span class=w>   </span><span class=no>on</span><span class=p>;</span>
</code></pre></div> <h3 id=open_file_cache_errors>open_file_cache_errors<a class=headerlink href=#open_file_cache_errors title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>open_file_cache_errors</strong> <code>off</code> | <code>on</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>open_file_cache_errors off;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>通过 <a href=#open_file_cache>open_file_cache</a> 启用或禁用文件查找错误缓存。</p> <h3 id=open_file_cache_min_uses>open_file_cache_min_uses<a class=headerlink href=#open_file_cache_min_uses title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>open_file_cache_min_uses</strong> <code>number</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>open_file_cache_min_uses 1;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>设置由 <a href=#open_file_cache>open_file_cache</a> 指令的 <code>inactive</code> 参数配置的时间段内文件访问的最小 <code>number</code> （次数），这是文件描述符在缓存中保持打开状态所必需的。</p> <h3 id=open_file_cache_valid>open_file_cache_valid<a class=headerlink href=#open_file_cache_valid title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>open_file_cache_valid</strong> <code>time</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>open_file_cache_valid 60s;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>设置 <a href=#open_file_cache>open_file_cache</a> 元素应该验证的时间。</p> <h3 id=output_buffers>output_buffers<a class=headerlink href=#output_buffers title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>output_buffers</strong> <code>number size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>output_buffers 2 32k;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>设置从磁盘读取响应缓冲区的 <code>number</code> （数量）和 <code>size</code> （大小）。</p> <blockquote> <p>在 1.9.5 版本之前，默认值是 <code>1 32k</code>。</p> </blockquote> <h3 id=port_in_redirect>port_in_redirect<a class=headerlink href=#port_in_redirect title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>port_in_redirect</strong> <code>on</code> | <code>off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>port_in_redirect on;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>启用或禁用指定由 nginx 发出的<a href=#absolute_redirect>绝对</a>重定向中的端口。</p> <blockquote> <p>在重定向中使用的主服务器名称由 <a href=#server_name_in_redirect>server_name_in_redirect</a> 指令控制。</p> </blockquote> <h3 id=postpone_output>postpone_output<a class=headerlink href=#postpone_output title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>postpone_output</strong> <code>size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>postpone_output 1460;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>如果指定的话，客户端数据的传输将被推迟，直到 nginx 至少有 <code>size</code> 字节的数据要发送。零值将禁止延迟数据传输。</p> <h3 id=read_ahead>read_ahead<a class=headerlink href=#read_ahead title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>read_ahead</strong> <code>sizef</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>read_ahead 0;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>设置使用文件时内核的预读数量。</p> <p>在 Linux 上，使用 <code>posix_fadvise</code>（<code>0, 0, 0, POSIX_FADV_SEQUENTIAL</code>）系统调用，因此 <code>size</code> 参数将被忽略。</p> <p>在 FreeBSD 上，使用自 FreeBSD 9.0-CURRENT 后支持的 <code>fcntl</code>（<code>O_READAHEAD, size</code>）系统调用。FreeBSD 7 需要<a href=http://sysoev.ru/freebsd/patch.readahead.txt>打补丁</a>。</p> <h3 id=recursive_error_pages>recursive_error_pages<a class=headerlink href=#recursive_error_pages title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>recursive_error_pages</strong> <code>on</code> | <code>off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>reset_timedout_connection off;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>启用或禁用使用 <a href=#error_page>error_page</a> 指令执行多个重定向。这种重定向的数量是<a href=#internal>有限</a>的。</p> <h3 id=request_pool_size>request_pool_size<a class=headerlink href=#request_pool_size title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>request_pool_size</strong> <code>size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>request_pool_size 4k;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server</td> </tr> </tbody> </table> <p>允许精确调整每个请求的内存分配。该指令对性能影响最小，一般不应该使用。</p> <h3 id=reset_timedout_connection>reset_timedout_connection<a class=headerlink href=#reset_timedout_connection title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>reset_timedout_connection</strong> <code>on</code> | <code>off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>reset_timedout_connection off;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>启用或禁用重置超时连接。重置过程如下。在关闭一个套接字之前，<code>SO_LINGER</code> 选项超时值被设置为 0。当套接字关闭时，TCP RST 被发送到客户端，并且释放该套接字占用的所有内存。这有助于避免长时间持有一个缓冲区已经被填充 FIN_WAIT1 状态的已关闭套接字。</p> <p>应该注意，超时的 keep-alive 连接被正常关闭。</p> <h3 id=resolver>resolver<a class=headerlink href=#resolver title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>resolver</strong> <code>address ... [valid=time] [ipv6=on|off]</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>——</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>将用于解析 upstream 服务器名称的名称服务器配置进指定的地址，例如：</p> <div class=highlight><pre><span></span><code><span class=k>resolver</span><span class=w> </span><span class=mi>127</span><span class=s>.0.0.1</span><span class=w> </span><span class=s>[::</span><span class=w> </span><span class=mi>1</span><span class=s>]:5353</span><span class=p>;</span>
</code></pre></div> <p>地址可以指定为域名或 IP 地址，也可以指定一个可选的端口（1.3.1，1.2.2）。如果没有指定端口，则使用端口 53。名称服务器以轮询方式查询。</p> <blockquote> <p>在 1.1.7 版本之前，只能配置一个名称服务器。从 1.3.1 和 1.2.2 版本开始，支持使用 IPv6 地址来指定名称服务器。</p> </blockquote> <p>默认情况下，nginx 将在解析时查找 IPv4 和 IPv6 地址。如果不想查找 IPv6 地址，则可以指定 <code>ipv6=off</code> 参数。</p> <blockquote> <p>从 1.5.8 版本开始，支持将名称解析为 IPv6 地址。</p> </blockquote> <p>默认情况下，nginx 使用响应的 TTL 值缓存回复。可选的 <code>valid</code> 参数可以覆盖它：</p> <div class=highlight><pre><span></span><code><span class=k>resolver</span><span class=w> </span><span class=mi>127</span><span class=s>.0.0.1</span><span class=w> </span><span class=s>[::</span><span class=w> </span><span class=mi>1</span><span class=s>]:5353</span><span class=w> </span><span class=s>valid=30s</span><span class=p>;</span>
</code></pre></div> <blockquote> <p>在 1.1.9 版本之前，缓存时间是不能调整的，nginx 总是缓存 5 分钟的回复。</p> <p>为了防止 DNS 欺骗，建议在安全的可信任本地网络中配置 DNS 服务器。</p> </blockquote> <h3 id=satisfy>satisfy<a class=headerlink href=#satisfy title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>satisfy</strong> <code>all</code> | <code>any</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>satisfy all;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>如果所有（全部）或至少一个（任意一个） <a href=../ngx_http_access_module/ >ngx_http_access_module</a>、<a href=../ngx_http_auth_basic_module/ >ngx_http_auth_basic_module</a>、<a href=../ngx_http_auth_request_module/ >ngx_http_auth_request_module</a> 或 <a href=../ngx_http_auth_jwt_module/ >ngx_http_auth_jwt_module</a> 模块允许访问，则允许访问。</p> <p>示例：</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>satisfy</span><span class=w> </span><span class=s>any</span><span class=p>;</span>

<span class=w>    </span><span class=kn>allow</span><span class=w> </span><span class=mi>192</span><span class=s>.168.1.0/32</span><span class=p>;</span>
<span class=w>    </span><span class=kn>deny</span><span class=w>  </span><span class=s>all</span><span class=p>;</span>

<span class=w>    </span><span class=kn>auth_basic</span><span class=w>           </span><span class=s>&quot;closed</span><span class=w> </span><span class=s>site&quot;</span><span class=p>;</span>
<span class=w>    </span><span class=kn>auth_basic_user_file</span><span class=w> </span><span class=s>conf/htpasswd</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <h3 id=send_lowat>send_lowat<a class=headerlink href=#send_lowat title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>send_lowat</strong> <code>size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>send_lowat 0;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>如果指令设置为非零值，nginx 将尝试通过使用 <a href=http://nginx.org/en/docs/events.html#kqueue>kqueue</a> 方法的 <code>NOTE_LOWAT</code> 标志或<code>SO_SNDLOWAT</code> 套接字选项来最小化客户端套接字上的发送操作数。在这两种情况下都使用到了指定的 <code>size</code>。</p> <p>该指令在 Linux、Solaris 和 Windows 上被忽略。</p> <h3 id=send_timeout>send_timeout<a class=headerlink href=#send_timeout title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>send_timeout</strong> <code>time</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>send_timeout 60s;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>设置向客户端发送响应的超时时间。超时设置只限定在两次连续的写入操作之间，而不是用于整个响应的传输。如果客户端在此时间内没有收到任何内容，则连接将被关闭。</p> <h3 id=sendfile>sendfile<a class=headerlink href=#sendfile title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>sendfile</strong> <code>on</code> | <code>off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>sendfile off;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location、location 中的 if</td> </tr> </tbody> </table> <p>启用或禁用 <code>sendfile()</code>。</p> <p>从 nginx 0.8.12 和 FreeBSD 5.2.1 开始，可以用 <a href=#aio>aio</a> 来为 <code>sendfile()</code> 预加载数据：</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/video/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>sendfile</span><span class=w>       </span><span class=no>on</span><span class=p>;</span>
<span class=w>    </span><span class=kn>tcp_nopush</span><span class=w>     </span><span class=no>on</span><span class=p>;</span>
<span class=w>    </span><span class=kn>aio</span><span class=w>            </span><span class=no>on</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>在此配置中，使用 <code>SF_NODISKIO</code> 标志调用 <code>sendfile()</code>，使其不会阻塞磁盘 I/O，而是以报告数据不在内存中的方式代替。然后 nginx 通过读取一个字节来启动异步数据加载。在第一次读取时，FreeBSD 内核会将文件的第一个 128K 字节加载到内存中，但是下一次读取只能以 16K 块加载数据。可以使用 <a href=#read_ahead>read_ahead</a> 指令进行修改。</p> <blockquote> <p>在 1.7.11 版本之前，可以使用 <code>aio sendfile</code> 来启用预加载。</p> </blockquote> <h3 id=sendfile_max_chunk>sendfile_max_chunk<a class=headerlink href=#sendfile_max_chunk title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left>**sendfile_max_chunk ** <code>size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>sendfile_max_chunk 0;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>设置为非零值时，可限制单个 <code>sendfile()</code> 调用时传输的数据量。如果没有限制，一个快速连接可能会完全占用工作进程。</p> <h3 id=server>server<a class=headerlink href=#server title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>server</strong> <code>{ ... }</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>——</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http</td> </tr> </tbody> </table> <p>设置虚拟服务器的配置。基于 IP（基于 IP 地址）和基于名称（基于 <code>Host</code> 请求头字段）的虚拟服务器之间没有明确的界限。相反，<a href=#listen>listen</a> 指令描述应接受服务器连接的所有地址和端口，<a href=#server_name>server_name</a> 指令列出所有服务器名称。<a href=http://nginx.org/en/docs/http/request_processing.html>如何处理请求</a>文档中提供了配置示例。</p> <h3 id=server_name>server_name<a class=headerlink href=#server_name title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>server_name</strong> <code>name ...</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>server_name "";</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>server</td> </tr> </tbody> </table> <p>设置虚拟服务器名称，例如：</p> <div class=highlight><pre><span></span><code><span class=k>server</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>server_name</span><span class=w> </span><span class=s>example.com</span><span class=w> </span><span class=s>www.example.com</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>第一个名字将成为主服务器名称。</p> <p>服务器名称可以包含一个星号（<code>*</code>）以代替名称的第一部分或最后一部分：</p> <div class=highlight><pre><span></span><code><span class=k>server</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>server_name</span><span class=w> </span><span class=s>example.com</span><span class=w> </span><span class=s>*.example.com</span><span class=w> </span><span class=s>www.example.*</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>这样的名称被称为通配符名称。</p> <p>上面提到的前两个名字可以合并成一个：</p> <div class=highlight><pre><span></span><code><span class=k>server</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>server_name</span><span class=w> </span><span class=s>.example.com</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>也可以在服务器名称中使用正则表达式，在名称前面加上波浪号（<code>〜</code>）：</p> <div class=highlight><pre><span></span><code><span class=k>server</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>server_name</span><span class=w> </span><span class=s>www.example.com</span><span class=w> </span><span class=p>~</span><span class=sr>^www\d+\.example\.com$;</span>
<span class=err>}</span>
</code></pre></div> <p>正则表达式可以包含之后用于其他指令的捕获（0.7.40）：</p> <div class=highlight><pre><span></span><code><span class=k>server</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>server_name</span><span class=w> </span><span class=p>~</span><span class=sr>^(www\.)?(.+)$;</span>

<span class=w>    </span><span class=s>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kn>root</span><span class=w> </span><span class=s>/sites/</span><span class=nv>$2</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=k>server</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>server_name</span><span class=w> </span><span class=s>_</span><span class=p>;</span>

<span class=w>    </span><span class=kn>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kn>root</span><span class=w> </span><span class=s>/sites/default</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>在正则表达式中命名捕获创建变量（0.8.25），之后可在其他指令中使用：</p> <div class=highlight><pre><span></span><code><span class=k>server</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>server_name</span><span class=w> </span><span class=p>~</span><span class=sr>^(www\.)?(?&lt;domain&gt;.+)$;</span>

<span class=w>    </span><span class=s>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kn>root</span><span class=w> </span><span class=s>/sites/</span><span class=nv>$domain</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>

<span class=k>server</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>server_name</span><span class=w> </span><span class=s>_</span><span class=p>;</span>

<span class=w>    </span><span class=kn>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
<span class=w>        </span><span class=kn>root</span><span class=w> </span><span class=s>/sites/default</span><span class=p>;</span>
<span class=w>    </span><span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>如果指令参数设置为 <code>$hostname</code>（0.9.4），则将替换为机器的主机名。</p> <p>也可以指定一个空的服务器名称（0.7.11）：</p> <div class=highlight><pre><span></span><code><span class=k>server</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>server_name</span><span class=w> </span><span class=s>www.example.com</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>它允许这个服务器对给定的 address:port 对处理没有 <code>Host</code> 头的请求，而不是默认的服务器。这是默认设置。</p> <blockquote> <p>在 0.8.48 之前，默认使用机器的主机名。</p> </blockquote> <p>在按名称搜索虚拟服务器的过程中，如果名称与多个指定变体相匹配（例如，通配符名称和正则表达式匹配），将按照以下优先顺序选择第一个匹配变体：</p> <ol> <li>确切的名字</li> <li>以星号开头的最长通配符名称，例如 <code>*.example.com</code></li> <li>以星号结尾的最长通配符名称，例如 <code>mail.*</code></li> <li>第一个匹配的正则表达式（按照配置文件中的出现顺序）</li> </ol> <p>服务器名称的详细描述在单独的<a href=http://nginx.org/en/docs/http/server_names.html>服务器名称</a>文档中提供。</p> <h3 id=server_name_in_redirect>server_name_in_redirect<a class=headerlink href=#server_name_in_redirect title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>server_name</strong> <code>on</code> | <code>off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>server_name_in_redirect off;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>启用或禁用在由 nginx 发出的 <a href=#absolute_redirect>absolute</a> 指令中使用由 <a href=#server_name>server_name</a> 指令指定的主服务器名称。当禁用主服务器名称时，将使用 <code>Host</code> 请求头字段中的名称。如果此字段不存在，则使用服务器的 IP 地址。</p> <p>重定向中使用端口由 <a href=#port_in_redirect>port_in_redirect</a> 指令控制。</p> <h3 id=server_names_hash_bucket_size>server_names_hash_bucket_size<a class=headerlink href=#server_names_hash_bucket_size title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>server_names_hash_bucket_size</strong> <code>size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>server_names_hash_bucket_size 32</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http</td> </tr> </tbody> </table> <p>设置服务器名称哈希表的存储桶大小。默认值取决于处理器缓存行的大小。设置哈希表的细节在单独的<a href=http://nginx.org/en/docs/hash.html>文档</a>中提供。</p> <h3 id=server_names_hash_max_size>server_names_hash_max_size<a class=headerlink href=#server_names_hash_max_size title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>server_names_hash_max_size</strong> <code>size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>server_names_hash_max_size 512;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http</td> </tr> </tbody> </table> <p>设置服务器名称哈希表的最大大小。设置哈希表的细节在单独的<a href=(http://nginx.org/en/docs/hash.html)>文档</a>中提供。</p> <h3 id=server_tokens>server_tokens<a class=headerlink href=#server_tokens title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>server_tokens</strong> <code>on</code> | <code>off</code> | <code>build</code> | <code>string</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>server_tokens on;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>在错误页面和 <code>Server</code> 响应头字段中启用或禁用发送 nginx 版本。</p> <p><code>build</code> 参数（1.11.10）能够发送构建名称以及 nginx 版本。</p> <p>此外，作为我们的<a href="http://nginx.com/products/?_ga=2.14041591.1300915338.1513355851-1890203964.1497190280">商业订阅</a>的一部分，从1.9.13 版本开始，可以使用带有变量的字符串显式设置错误页面上的签名和 <code>Server</code> 响应头字段值。指定空字符串将禁用 <code>Server</code> 字段的发送。</p> <h3 id=tcp_nodelay>tcp_nodelay<a class=headerlink href=#tcp_nodelay title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>tcp_nodelay</strong> <code>on</code> | <code>off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>tcp_nodelay on;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>启用或禁用 <code>TCP_NODELAY</code> 选项的使用。该选项仅在连接转换到 keep-alive 状态时启用。</p> <h3 id=tcp_nopush>tcp_nopush<a class=headerlink href=#tcp_nopush title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>tcp_nopush</strong> <code>on</code> | <code>off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>tcp_nopush off;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>启用或禁用在 FreeBSD 上使用 <code>TCP_NOPUSH</code> 套接字选项或在 Linux 上使用 <code>TCP_CORK</code> 套接字选项。这些选项只有在使用 <a href=#sendfile>sendfile</a> 时才能使用。启用该选项将允许：</p> <ul> <li>在 Linux 和 FreeBSD 4 上，在同一包中可发送响应头和文件开头。</li> <li>以完整包的方式发送一个文件</li> </ul> <h3 id=try_files>try_files<a class=headerlink href=#try_files title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>try_files</strong> <code>file ... uri</code>; <br> <strong>try_files</strong> <code>file ... =code</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>——</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>server、location</td> </tr> </tbody> </table> <p>以指定顺序检查文件是否存在，并使用第一个找到的文件进行请求处理。处理将在当前上下文中执行。指向文件的路径根据 <a href=#root>root</a> 和 <a href=#alias>alias</a> 指令从 <code>file</code> 参数构造。可以通过在名称末尾指定斜线来检查目录是否存在，例如，<code>$URI/</code>。如果找不到任何文件，则内部重定向将指向最后一个参数中指定的 <code>uri</code>。例如：</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/images/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>try_files</span><span class=w> </span><span class=nv>$uri</span><span class=w> </span><span class=s>/images/default.gif</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>location</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>/images/default.gif</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>expires</span><span class=w> </span><span class=s>30s</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>最后一个参数也可以指向一个命名的 location ，如以下示例。从 0.7.51 版本开始，最后一个参数也可以是一个 <code>code</code>：</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>try_files</span><span class=w> </span><span class=nv>$uri</span><span class=w> </span><span class=nv>$uri/index.html</span><span class=w> </span><span class=nv>$uri.html</span><span class=w> </span><span class=p>=</span><span class=mi>404</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>代理 Mongrel 示例：</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>try_files</span><span class=w> </span><span class=s>/system/maintenance.html</span>
<span class=w>              </span><span class=nv>$uri</span><span class=w> </span><span class=nv>$uri/index.html</span><span class=w> </span><span class=nv>$uri.html</span>
<span class=w>              </span><span class=s>@mongrel</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>location</span><span class=w> </span><span class=s>@mongrel</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://mongrel</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>Drupal/FastCGI 示例：</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>try_files</span><span class=w> </span><span class=nv>$uri</span><span class=w> </span><span class=nv>$uri/</span><span class=w> </span><span class=s>@drupal</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>location</span><span class=w> </span><span class=p>~</span><span class=w> </span><span class=sr>\.php$</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>try_files</span><span class=w> </span><span class=nv>$uri</span><span class=w> </span><span class=s>@drupal</span><span class=p>;</span>

<span class=w>    </span><span class=kn>fastcgi_pass</span><span class=w> </span><span class=s>...</span><span class=p>;</span>

<span class=w>    </span><span class=kn>fastcgi_param</span><span class=w> </span><span class=s>SCRIPT_FILENAME</span><span class=w> </span><span class=s>/path/to</span><span class=nv>$fastcgi_script_name</span><span class=p>;</span>
<span class=w>    </span><span class=kn>fastcgi_param</span><span class=w> </span><span class=s>SCRIPT_NAME</span><span class=w>     </span><span class=nv>$fastcgi_script_name</span><span class=p>;</span>
<span class=w>    </span><span class=kn>fastcgi_param</span><span class=w> </span><span class=s>QUERY_STRING</span><span class=w>    </span><span class=nv>$args</span><span class=p>;</span>

<span class=w>    </span><span class=kn>...</span><span class=w> </span><span class=s>other</span><span class=w> </span><span class=s>fastcgi_param&#39;s</span>
<span class=err>}</span>

<span class=s>location</span><span class=w> </span><span class=s>@drupal</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>fastcgi_pass</span><span class=w> </span><span class=s>...</span><span class=p>;</span>

<span class=w>    </span><span class=kn>fastcgi_param</span><span class=w> </span><span class=s>SCRIPT_FILENAME</span><span class=w> </span><span class=s>/path/to/index.php</span><span class=p>;</span>
<span class=w>    </span><span class=kn>fastcgi_param</span><span class=w> </span><span class=s>SCRIPT_NAME</span><span class=w>     </span><span class=s>/index.php</span><span class=p>;</span>
<span class=w>    </span><span class=kn>fastcgi_param</span><span class=w> </span><span class=s>QUERY_STRING</span><span class=w>    </span><span class=s>q=</span><span class=nv>$uri&amp;$args</span><span class=p>;</span>

<span class=w>    </span><span class=kn>...</span><span class=w> </span><span class=s>other</span><span class=w> </span><span class=s>fastcgi_param&#39;s</span>
<span class=err>}</span>
</code></pre></div> <p>在以下示例中</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>try_files</span><span class=w> </span><span class=nv>$uri</span><span class=w> </span><span class=nv>$uri/</span><span class=w> </span><span class=s>@drupal</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>try_files 指令相当于</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>error_page</span><span class=w> </span><span class=mi>404</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>@drupal</span><span class=p>;</span>
<span class=w>    </span><span class=kn>log_not_found</span><span class=w> </span><span class=no>off</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>还有一个示例</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=p>~</span><span class=w> </span><span class=sr>\.php$</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>try_files</span><span class=w> </span><span class=nv>$uri</span><span class=w> </span><span class=s>@drupal</span><span class=p>;</span>

<span class=w>    </span><span class=kn>fastcgi_pass</span><span class=w> </span><span class=s>...</span><span class=p>;</span>

<span class=w>    </span><span class=kn>fastcgi_param</span><span class=w> </span><span class=s>SCRIPT_FILENAME</span><span class=w> </span><span class=s>/path/to</span><span class=nv>$fastcgi_script_name</span><span class=p>;</span>

<span class=w>    </span><span class=kn>...</span>
<span class=err>}</span>
</code></pre></div> <p>在将请求传递给 FastCGI 服务器之前，try_files 将检查 PHP 文件是否存在。</p> <p>Wordpress 与 Joomla 示例：</p> <div class=highlight><pre><span></span><code><span class=k>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>try_files</span><span class=w> </span><span class=nv>$uri</span><span class=w> </span><span class=nv>$uri/</span><span class=w> </span><span class=s>@wordpress</span><span class=p>;</span>
<span class=p>}</span>

<span class=k>location</span><span class=w> </span><span class=p>~</span><span class=w> </span><span class=sr>\.php$</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>try_files</span><span class=w> </span><span class=nv>$uri</span><span class=w> </span><span class=s>@wordpress</span><span class=p>;</span>

<span class=w>    </span><span class=kn>fastcgi_pass</span><span class=w> </span><span class=s>...</span><span class=p>;</span>

<span class=w>    </span><span class=kn>fastcgi_param</span><span class=w> </span><span class=s>SCRIPT_FILENAME</span><span class=w> </span><span class=s>/path/to</span><span class=nv>$fastcgi_script_name</span><span class=p>;</span>
<span class=w>    </span><span class=kn>...</span><span class=w> </span><span class=s>other</span><span class=w> </span><span class=s>fastcgi_param&#39;s</span>
<span class=err>}</span>

<span class=s>location</span><span class=w> </span><span class=s>@wordpress</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=kn>fastcgi_pass</span><span class=w> </span><span class=s>...</span><span class=p>;</span>

<span class=w>    </span><span class=kn>fastcgi_param</span><span class=w> </span><span class=s>SCRIPT_FILENAME</span><span class=w> </span><span class=s>/path/to/index.php</span><span class=p>;</span>
<span class=w>    </span><span class=kn>...</span><span class=w> </span><span class=s>other</span><span class=w> </span><span class=s>fastcgi_param&#39;s</span>
<span class=err>}</span>
</code></pre></div> <h3 id=types_hash_bucket_size>types_hash_bucket_size<a class=headerlink href=#types_hash_bucket_size title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>types_hash_bucket_size</strong> <code>size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>types_hash_bucket_size 64;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>设置类型哈希表桶大小。设置哈希表的细节在单独的<a href=http://nginx.org/en/docs/hash.html>文档</a>中有提供。</p> <blockquote> <p>在版 1.5.13 本之前，默认值取决于处理器缓存行的大小。</p> </blockquote> <h3 id=types_hash_max_size>types_hash_max_size<a class=headerlink href=#types_hash_max_size title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>types_hash_max_size</strong> <code>size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>types_hash_max_size 1024;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server、location</td> </tr> </tbody> </table> <p>设置类型哈希表的最大大小。设置哈希表的细节在单独的<a href=http://nginx.org/en/docs/hash.html>文档</a>中有提供。</p> <h3 id=underscores_in_headers>underscores_in_headers<a class=headerlink href=#underscores_in_headers title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>underscores_in_headers</strong> <code>on</code> | <code>off</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>underscores_in_headers off;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http、server</td> </tr> </tbody> </table> <p>启用或禁用在客户端请求头字段中使用下划线。当禁用下划线时，名称中包含下划线的请求头字段将被标记为无效，并受制于 <a href=#ignore_invalid_headers>ignore_invalid_headers</a> 指令。</p> <p>如果该指令是在 <a href=#server>server</a> 级别指定，则仅在 server 是默认 server 时才使用该指令。指定的值也适用于监听相同地址和端口的所有虚拟服务器。</p> <h3 id=variables_hash_bucket_size>variables_hash_bucket_size<a class=headerlink href=#variables_hash_bucket_size title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>variables_hash_bucket_size</strong> <code>size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>variables_hash_bucket_size size;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http</td> </tr> </tbody> </table> <p>设置变量哈希表桶大小。设置哈希表的细节在单独的<a href=http://nginx.org/en/docs/hash.html>文档</a>中有提供。</p> <h3 id=variables_hash_max_size>variables_hash_max_size<a class=headerlink href=#variables_hash_max_size title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th align=left>-</th> <th align=left>说明</th> </tr> </thead> <tbody> <tr> <td align=left><strong>语法</strong></td> <td align=left><strong>variables_hash_max_size</strong> <code>size</code>;</td> </tr> <tr> <td align=left><strong>默认</strong></td> <td align=left>variables_hash_max_size 1024;</td> </tr> <tr> <td align=left><strong>上下文</strong></td> <td align=left>http</td> </tr> </tbody> </table> <p>设置变量哈哈希表的最大大小。设置哈希表的细节在单独的<a href=http://nginx.org/en/docs/hash.html>文档</a>中有提供。</p> <blockquote> <p>在 1.5.13 版本之前，默认值是 512。</p> </blockquote> <p><a id=embedded_variables></a></p> <h2 id=_2>内嵌变量<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p><code>ngx_http_core_module</code> 模块支持嵌入式变量名称与 Apache 服务器变量匹配。首先，这些是出现在客户端请求头字段的变量，例如 <code>$http_user_agent</code>、<code>$http_cookie</code> 等等。还有其他变量：</p> <ul> <li> <p><code>$arg_name</code></p> <p>请求行中的 <code>name</code> 参数</p> </li> <li> <p><code>$args</code></p> <p>请求行中的参数</p> </li> <li> <p><code>$binary_remote_addr</code></p> <p>客户端地址以二进制形式表示，值的长度对于 IPv4 地址总是 4 个字节，对于 IPv6 地址总是 16 个字节 - <code>$body_bytes_sent</code></p> <p>发送到客户端的字节数，不包括响应头。此变量与 <code>mod_log_config</code> Apache 模块的 <code>％B</code> 参数兼容</p> </li> <li> <p><code>$bytes_sent</code></p> <p>发送到客户端的字节数（1.3.8、1.2.5）</p> </li> <li> <p>$connection</p> <p>连接序列号（1.3.8、1.2.5）</p> </li> <li> <p><code>$connection_requests</code></p> <p>当前通过连接请求的请求数（1.3.8、1.2.5）</p> </li> <li> <p><code>$connect_length</code></p> <p><code>Content-Length</code> 请求头字段</p> </li> <li> <p><code>$content_type</code></p> <p><code>Content-Type</code> 请求头字段</p> </li> <li> <p><code>$cookie_name</code></p> <p>名称为 <code>name</code> 的 cookie</p> </li> <li> <p><code>$document_root</code></p> <p>根目录或别名指令的当前请求的值</p> </li> <li> <p><code>$document_uri</code></p> <p>与 <code>$uri</code> 相同</p> </li> <li> <p><code>$host</code></p> <p>按照以下优先顺序：来自请求行的主机名，来自 <code>Host</code> 请求头字段的主机名，或与请求匹配的服务器名</p> </li> <li> <p><code>$hostname</code></p> <p>主机名</p> </li> <li> <p><code>$http_name</code></p> <p>任意请求头字段,变量名称的最后一部分是将字段名称转换为小写，并用破折号替换为下划线</p> </li> <li> <p><code>$https</code></p> <p>如果连接以 SSL 模式运行，则为 <code>on</code>，否则为空字符串</p> </li> <li> <p><code>$is_args</code></p> <p>如果请求行有参数则为 <code>?</code>，否则为空字符串</p> </li> <li> <p><code>$limit_rate</code></p> <p>设置这个变量可以实现响应速率限制，见 <a href=#limit_rate>limit_rate</a></p> </li> <li> <p><code>$msec</code></p> <p>当前时间以毫秒为单位（1.3.9、1.2.6）</p> </li> <li> <p><code>$nginx_version</code></p> <p>nginx 版本</p> </li> <li> <p><code>$pid</code></p> <p>工作进程的 PID</p> </li> <li> <p><code>$pipe</code></p> <p>如果请求是管道模式则为 <code>p</code>，否则为 <code>.</code>（1.3.12、1.2.7）</p> </li> <li> <p><code>$proxy_protocol_addr</code></p> <p>来自 PROXY 协议头的客户端地址，否则为空字符串（1.5.12）</p> <p>要在 <a href=#listen>listen</a> 指令中设置 <code>proxy_protocol</code> 参数，必须先启用 PROXY 协议。</p> </li> <li> <p><code>$proxy_protocol_port</code> </p> <p>PROXY 协议头中的客户端口，否则为空字符串（1.11.0）</p> <p>要在 <a href=#listen>listen</a> 指令中设置 <code>proxy_protocol</code> 参数，必须先启用 PROXY 协议。</p> </li> <li> <p><code>$query_string</code></p> <p>与 <code>$args</code> 相同</p> </li> <li> <p><code>$realpath_root</code></p> <p>与当前请求的 <a href=#root>root</a> 或 <a href=#alias>alias</a> 指令值相对应的绝对路径名，所有符号链接都将解析为实际路径</p> </li> <li> <p><code>$remote_addr</code></p> <p>客户端地址</p> </li> <li> <p><code>$remote_port</code></p> <p>客户端端口</p> </li> <li> <p><code>$remote_user</code></p> <p>基本身份验证提供的用户名</p> </li> <li> <p><code>$request</code></p> <p>完整的原始请求行</p> </li> <li> <p><code>$request_body</code></p> <p>请求正文</p> <p>当请求正文被读取到<a href=#client_body_buffer_size>内存缓冲区</a>时，变量的值在由<a href=gx_http_proxy_module.md#proxy_pass>proxy_pass</a>、<a href=../ngx_http_fastcgi_module/#fastcgi_pass>fastcgi_pass</a>、<a href=../ngx_http_uwsgi_module/#uwsgi_pass>uwsgi_pass</a> 和 <a href=../ngx_http_scgi_module/#scgi_pass>scgi_pass</a> 指令处理的 location 中可用。</p> </li> <li> <p><code>$request_body_file</code></p> <p>带有请求正文的临时文件的名称</p> <p>在处理结束时，文件需要被删除。想始终将请求主体写入文件中，需要启用 <a href=#client_body_in_file_only>client_body_in_file_only</a>。当临时文件的名称在代理请求中或在向 FastCGI/uwsgi/SCGI 服务器的请求中传递时，应该分别通过 <a href=../ngx_http_proxy_module/#proxy_pass_request_body>proxy_pass_request_body off</a>、<a href=../ngx_http_fastcgi_module/#fastcgi_pass_request_body>fastcgi_pass_request_body off</a>、<a href=../ngx_http_uwsgi_module/#uwsgi_pass_request_body>uwsgi_pass_request_body off</a> 或 <a href=../ngx_http_scgi_module/#scgi_pass_request_body>scgi_pass_request_body off</a> 指令禁用传递请求正文。</p> </li> <li> <p><code>$request_completion</code></p> <p>如果请求已经完成，则返回 <code>OK</code>，否则返回空字符串</p> </li> <li> <p><code>$request_filename</code></p> <p>当前请求的文件路径，基于 <a href=#root>root</a> 或 <a href=#alias>alias</a> 指令以及请求 URI</p> </li> <li> <p><code>$request_id</code></p> <p>由 16 个随机字节生成的唯一请求标识符，以十六进制表示（1.11.0）</p> </li> <li> <p><code>$request_length</code></p> <p>请求长度（包括请求行、头部和请求体）（1.3.12、1.2.7）</p> </li> <li> <p><code>$request_method</code></p> <p>请求方法，通常为 <code>GET</code> 或 <code>POST</code></p> </li> <li> <p><code>$request_time</code></p> <p>请求处理时间以毫秒为单位（1.3.9、1.2.6）。自客户端读取第一个字节的时间起</p> </li> <li> <p><code>$request_uri</code></p> <p>完整的原始请求 URI（带参数）</p> </li> <li> <p><code>$scheme</code></p> <p>请求模式，<code>http</code> 或 <code>https</code></p> </li> <li> <p><code>$sent_http_name</code></p> <p>任意响应头字段。变量名称的最后一部分是将字段名称转换为小写，并用破折号替换为下划线</p> </li> <li> <p><code>$sent_trailer_name</code></p> <p>响应结束时发送的任意字段（1.13.2）。变量名称的最后一部分是将字段名称转换为小写，并用破折号替换为下划线</p> </li> <li> <p><code>$server_addr</code></p> <p>接受请求的服务器地址</p> <p>通常需要一个系统调用来计算这个变量的值。为了避免系统调用，<a href=#listen>listen</a> 指令必须指定地址并使用 <code>bind</code> 参数。</p> </li> <li> <p><code>$server_name</code></p> <p>接受请求的服务器名称</p> </li> <li> <p><code>$server_port</code></p> <p>接受请求的服务器端口</p> </li> <li> <p><code>$server_protocol</code></p> <p>请求协议，通常为 <code>HTTP/1.0</code>、<code>HTTP/1.1</code> 或 <a href=../ngx_http_v2_module/ >HTTP/2.0</a></p> </li> <li> <p><code>$status</code></p> <p>响应状态（1.3.2、1.2.2）</p> </li> <li> <p><code>$tcpinfo_rtt</code>、<code>$tcpinfo_rttvar</code>、<code>$tcpinfo_snd_cwnd</code>、<code>$tcpinfo_rcv_space</code></p> <p>有关客户端 TCP 连接的信息。在支持 <code>TCP_INFO</code> 套接字选项的系统上可用</p> </li> <li> <p><code>$time_iso8601</code></p> <p>本地时间采用 ISO 8601 标准格式（1.3.12、1.2.7）</p> </li> <li> <p><code>$time_local</code></p> <p>通用日志格式（Common Log Format）中的本地时间（1.3.12、1.2.7）</p> </li> <li> <p><code>$uri</code></p> <p><a href=#location>规范化</a>过的当前请求 URI</p> <p><code>$uri</code> 的值可能在请求期间会改变</p> </li> </ul> <h2 id=_3>原文档<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <p><a href=http://nginx.org/en/docs/http/ngx_http_core_module.html>http://nginx.org/en/docs/http/ngx_http_core_module.html</a></p> <hr> <div class=md-source-file> <small> 最后更新: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime">2023-10-17 07:57:07</span> </small> </div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> 回到页面顶部 </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyleft &copy; 2020 - 2023 fengzhao </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top"], "search": "../../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script> <script src=../../../assets/javascripts/bundle.51d95adb.min.js></script> </body> </html>